!function(){"use strict";var e="undefined"!=typeof window?window:global;if("function"!=typeof e.requirejs){var t={},n={},i=function(e,t){return{}.hasOwnProperty.call(e,t)},r=function(e,t){for(var n,i,r=[],o=0,a=(n=/^\.\.?(\/|$)/.test(t)?[e,t].join("/").split("/"):t.split("/")).length;o<a;o++)".."===(i=n[o])?r.pop():"."!==i&&""!==i&&r.push(i);return r.join("/")},o=function(t,i){var o={id:t,exports:{}};return n[t]=o,i(o.exports,function(t){return function(n){var i=function(e){return e.split("/").slice(0,-1).join("/")}(t),o=r(i,n);return e.requirejs(o,t)}}(t),o),o.exports},a=function(e,n){if("object"==typeof e)for(var r in e)i(e,r)&&(t[r]=e[r]);else t[e]=n};e.requirejs=function(e,a){var s=r(e,".");if(null==a&&(a="/"),i(n,s))return n[s].exports;if(i(t,s))return o(s,t[s]);var l=r(s,"./index");if(i(n,l))return n[l].exports;if(i(t,l))return o(l,t[l]);throw new Error('Cannot find module "'+e+'" from "'+a+'"')},e.requirejs.define=a,e.requirejs.register=a,e.requirejs.list=function(){var e=[];for(var n in t)i(t,n)&&e.push(n);return e},e.requirejs.brunch=!0}}(),window.requirejs.define({application:function(e,t,n){var i,r,o,a,s,l,c,u,d,p,f,h,m,v,g,w,y,b,x,k,D,C,F,M,T,S,P,j,E,I,O,V,L,A,B,N,R,H,z,q,W,U,Y,J,G,K,X,Q,Z,ee,te,ne;s=t("models/file_collection"),c=t("models/file_local_collection"),l=t("models/file_group_tab_collection"),t("./models/editor_profile_model"),a=t("./models/editor_profile_collection"),r=t("./models/application_profile_collection"),p=t("./models/keyboard_profile_model"),u=t("./models/file_tabs_model"),h=t("./models/preview_profile_collection"),m=t("./models/store_plugin_collection"),v=t("./models/tag_model"),w=t("./models/user_model"),g=t("./models/tour_model"),t("./models/store_plugin_model"),o=t("./constant"),y=t("./lib/utils"),d=t("./lib/idle_timeouter"),f=t("./lib/notifier"),R=t("./lib/client_file_watch_manager"),E=null,I=new a,O=I.getEditorProfileModel(),P=new r,j=P.getApplicationProfileModel(),W=new p,B=new u,Y=new h,J=Y.getPreviewProfileModel(),Q=new m,Z=new v,ne=new w,ee=new g,V=new s,(A=new c).fetch(),(L=new l).fetch(),q=!1,X=null,C=!1,F=!0,M=!0,D=null,k=!1,b=0,T={},S={},K="",G="",z=function(e){var t,n,r,o,a,s,l,c;if("client"===STORY_PLATFORM&&(t=require("path"),(n=i.getApplicationProfileModel().get("clientResourceRootDir")||"")||(n=t.dirname(process.execPath)),K=n,s=A.getFileLocalModelByFileId(e.id).get("fullPath")||"",G=s?t.dirname(s):n,"local"===e.get("pluginName")&&(c=i.getCurrentStorePluginModel())&&"local"===c.get("name"))){e.get("guid"),l=e.get("parentPath"),o=c.get("entryToken"),a=c.get("extraInfo");try{a=JSON.parse(a)}catch(e){r=e,console.log(r)}return a.useLocalResource&&(o=K),l?(G=t.join(o,l),K=o):G=K=o}},te=!1,U=!1,x=null,H=null,N=function(e){var t;return e=new String(e),t=y.getExt(e)||"",{base:e.substring(e.lastIndexOf("/")+1,e.lastIndexOf(t)),ext:t}},i={setUnlimitedLifeMode:function(e){return te=!!e},getUnlimitedLifeMode:function(){return te},setNonSecurity:function(e){return U=e},getNonSecurity:function(){return U},plugins:{},delayFns:[],state:{dbInited:!1,pluginInited:!1,initFileModel:null},resourcePlugins:{},publicPlugins:{},disabledPlugins:{},objectUrlCache:function(e,t){var n,i,r,o,a,s,l,c,u,d,p,h,m;if(s="",t&&(s=t.id),h=S[u=s+"__##__"+e])return h;r=require("path"),n=require("fs"),i=require("mime"),l=e,z(t),p="",0===l.indexOf("/")?(p=l,c=r.join(K,l)):c=r.join(G,l);try{o=n.statSync(c)}catch(e){if(a=e,!p)return null;try{o=n.statSync(p),c=p}catch(e){return e,null}}return T[u]&&o.mtime===T[u].mtime&&T[u].fileFullPath===c?null:(T[u]={mtime:o.mtime,fileFullPath:c},(d=function(e,t,r){var s,l;try{o=n.readFileSync(e)}catch(e){return a=e,console.log(a),f.showMessage("\u5904\u7406\u9644\u4ef6\u51fa\u9519:"+t+",\u9519\u8bef\u539f\u56e0\uff1a"+a),null}return l=i.lookup(e+"/"+t),s=new Blob([function(e){var t,n,i,r,o,a;for(t=new ArrayBuffer(e.length),a=new Uint8Array(t),i=r=0,o=e.length;r<o;i=++r)n=e[i],a[i]=n;return t}(o)],{type:l}),S[r]=window.URL.createObjectURL(s)})(c,l,u),m=function(e,n,i){if(n.mtimeMs!==i.mtimeMs)return d(c,l,u),t?t.trigger("attachmentChange",t):void 0},T[u].watchFileFn=m,E.watchFile(c,m),S[u])},resetObjectUrlCache:function(){var e,t;if("client"===STORY_PLATFORM)for(e in require("fs"),T)t=T[e],E.unwatchFile(t.fileFullPath,t.watchFileFn);return S={},T={}},getAliasLangMap:function(){return null===x&&i.resetAliasLangMap(),x},resetAliasLangMap:function(){var e;if(x={},e=(e=J.get("aliasLang","")).replace(/\r?\n|\r|\s/g,""))return e.split(";").forEach((function(e){var t,n;if(2===(t=e.split(":")).length&&(n=t[0]))return t[1].split(",").forEach((function(e){if(e)return x[e]=n}))}))},getCommands:function(){return this.homeView.getCommands()},hasCommand:function(e){var t;return!(!e||!(t=this.getCommands()))&&t[e]},execCommand:function(e,t,n){return n=n||window.event,this.homeView.execCommand(e,t,n)},getClientFileWatchManager:function(){return E},getFileCollection:function(){return V},getFileLocalCollection:function(){return A},getFileGroupTabCollection:function(){return L},getEditorProfileModel:function(){return O},getApplicationProfileModel:function(){return j},getPreviewProfileModel:function(){return J},getKeyboardProfileModel:function(){return W},getFileTabsModel:function(){return B},getUploadFilePath:function(e,t,n,i,r){var o,a,s,l,c,u,d,p,f;if(null==e&&(e="attachment"),s="",d={},a=j,(n=$.trim(n))||(n=Date.now()+".xsj"),t&&(d=t.getMeta()),o=function(){var t;switch((t=e.split("/")).length>=2&&(e=t[0]),"image"!==e&&"video"!==e&&"audio"!==e&&(e="attachment"),e){case"image":return d.imagePath||a.get("imagePath");case"audio":return d.audioPath||a.get("audioPath");case"video":return d.videoPath||a.get("videoPath");case"attachment":default:return d.attachmentPath||a.get("attachmentPath")}},u=N(n),p=$.trim(o())+"/"+n,s=d.assetPath||a.get("assetPath")||s){l=_.template(s,{interpolate:/\{\{(.+?)\}\}/g});try{f="\u5c0f\u4e66\u5320",t&&(f=t.get("title")||f),f=f.replace(/[\/\s]/g,"_"),p=l({filename:n,basename:u.base,extname:u.ext,title:f,md5:i,year:(new Date).getFullYear().toString(),month:((new Date).getMonth()+1).toString(),date:(new Date).getDate().toString()}),p=$.trim(p)}catch(e){c=e,console.error(c)}}return(p=(p=(p=(p=p.replace(/\\/g,"/")).replace(/\.+\/+/g,"")).replace(/\/{2,}/g,"/")).replace(/^\/+|\/+$/g,"")).endsWith(u.ext)||(p+=u.ext),p},isFirstUse:function(){return C},isNewest:function(){return F},isNewestDatabase:function(){return M},checkNewestVersion:function(){var e,t,n,i;if(i=parseInt(j.get("version")||0),n=parseInt(j.get("databaseVersion")||0),0===i&&(C=!0),t=10*parseInt(APP_VERSION.replace(/\./g,"")),n<(e=parseInt(DATABASE_VERSION))&&(M=!1,j.set({databaseVersion:e},{silent:!0}),j.save()),i!==t)return F=!1,j.set({version:t},{silent:!0}),j.save()},getStyleText:function(e,t,n){var i,r,a,s,l,c,u,d,p,f,h,m;return null==t&&(t={}),"function"==typeof t&&(n=t,t={}),f=J.get("systemPreviewCss")||"css/preview/default.css",m=J.get("userPreviewCssText")||"",h=!0,r=J.get("codePreviewCss")||"",u="",e&&(u=e.get("cssText")||"")&&(c=y.getCssMetaData(u))&&(c.hasOwnProperty("useSystemPreviewCss")&&(h=c.useSystemPreviewCss),c.hasOwnProperty("previewTheme")&&(d=c.previewTheme,(p=o.previewTheme[d])&&p.url&&(f=p.url),f&&(h=!0)),c.hasOwnProperty("codeTheme")&&(a=c.codeTheme,l=o.codeTheme,(s=l[a])&&s.url&&(r=s.url))),t.systemPreviewCss&&(f=t.systemPreviewCss),t.codePreviewCss&&(r=t.codePreviewCss),f="blank"===f?"":f,i=function(e,t){return $.get(e,(function(e,n,i){return t(null,e)})).fail((function(){return t(null,"")}))},function(e,t){return e?$.get(e,(function(e,n,i){return t(null,e)})).fail((function(){return t()})):t()}(h&&f,(function(e,d){var p;return"auto"===r&&(r="css/preview/code/default.css",(c=y.getCssMetaData(d))&&c.hasOwnProperty("codeTheme")&&(a=c.codeTheme,l=o.codeTheme,(s=l[a])&&s.url&&(r=s.url))),(p=[]).push("css/preview/components.css"),(r="blank"===r?"":r)&&p.push(r),async.map(p,i,(function(e,i){return d&&i.splice(1,0,d),m&&i.push(m),u&&i.push(u),t.userPreviewCssText&&i.push(t.userPreviewCssText),n(null,i.join("\n"))}))}))},getStorePluginModels:function(){return Q.models},getStorePluginCollection:function(){return Q},getCurrentStorePluginModel:function(){var e;return(e=j.get("plugin"))?Q.get(e):null},getCurrentResourcePluginModel:function(){var e;return(e=j.get("resourcePluginId"))?Q.get(e):null},getTagModel:function(){return Z},getUserModel:function(){return ne},getTourModel:function(){return ee},getCurrentFileMode:function(){return this.homeView.fileModel},setCss:function(e){return e},getPlugin:function(e,n,i){var r,o;return"string"!=typeof e&&(i=e,e="",n=""),i&&(e=i.get("name"),n=i.get("kind")),o=null,(r="resource"===n?this.resourcePlugins[e]:"public"===n?this.publicPlugins[e]:this.plugins[e])&&(o=new(t(r.factoryPath))(r.factoryOptions||{}),i&&o.init(i)),o},_initPlugins:function(e){var n,i;if(Q.fetch(),this.plugins={},this.publicPlugins={},this.resourcePlugins={},this.disabledPlugins={},n=_.filter(window.requirejs.list(),(function(e){return/^plugins\/[^\/.]*\/index/.test(e)})),MINI_WEB&&(n=["plugins/github/index","plugins/webdav/index"]),GITHUB_PAGE_WEB&&(n=["plugins/github/index"]),n.forEach((i=this,function(e){var n,r;if(!(r=new(t(e))).production)return i.disabledPlugins[r.name]=r;if("store"===r.kind){if((n=r.platform||"all")===STORY_PLATFORM||"all"===n)return i.plugins[r.name]={factoryPath:e,kind:"store",name:r.name,displayName:r.displayName,logo:r.logo,icon:r.icon,setting:$.isFunction(r.setting)}}else{if("public"===r.kind)return i.publicPlugins[r.name]={factoryPath:e,kind:"public",name:r.name,displayName:r.displayName,logo:r.logo,icon:r.icon};if("resource"===r.kind&&((n=r.platform||"all")===STORY_PLATFORM||"all"===n))return i.resourcePlugins[r.name]={factoryPath:e,kind:"resource",name:r.name,displayName:r.displayName,logo:r.logo,icon:r.icon}}})),!MINI_WEB)return $.getJSON("/plugin",{operateType:"getPlugins"},function(n){return function(i,r,o){var a,s,l,c,u,d,p,h,m,v,g,_,w;if(i.code)f.showMessage("\u521d\u59cb\u5316\u63d2\u4ef6\u5217\u8868\u5931\u8d25: "+i.code,6e3,"error");else for(s in h=t("plugins/remote_plugin"),m=t("plugins/remote_resource_plugin"),i)"resource"===(p=i[s]).kind?n.resourcePlugins[s]||n.disabledPlugins[s]||(l=(c=new m(p)).platform)!==STORY_PLATFORM&&"all"!==l||(n.resourcePlugins[s]={factoryPath:"plugins/remote_resource_plugin",factoryOptions:p,kind:p.kind,displayName:c.displayName,name:c.name,logo:c.logo,icon:c.icon}):n.plugins[s]||n.disabledPlugins[s]||(l=(c=new h(p)).platform)!==STORY_PLATFORM&&"all"!==l||(n.plugins[s]={factoryPath:"plugins/remote_plugin",factoryOptions:p,kind:p.kind,displayName:c.displayName,name:c.name,logo:c.logo,icon:c.icon,setting:$.isFunction(c.setting)});return(u=(a=j).get("plugin"))&&((w=Q.get(u))?(d=w.get("name"))&&!n.plugins[d]&&(a.set("plugin",""),a.save(),f.showMessage("\u65e0\u6cd5\u627e\u5230\u5b58\u50a8\u63d2\u4ef6\uff1a "+d,6e3,"error")):(a.set("plugin",""),a.save())),(g=a.get("resourcePluginId"))&&((v=Q.get(g))?(_=v.get("name"),n.resourcePlugins[_]||(a.set("resourcePluginId",""),a.save(),f.showMessage("\u65e0\u6cd5\u627e\u5230\u56fe\u5e8a\u63d2\u4ef6\uff1a "+_,6e3,"error"),v.destroy())):(a.set("resourcePluginId",""),a.save())),e()}}(this)).fail((function(t){return f.showMessage("\u521d\u59cb\u5316\u63d2\u4ef6\u5217\u8868\u5931\u8d25: "+t,6e3,"error"),e()}));e()},showLoader:function(e,t){var n;if(t=t||"\u6b22\u8fce\u4f7f\u7528\u5c0f\u4e66\u5320\u7f16\u8f91\u5668",this.$loader.html("<div class='ui large text loader'>"+t+"</div>"),this.$loader.show(),e)return(n=this.$loader.data("jqXHR"))&&n.abort(),this.$loader.data("jqXHR",e)},hideLoader:function(e){var t;if("client"===STORY_PLATFORM&&"function"==typeof(t=require("nw.gui").Window.get()).emit&&t.emit("storyFinishLoaded"),e)return this.$loader.data("jqXHR")===e&&null,this.$loader.data("jqXHR","")},afterHomeviewInitLayout:function(){return"client"===STORY_PLATFORM&&navigator.onLine&&j.get("autoCheckNewVersion")&&this.delayFns.push((function(){var e,n,i,r,a,s;return a=function(){if(!window.IDIOM)return $.get(o.host+"/getrandomidiom",(function(e){if(e&&e.idiom)return window.IDIOM=e.idiom}))},r=j.get("showRandomIdiom"),(s=ne.get("user"))&&s.vip||(r=!0),r&&a(),console.log("check new version"),i=t("./lib/check_new_version"),n=t("./views/client_upgrade_dialog_view"),e=t("./views/cache_upgrade_dialog_view"),i.checkNewVersion((function(t,i,r,o,a){var s,l,c,u;if(console.log("new version result:"+i),u=j.get("skipCheckVersion"),i&&u!==o.version)return l=f.showMessage({html:'<h5 style="margin-top: 0px;margin-right: 1em;">\u53d1\u73b0\u65b0\u7248\u672c:'+o.version+"</h5>\n<p>\n<p>"+o.description+"</p>\n<a href='http://soft.xiaoshujiang.com' target='_blank' class=\"manual_upgrade_new_version_button\" style=\"display:none\">\u8bf7\u5148\u5230\u5c0f\u4e66\u5320\u5b98\u7f51\u624b\u52a8\u4e0b\u8f7d\u6700\u65b0\u7684\u5ba2\u6237\u7aef"+(o.clientVersion||o.version)+'</a>\n<a href=\'javascript:void(0);\' class="cache_upgrade_new_version_button ui button basic positive mini" style="display:none">\u5f00\u59cb\u66f4\u65b0</a>\n<a href=\'javascript:void(0);\' class="client_upgrade_new_version_button ui button basic positive mini" style="display:none">\u5f00\u59cb\u66f4\u65b0</a>\n</p>\n<p style="text-align:right;">\n<a href=\'javascript:void(0);\' class=\'ok_button\'>\u77e5\u9053\u4e86</a>\n</p>'},-1).$note,s=l.find(".close"),r?((c=l.find(".cache_upgrade_new_version_button")).show(),c.on("click",(function(t){return t.preventDefault(),t.stopPropagation(),(new e).show(),s.trigger("click")}))):o.autoUpgrade?((c=l.find(".client_upgrade_new_version_button")).show(),c.on("click",(function(e){return e.preventDefault(),e.stopPropagation(),(new n).show(),s.trigger("click")}))):(c=l.find(".manual_upgrade_new_version_button")).show(),l.one("click",".ok_button",(function(e){return e.preventDefault(),e.stopPropagation(),j.set({skipCheckVersion:o.version},{silent:!0}),j.save(),s.trigger("click")}))}))})),$("body").addClass("loaded can_use_transition"),$("#loader-wrapper").remove(),"client"===STORY_PLATFORM&&($("body").hasClass("client_title_bar_mode")||($("body").addClass("client_title_bar_mode"),this.homeView.layout.resizeAll())),this.$loader.find(".sub.header").hide(),this.$loader.hide(),C&&"web"===STORY_PLATFORM&&!MINI_WEB&&this.showTour(),t("./lib/dynamic_import/import_highlight")(),t("./lib/dynamic_import/import_beautify")(),window.dispatchEvent(new Event("xsj.appInited"))},hideTour:function(){return D&&D.exit(),D=0},showTour:function(){return D=null,y.asyncLoadResources([{id:"introjs_js",type:"script",filename:"js/intro.js"},{id:"introjs_css",type:"style",filename:"css/introjs.css"}],(function(){if(0!==D)return D||(D=introJs()).setOptions({showStepNumbers:!1,steps:[{element:".main_button_intro",intro:"\u4e3b\u529f\u80fd\u6309\u94ae\uff0c\u53d1\u9001\u90ae\u4ef6\uff0c\u53d1\u5e03\u5230\u535a\u5ba2\uff0c\u5bfc\u51fa\uff0c\u5bfc\u5165\uff0c\u8bbe\u7f6e\u7b49",position:"right"},{element:".editor_buttons",intro:"\u5199\u4f5c\u6a21\u5f0f\u5f00\u5173\uff0c\u5207\u6362\u4e3b\u9898\uff0c\u8bbe\u7f6e\u7f16\u8f91\u5668\u914d\u7f6e\uff0c\u8fdb\u5165\u7eaf\u9605\u8bfb\u6a21\u5f0f\u7b49",position:"top"},{element:".preview_buttons",intro:"\u5f00\u542f\u9605\u8bfb\u6a21\u5f0f\uff0c\u81ea\u5b9a\u4e49\u6587\u7ae0css\u6837\u5f0f\uff0c\u5207\u6362\u9884\u89c8\u4e3b\u9898\uff0c\u8c03\u6574\u9884\u89c8\u533a\u4f4d\u7f6e\u7b49\u529f\u80fd",position:"top"},{element:".footer_intro",intro:"\u5173\u95ed\u6587\u6863\u7ba1\u7406\u533a\uff0c\u5207\u6362\u7ed1\u5b9a\uff0c\u67e5\u770b\u8bed\u6cd5\u624b\u518c",position:"top"},{element:".ui-layout-toggler-east",intro:"\u5173\u95ed\u9884\u89c8",position:"left"},{element:".preview_control_buttons",intro:"\u540c\u6b65\u6eda\u52a8\u7f16\u8f91\u533a\uff0c\u9884\u89c8\u533a",position:"top"}]}),D.start(),$("body").addClass("intro_mode"),D.onexit((function(){return $("body").removeClass("intro_mode")}))}))},_initProxy:function(){var e,t,n;if("client"===STORY_PLATFORM&&(t=require("nw.gui"),n=i.getProxy(),e=function(e,t){return n=i.getProxy(),e&&e.isProxy&&!k&&n.useProxy&&n.username?(k=setTimeout((function(){return k=!1}),1e3),b?(f.showMessage("\u4ee3\u7406\u8ba4\u8bc1\u5931\u8d25,\u8bf7\u91cd\u65b0\u5230`\u8bbe\u7f6e>\u7f51\u7edc`\u4fee\u6539\u4ee3\u7406\u8ba4\u8bc1,\u7cfb\u7edf\u81ea\u52a8\u5173\u95ed\u4ee3\u7406",6e3,"error"),i.disableProxy(),t({cancel:!0})):(b=1,t({authCredentials:{username:n.username,password:n.password}}))):t({cancel:!0})},chrome.webRequest.onAuthRequired.addListener(e,{urls:["<all_urls>"]},["asyncBlocking"]),n.useProxy))return t.App.setProxyConfig(n.protocol+"//"+n.host+":"+n.port)},initProxy:function(){var e,t;if("client"===STORY_PLATFORM)return k&&(clearTimeout(k),k=!1),b=0,e=require("nw.gui"),(t=i.getProxy()).useProxy?e.App.setProxyConfig(t.protocol+"//"+t.host+":"+t.port):e.App.setProxyConfig("")},disableProxy:function(){return j.set({proxyOn:!1}),j.save()},getProxy:function(){var e,t,n,i,r,o;return o=j.get("proxyOn")||!1,i=j.get("proxyProtocol")||"http:",e=j.get("proxyHost")||"",n=j.get("proxyPort")||"80",r=j.get("proxyUsername")||"",t=j.get("proxyPassword")||"",e?{useProxy:o,protocol:i,host:e,port:n,username:r,password:t}:{useProxy:!1}},refreshAuthInfo:function(e){var t,n,i;return t=!1,"mac"===(i=ne.get("token"))&&(t=!0,i=""),n=!!i,MINI_WEB&&(n=!0),MAC_STORE_WEB&&(n=!!i),GITHUB_PAGE_WEB&&(n=!1),n?$.ajax({url:o.apiHost+"/api/users/me",data:{access_token:i},method:"GET"}).done((function(t){var n;return t.isRealVip=t.vip,t.vip=t.vip||t.isTempVip,MAC_STORE_WEB&&(t.vip=!0),n=$.extend({},t,{user:t}),ne.set(n),"function"==typeof e?e(null,t):void 0})).fail((function(t,n,i){var r,o,a,s,l,c,u;return(r=t.responseJSON)&&r.error&&(r=r.error,f.showMessage("\u52a0\u8f7d\u7528\u6237\u4fe1\u606f\u51fa\u9519:"+r.message,6e3,"error")),console.log("pass..."),(c=ne.get("user"))&&c.vip&&(o=c.expireDate,l=new Date,a=!1,o&&(a=(o=moment(o)).isAfter(l)),a||c.isTempVip&&(o=c.modified||c.created)&&((o=moment(o)).add(60,"d"),a=o.isAfter(l)),MAC_STORE_WEB&&(a=!0),a||((s=_.clone(c)).vip=!1,s.isTempVip=!1,s.isRealVip=s.vip,u=$.extend({},s,{user:s}),ne.set(u))),"function"==typeof e?e("error"):void 0})):(MAC_STORE_WEB&&(t||ne.set(ne.constructor.defaultMacStoreUser)),"function"==typeof e?e():void 0)},getUserNotice:function(e){var t;return(t=ne.get("token"))?$.ajax({url:o.apiHost+"/api/users/me/notices",data:{access_token:t,filter:{where:{isReaded:!1},order:"created desc"}},method:"GET"}).done((function(n){var i,r,a,s,l;return n.length>0&&(s="",a=[],n.forEach((function(e,t){return a.push(e.id),s+='<h5 style="margin-top: 0px;margin-right: 1em;">'+e.title+'</h5>\n<time datetime="'+e.created+'">'+e.created+"</time>\n<p>"+e.content+"</p>"})),l=function(){return $.ajax({url:o.apiHost+"/api/users/updateNoticesReaded",method:"POST",data:{access_token:t,nids:a.join(",")}})},r=f.showMessage({html:s+"\n<p style=\"text-align:right;\">\n<a href='javascript:void(0);' class='ok_button'>\u77e5\u9053\u4e86</a>\n</p>"},-1,null,{onClosed:l}).$note,i=r.find(".close"),r.one("click",".ok_button",(function(e){return e.preventDefault(),e.stopPropagation(),i.trigger("click")}))),"function"==typeof e?e(null,n):void 0})).fail((function(t,n,i){return console.log("pass..."),"function"==typeof e?e("error"):void 0})):"function"==typeof e?e():void 0},lockWindow:function(e){var t,n,i,r,o;if(null==e&&(e=""),e+="",!((i=$("#lockWindow")).length>0))return 0===i.length&&$("body").prepend('<div id="lockWindow" class="locked_window">\n  <div class="ui mini modal visible active">\n    <div class="header">\u8bf7\u8f93\u5165\u89e3\u9501\u5bc6\u7801\uff1a</div>\n    <div class="content">\n      <div class="ui fluid icon input">\n        <input type="password" name="lockPassword" placeholder="\u8bf7\u8f93\u5165\u89e3\u9501\u5bc6\u7801..." autocomplete="off">\n        <i class="unlock icon"></i>\n      </div>\n    </div>\n    <div class="actions">\n      <div class="ui cancel button">\u53d6\u6d88</div>\n      <div class="ui approve primary button">\u786e\u5b9a</div>\n    </div>\n  </div>\n</div>'),i=$("#lockWindow"),n=i.find("input[name=lockPassword]"),t=i.find(".cancel"),r=i.find(".approve"),t.on("click",(function(){return n.val(""),n.parent().removeClass("error")})),o=function(){var o;return o=$.trim(n.val()),e!==o?(n.val(""),n.parent().addClass("error"),n.one("change",(function(){return n.parent().removeClass("error")}))):(t.off("click"),r.off("click"),i.off("keydown"),i.transition({animation:"zoom",onComplete:function(){return i.remove(),i=null}}))},r.on("click",(function(){return o()})),i.on("keydown",(function(e){if(13===e.keyCode)return o()}))},startAutoLock:function(){var e,t;return STORY_PLATFORM,null!=H&&H.stop(),e=j.get("lockTimeout"),e=Math.min(Math.max(parseInt(e)||6,6),1440),(H=new d({timeoutInMiliseconds:1e3*e*60,doInActive:(t=this,function(){var e;return e=j.get("lockPassword")||"",t.lockWindow(e)})})).start()},getAllInstanceFileModels:function(){var e,t;return[],e=i.homeView.editorView.getAllFileModels(!0),t=L.getAllConnectedFileModels(),_.uniq(_.flatten([e,t,V.models]))},stopAutoLock:function(){return null!=H&&H.stop(),H=null},initialize:function(){var e,n,r,a,s,l;return E=R(),localStorage.getItem("startStatus")?(localStorage.removeItem("startStatus"),void V.createFile(o.defaultNewFile.newFileTitle,o.defaultNewFile.newFileContent,[],{},(function(e,n,r){return q=!0,setTimeout((function(){var e;if(q)return e=t("views/start_fail_view"),X=new e({fileCollection:V}),$(".application_dimmer>.content>.ui.inverted.header").append(X.render().$el)}),5e3),i.initialize(n)}))):(l=this,r=function(){var e,n,r,a,c,u,d,p,f;return localStorage.setItem("startStatus","init"),a=t("views/home_view"),u=t("views/sidebar_view"),n=t("views/client_title_bar_view"),c=t("lib/router"),r=t("lib/config_sync"),(e=$("body")).addClass("platform_"+STORY_PLATFORM),(window.safari||window.navigator.userAgent.match(/iPad|iPhone/i))&&e.addClass("platform_safari_browser"),l.$loader=e.find(".application_dimmer"),d=function(){var e,n,r;if(r=DOCKER_VERSION||GITHUB_PAGE_WEB,!MINI_WEB||r)return n=t("./lib/dynamic_import/import_plugin_depence"),e=t("./lib/dynamic_import/import_fancytree"),async.map([n,e],(function(e,t){return e(t)}),(function(){return i._initPlugins((function(){return $(window).trigger("xsj.pluginInited"),i.state.pluginInited=!0}))}));i.state.pluginInited=!0},l.delayFns.push((function(){return window.clientWorkerManager?window.clientWorkerManager.startClientWorker((function(e){return d()})):d()})),l.delayFns.push((function(){if(!t("./lib/utils_emojis").supportsEmoji())return y.importCssString('@font-face {\n  font-family: "color-emoji";\n  src: url(./fonts/NotoEmoji-Regular.ttf) format("truetype");\n}',"xsj-fallback-color-emoji-style",!1)})),l.homeView=new a({fileModel:s}),l.sidebarView=new u,"client"===STORY_PLATFORM&&(l.clientTitleBarView=new n({el:$(".client_title_bar")}),l.clientTitleBarView.render()),l.router=new c,e.append(l.homeView.render().$el),e.addClass("xsj_no_scroll_container"),f=function(e){var t;return e.preventDefault(),e.stopPropagation(),(t=$(this)).scrollTop(0),t.scrollLeft(0)},$(".xsj_no_scroll_container,html").on("scroll",f),$(document).on("scroll",f),e.append("<div class='pusher' style='display:none;'></div>"),e.prepend(l.sidebarView.render().$el),l.homeView.initLayout((function(){return l.hideLoader(),l.afterHomeviewInitLayout(),localStorage.removeItem("startStatus"),q=!1,null!=X&&X.remove(),X=null,l.delayFns.map((function(e){return requestIdleCallback((function(){return e()}))})),l.delayFns.length=0})),l.refreshAuthInfo((function(){if(MINI_WEB&&!MAC_STORE_WEB&&!GITHUB_PAGE_WEB)return $.ajax({url:o.apiHost+"/api/database",method:"GET"}).done((function(e){var t,n;return n=ne.get("user"),t=o.apiHost+"/data/user_"+n.id,j.set({databaseSyncType:e.databaseSyncType,databaseCustomSyncUrl:e.databaseCustomSyncUrl||t,databaseCustomSyncWithCredentials:e.databaseCustomSyncWithCredentials,databaseCustomSyncUsername:e.databaseCustomSyncUsername,databaseCustomSyncPassword:e.databaseCustomSyncPassword,databaseCustomSyncLive:e.databaseCustomSyncLive})}))})),l.getUserNotice(),l._initProxy(),j.get("autoLock")&&l.startAutoLock(),j.get("lockWithStart")&&(p=j.get("lockPassword")||"",l.lockWindow(p)),r.initConfigDB(),r.initListenerChanges()},(n=B.get("activeTab"))&&(a=A.getFileLocalModelByFileId(n))&&((e=new(t("./models/file_model"))).set({_id:a.id,title:a.get("title"),content:a.get("content")}),e.isXSJFake=!0,V.add(e),s=e,i.state.initFileModel=s),r())}},n.exports=i}}),window.requirejs.define({constant:function(exports,requirejs,module){var apiHost,codeTheme,configDBOptions,corsAnyWhereURL,dataHost,defaultColors,defaultEmojiChars,defaultFontIcons,defaultThemeInfo,devURI,exportHost,grammar,host,introduce,newFileTemplate,plantumlDefaultServerUrl,pouchdb,pouchdbAppResource,pouchdbName,pouchdbOptions,pouchdbconfig,previewTheme,resourceDBOptions;plantumlDefaultServerUrl="https://www.plantuml.com/plantuml/svg/{{uml}}",defaultEmojiChars="['', '\u6211', '\u611b', '\u5c0f', '\u66f8', '\u5320','\u5f3a','\ud83d\ude04','\ud83d\ude03','\ud83d\ude00','\ud83d\ude0a','\u263a','\ud83d\ude09','\ud83d\ude0d','\ud83d\ude18','\ud83d\ude1a','\ud83d\ude17','\ud83d\ude19','\ud83d\ude1c','\ud83d\ude1d','\ud83d\ude1b','\ud83d\ude33','\ud83d\ude01','\ud83d\ude14']",defaultThemeInfo='{"name":"\u4e2d\u56fd\u4f20\u7edf\u8272(\u4eae)","colors":{"base00":"#F8F4ED","base01":"#E7E3DB","base02":"#C7D2D4","base03":"#A4ACA7","base04":"#3a403b","base05":"#2B312C","base06":"#141714","base07":"#090a09","base08":"#EE3F4D","base09":"#12AA9C","base0A":"#619AC3","base0B":"#41AE3C","base0C":"#983680","base0D":"#B78D12","base0E":"#FC7930","base0F":"#CC5595"},"good":true,"order":6,"dark":false,"value":"china-traditional-light","key":"china-traditional-light"}',introduce="\n\n----------\n\n\u5c0f\u4e66\u5320\u662f\u4e00\u6b3e\u672c\u5730\u4f18\u5148\uff0c\u53bb\u4e2d\u5fc3\u5316\uff0c\u5206\u5e03\u5f0f\uff0c\u652f\u6301\u9009\u62e9\u6027\u540c\u6b65\u7684\u5168\u5e73\u53f0\u8986\u76d6\u7b14\u8bb0\u8f6f\u4ef6\u3002",newFileTemplate="---\ntitle: <% print(moment().format('YYYY-MM-DD')); %>\u672a\u547d\u540d\u6587\u4ef6 \ntags: \u65b0\u5efa,\u6a21\u677f,\u5c0f\u4e66\u5320\ncategory: /\u5c0f\u4e66\u5320/\u65e5\u8bb0/<% print(moment().format('YYYY-MM')); %>\nemoji: \"<% var emojis = "+defaultEmojiChars+';print(emojis[Math.floor(Math.random() * emojis.length)]);%>"\ngrammar_cjkRuby: true\n---\n\n\n\u6b22\u8fce\u4f7f\u7528 **{\u5c0f\u4e66\u5320}(xiaoshujiang)\u7b14\u8bb0\u8f6f\u4ef6**\uff0c\u60a8\u53ef\u4ee5\u901a\u8fc7 `\u5c0f\u4e66\u5320\u4e3b\u6309\u94ae>\u6a21\u677f` \u91cc\u7684\u6a21\u677f\u7ba1\u7406\u6765\u6539\u53d8\u65b0\u5efa\u6587\u7ae0\u7684\u5185\u5bb9\u3002',window.nw&&(plantumlDefaultServerUrl="https://www.plantuml.com/plantuml/svg/{{uml}}",newFileTemplate="---\ntitle: <% print(moment().format('YYYY-MM-DD')); %>\u672a\u547d\u540d\u6587\u4ef6 \ntags: \u65b0\u5efa,\u6a21\u677f,\u5c0f\u4e66\u5320\ncategory: /\u5c0f\u4e66\u5320/\u65e5\u8bb0/<% print(moment().format('YYYY-MM')); %>\ngrammar_cjkRuby: true\n---\n\n\n\u6b22\u8fce\u4f7f\u7528 **{\u5c0f\u4e66\u5320}(xiaoshujiang)\u7b14\u8bb0\u8f6f\u4ef6**\uff0c\u60a8\u53ef\u4ee5\u901a\u8fc7 `\u5c0f\u4e66\u5320\u4e3b\u6309\u94ae>\u6a21\u677f` \u91cc\u7684\u6a21\u677f\u7ba1\u7406\u6765\u6539\u53d8\u65b0\u5efa\u6587\u7ae0\u7684\u5185\u5bb9\u3002"),newFileTemplate+=introduce,pouchdbOptions={revs_limit:500},pouchdbOptions.adapter="idb",pouchdbName="xiao",localStorage.getItem("_pouch_xiaoa")&&(pouchdbOptions.adapter="indexeddb",pouchdbName="xiaoa"),localStorage.getItem("_pouch_xiao")&&(pouchdbOptions.adapter="idb",pouchdbName="xiao"),MAC_STORE_WEB&&(pouchdbOptions.adapter="idb",pouchdbName="xiao"),pouchdb=new PouchDB(pouchdbName,pouchdbOptions),configDBOptions=$.extend({},pouchdbOptions,{auto_compaction:!0,adapter:"idb"}),resourceDBOptions=$.extend({},pouchdbOptions,{adapter:"idb"}),pouchdbconfig=new PouchDB("xiao_config",configDBOptions),pouchdbAppResource=new PouchDB("xiao_app_resource",resourceDBOptions),defaultColors=["base08","base09","base0A","base0B","base0C","base0D","base0E","base0F"],defaultFontIcons=[{name:"Address Book",value:"far fa-address-book"},{name:"Address Card",value:"far fa-address-card"},{name:"Coffee",value:"fas fa-coffee"},{name:"Compass",value:"far fa-compass"},{name:"Highlighter",value:"fas fa-highlighter"},{name:"Project Diagram",value:"fas fa-project-diagram"},{name:"Save",value:"far fa-save"},{name:"Sitemap",value:"fas fa-sitemap"},{name:"Tags",value:"fas fa-tags"},{name:"Handshake",value:"far fa-handshake"},{name:"Hand Point Right",value:"far fa-hand-point-right"},{name:"Hand Holding Usd",value:"fas fa-hand-holding-usd"},{name:"Hands Helping",value:"fas fa-hands-helping"},{name:"Globe",value:"fas fa-globe"},{name:"Dollar Sign",value:"fas fa-dollar-sign"},{name:"Piggy bank",value:"fas fa-piggy-bank"},{name:"Comments",value:"far fa-comments"},{name:"Poo",value:"fas fa-poo"},{name:"Keyboard",value:"far fa-keyboard"},{name:"Code",value:"fas fa-code"},{name:"Code Branch",value:"fas fa-code-branch"},{name:"Wifi",value:"fas fa-wifi"},{name:"Desktop",value:"fas fa-desktop"},{name:"Laptop",value:"fas fa-laptop"},{name:"TV",value:"fas fa-tv"},{name:"Tablet Alt",value:"fas fa-tablet-alt"},{name:"Yen Sign",value:"fas fa-yen-sign"},{name:"Clock",value:"far fa-clock"},{name:"Bell",value:"far fa-bell"},{name:"Angellist",value:"fab fa-angellist"},{name:"Feather Alt",value:"fas fa-feather-alt"},{name:"Hiking",value:"fas fa-hiking"},{name:"Tree",value:"fas fa-tree"},{name:"Building",value:"far fa-building"},{name:"Smiling Face",value:"fas fa-smile"},{name:"Smiling Face With Heart-Eyes",value:"far fa-grin-hearts"}],previewTheme={default:{name:"default",url:"css/preview/default.css"},story_sticker:{name:"story_sticker",url:"css/preview/themes/story_sticker.css"},story_dazzle:{name:"story_dazzle",url:"css/preview/themes/story_dazzle.css"},story_poster:{name:"story_poster",url:"css/preview/themes/story_poster.css"},story_colorful:{name:"story_colorful",url:"css/preview/themes/story_colorful.css"},story_papper:{name:"story_papper",url:"css/preview/themes/story_papper.css"},story_heading:{name:"story_heading",url:"css/preview/themes/story_heading.css"},story_dotted:{name:"story_dotted",url:"css/preview/themes/story_dotted.css"},story_letter:{name:"story_letter",url:"css/preview/themes/story_letter.css"},story_china:{name:"story_china",url:"css/preview/themes/story_china.css"},solarized_light:{name:"solarized_light",url:"css/preview/themes/solarized_light.css"},solarized_dark:{name:"solarized_dark",url:"css/preview/themes/solarized_dark.css"},tomorrow_night_eighties:{name:"tomorrow_night_eighties",url:"css/preview/themes/tomorrow_night_eighties.css"},tomorrow_night_blue:{name:"tomorrow_night_blue",url:"css/preview/themes/tomorrow_night_blue.css"},tomorrow_night_bright:{name:"tomorrow_night_bright",url:"css/preview/themes/tomorrow_night_bright.css"},tomorrow_night:{name:"tomorrow_night",url:"css/preview/themes/tomorrow_night.css"},chocolate:{name:"chocolate",url:"css/preview/themes/chocolate.css"},kuroir:{name:"kuroir",url:"css/preview/themes/kuroir.css"},mellow_contrast:{name:"mellow_contrast",url:"css/preview/themes/mellow_contrast.css"},mintchoc:{name:"mintchoc",url:"css/preview/themes/mintchoc.css"},chrome:{name:"chrome",url:"css/preview/themes/chrome.css"}},codeTheme={agate:{name:"agate",url:"css/preview/code/agate.css"},androidstudio:{name:"androidstudio",url:"css/preview/code/androidstudio.css"},"arduino-light":{name:"arduino-light",url:"css/preview/code/arduino-light.css"},arta:{name:"arta",url:"css/preview/code/arta.css"},ascetic:{name:"ascetic",url:"css/preview/code/ascetic.css"},"atelier-cave-dark":{name:"atelier-cave-dark",url:"css/preview/code/atelier-cave-dark.css"},"atelier-cave-light":{name:"atelier-cave-light",url:"css/preview/code/atelier-cave-light.css"},"atelier-dune-dark":{name:"atelier-dune-dark",url:"css/preview/code/atelier-dune-dark.css"},"atelier-dune-light":{name:"atelier-dune-light",url:"css/preview/code/atelier-dune-light.css"},"atelier-estuary-dark":{name:"atelier-estuary-dark",url:"css/preview/code/atelier-estuary-dark.css"},"atelier-estuary-light":{name:"atelier-estuary-light",url:"css/preview/code/atelier-estuary-light.css"},"atelier-forest.dark":{name:"atelier-forest.dark",url:"css/preview/code/atelier-forest-dark.css"},"atelier-forest.light":{name:"atelier-forest.light",url:"css/preview/code/atelier-forest-light.css"},"atelier-heath.dark":{name:"atelier-heath.dark",url:"css/preview/code/atelier-heath-dark.css"},"atelier-heath.light":{name:"atelier-heath.light",url:"css/preview/code/atelier-heath-light.css"},"atelier-lakeside.dark":{name:"atelier-lakeside.dark",url:"css/preview/code/atelier-lakeside-dark.css"},"atelier-lakeside.light":{name:"atelier-lakeside.light",url:"css/preview/code/atelier-lakeside-light.css"},"atelier-plateau-dark":{name:"atelier-plateau-dark",url:"css/preview/code/atelier-plateau-dark.css"},"atelier-plateau-light":{name:"atelier-plateau-light",url:"css/preview/code/atelier-plateau-light.css"},"atelier-savanna-dark":{name:"atelier-savanna-dark",url:"css/preview/code/atelier-savanna-dark.css"},"atelier-savanna-light":{name:"atelier-savanna-light",url:"css/preview/code/atelier-savanna-light.css"},"atelier-seaside.dark":{name:"atelier-seaside.dark",url:"css/preview/code/atelier-seaside-dark.css"},"atelier-seaside.light":{name:"atelier-seaside.light",url:"css/preview/code/atelier-seaside-light.css"},"atelier-sulphurpool.dark":{name:"atelier-sulphurpool.dark",url:"css/preview/code/atelier-sulphurpool-dark.css"},"atelier-sulphurpool.light":{name:"atelier-sulphurpool.light",url:"css/preview/code/atelier-sulphurpool-light.css"},"atom-one-dark":{name:"atom-one-dark",url:"css/preview/code/atom-one-dark.css"},"atom-one-light":{name:"atom-one-light",url:"css/preview/code/atom-one-light.css"},brown_paper:{name:"brown_paper",url:"css/preview/code/brown-paper.css"},"codepen-embed":{name:"codepen-embed",url:"css/preview/code/codepen-embed.css"},"color-brewer":{name:"color-brewer",url:"css/preview/code/color-brewer.css"},darcula:{name:"darcula",url:"css/preview/code/darcula.css"},dark:{name:"dark",url:"css/preview/code/dark.css"},darkula:{name:"darkula",url:"css/preview/code/darkula.css"},default:{name:"default",url:"css/preview/code/default.css"},docco:{name:"docco",url:"css/preview/code/docco.css"},dracula:{name:"dracula",url:"css/preview/code/dracula.css"},far:{name:"far",url:"css/preview/code/far.css"},foundation:{name:"foundation",url:"css/preview/code/foundation.css"},github:{name:"github",url:"css/preview/code/github.css"},"github-gist":{name:"github-gist",url:"css/preview/code/github-gist.css"},googlecode:{name:"googlecode",url:"css/preview/code/googlecode.css"},grayscale:{name:"grayscale",url:"css/preview/code/grayscale.css"},"gruvbox-dark":{name:"gruvbox-dark",url:"css/preview/code/gruvbox-dark.css"},"gruvbox-light":{name:"gruvbox-light",url:"css/preview/code/gruvbox-light.css"},hopscotch:{name:"hopscotch",url:"css/preview/code/hopscotch.css"},hybrid:{name:"hybrid",url:"css/preview/code/hybrid.css"},idea:{name:"idea",url:"css/preview/code/idea.css"},ir_black:{name:"ir_black",url:"css/preview/code/ir-black.css"},"kimbie.dark":{name:"kimbie.dark",url:"css/preview/code/kimbie.dark.css"},"kimbie.light":{name:"kimbie.light",url:"css/preview/code/kimbie.light.css"},magula:{name:"magula",url:"css/preview/code/magula.css"},"mono-blue":{name:"mono-blue",url:"css/preview/code/mono-blue.css"},monokai:{name:"monokai",url:"css/preview/code/monokai.css"},monokai_sublime:{name:"monokai_sublime",url:"css/preview/code/monokai-sublime.css"},obsidian:{name:"obsidian",url:"css/preview/code/obsidian.css"},ocean:{name:"ocean",url:"css/preview/code/ocean.css"},"paraiso.dark":{name:"paraiso.dark",url:"css/preview/code/paraiso-dark.css"},"paraiso.light":{name:"paraiso.light",url:"css/preview/code/paraiso-light.css"},pojoaque:{name:"pojoaque",url:"css/preview/code/pojoaque.css"},purebasic:{name:"purebasic",url:"css/preview/code/purebasic.css"},qtcreator_dark:{name:"qtcreator_dark",url:"css/preview/code/qtcreator_dark.css"},qtcreator_light:{name:"qtcreator_light",url:"css/preview/code/qtcreator_light.css"},railscasts:{name:"railscasts",url:"css/preview/code/railscasts.css"},rainbow:{name:"rainbow",url:"css/preview/code/rainbow.css"},school_book:{name:"school_book",url:"css/preview/code/schoolbook.css"},solarized_dark:{name:"solarized_dark",url:"css/preview/code/solarized-dark.css"},solarized_light:{name:"solarized_light",url:"css/preview/code/solarized-light.css"},sunburst:{name:"sunburst",url:"css/preview/code/sunburst.css"},tomorrow:{name:"tomorrow",url:"css/preview/code/tomorrow.css"},"tomorrow-night-blue":{name:"tomorrow-night-blue",url:"css/preview/code/tomorrow-night-blue.css"},"tomorrow-night-bright":{name:"tomorrow-night-bright",url:"css/preview/code/tomorrow-night-bright.css"},"tomorrow-night":{name:"tomorrow-night",url:"css/preview/code/tomorrow-night.css"},"tomorrow-night-eighties":{name:"tomorrow-night-eighties",url:"css/preview/code/tomorrow-night-eighties.css"},vs:{name:"vs",url:"css/preview/code/vs.css"},xcode:{name:"xcode",url:"css/preview/code/xcode.css"},xt256:{name:"xt256",url:"css/preview/code/xt256.css"},zenburn:{name:"zenburn",url:"css/preview/code/zenburn.css"}},grammar={commonBold:{title:"\u5f3a\u8c03(\u7c97\u4f53)",meta:"commonBold",default:!0,description:"markdown \u57fa\u7840\u8bed\u6cd5\u91cc\u7684\u52a0\u7c97\u5f3a\u8c03\n<pre><code><span>__\u7c97\u4f53__   **\u7c97\u4f53**</span></code></pre>"},commonItalic:{title:"\u5f3a\u8c03(\u659c\u4f53)",meta:"commonItalic",default:!0,description:"markdown \u57fa\u7840\u8bed\u6cd5\u91cc\u7684\u659c\u4f53\u5f3a\u8c03 <br>\n<pre><code><span>_\u659c\u4f53_   *\u659c\u4f53*</span></code></pre>"},toc:{title:"\u5927\u7eb2",meta:"toc",default:!0,description:"\u63d0\u4f9b\u6587\u6863\u5927\u7eb2\u663e\u793a\u529f\u80fd\uff0c\u652f\u6301\u663e\u793a\u601d\u7ef4\u8111\u56fe\u5927\u7eb2\uff0c\u8bed\u6cd5\u683c\u5f0f\u4e3a: <br>\n<pre><code><span>[toc]\n\u652f\u6301\u5e26\u53c2\u6570 depth, \u663e\u793a\u6700\u6df1\u5230\u51e0\u5c42\n[toc?depth=3]\n\u652f\u6301\u663e\u793a\u6210\u601d\u7ef4\u8111\u56fe\u5927\u7eb2\n[toc!]\n\u652f\u6301\u663e\u793a\u6210\u601d\u7ef4\u8111\u56fe\u5927\u7eb2\u5e76\u5e26\u4e0a\u6700\u6df1\u663e\u793a\u5230\u51e0\u5c42\n[toc!?depth=3]\n</span></code></pre>"},abbr:{title:"\u7f29\u5199\u5b9a\u4e49",meta:"abbr",default:!0,description:"\u63d0\u4f9b\u7f29\u5199\u5b9a\u4e49\u8bed\u6cd5\u6269\u5c55\u529f\u80fd\uff0c\u8bed\u6cd5\u683c\u5f0f\u4e3a:<br>\n<pre><code><span>The HTML specification is maintained by the W3C</span><br><span>*[W3C]:  World Wide Web</span></code></pre>"},table:{title:"\u8868\u683c",meta:"table",default:!0,description:"\u63d0\u4f9b\u8868\u683c\u8bed\u6cd5\u6269\u5c55\u529f\u80fd\uff0c\u8bed\u6cd5\u683c\u5f0f\u4e3a\uff1a\n<pre><code>\nFirst Header  | Second Header\n------------- | -------------\nContent Cell  | Content Cell\nContent Cell  | Content Cell\n</code></pre>"},tableExtra:{title:"\u589e\u5f3a\u578b\u8868\u683c",meta:"tableExtra",default:!1,description:"\u63d0\u4f9b\u589e\u5f3a\u578b\u8868\u683c\u8bed\u6cd5\u6269\u5c55\u529f\u80fd\uff0c\u652f\u6301\u5e26\u6807\u9898\u8868\u683c\uff0c\u591a\u8868\u5934\uff0c\u591a\u8868\u8eab\uff0c\u53ca\u884c\u5355\u5143\u683c\u5408\u5e76\u3002\u8bed\u6cd5\u683c\u5f0f\u4e3a:<br>\n<pre><code>\n|First Header  | Second Header ||\n|First Header  | Second Header | Third Header|\n|------------- | -------------|-------------|\n\u8868\u8eab1Content Cell  | Merge Content Cell||\nContent Cell  | Content Cell| Content Cell|\n\n\u8868\u8eab2Content Cell  | Merge Content Cell||\nContent Cell  | Content Cell| Content Cell|\n[\u8868\u683c\u6807\u9898]\n</code></pre>"},deflist:{title:"\u5b9a\u4e49",meta:"deflist",default:!0,description:"\u63d0\u4f9b\u5b9a\u4e49\u5217\u8868\u8bed\u6cd5\u6269\u5c55\u529f\u80fd\uff0c\u8bed\u6cd5\u683c\u5f0f\u4e3a\uff1a<br>\n<pre><code>\n\u82f9\u679c\n: \u4e00\u79cd\u6c34\u679c\n: \u4e00\u79cd\u54c1\u724c\uff0c\u8ba1\u7b97\u673a\uff0c\u624b\u6301\u8bbe\u5907\n\u6854\u5b50\n: \u4e00\u79cd\u6c34\u679c\n</code></pre>"},emoji:{title:"emoji\u8868\u60c5",meta:"emoji",default:!1,description:"\u63d0\u4f9bemoji\u8868\u60c5\u8bed\u6cd5\u6269\u5c55\u529f\u80fd\uff0c\u8bed\u6cd5\u683c\u5f0f\u4e3a\uff1a\n<pre><code>\n  :wink: :crush: :cry: :tear: :laughing: :yum:\n</code></pre>"},footnote:{title:"\u811a\u6ce8",meta:"footnote",default:!0,description:"\u63d0\u4f9b\u811a\u6ce8\u8bed\u6cd5\u6269\u5c55\u529f\u80fd\uff0c\u8bed\u6cd5\u683c\u5f0f\u4e3a\uff1a\n<pre><code>\n\u811a\u6ce8[^1x]\n\n[^1x]: \u811a\u6ce8\u7684\u7528\u6cd5\n</code></pre>"},strikethrough:{title:"\u6587\u5b57\u683c\u5f0f \u5220\u9664\u7ebf",meta:"strikethrough",default:!0,description:"\u63d0\u4f9b\u6587\u5b57\u683c\u5f0f \u5220\u9664\u7ebf \u8bed\u6cd5\u6269\u5c55\u529f\u80fd\uff0c\u8bed\u6cd5\u683c\u5f0f\u4e3a\uff1a\n<pre><code>\n~~\u63d2\u5165\u7684\u6587\u5b57~~\n</pre></code>"},ins:{title:"\u6587\u5b57\u683c\u5f0f \u63d2\u5165",meta:"ins",default:!0,description:"\u63d0\u4f9b\u6587\u5b57\u683c\u5f0f \u63d2\u5165 \u8bed\u6cd5\u6269\u5c55\u529f\u80fd\uff0c\u8bed\u6cd5\u683c\u5f0f\u4e3a\uff1a\n<pre><code>\n++\u63d2\u5165\u7684\u6587\u5b57++\n</pre></code>"},mark:{title:"\u6587\u5b57\u683c\u5f0f \u6807\u8bc6",meta:"mark",default:!0,description:"\u63d0\u4f9b\u6587\u5b57\u683c\u5f0f \u6807\u8bc6 \u8bed\u6cd5\u6269\u5c55\u529f\u80fd\uff0c\u8bed\u6cd5\u683c\u5f0f\u4e3a\uff1a\n<pre><code>\n==\u88ab\u8bb0\u53f7\u7684\u6587\u5b57==\n</code></pre>"},sub:{title:"\u6587\u5b57\u683c\u5f0f \u4e0b\u89d2\u6587\u5b57",meta:"sub",default:!0,description:"\u63d0\u4f9b\u6587\u5b57\u683c\u5f0f \u4e0b\u89d2\u6587\u5b57 \u8bed\u6cd5\u6269\u5c55\u529f\u80fd\uff0c\u8bed\u6cd5\u683c\u5f0f\u4e3a\uff1a\n<pre><code>\n\u4e0b\u89d2\u6587\u5b57: H~2~O\n</code></pre>"},sup:{title:"\u6587\u5b57\u683c\u5f0f \u4e0a\u89d2\u6587\u5b57",meta:"sup",default:!0,description:"\u63d0\u4f9b\u6587\u5b57\u683c\u5f0f \u4e0a\u89d2\u6587\u5b57 \u8bed\u6cd5\u6269\u5c55\u529f\u80fd\uff0c\u8bed\u6cd5\u683c\u5f0f\u4e3a\uff1a\n<pre><code>\n\u4e0a\u89d2\u6587\u5b57: 19^th^\n</code></pre>"},center:{title:"\u6587\u5b57\u683c\u5f0f \u6587\u5b57\u5c45\u4e2d",meta:"center",default:!1,description:"\u63d0\u4f9b\u6587\u5b57\u683c\u5f0f \u6587\u5b57\u5c45\u4e2d \u8bed\u6cd5\u6269\u5c55\u529f\u80fd\uff0c\u8bed\u6cd5\u683c\u5f0f\u4e3a\uff1a\n<pre><code>\n\u6587\u5b57\u5c45\u4e2d: ->\u6587\u5b57\u5c45\u4e2d<-\n</code></pre>"},align:{title:"\u6587\u5b57\u683c\u5f0f \u6587\u5b57\u5bf9\u9f50",meta:"align",default:!1,description:"\u63d0\u4f9b\u6587\u5b57\u683c\u5f0f \u6587\u5b57\u5bf9\u9f50 \u8bed\u6cd5\u6269\u5c55\u529f\u80fd\uff0c\u8bed\u6cd5\u683c\u5f0f\u4e3a:\n<pre><code>\n\u6587\u5b57\u5de6\u5bf9\u9f50: :>\u6587\u5b57\u5c45\u5de6<-\n\u6587\u5b57\u53f3\u5bf9\u9f50: ->\u6587\u5b57\u5c45\u53f3<:\n\u6587\u5b57\u4e24\u7aef\u5bf9\u9f50: :>\u4e24\u7aef\u5bf9\u9f50\u7684\u6587\u5b57<:\n\u6587\u5b57\u5c45\u4e2d: ->\u6587\u5b57\u5c45\u4e2d<-\n</code></pre>\n\u6ce8\uff1a \u8be5\u8bed\u6cd5\u4e0ecenter\u8bed\u6cd5\u51b2\u7a81\uff0c\u4e24\u79cd\u8bed\u6cd5\u540c\u65f6\u5f00\u542f\u65f6\uff0calign\u8bed\u6cd5\u5c06\u8986\u76d6center\u8bed\u6cd5\u3002"},checkbox:{title:"checkbox",meta:"checkbox",default:!0,description:"\u63d0\u4f9b\u5f85\u529e\u4e8b\u9879\u8bed\u6cd5\u6269\u5c55\u529f\u80fd\uff0c\u8bed\u6cd5\u683c\u5f0f\u4e3a\uff1a\n<pre><code>\n[ ] \u672a\u5b8c\u6210\u4e8b\u9879\n[-] \u672a\u5b8c\u6210\u4e8b\u9879\n[x] \u5b8c\u6210\u4e8b\u9879\n[X] \u5b8c\u6210\u4e8b\u9879\n</code></pre>"},mathjax:{title:"mathjax\u516c\u5f0f",meta:"mathjax",default:!1,options:{autoNumber:{title:"\u81ea\u52a8\u7f16\u53f7",value:!0,type:"boolean",description:"align \u73af\u5883 \u2192 \u591a\u516c\u5f0f\u5bf9\u9f50 + \u81ea\u52a8\u7f16\u53f7"},normal:{title:"\u517c\u5bb9\u901a\u7528\u5199\u6cd5",value:!0,type:"boolean",description:"\u63d0\u4f9b\u662f\u5426\u517c\u5bb9\u901a\u7528\u7684 $ \u7b26\u53f7\u5199\u6cd5"}},description:"\u63d0\u4f9bmathjax\u516c\u5f0f\u8bed\u6cd5\u6269\u5c55\u529f\u80fd\uff0c\u8bed\u6cd5\u683c\u5f0f\u4e3a\uff1a\n<pre><code>\n`!$ \\Gamma(z) = \\int_0^\\infty t^{z-1}e^{-t}dt\\,. $`\n```mathjax!\n$$\\Gamma(z) = \\int_0^\\infty t^{z-1}e^{-t}dt\\,.$$\n```\n</code></pre>"},mindmap:{title:"\u601d\u7ef4\u8111\u56fe",meta:"mindmap",default:!1,options:{direction:{title:"\u5e03\u5c40\u65b9\u5411",value:"",description:"\u76ee\u524d\u63d0\u4f9b lr, rl, tb, bt, h, v. \u9ed8\u8ba4\u4e3a lr"},theme:{title:"\u4e3b\u9898",value:"",description:"\u76ee\u524d\u63d0\u4f9b gray \u548c colorful \u4e24\u4e2a\u4e3b\u9898\uff0c\u9ed8\u8ba4\u4e3a colorful, \u5982\u679c\u8bbe\u5b9a\u4e86 colors \u503c\uff0c\u8be5\u53c2\u6570\u5931\u6548"},colors:{title:"colors",value:"",description:"colors \u521d\u59cb\u503c, \u591a\u4e2a\u6570\u503c\u4ee5\u9017\u53f7\u5206\u9694\uff0c\u6570\u503c\u683c\u5f0f\u4e3a\u6807\u51c6\u7684\u5341\u516d\u8fdb\u5236\u989c\u8272\u503c"},colorsMode:{title:"\u989c\u8272\u5206\u5e03\u65b9\u5f0f",value:"",description:"\u5f53\u4e3b\u9898\u4e3a colorful \u65f6\uff0c\u8be5\u53c2\u6570\u503c\u51b3\u5b9a\u591a\u79cd\u4e0d\u540c\u989c\u8272\u5982\u4f55\u5206\u914d\u4f7f\u7528\uff0c\u652f\u6301\u6309\u5206\u652f\u5206\u914d(branch)\u548c\u6309\u7ed3\u70b9\u7b49\u7ea7\u5206\u914d(depth), \u7cfb\u7edf\u9ed8\u8ba4\u4f7f\u7528 branch \u8fdb\u884c\u5206\u914d\u989c\u8272"},fontSizes:{title:"\u5b57\u4f53\u5927\u5c0f",value:"",description:"\u5b57\u4f53\u5927\u5c0f\u521d\u59cb\u503c, \u591a\u4e2a\u6570\u503c\u4ee5\u9017\u53f7\u5206\u9694\uff0c\u6570\u503c\u683c\u5f0f\u4e3a\u6807\u51c6\u7684\u6574\u578b\u503c, \u9700\u8981\u6ce8\u610f\u7684\u662f\u867d\u7136\u8bbe\u7f6e\u7684\u4e86\u5b57\u4f53\u5927\u5c0f\uff0c\u751f\u6210\u7684\u56fe\u7247\u8fd8\u4f1a\u6839\u636e\u9875\u9762\u5bbd\u5ea6\u8fdb\u884c\u7edf\u4e00\u7f29\u653e"}},description:"\u63d0\u4f9b\u601d\u7ef4\u8111\u56fe\u8bed\u6cd5\u6269\u5c55\u529f\u80fd\uff0c\u8bed\u6cd5\u683c\u5f0f\u4e3a\uff1a\n<pre><code>\n``` mindmap!?root=\u601d\u7ef4\u8111\u56fe&title=\u601d\u7ef4\u8111\u56fe\u6d4b\u8bd5&theme=gray&direction=v&colorsMode=depth&fontSizes=50,30,20\n\u5206\u652f\u4e00\n    a\u5b50\u5206\u5b50\u4e00\n    a\u5b50\u5206\u5b50\u4e8c\n\u5206\u652f\u4e8c\n    b\u5b50\u5206\u5b50\u4e00\n    b\u5b50\u5206\u5b50\u4e8c\n\u5206\u652f\u4e09\n    c\u5b50\u5206\u5b50\u4e00\n    c\u5b50\u5206\u5b50\u4e8c\n```\n\u63d0\u4f9b\u7684\u53c2\u6570\u6709 \ncolors: #2ca02c,#ff5722,#009688\ncolorsMode: branch\nfontSizes: 100,50,20\ndirection: lr, rl, tb, bt, h, v. \u9ed8\u8ba4\u4e3a lr\ntheme: gray, colorful. \u9ed8\u8ba4\u4e3a colorful\ntitle: \u4f7f\u7528 encodeURI \u7f16\u7801\u7684\u5b57\u7b26\u4e32\uff0c\u7528\u4e8e\u5728\u601d\u7ef4\u8111\u56fe\u4e0b\u65b9\u663e\u793a. \u9ed8\u8ba4\u4e3a\u7a7a\nroot: \u4f7f\u7528 encodeURI \u7f16\u7801\u7684\u5b57\u7b26\u4e32\uff0c\u7528\u6237\u5728\u601d\u7ef4\u8111\u56fe\u7684\u6839\u8282\u70b9\u3002\u5982\u679c\u7528\u6237\u7684\u6570\u636e\u91cc\u5df2\u7ecf\u6709\u6839\u8282\u70b9\uff0c\u53ef\u4ee5\u4e0d\u9700\u8981\u6307\u5b9a\u3002\u9ed8\u8ba4\u4e3a root\n</code></pre>"},flow:{title:"\u6d41\u7a0b\u56fe",meta:"flow",default:!1,description:"\u63d0\u4f9b\u6d41\u7a0b\u56fe\u8bed\u6cd5\u6269\u5c55\u529f\u80fd\uff0c\u8bed\u6cd5\u683c\u5f0f\u4e3a\uff1a\n<pre><code>\n```flow!\nst=>start: \u5f00\u59cb\ne=>end: \u7ed3\u675f\nop=>operation: \u64cd\u4f5c\u6b65\u9aa4\ncond=>condition: \u662f \u6216\u8005 \u5426?\nst->op->cond\ncond(yes)->e\ncond(no)->op\n```\n</code></pre>"},sequence:{title:"\u5e8f\u5217\u56fe",meta:"sequence",default:!1,options:{theme:{title:"\u4e3b\u9898",value:"simple",description:"simple, hand \u4e24\u79cd\u4e3b\u9898,\u9ed8\u8ba4 hand\u4e3b\u9898"}},description:"\u63d0\u4f9b\u5e8f\u5217\u56fe\u8bed\u6cd5\u6269\u5c55\u529f\u80fd\uff0c\u8bed\u6cd5\u683c\u5f0f\u4e3a\uff1a\n<pre><code>\n```sequence!\n\u5c0f\u660e->\u5c0f\u674e: \u4f60\u597d \u5c0f\u674e, \u6700\u8fd1\u600e\u4e48\u6837?\nNote right of \u5c0f\u674e: \u5c0f\u674e\u60f3\u4e86\u60f3\n\u5c0f\u674e--\x3e\u5c0f\u660e: \u8fd8\u662f\u8001\u6837\u5b50\n```\n</code></pre>"},plot:{title:"\u7edf\u8ba1\u56fe",meta:"plot",default:!1,description:'\u63d0\u4f9b\u7edf\u8ba1\u56fe\u6269\u5c55\u8bed\u6cd5\u529f\u80fd\uff0c\u8bed\u6cd5\u683c\u5f0f\u4e3a\uff1a\n<pre><code>\n```plot\n{\n"data": [ [[0, 0], [1, 1]] ],\n"options": { "yaxis": { "max": 1 } }\n}\n```\n</code></pre>'},code:{title:"\u6bb5\u4ee3\u7801\u6587\u5b57\u683c\u5f0f",meta:"code",default:!1,description:"\u63d0\u4f9b\u6bb5\u4ee3\u7801\u6587\u5b57\u683c\u5f0f\u8bed\u6cd5\u6269\u5c55\u529f\u80fd\uff0c\u8bed\u6cd5\u683c\u5f0f\u4e3a\uff1a\n<pre><code>\n```javascript\n  var >>~~hello~~<< = 'hello world'\n  var >>==hello==<< = 'hello world'\n  var >>**hello**<< = 'hello world'\n  var >>++hello++<< = 'hello world'\n```\n</code></pre>"},codeLinenums:{title:"\u6bb5\u4ee3\u7801\u663e\u793a\u884c\u53f7",meta:"codeLinenums",default:!0,description:"\u63d0\u4f9b\u6bb5\u4ee3\u7801\u663e\u793a\u884c\u53f7\u529f\u80fd,\u9009\u4e2d\u6216\u8005\u6253\u5f00\u65f6\u5c06\u4f1a\u9ed8\u8ba4\u6587\u7ae0\u5185\u6240\u6709\u6bb5\u4ee3\u7801\u663e\u793a\u884c\u53f7\uff0c\u5982\u679c\u53ea\u60f3\u6574\u7bc7\u6587\u7ae0\u91cc\u7684\u90e8\u4efd\u4ee3\u7801\u663e\u793a\u884c\u53f7\uff0c\u53ef\u4ee5\u5728\u6bcf\u7bc7\u6bb5\u4ee3\u7801\u7684\u540e\u9762\u52a0\u4e0a`?linenums`\u6765\u5355\u72ec\u5f00\u542f\u884c\u53f7\u663e\u793a\u7684\u529f\u80fd\u3002\u53c2\u8003\u683c\u5f0f\u4e3a\uff1a<br>\n\u5168\u5c40\u8bbe\u7f6e\u91cc\u7981\u7528\u663e\u793a\u79f8\uff0c\u4f46\u6709\u5355\u72ec\u4e00\u6bb5\u4ee3\u7801\u663e\u793a\u884c\u53f7\uff1a\n<pre><code>\n  ```javascript?linenums\n  var x = 1;\n  ```\n</code></pre>\n\u5168\u5c40\u8bbe\u7f6e\u91cc\u6253\u5f00\u663e\u793a\u884c\u53f7\uff0c\u4f46\u6709\u5355\u72ec\u4e00\u6bb5\u4ee3\u7801\u7981\u7528\u79f8\uff1a\n<pre><code>\n```javascript?linenums=false\nvar x = 1;\n```\n</code></pre>\n\u5176\u4ed6\u4e00\u4e9b\u6280\u5de7\uff1a<br>\n\u663e\u793a\u884c\u53f7\u5e76\u9ad8\u4eae\u7b2c1,3,5\u884c\uff1a\n<pre><code>\n```javascript?linenums&fancy=1,3,5\nvar x = '\u88ab\u9ad8\u4eae\u7684\u7b2c1\u884c';\nx ='\u6ca1\u6709\u88ab\u9ad8\u4eae\u7684\u884c';\nx = '\u88ab\u9ad8\u4eae\u7684\u7b2c3\u884c';\nx = '\u53c8\u4e00\u4e2a\u6ca1\u6709\u88ab\u9ad8\u4eae\u7684\u884c';\nx = '\u6700\u540e\u4e00\u4e2a\u88ab\u9ad8\u4eae\u7684\u884c';\n```\n</code></pre>\n\u6ce8\uff1a\u9ad8\u4eae\u884c\u5fc5\u9700\u540c\u65f6\u663e\u793a\u884c\u53f7\uff0c\u5982\u679c\u4e0d\u60f3\u663e\u793a\u884c\u53f7\uff0c\u4f46\u60f3\u9ad8\u4eae\u884c\uff0c\u53ef\u4ee5\u901a\u8fc7`\u6bb5\u4ee3\u7801\u5185\u6587\u5b57\u683c\u5f0f`\u529f\u80fd\u6765\u9ad8\u4eae\u3002\n\u884c\u53f7\u4ece\u6307\u5b9a\u8ba1\u6570\u5f00\u59cb:\n<pre><code>\n```javascript?linenums=10\nvar x = '\u8be5\u884c\u88ab\u6307\u5b9a\u4ece10\u5f00\u59cb\u8ba1\u6570';\n```\n\u6ce8\uff1a\u8fd9\u91cc\u6307\u5b9a\u8ba1\u6570\u4ec5\u7528\u4e8e\u884c\u53f7\u7684\u663e\u793a\uff0c\u5bf9\u4e8e\u9700\u8981\u9ad8\u4eae\u7684\u884c\u7cfb\u7edf\u4f9d\u65e7\u4ec5\u4e0e\u5b9e\u9645\u7684\u884c\u53f7\u8ba1\u7b97\uff0c\u6bd4\u5982\u6307\u5b9a\u884c10\u5f00\u59cb\u8ba1\u6570\uff0c\u9700\u8981\u9ad8\u4eae\u7b2c2\u884c\uff08\u884c\u53f7\u4e0a\u663e\u793a\u7684\u662f11\uff09\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a\n```javascript?linenums=10&fancy=2\nvar x = '\u8fd9\u91cc\u7684\u5de6\u4fa7\u663e\u793a\u7684\u884c\u53f7\u662f10'\nx = '\u8fd9\u91cc\u7684\u5de6\u4fa7\u884c\u53f7\u662f11,\u5e76\u4e14\u88ab\u9ad8\u4eae';\n</code></pre>"},html:{title:"html",meta:"html",default:!0,description:"\u5141\u8bb8\u6587\u6863\u5185\u4f7f\u7528html\u6807\u7b7e"},wikilink:{title:"wiki \u94fe\u63a5",meta:"wikilink",default:!1,description:"\u81ea\u52a8\u8bc6\u522b wiki \u683c\u5f0f\u7684\u94fe\u63a5\u8bed\u6cd5 [[\u94fe\u63a5\u5730\u5740|\u5185\u5bb9]]"},linkify:{title:"\u8d85\u94fe\u63a5",meta:"linkify",default:!0,description:"\u81ea\u52a8\u8f6c\u6362\u8d85\u94fe\u63a5"},typographer:{title:"\u5370\u5237\u5b57",meta:"typographer",default:!1,description:"\u63d0\u4f9b\u5370\u5237\u5b57\u66ff\u6362\u8bed\u6cd5\u6269\u5c55\u529f\u80fd\uff0c\u66ff\u6362\u7684\u6587\u5b57\u4e3a\uff1a\n<pre><code>\n(c) (C) (r) (R) (tm) (TM) (p) (P) +-\n\xa9 \xa9 \xae \xae \u2122 \u2122 \xa7 \xa7 \xb1\n</code></pre>"},video:{title:"\u89c6\u9891",meta:"video",default:!0,description:"\u63d0\u4f9b\u89c6\u9891\u8bed\u6cd5\u6269\u5c55\u529f\u80fd\uff0c\u8bed\u6cd5\u683c\u5f0f\u4e3a\uff1a\n<pre><code>\n%[\u7535\u5f71](https://markdown.xiaoshujiang.com/media/movie.ogg)\n</code></pre>"},audio:{title:"\u97f3\u9891",meta:"audio",default:!0,description:"\u63d0\u4f9b\u97f3\u9891\u6269\u5c55\u8bed\u6cd5\u529f\u80fd\uff0c\u8bed\u6cd5\u683c\u5f0f\u4e3a\uff1a\n<pre><code>\n~[\u97f3\u4e50](https://markdown.xiaoshujiang.com/media/horse.ogg)\n</code></pre>"},attachment:{title:"\u9644\u4ef6",meta:"attachment",default:!0,description:"\u63d0\u4f9b\u9644\u4ef6\u6269\u5c55\u8bed\u6cd5\u529f\u80fd\uff0c\u8bed\u6cd5\u683c\u5f0f\u4e3a\uff1a\n<pre><code>\n=[\u9644\u4ef6](./jianzhu.jpg)\n</code></pre>"},highlight:{title:"\u4ee3\u7801\u9ad8\u4eae",meta:"highlight",default:!0,description:"\u63d0\u4f9b\u4ee3\u7801\u9ad8\u4eae\u529f\u80fd\uff0e"},mermaid:{title:"mermaid\u6d41\u7a0b\u56fe\uff0c\u5e8f\u5217\u56fe\uff0c\u7518\u7279\u56fe",meta:"mermaid",default:!1,description:"mermaid\u63d0\u4f9b\u7684\u6d41\u7a0b\u56fe\uff0c\u5e8f\u5217\u56fe\uff0c\u7518\u7279\u56fe\u8bed\u6cd5\u6269\u5c55\uff0c\u8bed\u6cd5\u683c\u5f0f\u4e3a\uff1a\n<pre><code>\n```mermaid!\nsequenceDiagram\nA->> B: Query\nB->> C: Forward query\nNote right of C: Thinking...\nC->> B: Response\nB->> A: Forward response\n```\n</code></pre>"},classy:{title:"\u81ea\u5b9a\u4e49class",meta:"classy",default:!1,description:"\u63d0\u4f9b\u81ea\u5b9a\u4e49css\u540d\u79f0\uff0c\u65b9\u4fbf\u9488\u5bf9\u7279\u6b8a\u5730\u65b9\u7684\u663e\u793a\u6548\u679c\u5904\u7406\uff0c\u8bed\u6cd5\u683c\u5f0f\u4e3a\uff1a\n<pre><code>\n  # \u81ea\u5b9a\u4e49class {blue}\n</code></pre>"},cjkEmphasis:{title:"cjk\u5f3a\u8c03",meta:"cjkEmphasis",default:!1,description:"\u63d0\u4f9b\u9488\u5bf9CJK\u5f3a\u8c03\u683c\u5f0f\u663e\u793a\uff0c\u7531\u4e8e\u4e2d\u6587\u5e76\u6ca1\u6709\u771f\u6b63\u610f\u4e49\u4e0a\u7684\u659c\u4f53\u505a\u4e3a\u5f3a\u8c03\uff0c\u8be5\u8bed\u6cd5\u81ea\u52a8\u5c06\u659c\u4f53\u8f6c\u6362\u6210\u5bf9\u5e94\u7684\u886c\u7ebf\u5b57\u4f53\uff0e\u76ee\u524d\u53ea\u8bbe\u8ba1\u4e86\u4e2d\u6587\u5b57\u4f53\u5bf9\u5e94\u7684\u886c\u7ebf\u5b57\u4f53\uff0e\u8bed\u6cd5\u683c\u5f0f\u4e3a\uff1a\n<pre><code>\n  _\u9700\u8981\u663e\u793a\u4e2d\u6587\u886c\u7ebf\u5b57\u4f53\u7684\u5185\u5bb9_\n</code></pre>\n"},cjkRuby:{title:"cjk\u6ce8\u97f3\u6807\u793a",meta:"cjkRuby",default:!1,description:"\u63d0\u4f9b\u9488\u5bf9CJK\u6ce8\u97f3\u6807\u793a\u7684markdown\u8bed\u6cd5\uff0c\u8bed\u6cd5\u683c\u5f0f\u4e3a\uff1a\n<pre><code>\n  {\u9700\u8981\u88ab\u6ce8\u97f3\u6807\u793a\u7684\u5185\u5bb9}(\u6ce8\u97f3\u6807\u793a)\n</code></pre>\n\u6216\u8005\uff1a\n<pre><code>\n  {\u9700\u8981\u88ab\u6ce8\u97f3\u6807\u793a\u7684\u5185\u5bb9}[\u7f16\u53f7]\n  [\u7f16\u53f7]: \u6ce8\u97f3\u6807\u793a\n</code></pre>"},attrs:{title:"html\u5c5e\u6027\u914d\u7f6e(attrs)",meta:"attrs",default:!1,description:'Add classes, identifiers and attributes to your markdown with {.class #identifier attr=value attr2="spaced value"} curly brackets, similar to pandoc\'s header attributes.\n\u5177\u4f53\u4f7f\u7528\u53ef\u4ee5\u53c2\u8003 https://github.com/arve0/markdown-it-attrs\n\u6ce8\uff1a \u8be5\u529f\u80fd\u4e0e `\u81ea\u5b9a\u4e49class` \u8bed\u6cd5\u51b2\u7a81\uff0c\u4e24\u4e2a\u540c\u65f6\u6253\u5f00\u65f6\uff0c\u9ed8\u8ba4\u4f7f\u7528 `attrs` \u8bed\u6cd5'},decorate:{title:"html\u5c5e\u6027\u914d\u7f6e(decorate)",meta:"decorate",default:!0,description:'Add classes, identifiers and attributes to your markdown with \x3c!--{.class #identifier attr=value attr2="spaced value"}--\x3e curly brackets.\n\u6ce8\uff1a\u8be5\u529f\u80fd\u5fc5\u987b\u540c\u65f6\u6253\u5f00 html \u8bed\u6cd5\u624d\u80fd\u751f\u6548\n\u5177\u4f53\u4f7f\u7528\u53ef\u4ee5\u53c2\u8003 https://github.com/rstacruz/markdown-it-decorate'},nunjucks:{title:"nunjucks \u6a21\u677f\u8bed\u6cd5",meta:"nunjucks",default:!1,description:"\u63d0\u4f9b nunjucks \u6a21\u677f\u89e3\u6790\u8bed\u6cd5\n\u5177\u4f53\u4f7f\u7528\u53ef\u4ee5\u53c2\u8003 https://mozilla.github.io/nunjucks/templating.html\n\u6ce8\uff1a\u53ea\u5b9e\u73b0\u4e86\u540c\u6b65\u7684\u6a21\u677f\u6807\u7b7e\u8bed\u6cd5\uff0c\u7981\u6b62\u4f7f\u7528\u5f02\u6b65\u6807\u7b7e"},codeChunk:{title:"codeChunk \u8bed\u6cd5",meta:"codeChunk",default:!1,description:"\u63d0\u4f9b\u6267\u884c\u4ee3\u7801\u6bb5\u91cc\u7684\u4ee3\u7801\u529f\u80fd\uff0c\u5177\u4f53\u4f7f\u7528\u8bf7\u53c2\u8003\u4f7f\u7528\u624b\u518c\u8bf4\u660e\n\u6ce8\uff1a<br/>\n  <ol>\n  <li>\u8be5\u529f\u80fd\u7531\u4e8e\u63d0\u4f9b\u4e86\u811a\u672c\u6267\u884c\u7684\u6743\u9650\uff0c\u5728\u6267\u884c\u4ee3\u7801\u524d\uff0c\u8bf7\u786e\u4fdd\u4ee3\u7801\u7684\u5b89\u5168\uff0c\u9632\u6b62\u6076\u610f\u811a\u672c\u88ab\u6267\u884c\u3002</li>\n  <li>\u5bfc\u51fa\u529f\u80fd\u9ed8\u8ba4\u4e0d\u4f1a\u6267\u884c codechunk \u91cc\u7684\u811a\u672c\uff0c\u9700\u8981\u7528\u6237\u5148\u5230 `\u5173\u4e8e` \u91cc\u6253\u5f00`\u975e\u5b89\u5168\u6a21\u5f0f`\u6765\u8ba9\u5bfc\u51fa\u529f\u80fd\u81ea\u52a8\u6267\u884c\u811a\u672c\u91cc\u7684\u4ee3\u7801\u3002</li>\n  </ol>"},wavedrom:{title:"WaveDrom Digital timing diagram \u8bed\u6cd5",meta:"wavedrom",default:!1,description:"\u63d0\u4f9b WaveDrom Digital timing diagram \u89e3\u6790\u8bed\u6cd5\n\u5177\u4f53\u4f7f\u7528\u53ef\u4ee5\u53c2\u8003 http://wavedrom.com/"},plantuml:{title:"plantuml",meta:"plantuml",default:!1,options:{url:{title:"\u670d\u52a1\u5668\u5730\u5740",value:plantumlDefaultServerUrl,description:"\u7528\u4e8e\u751f\u6210uml\u56fe\u4f7f\u7528"}},description:"\u63d0\u4f9bplantuml\u6e32\u67d3\u7684markdown\u8bed\u6cd5\uff0c\u8bed\u6cd5\u683c\u5f0f\u4e3a\uff1a\n<pre><code>\n  ```plantuml!\n  Bob->Alice : hello\n  ```\n</code></pre>\n<br/>\n\u4ee3\u7801\u6bb5\u5185\u7684\u6587\u5b57\u5c06\u88abencode\u6210base64\u5e76\u88ab\u538b\u7f29\u540e\u505a\u4e3a :uml \u5185\u5bb9\u63d0\u4ea4\u5230\u670d\u52a1\u5668\u3002"},imgSize:{title:"\u56fe\u7247\u5927\u5c0f",meta:"imgSize",default:!0,description:"\u63d0\u4f9b\u751f\u6210\u7684\u56fe\u7247\u5927\u5c0f\u63a7\u5236\u529f\u80fd\u3002<br/>\n\u8bed\u6cd5\uff1a \u5728\u56fe\u7247\u63cf\u8ff0\u7684\u7ed3\u5c3e\uff0c\u6dfb\u52a0 <code>=\u5bbd\u5ea6\u6570\u5b57x\u9ad8\u5ea6\u6570\u5b57</code>\uff0c\u6bd4\u5982\u4e0b\u9762\u7684\u5199\u6cd5\n<pre><code>\n![\u56fe\u7247\u63cf\u8ff0 =200x100](\u56fe\u7247\u5730\u5740)\n</code></pre>"},xsjimg:{title:"xsjimg",meta:"xsjimg",default:!1,options:{url:{title:"\u670d\u52a1\u5668\u5730\u5740",value:"",description:"\u7528\u4e8e\u751f\u6210\u56fe\u7247\u4f7f\u7528, \u63d0\u4f9b :img \u53c2\u6570\uff0c \u6bd4\u5982 url\u5730\u5740\u4e3a http://www.xiaoshujiang.com/svg/{{xsjimg}}, \u7cfb\u7edf\u4f1a\u5c06\u6b63\u6587\u7684\u5185\u5bb9\u6309\u7167\u53c2\u6570\u7f16\u7801\u540e\u66ff\u6362\u6389 img ,\u6700\u540e\u901a\u8fc7http \u7684 get \u65b9\u6cd5\u63d0\u4ea4"},encode:{title:"\u53c2\u6570\u7f16\u7801\u65b9\u5f0f",value:"default",description:"\u63d0\u4ea4\u7684\u53c2\u6570\u7f16\u7801. <br/> default: \u53ea\u8fdb\u884c\u7b80\u5355\u7684 encodeURIComponent <br/> base64: \u5c06\u6b63\u6587\u5185\u5bb9\u8f6c\u6362\u6210 base64 \u518d\u63d0\u4ea4 <br/> zip: \u5c06\u6b63\u6587\u8fdb\u884c zip \u538b\u7f29"}},description:"\u63d0\u4f9b img \u6e32\u67d3\u7684markdown\u8bed\u6cd5\uff0c\u8bed\u6cd5\u683c\u5f0f\u4e3a\uff1a\n<pre><code>\n  ```xsjimg!\n  Bob->Alice : hello\n  ```\n</code></pre>\n<br/>\n\u4ee3\u7801\u6bb5\u5185\u7684\u6587\u5b57\u5c06\u4f1a\u6309\u53c2\u6570\u7f16\u7801\u65b9\u5f0f\u88ab\u7f16\u7801\u4e3a :img \u5185\u5bb9\u63d0\u4ea4\u5230\u670d\u52a1\u5668\u3002"}},$.fn.form.settings.rules.xsjEmail=function(e){var t,n,i,r;for(i=0,r=(n=e.split(",")).length;i<r;i++)if(t=n[i],t=(t=$.trim(t)).replace(/^"[^"]*?"\s+<([^>]*?)>$/,"$1"),!$.fn.form.settings.regExp.email.test(t))return!1;return!0},host="http://markdown.xiaoshujiang.com",/^https/i.test(document.location.protocol)&&(host="https://markdown.xiaoshujiang.com"),apiHost="https://api.xiaoshujiang.com",dataHost="https://data.xiaoshujiang.com",exportHost="https://export.xiaoshujiang.com",corsAnyWhereURL="/xsjcors/","production"!==ENV&&(DOCKER_VERSION||(corsAnyWhereURL="http://localhost:8585/",corsAnyWhereURL="http://cors.localhost.com/xsjcors/"),devURI="http://localhost",window.nw||(devURI=document.location.protocol+"//"+document.location.hostname),host=devURI+":3000",apiHost=devURI+":2000",dataHost=devURI+":4000",exportHost=devURI+":3050"),MINI_WEB&&!MAC_STORE_WEB&&(apiHost=document.location.origin,dataHost=apiHost),module.exports={welcome:"\u5c0f\u4e66\u5320\u7b14\u8bb0\u8f6f\u4ef6",host:host,apiHost:apiHost,dataHost:dataHost,exportHost:exportHost,exportPdfHost:host,corsAnyWhereURL:corsAnyWhereURL,colorSets:"#EE3F4D|#12AA9C|#619AC3|#41AE3C|#983680|#B78D12|#FC7930|#CC5595|#F44336|#E91E63|#9C27B0|#673AB7|#3F51B5|#2196F3|#03A9F4|#00BCD4|#009688|#4CAF50|#8BC34A|#CDDC39|#FFEB3B|#FFC107|#FF9800|#FF5722|#795548|#9E9E9E|#607D8B",localStorage:{namespace:"xiaoshujiang"},fileContentType:{attachment:"text/xsj-link"},maxFetchFileCount:60,initFileAttachmentTimeout:18e4,getNetworkResourceTimeout:18e4,exportHtmlTemplateFile:"templates/template.html",exportPdfTemplateFile:"templates/pdftemplate.html",exportTocHtmlTemplateFile:"templates/toctemplate.html",exportPresetationTemplateFile:"templates/presetation.html",fileSummaryMax:100,maxFileSize:31457280,pouchDB:pouchdb,pouchDBConfig:pouchdbconfig,pouchDBAppResource:pouchdbAppResource,pouchDBOptions:pouchdbOptions,configDBOptions:configDBOptions,customCssPrefix:"custom_css_preview",contentSplit:",,,",imageExts:[".JPG",".JPEG",".PNG",".GIF",".SVG",".ICO",".WEBP"],zip:{metaFilename:"xiaoshujiang.json",batchFilename:"files.json"},defaultThemeInfo:defaultThemeInfo,defaultSystemStorePic:"img/avatar_d_256x256.png",defaultSystemStoreName:"xiaoshujiang",defaultSystemStoreDisplayName:"\u5c0f\u4e66\u5320",defaultSystemStoreUserAvatar:"img/default.jpg",defaultSystemStoreUsername:"user",defaultSystemStoreUserDisplayName:"\u7528\u6237",grammar:grammar,codeTheme:codeTheme,previewTheme:previewTheme,fontIcons:defaultFontIcons,systemColors:defaultColors,getSystemEmojiChars:function(){return eval(defaultEmojiChars)},plantumlDefaultServerUrl:plantumlDefaultServerUrl,defaultNewFile:{newFileTitle:"\u672a\u547d\u540d\u6587\u4ef6",newFileContent:"---\ntitle: \u672a\u547d\u540d\u6587\u4ef6 \ntags: \u65b0\u5efa,\u6a21\u677f,\u5c0f\u4e66\u5320\ncategory: /\u5c0f\u4e66\u5320/\u6587\u7ae0\ngrammar_cjkRuby: true\n---\n\n\n\u6b22\u8fce\u4f7f\u7528 **{\u5c0f\u4e66\u5320}(xiaoshujiang)\u7b14\u8bb0\u8f6f\u4ef6**\uff0c\u60a8\u53ef\u4ee5\u901a\u8fc7==\u8bbe\u7f6e==\u91cc\u7684\u4fee\u6539\u6a21\u677f\u6765\u6539\u53d8\u65b0\u5efa\u6587\u7ae0\u7684\u5185\u5bb9\u3002",newFileTemplate:newFileTemplate}}}}),window.requirejs.define({initialize:function(e,t,n){var i,r,o,a,s,l,c,u,d,p,f,h,m,v,g;s=t("application"),o=t("./lib/utils"),r=t("./lib/notifier"),i=t("./constant"),p=null,c=function(e){if(!e.type||"markdown"===e.type)return emit(e.title)}.toString(),u=function(e){return e.title}.toString(),g=function(e,t){var n,r,o,a,s,l,d,p,f,h,m,v,g,w,y,b,x,k,D;return k=i.pouchDB,console.warn("no query index, system create it"),$(".application_dimmer .loader_message.sub.header").html("\u6b63\u5728\u91cd\u5efa\u7d22\u5f15..."),h=function(e){if(!e.type||"markdown"===e.type)return e.guid&&!e.isDeleted?emit([e.pluginName,e.guid,e.parentPath]):void 0},m=function(e){return[e.pluginName,e.guid,e.parentPath,e.isDeleted].join(",,,,")},y=function(e){var t,n,i;if(!(e.type&&"markdown"!==e.type||0===e._id.indexOf("_design/")||e.isDeleted)){for(n in i=[],t=e._attachments||{})"text/xsj-link"===t[n].content_type&&i.push(e._id+"__"+n);return emit([e.updateDate,e._id],i)}},x=function(e){return e.updateDate+",,..,,"+e.isDeleted},b=function(e){var t,n,i;if(!(e.type&&"markdown"!==e.type||0===e._id.indexOf("_design/")||e.isSys)){for(n in i=[],t=e._attachments||{})"text/xsj-link"===t[n].content_type&&i.push(e._id+"__"+n);return emit([e.updateDate,e._id],i)}},a=function(e){if(!e.type||"markdown"===e.type)return 0===e._id.indexOf("_design/")||e.isDeleted||e.isArchived?void 0:emit([e.updateDate,e._id])},s=function(e){return[e.updateDate,e.isDeleted,e.isArchived].join(",,,,")},r=function(e){if(!e.type||"markdown"===e.type)return 0===e._id.indexOf("_design/")||e.isDeleted?void 0:emit([e.createDate,e._id])},o=function(e){return e.createDate+",,..,,"+e.isDeleted},l=function(e){if(!e.type||"markdown"===e.type)return e.fullPath&&!e.isDeleted?emit(e.fullPath):void 0},d=function(e){return e.fullPath+",,,,"+e.isDeleted},p=function(e){var t,n,i,r;if((!e.type||"markdown"===e.type)&&e.isDeleted){for(r in t={},i=e._attachments||{})n=i[r],t[r]={content_type:n.content_type};return emit([e.updateDate,e._id],{_id:e._id,_rev:e._rev,_attachments:t})}},f=function(e){return e.updateDate+",,,,"+e.isDeleted},v=function(e){var t,n,i,r,o;if(!(e.type&&"markdown"!==e.type||e.isDeleted)){for(i=[],t=0,n=(o=_.uniq(_.compact(e.tagNames)).sort()).length;t<n;t++)r=o[t],i.push(emit(r,{updateDate:e.updateDate,createDate:e.createDate}));return i}},g=function(e){return(e.tagNames||[]).join(",,,,")+",,..,,"+e.isDeleted},n=function(e){var t,n,i,r,o;if((!e.type||"markdown"===e.type)&&!e.isDeleted&&e.tagNames&&Array.isArray(e.tagNames)&&e.tagNames.length>0){for(i=[],t=0,n=(o=function(e,t){var n,i,r,o;for(null==t&&(t=1),n=_.uniq(_.compact(e)).sort(),r=function(e,t,n,i){var o;if(0!==e)for(o=0;o<t.length;)r(e-1,t.slice(o+1),n.concat([t[o]]),i),o++;else n.length>0&&(i[i.length]=n)},i=[],o=t;o<n.length;)r(o,n,[],i),o++;return i.push(n),i}(e.tagNames)).length;t<n;t++)r=o[t],i.push(emit(r,{updateDate:e.updateDate,createdDate:e.createDate}));return i}},w=function(e,t,n){return e.length},D={_id:"_design/query_index",views:{by_title:{map:c,indexCheck:u},by_sysTitle:{map:function(e){if(!e.type||"markdown"===e.type)return e.isSys&&e.sysTitle&&!e.isDeleted?emit(e.sysTitle):void 0}.toString(),indexCheck:u},by_plugin:{map:h.toString(),indexCheck:m.toString()},by_updatedate:{map:y.toString(),indexCheck:x.toString()},by_updatedate_for_sync:{map:b.toString(),indexCheck:x.toString()},by_createdate:{map:r.toString(),indexCheck:o.toString()},by_draftupdatedate:{map:a.toString(),indexCheck:s.toString()},by_isDeleted:{map:p.toString(),indexCheck:f.toString()},by_fullPath:{map:l.toString(),indexCheck:d.toString()},by_tagNames:{map:v.toString(),reduce:w.toString(),indexCheck:g.toString()},by_combineTagNames:{map:n.toString(),reduce:w.toString(),indexCheck:g.toString()}}},e&&e._rev&&(D._rev=e._rev),k.put(D).then((function(){return k.query("query_index/by_plugin",{limit:0})})).then((function(){return"function"==typeof t?t():void 0})).catch((function(e){return console.log(e),"function"==typeof t?t():void 0}))},m=function(e){var n,r;return n=function(){var t;try{return"function"==typeof e&&e(),e=null}catch(e){return t=e,console.error(t)}},(r=i.pouchDB).get("_design/query_index").then((function(e){return s.isNewestDatabase()?n():(console.log("\u91cd\u65b0\u6784\u5efa\u7d22\u5f15\u3002\u3002\u3002"),t("./lib/pouchdb_index_view_manager").destroyAllViews(r,(function(){return delete e._rev,g(e,n)})))})).catch((function(e){return g(null,n)}))},f=function(e){return e()},a=function(){return"client"===STORY_PLATFORM?window.xsjClientInit():s.initialize()},l=function(e){var t,n,i,a,l;if(i=location.hash)if(history.pushState("",document.title,window.location.pathname+window.location.search),/^(#md=|#md64=)/.test(i)){t={};try{t=/^#md64=/.test(i)?JSON.parse(window.atob(i.slice(6))):JSON.parse(decodeURIComponent(i.slice(4)))}catch(e){e,console.log("parse cfg error"),r.showMessage("\u6253\u5f00\u94fe\u63a5\u51fa\u9519 ",6e3,"error")}if(t.content&&t.title&&_.isString(t.content)&&_.isString(t.title))return n=decodeURIComponent(escape(t.content)),a=decodeURIComponent(escape(t.title)),void p.createFile(a,n,[],{},(function(t,n,i){return e(null,n)}))}else if(/^(#xsjzip=)/.test(i)&&(l=$.trim(decodeURIComponent(i.slice(8))),/^http[s]?:\/\//i.test(l)))return s.homeView.showLoader(null,"\u52a0\u8f7d\u6587\u4ef6\uff1a ..."+l.slice(-20)),void o.importZipLink(l,{},(function(t,n,i,o,a){return s.homeView.hideLoader(),t?(r.showMessage("\u6253\u5f00\u6587\u4ef6\u5931\u8d25\uff0c\u8bf7\u6c42\u5931\u8d25: "+l+", \u8bf7\u624b\u52a8\u4e0b\u8f7d\u8be5 zip \u6587\u4ef6\uff0c\u518d\u5bfc\u5165\u5230\u5c0f\u4e66\u5320\u7cfb\u7edf\u5185",6e3,"error"),e()):p.createFile(n,i,o,a,(function(t,n,i){return e(null,n)}))}));return e()},h=function(e){var t,n;return n=!s.isNewest(),t=s.isFirstUse(),n&&(t?p.createGrammarHelpFile(n,(function(t,i,o){return t?(r.showMessage("\u521b\u5efa\u5e2e\u52a9\u6587\u4ef6\u5931\u8d25:"+t,6e3,"error"),e()):p.createUseHelpFile(n,(function(){return p.createUpdateHelpFile(n,(function(t,n){return e(null,n)}))}))})):p.createUpdateHelpFile(n,(function(t,n){return e(null,n,!0)}))),e()},d=function(e){var n;return s.state.initFileModel?(n=s.state.initFileModel).fetch({silent:!1,error:function(){return e()},success:function(){var i;return delete n.isXSJFake,t("./lib/preview_core").cleanCache(null,n),n.attachmentMeta={},n._isNeedSave=!1,(i=s.getFileLocalCollection().getFileLocalModelByFileId(n.id)).get("content")||i.get("isLocked")||$(window).trigger("changeFileModel",n),e()}}):e()},v=function(e){var t;return"client"===STORY_PLATFORM&&(t=require("../package.json"),window.APP_VERSION!==t.version&&(window.CLIENT_APP_VERSION=t.version)),e()},$((function(){return CodeMirrorSpellChecker({codeMirrorInstance:CodeMirror,getIgnoreWords:function(){var e;return"string"==typeof(e=s.getApplicationProfileModel().get("userDicts")||[])&&(e=e.split(",")),e}}),"client"===STORY_PLATFORM&&favicon.change("ico/favicon.ico?"+Date.now()),String.prototype.trim=function(){return this.replace(/^[ ]+|[ ]+$/g,"")},(!window.xsjClientUpgrade||!window.xsjClientUpgrade())&&(p=s.getFileCollection(),v((function(){return f((function(){return s.checkNewestVersion(),s.delayFns.push((function(){return m((function(){var e,n;return e=t("./lib/pouchdb_worker_manager"),(n=new e).startWorker((function(e){if(!e)return window.pouchdbWorkerManager=n})),$(window).trigger("xsj.dbInited"),s.state.dbInited=!0,window.xsjClientArgvInit&&(l=window.xsjClientArgvInit),d((function(){return l((function(e,n){return e?r.showMessage("\u521d\u59cb\u5316\u6587\u4ef6\u5931\u8d25:"+e,6e3,"error"):n&&$(window).trigger("changeFileModel",n),h((function(e,i,a){var l,c,u;if(i&&!n)return l=function(e,n){var i,a,s,l,c,u,d;if((i=(n=n||e.editorProxy).commonCodeMirrorEditor)&&!o.isMobileDevice()&&(l=e.getCursorByHashTag("foldnextline").row+1,console.log("foldLine",l),n.editor.foldCode({line:l,ch:0}),d=e.getCursorByHashTag("newestUpdate").row-1,s=e.getCursorByHashTag("newestUpdateEnd").row+1,e.initCursor({cursorPosition:d+1}),u={from:d,to:s,cursorLine:d},a=t("./views/codemirror/create_freeze_editor"),c=a(i,{lineInfo:u,forceOpen:!0})))return c.on("destroy",(function(){return c.off("destroy"),r.showMessage("\u5728\u7f16\u8f91\u533a\u5185\u6309 F4 ,\u53ef\u4ee5\u91cd\u65b0\u6253\u5f00\u9501\u884c\u7f16\u8f91\u5668",6e3,"warning")}))},c=function(e,t){return l(t,t.editorProxy)},u=function(e,t){return l(t,t)},s.homeView.editorView.fileModel&&(a=!0),a?void $(window).trigger("createNewEditor",[i,{forceOpen:!0,callback:u}]):$(window).trigger("changeFileModel",[i,{callback:c}])}))}))}))}))})),a()}))})))}))}}),window.requirejs.define({"lib/about":function(e,t,n){n.exports={show:function(){return $('<div class="ui modal standard">\n  <i class="close icon"></i>\n  <div class="header">\n    \u5173\u4e8e\u5c0f\u4e66\u5320\n  </div>\n  <div class="content">\n    <div class="ui medium image">\n      <img src="/images/avatar/large/chris.jpg">\n    </div>\n    <div class="description">\n      <div class="ui header">\u611f\u8c22\u60a8\u4f7f\u7528\u5c0f\u4e66\u5320\u7248\u7684markdown\u5728\u7ebf\u7f16\u8f91\u5668</div>\n      <p>\u672cmakrdown\u7f16\u8f91\u5668\u662f\u4e0e\u5c0f\u4e66\u5320\u7f51\u72ec\u7acb\u5f00\u6765\u7684\u4e00\u4e2a\u8f6f\u4ef6\uff0c\u65b9\u4fbf\u7528\u6237\u76f4\u63a5\u4f7f\u7528</p>\n      <p>\u6b22\u8fce\u6ce8\u518c\u5c0f\u4e66\u5320\u7528\u6237\uff0c\u521b\u5efa\u6709\u4ef7\u503c\u7684\u4f5c\u54c1<a href="http://www.xiaoshujiang.com" target="_blank">http://www.xiaoshujiang.com</a></p>\n    </div>\n  </div>\n  <div class="actions">\n    <div class="ui positive right labeled icon button">\n      \u5173\u95ed\n      <i class="check icon"></i>\n    </div>\n  </div>\n</div>').modal("show")}}}}),window.requirejs.define({"lib/app_resource_core":function(e,t,n){var i,r,o,a;t("../application"),t("../lib/notifier"),t("../lib/utils"),t("../constant"),r=t("../models/app_resource_model"),o=null,a=function(e){var t,n;return n=null,e&&(t=e.get("_attachments").attachment.data,n={data:e.get("_attachments").attachment.data,type:t.type,filename:e.get("filename")}),n},i={createResource:function(e,t,n,i,o){return r.createResource(e,t,n,i,(function(e,t){return o(e,a(t))}))},createResourceIf:function(e,t,n,i,o){return r.getResource(e,(function(s,l){return s?r.createResource(e,t,n,i,(function(e,t){return o(e,a(t))})):o(null,a(l))}))},getResource:function(e,t){var n,i;return n=function(){return r.getResource(e,(function(e,n){return t(e,a(n))}))},o?(i=o.get("urlMap")||{},e=i[e]||e,o.getAttachObjectByFilename(e,(function(e,i){var r,o;return i?(r=(r=(r=i.key).replace(/\/*$/,"")).substring(r.lastIndexOf("/")+1),o={data:i.data,type:i.type,filename:r,key:i.key},t(null,o)):n()}))):n()},setCurrentCopiedFileModel:function(e){return o=e}},n.exports=i}}),window.requirejs.define({"lib/cache":function(e,t,n){var i;i=function(e){var t,n;return 1e4,n=0,t={},{getCounter:function(){var e;return e=n,n++,e},setCounter:function(e){var t;try{return n=parseInt(e)}catch(e){return t=e,console.log(t)}},keys:function(){return Object.keys(t)},get:function(e){return t[e]},set:function(e,n){return Object.keys(t).length>1e4&&this.clean(),t[e]=n},clean:function(){return Object.keys(t).map((function(n){return"function"==typeof e&&e(t[n]),delete t[n]})),n=0}}},n.exports=i}}),window.requirejs.define({"lib/check_new_version":function(e,t,n){var i,r,o,a,s,l,c;i=t("../application"),a=t("../lib/utils"),o=t("./notifier"),s=!1,c=function(e,t,n,i,r){return e?o.showMessage("\u68c0\u6d4b\u65b0\u7248\u672c\u51fa\u9519:"+e,6e3,"error"):t?o.showMessage({html:"\u53d1\u73b0\u65b0\u7248\u672c<br/>\n<a href='http://soft.xiaoshujiang.com' target='_blank'>\u4e0b\u8f7d</a>"},-1):o.showMessage("\u5df2\u7ecf\u662f\u6700\u65b0\u7248\u672c")},l=function(e,t){var n;return n=i.getUserModel().get("token"),$.getJSON(e,{access_token:n}).then((function(e){return t(null,e)})).fail((function(e,n,i){return t(n)}))},r={_checkNewVersion:function(e,t,n,i){var r;return n.sw&&$.extend(n,n.sw),r=n.cache.url,async.map(["sw.json",r+"app/sw.json"],l,(function(e,t){var r,o,s;return e?i("\u68c0\u6d4b\u65b0\u7248\u672c\u51fa\u9519:"+e):(o=t[0],(s=t[1]).error?i("\u68c0\u6d4b\u65b0\u7248\u672c\u51fa\u9519:"+s.error):o.version.split("/")[2]===s.version.split("/")[2]?(r=function(){return a.complement(s.precacheConfig,o.precacheConfig,(function(e,r){return e?i(e):r.length<=0?i(null,!1,!1,n,t):i(null,!0,!0,n,t)}))},caches.open("xsj").then((function(e){return e.match("http://localhost/").then((function(e){return e.json()}))})).then((function(e){return e.serviceVersion===s.version?i(null,!1,!1,n,t):r()})).catch((function(){return r()}))):i(null,!0,!1,n,t))}))},checkNewVersion:function(e){var t,n,r;if(null==e&&(e=c),n=this,"client"===STORY_PLATFORM){if(r=new(require("node-webkit-updater"))(t=require("../package.json")),s)return;return s=!0,r.checkNewVersion((function(r,o,a){var l;return l=i.getUserModel().get("user"),s=!1,r?e(r):(a.clientVersion=a.version,a.clientDescription=a.description,o?l&&l.isRealVip?n._checkNewVersion(o,t,a,e):e(null,!0,!1,a,[]):a.sw&&a.sw.version!==a.version&&l&&l.isRealVip?n._checkNewVersion(o,t,a,e):e(null,!1,!1,a,[]))}))}}},n.exports=r}}),window.requirejs.define({"lib/chrome-tabs/index":function(e,t,n){var i,r,o,a,s;i=t("../../application"),r=t("../../lib/utils_font"),void 0!==document.body.style["-webkit-mask-repeat"]?$("html").addClass("cssmasks"):$("html").addClass("no-cssmasks"),s=function(e){var t,n;return n="chrome-tab-file droppable_file_item",t='<i class="file alternate outline icon"></i>',"group"===e.type?(n="chrome-tab-group","temp"===e.groupType&&(n+=" chrome-tab-temp-group"),t='<i class="book icon"></i>'):e.isPinned&&(n+=" chrome-tab-pin-file"),'<div class="chrome-tab '+n+'" data-id="'+_.escape(e.id)+'">\n  <div class="chrome-tab-favicon">\n  '+t+'\n  </div>\n  <div class="chrome-tab-title"></div>\n  <div class="chrome-tab-close"></div>\n  <div class="chrome-tab-curves">\n    <div class="chrome-tab-curves-left-shadow"></div>\n    <div class="chrome-tab-curves-left-highlight"></div>\n    <div class="chrome-tab-curves-left"></div>\n    <div class="chrome-tab-curves-right-shadow"></div>\n    <div class="chrome-tab-curves-right-highlight"></div>\n    <div class="chrome-tab-curves-right"></div>\n  </div>\n</div>'},a={title:"New Tab",data:{}},o={init:function(e){var t;return $.extend(e.$shell.data(),e),e.$shell.find(".chrome-tab").each((function(){return $(this).data().tabData={data:{}}})),t=function(){return o.render(e.$shell)},$(window).resize(t),t(),o.setupSortable(e.$shell),e.$shell.trigger("chromeTabRender")},render:function(e){return o.fixTabSizes(e),o.fixZIndexes(e)},setupSortable:function(e){var t;return(t=e.find(".chrome-tabs")).sortable({appendTo:"body",connectWith:".sortable_file_tabs_area",tolerance:"pointer",placeholder:{element:function(e){var t;return t=$.trim(e.text()),$('<div class="droppable_file_item ui-sortable-placeholder dragging_file_item ui-draggable-dragging chrome-tab chrome-tab-file">\n<div class="chrome-tab-favicon">\n  <i class="file alternate outline icon"></i>\n</div>\n<div class="chrome-tab-title">'+_.escape(t)+'</div>\n<div class="chrome-tab-curves">\n  <div class="chrome-tab-curves-left-shadow"></div>\n  <div class="chrome-tab-curves-left-highlight"></div>\n  <div class="chrome-tab-curves-left"></div>\n  <div class="chrome-tab-curves-right-shadow"></div>\n  <div class="chrome-tab-curves-right-highlight"></div>\n  <div class="chrome-tab-curves-right"></div>\n</div>\n</div>')},update:function(){}},helper:function(e,t){var n,i;return $(".dragging_file_item").remove(),$("body").addClass("iframe_dimmer xsj_dragging_item"),i=t.data("tabData"),(n=$('<div class="dragging_file_item"></div>')).text(i.title),n.data("itemInfo",{id:i.id,type:i.type,title:i.title,emoji:i.emoji,activeFile:i.activeFile})},distance:5,delay:150,zIndex:1e4,scroll:!1,cancel:".chrome-tab-close",start:function(){return setTimeout((function(){return $(".sortable_file_tabs_area").sortable("refreshPositions")}),1e3)},stop:function(e,t){if($("body").removeClass("iframe_dimmer xsj_dragging_item"),t.helper)return t.helper.remove()},update:function(n,i){var r;return i&&i.item&&i.item[0]&&i.item[0].parentElement&&((r=i.item).addClass("dropped_file_item"),appHighlightPosByEl(r[0]),setTimeout((function(){return r.removeClass("dropped_file_item")}),1e3)),e.trigger("chromeTabUpdate",[t.sortable("toArray",{attribute:"data-id"})])},remove:function(n,i){var r,o,a;if("file"===(o=(r=i.item).data("tabData")).type)return a={id:o.id,type:o.type,title:o.title,emoji:o.emoji,activeFile:o.activeFile},r.data("itemInfo",a),r.data("xsjSortableItem",{$el:r,remove:function(){return r.remove()}}),e.trigger("chromeTabUpdate",[t.sortable("toArray",{attribute:"data-id"})]),e.trigger("chromeTabClose",a);t.sortable("cancel")},receive:function(t,n){var i,r,a,s;if(s=n.item.data("xsjSortableItem"),a=n.helper,s?(r=s.$el.data("itemInfo"),a=n.item):r=n.helper.data("itemInfo"),e.trigger("chromeTabAdd",r),(i=o.addOrUpdateNewTab(e,r,a)).addClass("dropped_file_item"),appHighlightPosByEl(i[0]),setTimeout((function(){return i.removeClass("dropped_file_item")}),1e3),s)return n.item.data("xsjSortableItem",""),s.remove(),null}}),t.disableSelection()},fixTabSizes:function(e){var t,n,i;return t=e.find(".chrome-tab"),n=parseInt(t.first().css("marginLeft"),10)+parseInt(t.first().css("marginRight"),10)||0,i=(i=e.width()-50)/t.length-n,i=Math.max(e.data().minWidth,Math.min(e.data().maxWidth,i)),t.css({maxWidth:i})},fixZIndexes:function(e){var t;return(t=e.find(".chrome-tab")).each((function(e){var n,i;return n=$(this),i=t.length-e,n.hasClass("chrome-tab-current")&&(i=t.length+40),n.css({zIndex:i}),n.data({zIndex:i})}))},addOrUpdateNewTab:function(e,t,n){var i,r;return(0===(i=e.find(".chrome-tab").filter((function(e,n){return $(n).data("id")===t.id}))).length||n)&&(i.length<=0&&(i=$(s(t))),n?n.replaceWith(i):e.find(".chrome-tabs").append(i)),r=$.extend(!0,{},a,t),o.updateTab(e,i,r),i},setCurrentTab:function(e,t){return e.find(".chrome-tab-current").removeClass("chrome-tab-current"),t.addClass("chrome-tab-current"),o.render(e)},activeGroupTab:function(e,t){return e.find(".chrome-tab-current.chrome-tab-group").removeClass("chrome-tab-current"),e.find(".chrome-tab").filter((function(e,n){return $(n).data("id")===t})).addClass("chrome-tab-current")},activeTab:function(e,t){var n;return n=e.find(".chrome-tab").filter((function(e,n){return $(n).data("id")===t})),o.setCurrentTab(e,n)},destroyTab:function(e,t){var n;return"function"==typeof(n=e.find(".chrome-tab").filter((function(e,n){return $(n).data("id")===t}))).popup&&n.popup("destroy"),n.remove(),o.render(e)},updateTab:function(e,t,n){var o,a,s,l,c;return t.attr("title",n.title),t.find(".chrome-tab-title").text(n.title),(l=(a=i.getFileGroupTabCollection().get(n.id)).get("groupFontIcon"))&&r.registerFontIconStyle(l),(c=a.get("groupIcon"))&&t.find(".chrome-tab-favicon>i").removeClass().addClass(c),(o=a.get("emoji")||"")?t.find(".chrome-tab-favicon>i").addClass("file_emoji").html(o):t.find(".chrome-tab-favicon>i").removeClass("file_emoji").html(""),(s=a.get("groupColor")||"")?(t[0].style.setProperty("--lighterBackground",s),t[0].style.setProperty("--selectionBackground",s),t[0].style.setProperty("--defaultForeground","white")):(t[0].style.removeProperty("--lighterBackground"),t[0].style.removeProperty("--selectionBackground"),t[0].style.removeProperty("--defaultForeground")),"group"===n.type?"persist"===n.groupType?t.removeClass("chrome-tab-temp-group"):t.addClass("chrome-tab-temp-group"):n.isPinned?t.addClass("chrome-tab-pin-file"):t.removeClass("chrome-tab-pin-file"),t.data().tabData=n,t.data().id=n.id}},n.exports=o}}),window.requirejs.define({"lib/client_file_watch_manager":function(e,t,n){var i,r,o,a,s;t("../application"),i=t("../lib/notifier"),s={},a={},r=function(){},o=function(){var e,t,n,o,l;return"client"!==STORY_PLATFORM?null:(require("path"),e=require("fs"),require("mime"),l=function(n,s){var l,c,u;if(s=s||r,n&&"client"===STORY_PLATFORM){if((c=n.get("fullPath"))&&!e.existsSync(c)&&(n.set("fullPath",""),c=""),!c)return;return a[n.id]?a[n.id].fns.push(s):(l=[s],u=function(r,o,s){return e.readFile(r,{encoding:"utf-8"},(function(e,o){return e?(i.showMessage("\u672c\u5730\u6587\u4ef6\u5b9e\u65f6\u66f4\u65b0\u51fa\u9519: "+e,6e3,"error"),n.set("fullPath",""),t(r),delete a[n.id]):n.set("diskContent",o),l.forEach((function(t){return t(e,o)}))}))},a[n.id]={fns:l,watchFileLocalModelFn:u},o(c,u))}},n=function(n,i){var r,o,s;if(!n||"client"!==STORY_PLATFORM||((o=n.get("fullPath"))&&!e.existsSync(o)&&(n.set("fullPath",""),o=""),o))return(s=a[n.id])&&(i?(r=s.fns.slice(),s.fns.length=0,r.forEach((function(e){if(e!==i)return s.fns.push(e)}))):s.fns.length=0,0===s.fns.length)?(t(o,s.watchFileLocalModelFn),delete a[n.id]):void 0},{watchFile:o=function(t,n){var i;if(s[t])return s[t].push(n);s[t]=[n];try{return e.unwatchFile(t),e.watchFile(t,(function(e,n){return s[t].forEach((function(i){return i(t,e,n)}))}))}catch(e){return i=e,s[t]=null,console.error("watchFile "+t+" error: "+i),console.error(i)}},unwatchFile:t=function(t,n){var i,r;if(n?(r=(s[t]||[]).filter((function(e){return e!==n})),s[t]=r):s[t]=null,!s[t]||0===s[t].length){delete s[t];try{return e.unwatchFile(t)}catch(e){return i=e,console.error("unwatchFile "+t+" error: "+i),console.error(i)}}},watchFileLocalModel:l,unwatchFileLocalModel:n,checkConfirmFileLocalModel:function(t,n){var i,r;if(t&&"client"===STORY_PLATFORM&&((r=t.get("fullPath"))&&!e.existsSync(r)&&(t.set("fullPath",""),r=""),r&&(t.get("diskContent")||"")!==(i=e.readFileSync(r,{encoding:"utf-8"}))))return $('<div class="ui small modal">\n  <i class="close icon"></i>\n  <div class="content">\u672c\u5730\u6587\u4ef6\u5df2\u7ecf\u88ab\u4fee\u6539,\u662f\u5426\u91cd\u65b0\u52a0\u8f7d</div>\n  <div class="actions">\n  <div class="ui cancel button">\n    \u53d6\u6d88\n  </div>\n  <div class="ui positive right button">\n  \u786e\u5b9a\n  </div>\n  </div>\n</div>').modal({onApprove:function(){return t.set("diskContent",i),n(!0,i)},onDeny:function(){return n(!1,i)}}).modal("show")}})},n.exports=o}}),window.requirejs.define({"lib/code_chunk":function(e,t,n){var i;i={run:function(e,t,n,i,r){var o,a,s,l,c;if(null==t&&(t=""),null==i&&(i={}),"client"===STORY_PLATFORM)return s=require("path"),a=require("fs"),c=require("child_process").spawn,"string"==typeof(o=i.args||[])&&(o=[o]),t||(t=s.dirname(process.execPath)),l=s.resolve(t,Math.random().toString(36).substr(2,9)+"_code_chunk"),e=e.replace(/\u00A0/g," "),a.writeFile(l,e,(function(s){var u,d,p,f;if(!s)return p=!1,o=o.map((function(e){return"{input_file}"===e?(p=!0,l):e})),p||i.stdin||o.push(l),f=c(n,o,{cwd:t}),i.stdin&&f.stdin.write(e),f.stdin.end(),u=[],d=[],f.stdout.on("data",(function(e){return u.push(e)})),f.stderr.on("data",(function(e){return d.push(e)})),f.on("error",(function(e){return d.push(Buffer.from(e.toString(),"utf8"))})),f.on("close",(function(){var e,t;return a.unlinkSync(l),e=Buffer.concat(u).toString(),t=null,d.length&&(t=Buffer.concat(d).toString()),"function"==typeof r?r(t,e,i):void 0}));"function"==typeof r&&r(!0)}));setTimeout((function(){return"function"==typeof r?r(null,e,i):void 0}),0)}},n.exports=i}}),window.requirejs.define({"lib/config_sync":function(e,t,n){var i,r,o,a,s,l,c,u,d,p,f,h,m,v,g,w,y,b,x,k,D,C,F,M,T,S,P,j,E,I=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};o=t("../constant"),t("../lib/utils"),i=t("../application"),a=t("../lib/notifier"),l=t("../models/store_plugin_model"),s=t("./recently_use_manager"),g=o.configDBOptions,b=o.pouchDBConfig,E=null,m=null,T=function(){return null!=E&&E.cancel(),E=null,null!=m&&m.cancel(),m=null},x=function(e){if(e){if(e instanceof TypeError)e=e.toString();else try{e=JSON.stringify(e)}catch(t){t,console.log(e)}return e}},j=null,w=null,c=["font","css","assetPath","imagePath","audioPath","videoPath","attachmentPath","fullscreenBackgroundPic","fullscreenPreviewMinimap","cmFullscreenStyleStackFocusLine","cmColorpickerColorSets","autoAddTag","proxy","newFileTemplate","newFileTemplateId","storeTreeSort","filesSort","exportConfig","userDicts","themeInfo","filterInfos"],S=!0,MINI_WEB&&(S=!1),MAC_STORE_WEB&&(S=!0),S&&(y=["databaseSyncType","databaseCustomSyncUrl","databaseCustomSyncUsername","databaseCustomSyncPassword","databaseCustomSyncWithCredentials","databaseCustomSyncLive","databaseCustomSyncLiveFull","databaseCustomSyncLiveMax"],c=c.concat(y)),P={xsj_config_application:c,xsj_config_editor:["bindInfos","pastePlainFileMode","momentFormat","tocOrderedList","tocDepthFrom","tocDepthTo","useWrapMode","fontSize","viewportWidth","viewportAlign","mode","theme","editorFont","editorType","lineHeight","cm_minimap","cm_keyBinding","cm_lineNumbers","cm_autoCloseBrackets","cm_lineWrapping","cm_highlightActive","cm_styleStackFocusLine","cm_showInvisibles","cm_typewriterScrolling","cm_tabSize","cm_smartIndent","cm_indentUnit","cm_indentWithTabs","cm_scrollPastEnd","cm_autopreviewHoveredImage","cm_autopreviewImage","cm_autopreviewTodoList","cm_autopreview","cm_autopreview_image","cm_autopreview_link","cm_autopreview_inline","cm_autopreview_hr","cm_autopreview_yaml","cm_autopreview_mathjax","cm_autopreview_todo","cm_autopreview_toc","cm_autopreview_footnote","cm_autopreview_ruby","cm_autopreview_fenced_code","cm_autopreview_header","cm_autopreview_html","cm_autopreview_emoji","cm_autopreview_mermaid","cm_autopreiew_flow","cm_autopreview_sequence","cm_autopreview_plantUML","cm_activeCursorMathjax","cm_spellChecker","cm_variableHeight","cm_markerColorpicker"],xsj_config_preview:["table","delay","viewportWidth","viewportAlign","aliasLang","mathjaxRegex","codePreviewCss","systemPreviewCss","useSystemPreviewCss","userPreviewCssText","render*","grammar_*"]},v=function(e,t){return I.call(t,e)>=0||_.filter(t,(function(t){return!!t.endsWith("*")&&e.startsWith(t.substring(0,t.length-1))})).length>0},k=!1,D=!1,d=function(e,t,n){var i;if(null==n&&(n=$.noop),!k&&!D)return i=P[t]||[],w.get(t,(function(r,o){var a,s,l,c;for(l in r&&(o={_id:t,config:{},type:"settings"}),a=o.config||{},s=!1,e)c=e[l],v(l,i)&&(s=!0,a[l]=c);return s?w.put(o,n):n(null,o)}));setTimeout((function(){return n()}),10)},h=function(e,t,n,i){if(null==n&&(n="xsj_config_stores"),null==i&&(i=$.noop),!k&&!D)return w.get(n,(function(r,o){var a;return r&&(o={_id:n,stores:[],type:"settings",plugin:"",resourcePluginId:""}),o.stores||[],a=[],o.plugin=e.plugin,o.resourcePluginId=e.resourcePluginId,t.forEach((function(e){return a.push(e.attributes)})),o.stores=a,w.put(o,i)}));setTimeout((function(){return i()}),10)},F=function(e,t){var n;return null==t&&(t=$.noop),n=function(){return w.replicate.from(b,{doc_ids:[e],batch_size:1}).then((function(){return t()})).catch((function(){return t()}))},b.get(e,(function(r,o){var a,s,l,c,u,d,p;if(u={_id:e},r){if("xsj_config_stores"===e)b===w&&({plugin:(s=i.getApplicationProfileModel()).get("plugin"),resourcePluginId:s.get("resourcePluginId")},u.plugin=s.get("plugin"),u.resourcePluginId=s.get("resourcePluginId"),u.stores=M.toJSON());else{for(c in a={},a=b===w?C[e].attributes:C[e].defaults,d=P[e]||[],l={},a)p=a[c],v(c,d)&&(l[c]=p);u.config=l}return b.put(u,(function(){return b===w?t():n()}))}return b===w?t():n()}))},f=function(e){var t,n,r,o,a,s,c,u;if("xsj_config_stores"===e._id)return c=function(){var t,n,i;if(i=e.stores||[],t=JSON.stringify(i),JSON.stringify(M.models)!==t)return n=M.models.slice(),M.remove(M.models,{silent:!0}),n.forEach((function(e){return e.destroy()})),i.forEach((function(e){var t;return(t=new l(e)).save(),M.add(t,{silent:!0})}))},(s=(r=i.getApplicationProfileModel()).get("plugin"))&&(o=M.get(s))&&(a=JSON.stringify(o)),c(),(n=e.plugin)&&(t=M.get(n))?n!==s?r.save({plugin:n}):a!==JSON.stringify(t)&&(r.set({plugin:""}),r.save({plugin:n})):r.save({plugin:""}),u=e.resourcePluginId,r.save({resourcePluginId:u}),M.trigger("modelsChanged")},p=function(e){var t,n,i,r,o,a;if(i=C[e._id]){for(n in o=P[e._id]||[],t={},r=e.config)a=r[n],v(n,o)&&(t[n]=a);return i.save(t)}},u=function(e){if(e&&e._id)return"xsj_config_stores"===e._id?f(e):p(e)},C={xsj_config_application:i.getApplicationProfileModel(),xsj_config_editor:i.getEditorProfileModel(),xsj_config_preview:i.getPreviewProfileModel()},M=i.getStorePluginCollection(),r={getCurrentConfigDB:function(){return w},initTemplateDesign:function(e){var t,n,i,r,o;return n=function(e){var t;if(e.type&&"template"===e.type&&"string"==typeof(t=e.category||""))return emit(t||"undefined",{updateDate:e.updateDate,createDate:e.createDate})},r=function(e,t,n){return e.length},i=function(e){if(e.type&&"template"===e.type&&e.templateName)return console.log("zzzz"),emit(e.templateName,{updateDate:e.updateDate,createDate:e.createDate})},o={_id:"_design/query_index",views:{by_tagNames:{map:function(e){var t,n,i,r,o;if(e.type&&"template"===e.type){for(i=[],t=0,n=(o=_.uniq(_.compact(e.tagNames)).sort()).length;t<n;t++)r=o[t],i.push(emit(r,{updateDate:e.updateDate,createDate:e.createDate}));return i}}.toString(),reduce:r.toString()},by_name:{map:i.toString(),reduce:r.toString()},by_category:{map:n.toString(),reduce:r.toString()}}},t=function(e){var t,n;return!!(e&&e.views&&e.views.by_tagNames&&e.views.by_name&&(n=e.views.by_name,t=o.views.by_name,n.map===t.map&&n.reduce===t.reduce))},w.get("_design/query_index",(function(n,i){return t(i)?e():(i&&i._rev&&(o._rev=i._rev),w.put(o,(function(t){return t&&console.error(t),e()})))}))},createOrUpdateTemplate:function(e,t){var n;return e.type="template",n=uniqueNumber(),e.updateDate=n,e._id||(e._id="template_"+n),w.get(e._id,(function(i,r){return i?(delete e._rev,e.createDate=n,e.score=0,e.usetimes=0):(delete e._rev,e=Object.assign(r,e)),w.put(e,t)}))},deleteTemplate:function(e,t){return w.get(e,(function(e,n){return e?t():w.remove(n,t)}))},getTemplate:function(e,t,n){return w.get(e,t,(function(i,r){return i?n(i):(t.statistics&&s.addItem(e,"template"),t.statistics,n(null,r))}))},getTemplates:function(e,t,n,i){var r;return null==t&&(t=10),null==n&&(n=!1),r={selector:e,sort:[{type:"desc"},{sort:"desc"},{updateDate:"desc"}]},n&&(r.sort=[{type:"asc"},{sort:"asc"},{updateDate:"asc"}]),""!==t&&(r.limit=t),w.createIndex({index:{fields:["type","sort","updateDate"]}},(function(e,t){return w.find(r,(function(e,t){return n&&t.docs&&t.docs.reverse(),i(e,t||{docs:[]})}))}))},createOrUpdateSnippet:function(e,t){var n;return e.type="snippet",n=uniqueNumber(),e.updateDate=n,e._id||(e._id="snippet_"+n),w.get(e._id,(function(i,r){return i?(delete e._rev,e.createDate=n,e.score=0,e.usetimes=0):(delete e._rev,e=Object.assign(r,e)),w.put(e,t)}))},deleteSnippet:function(e,t){return w.get(e,(function(e,n){return e?t():w.remove(n,t)}))},getSnippet:function(e,t,n){return w.get(e,t,(function(i,r){return i?n(i):(t.statistics&&s.addItem(e,"snippet"),t.statistics,n(null,r))}))},getSnippets:function(e,t,n,i){var r;return null==t&&(t=10),null==n&&(n=!1),r={selector:e,sort:[{type:"desc"},{sort:"desc"},{updateDate:"desc"}]},n&&(r.sort=[{type:"asc"},{sort:"asc"},{updateDate:"asc"}]),""!==t&&(r.limit=t),w.createIndex({index:{fields:["type","sort","updateDate"]}},(function(e,t){return w.find(r,(function(e,t){return n&&t.docs&&t.docs.reverse(),i(e,t||{docs:[]})}))}))},createOrUpdateAvatar:function(e,t){var n;return e.type="avatar",n=uniqueNumber(),e.updateDate=n,e._id="system_user_avatar",w.get(e._id,(function(i,r){return i?(delete e._rev,e.createDate=n):(delete e._rev,e=Object.assign(r,e)),w.put(e,t)}))},deleteAvatar:function(e){return w.get("system_user_avatar",(function(t,n){return t?e():w.remove(n,e)}))},getAvatar:function(e,t){return w.get("system_user_avatar",e,(function(e,n){return e?t(e):t(null,n)}))},createOrUpdateTheme:function(e,t){var n;return e.type="theme",n=uniqueNumber(),e.updateDate=n,e._id||(e._id="theme_"+n),w.get(e._id,(function(i,r){return i?(delete e._rev,e.createDate=n,e.score=0,e.usetimes=0):(delete e._rev,e=Object.assign(r,e)),w.put(e,t)}))},deleteTheme:function(e,t){return w.get(e,(function(e,n){return e?t():w.remove(n,t)}))},getTheme:function(e,t,n){return w.get(e,t,(function(i,r){return i?n(i):(t.statistics&&s.addItem(e,"theme"),t.statistics,n(null,r))}))},getThemes:function(e,t,n,i){var r;return null==t&&(t=10),null==n&&(n=!1),r={selector:e,sort:[{type:"desc"},{sort:"desc"},{updateDate:"desc"}]},n&&(r.sort=[{type:"asc"},{sort:"asc"},{updateDate:"asc"}]),""!==t&&(r.limit=t),w.createIndex({index:{fields:["type","sort","updateDate"]}},(function(e,t){return w.find(r,(function(e,t){return n&&t.docs&&t.docs.reverse(),i(e,t||{docs:[]})}))}))},initDocs:function(e,t){return r.initTemplateDesign((function(){return r._initDocs(e,t)}))},_initDocs:function(e,t){var n,o;return j=i.getUserModel(),o=j.get("user"),n=function(t,n){return C[t],w.get(t,(function(i,a){var s;return e?F(t,(function(){return n()})):i?(s=r.getTargetDB(),o&&s?s.get(t,(function(e,i){return e?F(t,(function(){return n()})):w.replicate.from(s,{doc_ids:[t],batch_size:1}).then((function(){return n(null)})).catch((function(){return F(t,(function(){return n()}))}))})):F(t,(function(){return n()}))):n(null)}))},async.map(["xsj_config_application","xsj_config_editor","xsj_config_preview","xsj_config_stores"],n,(function(){return t()}))},initConfigDB:function(){var e;return e=(j=i.getUserModel()).get("user"),w=e&&e.id?new PouchDB("xiao_config_"+e.id,g):b},initListenerChanges:function(){var e,t,n,o;return j=i.getUserModel(),o=j.get("user"),e=i.getApplicationProfileModel(),t=i.getEditorProfileModel(),n=i.getPreviewProfileModel(),M=i.getStorePluginCollection(),r.initDocs(!1,(function(){return r.initStart(),e.on("change",(function(e,t){return console.log("apm model in configSyncLive going...."),d(e.changed,"xsj_config_application")})),t.on("change",(function(e,t){return console.log("epm model in configSyncLive going...."),d(e.changed,"xsj_config_editor")})),n.on("change",(function(e,t){return console.log("epm model in configSyncLive going...."),d(e.changed,"xsj_config_preview")})),e.on("forceSaveToDB",(function(t){return d(t||e.attributes,"xsj_config_application")})),e.on("change:plugin change:resourcePluginId",(function(){var t;return t={plugin:e.get("plugin"),resourcePluginId:e.get("resourcePluginId")},h(t,M.models)})),M.on("change",(function(){var t;return t={plugin:e.get("plugin"),resourcePluginId:e.get("resourcePluginId")},h(t,M.models),console.log("spc collection modify going...")})),M.on("add",(function(){var t;return t={plugin:e.get("plugin"),resourcePluginId:e.get("resourcePluginId")},h(t,M.models),console.log("spc collection add going...")})),M.on("remove",(function(){var t;return t={plugin:e.get("plugin"),resourcePluginId:e.get("resourcePluginId")},h(t,M.models),console.log("spc collection remove going...")}))})),j.on("change:token",(function(e,t){var n,i,a;return o=e.get("user"),a=e.get("token"),i=e.get("logoutClearConfig"),k=!0,r.stopSyncCouchdb(),n=function(e){return r.initDocs(!1,(function(){return w.allDocs({include_docs:!0,keys:["xsj_config_application","xsj_config_editor","xsj_config_preview","xsj_config_stores"]},(function(t,n){return t||n.rows.forEach((function(e,t){var n;return n=e.doc||{},u(n)})),e()}))}))},function(e){return w!==b&&i?w.destroy((function(){return e()})):e()}((function(){var e;return a?(e=o.id,w=new PouchDB("xiao_config_"+e,g)):w=b,n((function(){return k=!1,a&&o&&(r.initDBChangesListeners(),o.configSyncLive&&o.vip&&r.startConfigSyncCouchdb($.noop)),$(window).trigger("refreshAvatar")}))}))}))},resetDefaultDBConfig:function(e){var t,n,i,s,l;return l=(i=j).get("user"),(s=i.get("token"))?(k=!0,r.stopSyncCouchdb(),t=function(e){return $.ajax({url:o.apiHost+"/api/users/"+l.id+"/resetDBDefault",method:"POST",data:{type:"config"},headers:{Authorization:s}}).done((function(){return e()})).fail((function(t,n,i){var r,o;return r="\u91cd\u7f6e\u670d\u52a1\u5668\u914d\u7f6e\u51fa\u9519",(o=t.responseJSON)&&o.error?(r=(o=o.error).message,a.showMessage("\u63d0\u4ea4\u51fa\u9519:"+o.message,6e3,"error")):t.responseText?(r=t.responseText,a.showMessage("\u63d0\u4ea4\u51fa\u9519:"+t.responseText,6e3,"error")):(r=i||n||r,a.showMessage("\u63d0\u4ea4\u51fa\u9519:"+r,6e3,"error")),e(r)}))},n=function(e){return r.initDocs(!1,(function(){return w.allDocs({include_docs:!0,keys:["xsj_config_application","xsj_config_editor","xsj_config_preview","xsj_config_stores"]},(function(t,n){return t||n.rows.forEach((function(e,t){var n;return n=e.doc||{},u(n)})),e()}))}))},function(e){return t((function(t){return t?e(t):w.destroy(e)}))}((function(t){var i;return t?e(t):(i=l.id,w=new PouchDB("xiao_config_"+i,g),n((function(){return k=!1,s&&l&&(r.initDBChangesListeners(),l.configSyncLive&&l.vip&&r.startConfigSyncCouchdb($.noop)),e()})))}))):e()},initDBChangesListeners:function(){return null!=m&&m.cancel(),m=null,m=w.changes({live:!0,include_docs:!0,since:"now"}).on("change",(function(e){var t,n;if(t=e.doc)return["xsj_config_application","xsj_config_editor","xsj_config_preview","xsj_config_stores"].indexOf(t._id)>=0?(D=!0,u(t),void(D=!1)):("theme"===t.type&&(n=i.getApplicationProfileModel().get("themeInfo"))&&n.indexOf(t._id)>0&&$(window).trigger("refreshTheme"),"system_user_avatar"===t._id?$(window).trigger("refreshAvatar"):void 0)}))},initStart:function(){var e,t,n,i;return e=function(e){var t;if(e){try{e=JSON.stringify(e)}catch(e){t=e,console.log(t)}return a.showMessage("\u540c\u6b65\u670d\u52a1\u542f\u52a8\u5931\u8d25"+e,6e3,"error"),r.trigger("fault",e)}},i=j.get("user"),(n=j.get("token"))&&i&&(r.initDBChangesListeners(),(t=i.configSyncLive||!1)&&i.vip&&r.startConfigSyncCouchdb(e)),j.on("change:user",(function(o,a){return i=j.get("user"),n=j.get("token"),t=i.configSyncLive||!1,n&&i&&i.vip&&t?r.startConfigSyncCouchdb(e):r.stopSyncCouchdb()}))},getConfigDB:function(){return w},exportConfig:function(e){return w.allDocs({include_docs:!0,keys:["xsj_config_application","xsj_config_editor","xsj_config_preview","xsj_config_stores"]},(function(t,n){var i;return i={},t||n.rows.forEach((function(e,t){var n,r,o,a,s,l;if((r=e.doc)&&r._id){if("xsj_config_stores"===r._id)return i[r._id]={plugin:r.plugin,resourcePluginId:r.resourcePluginId,stores:r.stores};if(s=P[r._id]){for(o in n={},a=r.config)l=a[o],v(o,s)&&(n[o]=l);return i[r._id]=n}}})),e(t,i)}))},importConfig:function(e,t){return w.allDocs({include_docs:!0,keys:["xsj_config_application","xsj_config_editor","xsj_config_preview","xsj_config_stores"]},(function(n,i){var r;r=[],n?t(n):(i.rows.forEach((function(t,n){var i,o;if(o=e[t.key])return i={_id:t.key},t.doc&&(i._rev=t.doc._rev),"xsj_config_stores"===t.key?i=Object.assign(i,o):i.config=o,r.push(i)})),w.bulkDocs(r,t))}))},stopSyncCouchdb:function(e){return T(),setTimeout((function(){return"function"==typeof e?e():void 0}),10)},replicateToCouchdb:function(e){var t,n,i;return i=j.get("user"),n=j.get("token"),t=r.getTargetDB(),n&&i&&i.vip&&t?w.replicate.to(t,{doc_ids:["xsj_config_application","xsj_config_editor","xsj_config_preview","xsj_config_stores"],batch_size:1}).then((function(){return e()})).catch((function(t){return t=x(t),e(t)})):e("\u60a8\u8fd8\u4e0d\u662f\u4f1a\u5458\u7528\u6237\uff0c\u65e0\u6cd5\u4f7f\u7528\u6570\u636e\u5e93\u540c\u6b65\u529f\u80fd")},replicateFromCouchdb:function(e){var t,n,i;return i=j.get("user"),n=j.get("token"),t=r.getTargetDB(),n&&i&&i.vip&&t?w.replicate.from(t,{batch_size:1,doc_ids:["xsj_config_application","xsj_config_editor","xsj_config_preview","xsj_config_stores"]}).then((function(){return e()})).catch((function(t){return t=x(t),e(t)})):e("\u60a8\u8fd8\u4e0d\u662f\u4f1a\u5458\u7528\u6237\uff0c\u65e0\u6cd5\u4f7f\u7528\u6570\u636e\u5e93\u540c\u6b65\u529f\u80fd")},getTargetDB:function(){var e,t,n;return"mac"===(t=j.get("token"))&&(t=""),e=(n=j.get("user")).id,t&&n&&n.vip?new PouchDB("user_config_"+e,{prefix:o.dataHost+"/data/",fetch:function(e,n){return"mac"===(t=j.get("token"))&&(t=""),n.headers.set("access_token",t),PouchDB.fetch(e,n)}}):""},startConfigSyncCouchdb:function(e){var t,n,i;return i=j.get("user"),n=j.get("token"),t=r.getTargetDB(),n&&i&&i.vip&&t?(r.liveSyncCouchdb(w,t),e()):e("\u60a8\u8fd8\u4e0d\u662f\u4f1a\u5458\u7528\u6237\uff0c\u65e0\u6cd5\u4f7f\u7528\u6570\u636e\u5e93\u540c\u6b65\u529f\u80fd")},liveSyncCouchdb:function(e,t){var n,i;return null!=E&&E.cancel(),E=null,i=j.get("user"),0===(n=i.configSyncRange||[]).length&&(n=["xsj_config_application","xsj_config_editor","xsj_config_preview","xsj_config_stores"]),(E=e.sync(t,{live:!0,retry:!0,batch_size:1,since:0,filter:function(e){return["xsj_config_application","xsj_config_editor","xsj_config_preview","xsj_config_stores"].indexOf(e._id)>=0?n.indexOf(e._id)>=0:!e._id.startsWith("_design/")&&!e.isSys},conflicts:!0})).on("error",(function(e){return e=x(e),r.trigger("fault",e),E=null})),E.on("denied",(function(e){return e=x(e),r.trigger("denied",e)})),E.push.on("paused",(function(e){return e?(e=x(e),r.trigger("error",e)):r.trigger("synced")})),E.pull.on("paused",(function(e){return e?(e=x(e),r.trigger("error",e)):r.trigger("synced")})),E.pull.on("active",(function(){return r.trigger("syncing")})),E.push.on("active",(function(){return r.trigger("syncing")})),E.on("change",(function(){return r.trigger("synced")})),E.on("complete",(function(){return r.trigger("synced"),E=null}))}},_.extend(r,Backbone.Events),n.exports=r}}),window.requirejs.define({"lib/database_sync":function(e,t,n){var i,r,o,a,s,l,c,u,d,p,f,h,m,v,g,w,y,b;i=t("../constant"),t("../lib/utils"),t("../application"),o=t("../lib/notifier"),b=null,g=function(){return b&&(b.removeAllListeners(),b.pull.removeAllListeners(),b.push.removeAllListeners(),b.cancel()),b=null},l=function(e){if(e){if(e instanceof TypeError)e=e.toString();else try{e=JSON.stringify(e)}catch(t){t,console.log(e)}return e}},f=function(e,t){return e.get("_design/sync_index",(function(n,i){return w(e,i,t)}))},u=function(){return'{"_id":"_design/sync_index","views":{"get_recent_docs":{"map":"function (e){var t,n,i,r;if(\\"attachment\\"!==e.type&&0!==e._id.indexOf(\\"_design/\\")&&!e.isSys){n=e._attachments||{},r=[];for(i in n)t=n[i],\\"text/xsj-link\\"===t.content_type&&r.push(e._id+\\"__\\"+i);return emit([e.updateDate,e._id],r)}}"},"for_sync":{"map":"function (e){if(0!==e._id.indexOf(\\"_design/\\")&&!e.isSys)return emit([e.updateDate,e._id])}"}}}','{"_id":"_design/sync_index","views":{"get_recent_docs":{"map":"function (e){var t,n,i,r;if(\\"attachment\\"!==e.type&&0!==e._id.indexOf(\\"_design/\\")&&!e.isSys){n=e._attachments||{},r=[];for(i in n)t=n[i],\\"text/xsj-link\\"===t.content_type&&r.push(e._id+\\"__\\"+i);return emit([e.updateDate,e._id],r)}}"},"for_sync":{"map":"function (e){if(0!==e._id.indexOf(\\"_design/\\")&&!e.isSys)return emit([e.updateDate,e._id])}"}}}'},c=function(){var e,t;return e=function(e){if(0!==e._id.indexOf("_design/")&&!e.isSys)return emit([e.updateDate,e._id])},{_id:"_design/sync_index",views:{get_recent_docs:{map:function(e){var t,n,i;if("attachment"!==e.type&&0!==e._id.indexOf("_design/")&&!e.isSys){for(n in i=[],t=e._attachments||{})"text/xsj-link"===t[n].content_type&&i.push(e._id+"__"+n);return emit([e.updateDate,e._id],i)}}.toString()},for_sync:{map:e.toString()}}},t=u(),JSON.parse(t)},s=function(e){var t;return t=c(),!!(e&&e.views&&e.views.get_recent_docs&&e.views.get_recent_docs.map===t.views.get_recent_docs.map&&e.views.for_sync&&e.views.for_sync.map===t.views.for_sync.map)},w=function(e,t,n){var i;return i=c(),s(t)?n():(t&&t._rev&&(i._rev=t._rev),e.put(i,(function(e){return e=l(e),n(e)})))},p=function(e,t,n,i){var o;return o=function(n){return Promise.all([e.info(),t.info()]).then((function(o){var a,s,c,u;return a=o[0],u=o[1]||{},s=e.sync(t,{batch_size:1,doc_ids:n,since:0,checkpoint:!1}),c=uniqueNumber(),r.trigger("syncInfo",{id:c,type:"pullpush",docIds:n,state:"start",dbInfo:a,targetInfo:u,listeners:s}),["push","pull"].forEach((function(e){return s[e].on("checkpoint",(function(t){if(t.pending_batch)return r.trigger("syncInfo",{id:c,type:e,state:"processing",checkpointInfo:t,dbInfo:a,targetInfo:u})}))})),s.on("change",(function(e){return u.info||(u.info=e),r.trigger("syncInfo",{id:c,type:"pullpush",state:"syncing",info:e,dbInfo:a,targetInfo:u,listeners:s})})).then((function(e){return r.trigger("syncInfo",{id:c,state:"end",dbInfo:a}),i()})).catch((function(e){var t;return t=l(e),r.trigger("syncInfo",{id:c,state:"fault",dbInfo:a,error:t}),i(t)}))})).catch((function(e){return e=l(e),i(e)}))},d(e,t,[],n,(function(e,t){return e?i(e):t&&t.length>0?o(t):i()}))},d=function(e,t,n,i,r){return n=n||[],t.query("sync_index/get_recent_docs",{limit:i,include_docs:!1,conflicts:!0,descending:!0,reduce:!1,group:!1}).then((function(e){return e.rows.length>0&&e.rows.forEach((function(e,t){return(e.value||[]).forEach((function(e,t){return n.push(e)})),n.push(e.id)})),r(null,n)})).catch((function(e){return r(l(e))}))},h=function(e,t,n,i){return d(e,t,[],n,(function(r,o){return r?i(r):m(e,t,o,n,(function(n){var r;return n?i(n):((r=e.sync(t,{batch_size:1,doc_ids:o,since:0,checkpoint:!1})).on("denied",(function(e){return console.log("denied::::",e)})),r.then((function(e){return i()})).catch((function(e){return i(e)})))}))}))},m=function(e,t,n,i,r){return n=n||[],e.query("query_index/by_updatedate_for_sync",{limit:i,include_docs:!1,conflicts:!1,descending:!0,reduce:!1,group:!1}).then((function(e){return e.rows.length>0&&e.rows.forEach((function(e,t){return(e.value||[]).forEach((function(e,t){return n.push(e)})),n.push(e.id)})),r(null,n)})).catch((function(e){return r(l(e))}))},v=function(e,t,n,i){var o;return o=function(n){return Promise.all([e.info(),t.info()]).then((function(o){var a,s,c,u;return a=o[0],u=o[1]||{},s=e.sync(t,{batch_size:1,doc_ids:n,since:0,checkpoint:!1}),c=uniqueNumber(),r.trigger("syncInfo",{id:c,type:"pullpush",docIds:n,state:"start",dbInfo:a,targetInfo:u,listeners:s}),["push","pull"].forEach((function(e){return s[e].on("checkpoint",(function(t){if(t.pending_batch)return r.trigger("syncInfo",{id:c,type:e,state:"processing",checkpointInfo:t,dbInfo:a,targetInfo:u})}))})),s.on("change",(function(e){return u.info||(u.info=e),r.trigger("syncInfo",{id:c,type:"pullpush",state:"syncing",info:e,dbInfo:a,targetInfo:u,listeners:s})})).then((function(e){return r.trigger("syncInfo",{id:c,state:"end",dbInfo:a}),i()})).catch((function(e){return e=l(e),r.trigger("syncInfo",{id:c,state:"fault",dbInfo:a,error:e}),i(e)}))}))},m(e,t,[],n,(function(e,t){return e?i(e):t&&t.length>0?o(t):i()}))},y=null,a=null,r={init:function(e,t){var n,i,s,l;return y=e,s=(a=t).get("databaseSyncType"),(l=y.get("user"))&&l.vip||(s="local"),i=a.get("databaseCustomSyncLive")||!1,n=function(e){var t;if(e){try{e=JSON.stringify(e)}catch(e){t=e,console.log(t)}return o.showMessage("\u540c\u6b65\u670d\u52a1\u542f\u52a8\u5931\u8d25"+e,6e3,"error"),r.trigger("fault",e)}},"local"!==s&&"xsj"!==s&&"custom"!==s&&(s="local"),"xsj"===s?r.startXSJSyncCouchdb(n):"custom"===s&&i&&r.startCustomSyncCouchdb(n),y.on("change:token",(function(e,t,o){var c;if(l=y.get("user"),c=y.get("token"),s=a.get("databaseSyncType"),l&&l.vip||(s="local"),i=a.get("databaseCustomSyncLive")||!1,"local"!==s&&"xsj"!==s&&"custom"!==s&&(s="local"),!c)return r.stopSyncCouchdb();if(l&&l.vip){if("xsj"===s)return r.startXSJSyncCouchdb(n);if("custom"===s&&i)return r.startCustomSyncCouchdb(n)}})),$(window).on("online",(function(){return r.trigger("online")})),$(window).on("offline",(function(){return r.trigger("offline")}))},getDDocStr:function(){return u()},checkPouchDBViewIsSame:function(e,t){var n;return e||(e=r.getTargetDB())||t("\u60a8\u8fd8\u6ca1\u6709\u914d\u7f6e\u81ea\u5b9a\u4e49\u670d\u52a1\u5668\u5730\u5740"),n=y.get("user"),y.get("token")&&n&&n.vip?e.get("_design/sync_index",(function(e,n){var i;return i=s(n),t(e,i)})):t("\u60a8\u8fd8\u4e0d\u662f\u4f1a\u5458\u7528\u6237\uff0c\u65e0\u6cd5\u4f7f\u7528\u6570\u636e\u5e93\u540c\u6b65\u529f\u80fd")},stopSyncCouchdb:function(e){return g(),setTimeout((function(){return"function"==typeof e?e():void 0}),10)},startFullSyncCouchdb:function(e,t){var n,o,a;return e||(e=r.getTargetDB())||t("\u60a8\u8fd8\u6ca1\u6709\u914d\u7f6e\u81ea\u5b9a\u4e49\u670d\u52a1\u5668\u5730\u5740"),a=y.get("user"),o=y.get("token"),n=i.pouchDB,o&&a&&a.vip?f(e,(function(i){return i?t(i):Promise.all([n.info(),e.info()]).then((function(i){var o,a,s,c;return o=i[0],c=i[1]||{},a=PouchDB.sync(n,e,{query_params:{uid:"fullsync"},batch_size:1,pull:{filter:"_view",view:"sync_index/for_sync"},push:{filter:function(e){return!e._id.startsWith("_design/")&&!e.isSys}}}),s=uniqueNumber(),r.trigger("syncInfo",{id:s,type:"pullpush",state:"start",dbInfo:o,targetInfo:c,listeners:a}),a.on("change",(function(e){return c.info||(c.info=e),r.trigger("syncInfo",{id:s,type:"pullpush",state:"syncing",dbInfo:o,targetInfo:c,listeners:a,info:e})})).then((function(){return a=null,r.trigger("syncInfo",{id:s,state:"end",dbInfo:o}),t()})).catch((function(e){return e=l(e),r.trigger("syncInfo",{id:s,state:"fault",dbInfo:o,error:e}),t(e)}))})).catch((function(e){return e=l(e),t(e)}))})):t("\u60a8\u8fd8\u4e0d\u662f\u4f1a\u5458\u7528\u6237\uff0c\u65e0\u6cd5\u4f7f\u7528\u6570\u636e\u5e93\u540c\u6b65\u529f\u80fd")},startFullReplicateToCouchdb:function(e){var t,n,o,a;return(n=r.getTargetDB())||e("\u60a8\u8fd8\u6ca1\u6709\u914d\u7f6e\u81ea\u5b9a\u4e49\u670d\u52a1\u5668\u5730\u5740"),a=y.get("user"),o=y.get("token"),t=i.pouchDB,o&&a&&a.vip?Promise.all([t.info(),n.info()]).then((function(i){var o,a,s,c;return o=i[0],c=i[1]||{},a=t.replicate.to(n,{batch_size:1,since:0,checkpoint:!1,query_params:{uid:uniqueNumber()},filter:function(e){return!e._id.startsWith("_design/")&&!e.isSys}}),s=uniqueNumber(),r.trigger("syncInfo",{id:s,type:"push",state:"start",dbInfo:o,targetInfo:c,listeners:a}),a.on("checkpoint",(function(e){if(e.pending_batch)return r.trigger("syncInfo",{id:s,type:"push",state:"processing",checkpointInfo:e,dbInfo:o,targetInfo:c})})),a.on("change",(function(e){return c.info||(c.info=e),r.trigger("syncInfo",{id:s,type:"push",state:"syncing",info:e,dbInfo:o,targetInfo:c,listeners:a})})).then((function(){return r.trigger("syncInfo",{id:s,state:"end",dbInfo:o}),e()})).catch((function(t){return t=l(t),r.trigger("syncInfo",{id:s,state:"fault",dbInfo:o,error:t}),e(t)}))})).catch((function(t){return t=l(t),e(t)})):e("\u60a8\u8fd8\u4e0d\u662f\u4f1a\u5458\u7528\u6237\uff0c\u65e0\u6cd5\u4f7f\u7528\u6570\u636e\u5e93\u540c\u6b65\u529f\u80fd")},startFullReplicateFromCouchdb:function(e){var t,n,o,s,c;return c=y.get("user"),s=y.get("token"),"xsj"===a.get("databaseSyncType")?(n=c.id,o=new PouchDB("user_"+n,{prefix:i.dataHost+"/data/",fetch:function(e,t){return t.headers.set("access_token",s),PouchDB.fetch(e,t)}})):o=r.getTargetDB(),o||e("\u60a8\u8fd8\u6ca1\u6709\u914d\u7f6e\u81ea\u5b9a\u4e49\u670d\u52a1\u5668\u5730\u5740"),t=i.pouchDB,s&&c&&c.vip?Promise.all([t.info(),o.info()]).then((function(n){var i,a,s,c;return i=n[0],c=n[1]||{},a=t.replicate.from(o,{batch_size:1,since:0,checkpoint:!1,query_params:{uid:uniqueNumber()},filter:"_view",view:"sync_index/for_sync"}),s=uniqueNumber(),r.trigger("syncInfo",{id:s,type:"pull",state:"start",dbInfo:i,targetInfo:c,listeners:a}),a.on("checkpoint",(function(e){if(e.pending_batch)return r.trigger("syncInfo",{id:s,type:"pull",state:"processing",checkpointInfo:e,dbInfo:i,targetInfo:c})})),a.on("change",(function(e){return c.info||(c.info=e),r.trigger("syncInfo",{id:s,type:"pull",state:"syncing",info:e,dbInfo:i,targetInfo:c})})).then((function(){return r.trigger("syncInfo",{id:s,state:"end",dbInfo:i}),e()})).catch((function(t){return t=l(t),r.trigger("syncInfo",{id:s,state:"fault",dbInfo:i,error:t}),e(t)}))})).catch((function(t){return t=l(t),e(t)})):e("\u60a8\u8fd8\u4e0d\u662f\u4f1a\u5458\u7528\u6237\uff0c\u65e0\u6cd5\u4f7f\u7528\u6570\u636e\u5e93\u540c\u6b65\u529f\u80fd")},replicateToCountDocs:function(e,t){var n,o,a,s;return null==e&&(e=10),(o=r.getTargetDB())||t("\u60a8\u8fd8\u6ca1\u6709\u914d\u7f6e\u81ea\u5b9a\u4e49\u670d\u52a1\u5668\u5730\u5740"),s=y.get("user"),a=y.get("token"),n=i.pouchDB,a&&s&&s.vip?v(n,o,e,t):t("\u60a8\u8fd8\u4e0d\u662f\u4f1a\u5458\u7528\u6237\uff0c\u65e0\u6cd5\u4f7f\u7528\u6570\u636e\u5e93\u540c\u6b65\u529f\u80fd")},replicateFromCountDocs:function(e,t){var n,o,a,s;return null==e&&(e=10),(o=r.getTargetDB())||t("\u60a8\u8fd8\u6ca1\u6709\u914d\u7f6e\u81ea\u5b9a\u4e49\u670d\u52a1\u5668\u5730\u5740"),s=y.get("user"),a=y.get("token"),n=i.pouchDB,a&&s&&s.vip?f(o,(function(i){return i?t(i):p(n,o,e,t)})):t("\u60a8\u8fd8\u4e0d\u662f\u4f1a\u5458\u7528\u6237\uff0c\u65e0\u6cd5\u4f7f\u7528\u6570\u636e\u5e93\u540c\u6b65\u529f\u80fd")},getTargetDB:function(){var e,t,n,i,r,o;return(i=a.get("databaseCustomSyncUrl"))?(r=a.get("databaseCustomSyncUsername")||"",n=a.get("databaseCustomSyncPassword")||"",o=a.get("databaseCustomSyncWithCredentials"),r=$.trim(r),n=$.trim(n),t={},r&&(e={username:r,password:n},t.auth=e),t.fetch=function(e,t){return o&&(t.credentials="include"),PouchDB.fetch(e,t)},new PouchDB(i,t)):null},startCustomSyncCouchdb:function(e){var t,n,o,s,l;return l=y.get("user"),s=y.get("token"),t=i.pouchDB,s&&l&&l.vip?(o=r.getTargetDB(),n=a.get("databaseCustomSyncLiveMax")||"10",a.get("databaseCustomSyncLiveFull")&&"client"===STORY_PLATFORM&&(n=-1),o?r.startSyncCouchdb(t,o,n,e):e("\u6ca1\u6709\u914d\u7f6e\u6570\u636e\u5e93\u5730\u5740")):e("\u60a8\u8fd8\u4e0d\u662f\u4f1a\u5458\u7528\u6237\uff0c\u65e0\u6cd5\u4f7f\u7528\u6570\u636e\u5e93\u540c\u6b65\u529f\u80fd")},startXSJSyncCouchdb:function(e){var t,n,o,a,s;return s=y.get("user"),a=y.get("token"),t=i.pouchDB,a&&s&&s.vip?(n=s.id,o=new PouchDB("user_"+n,{prefix:i.dataHost+"/data/",fetch:function(e,t){return t.headers.set("access_token",a),PouchDB.fetch(e,t)}}),r.startSyncCouchdb(t,o,10,e)):e("\u60a8\u8fd8\u4e0d\u662f\u4f1a\u5458\u7528\u6237\uff0c\u65e0\u6cd5\u4f7f\u7528\u6570\u636e\u5e93\u540c\u6b65\u529f\u80fd")},resetXSJDBDatabase:function(e,t){var n,s,l,c,u;return c=(s=y).get("user"),(l=s.get("token"))?(n=a.get("databaseSyncType"),c&&c.vip||(n="local"),"xsj"===n&&r.stopSyncCouchdb(),u=function(e){return"xsj"===n&&r.startXSJSyncCouchdb(),t(e)},function(e){return $.ajax({url:i.apiHost+"/api/users/"+c.id+"/resetDBDefault",method:"POST",data:{type:"database"},headers:{Authorization:l}}).done((function(){return e()})).fail((function(t,n,i){var r,o;return r="\u91cd\u7f6e\u670d\u52a1\u5668\u914d\u7f6e\u51fa\u9519",r=(o=t.responseJSON)&&o.error?(o=o.error).message:t.responseText?t.responseText:i,e(r)}))}((function(t){return t?(o.showMessage("\u63d0\u4ea4\u51fa\u9519:"+t,6e3,"error"),u(t)):e?i.pouchDB.destroy().then((function(){return o.showMessage("\u5220\u9664\u6210\u529f, \u8bf7\u91cd\u542f\u5c0f\u4e66\u5320",3e3,"info"),alert("\u5220\u9664\u6210\u529f,\u7cfb\u7edf\u5c06\u91cd\u65b0\u542f\u52a8"),"client"!==STORY_PLATFORM?document.location.reload():global.restartXSJApp()})).catch((function(e){return o.showMessage("\u5220\u9664\u5931\u8d25: "+e,6e3,"error"),u(e)})):(o.showMessage("\u5220\u9664\u6210\u529f"),u())}))):t("\u672a\u767b\u5f55")},startSyncCouchdb:function(e,t,n,i){return null==n&&(n=10),r.trigger("syncing"),f(t,(function(a){var s;return a?(a=l(a),i(a)):i(),r.trigger("synced"),s="now",-1===n?s=0:(r.trigger("syncing"),h(e,t,n,(function(e){return e?(console.error(e),e=l(e),o.showMessage("\u540c\u6b65\u5931\u8d25\uff1a"+e,6e3,"error")):r.trigger("synced")}))),r.liveSyncCouchdb(e,s,t)}))},syncSpecDocIds:function(e,t){var n,o,s,c,u;return u=y.get("user"),c=y.get("token"),"xsj"===a.get("databaseSyncType")?(o=u.id,s=new PouchDB("user_"+o,{prefix:i.dataHost+"/data/",fetch:function(e,t){return t.headers.set("access_token",c),PouchDB.fetch(e,t)}})):s=r.getTargetDB(),s||t("\u60a8\u8fd8\u6ca1\u6709\u914d\u7f6e\u81ea\u5b9a\u4e49\u670d\u52a1\u5668\u5730\u5740"),n=i.pouchDB,c&&u&&u.vip?Promise.all([n.info(),s.info()]).then((function(i){var o,a,l,c;return o=i[0],c=i[1]||{},a=n.sync(s,{batch_size:1,since:0,doc_ids:e,checkpoint:!1}),l=uniqueNumber(),r.trigger("syncInfo",{id:l,type:"pullpush",docIds:e,state:"start",dbInfo:o,targetInfo:c,listeners:a}),["push","pull"].forEach((function(e){return a[e].on("checkpoint",(function(t){if(t.pending_batch)return r.trigger("syncInfo",{id:l,type:e,state:"processing",checkpointInfo:t,dbInfo:o,targetInfo:c})}))})),a.on("change",(function(e){return c.info||(c.info=e),r.trigger("syncInfo",{id:l,type:"pullpush",state:"syncing",info:e,dbInfo:o,targetInfo:c,listeners:a})})).then((function(e){return r.trigger("syncInfo",{id:l,state:"end",dbInfo:o}),t()})).catch((function(e){return r.trigger("syncInfo",{id:l,state:"fault",dbInfo:o,error:e}),t(e)}))})).catch((function(e){return e=l(e),t(e)})):t("\u60a8\u8fd8\u4e0d\u662f\u4f1a\u5458\u7528\u6237\uff0c\u65e0\u6cd5\u4f7f\u7528\u6570\u636e\u5e93\u540c\u6b65\u529f\u80fd")},pullAndPushRecentCountDocs:function(e,t){var n,o,a,s;return(o=r.getTargetDB())||t("\u60a8\u8fd8\u6ca1\u6709\u914d\u7f6e\u81ea\u5b9a\u4e49\u670d\u52a1\u5668\u5730\u5740"),s=y.get("user"),a=y.get("token"),n=i.pouchDB,a&&s&&s.vip?h(n,o,e,t):t("\u60a8\u8fd8\u4e0d\u662f\u4f1a\u5458\u7528\u6237\uff0c\u65e0\u6cd5\u4f7f\u7528\u6570\u636e\u5e93\u540c\u6b65\u529f\u80fd")},liveSyncCouchdb:function(e,t,n){return null==t&&(t="now"),g(),(b=e.sync(n,{batch_size:1,live:!0,retry:!0,since:t,conflicts:!0,push:{filter:function(e){return!e._id.startsWith("_design/")&&!e.isSys}},pull:{filter:"_view",view:"sync_index/for_sync"}})).catch((function(e){return e=l(e),r.trigger("error",e)})),b.on("error",(function(e){return e=l(e),r.trigger("fault",e),b=null})),b.on("denied",(function(e){return e=l(e),r.trigger("denied",e)})),b.push.on("paused",(function(e){return e?(e=l(e),r.trigger("error",e)):r.trigger("synced")})),b.pull.on("paused",(function(e){if(e){if("ETIMEDOUT"===e.code)return;return e=l(e),r.trigger("error",e)}return r.trigger("synced")})),b.pull.on("active",(function(){return r.trigger("syncing")})),b.push.on("active",(function(){return r.trigger("syncing")})),b.on("change",(function(){return r.trigger("synced")})),b.on("complete",(function(){return r.trigger("synced"),b=null}))}},_.extend(r,Backbone.Events),n.exports=r}}),window.requirejs.define({"lib/default_xsj_commands":function(e,t,n){var i,r;i=t("./notifier"),r=t("./utils"),n.exports={newFile:{name:"newFile",shortcuts:["ctrl+shift+r"],fn:function(e,t){return t&&(t.stopPropagation(),t.preventDefault()),$(window).trigger("newFileModel")}},save:{name:"save",shortcuts:["ctrl+s"],fn:function(e,t){return t&&(t.stopPropagation(),t.preventDefault()),$(window).trigger("saveFileModel")}},saveInternal:{name:"saveInternal",fn:function(e,t){return t&&(t.stopPropagation(),t.preventDefault()),$(window).trigger("saveFileModel",!0)}},saveAs:{name:"save as",shortcuts:["ctrl+shift+s"],fn:function(e,t){return t&&(t.stopPropagation(),t.preventDefault()),$(window).trigger("saveAsFileModel")}},zoomIn:{name:"zoom in",range:"all",shortcuts:[{codeMirrorValue:"ctrl-=",value:"ctrl+="}],fn:function(e,t){if("client"===STORY_PLATFORM)return t&&(t.stopPropagation(),t.preventDefault()),$(window).trigger("clientZoomLevel",[.25,!0])}},zoomOut:{name:"zoom out",range:"all",shortcuts:[{codeMirrorValue:"ctrl--",value:"ctrl+-"}],fn:function(e,t){if("client"===STORY_PLATFORM)return t&&(t.stopPropagation(),t.preventDefault()),$(window).trigger("clientZoomLevel",[-.25,!0])}},resetZoom:{name:"reset zoom",range:"all",fn:function(e,t){if("client"===STORY_PLATFORM)return t&&(t.stopPropagation(),t.preventDefault()),$(window).trigger("clientZoomLevel",[0,!1])}},preview:{name:"preview",shortcuts:["ctrl+shift+p"],fn:function(e,t){return t&&(t.stopPropagation(),t.preventDefault()),$(window).trigger("togglePreview")}},zenWriter:{name:"zen writer",shortcuts:["ctrl+shift+1"],fn:function(e,t){return t&&(t.stopPropagation(),t.preventDefault()),$(window).trigger("toggleEditorZenMode",!0)}},zenReader:{name:"zen reader",shortcuts:["ctrl+shift+2"],fn:function(e,t){return t&&(t.stopPropagation(),t.preventDefault()),$(window).trigger("togglePreviewZenMode",!0)}},toggleSidebar:{name:"toggle sidebar",shortcuts:["ctrl+shift+b"],fn:function(e,t){return t&&(t.stopPropagation(),t.preventDefault()),e.sidebarView.$el.sidebar("toggle")}},toggleOnlyPreview:{name:"toggle only preview mode",fn:function(e,t){return $(window).trigger("toggleOnlyPreviewMode")}},toggleStore:{name:"toggle store",shortcuts:["ctrl+shift+f"],fn:function(e,t){return t&&(t.stopPropagation(),t.preventDefault()),$(window).trigger("toggleStore")}},preventDefault:{name:"prevent default",fn:function(e,t){t&&(t.stopPropagation(),t.preventDefault())}},passToDefault:{name:"pass to default",fn:function(e,t){}},exportFiles:{name:"export files",fn:function(e,t){return t&&(t.stopPropagation(),t.preventDefault()),$(window).trigger("exportFileModel")}},toggleEditorTocPanel:{name:"toggle editor toc panel",fn:function(e,t){return t&&(t.stopPropagation(),t.preventDefault()),$(window).trigger("execCommand",["toggleEditorTocPanel"])}},togglePreviewTocPanel:{name:"toggle preview toc panel",fn:function(e,t){return t&&(t.stopPropagation(),t.preventDefault()),$(window).trigger("execCommand",["togglePreviewTocPanel"])}},toggleVimMode:{name:"toggle vim mode",fn:function(e,t){var n;switch(t&&(t.stopPropagation(),t.preventDefault()),(n=e.getEditorProfileModel()).get("editorType")){case"ace":return"vim"!==n.get("keyBinding")?n.save({keyBinding:"vim"}):n.save({keyBinding:"ace"});case"codemirror":return"vim"!==n.get("cm_keyBinding")?n.save({cm_keyBinding:"vim"}):n.save({cm_keyBinding:"default"})}}},toggleEmacsMode:{name:"toggleEmacsMode",fn:function(e,t){var n;switch(t&&(t.stopPropagation(),t.preventDefault()),(n=e.getEditorProfileModel()).get("editorType")){case"ace":return"emacs"!==n.get("keyBinding")?n.save({keyBinding:"emacs"}):n.save({keyBinding:"ace"});case"codemirror":return"emacs"!==n.get("cm_keyBinding")?n.save({cm_keyBinding:"emacs"}):n.save({cm_keyBinding:"default"})}}},toggleFileListPanel:{name:"toggle file list panel",shortcuts:["ctrl+left"],fn:function(e,t){var n,i,r;if(t&&(t.stopPropagation(),t.preventDefault()),"west",i=(n=e.homeView.layout).options,r=n.state,i.west.closable&&!r.west.isHidden)return n.toggle("west")}},toggleToolPanel:{name:"toggle north panel",shortcuts:["ctrl+up"],fn:function(e,t){var n;return t&&(t.stopPropagation(),t.preventDefault()),"north",(n=e.homeView.layout).options,n.state,n.toggle("north")}},insertSnippet:{name:"insert snippet",fn:function(e,t,n){var i,r;return t&&(t.stopPropagation(),t.preventDefault()),r="",n.args&&(i=n.args.split(/\s+/)).length>0&&(r=i[0]),e.homeView.editorView.getActiveEditorView().insertSnippet(r)}},setFileModelAttribute:{name:"set file attribute",fn:function(e,t,n){var o,a,s,l,c,u,d,p,f,h;return t&&(t.stopPropagation(),t.preventDefault()),(o=this.fn).isProcessing?i.showMessage("\u7a0b\u5e8f\u6b63\u5728\u6267\u884c\u4e2d....",6e3,"error"):(o.isProcessing=!0,h=(d=e.homeView).storeView,(f=(u=h.fileBrowserView).getSelectedFileModels())&&0!==f.length||(f=d.fileModel?[d.fileModel]:[]),0===f.length?(i.showMessage("\u60a8\u8fd8\u6ca1\u6709\u9009\u62e9\u4efb\u4f55\u6587\u4ef6",6e3,"error"),void(o.isProcessing=!1)):(s=n.args.split(/\s+/)).length>=2?(l=s[0],c=s[1],"tags"===l&&(l="tagNames"),"tagNames"!==l&&"category"!==l&&"flag"!==l?(i.showMessage("\u76ee\u524d\u4ec5\u652f\u6301\u4fee\u6539 tags, category, flag \u4e09\u4e2a\u5c5e\u6027",6e3,"error"),void(o.isProcessing=!1)):(u.$dimmer.dimmer("show"),a=function(e,t){var n,o,a,s,u;return u=_.escape(e.get("title")),n=e.get("content"),"tagNames"===(o=l)&&(o="tags"),a=r.setMetaData(n,o,c,!0),s={},c?"tags"===o&&!attribute instanceof Array&&"string"==typeof attribute?s[l]=c.split(","):s[l]=c:s[l]="tags"===o?[]:"",n!==a&&(s.content=a),e.save(s,{force:!0,success:function(){return i.showMessage("\u4fee\u6539\u6587\u4ef6\u300a"+u+"\u300b\u6210\u529f"),t()},error:function(e){return i.showMessage("\u4fee\u6539\u6587\u4ef6\u300a"+u+"\u300b\u5931\u8d25:"+e,6e3,"error"),t()}})},p=function(e,t){return u.$dimmer.dimmer("hide"),i.showMessage("\u4fee\u6539\u5b8c\u6210"),u.refreshFilterFiles(),o.isProcessing=!1},async.mapLimit(f,20,a,p))):(i.showMessage("\u547d\u4ee4\u9ed8\u8ba4\u53c2\u6570\u4e0d\u7b26\u5408\u8981\u6c42",6e3,"error"),void(o.isProcessing=!1)))}}}}}),window.requirejs.define({"lib/dynamic_import/import_beautify":function(e,t,n){var i;i=t("../utils"),n.exports=function(e){return i.asyncLoadResources([{id:"beautify_js",type:"script",filename:"js/beautify/beautify.js"}],(function(){return"function"==typeof e?e():void 0}))}}}),window.requirejs.define({"lib/dynamic_import/import_blueimp_gallery":function(e,t,n){var i;i=t("../utils"),n.exports=function(e){return i.asyncLoadResources([{id:"blueimp_gallery_js",type:"script",filename:"js/blueimp/blueimp_gallery.js"},{id:"blueimp_gallery_css",type:"style",filename:"js/blueimp/blueimp_gallery.css"}],(function(){return"function"==typeof e?e():void 0}))}}}),window.requirejs.define({"lib/dynamic_import/import_calendar":function(e,t,n){var i;i=t("../utils"),n.exports=function(e){return i.asyncLoadResources([{id:"fomanticui_calendar_js",type:"script",filename:"js/fomanticui/calendar.js"},{id:"fomanticui_calendar_css",type:"style",filename:"js/fomanticui/calendar.css"}],(function(){return"function"==typeof e?e():void 0}))}}}),window.requirejs.define({"lib/dynamic_import/import_fancytree":function(e,t,n){var i;i=t("../utils"),n.exports=function(e){return i.asyncLoadResources([{id:"jquery_fancytree_js",type:"script",filename:"js/fancytree/fancytree.js"},{id:"jquery_fancytree_css",type:"style",filename:"js/fancytree/fancytree.css"}],(function(){return"function"==typeof e?e():void 0}))}}}),window.requirejs.define({"lib/dynamic_import/import_flatpickr":function(e,t,n){var i;i=t("../utils"),n.exports=function(e){return i.asyncLoadResources([{id:"flatpickr_js",type:"script",filename:"js/flatpickr/flatpickr.js"},{id:"flatpickr_css",type:"style",filename:"js/flatpickr/flatpickr.css"}],(function(){return"function"==typeof e?e():void 0}))}}}),window.requirejs.define({"lib/dynamic_import/import_highlight":function(e,t,n){var i;i=t("../utils"),n.exports=function(e){return i.asyncLoadResources([{id:"highlight_js",type:"script",filename:"js/highlight.js"}],(function(){var t,n,i,r,o,a,s,l,c,u;for(t=hljs.listLanguages,r=[],o=0,l=(u=t()).length;o<l;o++)if(s=u[o],r.push(s),i=hljs.getLanguage(s).aliases)for(a=0,c=i.length;a<c;a++)n=i[a],r.push(n);return hljs.listLanguages=function(e){return null==e&&(e=!1),e?r:t()},"function"==typeof e?e():void 0}))}}}),window.requirejs.define({"lib/dynamic_import/import_parse_depence":function(e,t,n){var i;i=t("../utils"),n.exports=function(e){return i.asyncLoadResources([{id:"parse_js",type:"script",filename:"js/parse/parse_depence.js"},{id:"rangy_js",type:"script",filename:"js/rangy/rangy.js"}],(function(){return rangy.init(),e()}))}}}),window.requirejs.define({"lib/dynamic_import/import_plugin_depence":function(e,t,n){var i;i=t("../utils"),n.exports=function(e){return i.asyncLoadResources([{id:"plugins_js",type:"script",filename:"js/plugins.js"},{id:"vendor_plugins_js",type:"script",filename:"js/vendor-plugins.js"}],(function(){return"function"==typeof e?e():void 0}))}}}),window.requirejs.define({"lib/dynamic_import/import_pouchdb_replication_stream":function(e,t,n){var i;i=t("../utils"),n.exports=function(e){return i.asyncLoadResources([{id:"replication_stream_js",type:"script",filename:"js/pouchdb/pouchdb.replication-stream.js"},{id:"file_reader_stream_js",type:"script",filename:"js/pouchdb/file-reader-stream.js"},{id:"xsj_stream_js",type:"script",filename:"js/pouchdb/xsj-stream.js"}],e)}}}),window.requirejs.define({"lib/dynamic_import/import_zen_background_depence":function(e,t,n){var i;i=t("../utils"),n.exports=function(e){return i.asyncLoadResources([{id:"zen_background_depence_js",type:"script",filename:"js/zen/zen_background_depence.js"}],(function(){return"function"==typeof e?e():void 0}))}}}),window.requirejs.define({"lib/editor/autopreview/category_manager":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<div class="category_manager_form_container">\n<div class="ui form sticky">\n<div class="field">\n<div class="ui fluid labeled icon input">\n<div class="ui label parent_path">/</div>\n<input type="text" name="category" placeholder="\u5c0f\u4e66\u5320/\u7b14\u8bb0(\u5c42\u7ea7\u4e4b\u95f4\u7528\u7b26\u53f7 / \u5206\u5f00)">\n<i class="sitemap icon"></i>\n</div>\n</div>\n<div class="ui error message"></div>\n</div>\n<div class="category_tree_container theme_tree_container">\n<div class="category_tree_instance"></div>\n<div class="ui transition hidden dimmer">\n<div class="ui text loader">\u52a0\u8f7d\u4e2d</div>\n</div>\n</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"lib/editor/autopreview/category_manager_view":function(e,t,n){var i,r,o,a,s,l,c,u={}.hasOwnProperty;s=t("../../../views/view"),r=t("../../../constant"),t("../../../application"),o=t("../../notifier"),a=t("../../pouchdb_index_view_manager"),l=t("./category_manager"),c=null,i=function(e){var n;function i(){return i.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)u.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(i,e),i.prototype.template=l,i.prototype.className="category_manager_container",i.prototype.callbackFn=null,i.prototype.events={click:"selfClickFn"},i.prototype.categoryInputKeyPress=function(e){return 13===e.keyCode?c.destroy(!0):27===e.keyCode?c.destroy():void 0},i.prototype.selfClickFn=function(e){if(e.target===this.el)return this.destroy(!0)},i.prototype.initialize=function(e){return c=this,$(document).on("keydown",this.categoryInputKeyPress)},i.prototype.show=function(e,t,n){var i;return this.callbackFn=n,c.render(),i=e.getBoundingClientRect(),c.$el.css({position:"absolute",zIndex:500,left:0,right:0,top:0,bottom:0}),c.$el.find(".category_manager_form_container").css({position:"fixed",left:i.x,top:i.y,width:i.width-5,minHeight:i.height}),$("#main").append(c.$el),c.init(t)},n=function(e){return(e=e.replace(/\/{2,}/g,"/")).replace(/^\/|\/$/,"")},i.prototype.init=function(e){var i,s,l;return e=n(e),(i=c.$el.find("input[name=category]")).val(e),!1,this.$dimmer=this.$el.find(".dimmer"),this.$dimmer.dimmer({onShow:function(){return c.$dimmer.find(".ui.text").html("\u52a0\u8f7d\u4e2d")}}),this.$dimmer.dimmer("show"),l=function(e,t,n,i){if(c)return c.$dimmer.find(".ui.text").html("\u7d22\u5f15\u4e2d:"+e+" / "+t)},s=r.pouchDB,t("../../dynamic_import/import_fancytree")((function(){return a.getCategoryAndFlagView(s,(function(t,r){var a;return t?o.showMessage("\u52a0\u8f7d\u7d22\u5f15\u51fa\u9519:"+t,6e3,"error"):(a=r.viewName,s.query(a+"/by_category",{reduce:!0,group:!0,showUpdateProgressInfo:l}).then((function(t){var r,o,a,s,l,u,d;if(c)return c.$dimmer.dimmer("hide"),o=t.rows,r={},o.reduce((function(e,t){var n;return e[n=(n=t.key.replace(/^\/*|\/*$/g,"")).replace(/\/+/g,"/")]?e[n]+=t.value:e[n]=t.value,e}),r),s={},o.forEach((function(e){var t,n;return(t=e.key.replace(/^[\/]*|[\/]*$/g,"").replace(/\/+/g,"/").split(/[\/]/)).length,n=s,t.forEach((function(e,t){return n[e]||(n[e]={}),n=n[e]}))})),(l=function(e,t,n){var i,o,a,s,c,u;for(s in n&&(n+="/"),c=[],t)u=t[s],o=r[a=n+s],0===Object.keys(u).length?c.push(e.push({title:s,key:a,count:o,goto:!!o,folder:!1})):(i=[],e.push({title:s,key:a,count:o,goto:!!o,folder:!0,children:i}),c.push(l(i,u,a)));return c})((d={title:"\u6839\u76ee\u5f55",key:"/",children:[]}).children,s,""),a={click:function(e,t){var r;if(r=!0,t.node.folder&&("title"!==t.targetType?r=!1:(e.preventDefault(),e.stopPropagation())),r)return i.val(n(t.node.key))},extensions:["wide","glyph","filter"],filter:{mode:"dimm"},clickFolderMode:3,source:d,wide:{levelOfs:"20px"},glyph:{map:{doc:"far fa-folder",checkbox:"fa fa-square-o",checkboxSelected:"fa fa-check-square-o",checkboxUnknown:"fa fa-square",error:"fa fa-warning",expanderClosed:"fa fa-caret-right",expanderLazy:"fa fa-angle-right",expanderOpen:"fa fa-caret-down",folder:"far fa-folder",folderOpen:"far fa-folder-open",loading:"fa fa-spinner fa-pulse"}}},u=c.$el.find(".category_tree_instance").fancytree(a).data("uiFancytree").getTree(),e&&u.activateKey(e),!0})).catch((function(e){return c.$dimmer.dimmer("hide"),o.showMessage("\u52a0\u8f7d\u5217\u8868\u51fa\u9519:"+e,6e3,"error")})))}))})),i[0].focus(),i[0].select()},i.prototype.destroy=function(e){var t,i,r;return $(document).off("keydown",this.categoryInputKeyPress),e&&c&&this.callbackFn&&(t=c.$el.find("input[name=category]"),(i=n(t.val()))&&(i="/"+i),this.callbackFn(i)),r&&this.$el.find(".category_tree_instance").fancytree("destroy"),r=!1,c=null,this.remove()},i}(s),n.exports=i}}),window.requirejs.define({"lib/editor/autopreview/codemirror_autopreview":function(e,t,n){var i,r,o,a,s,l,c,u,d,p,f,h,m,v,g,_,w,y,b,x,k,D,C,$,F=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};f=t("./image_preview"),$=t("./todo_preview"),g=t("./mathjax_preview"),p=t("./html_preview"),_=t("./mermaid_preview"),l=t("./flow_preview"),k=t("./sequence_preview"),w=t("./plantuml_preview"),u=t("./header_preview"),h=t("./inline_preview"),d=t("./hr_preview"),v=t("./link_preview"),s=t("./file_yaml_preview"),a=t("./fenced_code_preview"),o=t("./emoji_preview"),D=t("./table_preview"),C=t("./toc_preview"),c=t("./footnote_preview"),x=t("./ruby_preview"),b=t("./quote_preview"),y={image:f,todolist:$,mathjax:g,html:p,mermaid:_,flow:l,sequence:k,plantUML:w,header:u,inline:h,hr:d,link:v,fileYaml:s,fencedCode:a,emoji:o,table:D,toc:C,footnote:c,ruby:x,quote:b},m=function(e,t){var n;return!((n={begin:e.getCursor("from"),end:e.getCursor("to")}).begin.line>t||n.end.line<t)},r=function(e,t,n,i){var r,o,a,s,l,c,u,d,p,f;if(r=e.doc,f=e.xsjApp,o=e.fileModel,l={resultConfig:{},previewSet:{}},o&&f&&(c=f.getPreviewProfileModel(),l=o.getPreviewConfig(f,c)),a=m(r,t),s=e.getLineTokens(t,!0)||[],u=function(e,t,n){var i,o,c,u,d,p,f,h,m;if(!n.isBlock||!a){if(n.regex){for(p=n.regex,u=n.marker,f=[];null!==(d=p.exec(t.text));)m={line:e,ch:(c={line:e,ch:d.index}).ch+d[0].length},(o=n.createElement(d,c,m,s,l))&&(u.replacedWith=o,(h=r.markText(c,m,u)).__autopreviewType=n.name,n.callback&&"function"==typeof n.callback&&h&&o?f.push(n.callback(h,o)):f.push(void 0));return f}return i=n.createElement(e,t,s,l),n.clearMarkers&&!1===i?n.clearMarkers(e,t,s):void 0}n.clearMarkers&&n.clearMarkers(e,t,s)},i&&0!==i.length){for(p in d=[],i)!0===i[p]&&y[p]?d.push(u(t,n,y[p](e))):d.push(void 0);return d}},i=function(){function e(e,t){this.cm=e,this.autopreviewTypes=t,this.isActive=!0}return e.prototype.autopreviewQueue=null,e.prototype.autopreviewTypes={},e.prototype.isActive=!1,e.prototype.cm=null,e.prototype.selectionLines=[],e.prototype.autopreviewInternal=function(e,t){var n,i;if(null==e&&(e=this.autopreviewTypes),i=(n=this.cm).doc.getLineHandle(t))return r(n,t,i,e)},e.prototype.getMarkers=function(e){return(this.cm.doc.getAllMarks()||[]).filter((function(t){return e?t.__autopreviewType===e:!!t.__autopreviewType}))},e.prototype.clearMarkers=function(e){var t;return t=this.getMarkers(e),this.cm.operation((function(){var e,n,i,r;for(r=[],e=0,n=t.length;e<n;e++)i=t[e],r.push(i.clear());return r}))},e.prototype.setSelectionLines=function(e){var t,n;return t=this,n=this.cm,this.cm.operation((function(){return t.selectionLines.forEach((function(t){if(e.indexOf(t)<0)return n.removeLineClass(t,"wrap","xsj_autopreview_selection_line")})),e.forEach((function(e){if(t.selectionLines.indexOf(e)<0)return n.addLineClass(e,"wrap","xsj_autopreview_selection_line")}))})),t.selectionLines=e},e.prototype.runAutopreviewQueue=function(e,t){var n,i,r,o;if(i=this,r=this.cm,this.isActive){if(this.runAutopreviewQueue.running){if(!e)return;i.finishRunFn&&(r.off("update",i.finishRunFn),i.finishRunFn=null),i.runAutopreviewQueue.running=!1,i.runAutopreviewQueue.runningLineNums=[]}if(this.autopreviewQueue){n=Object.assign({},this.autopreviewQueue),this.autopreviewQueue=null,this.runAutopreviewQueue.running=!0,this.runAutopreviewQueue.runningLineNums=Object.keys(n);try{r.operation((function(){var e,t,r;for(e in t=[],n)r=n[e],t.push(i.autopreviewInternal(null,r.lineNumber));return t}))}catch(e){o=e,console.error(o)}return t||i.finishRunFn?void 0:(i.finishRunFn=function(){return i.finishRunFn&&(r.off("update",i.finishRunFn),i.finishRunFn=null),i.runAutopreviewQueue.running=!1,i.runAutopreviewQueue.runningLineNums=[]},r.on("update",i.finishRunFn))}}},e.prototype.addToAutopreviewQueue=function(e,t,n){var i,r,o,a,s,l;if(this.runAutopreviewQueue.runningLineNums&&this.runAutopreviewQueue.runningLineNums.length>0&&(a=e+"",F.call(this.runAutopreviewQueue.runningLineNums,a)<0&&(n=!0)),!this.runAutopreviewQueue.running||n)return this.autopreviewQueue=this.autopreviewQueue||{},this.autopreviewQueue[e]={lineNumber:e},this,i=this.cm,!0===t&&(t={line:e,ch:0}),t&&(l=(s=i.getTokenAt(t)).type||"",s.state&&s.state.inner&&(o=s.state.inner,(1===s.state.state||l.indexOf("yaml-frontmatter")>=0)&&this.addToAutopreviewQueue(0,!1,!0),s.state.inner.innerModeLine&&this.addToAutopreviewQueue(s.state.inner.innerModeLine,!1,!0),o.outer&&(o.outer.localModeLine&&this.addToAutopreviewQueue(o.outer.localModeLine,!1,!0),o.outer.htmlModeLine&&this.addToAutopreviewQueue(o.outer.htmlModeLine,!1,!0),o.outer.setext&&(r=i.getCursor(),this.addToAutopreviewQueue(r.line+1,!1,!0)),o.outer.table&&o.outer.tableLine)))?this.addToAutopreviewQueue(o.outer.tableLine,!1,!0):void 0},e.prototype.isAutopreviewed=function(){return this.isActive},e.prototype.changeConfig=function(e){var t;return t=this,this.cm.operation((function(){var n,i;for(i in n=t.autopreviewTypes)n[i],e[i]||t.clearMarkers(i);return t.autopreviewTypes=e,t.cm.refresh()}))},e.prototype.disableAutopreview=function(){return this.isActive=!1,this.clearMarkers(),this.cm.refresh()},e.prototype.enableAutopreview=function(){return this.isActive=!0,this.cm.refresh()},e.prototype.destroy=function(){return this.disableAutopreview()},e}(),n.exports=i}}),window.requirejs.define({"lib/editor/autopreview/color_manager_view":function(e,t,n){var i,r,o,a={}.hasOwnProperty;t("../../../constant"),i=t("../../../application"),t("../../utils_emojis"),t("../../utils"),t("./utils_cover"),t("../../notifier"),o=null,r=function(e){var t;function n(){return n.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)a.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(n,Backbone.View),n.prototype.className="ui modal",n.prototype.initialize=function(e){return o=this},n.prototype.events={"click .clear_color_btn":"clearColorFn","click .select_color_btn":"showColorPickerFn","change input[type=radio][name=baseColorType]":"baseColorTypeChangedFn"},t=function(e){return o.$el.find(".color_select_result").css("background",e),o.$el.find("input[name=colorValue]").val(e)},n.prototype.clearColorFn=function(e){return t("")},n.prototype.baseColorTypeChangedFn=function(e){var n;return(n=$(e.currentTarget).val())&&(n="var(--"+n+")"),t(n)},n.prototype.showColorPickerFn=function(e){var n,r,o,a;return n=i.getApplicationProfileModel(),o=$.trim(n.get("cmColorpickerColorSets"))||"",a=[],o&&(a=o.split("|")),(r=new CodeMirrorColorPicker.ColorPicker({type:"sketch",mode:"edit",colorSets:function(){return o=$.trim(n.get("cmColorpickerColorSets"))||"",a=[],o&&(a=o.split("|")),[{colors:a,name:"Input Colors",edit:!0}]},color:"black"})).$root.addClass("xsj_only_palette"),r.show({left:e.clientX,top:e.clientY,hideDelay:2e3},"black",(function(e){return r.hide(),r.destroy(),t(e)}))},n.prototype.show=function(e,n,i){var r,a;return this.$el.html('<i class="close icon"></i>\n<div class="content">\n<div class="ui segment" >\n    <div class="ui form">\n      <div class="inline fields">\n        <label for="baseColorType">\u9009\u62e9\u989c\u8272</label>\n        <div class="field" style="margin: 0 0.5em;padding: 0.2em 0.2em; background: var(--base08)">\n          <div class="ui radio">\n            <input type="radio" name="baseColorType" value="base08">\n            <label></label>\n          </div>\n        </div>\n        <div class="field" style="margin: 0 0.5em;padding: 0.2em 0.2em; background: var(--base09)">\n          <div class="ui radio">\n            <input type="radio" name="baseColorType" value="base09">\n            <label></label>\n          </div>\n        </div>\n        <div class="field" style="margin: 0 0.5em;padding: 0.2em 0.2em; background: var(--base0A)">\n          <div class="ui radio">\n            <input type="radio" name="baseColorType" value="base0A">\n            <label></label>\n          </div>\n        </div>\n        <div class="field" style="margin: 0 0.5em;padding: 0.2em 0.2em; background: var(--base0B)">\n          <div class="ui radio">\n            <input type="radio" name="baseColorType" value="base0B">\n            <label></label>\n          </div>\n        </div>\n        <div class="field" style="margin: 0 0.5em;padding: 0.2em 0.2em; background: var(--base0C)">\n          <div class="ui radio">\n            <input type="radio" name="baseColorType" value="base0C">\n            <label></label>\n          </div>\n        </div>\n        <div class="field" style="margin: 0 0.5em;padding: 0.2em 0.2em; background: var(--base0D)">\n          <div class="ui radio">\n            <input type="radio" name="baseColorType" value="base0D">\n            <label></label>\n          </div>\n        </div>\n        <div class="field" style="margin: 0 0.5em;padding: 0.2em 0.2em; background: var(--base0F)">\n          <div class="ui radio">\n            <input type="radio" name="baseColorType" value="base0F">\n            <label></label>\n          </div>\n        </div>\n        <div class="field" style="margin: 0 0.5em;padding: 0.2em 0.2em; background: var(--base0E)">\n          <div class="ui radio">\n            <input type="radio" name="baseColorType" value="base0E">\n            <label></label>\n          </div>\n        </div>\n        <div class="field">\n          <div class="ui button select_color_btn">\u5176\u4ed6\u989c\u8272</div>\n        </div>\n      </div>\n\n      <div class="field">\n          <label for="colorValue">\u989c\u8272</label>\n          <div class="ui fluid input">\n              <div class="ui tag label color_select_result" style="color: white; background: var(--base0A);">\u663e\u793a\u6548\u679c</div>\n              <input type="hidden" name="colorValue" placeholder="">\n              <div class="ui  button  basic mini icon clear_color_btn">\n                  <i class="icon trash"/>\n              </div>\n          </div>\n      </div>\n\n    </div>\n  </div>\n</div>\n<div class="actions">\n    <div class="ui cancel button" >\n        \u53d6\u6d88\n    </div>\n    <div class="ui positive button">\n        <span >\u786e\u5b9a</span> \n    </div>\n</div>'),r=this.$el,(a=r.find(".ui.form")).form({onSuccess:function(){var e;return e=r.find("input[name=colorValue]").val().trim(),i(e||""),r.modal("hide")}}),r.modal({closable:!1,onVisible:function(){if(n.doc.cm.focus(),e)return t(e)},onHidden:function(){return n.doc.cm.focus(),r.modal("destroy"),o.remove(),o=null},onDeny:function(){return!0},onApprove:function(){return a.form("validate form"),!1}}).modal("show")},n}(),n.exports=r}}),window.requirejs.define({"lib/editor/autopreview/cover_manager_view":function(e,t,n){var i,r,o,a,s,l,c,u,d,p,f,h,m={}.hasOwnProperty;i=t("../../../constant"),t("../../../application"),t("../../utils_emojis"),l=t("../../utils"),o=t("./utils_cover"),a=t("../../notifier"),s=t("../../resource_core"),h=null,u=function(e){var t;return t=e.substring(e.lastIndexOf(".")+1).toUpperCase(),_.contains(["JPG","JPEG","PNG","SVG"],t)},p='<a class="active item" data-tab="random" >\n    \u968f\u673a\u56fe\u7247\n</a>',d='<div class="ui active tab segment" data-tab="random">\n    <p class="random-zone">\n      <span class="ui button icon massive primary random_btn"><i class="fas fa-dice"></i></span>\n    </p>\n</div>',MINI_WEB&&(p="",d=""),f='<i class="close icon"></i>\n<div class="content upload_container">\n<div class="four item tabular ui menu attached">\n    '+p+'\n    <a class="item" data-tab="import" >\n        \u672c\u5730\u56fe\u7247\n    </a>\n    <a class="item" data-tab="local" >\n        \u6587\u7ae0\u56fe\u7247\n    </a>\n    <a class="item" data-tab="network" >\n        \u7f51\u7edc\u56fe\u7247\n    </a>\n</div>\n'+d+'\n<div class="ui tab segment" data-tab="import">\n    <div style="display:none;"><input type="file" multiple="" name="fileData" class="form-control"></div>\n    <p class="drop-zone" >\u5c06\u6587\u4ef6\u62d6\u62fd\u5230\u8fd9\u91cc</p>\n</div>\n<div class="ui tab segment" data-tab="local">\n  <p >\u9009\u62e9\u4e00\u4e2a\u5df2\u7ecf\u6dfb\u52a0\u7684\u6587\u4ef6</p>\n  <div class="file_gallery">\n      <div class="ui cards"></div>\n  </div>\n</div>\n<div class="ui tab segment" data-tab="network">\n    <p >\u8f93\u5165\u56fe\u7247\u6587\u4ef6\u7684url\u5730\u5740:</p>\n    <div class="ui form">\n        <div class="field">\n            <div class="ui fluid icon input">\n                <input type="text" name="link" placeholder="\u8bf7\u5728\u8fd9\u91cc\u8f93\u5165\u4e00\u4e2a\u94fe\u63a5\u5730\u5740"\n                >\n                <i class="linkify icon"></i>\n            </div>\n        </div>\n    </div>\n\n</div>\n</div>\n<div class="actions">\n    <div class="ui cancel button" >\n        \u53d6\u6d88\n    </div>\n    <div class="ui positive button">\n        <span >\u786e\u5b9a</span> \n    </div>\n</div>',c=function(e){return e.backgroundDraggable("disable"),e.css("backgroundPosition",""),e.data("backgroundPosition",""),e.backgroundDraggable({percent:!0,axis:"y",done:function(t,n){if(n)return t.preventDefault(),t.stopPropagation(),e.data("backgroundPosition",n),e.data("moving",!0),setTimeout((function(){return e.data("moving","")}),10),!1}})},r=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)m.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,Backbone.View),t.prototype.className="ui modal",t.prototype.randomFile=null,t.prototype.selectedFile=null,t.prototype.localFilePath=null,t.prototype.coverInfoObj=null,t.prototype.randomPos=-1,t.prototype.tabPath="random",t.prototype.initialize=function(e){return h=this,this.fileModel=e.fileModel},t.prototype.events={"click .drop-zone":"selectFileFn","click .random-zone .random_btn":"randomFileFn"},t.prototype.setModalBackground=function(e){var t,n;return t=this.$el.parent()[0],n=this.$el.width()/2,t.style.background="url("+e+") center center / cover no-repeat",t.style.setProperty("--coverModalWidth",n+"px")},t.prototype.randomFileFn=function(){var e,t,n,r,o,s,l,u;if(!(e=this.$el.find(".random_btn")).hasClass("loading")&&h.coverInfoObj)return(u=(n=Object.keys(h.coverInfoObj)).length)>0?(e.addClass("loading"),(l=this.randomPos)<0||"production"===ENV?l=_.random(0,u-1):(l+=1)>=u&&(l=0),this.randomPos=l,r=n[l],o=h.coverInfoObj[r],s=i.host+"/"+o.image,(t=h.$el.find(".random-zone")).addClass("has-image").css("background-image","url("+s+")"),this.setModalBackground(s),c(t),fetch(s).then((function(e){return e.blob()})).then((function(t){return e.removeClass("loading"),h.randomFile={blobData:t,file:t,path:o.name}})).catch((function(t){return a.showMessage("\u52a0\u8f7d\u5c01\u9762\u5931\u8d25: "+t,6e3,"error"),e.removeClass("loading")}))):void 0},t.prototype.selectFileFn=function(e){if(!$(e.currentTarget).data("moving"))return h.$el.find("input[type=file]").trigger("click")},t.prototype.show=function(e,t,n){var r,d,p,m,v,g,w;return this.$el.html(f),this.dimmer=l.xsjDimmer(this.$el.find(".upload_container")),r=this.$el,l.initdragFilesSupport(r.find(".drop-zone,.random-zone"),(function(e,t){return l.insertImageFile(e,(function(e,n,i){var r,o;return u(i.name)?(o={blobData:l.dataURL2Blob(e),file:i,path:n},(r=$(t.currentTarget)).hasClass("random-zone")?h.randomFile=o:h.selectedFile=o,r.addClass("has-image").css("background-image","url("+e+")"),h.setModalBackground(e),c(r)):a.showMessage("\u9519\u8bef\u7684\u56fe\u7247\u683c\u5f0f,  \u4ec5\u652f\u6301 jpg \u683c\u5f0f",6e3,"error")}))})),l.initFileImportSupport(r.find('input[type="file"]'),(function(e){return l.insertImageFile(e,(function(e,t,n){var i,r;return u(n.name)?(r=l.dataURL2Blob(e),h.selectedFile={blobData:r,file:n,path:t},(i=h.$el.find(".drop-zone")).addClass("has-image").css("background-image","url("+e+")"),h.setModalBackground(e),c(i)):a.showMessage("\u9519\u8bef\u7684\u56fe\u7247\u683c\u5f0f,  \u4ec5\u652f\u6301 jpg \u683c\u5f0f",6e3,"error")}))})),(p=r.find(".ui.form")).form({fields:{link:{identifier:"link",rules:[{type:"empty",prompt:"\u56fe\u7247\u5730\u5740\u4e0d\u80fd\u4e3a\u7a7a"}]}},onSuccess:function(){var e,t;return t=(e=r.find('input[name="link"]')).data("selectedFilePosition"),n(e.val(),t),r.modal("hide")}}),navigator.onLine&&!MINI_WEB&&((m=this.$el.find(".random_btn")).addClass("loading"),fetch(i.host+"/css/random-covers.json?fver="+moment().format("YYYYMMDD")).then((function(e){return e.json()})).then((function(e){if(m.removeClass("loading"),m.transition("jiggle"),h.coverInfoObj=e,!t.__xsjNewUrl)return m.trigger("click")})).catch((function(e){return a.showMessage("\u52a0\u8f7d\u968f\u673a\u5c01\u9762\u5931\u8d25: "+e,6e3,"error"),m.remove()}))),r.modal({closable:!1,dimmerSettings:{opacity:.7},onVisible:function(){var e,n,i;if(h.$el.parent().addClass("cover_modals"),t.doc.cm.focus(),t.__xsjNewUrl&&!MINI_WEB&&(i=t.doc.cm.fileModel.get("cover")||"",n=o.getBackgroundPosition(i),(e=h.$el.find(".random-zone")).addClass("has-image").css("background-image","url("+t.__xsjNewUrl+")"),h.setModalBackground(t.__xsjNewUrl),c(e),n))return e.css("background-position",n)},onHidden:function(){var e;return e=h.$el.parent()[0],h.$el.parent().removeClass("cover_modals"),e.style.background="",e.style.removeProperty("--coverModalWidth"),t.doc.cm.focus(),r.modal("destroy"),h.remove(),h=null},onDeny:function(){return n(null,null),!0},onApprove:function(){var t,i,o,a,c;if("network"===(c=h.tabPath))return p.form("validate form"),!1;if(i=null,a="","random"===c&&(i=h.randomFile,a=h.$el.find(".random-zone").data("backgroundPosition")),"import"===c&&(i=h.selectedFile,a=h.$el.find(".drop-zone").data("backgroundPosition")),"local"===c&&(i=h.localFilePath),i){if("object"==typeof i)return h.dimmer.dimmer("show"),o=i.path,t=l.getExt(o),o="randomCover.jpg",t&&(o="randomCover"+t),s.uploadResource({},h.fileModel,o,i.file.type,i.blobData,{fixRepeatFilename:!1},(function(e,t,n,i){return h.dimmer.dimmer("hide"),r.find('input[name="link"]').val(n).data("selectedFilePosition",a),p.form("validate form")})),!1;if("string"==typeof i)return r.find('input[name="link"]').val(i),p.form("validate form"),!1}else if(a)return n(e,a)}}).modal("show"),r.find(".ui.menu .item").tab({onVisible:function(e){return h.tabPath=e}}),MINI_WEB&&r.find(".ui.menu .item").tab("change tab","import"),r.find(".file_gallery").mousewheel((function(e,t){return this.scrollLeft-=40*t,e.preventDefault()})),d=r.find(".ui.cards"),w=220*(g=(g=this.fileModel.attachments()).filter((function(e){return u(e)}))).length,d.css({width:w}),v=function(e,t){return h.fileModel.getAttachObjectByFilename(e,(function(n,i){var o,a,s;return h&&i&&i.objectUrl&&(a=i.objectUrl,s=e.substring(e.lastIndexOf(".")+1).toUpperCase(),o=_.contains(["JPG","JPEG","PNG","GIF","SVG"],s)?$('<div class="ui card">\n  <div class="center-cropped" style="background-image: url(\''+a+'\');"></div>\n  <div class="content">'+e+"</div>\n</div>"):$('<div class="ui card">\n  <div class="content">'+e+"</div>\n</div>"),d.append(o),o.click((function(){return h.localFilePath="./"+e,r.find(".ui.card.raised").removeClass("raised"),h.setModalBackground(a),o.addClass("raised")}))),t()}))},async.mapLimit(g,10,v,(function(){}))},t}(),n.exports=r}}),window.requirejs.define({"lib/editor/autopreview/create_date_manager_view":function(e,t,n){var i,r,o={}.hasOwnProperty;t("../../../constant"),t("../../../application"),r=null,i=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)o.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(n,Backbone.View),n.prototype.className="create_date_manager_container",n.prototype.callbackFn=null,n.prototype.callbackVal="",n.prototype.events={click:"selfClickFn"},n.prototype.createDateInputKeyPress=function(e){return 13===e.keyCode?r.destroy(!0):27===e.keyCode?r.destroy():void 0},n.prototype.selfClickFn=function(e){if(e.target===this.el)return this.destroy()},n.prototype.initialize=function(e){return r=this,$(document).on("keydown",this.createDateInputKeyPress)},n.prototype.show=function(e,t,n){var i;return this.callbackFn=n,r.render(),i=e.getBoundingClientRect(),r.$el.css({position:"absolute",zIndex:500,inset:0}),r.init(t),r.$el.find(".create_date_manager_form_container").css({position:"fixed",right:window.innerWidth-i.right,top:i.y}),$("#main").append(r.$el)},n.prototype.init=function(e){var n;return this.callbackVal=e,n=$('<div class="create_date_manager_form_container">\n</div>'),t("../../dynamic_import/import_calendar")((function(){var t;if(r)return t=[],function(){return n.calendar({className:{calendar:"ui calendar",active:"active",popup:"ui popup",grid:"ui equal width grid",column:"column",table:"ui celled center aligned unstackable table",prev:"prev link",next:"next link",prevIcon:"chevron left icon",nextIcon:"chevron right icon",link:"link",cell:"link",disabledCell:"disabled",weekCell:"disabled",adjacentCell:"adjacent",activeCell:"active",rangeCell:"range",focusCell:"focus",todayCell:"today-cell",today:"today link"},text:{days:["\u65e5","\u4e00","\u4e8c","\u4e09","\u56db","\u4e94","\u516d"],months:["\u4e00\u6708","\u4e8c\u6708","\u4e09\u6708","\u56db\u6708","\u4e94\u6708","\u516d\u6708","\u4e03\u6708","\u516b\u6708","\u4e5d\u6708","\u5341\u6708","\u5341\u4e00\u6708","\u5341\u4e8c\u6708"],monthsShort:["\u4e00","\u4e8c","\u4e09","\u56db","\u4e94","\u516d","\u4e03","\u516b","\u4e5d","\u5341","\u5341\u4e00","\u5341\u4e8c"],today:"\u4eca\u5929",weekNo:"\u661f\u671f"},formatter:{cell:function(e,t,n){}},today:!0,eventClass:"positive",eventDates:t,showWeekNumbers:!0,initialDate:moment(e).toDate(),type:"date",onSelect:function(e,t){if("day"===t)return r.callbackVal=e.getTime(),r.destroy(!0)},selectAdjacentDays:!0})}()})),this.$el.html(n)},n.prototype.destroy=function(e){return this.$el.calendar("destroy"),$(document).off("keydown",this.createDateInputKeyPress),e&&r&&this.callbackFn&&this.callbackFn(this.callbackVal||""),r=null,this.remove()},n}(),n.exports=i}}),window.requirejs.define({"lib/editor/autopreview/create_inline_table":function(e,t,n){var i,r,o,a,s,l,c,u,d={}.hasOwnProperty;a=t("../../../lib/utils_table"),s=t("../../../lib/utils"),o=t("../../../lib/utils_system"),i=t("../../../application"),r=t("../../notifier"),u=function(e,t){var n;return n=0,e.parent?t.heightAtLine(e.lineNo(),"local",!0)-4:n},c=function(e){return function(t){var n,l,c,p,f,h,m,v,g,w,y,b,x,k,D;function C(){return C.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)d.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(C,Backbone.View),C.prototype.editor=null,C.prototype.el=e,n="",k=null,g=!1,v=!1,p=null,w=null,b=null,m=null,x=null,c=function(){if(p&&p.handsontable)return p.handsontable.deselectCell()},D=function(e,t,n){var i;if(w)if((i=w.line.lineNo())<t||i>n){if(g)return x.$el.find(".codemirror_table_wrapper").empty(),p=null,g=!1}else if(!g)return g=!0,x.initContainer()},C.prototype.events={"click .trash_button":"removeFn","click .transpose_button":"transposeFn","click .code_button":"codeFn","click .copy_button":"copyFn"},C.prototype.transposeFn=function(e){var t,i,r;if(e.preventDefault(),e.stopPropagation(),r=(r=p.handsontable.getData()).slice(0,r.length-1),t=p.alignInfos,r=p.Handsontable.helper.translateRowsToColumns(r),(i=markdownTable(r,{align:t}))!==n)return x.trigger("contentChanged",i)},C.prototype.copyFn=function(e){return e.preventDefault(),e.stopPropagation(),$(document).one("copy",(function(e){return e.preventDefault(),e.stopPropagation(),e.originalEvent.clipboardData.setData("text/plain",n),r.showMessage("\u590d\u5236\u6210\u529f")})),document.execCommand("copy")},C.prototype.codeFn=function(){var e;return e=k.find(),this.editor.startOperation(),e&&(this.editor.setCursor({line:e.from.line+1,ch:1}),k.clear(),this.editor.setSelection(e.from,e.to)),this.destroy(),this.editor.endOperation()},C.prototype.removeFn=function(){return this.trigger("contentChanged",""),this.destroy()},l=function(e){return a.getTableByString(e)},C.prototype.initContainer=function(e){var t,a,s;return s=(t=$('<iframe src="table_widget.html" frameborder="0" style="width: 100%;height:100%;"></iframe>'))[0],(a=this.$el.find(".codemirror_table_wrapper")).addClass("iframe_loader"),a.html(t),(p=s.contentWindow).xsjBeforeLoad=function(){return h(),f(i.getApplicationProfileModel().get("themeInfo")),p.xsjBeforeLoad=null},s.onload=function(){return window.changeOpenTarget&&window.changeOpenTarget(p.document),a.removeClass("iframe_loader"),p.loadData(l(n)),p.$(p).on("copyTable",(function(e,t){var n,i,a;if(i=t.data,n=t.aligns||[],i)return a=markdownTable(i,{align:n}),o.copyClipboard(a,null,(function(){return r.showMessage("\u590d\u5236\u6210\u529f")}))})),p.$(p).on("tableSizeChanged",(function(e,t){var n;if(t&&t.height){if(!w)return;return(n=3*window.outerHeight/4)>300&&t.height>n&&(t.height=n),$(w.node).height(t.height-w.doc.cm.defaultTextHeight()),w.changed()}})),p.$(p).on("tableDataChanged",(function(e,t){var i,r,o;if(r=t.data,i=t.aligns||[],r&&(o=markdownTable(r,{align:i}))!==n)return n=o,x.trigger("contentChanged",o)}))}},C.prototype.initialize=function(e){return x=this,w=e.lineCodemirrorWidget,this.editor=e.editor,m=e.initWidgetTop},y=function(){var e,t,n;return $(w.node).resizable({helper:"ui-resizable-helper inline-codemirror-resizable-helper",handles:"s",stop:function(e,t){return t.element.css("width","")}}),t=function(){var e,t,n,i;if(w&&(e=w.doc.cm).getLineNumber(w.line)>=0){i=u(w.line,e),t=w.height+w.doc.cm.defaultTextHeight()-4,n=w.doc.cm.display.lineDiv.clientWidth,x.$el.css({width:n-10,height:t,top:i});try{return w.changed()}catch(e){return e,w.destroyLineCodemirrorWidgetFn(),console.log("skip")}}},n=_.throttle(t,100),e=0,(b=new ResizeObserver((function(t){var i;return t[0].borderBoxSize?(i=t[0].borderBoxSize[0].blockSize)&&e!==i?(e=i,n()):void 0:n()}))).observe(x.editor.display.sizer)},C.prototype.show=function(){return $(w.node),this.$el.css({width:w.node.clientWidth-4-6-10,height:w.height,left:0,top:m,zIndex:100}),y(),this.initListeners(),w.lineTableWidgetView=this},C.prototype.destroyListeners=function(){document.body.removeEventListener("click",c,!0),document.body.removeEventListener("mousedown",c,!0),document.body.removeEventListener("mouseup",c,!0),x.editor.off("viewportChange",D),this.stopListening(i.getApplicationProfileModel())},h=function(){var e;return e=$("#xsj-default-global-style").text(),s.importCssString(e,"xsj-default-global-style",!1,p.document)},f=function(e){var t,n,i;i=null;try{i=JSON.parse(e)}catch(e){i=null}if(t="",i&&"object"==typeof i&&(n=i.key)&&!i.themeId&&(t="css/themes/base16-"+n+".css"),t||(t=$("#story_theme").attr("href")),t)return s.importCssUrl(t,"story_theme",!0,p.document)},C.prototype.initListeners=function(){this.listenTo(i.getApplicationProfileModel(),"change:themeInfo",(function(e,t){if(p)return f(t)})),document.body.addEventListener("click",c,!0),document.body.addEventListener("mousedown",c,!0),document.body.addEventListener("mouseup",c,!0),x.editor.on("viewportChange",D)},C.prototype.setContent=function(e,t){if(n!==e)return k=t,n=e,p&&p.loadData(l(n)),g?void 0:(g=!0,this.initContainer())},C.prototype.destroy=function(){v||(v=!0,setTimeout((function(){return x.remove()}),1))},C.prototype.remove=function(){return p=null,g=!1,this.destroyListeners(),b.unobserve(x.editor.display.sizer),b=null,w&&(w.destroyLineCodemirrorWidgetFn&&(w.line.off("delete",w.destroyLineCodemirrorWidgetFn),w.destroyLineCodemirrorWidgetFn=null),w.lineTableWidgetView=null,$(w.node).resizable("destroy"),w.lineTableWidgetView=null,w.clear(),w=null,k=null),C.__super__.remove.call(this)},C}()},l=function(e,t,n){var i,r,o,s,l,d,p,f,h,m,v,g,_,w,y;if(o=e,(v=(t=t||{}).lineNum)||(v=o.getCursor().line),d=200,t.content&&(d=40*a.getTableByString(t.content).data.length+20),m=o.getLineHandle(v),h=null,s=function(){if(h&&h.lineTableWidgetView)return h.lineTableWidgetView.destroy()},m.widgets)for(l=0,f=(_=m.widgets).length;l<f;l++)if((p=_[l]).lineTableWidgetView){h=p;break}return h?(n(null,h.lineTableWidgetView),h.lineTableWidgetView):(w=uniqueNumber(),r=$('<div class="line-codemirror-placeholder-'+w+'" style="height: '+d+'px;margin-top: 6px;">\n</div>'),y=u(m,o),h=o.addLineWidget(v,r[0],{className:"inline-codemirror-linewidget"}),i=$('<div class="line-codemirror-widget codemirror-widget line-table-widget  line-codemirror-'+w+'" style="height: '+d+'px;">\n<div class="codemirror-widget-title">\n  <i class="icon link code code_button" title="\u4fee\u6539\u6e90\u4ee3\u7801"></i>\n  <i class="icon link retweet transpose_button" title="\u884c\u5217\u4e92\u8f6c(\u8f6c\u7f6e\u77e9\u9635)"></i>\n  <i class="icon link copy outline copy_button" title="\u590d\u5236\u4ee3\u7801"></i>\n  <i class="icon link trash alternate trash_button" title="\u5220\u9664\u8868\u683c"></i>\n  </div>\n<div class="codemirror_table_wrapper iframe_wrapper" style="height: 100%;">\n</div>\n  </div> '),o.addWidget({line:v,ch:0},i[0]),(g=new(c(i[0]))({initWidgetTop:y,lineCodemirrorWidget:h,editor:o})).show(),m.on("delete",s),h.destroyLineCodemirrorWidgetFn=s,n(null,g),g)},n.exports=l}}),window.requirejs.define({"lib/editor/autopreview/emoji_manager_view":function(e,t,n){var i,r,o,a,s={}.hasOwnProperty;t("../../../constant"),t("../../../application"),r=t("../../utils_emojis"),o=null,a='<span class="emoji_manager_form_clear_btn"><i class="icon trash link" title="\u5220\u9664\u8868\u60c5\u7b26\u53f7"></i></span>',i=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)s.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,Backbone.View),t.prototype.className="emoji_manager_container",t.prototype.callbackFn=null,t.prototype.callbackVal="",t.prototype.events={click:"selfClickFn","click .emoji_manager_form_clear_btn":"clearSelectFn","click .emoji_manager_form_random_btn":"randomSelectFn","emoji-click emoji-picker":"emojiClickFn"},t.prototype.randomSelectFn=function(e){var t,n,i;if(n=$(e.currentTarget),!(t=n.find(".icon")).hasClass("loading"))return t.addClass("loading"),r.getRandomEmojiChar((i=this,function(e){return t.removeClass("loading"),i.callbackVal||i.$el.find(".emoji_manager_form_container").append(a),i.$el.find(".emoji_manager_form_select_result").html(e),i.callbackVal=e}))},t.prototype.clearSelectFn=function(){return this.callbackVal="",this.$el.find(".emoji_manager_form_select_result").html(""),this.$el.find(".emoji_manager_form_clear_btn").remove()},t.prototype.emojiClickFn=function(e){var t;return t=e.originalEvent.detail,this.callbackVal||this.$el.find(".emoji_manager_form_container").append(a),this.$el.find(".emoji_manager_form_select_result").html(t.unicode),this.callbackVal=t.unicode},t.prototype.emojiInputKeyPress=function(e){return 13===e.keyCode?o.destroy(!0):27===e.keyCode?o.destroy():void 0},t.prototype.selfClickFn=function(e){if(e.target===this.el)return this.destroy(!0)},t.prototype.initialize=function(e){return o=this,$(document).on("keydown",this.emojiInputKeyPress)},t.prototype.show=function(e,t,n){var i;return this.callbackFn=n,o.render(),i=e.getBoundingClientRect(),o.$el.css({position:"absolute",zIndex:500,left:0,right:0,top:0,bottom:0}),o.init(t),o.$el.find(".emoji_manager_form_container").css({position:"fixed",left:i.x,top:i.y,width:i.width-5,minWidth:200,minHeight:i.height}),$("#main").append(o.$el)},t.prototype.init=function(e){return this.callbackVal=e,this.$el.html('<div class="emoji_manager_form_container">\n  <div class="emoji_manager_form_select_result_btns">\n    <span class="emoji_manager_form_select_result">'+e+'</span>\n    <span class="emoji_manager_form_random_btn"><i class="icon fas fa-dice link" title="\u968f\u673a\u8868\u60c5\u7b26\u53f7"></i></span>\n    '+(e?a:"")+'\n  </div>\n  <emoji-picker data-source="./js/modules/emoji-picker-element/data.json" class="xsj_emoji_picker" style="width: 100%;min-width: fit-content;"></emoji-picker>\n</div>')},t.prototype.destroy=function(e){return $(document).off("keydown",this.emojiInputKeyPress),e&&o&&this.callbackFn&&this.callbackFn(this.callbackVal||""),o=null,this.remove()},t}(),n.exports=i}}),window.requirejs.define({"lib/editor/autopreview/emoji_preview":function(e,t,n){var i,r,o,a;t("../../../lib/utils"),(r=t("./utils")).getMarkdownState,o=function(e){var t,n;return window.markdownitEmoji?((t=new markdownit("zero")).use(window.markdownitEmoji),(n=t.renderInline(e))===e&&(n=""),n):""},a=function(e,t){if(window.twemoji)return window.twemoji.parse(e,(function(e){return t("emoji/twemoji-2.2.1/svg/"+e+".svg")}))},i=function(e){var t;return t=e.doc,{isBlock:!1,createElement:function(e,n,i){var s,l,c,u,d;if(n.text,d=[],!r.checkIsInTable(i)&&((i=i.slice()).forEach((function(e){if((e.type||"").indexOf("formatting-emoji")>=0)return d.push({start:{ch:e.start},end:{ch:e.end},str:e.string,token:e})})),0!==d.length))return c=t.getCursor(),u=t.indexFromPos(c),s=[],(n.markedSpans||[]).forEach((function(e){var t,n;if((n=e.marker).__isEmojiMarker)return t=n.find(),s.push({pos:t,str:n.__str,textMarker:n})})),l=function(e){var t;return(t=s.findIndex((function(t){var n;return n=t.pos,e.start.ch===n.from.ch&&e.end.ch===n.to.ch&&e.str===t.str})))>=0&&(s.splice(t,1),!0)},d.forEach((function(n){var i,r,s,c,d,p,f,h,m;if(d={ch:n.start.ch,line:e},m={ch:n.end.ch,line:e},c=t.indexFromPos(d),h=t.indexFromPos(m),!(u>=c&&u<=h)&&!l(n)&&(s=t.getRange(d,m),r=o(s))){(i=document.createElement("span")).innerHTML=r,p={replacedWith:i,clearOnEnter:!0,handleMouseEvents:!1,inclusiveLeft:!1,inclusiveRight:!1};try{return a(r,(function(e){if(e)return i.innerHTML="<img style='width: 1em;' src=\""+e+'"/>'})),(f=t.markText(d,m,p)).__str=n.str,f.__isEmojiMarker=!0,f.__autopreviewType="emoji"}catch(e){return e,console.log("\u5b58\u5728\u91cd\u53e0\uff0c\u5ffd\u7565\u521b\u5efa...",d,m)}}})),s.forEach((function(e){return e.textMarker.clear()})),null}}},n.exports=i}}),window.requirejs.define({"lib/editor/autopreview/fenced_code_preview":function(e,t,n){var i,r,o;t("../../utils_generate_chart"),o=t("../../utils_system"),r=t("../../notifier"),i=function(e){var t;return t=e.doc,{isBlock:!1,clearMarkers:function(e,t){return(t.markedSpans||[]).forEach((function(e){var t;if((t=e.marker).__isFencedCodeMarker&&t.__mainFencedCodeMarker)return t.clear()}))},createElement:function(n,i,a){var s,l,c,u,d,p,f,h,m,v,g,w,y,b,x,k,D,C,$,F,M,T,S,P,j,E;if(D=i.text,y=null,(C=a[0])&&C.state&&C.state.inner&&C.state.inner.outer){if("mermaid"===(M=($=C.state.inner.outer).localModeName)||"flow"===M||"sequence"===M||"mathjax"===M||"plantuml"===M)return!1;$.localModeCh&&$.localModeLine===n&&(y={name:$.localModeName,title:(null!=(T=$.localModeState)?T.title:void 0)||"",start:{from:{line:n,ch:0},to:{line:n,ch:D.length}}})}if(!y)return!1;if(y&&y.start)for(F=Math.min(t.lastLine(),800)+n;n<F;){for(n++,t.getLine(n),c=e.getLineTokens(n)||[],l=0;l<c.length;)if(s=c[l],l++,(s.type||"").indexOf("formatting-code-block-close")>=0){y.end={from:{line:n,ch:0},to:{line:n,ch:s.end}};break}if(y.end)break}return!(!y||!y.end)&&(h=t.getCursor(),m=t.indexFromPos(h),x=y.start.from,j=y.start.to,k=y.end.from,E=y.end.to,b=t.indexFromPos(x),P=t.indexFromPos(E),u=(u=t.getRange(j,k)).substring(1,u.length-1),m>=b&&m<=P?((i.markedSpans||[]).forEach((function(e){var t;if((t=e.marker).__isFencedCodeMarker)return t.clear()})),!0):(f=function(e,n,i,r){var o,a;o="string"==typeof i?{className:i}:{replacedWith:i&&"object"==typeof i?i:document.createElement("span"),clearOnEnter:!0,handleMouseEvents:!1,inclusiveLeft:!1,inclusiveRight:!1};try{return(a=t.markText(e,n,o)).__isFencedCodeMarker=!0,i&&(a.__mainFencedCodeMarker=!0),a.__autopreviewType="fencedCode",r.push(a),a.on("clear",(function(){return r.map((function(e){return e.clear()}))})),a}catch(e){}},S=[],(d=document.createElement("span")).classList.add("xsj_autopreview_fenced_code_header_container"),y.title||d.classList.add("xsj_autopreview_fenced_code_header_blank_title"),w=_.escape(y.title),g=_.escape(y.name.substring(0,11)),p=f(x,j,d,S),v=f(k,E,null,S),d.innerHTML='<span class="xsj_autopreview_fenced_code_header"><span class="xsj_autopreview_fenced_code_header_title" title="'+w+"\"><span class=\"edit-btn\" title='\u7f16\u8f91'><i class='code icon link'></i></span>"+w+'<wbr></span><span class="xsj_autopreview_fenced_code_header_buttons"><span class="delete-btn" title="\u5220\u9664"><i class=\'trash icon link\'></i></span><span class="copy-btn"><i class=\'copy outline icon link\'></i>'+g+"</span></span></span>",d.onclick=function(n){var i,a,s,l;if(n.stopImmediatePropagation(),n.preventDefault(),n.stopPropagation(),"I"===(l=n.target).tagName&&(l=l.parentElement),l.classList.contains("copy-btn"))return document.execCommand("copy"),o.copyClipboard(u,{},(function(){return r.showMessage("\u590d\u5236\u6210\u529f")}));if(l.classList.contains("edit-btn")){if(a=null!=p?p.find():void 0)return t.setCursor(a.from),e.focus()}else if(l.classList.contains("delete-btn")){if(s=null!=p?p.find():void 0,i=null!=v?v.find():void 0,s&&i)return e.replaceRange("",s.from,i.to)}else if(l.classList.contains("xsj_autopreview_fenced_code_header_title")&&(a=null!=p?p.find():void 0))return e.foldCode(a.from)},!0))}}},n.exports=i}}),window.requirejs.define({"lib/editor/autopreview/file_yaml_preview":function(e,t,n){var i,r,o,a,s,l,c,u,d,p,f,h,m,v,g,w;w=t("../../../lib/preview_core"),i=t("../../../application"),t("../../notifier"),t("../../../lib/resource_core"),h=t("../../utils"),t("../../utils_generate_chart"),s=t("./utils_cover"),p=t("./tag_manager_view"),f=t("./theme_manager_view"),c=t("./emoji_manager_view"),r=t("./category_manager_view"),a=t("./cover_manager_view"),d=t("./idiom_manager_view"),l=t("./create_date_manager_view"),o=t("./color_manager_view"),m='<i class="far fa-smile emoji_icon"></i>',g="\u58f9\u6708,\u8d30\u6708,\u53c1\u6708,\u8086\u6708,\u4f0d\u6708,\u9646\u6708,\u67d2\u6708,\u634c\u6708,\u7396\u6708,\u58f9\u62fe\u6708,\u58f9\u62fe\u58f9\u6708,\u58f9\u62fe\u8d30\u6708".split(","),v=function(e,t,n){return w.getUrlInfo(e,t,{parseClientLocalMedias:!0},(function(e,i){return e?n(t):n(i.url,i)}))},u=function(e){var t,n;return n=e.doc,t=e.fileModel,{isBlock:!1,createElement:function(u,w,y){var b,x,k,D,C,F,M,T,S,P,j,E,I,O,V,L,A,B,N,R,H,z,q,W,U,Y,J,G,K,X,Q,Z,ee,te,ne,ie,re,oe,ae;if(w.text,ae=null,(K=w.stateAfter)&&K.lookAhead&&(K=K.state),K&&1===K.state&&0===u&&(ae={start:{line:u,ch:0}}),ae){if(ae&&ae.start)for(W=Math.min(n.lastLine(),50)+u;u<W&&(u++,x=n.getLine(u),/^\-{3,}/.test(x)&&(ae.end={line:u,ch:x.length}),!ae.end););if(ae&&ae.end){if(P=n.getCursor(),j=n.indexFromPos(P),q=w.markedSpans||[],ee={},q.forEach((function(e){var t;if((t=e.marker).__isFileYamlPreviewMarker&&t.__uuid)return ee[t.__uuid]=t})),B=ae.start,re=ae.end,A=n.indexFromPos(B),ie=n.indexFromPos(re),j>A&&j<=ie)return null;if(ne="",Q="",T="",M="",R="",D="",te="",t&&(L=t.getMeta(),ne=t.get("title"),Q=t.get("tagNames")||[],T=t.get("createDate")||"",k=t.get("category")||"",I=t.get("emoji")||"",D=t.get("color")||"",te=L.theme||"",R=t.get("idiom")||"",M=t.get("cover")||"",F=s.getBackgroundPosition(M),M=t.getCoverUrl(),X=Q,Q=Q.map((function(e,t){return'<span class="xsj_autopreview_yaml_tag"><i class="xsj_autopreview_yaml_tag_remove_btn" data-index="'+t+'"></i>'+_.escape(e)+"</span>"})).join(",")),U=ne+Q+k+T+M+I+D+R+te,oe=CryptoJS.MD5(U).toString(),ee[oe])delete ee[oe];else{N="",C="",Y="",G="",M&&(N="xsj_autopreview_yaml_has_cover",C='<img class="xsj_autopreview_yaml_cover_image"/>',Y='<span class="xsj_autopreview_yaml_remove_cover_btn" title="\u5220\u9664\u5c01\u9762"><i class="trash icon"></i></span>'),te&&(G='<span class="xsj_autopreview_yaml_remove_theme_btn" title="\u5220\u9664\u4e3b\u9898"><i class="trash icon"></i></span>'),O="blank_emoji",V=m,J="",I&&(O="",V='<i class="icon emoji_icon">'+I+"</i>",J='<span class="xsj_autopreview_yaml_remove_emoji_btn" title="\u5220\u9664\u56fe\u6807"><i class="trash icon"></i></span>'),b=$("<span class='xsj_autopreview_container'></span>"),D&&b[0].style.setProperty("--articleColor",D),H="",R&&(H='<div class="xsj_autopreview_yaml_idiom_text">'+_.escape(R)+"</div>"),S=moment(T),b.html('<div class="xsj_autopreview_yaml_container">\n<div class="xsj_autopreview_yaml_cover_container">\n   '+C+'\n</div>\n<div class="xsj_autopreview_yaml_top_left_btns">\n  <div class="xsj_autopreview_yaml_cover_btns">\n    <span class="xsj_autopreview_yaml_add_cover_btn" title="'+(M?"\u4fee\u6539\u5c01\u9762":"\u6dfb\u52a0\u5c01\u9762")+'"><i class="image icon"></i></span>\n    '+Y+'\n  </div>\n  <div class="xsj_autopreview_yaml_theme_btns '+(te?"xsj_autopreview_yaml_has_theme":"")+'">\n    <span class="xsj_autopreview_yaml_add_theme_btn" title="'+(te?"\u4fee\u6539\u6587\u7ae0\u4e3b\u9898":"\u8bbe\u7f6e\u6587\u7ae0\u4e3b\u9898")+'"><i class="theme icon"></i></span>\n    '+G+'\n  </div>\n</div>\n<div class="xsj_autopreview_yaml_create_date" title="\u521b\u5efa\u65f6\u95f4: '+S.format("YYYY-MM-DD, dddd")+'">\n  <div class="week">'+S.format("dddd")+'</div>\n  <div class="year">'+S.year()+'</div>\n  <div class="date">'+S.format("DD")+'</div>\n  <div class="month">'+g[S.month()]+'</div>\n</div>\n<h1 class="xsj_autopreview_yaml_title">'+_.escape(ne)+'</h1>\n<div class="xsj_autopreview_yaml_tags">'+Q+' <span class="xsj_autopreview_yaml_tag_modify_btn"><i class="plus circle icon" title="\u6dfb\u52a0\u65b0\u6807\u7b7e"></i></span></div>\n<div class="xsj_autopreview_yaml_category">\n  <span class="xsj_autopreview_yaml_category_content">'+_.escape(k)+'</span>\n  <span class="xsj_autopreview_yaml_category_modify_btn" style="margin-left: .5em;"><i class="sitemap icon" title="\u4fee\u6539\u5206\u7c7b"></i></span>\n  </div>\n<div class="xsj_autopreview_yaml_emoji_btns">\n  <span class="xsj_autopreview_yaml_emoji_modify_btn '+O+'" >'+V+"</span>\n  "+J+'\n</div>\n<div class="xsj_autopreview_yaml_control_btns">\n  <span class="xsj_autopreview_yaml_idiom_btn" title="\u968f\u4fbf\u5199\u51e0\u53e5" ><i class="icon map signs"></i></span>\n  <span class="xsj_autopreview_yaml_color_btn" title="\u9009\u62e9\u6587\u7ae0\u989c\u8272" ><i class="fas fa-palette icon"></i></span>\n  <span class="xsj_autopreview_yaml_modify_btn" title="\u5143\u6570\u636e"><i class="icon cogs"></i></span>\n</div>\n'+H+"\n</div>"),E=b.get(0);try{(Z=n.markText(B,re,{replacedWith:E,clearOnEnter:!0,handleMouseEvents:!1,inclusiveLeft:!0,inclusiveRight:!0})).__uuid=oe,Z.__isFileYamlPreviewMarker=!0,Z.__autopreviewType="fileYaml",Z.__loadTimes=0,Z.__xsjurl=M,Z.__xsjLoadFn=function(){if(!t.isXSJFake)return Z.__loadTimes=0,M?v(t,M,(function(e,t){var n;return Z.__xsjNewUrl=e,(n=b.find(".xsj_autopreview_yaml_cover_image")).attr("src",e),n[0].onload=function(){if(b.find(".xsj_autopreview_yaml_container").addClass(N),F)return n.css("object-position",F)},n[0].onerror=function(){return b.find(".xsj_autopreview_yaml_container").removeClass(N)}})):void 0;Z.__loadTimes<10&&setTimeout((function(){return Z.__xsjLoadFn(),Z.__loadTimes++}),1e3)},Z.__xsjLoadFn()}catch(e){e,console.log("\u5b58\u5728\u91cd\u53e0\uff0c\u5ffd\u7565\u521b\u5efa...",B,re)}E.onclick=function(s){var u,v,g,w,y,x,C,S,P;if(!(P=s.target).classList.contains("form-control")){if(s.preventDefault(),s.stopPropagation(),P.classList.contains("xsj_autopreview_yaml_tag_remove_btn"))return S=parseInt(P.dataset.index,10),(X=X.slice()).splice(S,1),C=e.getValue(),C=h.setMetaData(C,"tags",X.join(","),!1),t.set("tagNames",X),t.set("content",C),t.save(),Q=(Q=X||[]).map((function(e,t){return'<span class="xsj_autopreview_yaml_tag"><i class="xsj_autopreview_yaml_tag_remove_btn" data-index="'+t+'"></i>'+_.escape(e)+"</span>"})).join(","),b.find(".xsj_autopreview_yaml_tags").html(Q+' <span class="xsj_autopreview_yaml_tag_modify_btn"><i class="plus circle icon" title="\u6dfb\u52a0\u65b0\u6807\u7b7e"></i></span>');if(P.classList.contains("xsj_autopreview_yaml_tag"))return console.log("\u4e0d\u505a\u4efb\u4f55\u64cd\u4f5c");if(P.parentElement.classList.contains("xsj_autopreview_yaml_idiom_btn"))return g=new d,x=t.get("idiom")||"",g.show(x,(function(n){return C=e.getValue(),C=h.setMetaData(C,"idiom",n,!1,{forceQuotes:!0}),t.set("idiom",n),t.set("content",C),t.save()}));if(P.parentElement.classList.contains("xsj_autopreview_yaml_create_date"))return v=new l,y=t.get("createDate")||"",v.show(P.parentElement,y,(function(n){if(n)return C=e.getValue(),C=h.setMetaData(C,"createDate",moment(n).format("YYYY-MM-DD"),!1,{forceQuotes:!0}),t.set("createDate",n),t.set("content",C),t.save()}));if(P.parentElement.classList.contains("xsj_autopreview_yaml_color_btn"))return u=new o,w=t.get("color")||"",u.show(w,Z,(function(n){return C=e.getValue(),C=h.setMetaData(C,"color",n,!1,{forceQuotes:!0}),t.set("color",n),t.set("content",C),t.save()}));if(P.parentElement.classList.contains("xsj_autopreview_yaml_add_theme_btn"))return new f({fileModel:t}).show(P.parentElement.parentElement.parentElement.parentElement,te,(function(n){if(te!==n)return C=e.getValue(),C=h.setMetaData(C,"theme",n,!1),t.set("content",C),t.save(),te=n}));if(P.parentElement.classList.contains("xsj_autopreview_yaml_add_cover_btn"))return new a({fileModel:t}).show(M,Z,(function(n,i){var r,o;if(n)return C=e.getValue(),o="![]("+n+")",r=E.querySelector("img.xsj_autopreview_yaml_cover_image"),i?(F=i,o="![#"+i+"]("+n+")",r&&(r.style.objectPosition=i)):(F="",r&&(r.style.objectPosition="")),C=h.setMetaData(C,"cover",o,!1),t.set("cover",o),t.set("content",C),t.save()}));if(P.parentElement.classList.contains("xsj_autopreview_yaml_remove_emoji_btn"))return U=ne+Q+k+T+M+(I="")+D+R+te,oe=CryptoJS.MD5(U).toString(),Z.__uuid=oe,C=e.getValue(),C=h.setMetaData(C,"emoji","",!1),t.set("emoji",""),t.set("content",C),t.save(),b.find(".xsj_autopreview_yaml_emoji_modify_btn").addClass("blank_emoji").html(m);if(P.parentElement.classList.contains("xsj_autopreview_yaml_remove_theme_btn"))return C=e.getValue(),C=h.setMetaData(C,"theme","",!1),t.set("content",C),t.save(),i.homeView.changeTempTheme("");if(P.parentElement.classList.contains("xsj_autopreview_yaml_remove_cover_btn"))return C=e.getValue(),C=h.setMetaData(C,"cover","",!1),t.set("cover",""),t.set("content",C),t.save(),b.find(".xsj_autopreview_yaml_has_cover").removeClass(".xsj_autopreview_yaml_has_cover");if(P.parentElement.classList.contains("xsj_autopreview_yaml_emoji_modify_btn"))return(new c).show(P.parentElement.parentElement,I,(function(n){if(I!==n)return C=e.getValue(),C=h.setMetaData(C,"emoji",n,!1),t.set("emoji",n),t.set("content",C),t.save(),n?b.find(".xsj_autopreview_yaml_emoji_modify_btn").removeClass("blank_emoji").html("<i class='icon emoji_icon'>"+n+"</i>"):b.find(".xsj_autopreview_yaml_emoji_modify_btn").addClass("blank_emoji").html(m)}));if(P.classList.contains("xsj_autopreview_yaml_category_content"))return P.parentElement.querySelector(".xsj_autopreview_yaml_category_modify_btn>i.icon").click();if(P.parentElement.classList.contains("xsj_autopreview_yaml_category_modify_btn"))return(new r).show(P.parentElement.parentElement,k,(function(n){if(k!==n)return C=e.getValue(),C=h.setMetaData(C,"category",n,!1),t.set("category",n),t.set("content",C),t.save(),b.find(".xsj_autopreview_yaml_category").html('<span class="xsj_autopreview_yaml_category_content">'+_.escape(n)+'</span>\n<span class="xsj_autopreview_yaml_category_modify_btn" style="margin-left: .5em;"><i class="sitemap icon" title="\u4fee\u6539\u5206\u7c7b"></i></span>')}));if(P.parentElement.classList.contains("xsj_autopreview_yaml_tag_modify_btn"))return(new p).show(P.parentElement.parentElement,X,(function(n){var i,r;if(r=X.join(","),i=n?n.split(","):null,r!==n)return C=e.getValue(),C=h.setMetaData(C,"tags",n,!1),t.set("tagNames",i),t.set("content",C),t.save(),Q=(Q=i||[]).map((function(e,t){return'<span class="xsj_autopreview_yaml_tag"><i class="xsj_autopreview_yaml_tag_remove_btn" data-index="'+t+'"></i>'+_.escape(e)+"</span>"})).join(","),b.find(".xsj_autopreview_yaml_tags").html(Q+' <span class="xsj_autopreview_yaml_tag_modify_btn"><i class="plus circle icon" title="\u6dfb\u52a0\u65b0\u6807\u7b7e"></i></span>')}));if(P.classList.contains("xsj_autopreview_yaml_title")){if(P.classList.contains("xsj_autopreview_yaml_title_modify"))return;return P.classList.add("xsj_autopreview_yaml_title_modify"),P.contentEditable=!0,function(){var e,t,n;return e=P,t=document.createRange(),n=window.getSelection(),t.selectNode(e.childNodes[0]),n.removeAllRanges(),n.addRange(t)}(),P.onpaste=function(e){var t;return e.preventDefault(),t=$.trim(e.clipboardData.getData("text/plain")).replace(/\n+/g," "),document.execCommand("insertHTML",!1,t)},P.onblur=function(){var n;return P.contentEditable=!1,(n=$.trim(P.outerText).replace(/\n+/g," "))&&ne!==n&&(C=e.getValue(),C=h.setMetaData(C,"title",n),t.set("title",n),t.set("content",C),t.save()),P.classList.remove("xsj_autopreview_yaml_title_modify"),P.onblur=null,P.onkeypress=null,P.onpaste=null},P.onkeypress=function(e){if(13===e.keyCode)return P.blur()}}return n.setCursor({line:1,ch:0}),e.focus()}}}for(z in ee)ee[z].clear();return null}}}}},n.exports=u}}),window.requirejs.define({"lib/editor/autopreview/flow_preview":function(e,t,n){var i,r,o;i=t("../../utils_generate_chart"),o=t("./utils"),r=function(e){var t;return t=e.doc,{isBlock:!1,createElement:function(n,r){var a,s,l,c,u,d,p,f,h,m,v,g,_,w,y,b,x,k,D;if(r.text,d=null,(w=r.stateAfter)&&w.lookAhead&&(w=w.state),w&&w.inner&&w.inner.outer&&"flow"===(m=w.inner.outer).localModeName&&m.localModeLine===n&&(d={start:{line:n,ch:0},startStr:{line:n+1,ch:0}}),d){if(d&&d.start)for(g=Math.min(t.lastLine(),50)+n;n<g;){for(n++,t.getLine(n),c=e.getLineTokens(n)||[],l=0;l<c.length;)if(s=c[l],l++,(s.type||"").indexOf("formatting-code-block-close")>=0){d.end={line:n,ch:s.end},d.endStr={line:n,ch:0};break}if(d.end)break}if(d&&d.end){if(v=r.markedSpans||[],b={},v.forEach((function(e){var t;if((t=e.marker).__isFlowMarker&&t.__uuid)return b[t.__uuid]=t})),f=d.start,k=d.end,p=t.indexFromPos(f),x=t.indexFromPos(k),o.checkInRange(e,p,x))return null;if(_=t.getRange(d.startStr,d.endStr),D=CryptoJS.MD5(_).toString(),b[D])delete b[D];else{(a=$("<span class='xsj_autopreview_container xsj_autopreview_normal_block_container xsj_autopreview_svg_container xsj_autopreview_block_flow_container'></span>")).text(_),u=a.get(0);try{i.generateFlow(_,"svg",(function(e,t){return a.html(t),null!=y?y.changed(!0):void 0})),(y=t.markText(f,k,{replacedWith:u,clearOnEnter:!0,handleMouseEvents:!1,inclusiveLeft:!0,inclusiveRight:!0})).__uuid=D,y.__isFlowMarker=!0,y.__autopreviewType="flow",u.onclick=function(){var n,i;if(n=y.find())return i=n.from,y.clear(),i.ch+=3,t.setCursor(i),e.focus()}}catch(e){e,console.log("\u5b58\u5728\u91cd\u53e0\uff0c\u5ffd\u7565\u521b\u5efa...",f,k)}}for(h in b)b[h].clear();return null}}}}},n.exports=r}}),window.requirejs.define({"lib/editor/autopreview/footnote_preview":function(e,t,n){var i,r,o;t("../../../lib/utils"),t("../../../lib/utils_url"),r=t("./utils"),o=r.getMarkdownState,i=function(e){var t;return t=e.doc,{isBlock:!1,createElement:function(n,i,a){var s,l,c,u,d,p,f,h;if(s=i.text,d=[],u={},!r.checkIsInTable(a)){for(a=a.slice();l=a.shift();)if(h=l.type||"",(c=o(l.state))&&l&&"["===l.string&&c.linkText){switch(u.type="link",f=s.charAt(l.start-1),p=s.charAt(l.start+1),f){case"^":u.type="footnote",u.srcType="inline";break;default:u.type="link"}if("^"===p&&(u.type="footnote",u.srcType="ref"),"footnote"===u.type)for(u.start={ch:l.start},"inline"===u.srcType&&(u.start.ch=l.start-1);l=a.shift();)if((c=o(l.state))&&(h=l.type||"","]"===l.string&&h.indexOf(" formatting-link ")>=0)){u.end={ch:l.end},d.push(u),u={};break}}if(0!==d.length)return(i.markedSpans||[]).forEach((function(e){var t;if((t=e.marker).__isFootnoteMarker)return t.clear()})),d.forEach((function(i){var o,a,s,l,c,d,p,f,h;if(l={line:n,ch:i.start.ch},f={line:n,ch:i.end.ch},s=t.indexFromPos(l),p=t.indexFromPos(f),l!==f)return a=function(e,n,i,r){var o,a;o="string"==typeof i?{className:i}:{replacedWith:i&&"object"==typeof i?i:document.createElement("span"),clearOnEnter:!0,handleMouseEvents:!1,inclusiveLeft:!1,inclusiveRight:!1};try{return(a=t.markText(e,n,o)).__isFootnoteMarker=!0,a.__autopreviewType="footnote",r.push(a),a.on("clear",(function(){return r.map((function(e){return e.clear()}))}))}catch(t){return t,console.log("\u5b58\u5728\u91cd\u53e0\uff0c\u5ffd\u7565\u521b\u5efa...",e,n)}},r.checkInRange(e,s,p)?null:(d=[],h=e.getValue().substring(s,p),o="xsj_autopreview_footnote_btn","ref"===i.srcType&&(h="#^"+h+": ",o="xsj_autopreview_link_btn"),u.src=h,(c=document.createElement("span")).classList.add(o),"bookmark outline icon footnote_icon",c.innerHTML='<i class="bookmark outline icon footnote_icon"></i>',a(l,f,c,d),r.initPopupFn(e,d[0],h),c.onclick=function(e){return d.map((function(e){return e.clear()}))})})),null}}}},n.exports=i}}),window.requirejs.define({"lib/editor/autopreview/header_preview":function(e,t,n){var i;i=function(e){var t;return t=e.doc,{isBlock:!1,createElement:function(e,n,i){var r,o,a,s,l;if(s=n.text,o=[],i.forEach((function(t){if((t.type||"").indexOf("formatting-header")>=0)return o.push({token:t,start:{line:e,ch:t.start},end:{line:e,ch:t.end}})})),0!==o.length){if(r=t.getCursor(),l=[],(n.markedSpans||[]).forEach((function(e){var t;if((t=e.marker).__isHeaderMarker)return l.push(t)})),a=!1,1===i.length&&1===o.length&&s.match(/^ *(?:\={1,}|-{1,})\s*$/)&&r.line+1===e&&(a=!0),r.line===e||a)l.map((function(e){return e.clear()}));else{if(l.length>0)return;o.forEach((function(e){var n,i,r;n=e.start,r=e.end;try{return i=t.markText(n,r,{replacedWith:document.createElement("span"),clearOnEnter:!0,handleMouseEvents:!1,inclusiveLeft:!1,inclusiveRight:!1}),l.push(i),i.on("clear",(function(){return l.map((function(e){return e.clear()}))})),i.__isHeaderMarker=!0,i.__autopreviewType="header"}catch(e){return e,console.log("\u5b58\u5728\u91cd\u53e0\uff0c\u5ffd\u7565\u521b\u5efa...",n,r)}}))}return null}}}},n.exports=i}}),window.requirejs.define({"lib/editor/autopreview/hr_preview":function(e,t,n){var i,r;r=function(e){if(e)return e.lookAhead&&(e=e.state),e.inner.outer},i=function(e){var t;return t=e.doc,{isBlock:!0,createElement:function(n,i,o){var a,s,l,c,u,d;if(l=i.text,o&&!(o.length<=0)&&(c=r(o[0].state))){if(c.hr){(i.markedSpans||[]).forEach((function(e){var t;if((t=e.marker).__isHrMarker)return t.clear()})),a={line:n,ch:0},d={line:n,ch:l.length};try{(s=document.createElement("span")).innerHTML="<div class='autopreview_hr'></div>",(u=t.markText(a,d,{replacedWith:s,clearOnEnter:!0,handleMouseEvents:!1,inclusiveLeft:!0,inclusiveRight:!0})).__isHrMarker=!0,u.__autopreviewType="hr",s.onclick=function(){var n,i;if(n=u.find())return i=n.from,u.clear(),i.ch+=3,t.setCursor(i),e.focus()}}catch(e){e,console.log("\u5b58\u5728\u91cd\u53e0\uff0c\u5ffd\u7565\u521b\u5efa...",a,d)}}return null}}}},n.exports=i}}),window.requirejs.define({"lib/editor/autopreview/html_preview":function(e,t,n){var i,r,o,a,s,l,c;t("../../utils_generate_chart"),s=t("../../utils"),a=t("../../../lib/utils_url"),r=t("../../../lib/notifier"),o=t("./utils"),l=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","section","source","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"],c=function(e,t){var n,i,r,o;return n={html:!0,xhtmlOut:!0,breaks:!1,linkify:!0,typographer:!0},(i=window.markdownit(n)).use(window.markdownitWikilink),i.use(window.markdownitMark),r=t?i.render(e):i.renderInline(e),o=s.stripScripts(r,{convertIframeToWebview:!0}),(o=s.stripStyles(o.innerHTML)).innerHTML},i=function(e){var t;return t=e.doc,{isBlock:!1,createElement:function(n,i,s){var u,d,p,f,h,m,v,g,w;if(e.state.anchorHovers&&(e.state.anchorHovers.map((function(e){return e.classList.remove("xsj_anchor_range_hover")})),e.state.anchorHovers.length=0),i.text,v=[],m=null,!o.checkIsInTable(s)){if(s.forEach((function(e,t){var i,r;if((r=e.type||"").indexOf("html-open")>=0&&(m={block:!1,start:{line:n,ch:e.start,lineToken:e}},(i=s[t+1])&&l.indexOf(i.string)>=0&&(m.block=!0)),r.indexOf("html-close")>=0&&m)return m.end={lineToken:e,line:n,ch:e.end},v.push(m),m=null})),m&&m.start)for(w=Math.min(t.lastLine(),50)+n;n<w;){for(n++,p=e.getLineTokens(n)||[],d=0;d<p.length;)if(u=p[d],d++,(u.type||"").indexOf("html-close")>=0){m.end={lineToken:u,line:n,ch:u.end},v.push(m),m=null;break}if(!m)break}if(m||0!==v.length)return g=i.markedSpans||[],{},f=[],g.forEach((function(e){var t,n;if((n=e.marker).__isHtmlMarker)return t=n.find(),f.push({pos:t,str:n.__str,textMarker:n})})),h=function(e,t){var n;return(n=f.findIndex((function(n){var i;return i=n.pos,e.start.ch===i.from.ch&&e.end.ch===i.to.ch&&t===n.str})))>=0&&(f.splice(n,1),!0)},v.forEach((function(n){var i,s,l,u,d,p,f,m,v;if(d=n.start,v=n.end,u=t.indexFromPos(d),m=t.indexFromPos(v),o.checkInRange(e,u,m,!0))return null;if(p=t.getRange(d,v),!h(n,p)){l="xsj_autopreview_html_inline_container",n.block?(l="xsj_autopreview_html_block_container","<DIV><BR></DIV>"===p.toUpperCase()&&(l+=" xsj_autopreview_html_block_br_container")):"<BR>"===p.toUpperCase()&&(l+=" xsj_autopreview_html_inline_br_container"),(i=$("<span class='xsj_autopreview_container xsj_autopreview_html_container "+l+"'></span>")).html(c(p,n.block)),s=i.get(0);try{return(f=t.markText(d,v,{replacedWith:s,clearOnEnter:!0,handleMouseEvents:!1,inclusiveLeft:!1,inclusiveRight:!1,selectLeft:!0,selectRight:!1})).__str=p,f.__isHtmlMarker=!0,f.__autopreviewType="html",s.oncontextmenu=function(e){var t;(t=e.target).classList.contains("xsj_anchor")&&(e.preventDefault(),e.stopPropagation(),console.log("xsj_anchor",arguments),t.classList.contains("xsj_anchor_range")&&console.log("xsj_anchor_range"))},s.onmouseleave=function(){var t;if("function"==typeof(t=s.onmouseover).cancel&&t.cancel(),e.state.anchorHovers)return e.state.anchorHovers.map((function(e){return e.classList.remove("xsj_anchor_range_hover")})),e.state.anchorHovers.length=0},s.onmouseover=_.debounce((function(t){var n,i,r,o,a,s,l,c,u,d,p,f;if(p=t.target,e.state.anchorHovers&&(e.state.anchorHovers.map((function(e){return e.classList.remove("xsj_anchor_range_hover")})),e.state.anchorHovers.length=0),p.classList.contains("xsj_anchor_range")&&(s=p.id||p.name,d=e.getValue(),f=e.display.wrapper,n=$(f),l='<a class="xsj_anchor xsj_anchor_range xsj_anchor_range_start" name="'+s+'"></a>',r='<a class="xsj_anchor xsj_anchor_range xsj_anchor_range_end" name="'+s+'"></a>',c=d.indexOf(l)+l.length,o=d.indexOf(r),u=e.posFromIndex(c),a=e.posFromIndex(o),i=p.classList.contains("xsj_anchor_range_start")?n.find(".xsj_anchor_range_end[name="+s+"]")[0]:n.find(".xsj_anchor_range_start[name="+s+"]")[0],a&&u&&!e.getSelection()&&!t.shiftKey&&!t.ctrlKey&&!t.altKey))return e.setSelection(u,a,{scroll:!1}),setTimeout((function(){if(i)return n.find(".CodeMirror-selected").addClass("xsj_anchor_range_selected"),i.classList.add("xsj_anchor_range_hover"),e.state.anchorHovers=e.state.anchorHovers||[],e.state.anchorHovers.push(i)}),200)}),200),s.onclick=function(n){var i,o,l,c,u,d,p,h,m,v;if(n.preventDefault(),n.stopPropagation(),n.target,l=n.path||n.composedPath())for(u=0,p=l.length;u<p&&(m=l[u])!==s;u++)if("A"===m.tagName){if(m.classList.contains("xsj_anchor")&&(i=m.id||m.name))return v=(c=e.fileModel).get("title"),o="["+v+"](xsjapp://doc/"+c.id+"#"+i+")",$(document).one("copy",(function(e){return e.preventDefault(),e.stopPropagation(),e.originalEvent.clipboardData.setData("text/plain",o),r.showMessage("\u590d\u5236\u5f15\u7528\u6210\u529f")})),void document.execCommand("copy");if(m.href&&!a.isInternal(m.href))return void window.openTarget(m.href)}if(d=f.find())return h=d.from,f.clear(),h.ch+=2,t.setCursor(h),e.focus()}}catch(e){return e,console.log("\u5b58\u5728\u91cd\u53e0\uff0c\u5ffd\u7565\u521b\u5efa...",d,v)}}})),f.forEach((function(e){return e.textMarker.clear()})),null}}}},n.exports=i}}),window.requirejs.define({"lib/editor/autopreview/idiom_manager_view":function(e,t,n){var i,r,o,a,s,l,c={}.hasOwnProperty;i=t("../../../constant"),t("../../../application"),t("../../utils_emojis"),t("../../utils"),t("./utils_cover"),t("../../notifier"),t("../../resource_core"),l=null,a='<div class="ui primary button random_btn icon"><i class="icon fas fa-dice link"></i></div>',MINI_WEB&&(a=""),s='<i class="close icon"></i>\n<div class="content">\n<div class="ui segment" >\n    <div>\n      <i class="map signs icon" style="transform: scale(5) rotate(-10deg);overflow: visible;z-index: 10;position: relative;transform-origin: bottom;"></i>\n      \u968f\u4fbf\u5199\u4e24\u53e5\uff1a</div>\n    <div class="ui form">\n        <div class="field">\n            <div class="ui fluid icon">\n                <textarea maxlength=300 name="idiom" placeholder="\u968f\u4fbf\u5199\u4e24\u53e5..."></textarea>\n            </div>\n        </div>\n    </div>\n\n</div>\n</div>\n<div class="actions">\n\n    '+a+'\n    <div class="ui cancel button" >\n        \u53d6\u6d88\n    </div>\n    <div class="ui positive button">\n        <span >\u786e\u5b9a</span> \n    </div>\n</div>',o=function(e){return fetch(i.host+"/getrandomidiom?type=random&fver="+moment().format("YYYYMMDD")).then((function(e){return e.json()})).then((function(t){return e(t)})).catch((function(t){return e()}))},r=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)c.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,Backbone.View),t.prototype.className="ui modal",t.prototype.initialize=function(e){return l=this},t.prototype.events={"click .random_btn":"randomIdiomFn"},t.prototype.randomIdiomFn=function(){var e;if(!(e=this.$el.find(".random_btn")).hasClass("loading"))return e.addClass("loading"),o((function(t){var n;if(e.removeClass("loading"),t)return(n=l.$el.find("textarea[name=idiom]")).val(t.idiom),n[0].select()}))},t.prototype.show=function(e,t){var n,i,r,a;return this.$el.html(s),n=this.$el,i=n.find(".ui.form"),r=n.find('textarea[name="idiom"]'),i.form({onSuccess:function(){return t(r.val()||""),n.modal("hide")}}),!navigator.onLine||e||MINI_WEB||((a=this.$el.find(".random_btn")).addClass("loading"),o((function(e){if(a.removeClass("loading"),a.transition("jiggle"),e&&!r.val())return r.val(e.idiom),r[0].select()}))),n.modal({closable:!1,onVisible:function(){if(e)return r.val(e),r[0].select()},onHidden:function(){return n.modal("destroy"),l.remove(),l=null},onDeny:function(){return!0},onApprove:function(){return i.form("validate form"),!1}}).modal("show")},t}(),n.exports=r}}),window.requirejs.define({"lib/editor/autopreview/image_preview":function(e,t,n){var i,r,o,a,s,l,c,u,d,p,f,h,m,v,g,w,y,b,x,k=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};w=t("../../../lib/preview_core"),f=t("../../../lib/utils"),s=t("../../../lib/notifier"),p=t("../../../lib/utils_url"),l=t("./utils_pdf"),i=t("../../../lib/app_resource_core"),r=t("../../../models/app_resource_model"),o=t("../../../constant"),u=t("./utils"),d=t("../../../views/single_popup_manager_view"),c=t("../../../views/pdf_popup_manager_view"),m=u.getMarkdownState,x=function(e,t){var n,i,r;return n={html:!0,xhtmlOut:!0,breaks:!1,linkify:!0,typographer:!0},(i=window.markdownit(n)).use(window.markdownitWikilink),i.use(window.markdownitMark),r=i.renderInline(e),f.stripScripts(r).innerText},g=function(e){var t,n,i;return null==e&&(e=""),i=null,n=null,t=e.replace(/\s+=([\d]*)[xX\*]([\d]*)\s*$/,(function(e,t,r){return i=t,n=r,""})),{width:i,height:n,description:t}},y={},v=function(e,t,n){return w.getUrlInfo(e,t,{parseClientLocalMedias:!0},(function(o,a){var s;return o?n(t):/\.pdf$/i.test(a.filename)&&/^blob:/i.test(a.url)&&a.filesize<104857600?(s="pdf_preview_"+e.id+":::"+t,y[s]?(a.pdfCoverURL=y[s],n(a.url,a)):i.getResource(s,(function(e,t){var i;return t?(i=window.URL.createObjectURL(t.data),y[s]=i,a.pdfCoverURL=i,n(a.url,a)):l.generateCoverFn(a.url,(function(e,t){var o;return t?(o=t.data,r.createResource(s,a.filename+".png",o.type,o,(function(e,t){return t&&(i=window.URL.createObjectURL(t.get("_attachments").attachment.data),y[s]=i,a.pdfCoverURL=i),n(a.url,a)}))):n(a.url,a)}))}))):n(a.url,a)}))},h=function(e){var t,n,i;return null==e&&(e=""),i=/[!=%~]\[([^\]]*)\]/,(n=e.match(i))?(t=n[1],x(t)):""},b=function(e,n,i){return t("../../../lib/dynamic_import/import_blueimp_gallery")((function(){return blueimp.Gallery(e,{index:n,slideLoadingClass:"ui loader slide-loading",onslide:function(t,n){var i,r,o,a;return this,i=$(this.container[0]),r=null,(a=e[t])&&(o=a.src,r=f.getExt(o,1).toUpperCase()),".JPG"===r||".JPEG"===r||".PNG"===r?i.find(".edit>i").show():i.find(".edit>i").hide()},onopen:function(){var t,n;return n=this,(t=$(n.container[0])).on("click",".rotate",(function(e){return e.preventDefault(),e.stopPropagation(),n.rotate(90)})),t.on("click",".edit",(function(t){var r,o,a;return t.preventDefault(),t.stopPropagation(),a=n.getIndex(),r=null,(o=e[a])&&(r=o.src),d.showPopupView("image",{fileModel:i,link:decodeURI(r),operateType:"save"}),n.close()})),t.on("click",".download",(function(t){var i,r;return t.preventDefault(),t.stopPropagation(),r=n.getIndex(),i=e[r],f.getCrossOrignDomainResource(i.href,(function(e,n){var r,o,a;if(e)return s.showMessage("\u4e0b\u8f7d\u51fa\u9519:"+e,6e3,"error");o=f.dataURL2Blob(n),r=".png";try{i.src&&(r=f.getExt(i.src)),r||(r="."+n.split(";")[0].split("/")[1].split("+")[0])}catch(e){t=e,r=".png"}return a=i.title||"\u672a\u547d\u540d\u6587\u4ef6",saveAs(o,a+r)}))}))},onclosed:function(){var e;return this,(e=$(this.container[0])).off("click",".rotate"),e.off("click",".edit"),e.off("click",".download")}})}))},a=function(e){var t,n;return n=e.doc,t=e.fileModel,{isBlock:!1,createElement:function(r,a,l,w){var y,x,D,C,F,M,T,S,P,j,E,I;for(F=a.text,E=e.getLine(r-1)||"",C=!1,""===$.trim(E)&&["!","%"].indexOf($.trim(F).charAt(0))>=0&&(C=!0),j=[],P={},l=l.slice();M=l.shift();)if(I=M.type||"",T=m(M.state)){if(T.table)break;if(T.image&&T.imageMarker)for(P.type="image",P.block=C,C=!1,P.start={ch:M.start};M=l.shift();)if((T=m(M.state))&&(I=M.type||"",T.linkHref&&I.indexOf("formatting")<0&&(P.src=M.string),I.indexOf("formatting-link-string")>=0&&(")"===M.string&&(P.srcType="direct"),"]"===M.string&&(P.srcType="ref"),P.srcType))){P.end={ch:M.end},P.str=F.substring(P.start.ch,P.end.ch),j.push(P),P={};break}}if(0!==j.length){if(S=a.markedSpans||[],D=[],y=[],S.forEach((function(e){var t,n,i,r;if((t=e.marker).__imgTextMarker)return(i=(n=t.__imgTextMarker).find())&&(i.from||(i={from:i,to:i})),i&&(r=j[y.length])&&r.str===n.__str?y.push({pos:i,str:n.__str}):D.push(t)})),j.length!==y.length||0!==D.length)return x=function(e){return!!y.find((function(t){var n;return n=t.pos,e.start.ch===n.from.ch&&e.end.ch===n.to.ch&&e.str===t.str}))},j.forEach((function(a){var l,m,y,C,F,M,T,S,P,j,E,I,O,V,L,A,B,N,R,H;if(R=$.trim(a.src),m="","ref"===a.srcType&&(R=$.trim(f.getReference(e.getValue(),R))),R&&((H=R.indexOf(" "))>0&&(m=R.substring(H+1),R=R.substring(0,H),m=m.replace(/^['"]|['"]$/g,"")),R)){if(j={line:r,ch:a.start.ch},N={line:r,ch:a.end.ch},P=n.indexFromPos(j),B=n.indexFromPos(N),C=null,(F=D.findIndex((function(e){return e.__xsjurl===R&&e.__isBlock===a.block})))>=0&&(C=D.splice(F,1)[0]),u.checkInRange(e,P,B))return null;if(!x(a)){switch(A=null,C&&C.__imgTextMarker&&C.__imgTextMarker.find()?A=C.__imgTextMarker:((A=n.markText(j,N,{replacedWith:document.createElement("span"),clearOnEnter:!0,handleMouseEvents:!1,inclusiveLeft:!1,inclusiveRight:!1})).__str=a.str,A.__autopreviewType="image"),S=f.getExt(R,1),y=!1,V="image",a.str.charAt(0)){case"%":V="video";break;case"~":V="audio";break;case"=":V="attachment";break;default:V="image"}return w.previewSet.renderAutoDetectAttachment&&S&&(L=S.toUpperCase(),k.call(o.imageExts,L)<0)&&(y=!0),I=function(e){var n,i,r,o,a,s,l;return a={},(o=t.mediaNaturalSizeCache[R])&&(a.width=o.width,a.height=o.height),w.resultConfig.imgSize&&(r=e.width,i=e.height,n=0,o&&o.width&&o.height&&(n=o.width/o.height),l=r,s=i,(i||r)&&(n>0&&(i||(s=r/n),r||(l=i*n)),l&&(a.width=l),s&&(a.height=s))),a},E=function(e){var t,n,i;return t=g(e),n="",(i=I(t)).width&&(n=" width="+i.width+" "),i.height&&(n+=" height="+i.height+" "),n},C?(C.__imgTextMarker=A,C.__str===a.str&&C.__altTitle===m||(C.__str=a.str,C.__altTitle=m,C.__xsjRenderFigureFn())):(T="xsj_autopreview_inline_image_container",a.block&&(T="xsj_autopreview_block_image_container"),S.endsWith(".html")&&(T="xsj_autopreview_block_image_container"),O=E(h(a.str)),l=$("<span class='xsj_autopreview_container "+T+"'><img class='xsj_autopreview_image xsj_autopreview' draggable=false "+O+"/><span class='xsj_autopreview_loader'><i class='spinner loading icon'></i></span></span>"),M=l.get(0),(C=e.setBookmark(N,{widget:M,handleMouseEvents:!1})).__imgTextMarker=A,C.__xsjurl=R,C.__loadTimes=0,C.__isBlock=a.block,C.__altTitle=m,C.__str=a.str,C.__xsjRenderFigureFn=function(){var e,t,n,i,r,o,a;return this,r={width:0,height:0,description:h(this.__str)},w.resultConfig.imgSize&&(r=g(h(this.__str))),1===(e=(n=$(this.replacedWith)).find(".xsj_autopreview_image_attachment_container .file_desciption>.filename")).length?((i=this.__altTitle)||(i=r.description),void(i&&e.text(i))):(w.resultConfig.imgSize&&(t=n.find("img.xsj_autopreview_image"),(o=I(r)).width&&t.attr("width",o.width),o.height&&t.attr("height",o.height)),this.__isBlock&&0!==n.find(".xsj_autopreview_block_image_figure").length?(a="",(i=this.__altTitle)||(i=r.description),i&&(a="<span>"+_.escape(i)+"</span>"),n.find(".xsj_autopreview_block_image_figure").html(a)):void 0)},C.__xsjLoadFn=function(){if(!t.isXSJFake)return C.__loadTimes=0,v(t,R,(function(n,i){var r,o,s,c,u,d,p,f,m,v,w,b,x;return"https://markdown.xiaoshujiang.com/img/spinner.gif"===n&&(n="./img/spinner.gif"),C.__xsjNewUrl=n,"video"===V?(w=0,i&&(w=i.filesize||0),x='<video class="xsj_autopreview_video xsj_autopreview_image" src="'+n+'" '+O+' controls></video>\n<span class="xsj_autopreview_delete_image_btn">\n  <div class="ui button icon delete_image_btn">\n    <i class="icon trash"></i>\n  </div>\n  <span class="xsj_autopreview_image_file_size">'+(w?filesize(w):"")+"</span>\n</span>",l.html(x),(b=l.find(".xsj_autopreview_video")[0]).addEventListener("loadedmetadata",(function(){return t.mediaNaturalSizeCache[R]={type:"video",width:b.videoWidth,height:b.videoHeight},b.setAttribute("width",b.videoWidth),b.setAttribute("height",b.videoHeight)}))):"audio"===V?(w=0,i&&(w=i.filesize||0),c='<audio class="xsj_autopreview_audio xsj_autopreview_image" src="'+n+'" controls></audio>\n<span class="xsj_autopreview_delete_image_btn">\n  <div class="ui button icon delete_image_btn">\n    <i class="icon trash"></i>\n  </div>\n  <span class="xsj_autopreview_image_file_size">'+(w?filesize(w):"")+"</span>\n</span>",l.html(c)):/(drawio|table)\.html$/gi.test(R)?$.get(n).done((function(e,t,n){return l.html('<div class="xsj_autopreview_image_component_container">'+e+"</div>"),l.append('<span class="xsj_autopreview_delete_image_btn">\n  <div class="ui button icon delete_image_btn icon">\n    <i class="icon trash"></i>\n  </div>\n  <div class="ui button edit_image_btn icon"><i class="edit icon"></i></div>\n</span>'),null!=C?C.changed(!0):void 0})).fail((function(){var e;return e=$("<span class='xsj_autopreview_image xsj_autopreview xsj_image_error'></span>"),l.html(e),null!=C?C.changed(!0):void 0})):y&&i?(v=(f=i.filename||"").substring(f.lastIndexOf("/")+1),u=g(h(C.__str)),v=C.__altTitle||u.description||v||"\u9644\u4ef6",w=i.filesize||0,d="fa fa-paperclip fa-2x",o="",/\.pdf$/i.test(f)&&(d="far fa-file-pdf fa-2x",i.pdfCoverURL&&e.editorModel&&e.editorModel.get("cm_previewPDF")&&(o='<span class="xsj_autopreview_pdf_preview_container">\n  <span class="xsj_autopreview_pdf_preview_btns_container">\n    <div class="ui button icon view_pdf_btn">\n      <i class="file pdf icon"></i>\n    </div>\n  </span>\n  <span class="xsj_autopreview_pdf_preview_image_container">\n    <img src="'+i.pdfCoverURL+'" class="xsj_autopreview_pdf_preview_image"/>\n  </span>\n</span>')),s='<div class="ui button icon delete_image_btn">\n  <i class="icon trash"></i>\n</div>\n<a class=\'xsj_autopreview_image_attachment_container\' href=\''+i.url+"' name='"+_.escape(f)+"' data-size='"+w+"' title='"+_.escape(v)+"'>\n  <i class=\""+d+' file_icon"></i>\n  <span class="file_desciption">\n    <span class="filename">'+_.escape(v)+'</span>\n    <span class="filesize">'+filesize(w)+"</span>\n  </span>\n</a>\n"+o,l.removeClass("xsj_autopreview_block_image_container"),l.addClass("xsj_autopreview_attachment_container"),l.html(s),null!=(m=l[0].querySelector(".xsj_autopreview_pdf_preview_image_container>img"))?m.onload=function(){return null!=C?C.changed(!0):void 0}:void 0):(r=$("<img class='xsj_autopreview_image xsj_autopreview' draggable=false "+O+">").attr("src",n),p=r.get(0),w=0,i&&i.filesize&&(w=i.filesize),p.addEventListener("load",(function(){var e,n,i;return t.mediaNaturalSizeCache[R]={type:"image",width:p.naturalWidth,height:p.naturalHeight},(n=I(g(h(self.__str)))).width&&p.setAttribute("width",n.width),n.height&&p.setAttribute("height",n.height),l.find(".xsj_autopreview_loader").remove(),i="",a.block?(e='<div class="ui button show_gallery_btn"><i class="zoom-in icon"></i></div>',(/(jpg|jpeg|png)$/i.test(S)||/drawio\.svg$/i.test(R))&&(e='<div class="ui button edit_image_btn"><i class="edit icon"></i></div><div class="ui button show_gallery_btn"><i class="zoom-in icon"></i></div>'),l.append('<div class="xsj_autopreview_block_image_figure"></div>\n<span class="xsj_autopreview_block_image_btns"><div class="ui icon buttons">'+e+"</div></span>")):p.naturalWidth>100&&(i='<div class="ui button show_gallery_btn icon"><i class="zoom-in icon"></i></div>'),C.__xsjRenderFigureFn(),l.append('<span class="xsj_autopreview_delete_image_btn">\n  '+i+'\n  <div class="ui button icon delete_image_btn">\n    <i class="icon trash"></i>\n  </div>\n  <span class="xsj_autopreview_image_file_size">'+(w?filesize(w):"")+"</span>\n</span>"),null!=C?C.changed(!0):void 0}),!1),p.onerror=function(){return l.find(".xsj_autopreview_loader").remove(),r.replaceWith("<span class='xsj_autopreview_image xsj_autopreview xsj_image_error'></span>"),null!=C?C.changed(!0):void 0},l.html(r),l.append("<span class='xsj_autopreview_loader'><i class='spinner loading icon'></i></span>"))}));C.__loadTimes<10&&setTimeout((function(){return C.__xsjLoadFn(),C.__loadTimes++}),1e4*C.__loadTimes+1e3)},C.__isImageMarker=!0,C.__disableTypeWriterScroll=!0,C.__autopreviewType="image",C.__xsjLoadFn()),C.replacedWith.onclick=function(r){var o,a,l,u,h,m,v,g,w,y,x,k,D,$,F,T,S,P;if(r.stopImmediatePropagation(),r.preventDefault(),r.stopPropagation(),S=r.target,u=r.path||r.composedPath())for(w=0,k=u.length;w<k&&(F=u[w])!==M;w++)if("A"===F.tagName&&F.href&&!/^blob:/.test(F.href)&&!p.isInternal(F.href))return void window.openTarget(F.href);if(S.classList.contains("xsj_autopreview_image_attachment_container")){if(m=C.__xsjurl,h=t.get("fileMap")||{},"xsjurl"!==f.validateUrlPath(m).result&&(P=p.splitHashTag(m),h[P.url]&&(m=h[P.url])),"xsjurl"===f.validateUrlPath(m).result){0===(v=(v=m).replace(/^\.*\/*/,"")).indexOf("./")&&(v=v.substring(2));try{v=decodeURI(v)}catch(e){r=e,console.error("error filename:"+v)}if(o=f.getExt(v),t.hasAttachment(v)&&/\.pdf$/i.test(o))return void c.showPopupView(t.id+"__"+v,{})}return v=C.__xsjurl,o=f.getExt(v,1),/\.pdf$/i.test(o)&&(P=p.splitHashTag(v),confirm("\u8be5\u6587\u4ef6\u4e3a pdf \u6587\u4ef6\uff0c\u662f\u5426\u4e0b\u8f7d\u4e0b\u6765\u8fdb\u884c\u6279\u6ce8\u9605\u8bfb\u3002\u4e0b\u8f7d\u5730\u5740\uff1a"+decodeURI(P.url)))?("text/plain",l=new Blob([P.url],{type:"text/plain"}),a={attachmentMeta:{subType:"linkFile"},fixRepeatFilename:!1},s.showHandling("PDF \u6587\u4ef6\u4e0b\u8f7d\u4e2d...("+_.escape(decodeURI(P.url))+")"),void fetch(p.covertGithubUrl(P.url)).then((function(e){if(e.status<200||e.status>300)throw"\u4e0b\u8f7d\u51fa\u9519:"+e.status+"("+e.statusText+")";return e.blob()})).then((function(e){return f.blobToMd5(e,(function(n,r){var u;return u="attachments/"+r+o,i.createResource(P.url,r+o,e.type,e,(function(e,n){return t.addAttachment(l,u,"text/plain",a,(function(e,n,i,r){return s.hideHandling(),h[P.url]=u,t.save({fileMap:Object.assign({},h)},{isForce:!0}),c.showPopupView(t.id+"__"+u,{})}))}))}))})).catch((function(e){return s.hideHandling(),s.showMessage("\u4e0b\u8f7d PDF \u6587\u4ef6\u51fa\u9519\uff1a"+e,6e3,"error")}))):(g=S.getAttribute("href"),D=S.getAttribute("name"),T=(T=D.substring(D.lastIndexOf("/")+1))||"\u9644\u4ef6",void f.objectURLToBlob(g,(function(e,t){return saveAs(t,T)})))}if("I"===S.tagName&&S.classList.contains("icon")&&(S=S.parentElement),!S.classList.contains("view_pdf_btn")){if(S.classList.contains("button")){if(S.classList.contains("show_gallery_btn"))return void b([{title:"",href:C.__xsjNewUrl,thumbnail:C.__xsjNewUrl,src:C.__xsjurl}],0,t);if(S.classList.contains("edit_image_btn"))return o=f.getExt(C.__xsjurl),void(/drawio/i.test(o)?d.showPopupView("drawio",{fileModel:t,link:decodeURI(C.__xsjurl)}):/table/i.test(o)?d.showPopupView("table",{fileModel:t,link:decodeURI(C.__xsjurl)}):d.showPopupView("image",{fileModel:t,link:decodeURI(C.__xsjurl),operateType:"save"}));if(S.classList.contains("delete_image_btn"))return void((x=C.find())&&(C.clear(),A.clear(),j={line:x.line,ch:x.ch-C.__str.length},e.replaceRange("",j,x),n.setCursor(j),e.focus()))}return(x=A.find())?($=x.from,A.clear(),$.ch+=2,n.setCursor($),e.focus()):void 0}(y=S.closest(".xsj_autopreview_attachment_container").querySelector(".xsj_autopreview_image_attachment_container"))&&y.click()}}}})),D.map((function(e){return e.clear()})),null}else(S=a.markedSpans||[]).filter((function(e){var t;return!(!(t=e.marker)||!t.__imgTextMarker)})).map((function(e){var t;if(t=e.marker)return t.clear()}))}}},n.exports=a}}),window.requirejs.define({"lib/editor/autopreview/index":function(e,t,n){var i,r,o,a,s,l,c,u,d,p,f,h,m;i=t("./codemirror_autopreview"),d=function(e,t,n){var i,r,o,a;if(i=e.state.autopreview){for(a=t.line,r=n.line,o=[];a<=r;)i.addToAutopreviewQueue(a,!1,!0),o.push(a++);return o}},f=function(e,t,n){var i,r;if(i=e.state.autopreview)return r=e.doc.getLineNumber(t),i.addToAutopreviewQueue(r)},r=_.debounce((function(e){return e.eachLine((function(e){return(e.markedSpans||[]).forEach((function(e){var t;if((t=e.marker)&&t.__tocurl)return t.__tocLoadFn()}))}))}),500),c=function(e,t){var n,i;if(n=e.state.autopreview)return t&&t.text&&("setValue"===t.origin&&t.text.forEach((function(e,t){if(t<=2e3)return n.addToAutopreviewQueue(t,!1,!0)})),"paste"===t.origin&&(i=t.from.line,t.text.forEach((function(e,t){if(t<=2e3)return n.addToAutopreviewQueue(t+i,!1,!0)}))),t.origin||(m(e),t.from&&t.to&&(i=t.from.line,t.text.forEach((function(e,t){if(t<=200)return n.addToAutopreviewQueue(t+i,!0,!0)}))))),n.runAutopreviewQueue(!0),r(e)},p=function(e,t){return c(e,{origin:"setValue"})},o=_.debounce((function(e){if(e)return e.runAutopreviewQueue(!0,!0)}),10),u=function(e,t){var n,i;if(n=e.state.autopreview)return i=e.getCursor(),n.addToAutopreviewQueue(i.line,i,!0),o(n)},l=function(e,t){var n,i,r,o,a;if(n=e.state.autopreview)return i=e.getCursor(),n.addToAutopreviewQueue(i.line,i,!0),a=e.getViewport(),(r=t.ranges)&&(o=[],r.forEach((function(e){var t,i,r,s;for(t=Math.min(e.anchor.line,e.head.line),i=Math.max(e.anchor.line,e.head.line),r=t,s=[];r<=i;)o.push(r),r>=a.from&&r<=a.to&&n.addToAutopreviewQueue(r,!1,!0),s.push(r++);return s})),n.setSelectionLines(o)),(r=e.doc.listSelections())?r.forEach((function(e){var t,i,r,o;for(t=Math.min(e.anchor.line,e.head.line),i=Math.max(e.anchor.line,e.head.line),r=t,o=[];r<=i;)r>=a.from&&r<=a.to&&n.addToAutopreviewQueue(r,!1,!0),o.push(r++);return o})):void 0},m=function(e,t){var n,i,r,o;if(n=e.state.autopreview){for(r=(o=e.getViewport()).from,i=[];r<=o.to;)n.addToAutopreviewQueue(r,!0),i.push(r++);return i}},h=function(e,t){var n;if(n=e.state.autopreview)return n.runAutopreviewQueue(!0)},s=function(e,t,n,i){return e.getViewport(),e.eachLine((function(e){return(e.markedSpans||[]).forEach((function(e){var t;if((t=e.marker)&&t.__xsjurl&&t.__xsjurl.indexOf(n)>=0)return t.__xsjLoadFn()}))}))},a=function(e,t){var n,i,r,o;if((n=e.state.autopreview)&&t&&t.changed){for(i in o=[],r=t.changed)r[i],("title"===i||"tagNames"===i||"category"===i||"color"===i||"cover"===i||"idiom"===i||"emoji"===i)&&o.indexOf(0)<0&&o.push(0);if(o.length>0)return o.forEach((function(e){return n.addToAutopreviewQueue(e,!1,!0)})),n.runAutopreviewQueue(!0)}},CodeMirror.defineOption("autopreview",!1,(function(e,t,n){if(n&&n!==CodeMirror.Init&&e.state.autopreview){if(t)return void e.state.autopreview.changeConfig(t);e.off("change",c),e.off("refresh",p),e.off("viewportChange",h),e.off("renderLine",f),e.off("cursorActivity",u),e.off("beforeSelectionChange",l),e.off("attachmentChange",s),e.off("articleAttributeChange",a),e.off("fold",d),e.getWrapperElement().classList.remove("xsj_autopreview_mode"),e.getWrapperElement().classList.add("xsj_normal_mode"),e.state.autopreview.destroy(),e.state.autopreview=null}if(t)return e.state.autopreview=new i(e,"object"==typeof t?t:{}),e.on("change",c),e.on("refresh",p),e.on("viewportChange",h),e.on("renderLine",f),e.on("cursorActivity",u),e.on("beforeSelectionChange",l),e.on("attachmentChange",s),e.on("articleAttributeChange",a),e.on("fold",d),e.getWrapperElement().classList.add("xsj_autopreview_mode"),e.getWrapperElement().classList.remove("xsj_normal_mode"),e.state.autopreview.enableAutopreview()}))}}),window.requirejs.define({"lib/editor/autopreview/inline_preview":function(e,t,n){var i,r,o;o=t("../../../lib/utils"),r=t("./utils"),i=function(e){var t,n;return t=e.doc,n=["highlight","strong","em","strikethrough","underline"],{isBlock:!1,createElement:function(i,a,s){var l,c;if(a.text,c=[],l={},!r.checkIsInTable(s)&&(s.forEach((function(e){var t;return t=e.type||"",n.forEach((function(n){if(t.indexOf(" formatting-"+n+" ")>=0)return l[n]?(l[n].end={from:e.start,to:e.end,token:e},c.push(l[n]),delete l[n]):l[n]={type:n,start:{from:e.start,to:e.end,token:e}}}))})),0!==c.length))return(a.markedSpans||[]).forEach((function(e){var t;if((t=e.marker).__isInlineMarker)return t.clear()})),c.forEach((function(n){var a,s,l,c,u,d,p,f,h,m,v,g;if(d={ch:n.start.from,line:i},v={ch:n.start.to,line:i},p={ch:n.end.from,line:i},g={ch:n.end.to,line:i},v.ch!==p.ch)return u=t.indexFromPos(d),m=t.indexFromPos(g),c=function(e,n,i,r){var o,a;o={replacedWith:document.createElement("span"),clearOnEnter:!0,handleMouseEvents:!1,inclusiveLeft:!1,inclusiveRight:!1},i&&(o="string"==typeof i?{className:i}:i);try{return(a=t.markText(e,n,o)).__isInlineMarker=!0,a.__autopreviewType="inline",r.push(a),a.on("clear",(function(){return r.map((function(e){return e.clear()}))}))}catch(t){return t,console.log("\u5b58\u5728\u91cd\u53e0\uff0c\u5ffd\u7565\u521b\u5efa...",e,n)}},f=[],"highlight"===n.type&&(l=t.getRange(p,g),h={},(l=$.trim(l.replace("==","")))&&(a=o.getBackgroundColor(l),s="cm-custom-highlight","#000000"===l&&(s+=" cm-black-placeholder-highlight"),"#ffffff"===l.toLowerCase()&&(s+=" cm-white-placeholder-highlight"),h={css:"color:"+l+";background-color:"+a,className:s}),c(d,g,h,f)),r.checkInRange(e,u,m)?(c(d,v,"xsj_autopreview_cursor_in_range",f),c(p,g,"xsj_autopreview_cursor_in_range",f)):(c(d,v,null,f),c(p,g,null,f))})),null}}},n.exports=i}}),window.requirejs.define({"lib/editor/autopreview/link_preview":function(e,t,n){var i,r,o,a,s;a=t("../../../lib/utils"),o=t("../../../lib/utils_url"),r=t("./utils"),s=r.getMarkdownState,i=function(e){var t;return t=e.doc,{isBlock:!1,createElement:function(n,i,l){var c,u,d,p,f,h,m,v,g,_;if(c=i.text,f=[],p={},!r.checkIsInTable(l)){for(l=l.slice();u=l.shift();)if(v=u.type||"",d=s(u.state)){if(d.image&&d.imageMarker)for(p.type="image",p.start={ch:u.start};u=l.shift();)if((d=s(u.state))&&(v=u.type||"",d.linkHref&&v.indexOf("formatting")<0&&(p.src=u.string),v.indexOf("formatting-link-string")>=0&&(")"===u.string&&(p.srcType="direct"),"]"===u.string&&(p.srcType="ref"),p.srcType))){p.end={ch:u.end},p={};break}if(d.wikilink)for(p.type="wiki",p.start={from:u.start,to:u.end+1},l.shift();u=l.shift();)if(d=s(u.state)){if(v=u.type||"",d.linkHref&&(g=_=u.string,(h=_.lastIndexOf("|"))>=0&&(_=_.substring(h+1),g=g.substring(0,h),p.start.to+=h+1,p.src=g),!g)){p={};break}if(v.indexOf("formatting-link-string")>=0){p.end={from:u.start,to:u.end+1},l.shift(),f.push(p),p={};break}}if(u&&"["===u.string&&d.linkText){switch(p.type="link",c.charAt(u.start-1)){case"%":p.type="video";break;case"~":p.type="audio";break;case"=":p.type="attachment";break;default:p.type="link"}for("link"===p.type?p.start={from:u.start,to:u.end}:p.start={from:u.start-1,to:u.end};u=l.shift();)if((d=s(u.state))&&(v=u.type||"","]"===u.string&&v.indexOf(" formatting-link ")>=0&&(p.end={from:u.start}),d.linkHref&&v.indexOf("formatting")<0&&(p.src=u.string),v.indexOf(" formatting-link-string ")>=0&&p.end&&(")"===u.string&&(p.srcType="direct",(m=p.src.indexOf(" "))>0&&(p.src=p.src.substring(0,m))),"]"===u.string&&(p.srcType="ref"),p.srcType))){p.end.to=u.end,f.push(p),p={};break}}}if(0!==f.length)return(i.markedSpans||[]).forEach((function(e){var t;if((t=e.marker).__isLinkMarker)return t.clear()})),f.forEach((function(i){var s,l,c,u,d,p,f,h,m,v,g,_;if(c={ch:i.start.from,line:n},v={ch:i.start.to,line:n},u={ch:i.end.from,line:n},g={ch:i.end.to,line:n},v.ch!==u.ch){if(l=t.indexFromPos(c),m=t.indexFromPos(g),s=function(e,n,i,r){var o,a;o="string"==typeof i?{className:i}:{replacedWith:i&&"object"==typeof i?i:document.createElement("span"),clearOnEnter:!0,handleMouseEvents:!1,inclusiveLeft:!1,inclusiveRight:!1};try{return(a=t.markText(e,n,o)).__isLinkMarker=!0,a.__autopreviewType="link",r.push(a),a.on("clear",(function(){return r.map((function(e){return e.clear()}))}))}catch(t){return t,console.log("\u5b58\u5728\u91cd\u53e0\uff0c\u5ffd\u7565\u521b\u5efa...",e,n)}},r.checkInRange(e,l,m))return s(c,v,"xsj_autopreview_cursor_in_range",h=[]),s(u,g,"xsj_autopreview_cursor_in_range",h);switch(s(c,v,null,h=[]),_=i.src,"ref"===i.srcType&&(_=a.getReference(e.getValue(),_)),p=!o.isInternal(_),(f=document.createElement("span")).classList.add("xsj_autopreview_link_btn"),i.type){case"audio":d="file audio outline icon";break;case"video":d="file video outline icon";break;case"attach":d="file archive outline icon";break;case"wiki":d="file word outline icon";break;default:d="file alternate outline icon",p&&(d=o.getIconName(_))}return f.innerHTML='<i class="'+d+'"></i>',s(u,g,f,h),r.initPopupFn(e,h[1],_),f.onclick=function(e){return p?o.openTarget(_)?void 0:window.openTarget(_):h.map((function(e){return e.clear()}))}}})),null}}}},n.exports=i}}),window.requirejs.define({"lib/editor/autopreview/mathjax_preview":function(e,t,n){var i,r,o;t("../../utils_generate_chart"),r=t("./utils_worker_mathjax"),o=t("./utils"),i=function(e){var t;return t=e.doc,{isBlock:!1,createElement:function(n,i,a){var s,l,c,u,d,p,f,h;if(i.text,p=[],d=null,!o.checkIsInTable(a)&&(a.forEach((function(e){var t;if((t=e.type||"").indexOf("mathjax-open")>=0&&(d={start:{line:n,ch:e.start,lineToken:e}}),t.indexOf("mathjax-close")>=0&&d)return d.end={lineToken:e,line:n,ch:e.end},"$$"===e.string?d.type="block":d.type="inline",p.push(d),d=null})),d&&d.start&&("xsjBlockMathjax"!==(h=(s=d.start.lineToken.state.inner.innerActive).name)&&"normalBlockMathjax"!==h||(f=Math.min(t.lastLine(),200),t.iter(n+1,n+f,(function(t){var n,i,r;switch(n=t.text,s.name){case"xsjBlockMathjax":if($.trim(n).match(/^[~`]{3,}$/))return i=e.getLineNumber(t),d.end={line:i,ch:n.length},!0;break;case"normalBlockMathjax":if((r=n.indexOf("$$"))>=0)return i=e.getLineNumber(t),d.end={line:i,ch:r+2},!0}})),d.end&&(d.type="block",p.push(d))),d=null),d||0!==p.length))return u=i.markedSpans||[],l=[],u.forEach((function(e){var t,n;if((n=e.marker).__isMathMarker)return t=n.find(),l.push({pos:t,str:n.__str,textMarker:n})})),c=function(e,t){var n;return(n=l.findIndex((function(n){var i;return i=n.pos,e.start.ch===i.from.ch&&e.end.ch===i.to.ch&&t===n.str})))>=0&&(l.splice(n,1),!0)},p.forEach((function(n){var i,a,s,l,u,d,p,f,h;if(u=n.start,h=n.end,l=t.indexFromPos(u),f=t.indexFromPos(h),o.checkInRange(e,l,f))return null;if(d=t.getRange(u,h),!c(n,d)){s="xsj_autopreview_inline_mathjax_container","block"===n.type&&(s="xsj_autopreview_block_mathjax_container"),(i=$("<span class='xsj_autopreview_container "+s+"'></span>")).text(d),a=i.get(0);try{return r.generateMathjax(d,"svg",(function(e,t){if(t)return i.html(t),null!=p?p.changed(!0):void 0})),(p=t.markText(u,h,{replacedWith:a,clearOnEnter:!0,handleMouseEvents:!1,inclusiveLeft:!1,inclusiveRight:!1})).__str=d,p.__isMathMarker=!0,p.__autopreviewType="mathjax",a.onclick=function(){var n,i;if(n=p.find())return i=n.from,p.clear(),i.ch+=3,t.setCursor(i),e.focus()}}catch(e){return e,console.log("\u5b58\u5728\u91cd\u53e0\uff0c\u5ffd\u7565\u521b\u5efa...",u,h)}}})),l.forEach((function(e){return e.textMarker.clear()})),null}}},n.exports=i}}),window.requirejs.define({"lib/editor/autopreview/mermaid_preview":function(e,t,n){var i,r,o,a;i=t("../../utils_generate_chart"),o=t("./utils"),a=function(e){var t,n;return t=null,(n=e.stateAfter)&&n.lookAhead&&(n=n.state),n&&n.inner&&n.inner.outer&&(t=n.inner.outer),t},r=function(e){var t;return t=e.doc,{isBlock:!1,createElement:function(n,r){var s,l,c,u,d,p,f,h,m,v,g,_,w,y,b,x,k,D;if(r.text,_=null,(m=a(r))&&/mermaid/i.test(m.localModeName)&&m.localModeLine===n&&(_={start:{line:n,ch:0},startStr:{line:n+1,ch:0}}),_){if(_&&_.start)for(g=Math.min(t.lastLine(),50)+n;n<g;){for(n++,t.getLine(n),u=e.getLineTokens(n)||[],c=0;c<u.length;)if(l=u[c],c++,(l.type||"").indexOf("formatting-code-block-close")>=0){_.end={line:n,ch:l.end},_.endStr={line:n,ch:0};break}if(_.end)break}if(_&&_.end){if(v=r.markedSpans||[],b={},v.forEach((function(e){var t;if((t=e.marker).__isMermaidMarker&&t.__uuid)return b[t.__uuid]=t})),f=_.start,k=_.end,p=t.indexFromPos(f),x=t.indexFromPos(k),o.checkInRange(e,p,x))return null;if(w=t.getRange(_.startStr,_.endStr),D=CryptoJS.MD5(w).toString(),b[D])delete b[D];else{(s=$("<span class='xsj_autopreview_container xsj_autopreview_normal_block_container xsj_autopreview_svg_container xsj_autopreview_block_mermaid_container'></span>")).text(w),d=s.get(0);try{i.generateMermaid(w,"svg",(function(e,t){return s.html(t),null!=y?y.changed(!0):void 0})),(y=t.markText(f,k,{replacedWith:d,clearOnEnter:!0,handleMouseEvents:!1,inclusiveLeft:!0,inclusiveRight:!0})).__uuid=D,y.__isMermaidMarker=!0,y.__autopreviewType="mermaid",d.onclick=function(){var n,i;if(n=y.find())return i=n.from,y.clear(),i.ch+=3,t.setCursor(i),e.focus()}}catch(e){e,console.log("\u5b58\u5728\u91cd\u53e0\uff0c\u5ffd\u7565\u521b\u5efa...",f,k)}}for(h in b)b[h].clear();return null}}}}},n.exports=r}}),window.requirejs.define({"lib/editor/autopreview/plantuml_preview":function(e,t,n){var i,r,o,a;i=t("../../utils_generate_chart"),r=t("../../../constant"),a=t("./utils"),o=function(e){var t;return t=e.doc,{isBlock:!1,createElement:function(n,o){var s,l,c,u,d,p,f,h,m,v,g,_,w,y,b,x,k,D,C,F,M,T;if(o.text,_=null,(x=o.stateAfter)&&x.lookAhead&&(x=x.state),x&&x.inner&&x.inner.outer&&(m=x.inner.outer,/plantuml/i.test(m.localModeName)&&m.localModeLine===n&&(_={start:{line:n,ch:0},startStr:{line:n+1,ch:0}})),_){if(_&&_.start)for(g=Math.min(t.lastLine(),50)+n;n<g;){for(n++,t.getLine(n),u=e.getLineTokens(n)||[],c=0;c<u.length;)if(l=u[c],c++,(l.type||"").indexOf("formatting-code-block-close")>=0){_.end={line:n,ch:l.end},_.endStr={line:n,ch:0};break}if(_.end)break}if(_&&_.end){if(v=o.markedSpans||[],D={},v.forEach((function(e){var t;if((t=e.marker).__isPlantUMLMarker&&t.__uuid)return D[t.__uuid]=t})),f=_.start,F=_.end,p=t.indexFromPos(f),C=t.indexFromPos(F),a.checkInRange(e,p,C))return null;if(y=t.getRange(_.startStr,_.endStr),T=CryptoJS.MD5(y).toString(),D[T])delete D[T];else{if((s=$("<span class='xsj_autopreview_container xsj_autopreview_block_image_container'></span>")).text(y),d=s.get(0),b=(w=e.xsjApp.getPreviewProfileModel().get("grammar_plantuml_options_url")||r.plantumlDefaultServerUrl).match(/\/png\//i)?"png":"svg",!(M=i.getPlantUMLUrl(w,y)))return;try{"png"===b?s.html("<img src='"+M+"' style='max-width:100%;'/>"):s.html("<object data='"+M+"' style='max-width:100%;'/>"),(k=t.markText(f,F,{replacedWith:d,clearOnEnter:!0,handleMouseEvents:!1,inclusiveLeft:!0,inclusiveRight:!0})).__uuid=T,k.__isPlantUMLMarker=!0,k.__autopreviewType="plantUML",d.onclick=function(){var n,i;if(n=k.find())return i=n.from,k.clear(),i.ch+=3,t.setCursor(i),e.focus()}}catch(e){e,console.log("\u5b58\u5728\u91cd\u53e0\uff0c\u5ffd\u7565\u521b\u5efa...",f,F)}}for(h in D)D[h].clear();return null}}}}},n.exports=o}}),window.requirejs.define({"lib/editor/autopreview/quote_preview":function(e,t,n){var i,r;t("../../../lib/utils"),r=function(e){var t,n;return t=null,(n=e.stateAfter)&&n.lookAhead&&(n=n.state),n&&n.inner&&n.inner.outer&&(t=n.inner.outer),t},i=function(e){var t,n,i;return i=e.doc,n=function(e,t,n){var o,a,s,l,c,u,d,p;if(l=t.markedSpans||[],(u=i.getLineHandle(e-1))&&(s=r(u))&&s.quote>=n)return l.forEach((function(e){var t;if((t=e.marker).__isStartQuoteMarker)return t.clear()})),!1;if(l.find((function(e){return!!e.marker.__isStartQuoteMarker})))return!0;a={ch:0,line:e},p={ch:0,line:e},(o=document.createElement("span")).classList.add("xsj_autopreview_quote_start"),o.classList.add("xsj_autopreview_quote_start_"+n),o.classList.add("xsj_autopreview"),c={widget:o,clearOnEnter:!1,handleMouseEvents:!1,inclusiveLeft:!1,inclusiveRight:!1};try{(d=i.setBookmark(a,c)).__isStartQuoteMarker=!0,d.__autopreviewType="quote"}catch(e){e,console.log("\u5b58\u5728\u91cd\u53e0\uff0c\u5ffd\u7565\u521b\u5efa...",a,p)}return!0},t=function(e,t,n){var o,a,s,l,c,u,d,p;if(l=t.markedSpans||[],(u=i.getLineHandle(e+1))&&(s=r(u))&&s.quote>=n)return l.forEach((function(e){var t;if((t=e.marker).__isEndQuoteMarker)return t.clear()})),!1;if(l.find((function(e){return!!e.marker.__isEndQuoteMarker})))return!0;a={ch:t.text.length,line:e},p={ch:t.text.length,line:e},(o=document.createElement("span")).classList.add("xsj_autopreview_quote_end"),o.classList.add("xsj_autopreview_quote_end_"+n),o.classList.add("xsj_autopreview"),c={widget:o,clearOnEnter:!1,handleMouseEvents:!1,inclusiveLeft:!1,inclusiveRight:!1};try{(d=i.setBookmark(a,c)).__isEndQuoteMarker=!0,d.__autopreviewType="quote"}catch(e){e,console.log("\u5b58\u5728\u91cd\u53e0\uff0c\u5ffd\u7565\u521b\u5efa...",a,p)}return!0},{isBlock:!0,clearMarkers:function(e,i,o){var a,s;return(s=i.markedSpans||[]).forEach((function(e){var t;if((t=e.marker).__isQuoteMarker)return t.clear()})),(null!=(a=r(i))?a.quote:void 0)?(n(e,i,a.quote),t(e,i,a.quote)):a?s.forEach((function(e){var t;if((t=e.marker).__isStartQuoteMarker||t.__isEndQuoteMarker)return t.clear()})):void 0},createElement:function(e,o,a){var s,l,c,u,d,p,f,h,m,v,g;if(o.text,!(p=r(o)))return!1;if(!(h=p.quote))return!1;for(n(e,o,h),t(e,o,h),m={start:{ch:0,line:e},end:{ch:0,line:e},str:""},c=0,u=a.length;c<u&&((d=a[c]).type||"").indexOf("formatting-quote")>=0;c++)m.end.ch=d.end,m.str+=d.string;l={ch:m.start.ch,line:e},g={ch:m.end.ch,line:e},(s=document.createElement("span")).classList.add("xsj_autopreview_quote"),s.classList.add("xsj_autopreview"),f={replacedWith:s,clearOnEnter:!0,handleMouseEvents:!1,inclusiveLeft:!1,inclusiveRight:!1};try{(v=i.markText(l,g,f)).__str=m.str,v.__isQuoteMarker=!0,v.__autopreviewType="quote"}catch(e){e,console.log("\u5b58\u5728\u91cd\u53e0\uff0c\u5ffd\u7565\u521b\u5efa...",l,g)}return null}}},n.exports=i}}),window.requirejs.define({"lib/editor/autopreview/ruby_preview":function(e,t,n){var i,r,o,a,s,l;o=t("../../../lib/utils"),t("../../../lib/utils_url"),r=t("./utils"),s=r.getMarkdownState,l=function(e,t){var n,i,r;return n={html:!0,xhtmlOut:!0,breaks:!1,linkify:!0,typographer:!0},(i=window.markdownit(n)).use(window.markdownitWikilink),i.use(window.markdownitMark),r=i.renderInline(e),o.stripScripts(r).innerText},a=function(e){var t,n,i;return null==e&&(e=""),i=/\{([^\}]*)\}/,(n=e.match(i))?(t=n[1],l(t)):""},i=function(e){var t;return t=e.doc,{isBlock:!1,createElement:function(n,i,l,c){var u,d,p,f,h,m,v,g,_,w;for(f=i.text,_=[],g={},l=l.slice();h=l.shift();)if(w=h.type||"",m=s(h.state)){if(m.table)break;if(m.cjkruby)for(g.start={ch:h.start},g.strong=m.strong,g.em=m.em;h=l.shift();)if((m=s(h.state))&&(w=h.type||"",m.linkHref&&w.indexOf("formatting")<0&&(g.src=h.string),w.indexOf("formatting-link-string")>=0&&(")"===h.string&&(g.srcType="direct"),"]"===h.string&&(g.srcType="ref"),g.srcType))){g.end={ch:h.end},g.str=f.substring(g.start.ch,g.end.ch),_.push(g),g={};break}}if(0!==_.length){if(v=i.markedSpans||[],p=[],u=[],v.forEach((function(e){var t,n,i;if((t=e.marker).__isCJKRubyMarker)return(n=t.find())&&(n.from||(n={from:n,to:n})),n&&(i=_[u.length])&&i.str===t.__str?u.push({pos:n,str:t.__str}):p.push(t)})),_.length!==u.length||0!==p.length)return d=function(e){return!!u.find((function(t){var n;return n=t.pos,e.start.ch===n.from.ch&&e.end.ch===n.to.ch&&e.str===t.str}))},_.forEach((function(i){var s,l,c,u,p,f,h,m,v,g;if(v=$.trim(i.src),"","ref"===i.srcType&&(v=$.trim(o.getReference(e.getValue(),v))),v&&((g=v.split(" ")).length>1&&(v=g[0],g[1].replace(/^['"]|['"]$/g,"")),v)){if(l={line:n,ch:i.start.ch},m={line:n,ch:i.end.ch},s=t.indexFromPos(l),h=t.indexFromPos(m),r.checkInRange(e,s,h))return null;if(!d(i))return u=document.createElement("span"),f=t.markText(l,m,{replacedWith:u,clearOnEnter:!0,handleMouseEvents:!1,inclusiveLeft:!1,inclusiveRight:!1}),c="",p="",i.strong&&(c="<strong>"+c,p+="</strong>"),i.em&&(c="<em>"+c,p+="</em>"),u.innerHTML=c+"<ruby>"+a(i.str)+"<rp>(</rp><rt>"+v+"</rt><rp>)</rp></ruby>"+p,f.__str=i.str,f.__autopreviewType="ruby",f.__isCJKRubyMarker=!0,f.__xsjurl=v,u.onclick=function(){var n,i;if(n=f.find(),f.clear(),n)return(i=n.from).ch+=2,t.setCursor(i),e.focus()}}})),p.map((function(e){return e.clear()})),null}else(v=i.markedSpans||[]).filter((function(e){var t;return!(!(t=e.marker)||!t.__isCJKRubyMarker)})).map((function(e){var t;if(t=e.marker)return t.clear()}))}}},n.exports=i}}),window.requirejs.define({"lib/editor/autopreview/sequence_preview":function(e,t,n){var i,r,o;i=t("../../utils_generate_chart"),r=t("./utils"),o=function(e){var t;return t=e.doc,{isBlock:!1,createElement:function(n,o){var a,s,l,c,u,d,p,f,h,m,v,g,_,w,y,b,x,k,D;if(o.text,_=null,(w=o.stateAfter)&&w.lookAhead&&(w=w.state),w&&w.inner&&w.inner.outer&&"sequence"===(h=w.inner.outer).localModeName&&h.localModeLine===n&&(_={start:{line:n,ch:0},startStr:{line:n+1,ch:0}}),_){if(_&&_.start)for(v=Math.min(t.lastLine(),50)+n;n<v;){for(n++,t.getLine(n),c=e.getLineTokens(n)||[],l=0;l<c.length;)if(s=c[l],l++,(s.type||"").indexOf("formatting-code-block-close")>=0){_.end={line:n,ch:s.end},_.endStr={line:n,ch:0};break}if(_.end)break}if(_&&_.end){if(m=o.markedSpans||[],b={},m.forEach((function(e){var t;if((t=e.marker).__isSequenceMarker&&t.__uuid)return b[t.__uuid]=t})),p=_.start,k=_.end,d=t.indexFromPos(p),x=t.indexFromPos(k),r.checkInRange(e,d,x))return null;if(g=t.getRange(_.startStr,_.endStr),D=CryptoJS.MD5(g).toString(),b[D])delete b[D];else{(a=$("<span class='xsj_autopreview_container xsj_autopreview_normal_block_container xsj_autopreview_svg_container xsj_autopreview_block_sequence_container'></span>")).text(g),u=a.get(0);try{i.generateSequence(g,"svg",(function(e,t){return a.html(t),null!=y?y.changed(!0):void 0})),(y=t.markText(p,k,{replacedWith:u,clearOnEnter:!0,handleMouseEvents:!1,inclusiveLeft:!0,inclusiveRight:!0})).__uuid=D,y.__isSequenceMarker=!0,y.__autopreviewType="sequence",u.onclick=function(){var n,i;if(n=y.find())return i=n.from,y.clear(),i.ch+=3,t.setCursor(i),e.focus()}}catch(e){e,console.log("\u5b58\u5728\u91cd\u53e0\uff0c\u5ffd\u7565\u521b\u5efa...",p,k)}}for(f in b)b[f].clear();return null}}}}},n.exports=o}}),window.requirejs.define({"lib/editor/autopreview/table_preview":function(e,t,n){var i,r,o,a;t("../../utils_generate_chart"),i=t("./utils"),o=t("./create_inline_table"),a=function(e){var t,n;return t=null,(n=e.stateAfter)&&n.lookAhead&&(n=n.state),n&&n.inner&&n.inner.outer&&(t=n.inner.outer),t},r=function(e){var t;return t=e.doc,{isBlock:!1,clearMarkers:function(e,t,n){var i;if(i=null,n&&n.length>0&&(i=a({stateAfter:n[0].state})),i)return(t.markedSpans||[]).forEach((function(e){var t;if((t=e.marker).__isTableMarker&&t.__lineNumber!==i.tableLine)return t.clear()}))},createElement:function(n,r,s){var l,c,u,d,p,f,h,m,v,g,_,w,y,b,x,k;if(r.text,(v=null)||s&&s.length>0&&(v=a({stateAfter:s[0].state})),y=null,v&&v.table){if(v.tableLine!==n)return!1;y={start:{line:n,ch:0}}}if(y&&y.start&&(g=Math.min(t.lastLine(),200),w=null,t.iter(n+1,n+g,(function(t){var n,i;if((i=a(t))||(n=e.getLineTokens(t.lineNo()))&&n.length>0&&(i=a({stateAfter:n[0].state})),!i||!i.table)return!0;w=t})),w&&(y.end={line:w.lineNo(),ch:w.text.length})),b=null,d=null,(r.markedSpans||[]).forEach((function(e){var t;if((t=e.marker).__isFold&&(d=!0),t.__isTableMarker)return b?t.clear():b=t})),y&&y.end&&!d){if(u=y.start,k=y.end,c=t.indexFromPos(u),x=t.indexFromPos(k),i.checkInRange(e,c,x))return null;if(_=t.getRange(y.start,y.end),b&&(l=b.find())&&(0===CodeMirror.cmpPos(u,l.from)&&0===CodeMirror.cmpPos(k,l.to)?"":(b.off("clear"),b.clear(),b=null)),!b)try{(b=t.markText(u,k,{replacedWith:document.createElement("span"),clearOnEnter:!0,handleMouseEvents:!1,inclusiveLeft:!0,inclusiveRight:!0})).__isTableMarker=!0,b.__autopreviewType="table"}catch(e){e,console.log("\u5b58\u5728\u91cd\u53e0\uff0c\u5ffd\u7565\u521b\u5efa...",u,k)}b&&(b.__lineNumber=n,o(e,{lineNum:u.line,content:_},(function(t,n){return n.textMarker=b,n.setContent(_,b),b.off("clear"),b.on("clear",(function(){if(n&&n.textMarker===b)return n.destroy()})),n.off("contentChanged"),n.on("contentChanged",(function(t){if(l=b.find())return e.replaceRange(t,l.from,l.to)}))})))}else{for(p=0,h=(m=r.widgets||[]).length;p<h;p++)(f=m[p]).lineTableWidgetView&&f.lineTableWidgetView.destroy();b&&b.clear()}return null}}},n.exports=r}}),window.requirejs.define({"lib/editor/autopreview/tag_manager":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<div class="ui fluid multiple search selection dropdown scrolling">\n<input type="hidden" name="filters" class="tag_name_value">\n<i class="tags icon"></i>\n<span class="text"></span>\n<div class="menu">\n<div class="header">\n\u9009\u62e9\u4e00\u4e2a\u6807\u7b7e\n</div>\n</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"lib/editor/autopreview/tag_manager_view":function(e,t,n){var i,r,o,a,s,l,c,u={}.hasOwnProperty;a=t("../../../views/view"),r=t("../../../constant"),i=t("../../../application"),l=t("./tag_manager"),c=null,s=[],o=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)u.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.template=l,t.prototype.className="tag_manager_container",t.prototype.initialize=function(e){return c=this},t.prototype.show=function(e,t,n){var i;return c.render(),i=e.getBoundingClientRect(),c.$el.css({position:"absolute",zIndex:500,left:0,right:0,top:0,bottom:0}),c.$el.find(".dropdown").css({position:"fixed",left:i.x,top:i.y,width:i.width-5,minHeight:i.height}),$("#main").append(c.$el),c.init(t,n)},t.prototype.init=function(e,t){var n,o,a,l,u,d;for(null==e&&(e=[]),d=i.getTagModel().getTags(),0===s.length&&(s=d||[]),r.pouchDB.query("query_index/by_tagNames",{reduce:!0,group:!0}).then((function(e){var t;if(t=(t=e.rows).map((function(e){return e.key})),t=_.uniq(t.concat(d)),s=t,c)return c.$el.find(".dropdown").dropdown("setup menu",{values:t.map((function(e){return{value:e,text:e,name:e}}))}),c.$el.find(".dropdown>.search").trigger("click")})),u="",o=0,a=s.length;o<a;o++)l=s[o],u+='<div class="item" data-value="'+_.escape(l)+'">\n  '+_.escape(l)+"\n</div>";return c.$el.find(".menu").append(u),c.$el.find(".dropdown").dropdown({allowAdditions:!0,forceSelection:!1,filterRemoteData:!0,showOnFocus:!0,hideAdditions:!1,message:{addResult:"\u6dfb\u52a0\u65b0\u6807\u7b7e: <b>{term}</b>"},delay:{hide:1e3},onHide:function(){var e,n;if(c)return e=!1,document.activeElement===c.$el.find("input.search")[0]?window.event&&window.event instanceof window.KeyboardEvent&&27===window.event.keyCode&&(e=!0):e=!0,!!e&&(n=c.$el.find(".dropdown").dropdown("get value"),t(n),c.remove(),!1)}}),n=c.$el.find(".dropdown"),e.map((function(e){return n.dropdown("set selected",e)})),c.$el.find("input.search")[0].focus()},t.prototype.remove=function(){return c.$el.find(".dropdown").dropdown("destroy"),c=null,t.__super__.remove.call(this)},t.prototype.getQueryTags=function(){var e,t,n,i,r,o;if(o=[],n=c.$el.find(".dropdown").dropdown("get value"))o=n.split(",");else for(e=0,t=(i=c.$el.find(".tag_recommends .ui.label.active").toArray()).length;e<t;e++)r=i[e],o.push($(r).data("value"));return _.uniq(_.compact(o),!0).sort()},t}(a),n.exports=o}}),window.requirejs.define({"lib/editor/autopreview/theme_manager":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<div class="ui fluid search selection dropdown">\n<i class="loading icon asterisk"></i>\n\u52a0\u8f7d\u4e2d...\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"lib/editor/autopreview/theme_manager_view":function(e,t,n){var i,r,o,a,s,l,c,u,d,p={}.hasOwnProperty;l=t("../../../views/view"),i=t("../../../application"),r=t("../../../lib/config_sync"),s=t("../../../views/themes_manager_view"),a=t("../../notifier"),u=t("./theme_manager"),d=null,c=!1,o=function(e){var t;function n(){return n.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)p.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(n,e),n.prototype.template=u,n.prototype.selectedTheme="",n.prototype.fileModel=null,n.prototype.callbackFn=null,n.prototype.className="theme_manager_container",t=null,n.prototype.initialize=function(e){return d=this,c=!1,this.fileModel=e.fileModel},n.prototype.events={click:"returnFn","click .themes_manager_btn":"showThemesManagerModalFn","click .random_theme_btn":"randomThemeFn"},n.prototype.randomThemeFn=function(){var e,t,n;return e=i.getApplicationProfileModel(),t="theme_fileModel_"+this.fileModel.id,n=(n=this.fileModel.get("title")||"\u968f\u673a\u6587\u7ae0").substring(0,30)+"\u7684\u4e3b\u9898",e.trigger("exploreTheme",{themeId:t,themeName:n}),i.homeView.changeTempTheme.prevTempTheme=t,"function"==typeof this.callbackFn&&this.callbackFn(t),this.remove()},n.prototype.showThemesManagerModalFn=function(){return(new s).show(!0),d.remove()},n.prototype.returnFn=function(e){if(e.target===e.currentTarget&&!c)return null!=d?d.remove():void 0},n.prototype.show=function(e,t,n){var i,r;return d.render(),r=e.getBoundingClientRect(),d.$el.css({position:"absolute",zIndex:500,left:0,right:0,top:0,bottom:0}),d.$el.find(".ui.dropdown").css({position:"fixed",left:r.x,top:r.y,width:r.width-5,minHeight:40}),$("#main").append(d.$el),i=function(e){if(n(e),e&&e!==t)return d._showAppThemeManagerTourFn()},d.init(t,i)},n.prototype.init=function(e,n){var o;return null==e&&(e=""),this.callbackFn=n,this.selectedTheme=e,o={type:"theme",sort:{$lt:[]},updateDate:{$lt:[]}},r.getThemes(o,"",!1,(function(e,r){var o,s,l,u,p,f;if(t=r.docs,f="","web"!==STORY_PLATFORM||MINI_WEB||(f=' <div class="ui mini button icon random_theme_btn"><i class="fas fa-dice"></i></div>'),e)a.showMessage("\u52a0\u8f7d\u4e3b\u9898\u5217\u8868\u51fa\u9519\uff1a"+e,6e3,"error");else if(0!==t.length){if(d){for(c=!0,o=d.$el.find(".ui.dropdown"),u="",l=0,p=t.length;l<p;l++)s=t[l],u+='<div class="item" data-value="'+_.escape(s._id)+'">\n  '+_.escape(s.themeName)+"\n</div>";return o.html('<i class="dropdown icon"></i>\n<span class="text"></span>\n<div class="menu" style="max-height: initial;">\n  <div class="header" style="border-bottom: 1px solid var(--lighterBackground);padding-bottom: 0.75rem;margin-bottom: 0;">\n    <div class="ui mini primary button icon themes_manager_btn">\u4e3b\u9898\u7ba1\u7406</div>'+f+'\n  </div>\n  <div class="scrolling menu">\n    '+u+"\n  </div>\n</div>"),o.dropdown({forceSelection:!1,filterRemoteData:!0,showOnFocus:!0,message:{noResults:""},delay:{hide:1e3},onChange:function(e){return d.selectedTheme=e,i.homeView.changeTempTheme(e)},onHide:function(){var e;if(d)return e=!1,document.activeElement===d.$el.find("input.search")[0]?window.event&&window.event instanceof window.KeyboardEvent&&27===window.event.keyCode&&(e=!0):e=!0,!!e&&(n(d.selectedTheme),d.remove(),!1)}}),d.$el.find("input.search")[0].focus()}}else null!=d&&d.$el.find(".ui.dropdown").html('\u60a8\u8fd8\u672a\u521b\u5efa\u4efb\u4f55\u4e3b\u9898 <div class="ui mini primary button icon themes_manager_btn">\u4e3b\u9898\u7ba1\u7406</div>'+f)}))},n.prototype.remove=function(){return d.$el.find(".ui.dropdown").dropdown("destroy"),t=null,d=null,c=!1,n.__super__.remove.call(this)},n.prototype._showAppThemeManagerTourFn=function(){var e,t,n,r,o,a,s;if(s=i.getTourModel(),"web"===STORY_PLATFORM&&s.canPrompt("app_and_article_theme_manager_learned")){if(!(n=$(".store_footer .theme_buttons")).find(">i").visible())return;return(t=$(".store_footer .store_buttons")).css("opacity",1),r=(o=n[0].getBoundingClientRect()).x+o.width/2,a=o.y+o.height/2,e=$('<div class="spotlight_container" style="\nbackground: radial-gradient(circle at '+r+"px "+a+'px, transparent 180px, rgba(0, 0, 0, 0.4) 182px, rgba(0, 0, 0, 0.9) 900px);\n"></div>'),n.popup({on:"manual",closable:!1,position:"bottom left",onVisible:function(){var i;return n.css({color:"var(--negativeColor)",outline:"3px solid var(--negativeColor)",outlineOffset:"2px",transform:"scale(2.5) rotate(-15deg)",transition:"transform 1s, outline 1s"}),$("body").append(e),(i=this).width(300),i.find(".ok").click((function(){return e.remove(),n.popup("destroy"),s.dontPrompt("app_and_article_theme_manager_learned"),i.remove(),t.css("opacity",""),n.css({color:"",outline:"",outlineOffset:"",transform:""})}))},html:'<div class="header">\u63d0\u793a</div><div class="content">\u60a8\u521a\u4fee\u6539\u7684\u662f\u6587\u7ae0\u4e3b\u9898\uff0c\u70b9\u51fb\u8fd9\u91cc\u53ef\u4ee5\u8bbe\u7f6e\u5e94\u7528\u4e3b\u9898\u3002<br/><strong>\u6587\u7ae0\u4e3b\u9898</strong>\u4e0e<strong>\u5e94\u7528\u4e3b\u9898</strong>\u7684\u533a\u522b\u662f\uff0c\u6587\u7ae0\u4e3b\u9898\u4f1a\u968f\u7740\u6587\u7ae0\u7684\u5207\u6362\uff0c\u81ea\u52a8\u4fee\u6539\u5e94\u7528\u4e3b\u9898\u3002<div><a href="javascript:void(0);" class="ok pull-right">\u77e5\u9053\u4e86</a></div></div>'}).popup("show")}},n}(l),n.exports=o}}),window.requirejs.define({"lib/editor/autopreview/toc_preview":function(e,t,n){var i,r,o;o=t("../../../lib/utils"),(i=t("./utils")).getMarkdownState,r=function(e){var t;return t=e.doc,{isBlock:!0,createElement:function(n,r,a){var s,l,c,u,d,p,f,h,m,v,g,w,y,b,x,k,D,C,F,M,T;if(b=r.text,{},y=!1,(x=a[0])&&1===a.length&&x.type&&x.type.indexOf("toc-formatting")>=0&&(y=!0),y){if(k=r.markedSpans||[],h=[],c=[],k.forEach((function(e){var t,n,i;if((t=e.marker).__tocTextMarker)return(i=(n=t.__tocTextMarker).find())&&(i.from||(i={from:i,to:i})),i?c.push({pos:i,str:n.__str}):h.push(t)})),1!==c.length||0!==h.length){if(p=function(e){return!!c.find((function(t){var n;return n=t.pos,e.start.ch===n.from.ch&&e.end.ch===n.to.ch&&e.str===t.str}))},l={str:b,start:{ch:0,line:n},end:{ch:b.length,line:n}},T=b,g={line:n,ch:0},M={line:n,ch:b.length},v=t.indexFromPos(g),F=t.indexFromPos(M),u=null,(d=h.findIndex((function(e){return e.__tocurl===T})))>=0&&(u=h.splice(d,1)[0]),i.checkInRange(e,v,F))return null;if(!p(l))return(C=t.markText(g,M,{replacedWith:document.createElement("span"),clearOnEnter:!0,handleMouseEvents:!1,inclusiveLeft:!1,inclusiveRight:!1})).__str=l.str,C.__autopreviewType="toc",u?u.__tocTextMarker=C:("xsj_autopreview_block_toc_container",m=(s=$("<span class='xsj_autopreview_container xsj_autopreview_block_toc_container'></span>")).get(0),(u=e.setBookmark(M,{widget:m,handleMouseEvents:!1})).__tocTextMarker=C,u.__tocurl=T,u.__tocLoadFn=function(t){var n,i,r,a,l,c,d,p,f,h,m;if(n=e.getValue(),a=o.getHeadingInfo(n),t||u.__headings!==a.headings)return u.__headings=a.headings,r=u.__headings,(m=T.indexOf("?"))>0&&(h=T.substring(m+1,T.length-1),c=$.deparam(h),(i=c.depth)&&i<8&&(r=r.filter((function(e){return e.level<=i})))),u.__filteredHeadings=r,l=0,p=function(e){return e.replace(/(<([^>]+)>)/gi,"")},d=r.map((function(e){var t,n,i;if(i=[],e.level>l)for(n=e.level-l,t=0;t<n;)t++,i.push("<ul>"),l++;else if(e.level<l)for(n=l-e.level,t=0;t<n;)t++,i.push("</ul>"),l--;return(i=i.concat(['<li class="folder"><a href="javascript:void(0)">',_.escape(p(e.content)),"</a>"])).join("")})),f=d.join("")+new Array(l+1).join("</ul>"),setTimeout((function(){return f?s.html(f):s.html('<i class="frown icon"></i>\u60a8\u7684\u6587\u6863\u597d\u50cf\u6709\u4e9b\u4e0d\u5408\u7406\uff0c\u65e0\u6cd5\u751f\u6210\u6587\u6863\u5927\u7eb2\u56fe\u54e6'),u.changed(!0)}),1)},u.__isTocMarker=!0,u.__disableTypeWriterScroll=!0,u.__autopreviewType="toc",u.__tocLoadFn(!0)),w=function(e,t,n){var i,r,o,a,s,l,c;return a=e.line,s=e.level,o=a+t,(c=a-t)<0&&(o-=c,c=0),o>=(i=n.split("\n")).length&&(o=i.length-1),r=i.slice(c,o),l=a-c,'<ol start="'+(c+1)+'">\n  '+r.map((function(e,t){var n;return e=_.escape(e),n="preview_context_line_content",t===l?"<li class='"+(n="preview_context_line_content_current")+"'><h"+s+">"+e+"</h"+s+"></li>":"<li class='"+n+"'>"+e+"</li>"})).join("\n")+"\n</ol>"},f=function(e){if(e.popupTargetEl)return $(e.popupTargetEl).popup("destroy"),e.popupTargetEl=null},D=function(e,t,n,i){var r,o;if(t!==e.popupTargetEl)return e.popupTargetEl&&$(e.popupTargetEl).popup("destroy"),e.popupTargetEl=t,r=w(n,6,i),o='<div class="preview_context_line_content_container" style="width: '+e.doc.cm.display.lastWrapWidth+'px;max-width: 21cm;">\n  '+r+"\n</div>",$(e.popupTargetEl).popup({lastResortx:"top center",lastResort:!0,delay:{show:500},position:"top center",on:"hover",html:o}),$(e.popupTargetEl).trigger("mouseenter")},u.replacedWith.onmousemove=function(t){var n,i,r;return t.preventDefault(),t.stopPropagation(),"A"===(n=t.target).tagName?(r=$(u.replacedWith).find("a").index(n),i=u.__filteredHeadings[r],D(u,n,i,e.getValue())):f(u)},u.replacedWith.onclick=function(n){var i,r,o,a,s,l,c;if(n.preventDefault(),n.stopPropagation(),"A"===(a=n.target).tagName){if(l=$(u.replacedWith).find("a").index(a),s=u.__filteredHeadings[l])return c=s.line,e.focus(),i={line:c,ch:0},e.scrollIntoView(i,e.display.lastWrapHeight/2),t.setCursor(i),e.highlightPos(i,{autoHideTimeout:2e3})}else if(r=C.find())return o=r.from,C.clear(),o.ch+=2,t.setCursor(o),e.focus()},h.map((function(e){return e.clear()})),null}}else(k=r.markedSpans||[]).filter((function(e){var t;return!(!(t=e.marker)||!t.__tocTextMarker)})).map((function(e){var t;if(t=e.marker)return t.clear()}))}}},n.exports=r}}),window.requirejs.define({"lib/editor/autopreview/todo_preview":function(e,t,n){var i,r,o;t("../../../lib/utils"),(i=t("./utils")).getMarkdownState,o=function(e,t){var n,i;if(Howl&&e.state.typewriterScrolling&&e.state.typewriterScrolling.globalState&&(n=e.state.typewriterScrolling.globalState).sound&&"loaded"===(i=new Howl({src:[t],volume:n.soundValue/100})).state())return i.play()},r=function(e){var t;return t=e.doc,{isBlock:!1,createElement:function(n,r,a){var s,l,c;if(r.text,c=[],!i.checkIsInTable(a)&&((a=a.slice()).forEach((function(e,t){var n,i,r;if(t>0&&(r=e.type||"",i=(n=a[t-1]).type||"",r.indexOf("formatting-task")>=0&&i.indexOf("formatting-list")>=0))return c.push({start:{ch:n.start},end:{ch:e.end+1},str:n.string+e.string,markupStr:n.string.trim(),taskStr:e.string,token:e})})),0!==c.length))return s=[],(r.markedSpans||[]).forEach((function(e){var t,n;if((n=e.marker).__isTodoMarker)return t=n.find(),s.push({pos:t,str:n.__str,textMarker:n})})),l=function(e){var t;return(t=s.findIndex((function(t){var n;return n=t.pos,e.start.ch===n.from.ch&&e.end.ch===n.to.ch&&e.str===t.str})))>=0&&(s.splice(t,1),!0)},c.forEach((function(r){var a,s,c,u,d,p,f,h,m;if(c={ch:r.start.ch,line:n},m={ch:r.end.ch,line:n},s=t.indexFromPos(c),h=t.indexFromPos(m),i.checkInRange(e,s,h,!0))return null;if(!l(r)){a=document.createElement("span"),u=/x/i.test(r.taskStr),p=r.markupStr,(a=document.createElement("span")).classList.add("xsj_autopreview_todolist"),a.classList.add("xsj_autopreview"),a.classList.add("todolist"),u&&a.classList.add("checked"),d={replacedWith:a,clearOnEnter:!0,handleMouseEvents:!1,inclusiveLeft:!1,inclusiveRight:!1};try{(f=t.markText(c,m,d)).__str=r.str,f.__isTodoMarker=!0,f.__autopreviewType="todo"}catch(e){e,console.log("\u5b58\u5728\u91cd\u53e0\uff0c\u5ffd\u7565\u521b\u5efa...",c,m)}return a.onclick=function(){var e,n;return n=f.find(),e=(u=a.classList.contains("checked"))?p+" [ ] ":p+" [x] ",t.replaceRange(e,n.from,n.to),a.classList.toggle("checked")},a.onmousedown=function(){return o(e,"./media/typewriter/1/pop-down.mp3")},a.onmouseup=function(){return u=a.classList.contains("checked"),o(e,u?"./media/typewriter/1/pop-up-on.mp3":"./media/typewriter/1/pop-up-off.mp3")}}})),s.forEach((function(e){return e.textMarker.clear()})),null}}},n.exports=r}}),window.requirejs.define({"lib/editor/autopreview/utils":function(e,t,n){var i,r,o,a,s;i=t("../../../views/file_list_by_url_view"),r=t("../../../lib/utils_url"),(o={}).getMarkdownState=function(e){if(e&&e.inner&&e.inner.outer)return e.inner.outer},o.checkIsInTable=function(e){var t;return!!(e&&e.length>0&&(t=o.getMarkdownState(e[0].state))&&t.table)},s=function(e,t,n,i){return i?e>t&&e<n:e>=t&&e<=n},o.checkInRange=function(e,t,n,i){var r,o,a,l,c,u,d;for(l=!1,a=0,c=(d=e.listSelections()).length;a<c;a++){if(u=d[a],r=e.indexFromPos(u.anchor),s(r,t,n,i)){l=!0;break}if(o=e.indexFromPos(u.head),s(o,t,n,i)){l=!0;break}}return l},a=null,o.initPopupFn=function(e,n,o){var s,l,c,u,d,p,f,h,m,v,g,_;if(n)return _=null,f=function(n,i){var o,a;return n=(a=r.splitHashTag(n)).url,o=a.hashTag,!n&&o&&(n=e.fileModel.id),t("../../../application").getFileCollection().getModelById(n,(function(e,t){var n;if(t)return n=r.getFileModelContent(t,o),i(n,t)}))},d=function(e){if(_&&(clearTimeout(_),_=null),e.popupTargetEl)return $(e.popupTargetEl).popup("destroy"),e.popupTargetEl=null},(g=function(e,t,n,i){var r,o;if(e.popupTargetEl&&!(n<g.orderNum)&&(g.orderNum=n,t!==g.currentUid))return g.currentUid=t,o='<div class="preview_context_line_content_container" style="width: max-content;max-width: min(21cm, '+(e.doc.cm.display.lastWrapWidth+"px")+');overflow:hidden;max-height:40VH;">\n  '+i+"\n</div>",(r=$(e.popupTargetEl)).popup("is visible")?(r.popup("change content",i),void r.popup("reposition")):(r.popup({lastResortx:"top center",lastResort:!0,delay:{show:500},onVisible:function(){return $(this).one("mousemove",(function(){return c(e)}))},onHide:function(){return!e.popupTargetEl},position:"top center",on:"hover",html:o}),r.trigger("mouseenter"))}).currentOrderNum=0,g.currentUid=0,v=function(e,t,n){return f(n,(function(n,i){var r;return r="internal_"+i.id,g(e,r,t,n)}))},h=null,u=function(e){return h&&(clearTimeout(h),h=null),e.fileListByUrlView&&(e.fileListByUrlView.destroy(),e.fileListByUrlView=null),e.dropdownTargetEl=null},m=function(t,n,r){var o;return o=new i({url:r,fileModel:e.fileModel,cancelDestroyLinkTimeout:s,bookmarker:t,editor:e,destroyLink:c,delayDestroyLink:l,showLinkPopupContent:g}),t.fileListByUrlView=o,o.show(n)},p=0,c=function(e){return a=null,p&&(clearTimeout(p),p=null),g.currentUid=0,g.currentOrderNum=0,d(e),u(e)},l=function(e){return _&&(clearTimeout(_),_=null,e.popupTargetEl=null),h&&(clearTimeout(h),h=null,e.dropdownTargetEl=null),p&&clearTimeout(p),p=setTimeout((function(){return c(e)}),500)},s=function(){if(p)return clearTimeout(p),p=null},n.replacedWith.onmousemove=function(e){var t;e.preventDefault(),e.stopPropagation(),(t=e.target).classList.contains("icon")&&(t=t.parentElement),a&&a!==n&&c(a),a=n,p&&(clearTimeout(p),p=null),t.classList.contains("xsj_autopreview_footnote_btn")?function(){var e;if(t!==n.popupTargetEl)n.popupTargetEl&&$(n.popupTargetEl).popup("destroy"),n.popupTargetEl=t,e=uniqueNumber(),_=setTimeout((function(){if(_=null,n.popupTargetEl)return g(n,"footnote_"+e,e,o)}))}():t.classList.contains("xsj_autopreview_link_btn")&&(function(){var e;if(t!==n.popupTargetEl)return n.popupTargetEl&&$(n.popupTargetEl).popup("destroy"),n.popupTargetEl=t,e=uniqueNumber(),_=setTimeout((function(){if(_=null,n.popupTargetEl)return v(n,e,o)}))}(),function(){if(t!==n.dropdownTargetEl)n.fileListByUrlView&&(n.fileListByUrlView.destroy(),n.fileListByUrlView=null),n.dropdownTargetEl=t,h=setTimeout((function(){if(h=null,n.dropdownTargetEl)return m(n,t,o)}),800)}())},n.replacedWith.onmouseleave=function(e){return l(n)},n.on("clear",(function(){return c(n)}))},n.exports=o}}),window.requirejs.define({"lib/editor/autopreview/utils_cover":function(e,t,n){var i;(i={}).getBackgroundPosition=function(e){var t;return(t=e.match(/!\[#([^\]]+)\]/))?t[1]:""},n.exports=i}}),window.requirejs.define({"lib/editor/autopreview/utils_pdf":function(e,t,n){var i,r;i={},(r=function(e,t){var n;if(r.sequence.push([e,t]),!r.$iframe)return r.$iframe=$('<iframe src="./pdfpreview/utils.html" style="position:absolute;left:0;top:0;z-index:-1;visible:hidden;pointer-events:none;"></iframe>'),n=r.$iframe,$(document.body).append(n),n.one("load",(function(){var e,t;return e=n[0].contentWindow,(t=function(){var i,o,a;return 0===r.sequence.length?(n.remove(),r.sequence=[],void(r.$iframe=null)):(o=(a=r.sequence.shift())[0],i=a[1],e.generateCoverFn(o).then((function(e){return i(null,{data:e}),t()})).catch((function(e){return i(e),t()})))})()}))}).$iframe=null,r.sequence=[],i.generateCoverFn=r,n.exports=i}}),window.requirejs.define({"lib/editor/autopreview/utils_worker_mathjax":function(e,t,n){var i,r,o,a,s,l;i=t("../../utils_generate_chart"),a=[],s=!1,o=function(e,t){return t("fallback")},l=function(){var e;if(!(s||a.length<=0))return s=!0,e=a.shift(),o(e.content,(function(t,n){return n?e.callback(null,n):i.generateMathjax(e.content,"svg",e.callback),s=!1,l()}))},(r={}).generateMathjax=function(e,t,n){return a.push({content:e,format:t,callback:n}),l()},n.exports=r}}),window.requirejs.define({"lib/editor/base_codemirror_editor":function(e,t,n){var i,r,o;o=["resize","setEditorContent","redraw","getValue","getLength","getScreenLength","getRowLength","screenToDocumentRow","screenToDocumentRowHeight","documentToScreenRow","documentToScreenRowHeight","getScrollTop","getFirstVisibleRow","getLastVisibleRow","getCursorPositionScreen","getCursorPosition","getCursorPositionXY","getAllFoldInfos","applyFoldInfos","highlightLines","removeMarker","execCommand","getSelectionRange","setSelectionRange","scrollToY","gotoLine","moveCursorTo","focus","search","setValue","insertSnippet","insertValue","getUndoManager"],i=function(){function e(e){this.commonCodeMirrorEditor=e,this.editor=this.commonCodeMirrorEditor.editor}return e.prototype.editor=null,e.prototype.commonCodeMirrorEditor=null,e.prototype.resize=function(){return this.commonCodeMirrorEditor.resize()},e.prototype.setEditorContent=function(){return this.commonCodeMirrorEditor.destroyChildren(),this.editor.fileModel&&this.editor.getDoc().setValue(this.editor.fileModel.get("content")),this.getUndoManager().init()},e.prototype.redraw=function(){return this.editor.setOption("mode",this.editor.getOption("mode"))},e.prototype.getValue=function(){return this.editor.getDoc().getValue()},e.prototype.getLength=function(){return this.editor.getDoc().lineCount()},e.prototype.getScreenLength=function(){return this.getLength()},e.prototype.getRowLength=function(e){return 1},e.prototype.screenToDocumentRow=function(e){return e},e.prototype.screenToDocumentRowHeight=function(e){return this.documentToScreenRowHeight(e,0)},e.prototype.documentToScreenRow=function(e){return e},e.prototype.documentToScreenRowHeight=function(e,t){return null==t&&(t=0),this.editor.cursorCoords({line:e,ch:0},"window").top},e.prototype.getScrollTop=function(){return this.editor.getScrollerElement().scrollTop},e.prototype.getFirstVisibleRow=function(){var e,t,n,i,r;if(r=this.editor.getViewport(),i=this.editor.display.renderedView,t=r.from,!i)return t;for(e=this.editor.getWrapperElement().getBoundingClientRect();t<=r.to&&!((n=i[t-r.from])&&n.node.getBoundingClientRect().bottom>e.top);)t++;return t},e.prototype.getLastVisibleRow=function(e){var t,n,i,r,o;if(o=this.editor.getViewport(),this.editor.getDoc().lineCount(),r=this.editor.display.renderedView,n=o.to,!r)return n;for(t=this.editor.getWrapperElement().getBoundingClientRect();n>=o.from&&!((i=r[n-o.from])&&i.node.getBoundingClientRect().top<t.bottom);)n--;return n},e.prototype.getCursorPositionScreen=function(){return this.editor.getCursor().line},e.prototype.getCursorPosition=function(){return this.editor.getCursor().line},e.prototype.getCursorPositionXY=function(){var e;return{row:(e=this.editor.getCursor()).line,column:e.ch}},e.prototype.getAllFoldInfos=function(){return this.editor.getAllFoldInfos?this.editor.getAllFoldInfos():[]},e.prototype.applyFoldInfos=function(e){var t;return"function"==typeof(t=this.editor).applyFoldInfos?t.applyFoldInfos(e):void 0},e.prototype.highlightLines=function(e,t){return this.editor.getDoc().markText({line:e,ch:0},{line:t+1,ch:0}).id},e.prototype.removeMarker=function(e){var t,n,i,r,o;for(r=null,t=0,n=(o=this.editor.getDoc().getAllMarks()).length;t<n;t++)if((i=o[t]).id===e){r=i;break}if(r)return r.clear()},e.prototype.execCommand=function(e,t,n){return this.commonCodeMirrorEditor.execCommand(e,t,n)},e.prototype.getSelectionRange=function(){var e;return e=this.editor.getDoc().listSelections()[0],{start:this.editor.getDoc().indexFromPos(e.anchor),end:this.editor.getDoc().indexFromPos(e.head)}},e.prototype.setSelectionRange=function(e,t){var n,i,r,o,a,s,l,c,u,d;if(r=(i=this.editor.getDoc()).first||0,c=0,n=i.posFromIndex(e),o=i.posFromIndex(t),r>0&&i.linked&&i.linked.length>0)for(a=0,s=(d=i.linked).length;a<s;a++)if((l=d[a]).isParent){c=(u=l.doc).indexFromPos({line:r,ch:0}),n=u.posFromIndex(e+c),o=u.posFromIndex(t+c);break}return i.setSelection(n,o)},e.prototype.scrollToY=function(e){return this.editor.scrollTo(0,e)},e.prototype.gotoLine=function(e,t){var n,i,r;return null==e&&(e=0),null==t&&(t=0),n=this.getFirstVisibleRow(),i=this.getLastVisibleRow(),r=n<e&&e<i?null:this.editor.display.lastWrapHeight/2,this.editor.scrollIntoView({line:e,ch:t},r),this.editor.getDoc().setCursor({line:e,ch:t})},e.prototype.moveCursorTo=function(e,t){return null==e&&(e=0),null==t&&(t=0),this.editor.getDoc().setCursor({line:e,ch:t})},e.prototype.focus=function(){return this.editor.focus()},e.prototype.search=function(e,t){return CodeMirror.commands.xsjFind(this.editor,e,t)},e.prototype.setValue=function(e){var t,n,i,r,o,a,s,l,c,u,d,p,f,h,m,v;if(t=new diff_match_patch,u=(v=this.getValue()).length-1,h=Math.min(t.diff_commonPrefix(v,e),u),i=Math.min(t.diff_commonSuffix(v,e),v.length-h,e.length-h),f=e.substring(h,e.length-i),o=(n=this.editor.getDoc()).first||0,c=0,m=n.posFromIndex(h),r=n.posFromIndex(v.length-i),o>0&&n.linked&&n.linked.length>0)for(a=0,s=(p=n.linked).length;a<s;a++)if((l=p[a]).isParent){c=(d=l.doc).indexFromPos({line:o,ch:0}),m=d.posFromIndex(h+c),r=d.posFromIndex(v.length-i+c);break}return this.editor.getDoc().replaceRange(f,m,r)},e.prototype.insertSnippet=function(e){return new CodeMirror.templatesHint.Template({template:e}).insert(this.editor,{from:this.editor.getCursor(!0),to:this.editor.getCursor(!1)},{docTitle:this.editor.fileModel.get("title"),docTagNames:this.editor.fileModel.get("tagNames"),docId:this.editor.fileModel.id,docCreateDate:this.editor.fileModel.get("createDate"),docUpdateDate:this.editor.fileModel.get("updateDate"),docContent:this.editor.fileModel.get("content"),editorSelectionText:this.editor.getDoc().getSelection(),clipboardText:"",clipboardHtml:"",clipboardMarkdown:""})},e.prototype.insertValue=function(e){return this.editor.getDoc().replaceRange(e,this.editor.getCursor(!0),this.editor.getCursor(!1))},e.prototype.getUndoManager=function(){return this.commonCodeMirrorEditor.getUndoManager()},e}(),r=function(e,t){var n;return n=new i(t),o.forEach((function(t){return e[t]=function(){return n[t].apply(n,arguments)}}))},n.exports=r}}),window.requirejs.define({"lib/editor/base_editor":function(e,t,n){var i,r,o,a,s,l;i=t("../../application"),a=t("../utils"),o=t("../config_sync"),l=["setEditorContent","getValue","getCursorLineValue","getLength","getScreenLength","getRowLength","screenToDocumentRow","screenToDocumentRowHeight","documentToScreenRow","documentToScreenRowHeight","getScrollTop","getFirstVisibleRow","getLastVisibleRow","getCursorPositionScreen","getCursorPosition","getCursorPositionXY","getAllFoldInfos","applyFoldInfos","getPositionByIndex","getCursorByHashTag","highlightLines","removeMarker","getSelectionRange","getSelectionValue","setSelectionRange","gotoLine","scrollToY","moveCursorTo","focus","search","setValue","insertSnippet","insertValue","getUndoManager","execCommand"],r=function(){function e(){}return e.prototype.setEditorContent=function(){var e;if(this.editorProxy.fileModel)return null!=(e=this.editorProxy)?e.setEditorContent(this.editorProxy.fileModel.get("content")):void 0},e.prototype.getValue=function(e){var t,n;return t=this.editorProxy.getValue(),e?(e<0&&(e=0),e>=(n=t.split("\n")).length&&(e=n.length-1),n[e]):t},e.prototype.getCursorLineValue=function(){var e;return e=this.getCursorPosition()||1,this.getValue(e)},e.prototype.getLength=function(){return this.editorProxy.getLength()},e.prototype.getScreenLength=function(){return this.editorProxy.getScreenLength()},e.prototype.getRowLength=function(e){return this.editorProxy.getRowLength(e)},e.prototype.screenToDocumentRow=function(e){return this.editorProxy.screenToDocumentRow(e)},e.prototype.screenToDocumentRowHeight=function(e){return this.editorProxy.screenToDocumentRowHeight(e)},e.prototype.documentToScreenRow=function(e){return this.editorProxy.documentToScreenRow(e)},e.prototype.documentToScreenRowHeight=function(e,t){return null==t&&(t=0),this.editorProxy.documentToScreenRowHeight(e,t)},e.prototype.getScrollTop=function(){return this.editorProxy.getScrollTop()},e.prototype.getFirstVisibleRow=function(){return this.editorProxy.getFirstVisibleRow()},e.prototype.getLastVisibleRow=function(e){return null==e&&(e=0),this.editorProxy.getLastVisibleRow(e)},e.prototype.getCursorPositionScreen=function(){return this.editorProxy.getCursorPositionScreen()},e.prototype.getCursorPosition=function(){return this.editorProxy.getCursorPosition()},e.prototype.getCursorPositionXY=function(){return this.editorProxy.getCursorPositionXY()},e.prototype.getAllFoldInfos=function(){return this.editorProxy.getAllFoldInfos?this.editorProxy.getAllFoldInfos():[]},e.prototype.applyFoldInfos=function(e){var t;return"function"==typeof(t=this.editorProxy).applyFoldInfos?t.applyFoldInfos(e):void 0},e.prototype.getPositionByIndex=function(e){var t,n,i,r,o,a,s;for(null==e&&(e=0),o=0,s=0,t=i=0,r=(n=this.getValue().split("\n")).length;i<r;t=++i){if(o+(a=n[t]).length+1>e){s=t;break}o+=a.length+1}return{row:s,column:e-o}},e.prototype.getCursorByHashTag=function(e){var t;return t=this.getValue(),a.getCursorByHashTag(e,t)},e.prototype.highlightLines=function(e,t){},e.prototype.removeMarker=function(e){},e.prototype.getSelectionRange=function(){return this.editorProxy.getSelectionRange()},e.prototype.getSelectionValue=function(){var e;return e=this.editorProxy.getSelectionRange(),this.getValue().substring(e.start,e.end)},e.prototype.setSelectionRange=function(e,t){return this.editorProxy.setSelectionRange(e,t)},e.prototype.gotoLine=function(e,t){return this.editorProxy.gotoLine(e,t)},e.prototype.scrollToY=function(e){return this.editorProxy.scrollToY(e)},e.prototype.moveCursorTo=function(e,t){return this.editorProxy.moveCursorTo(e,t)},e.prototype.focus=function(){return this.editorProxy.focus()},e.prototype.search=function(e,t){return this.editorProxy.search(e,t)},e.prototype.setValue=function(e){return this.editorProxy.setValue(e)},e.prototype.insertSnippet=function(e,t){var n;return n=this,o.getSnippet(e,{statistics:!0},(function(e,r){var o,s,l,c,u,d,p,f,h;if(o=i.getApplicationProfileModel(),e&&(r={content:o.get("defaultSnippet"),canScript:!0,mode:"normal"}),d=r.content,r.canScript){if(h={docTitle:(f=n.editorProxy.fileModel).get("title"),docTagNames:f.get("tagNames"),docId:f.id,docCreateDate:f.get("createDate"),docUpdateDate:f.get("updateDate"),docContent:f.get("content"),editorSelectionText:n.getSelectionValue(),clipboardText:"",clipboardHtml:"",clipboardMarkdown:""},"client"===STORY_PLATFORM){if(u=(s=window.nw.Clipboard.get()).get("text")||"",(l=s.get("html")||"")&&d.indexOf("clipboardMarkdown")>=0)try{c=a.html2markdown(l)}catch(e){p=e,console.error(p)}h=Object.assign(h,{clipboardText:u,clipboardHtml:l,clipboardMarkdown:c})}d=_.template(d)(h)}return n.editorType===r.mode?n.editorProxy.insertSnippet(d):n.editorProxy.insertValue(d),"function"==typeof t&&t(),n.focus()}))},e.prototype.insertValue=function(e){return this.editorProxy.insertValue(e)},e.prototype.getUndoManager=function(){return this.editorProxy.getUndoManager()},e.prototype.execCommand=function(e,t,n){return this.editorProxy.execCommand(e,t,n)},e}(),s=function(e){var t;return t=new r,l.forEach((function(n){return e[n]=function(){return t[n].apply(e,arguments)}})),e},n.exports=s}}),window.requirejs.define({"lib/editor/create_active_editor":function(e,t,n){var i,r,o;o=t("./base_editor"),i=function(){function e(e){this.editorProxy=e,this.fileModel=this.editorProxy.fileModel}return e.prototype.fileModel=null,e.prototype.editorProxy=null,e.prototype.editorType="codemirror",e.prototype.changeEditorProxy=function(e){return this.editorProxy=e,this.fileModel=e.fileModel},e.prototype.changeFileModel=function(e,t){var n;if(this.fileModel=e,this.editorProxy.fileModel!==e)return"function"==typeof(n=this.editorProxy).changeFileModel?n.changeFileModel(e):void 0},e}(),r=function(e){var t;return t=new i(e),o(t),t},n.exports=r}}),window.requirejs.define({"lib/editor/popup_editor_manager":function(e,t,n){var i,r,o,a,s,l=function(e,t){return function(){return e.apply(t,arguments)}};i=t("../../application"),o=t("../notifier"),r=t("../../lib/utils_leader_line"),s=t("../../views/codemirror/create_popup_editor"),a=function(){var e;function t(e){this.createNewEditor=l(this.createNewEditor,this),this.destroyEditor=l(this.destroyEditor,this),this.minEditor=l(this.minEditor,this),this,this.previewView=e.previewView,this.editorView=e.editorView,this.model=e.model,$(window).on("createNewEditor",this.createNewEditor),$(window).on("destroyGroupEditor",this.destroyEditor),$(window).on("minGroupEditor",this.minEditor)}return t.prototype.nextId=1,t.prototype.editEditors={},t.prototype.model=null,t.prototype.previewView=null,t.prototype.editorView=null,e={},t.prototype.minEditor=function(t,n,r){var o,a;if(null==r&&(r={}),i.getFileGroupTabCollection(),(o=e[n])&&!(a=o.getWindow()).isMin)return a.toggleMin()},t.prototype.destroyEditor=function(t,n,r){var o,a,s;if(null==r&&(r={}),a=i.getFileGroupTabCollection(),(s=e[n])&&s.close(),(o=a.get(n))&&(r.destroy||"temp"===o.get("groupType")))return o.destroy()},t.prototype.createNewEditor=function(t,n,a){var l,c,u,d,p,f,h,m,v,g,w,y,b,x,k,D,C,F,M,T,S,P,j,E,I;if(null==a&&(a={}),k=!1,(I=i.getUserModel().get("user"))&&I.vip&&(k=!0),"web"===STORY_PLATFORM&&(k=!0),a.forceOpen&&(k=!0),m=i.getFileGroupTabCollection(),w=a.groupId||"group_"+uniqueNumber(),!(F=e[w])&&Object.keys(e).length>2&&!k)o.showMessage("\u975e\u4f1a\u5458\u65e0\u6cd5\u5728\u5ba2\u6237\u7aef\u540c\u65f6\u521b\u5efa3\u4e2a\u4ee5\u4e0a\u7684\u6d6e\u52a8\u7f16\u8f91\u5668",6e3,"error");else if(n instanceof Array&&(n=n[(v=n).length-1]),x=[],v&&v.forEach((function(e){if(e.id!==n.id)return x.push({id:e.id,name:e.get("title"),emoji:e.get("emoji")})})),x.push({id:n.id,name:n.get("title"),emoji:n.get("emoji")}),y=m.getFileGroupTabModelById(w,{name:"",activeFile:n.id,files:x,position:a.position}),F){if(p=a.callback,F.fileModel!==n&&(p=function(){if(F.changeFileModel(n,{}),a.callback)return a.callback(y,F)}),(M=F.getWindow()).isMin)return F.show(),M.$el.css({opacity:0}),f=M.$el.offset(),M.$el.visible(!0)||(f=M.fixPosition()),E=null,(c=$(".chrome-tabs-shell")).visible(!0)&&(l=c.find(".chrome-tab[data-id="+y.id+"]"),E=l.offset()),E||(E=$(".main_toolbar_container .file_tabs").offset()),b=y.get("groupIcon")||"fas fa-book",g=y.get("groupColor")||"var(--defaultForeground)",(u=$("<i class='xsj_draggable_dialog_min_flyer "+b+"' style='color: "+g+"'></i>")).offset({top:E.top,left:E.left}).css({position:"absolute",height:"150px",width:"150px","z-index":"100"}).appendTo($("body")),u.animate({top:f.top+10,left:f.left+10,width:75,height:75},600,"easeInOutExpo"),u.animate({width:0,height:0},(function(){return u.detach(),M.$el.css({opacity:1}),M.toggleMin(),M.once("toggleMin",(function(){if(p)return p(y,F)}))}));if(M.$el.hasClass("draggable_dialog_focus")?M.$el.visible(!0)?p||M.toggleMin():M.fixPosition():(M.focus(),M.$el.visible(!0)?p||M.$el.transition("jiggle"):M.fixPosition()),M.isShade)return M.toggleShade(),void M.once("toggleShade",(function(){if(p)return p(y,F)}));if(p)return p(y,F)}else if(F=s(this.editorView,n,i.getEditorProfileModel(),y.get("files")),e[w]=F,j={position:y.get("position"),isMax:y.get("isMax"),cursorOpts:{}},(d=y.getActiveFileInfo())&&(j.cursorOpts={cursorPosition:d.row||0,cursorPositionColumn:d.column||0}),a.initCursor&&(j.cursorOpts={cursorPosition:a.initCursor.row||0,cursorPositionColumn:a.initCursor.column||0}),F.show(j),M=F.getWindow(),C=M.setTitle,M.setTitle=function(e){if(!y||!y.get("name"))return C.apply(this,[e])},n&&M.setTitle(n.get("title")),S=function(e){if(e)return M.$el.find(".header_logo>i").removeClass().addClass(e+" header_logo_icon")},P=function(e){if(e)return M.$el.find(".header_title").text(e).parent().attr("title",e)},h=function(e){var t,n;if(t=e.changed)return t.groupColor&&(g=e.get("groupColor"),T(g)),t.groupIcon&&(b=e.get("groupIcon"),S(b)),t.name?(n=e.get("name"),P(n)):void 0},(T=function(e){var t;return t=M.$el,e?(t[0].style.setProperty("--selectionBackground",e),t[0].style.setProperty("--defaultForeground","white")):(t[0].style.removeProperty("--selectionBackground"),t[0].style.removeProperty("--defaultForeground"))})(y.get("groupColor")),S(y.get("groupIcon")),P(y.get("name")),y.on("change",h),y.connectFileModel(n),M.on("beforeClose",(function(){return M.$el.droppable("destroy")})),F.on("beforeClose",(function(){var e,t,n,i;if(y&&"temp"!==y.get("groupType")&&(t=y.get("files")||[],n=!1,e=y.get("activeFile"),i=F.getCursorPositionXY(),t.map((function(t){if(t.id===e&&(t.row!==i.row||t.column!==i.column))return t.row=i.row,t.column=i.column,n=!0})),n))return y.save({files:t})})),F.on("close",(function(){if(delete e[y.id],y&&(y.off("change",h),"temp"===y.get("groupType")))return y.destroy(),y=null})),M.$el.droppable({accept:".droppable_file_item",greedy:!0}),F.on("tabDragReceive",(function(){return M.focus()})),F.on("reposition",(function(e){if(y)return y.save({position:e})})),F.on("toggleMax",(function(e){if(y)return y.save({isMax:e})})),F.on("toggleMin",(function(e){if(y&&(y.save({isMin:e}),e))return E=M.$el.offset(),M.$el.hide("pulsate",{},100),c=$(".chrome-tabs-shell"),f=null,c.visible(!0)&&(l=c.find(".chrome-tab[data-id="+y.id+"]"),f=l.offset()),f||(f=$(".main_toolbar_container .file_tabs").offset()),b=y.get("groupIcon")||"fas fa-book",g=y.get("groupColor")||"var(--defaultForeground)",(u=$("<i class='xsj_draggable_dialog_min_flyer "+b+"' style='color: "+g+"'></i>")).offset({top:E.top,left:E.left}).css({opacity:"0.5",position:"absolute",height:"150px",width:"150px","z-index":"100"}).appendTo($("body")),u.animate({top:f.top+10,left:f.left+10,width:75,height:75},600,"easeInOutExpo"),u.animate({width:0,height:0},(function(){return u.detach()}))})),F.on("toggleShade",(function(e){if(y)return y.save({isShade:e})})),F.on("togglePin",(function(e){if(y)return y.save({isPinned:e})})),F.on("focus",(function(){return m.trigger("xsjActive",y.id,"group")})),F.on("tabFilesChanged",(function(e){var t,n,r,o,a,s;if(y)return r={files:e.map((function(e){return{id:e.id,name:e.title,emoji:e.emoji}}))},t=y.get("activeFile"),s=y.get("files").findIndex((function(e){return e.id===t})),y.save(r),n=e.find((function(e){return e.id===t})),o=y.get("files"),n?F.hideNoFileDimmer():((a=o[s])||(a=o[s+1]),a||(a=o[o.length-1]),a?i.getFileCollection().getModelById(a.id,(function(e,t){return F.changeFileModel(t)})):"temp"===y.get("groupType")?F.close():F.changeFileModel())})),F.on("tabActiveFileChanged",(function(e,t){var n,i,r,o,a;if(y&&(i=y.get("files")||[],r=!1,(n=y.get("activeFile"))!==e.id&&(r=!0),o=F.getCursorPositionXY(),a=F.getAllFoldInfos()||[],i.map((function(t){if(t.id===e.id&&(t.name!==e.title&&(t.name=e.title,r=!0),e.row=t.row||0,e.column=t.column||0,e.foldInfos=t.foldInfos),t.id===n&&(t.row!==o.row||t.column!==o.column||!_.isEqual(t.foldInfos,a)))return t.row=o.row,t.column=o.column,t.foldInfos=a,r=!0})),r))return y.connectFileModel(t),y.save({activeFile:e.id,files:i})})),m.trigger("xsjActive",y.id,"group"),a.leaderLine&&(D=a.leaderLine,r.showLeaderLine(D.source,[F.$el],{autoHide:!0})),a.callback)return a.callback(y,F)},t}(),n.exports=a}}),window.requirejs.define({"lib/editor_tooltip":function(e,t,n){var i,r,o,a;a=function(e,t){var n;return n=t.offset(),{top:e.pageY-n.top+t.scrollTop(),left:e.pageX-n.left+t.scrollLeft()}},o=function(e,t,n,i){var r,o,s,l;switch(s=a(e,n),o=t[0].offsetWidth,r=t[0].offsetHeight,i){case"bottom":l={top:s.top+13,left:s.left-o/2};break;case"top":l={top:s.top-r-13,left:s.left-o/2};break;case"left":l={top:s.top-r/2,left:s.left-o-13};break;case"right":l={top:s.top-r/2,left:s.left+13}}return t.css(l).addClass(i)},r=function(e,t,n){var i,r,a,s;return s={top:n.scrollTop(),right:n.width()+n.scrollLeft()},a="top",(r={top:(i=t.position()).top,right:i.left+t.width(),left:i.left}).top-s.top<0&&(a="bottom"),r.right-s.right>0&&(a="left"),r.left<0&&(a="right"),o(e,t,n,a)},i={show:function(e,t,n){var r,o,a;if((r=$(e.currentTarget)).data("uid"),o=r.data("delay_in"),(a=r.data("delay_out"))&&(clearTimeout(a),r.data("delay_out",null)),!o)return o=_.delay(i._show,1e3,e,t,n),r.data("delay_in",o)},hide:function(e,t){var n,r;if((t=t||$(e.currentTarget)).data("uid"),n=t.data("delay_in"),r=t.data("delay_out"),n&&(clearTimeout(n),t.data("delay_in",null)),!r)return r=_.delay(i._hide,1e3,t),t.data("delay_out",r)},_hide:function(e){var t,n;if(e.data("delay_out",null),n=e.data("uid"),t=$("#editor_tooltip_"+n),n&&1===t.length)return t.off("mouseenter").off("mouseout"),t.removeClass("visible top bottom left right"),t.remove(),null},_show:function(e,t,n){var o,a,s,l,c,u,d,p;return(a=$(e.currentTarget)).data("delay_in",null),l=t.offset(),s=a.data("uid"),o=$("#editor_tooltip_"+s),s&&1===o.length?(o.addClass("visible"),o.find(".content").html(n)):(d='<div class="ignored ui popup transition center visible" style="min-width: 300px;">\n<div class="content">'+n+"</div>\n</div>",s=_.uniqueId(),(o=$(d).appendTo(t)).attr("id","editor_tooltip_"+s),a.data("uid",s)),o.off("mouseenter").off("mouseout"),o.on("mouseenter",(function(){var e;if(e=a.data("delay_out"))return a.data("delay_out",null),clearTimeout(e)})),o.on("mouseleave",(function(){return i.hide(e,a)})),u={top:e.pageY+t.scrollTop()-l.top,left:e.pageX+t.scrollLeft()-l.left},o.css(u),p={top:(c=o.position()).top-o.height()/2,left:c.left-o.width()/2},o.css(p),r(e,o,t)}},n.exports=i}}),window.requirejs.define({"lib/filetime_demo_datas":function(e,t,n){var i,r,o,a,s,l,c,u,d,p,f;i=t("../constant"),a=null,r=null,u=null,o=null,c=function(e,t){if(t%7==0&&(r||(r=i.systemColors.map((function(e){return"var(--"+e+")"}))),e.color=r[_.random(0,r.length-1)]),t%3==0&&(a||(a=i.getSystemEmojiChars()),e.emoji=a[_.random(0,a.length-1)]),t%5!=0&&t%2!=0||(e.cover=p()),t%11==0||t%8==0)return e.idiom=f()},l=function(e){if(u)return e();fetch(i.host+"/other/idioms.json?fver="+moment().format("YYYYMMDD")).then((function(e){return e.json()})).then((function(t){return u=t,e()})).catch(e)},f=function(){var e;return u?(e=_.random(0,u.length-1),u[e]):""},s=function(e){if(o)return e();fetch(i.host+"/css/random-covers.json?fver="+moment().format("YYYYMMDD")).then((function(e){return e.json()})).then((function(t){return o=t,e()})).catch(e)},p=function(){var e,t,n,r;if(o)return(r=(e=Object.keys(o)).length)>0?(t=e[_.random(0,r-1)],n=o[t],i.host+"/"+n.image):""},d=function(e){return $.getJSON("./media/suziwen_github.json",(function(t){var n,i,r,o;return n={},t=t.filter((function(e,t){return c(e,t),moment(e.createDate).isAfter(new Date(2011,0,1))})),n.allDemoDocs=t,n.filterIds=t.filter((function(e){return!!moment(e.createDate).isAfter(new Date(2014,0,1))&&(e.tagNames&&e.tagNames.indexOf("javascript")>=0)})).map((function(e){return e._id})),o={},r={},i={},t.forEach((function(e){var t,n,a,s;return t=moment(e.createDate),e.createDate=t.toDate().getTime(),e.xsjType="demo",n=t.format("YYYYMMDD"),a=t.format("YYYYMM"),s=t.format("YYYY"),i[n]?(i[n].value++,i[n].ids.push(e._id)):i[n]={ids:[e._id],value:1,key:[t.year(),t.month(),t.date()]},r[a]?(r[a].value++,r[a].ids.push(e._id)):r[a]={ids:[e._id],value:1,key:[t.year(),t.month()]},o[s]?(o[s].value++,o[s].ids.push(e._id)):o[s]={ids:[e._id],value:1,key:[t.year()]}})),n.groupByMonth=r,n.groupByDay=i,n.groupByYear=o,e(n)}))},n.exports=function(e){return s((function(){return l((function(){return d(e)}))}))}}}),window.requirejs.define({"lib/filetime_sequence_show_github_content":function(e,t,n){var i,r,o;i=t("./utils"),o=function(e,t){var n;if(!e.fullContent)return n=e._id.substring("https://github.com/".length),fetch("https://api.github.com/repos/"+n+"/readme",{headers:{Accept:"application/vnd.github+json"}}).then((function(e){return e.json()})).then((function(n){if(n&&n.content&&"base64"===n.encoding)return e.fullContent=i.dataURL2String("data:base64;plain/text,"+n.content),t()})).catch((function(e){return console.error(e),t()}));t()},(r=function(e,t){return r.loading?r.next=[e,t]:(r.loading=!0,o(e,(function(){var e;return r.loading=!1,(e=r.next)?(r.next=null,r.apply(null,e)):t()})))}).next=null,r.loading=!1,n.exports=r}}),window.requirejs.define({"lib/idle_timeouter":function(e,t,n){var i;i=function(){var e,t,n,i,r;function o(t){null==t&&(t={}),t.timeoutInMiliseconds&&(r=t.timeoutInMiliseconds),t.doInActive&&"function"==typeof t.doInActive&&(e=t.doInActive),console.log("initiaaaaaaaa.....")}return i=null,r=36e5,e=function(){},t=function(){return i&&window.clearTimeout(i),n()},n=function(){return i=window.setTimeout((function(){return e()}),r)},o.prototype.start=function(){return window.addEventListener("mousemove",t,!1),window.addEventListener("mousedown",t,!1),window.addEventListener("keypress",t,!1),window.addEventListener("touchmove",t,!1)},o.prototype.stop=function(){return window.clearTimeout(i),i=null,window.removeEventListener("mousemove",t),window.removeEventListener("mousedown",t),window.removeEventListener("keypress",t),window.removeEventListener("touchmove",t)},o.prototype.setTimeout=function(e){return this.stop(),r=e,this.start()},o}(),n.exports=i}}),window.requirejs.define({"lib/markdown/align":function(e,t,n){n.exports=function(e,t){var n,i;return"align","center html recognizes `->center<-` markup and turns it into `<center>center</center>` tag (note:\nif you you want this to work in your own code, you must correct the rendering output, which is more\nimaginary than correct right now\u2014this is a MarkDown syntax plugin example, not an HTML5\ntutorial...)",n=/^([:-]>)([\s\S]*)(<[-:])$/m,i=function(e,t,i,r){var o,a,s,l,c,u;for(e.md.block.ruler.getRules("paragraph"),c=t+1,i=e.lineMax,!1;c<i&&!e.isEmpty(c);)e.tShift[c],e.blkIndent,c++;if(o=(s=e.getLines(t,c,e.blkIndent,!1).trim()).slice(0,2),l=s.slice(s.length-2),n.exec(s),":>"===o&&"<:"===l)a="story_align_justify";else if(":>"===o&&"<-"===l)a="story_align_left";else if("<:"===l&&"->"===o)a="story_align_right";else{if("->"!==o||"<-"!==l)return!1;a="story_align_center"}return s=s.slice(2,s.length-2),e.line=c,r||((u=e.push("align_open","div",1)).attrs||(u.attrs=[]),u.attrs.push(["class",a]),u.map=[t,e.line],(u=e.push("inline","",0)).content=s,u.map=[t,e.line],u.children=[],u=e.push("align_close","div",-1)),!0},e.block.ruler.before("fence","align",i,{alt:["paragraph","reference","blockquote","list"]})}}}),window.requirejs.define({"lib/markdown/attachment":function(e,t,n){n.exports=function(e,t){var n,i,r,o,a;return'attachment recognizes `=[title](src)` markup and turns it into `<a class="attachment" href="src">title</a>` tag (note:\nif you you want this to work in your own code, you must correct the rendering output, which is more\nimaginary than correct right now\u2014this is a MarkDown syntax plugin example, not an HTML5\ntutorial...)',o=n="attachment",a=61,i=function(e,t){var n,i,r,s,l,c,u,d,p,f,h,m,v,g="",_=e.pos,w=e.posMax;if(e.src.charCodeAt(e.pos)!==a)return!1;if(91!==e.src.charCodeAt(e.pos+1))return!1;var y=e.md.utils.normalizeReference,b=e.md.utils.isSpace;if(c=e.pos+2,(l=e.md.helpers.parseLinkLabel(e,e.pos+1,!1))<0)return!1;if((u=l+1)<w&&40===e.src.charCodeAt(u)){for(u++;u<w&&(b(i=e.src.charCodeAt(u))||10===i);u++);if(u>=w)return!1;for(v=u,(p=e.md.helpers.parseLinkDestination(e.src,u,e.posMax)).ok&&(g=e.md.normalizeLink(p.str),e.md.validateLink(g)?u=p.pos:g=""),v=u;u<w&&(b(i=e.src.charCodeAt(u))||10===i);u++);if(p=e.md.helpers.parseLinkTitle(e.src,u,e.posMax),u<w&&v!==u&&p.ok)for(f=p.str,u=p.pos;u<w&&(b(i=e.src.charCodeAt(u))||10===i);u++);else f="";if(u>=w||41!==e.src.charCodeAt(u))return e.pos=_,!1;u++}else{if(void 0===e.env.references)return!1;if(u<w&&91===e.src.charCodeAt(u)?(v=u+1,(u=e.md.helpers.parseLinkLabel(e,u))>=0?s=e.src.slice(v,u++):u=l+1):u=l+1,s||(s=e.src.slice(c,l)),!(d=e.env.references[y(s)]))return e.pos=_,!1;g=d.href,f=d.title}return t||(r=e.src.slice(c,l),e.md.inline.parse(r,e.md,e.env,m=[]),(h=e.push(o,"img",0)).attrs=n=[["src",g],["alt",""]],h.children=m,h.content=r,f&&n.push(["title",f])),e.pos=u,e.posMax=w,!0},r=function(e,t,n,i){var r,o,a,s,l,c,u,d,p,f;for(o={},s=e[t].content,l=0,c=(d=e[t].attrs).length;l<c;l++)o[(r=d[l])[0]]=r[1];return f=o.title,p=o.src,f=f||s,a=null,(u=i.previewCache)&&(a=u.get("url_attachment_"+p+"_"+f)),n.noRemoteResource?"<a class='attachment' href='"+p+"'>"+f+"</a>":a||"<span class='story_remote_resource_placeholder story_remote_resource story_remote_resource_inline' data-vdom-skip='true' data-src='"+p+"' data-title='"+f+"' data-type='attachment'>\n  <i class=\"fa fa-spinner fa-spin fa-3x fa-fw margin-bottom\"></i>\n</span>"},e.inline.ruler.after("backticks",n,i),e.renderer.rules[n]=r}}}),window.requirejs.define({"lib/markdown/audio":function(e,t,n){n.exports=function(e,t){var n,i,r,o;return"audio","audio recognizes `~[title](src)` markup and turns it into `<audio>` tag (note:\nif you you want this to work in your own code, you must correct the rendering output, which is more\nimaginary than correct right now\u2014this is a MarkDown syntax plugin example, not an HTML5\ntutorial...)",r="audio",o=126,n=function(e,t){var n,i,a,s,l,c,u,d,p,f,h,m,v,g="",_=e.pos,w=e.posMax;if(e.src.charCodeAt(e.pos)!==o)return!1;if(91!==e.src.charCodeAt(e.pos+1))return!1;var y=e.md.utils.normalizeReference,b=e.md.utils.isSpace;if(c=e.pos+2,(l=e.md.helpers.parseLinkLabel(e,e.pos+1,!1))<0)return!1;if((u=l+1)<w&&40===e.src.charCodeAt(u)){for(u++;u<w&&(b(i=e.src.charCodeAt(u))||10===i);u++);if(u>=w)return!1;for(v=u,(p=e.md.helpers.parseLinkDestination(e.src,u,e.posMax)).ok&&(g=e.md.normalizeLink(p.str),e.md.validateLink(g)?u=p.pos:g=""),v=u;u<w&&(b(i=e.src.charCodeAt(u))||10===i);u++);if(p=e.md.helpers.parseLinkTitle(e.src,u,e.posMax),u<w&&v!==u&&p.ok)for(f=p.str,u=p.pos;u<w&&(b(i=e.src.charCodeAt(u))||10===i);u++);else f="";if(u>=w||41!==e.src.charCodeAt(u))return e.pos=_,!1;u++}else{if(void 0===e.env.references)return!1;if(u<w&&91===e.src.charCodeAt(u)?(v=u+1,(u=e.md.helpers.parseLinkLabel(e,u))>=0?s=e.src.slice(v,u++):u=l+1):u=l+1,s||(s=e.src.slice(c,l)),!(d=e.env.references[y(s)]))return e.pos=_,!1;g=d.href,f=d.title}return t||(a=e.src.slice(c,l),e.md.inline.parse(a,e.md,e.env,m=[]),(h=e.push(r,"img",0)).attrs=n=[["src",g],["alt",""]],h.children=m,h.content=a,f&&n.push(["title",f])),e.pos=u,e.posMax=w,!0},i=function(e,t,n,i){var r,o,a,s,l,c,u,d,p;for(o={},s=0,l=(u=e[t].attrs).length;s<l;s++)o[(r=u[s])[0]]=r[1];return p=o.title,d=o.src,a=null,(c=i.previewCache)&&(a=c.get("url_audio_"+d)),n.noRemoteResource?"<audio src='"+d+"' controls>"+p+"</audio>":a||"<span class='story_remote_resource_placeholder story_remote_resource story_remote_resource_block' data-vdom-skip='true' data-src='"+d+"' data-title='"+p+"' data-type='audio'>\n  <i class=\"fa fa-spinner fa-spin fa-3x fa-fw margin-bottom\"></i>\n</span>"},e.inline.ruler.after("backticks","audio",n),e.renderer.rules.audio=i}}}),window.requirejs.define({"lib/markdown/center":function(e,t,n){n.exports=function(e,t){var n,i,r;return i="center","center html recognizes `->center<-` markup and turns it into `<center>center</center>` tag (note:\nif you you want this to work in your own code, you must correct the rendering output, which is more\nimaginary than correct right now\u2014this is a MarkDown syntax plugin example, not an HTML5\ntutorial...)",n=/^->([\s\S]*?)<-/m,r=function(e,t){var r,o,a;return a=e.posMax,"-"===e.src[e.pos]&&">"===e.src[e.pos+1]&&(!!(o=n.exec(e.src.slice(e.pos)))&&(r=o[1],t||(e.posMax=e.pos+2+r.length,e.pos=e.pos+2,e.push(i+"_open",i,1).markup="->",e.md.inline.tokenize(e),e.push(i+"_close",i,-1).markup="<-",e.pos=e.posMax+2,e.posMax=a),!0))},function(e,t,n,i){var r,o,a,s,l;for(o={},a=0,s=(l=e[t].attrs).length;a<s;a++)o[(r=l[a])[0]]=r[1];return"<center>"+o.content+"</center>"},e.inline.ruler.before("text",i,r)}}}),window.requirejs.define({"lib/markdown/markdown_section_parser":function(e,t,n){var i,r,o;r="^[ \\t]*\\n\\\\?\\\\begin\\{[a-z]*\\*?\\}[\\s\\S]*?\\\\end\\{[a-z]*\\*?\\}|"+(r="^[ \\t]*\\n\\\\\\\\[[\\s\\S]*?\\\\\\\\]|"+(r="^[ \\t]*\\n\\$\\$[\\s\\S]*?\\$\\$|"+(r="^```[^`\\n]*\\n[\\s\\S]*?\\n```|"+(r="^.+[ \\t]*\\n=+[ \\t]*\\n+|^.+[ \\t]*\\n-+[ \\t]*\\n+|^\\#{1,6}[ \\t]*.+?[ \\t]*\\#*\\n+")))),r=new RegExp(r,"gm"),o=0,i=function(e,t){var n,i,a,s,l;return s=t.substring(e.length),a=[],n=function(t,n){var r;return r=l.substring(i,n),a.push({id:++o,text:r,textWithFrontMatter:e+r}),e=""},i=0,(l=s+"\n\n").replace(r,(function(e,t){return n(0,t),i=t})),n(0,s.length)},n.exports=i}}),window.requirejs.define({"lib/markdown/nunjucks_inline":function(e,t,n){n.exports=function(e,t){var n,i,r,o;return i="nunjucks","prevent nunjucks tag parsed to html",n=/^\{\{[^\}]*\}\}|^\{\%[^\%]*\%\}/,r=function(e,t){var r,o,a,s;return s=e.pos,a=e.posMax,!!e.md.options.nunjucks&&(!(123!==e.src.charCodeAt(s)||s+4>=a)&&((123===(r=e.src.charCodeAt(s+1))||37===r)&&(!!(o=e.src.slice(s).match(n))&&(t||(e.push(i,"",0).content=e.src.slice(s,s+o[0].length)),e.pos+=o[0].length,!0))))},o=function(e,t,n,i,r){return e[t].content},e.inline.ruler.before("html_inline",i,r),e.renderer.rules[i]=o}}}),window.requirejs.define({"lib/markdown/ruby":function(e,t,n){var i;i=function(e){return e.trim().replace(/\s+/g," ").toUpperCase()},n.exports=function(e,t){var n,r,o,a;return"ruby","ruby html recognizes `{title}(src)` or `{title}[src]` markup and turns it into `<ruby >title <rt>(</rt><rb>src</rb><rt>)</rt></ruby>` tag (note:\nif you you want this to work in your own code, you must correct the rendering output, which is more\nimaginary than correct right now\u2014this is a MarkDown syntax plugin example, not an HTML5\ntutorial...)",n=/^\{([^\}]*)\}\s*\(([^)]+)\)/,r=/^\{([^\}]*)\}\s*\[([^\]]+)\]/,o=function(e,t){var o,a,s,l,c,u,d,p;if("{"!==e.src[e.pos])return!1;if(null==(s=n.exec(e.src.slice(e.pos)))){if(null==(d=r.exec(e.src.slice(e.pos))))return!1;if(a=(s=d)[1],u=s[2],null==(l=null!=(c=e.env.references)?c[i(u)]:void 0))return!1;p=decodeURI(l.href)}else a=s[1],p=s[2];return t||(o=[["ruby",p]],e.push("ruby","ruby",e.level).attrs=o,a&&o.push(["content",a])),e.pos+=s[0].length,!0},a=function(e,t,n,i){var r,o,a,s,l;for(o={},a=0,s=(l=e[t].attrs).length;a<s;a++)o[(r=l[a])[0]]=r[1];return"<ruby>"+o.content+"<rp>(</rp><rt>"+o.ruby+"</rt><rp>)</rp></ruby>"},e.inline.ruler.after("link","ruby",o),e.renderer.rules.ruby=a}}}),window.requirejs.define({"lib/markdown/tableextra":function(e,t,n){var i,r;r=function(e,t){var n,i;return i=e.bMarks[t]+e.blkIndent,n=e.eMarks[t],e.src.substr(i,n-i)},i=function(e){var t,n,i,r,o,a,s,l;for(l=[],s=0,a=e.length,n=null,i=0,o=0,t=!1,r=0,n=e.charCodeAt(s);s<a;)96===n&&i%2==0?(t=!t,r=s):124!==n||i%2!=0||t?92===n?i++:i=0:(l.push(e.substring(o,s)),o=s+1),++s===a&&t&&(t=!1,s=r+1),n=e.charCodeAt(s);return l.push(e.substring(o)),l},n.exports=function(e,t){var n;return"tableextra","table extra",n=function(e,t,n,o){var a,s,l,c,u,d,p,f,h,m,v,g,_,w,y,b,x,k,D,C,$,F,M,T,S,P,j,E,I,O,V,L;if(t+2>n)return!1;if(C=t+1,e.tShift[C]<e.blkIndent)return!1;for(M=-1,T="";C<n;){if(e.bMarks[C]+e.tShift[C]>=e.eMarks[C])return!1;if(b=r(e,C),/^[-:| ]+$/.test(b)){M=C,T=b;break}C++}if(M<0)return!1;if(($=T.split("|")).length<2)return!1;for(l=[],d=f=0,v=$.length;f<v;d=++f){if($[d],!(S=$[d].trim())){if(0===d||d===$.length-1)continue;return!1}if(!/^:?-+:?$/.test(S))return!1;58===S.charCodeAt(S.length-1)?l.push(58===S.charCodeAt(0)?"center":"right"):58===S.charCodeAt(0)?l.push("left"):l.push("")}for(C=t,O=[];C<M;){if(-1===(b=r(e,C).trim()).indexOf("|"))return!1;$=i(b.replace(/^\||\|$/g,"")),O.push($),C++}for(C=M+1,j=[],P=[],a=!1;C<n&&!(e.tShift[C]<e.blkIndent);)if(b=r(e,C).trim()){if(-1===b.indexOf("|"))break;a=!1,($=i(b.replace(/^\||\|$/g,""))).length=l.length,P.push($),C++}else{if(a)break;a=!0,j.push(P),P=[],C++}if(a&&C--,P.length>0&&j.push(P),c="",u=-1,C<=n&&(b=r(e,C).trim(),(k=/\[([\s\S]*?)\]/.exec(b))&&(c=k[1],u=C,C++)),o)return!0;for((V=e.push("table_open","table",1)).attrJoin("class","table-extra"),V.map=[t,0],c&&((V=e.push("table_caption_open","caption",1)).map=[u,u+1],(V=e.push("inline","",0)).content=c.trim(),V.map=[u,u+1],V.children=[],V=e.push("table_caption_close","caption",-1)),(V=e.push("table_colgroup_open","colgroup",1)).map=[t,0],d=h=0,g=l.length;h<g;d=++h)s=l[d],V=e.push("table_col","col",0),s&&(V.attrs=[["style","text-align:"+s]]);for(V=e.push("table_colgroup_close","colgroup",-1),(V=e.push("table_thead_open","thead",1)).map=[t,0],d=m=0,_=O.length;m<_;d=++m){for(L=O[d],(V=e.push("table_tr_open","tr",1)).map=[t,0],p=0;p<L.length;)F=0,I=(I=L[p])||"",(V=e.push("table_th_open","th",1)).map=[t,t+1],V.attrs=[],l[p]&&V.attrs.push(["style","text-align:"+l[p]]),F>0&&V.attrs.push(["colspan",F+1]),(V=e.push("inline","",0)).content=I.trim(),V.map=[t,t+1],V.children=[],V=e.push("th_close","th",-1),p=F+p+1;V=e.push("table_tr_close","tr",-1)}for(V=e.push("table_thead_close","thead",-1),d=x=0,w=j.length;x<w;d=++x){for(P=j[d],(V=e.push("table_tbody_open","tbody",1)).map=[t,0],d=D=0,y=P.length;D<y;d=++D){for(L=P[d],(V=e.push("table_tr_open","tr",1)).map=[t,0],p=0;p<L.length;)F=0,E=(E=L[p])||"",(V=e.push("table_td_open","td",1)).map=[t,t+1],V.attrs=[],l[p]&&V.attrs.push(["style","text-align:"+l[p]]),F>0&&V.attrs.push(["colspan",F+1]),(V=e.push("inline","",0)).content=E.trim(),V.map=[t,t+1],V.children=[],V=e.push("table_td_close","td",-1),p=F+p+1;V=e.push("table_tr_close","tr",-1)}V=e.push("table_tbody_close","tbody",-1)}return V=e.push("table_close","table",-1),e.line=C,!0},function(e,t,n,o){var a,s,l,c,u,d,p,f,h,m,v,g,_,w,y,b,x;if(t+2>n)return!1;if(v=t+1,e.tShift[v]<e.blkIndent)return!1;if((g=e.bMarks[v]+e.tShift[v])>=e.eMarks[v])return!1;if(124!==(s=e.src.charCodeAt(g))&&45!==s&&58!==s)return!1;if(m=r(e,t+1),!/^[-:| ]+$/.test(m))return!1;if((_=m.split("|")).length<2)return!1;for(a=[],l=c=0,p=_.length;c<p;l=++c){if(_[l],!(w=_[l].trim())){if(0===l||l===_.length-1)continue;return!1}if(!/^:?-+:?$/.test(w))return!1;58===w.charCodeAt(w.length-1)?a.push(58===w.charCodeAt(0)?"center":"right"):58===w.charCodeAt(0)?a.push("left"):a.push("")}if(-1===(m=r(e,t).trim()).indexOf("|"))return!1;if(_=i(m.replace(/^\||\|$/g,"")),a.length!==_.length)return!1;if(o)return!0;for((x=e.push("table_open","table",1)).map=y=[t,0],(x=e.push("thead_open","thead",1)).map=[t,t+1],(x=e.push("tr_open","tr",1)).map=[t,t+1],l=u=0,f=_.length;u<f;l=++u)_[l],(x=e.push("th_open","th",1)).map=[t,t+1],a[l]&&(x.attrs=[["style","text-align:"+a[l]]]),(x=e.push("inline","",0)).content=_[l].trim(),x.map=[t,t+1],x.children=[],x=e.push("th_close","th",-1);for(x=e.push("tr_close","tr",-1),x=e.push("thead_close","thead",-1),(x=e.push("tbody_open","tbody",1)).map=b=[t+2,0],v=t+2;v<n&&!(e.tShift[v]<e.blkIndent)&&-1!==(m=r(e,v).trim()).indexOf("|");){for((_=i(m.replace(/^\||\|$/g,""))).length=a.length,x=e.push("tr_open","tr",1),l=d=0,h=_.length;d<h;l=++d)_[l],x=e.push("td_open","td",1),a[l]&&(x.attrs=[["style","text-align:"+a[l]]]),(x=e.push("inline","",0)).content=_[l]?_[l].trim():"",x.children=[],x=e.push("td_close","td",-1);x=e.push("tr_close","tr",-1),v++}return x=e.push("tbody_close","tbody",-1),x=e.push("table_close","table",-1),y[1]=b[1]=v,e.line=v,!0},e.block.ruler.before("paragraph","tableextra",n,{alt:["paragraph","reference"]})}}}),window.requirejs.define({"lib/markdown/video":function(e,t,n){n.exports=function(e,t){var n,i,r,o;return"video","video recognizes `%[title](src)` `%[title](src src src)` markup and turns it into `<video>` or `<video><source /><source /></video>` tag (note:\nif you you want this to work in your own code, you must correct the rendering output, which is more\nimaginary than correct right now\u2014this is a MarkDown syntax plugin example, not an HTML5\ntutorial...)",r="video",o=37,n=function(e,t){var n,i,a,s,l,c,u,d,p,f,h,m,v,g="",_=e.pos,w=e.posMax;if(e.src.charCodeAt(e.pos)!==o)return!1;if(91!==e.src.charCodeAt(e.pos+1))return!1;var y=e.md.utils.normalizeReference,b=e.md.utils.isSpace;if(c=e.pos+2,(l=e.md.helpers.parseLinkLabel(e,e.pos+1,!1))<0)return!1;if((u=l+1)<w&&40===e.src.charCodeAt(u)){for(u++;u<w&&(b(i=e.src.charCodeAt(u))||10===i);u++);if(u>=w)return!1;for(v=u,(p=e.md.helpers.parseLinkDestination(e.src,u,e.posMax)).ok&&(g=e.md.normalizeLink(p.str),e.md.validateLink(g)?u=p.pos:g=""),v=u;u<w&&(b(i=e.src.charCodeAt(u))||10===i);u++);if(p=e.md.helpers.parseLinkTitle(e.src,u,e.posMax),u<w&&v!==u&&p.ok)for(f=p.str,u=p.pos;u<w&&(b(i=e.src.charCodeAt(u))||10===i);u++);else f="";if(u>=w||41!==e.src.charCodeAt(u))return e.pos=_,!1;u++}else{if(void 0===e.env.references)return!1;if(u<w&&91===e.src.charCodeAt(u)?(v=u+1,(u=e.md.helpers.parseLinkLabel(e,u))>=0?s=e.src.slice(v,u++):u=l+1):u=l+1,s||(s=e.src.slice(c,l)),!(d=e.env.references[y(s)]))return e.pos=_,!1;g=d.href,f=d.title}return t||(a=e.src.slice(c,l),e.md.inline.parse(a,e.md,e.env,m=[]),(h=e.push(r,"img",0)).attrs=n=[["src",g],["alt",""]],h.children=m,h.content=a,f&&n.push(["title",f])),e.pos=u,e.posMax=w,!0},i=function(e,t,n,i){var r,o,a,s,l,c,u,d,p,f,h;for(a={},l=0,c=(d=e[t].attrs).length;l<c;l++)a[(o=d[l])[0]]=o[1];return h=a.title,p=a.src,s=null,(u=i.previewCache)&&(s=u.get("url_video_"+p)),n.noRemoteResource?(f=p.split(" ")).length>1?"<video controls>"+[function(){var e,t,n;for(n=[],e=0,t=f.length;e<t;e++)r=f[e],n.push("<source src='"+r+"' />");return n}()].join("")+h+"</video>":"<video src='"+p+"' controls>"+h+"</video>":s||"<span class='story_remote_resource_placeholder story_remote_resource story_remote_resource_block' data-vdom-skip='true' data-src='"+p+"' data-title='"+h+"' data-type='video'>\n  <i class=\"fa fa-spinner fa-spin fa-3x fa-fw margin-bottom\"></i>\n</span>"},e.inline.ruler.after("backticks","video",n),e.renderer.rules.video=i}}}),window.requirejs.define({"lib/miniweb_server":function(e,t,n){var i,r,o,a,s,l,c,u,d,p,f,h,m,v,g,w,y;i=t("../constant"),t("../lib/utils"),t("../application"),o=t("../lib/notifier"),y=null,g=function(){return y&&(y.removeAllListeners(),y.pull.removeAllListeners(),y.push.removeAllListeners(),y.cancel()),y=null},s=function(e){if(e){if(e instanceof TypeError)e=e.toString();else try{e=JSON.stringify(e)}catch(t){t,console.log(e)}return e}},p=function(e,t){return e.get("_design/sync_index",(function(n,i){return w(e,i,t)}))},c=function(){return'{"_id":"_design/sync_index","views":{"get_recent_docs":{"map":"function (e){var t,n,i,r;if(\\"attachment\\"!==e.type&&0!==e._id.indexOf(\\"_design/\\")&&!e.isSys){n=e._attachments||{},r=[];for(i in n)t=n[i],\\"text/xsj-link\\"===t.content_type&&r.push(e._id+\\"__\\"+i);return emit([e.updateDate,e._id],r)}}"},"for_sync":{"map":"function (e){if(0!==e._id.indexOf(\\"_design/\\")&&!e.isSys)return emit([e.updateDate,e._id])}"}}}','{"_id":"_design/sync_index","views":{"get_recent_docs":{"map":"function (e){var t,n,i,r;if(\\"attachment\\"!==e.type&&0!==e._id.indexOf(\\"_design/\\")&&!e.isSys){n=e._attachments||{},r=[];for(i in n)t=n[i],\\"text/xsj-link\\"===t.content_type&&r.push(e._id+\\"__\\"+i);return emit([e.updateDate,e._id],r)}}"},"for_sync":{"map":"function (e){if(0!==e._id.indexOf(\\"_design/\\")&&!e.isSys)return emit([e.updateDate,e._id])}"}}}'},l=function(){var e,t;return e=function(e){if(0!==e._id.indexOf("_design/")&&!e.isSys)return emit([e.updateDate,e._id])},{_id:"_design/sync_index",views:{get_recent_docs:{map:function(e){var t,n,i;if("attachment"!==e.type&&0!==e._id.indexOf("_design/")&&!e.isSys){for(n in i=[],t=e._attachments||{})"text/xsj-link"===t[n].content_type&&i.push(e._id+"__"+n);return emit([e.updateDate,e._id],i)}}.toString()},for_sync:{map:e.toString()}}},t=c(),JSON.parse(t)},a=function(e){var t;return t=l(),!!(e&&e.views&&e.views.get_recent_docs&&e.views.get_recent_docs.map===t.views.get_recent_docs.map&&e.views.for_sync&&e.views.for_sync.map===t.views.for_sync.map)},w=function(e,t,n){var i;return i=l(),a(t)?n():(t&&t._rev&&(i._rev=t._rev),e.put(i,(function(e){return e=s(e),n(e)})))},d=function(e,t,n,i){var o;return o=function(n){return Promise.all([e.info(),t.info()]).then((function(o){var a,l,c,u;return a=o[0],u=o[1]||{},l=e.sync(t,{batch_size:1,doc_ids:n,since:0,checkpoint:!1}),c=uniqueNumber(),r.trigger("syncInfo",{id:c,type:"pullpush",docIds:n,state:"start",dbInfo:a,targetInfo:u,listeners:l}),l.on("change",(function(e){return u.info||(u.info=e),r.trigger("syncInfo",{id:c,type:"pullpush",state:"syncing",info:e,dbInfo:a,targetInfo:u,listeners:l})})).then((function(e){return r.trigger("syncInfo",{id:c,state:"end",dbInfo:a}),i()})).catch((function(e){var t;return t=s(e),r.trigger("syncInfo",{id:c,state:"fault",dbInfo:a,error:t}),i(t)}))})).catch((function(e){return e=s(e),i(e)}))},u(e,t,[],n,(function(e,t){return e?i(e):t&&t.length>0?o(t):i()}))},u=function(e,t,n,i,r){return n=n||[],t.query("sync_index/get_recent_docs",{limit:i,include_docs:!1,conflicts:!0,descending:!0,reduce:!1,group:!1}).then((function(e){return e.rows.length>0&&e.rows.forEach((function(e,t){return(e.value||[]).forEach((function(e,t){return n.push(e)})),n.push(e.id)})),r(null,n)})).catch((function(e){return r(s(e))}))},h=function(e,t,n,i){return u(e,t,[],n,(function(r,o){return r?i(r):m(e,t,o,n,(function(n){return n?i(n):e.sync(t,{batch_size:1,doc_ids:o,since:0,checkpoint:!1}).then((function(e){return i()})).catch((function(e){return i(e)}))}))}))},m=function(e,t,n,i,r){return n=n||[],e.query("query_index/by_updatedate_for_sync",{limit:i,include_docs:!1,conflicts:!1,descending:!0,reduce:!1,group:!1}).then((function(e){return e.rows.length>0&&e.rows.forEach((function(e,t){return(e.value||[]).forEach((function(e,t){return n.push(e)})),n.push(e.id)})),r(null,n)})).catch((function(e){return r(s(e))}))},v=function(e,t,n,i){var o;return o=function(n){return Promise.all([e.info(),t.info()]).then((function(o){var a,l,c,u;return a=o[0],u=o[1]||{},l=e.sync(t,{batch_size:1,doc_ids:n,since:0,checkpoint:!1}),c=uniqueNumber(),r.trigger("syncInfo",{id:c,type:"pullpush",docIds:n,state:"start",dbInfo:a,targetInfo:u,listeners:l}),l.on("change",(function(e){return u.info||(u.info=e),r.trigger("syncInfo",{id:c,type:"pullpush",state:"syncing",info:e,dbInfo:a,targetInfo:u,listeners:l})})).then((function(e){return r.trigger("syncInfo",{id:c,state:"end",dbInfo:a}),i()})).catch((function(e){return e=s(e),r.trigger("syncInfo",{id:c,state:"fault",dbInfo:a,error:e}),i(e)}))})).catch((function(e){return e=s(e),i(e)}))},m(e,t,[],n,(function(e,t){return e?i(e):t&&t.length>0?o(t):i()}))},f=null,r={init:function(e){var t;if(null==e&&(e={}),e.autoStart)return t=function(e){var t;if(e){try{e=JSON.stringify(e)}catch(e){t=e,console.log(t)}return o.showMessage("\u8ff7\u4f60\u5320\u670d\u52a1\u542f\u52a8\u5931\u8d25,"+e,6e3,"error"),r.trigger("fault",e)}},r.startServer(e,t)},getServer:function(){return f},startServer:function(e,t){return window.pouchdbServerManager?window.pouchdbServerManager.startPouchDBServer(e,(function(n,i){return n?"function"==typeof t?t(n):void 0:(e.password&&(i.password=e.password,e.username?i.username=e.username:i.username="admin"),f=i,r.trigger("start"),r.startCustomSyncCouchdb((function(e){return"function"==typeof t?t(e,i):void 0})))})):t("\u670d\u52a1\u672a\u6b63\u5e38\u521d\u59cb\u5316")},stopServer:function(e){var t;return t=function(){return f=null,r.trigger("stop"),e()},r.stopSyncCouchdb((function(){return window.pouchdbServerManager?window.pouchdbServerManager.stopPouchDBServer((function(){return t()})):t()}))},destroyServer:function(e){return r.stopServer((function(){return window.pouchdbServerManager?window.pouchdbServerManager.destroyPouchDBServer((function(){return e()})):e()}))},stopSyncCouchdb:function(e){return g(),setTimeout((function(){return"function"==typeof e?e():void 0}),10)},startFullReplicateFromCouchdb:function(e){var t,n;return n=r.getTargetDB(),t=i.pouchDB,Promise.all([t.info(),n.info()]).then((function(i){var o,a,l,c;return o=i[0],c=i[1]||{},a=t.replicate.from(n,{batch_size:1,since:0,checkpoint:!1,query_params:{uid:uniqueNumber()},filter:"_view",view:"sync_index/for_sync"}),l=uniqueNumber(),r.trigger("syncInfo",{id:l,type:"pull",state:"start",dbInfo:o,targetInfo:c,listeners:a}),a.on("change",(function(e){return c.info||(c.info=e),r.trigger("syncInfo",{id:l,type:"pull",state:"syncing",info:e,dbInfo:o,targetInfo:c})})).then((function(){return r.trigger("syncInfo",{id:l,state:"end",dbInfo:o}),e()})).catch((function(t){return t=s(t),r.trigger("syncInfo",{id:l,state:"fault",dbInfo:o,error:t}),e(t)}))})).catch((function(t){return t=s(t),e(t)}))},replicateToCountDocs:function(e,t){var n,o;return null==e&&(e=10),o=r.getTargetDB(),n=i.pouchDB,v(n,o,e,t)},replicateFromCountDocs:function(e,t){var n,o;return null==e&&(e=10),o=r.getTargetDB(),n=i.pouchDB,p(o,(function(i){return i?t(i):d(n,o,e,t)}))},getTargetDB:function(){var e,t,n,i,r;return f?(i="http://localhost:"+f.web.port+"/data/user_"+f.user.id,r=f.username||"",n=f.password||"",!1,r=$.trim(r),n=$.trim(n),t={},r&&(e={username:r,password:n},t.auth=e),t.fetch=function(e,t){return PouchDB.fetch(e,t)},new PouchDB(i,t)):null},startCustomSyncCouchdb:function(e){var t,n;return t=i.pouchDB,n=r.getTargetDB(),10,r.startSyncCouchdb(t,n,10,e)},startSyncCouchdb:function(e,t,n,i){return null==n&&(n=10),p(t,(function(o){var a;return o?(o=s(o),i(o)):i(),a="now",-1===n?a=0:(r.trigger("syncing"),h(e,t,n,(function(){return r.trigger("synced")}))),r.liveSyncCouchdb(e,a,t)}))},syncSpecDocIds:function(e,t){var n,o;return o=r.getTargetDB(),n=i.pouchDB,Promise.all([n.info(),o.info()]).then((function(i){var a,s,l,c;return a=i[0],c=i[1]||{},s=n.sync(o,{batch_size:1,doc_ids:e}),l=uniqueNumber(),r.trigger("syncInfo",{id:l,type:"pullpush",docIds:e,state:"start",dbInfo:a,targetInfo:c,listeners:s}),s.on("change",(function(e){return c.info||(c.info=e),r.trigger("syncInfo",{id:l,type:"pullpush",state:"syncing",info:e,dbInfo:a,targetInfo:c,listeners:s})})).then((function(e){return r.trigger("syncInfo",{id:l,state:"end",dbInfo:a}),t()})).catch((function(e){return r.trigger("syncInfo",{id:l,state:"fault",dbInfo:a,error:e}),t(e)}))})).catch((function(e){return e=s(e),t(e)}))},pullAndPushRecentCountDocs:function(e,t){var n,o;return o=r.getTargetDB(),n=i.pouchDB,h(n,o,e,t)},liveSyncCouchdb:function(e,t,n){return null==t&&(t="now"),g(),(y=e.sync(n,{batch_size:1,live:!0,retry:!0,since:t,conflicts:!0,push:{filter:function(e){return!e._id.startsWith("_design/")&&!e.isSys}},pull:{filter:"_view",view:"sync_index/for_sync"}})).on("error",(function(e){return e=s(e),r.trigger("fault",e),y=null})),y.on("denied",(function(e){return e=s(e),r.trigger("denied",e)})),y.push.on("paused",(function(e){return e?(e=s(e),r.trigger("error",e)):r.trigger("synced")})),y.pull.on("paused",(function(e){if(e){if("ETIMEDOUT"===e.code)return;return e=s(e),r.trigger("error",e)}return r.trigger("synced")})),y.pull.on("active",(function(){return r.trigger("syncing")})),y.push.on("active",(function(){return r.trigger("syncing")})),y.on("change",(function(){return r.trigger("synced")})),y.on("complete",(function(){return r.trigger("synced"),y=null}))}},_.extend(r,Backbone.Events),n.exports=r}}),window.requirejs.define({"lib/notifier":function(e,t,n){var i,r,o,a,s;r=(r=$(".notifications.top-right")).length>0?r:$('<div class="notifications top-right"></div>').appendTo("body"),o=(o=$(".notifications.bottom-right")).length>0?o:$('<div class="notifications bottom-right"></div>').appendTo("body"),a=o.notify({fadeOut:{enabled:!1},message:{text:"\u5904\u7406\u4e2d...",type:"info"}}),s=null,i={showMessage:function(e,t,n,i){var o,s,l,c;return null==i&&(i={}),i=$.extend({},{onClosed:$.noop,onClose:$.noop},i),c="object"==typeof e?e:{text:e},l=!0,s=!1,"error"!==n&&-1!==t||(l=!1,s=!0,a.hide()),(o=r.notify({fadeOut:{enabled:l,delay:t||1e3},closable:s,message:c,type:n||"info",onClosed:i.onClosed,onClose:i.onClose})).show(),o},showHandling:function(e,t){if(s&&(clearTimeout(s),s=null),a.$note.html(e||"\u5904\u7406\u4e2d..."),a.$note.prepend("<i class='asterisk loading icon'></i>"),a.show(),t)return s=setTimeout((function(){return s=null,a.hide()}),1e3)},hideHandling:function(){return a.hide()}},n.exports=i}}),window.requirejs.define({"lib/nunjucks/core":function(e,t,n){var i,r,o,a,s,l,c,u,d,p={}.hasOwnProperty;s=t("./tag"),i=t("./filter"),l=/^ *(`{3,}|~{3,})[ \.]*(\S+)? *\n([\s\S]*?)\s*\1 *(?:\n+|$)/gm,c=/(`+)\s*([\s\S]*?[^`])\s*\1(?!`)/gm,o=function(){function e(){this.env=new nunjucks.Environment(null,{autoescape:!1}),s(this),i(this)}return e.prototype.placeholder="\ufffc",e.prototype.rPlaceholder=/(?:<|&lt;)\!--\uFFFC(\d+)--(?:>|&gt;)/g,e.prototype.ctx=null,e.prototype.register=function(e,t,n){var i;if(!e)throw new TypeError("name is required");if("function"!=typeof t)throw new TypeError("fn must be a function");return n&&"boolean"!=typeof n||(n={ends:n}),i=n.ends?new r(e,t):new a(e,t),this.env.addExtension(e,i)},e.prototype.render=function(e,t){var n,i,r;return null==t&&(t={context:{}}),this.ctx=t,e,n=[],r=this.placeholder,i=function(e){return"\x3c!--"+r+(n.push(e)-1)+"--\x3e"},e=(e=e.replace(l,i)).replace(c,i),e=(e=this.env.renderString(e,t.context)).replace(this.rPlaceholder,(function(e,t){return n[t]}))},e.prototype._render=function(e,t){var n,i,r;return null==t&&(t={context:{}}),this.ctx=t,e,n=[],r=this.placeholder,i=function(e){return"\x3c!--"+r+(n.push(e)-1)+"--\x3e"},e=e.replace(/<code.*>[\s\S]*?<\/code>/gm,i),e=(e=this.env.renderString(e,t.context)).replace(this.rPlaceholder,(function(e,t){return n[t]}))},e}(),a=function(){function e(e,t){this.tags=[e],this.fn=t}return e.prototype.parse=function(e,t,n){var i;return i=this._parseArgs(e,t,n),new t.CallExtension(this,"run",i,[])},e.prototype._parseArgs=function(e,t,n){var i,r,o,a,s,l;for(s=e.nextToken(),a=new t.NodeList(s.lineno,s.colno),i=new t.Array(s.lineno,s.colno),r="";l=e.nextToken(!0);)if(l.type===n.TOKEN_WHITESPACE||l.type===n.TOKEN_BLOCK_END){if(""!==r&&(o=new t.Literal(s.lineno,s.colno,r.trim()),i.addChild(o),r=""),l.type===n.TOKEN_BLOCK_END)break}else r+=l.value;return a.addChild(i),a},e.prototype.run=function(e,t){return this._run(e,t,"")},e.prototype._run=function(e,t,n){return this.fn.call(e.ctx,t,n)},e}(),u=function(e){var t,n,i;return(n=e.match(/^[ \t]*(?=\S)/gm))?(t=Math.min.apply(Math,n.map((function(e){return e.length}))),i=new RegExp("^[ \\t]{"+t+"}","gm"),t>0?e.replace(i,""):e):e},d=function(e){return u(e()).replace(/^\n?|\n?$/g,"")},r=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)p.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.parse=function(e,t,n){var i,r;return r=this._parseArgs(e,t,n),i=this._parseBody(e,t,n),new t.CallExtension(this,"run",r,[i])},t.prototype._parseBody=function(e,t,n){var i;return i=e.parseUntilBlocks("end"+this.tags[0]),e.advanceAfterBlockEnd(),i},t.prototype.run=function(e,t,n){return this._run(e,t,d(n))},t}(a),n.exports=o}}),window.requirejs.define({"lib/nunjucks/filter/date":function(e,t,n){var i;i=function(e,t){var n,i,r,o,a;r=[],n=[],Array.prototype.push.apply(n,arguments);try{o=window.moment.utc(e)}catch(e){i=e,r.push(i)}if(o)try{a=o[t]&&$.isFunction(o[t])?o[t].apply(o,n.slice(2)):o.format(t||"YYYY-MM-DD HH:mm:ss")}catch(e){i=e,r.push(i)}return r.length>0?r.join("\n"):a},n.exports=i}}),window.requirejs.define({"lib/nunjucks/filter/index":function(e,t,n){n.exports=function(e){var n,i;return n=t("./date"),i=t("./numbo"),e.env.addFilter("date",n),e.env.addFilter("numbo",i)}}}),window.requirejs.define({"lib/nunjucks/filter/numbo":function(e,t,n){var i;i=function(e,t,n){var i,r,o;null==t&&(t="zhTW"),null==n&&(n="check"),r=[];try{o=numbo.convert(e,t,n)}catch(e){i=e,r.push(i)}return r.length>0?r.join("\n"):o},n.exports=i}}),window.requirejs.define({"lib/nunjucks/tag/blockquote":function(e,t,n){var i,r,o,a;a=/(\S.*)\s+(https?:\/\/)(\S+)\s+(.+)/i,o=/(\S.*)\s+(https?:\/\/)(\S+)/i,r=/([^,]+),\s*([^,]+)/,i=/(.+)/,n.exports=function(e){return function(t,n){var s,l,c,u,d,p,f,h;return s="",p="",h="",l="",d="",(f=t.join(" "))&&(a.test(f)?(s=(u=f.match(a))[1],p=u[2]+u[3],h=u[4]):o.test(f)?(s=(u=f.match(o))[1],p=u[2]+u[3]):r.test(f)?(s=(u=f.match(r))[1],h=u[2]):i.test(f)&&(s=(u=f.match(i))[1]),s&&(l+="<strong>"+s+"</strong>"),p?(c=p.replace(/^https?:\/\/|\/(index.html?)?$/g,""),l+='<cite><a href="'+p+'">'+(h=h||c)+"</a></cite>"):h&&(l+="<cite>"+h+"</cite>")),d+="<blockquote>\n",d+=e.ctx.getRender().render(n,e.ctx.env),l&&(d+="<footer>"+l+"</footer>"),d+="\n</blockquote>"}}}}),window.requirejs.define({"lib/nunjucks/tag/code":function(e,t,n){var i,r,o,a,s,l,c,u;o=/(\S[\S\s]*)\s+(https?:\/\/)(\S+)\s+(.+)/i,r=/(\S[\S\s]*)\s+(https?:\/\/)(\S+)/i,i=/(\S[\S\s]*)/,l=/\s*lang:(\w+)/i,c=/\s*line_number:(\w+)/i,s=/\s*highlight:(\w+)/i,a=/\s*first_line:(\d+)/i,u=/\s*mark:([0-9,\-]+)/i,n.exports=function(e){return function(e,t){var n,d,p,f,h,m,v,g,w,y,b;return n=e.join(" "),f=!0,m="",l.test(n)&&(n=n.replace(l,(function(){return m=arguments[1],""}))),s.test(n)&&(n=n.replace(s,(function(){return f="true"===arguments[1],""}))),(f=f&&!!m)?("",v=!1,h=-1,g=[],c.test(n)&&(n=n.replace(c,(function(){return v="true"===arguments[1],""}))),a.test(n)&&(n=n.replace(a,(function(){try{h=parseInt(arguments[1])}catch(e){e,h=-1}return""}))),u.test(n)&&(n=n.replace(u,(function(){return g=arguments[1].split(",").reduce((function(e,t){var n,i,r;if(/\-/.test(t)){for(n=Number(t.substr(0,t.indexOf("-"))),(i=Number(t.substr(t.indexOf("-")+1)))<n&&(r=n,n=i,i=r);n<=i;)e.push(n),n++;return e}return e.push(Number(t)),e}),[]),""}))),o.test(n)?(b=(w=n.match(o))[1],w[2]+w[3],w[4]):r.test(n)?(b=(w=n.match(r))[1],w[2]+w[3]):i.test(n)&&(b=(w=n.match(i))[1]),d={},v&&(d.linenums=!0),h>0&&(d.linenums=h),g.length>0&&(d.fancy=g.join(",")),b&&(d.title=b),p="",m&&(p+="language-"+m),(y=decodeURIComponent($.param(d)))&&(p+="?"+y),t='<pre><code class="'+_.escape(p)+'">'+_.escape(t)+"\n</code></pre>"):'<pre><code class="nohighlight hljs">'+_.escape(t)+"</code></pre>"}}}}),window.requirejs.define({"lib/nunjucks/tag/img":function(e,t,n){var i,r,o;i=function(e,t,n){var i,r,o;if(!e)throw new TypeError("tag is required!");for(i in r="<"+e,t)(o=t[i])&&(r+=" "+i+'="'+o+'"');return r+=n?">"+n+"</"+e+">":">"},o=/((([A-Za-z]{3,9}:(?:\/\/)?)(?:[-;:&=\+\$,\w]+@)?[A-Za-z0-9.-]+|(?:www.|[-;:&=\+\$,\w]+@)[A-Za-z0-9.-]+)((?:\/[\+~%\/.\w-_]*)?\??(?:[-\+=&;%@.\w_]*)#?(?:[.\!\/\\w]*))?)/,r=/["']?([^"']+)?["']?\s*["']?([^"']+)?["']?/,n.exports=function(e){return function(t,n){var a,s,l,c,u,d,p,f,h,m,v,g;for(l=[],h="",d="",u=0,p=t.length,e.ctx.env;u<p;){if(d=t[u],u++,o.test(d)){m=d;break}l.push(d)}return(t=t.slice(u+1)).length&&(/\D+/.test(t[0])||(g=t.shift(),t.length&&!/\D+/.test(t[0])&&(c=t.shift())),h=t.join(" ")),h&&r.test(h)&&(v=(f=h.match(r))[1],a=f[2]),s={src:m,class:l.join(" "),width:g,height:c,title:v,alt:a},i("img",s)}}}}),window.requirejs.define({"lib/nunjucks/tag/index":function(e,t,n){n.exports=function(e){var n,i,r,o,a,s,l,c;return n=t("./blockquote")(e),e.register("quote",n,!0),e.register("blockquote",n,!0),a=t("./pullquote")(e),e.register("pullquote",a,!0),i=t("./code")(e),e.register("code",i,!0),e.register("codeblock",i,!0),r=t("./img")(e),e.register("img",r),e.register("image",r),c=t("./youtube")(e),e.register("youtube",c),l=t("./vimeo")(e),e.register("vimeo",l),s=t("./slideshare")(e),e.register("slideshare",s),o=t("./link"),e.register("a",o),e.register("link",o),e.register("anchor",o)}}}),window.requirejs.define({"lib/nunjucks/tag/link":function(e,t,n){var i,r,o;i=function(e,t,n){var i,r,o;if(!e)throw new TypeError("tag is required!");for(i in r="<"+e,t)(o=t[i])&&(r+=" "+i+'="'+o+'"');return r+=n?">"+n+"</"+e+">":">"},o=/((([A-Za-z]{3,9}:(?:\/\/)?)(?:[-;:&=\+\$,\w]+@)?[A-Za-z0-9.-]+|(?:www.|[-;:&=\+\$,\w]+@)[A-Za-z0-9.-]+)((?:\/[\+~%\/.\w-_]*)?\??(?:[-\+=&;%@.\w_]*)#?(?:[.\!\/\\w]*))?)/,r=function(e,t){var n,r,a,s,l,c,u,d;for(d="",c=[],n=!1,u="",a="",r=0,s=e.length;r<s;){if(a=e[r],r++,o.test(a)){d=a;break}c.push(a)}return(e=e.slice(r+1)).length&&("true"!==(l=e[0])&&"false"!==l||(n="true"===l,e.shift()),u=e.join(" ")),i("a",{href:d,title:u,target:n?"_blank":""},c.join(" "))},n.exports=r}}),window.requirejs.define({"lib/nunjucks/tag/pullquote":function(e,t,n){n.exports=function(e){return function(t,n){var i;return i="",t.unshift("pullquote"),i+='<blockquote class="'+t.join(" ")+'">\n',i+=e.ctx.getRender().render(n,e.ctx.env),i+="\n</blockquote>"}}}}),window.requirejs.define({"lib/nunjucks/tag/slideshare":function(e,t,n){n.exports=function(e){return function(t,n){var i,r;return i=t[0],(r=e.ctx.env.previewCache.get("slideshare_"+i))?'<div class="slideshare_container story_script_resource_placeholder story_remote_resource_placeholder story_remote_resource" data-vdom-skip="true" data-vdom-cache="true" data-slideshareid="'+i+'" data-type="slideshare" data-status="thumbnail"><img src="'+r+'"/><i class="icon fa fa-slideshare fa-5x"></i></div>':'<div class="slideshare_container story_script_resource_placeholder story_remote_resource_placeholder story_remote_resource" data-vdom-skip="true" data-slideshareid="'+i+'" data-type="slideshare" data-status="init"><img /><i class="icon fa fa-spinner fa-spin fa-5x"></i></div>'}}}}),window.requirejs.define({"lib/nunjucks/tag/vimeo":function(e,t,n){n.exports=function(e){return function(t,n){var i,r;return i=t[0],(r=e.ctx.env.previewCache.get("vimeo_"+i))?'<div class="vimeo_container video_container story_script_resource_placeholder" data-vdom-skip="true" data-vdom-cache="true" data-videoid="'+i+'" data-type="vimeo" data-status="thumbnail"><img src="'+r+'"/><i class="icon fa fa-vimeo-square fa-5x"></i></div>':'<div class="vimeo_container video_container story_script_resource_placeholder" data-vdom-skip="true" data-videoid="'+i+'" data-type="vimeo" data-status="init"><img /><i class="icon fa fa-spinner fa-spin fa-5x"></i></div>'}}}}),window.requirejs.define({"lib/nunjucks/tag/youtube":function(e,t,n){n.exports=function(e){return function(t,n){var i,r;return i=t[0],(r=e.ctx.env.previewCache.get("youtube_"+i))?'<div class="youtube_container video_container story_script_resource_placeholder" data-vdom-skip="true" data-vdom-cache="true" data-videoid="'+i+'" data-type="youtube" data-status="thumbnail"><img src="'+r+'"/><i class="icon fa fa-youtube-play fa-5x"></i></div>':'<div class="youtube_container video_container story_script_resource_placeholder" data-vdom-skip="true" data-videoid="'+i+'" data-type="youtube" data-status="init"><img/><i class="icon fa fa-spinner fa-spin fa-5x"></i></div>'}}}}),window.requirejs.define({"lib/pouchdb_index_view_manager":function(exports,requirejs,module){var _fullSearch,_normalContentSearch,_normalSearch,autoBuildIndexFn,buildAttachmentView,buildCategoryAndFlagView,buildColorView,buildContentView,buildDateView,buildDraftView,buildFullSearchView,buildNormalView,buildReverseLinkView,buildSlugView,buildTitleView,buildUpView,buildViews,countOccurrences,destroyAllViews,fullSearch,getAttachmentView,getBuildViewNames,getCategoryAndFlagView,getColorView,getConditionIdsFn,getContentView,getDateView,getDraftView,getReverseLinkView,getSlugView,getTitleView,getUpView,queryByCreateDateRange,queryByUpdateDateRange,indexOf=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};getCategoryAndFlagView=function(e,t){var n,i,r,o,a,s,l,c,u,d,p;return i=function(e){return e.category+",,,,"+e.isDeleted},o=function(e){if(!(e.type&&"markdown"!==e.type||e.isDeleted||null===e.flag||void 0===e.flag))return emit(e.flag,{updateDate:e.updateDate,createDate:e.createDate})},s=function(e){return e.flag+",,,,"+e.isDeleted},c=function(e,t,n){return e.length},n=function(e){if((!e.type||"markdown"===e.type)&&!e.isDeleted&&e.category&&"string"==typeof e.category)return emit(e.category,{updateDate:e.updateDate,createDate:e.createDate})}.toString(),a=o.toString(),u=c.toString(),r=i.toString(),l=s.toString(),d={views:{by_category:{map:n,reduce:u},by_flag:{map:a,reduce:u}}},p="xsj-"+CryptoJS.MD5(JSON.stringify(d)).toString(),d.views.by_category.indexCheck=r,d.views.by_flag.indexCheck=l,d._id="_design/"+p,e.get("_design/"+p,(function(n,i){return i&&(d._rev=i._rev),n||i.views.by_category.indexCheck!==r?e.viewCleanup((function(){return e.put(d,(function(e,n){return e&&console.error("\u521b\u5efacategoryAndFlag\u89c6\u56fe\u51fa\u9519:"+e),t(null,{viewName:p})}))})):t(null,{viewName:p})}))},getAttachmentView=function(e,t){var n,i,r,o,a,s,l;return o=function(e){return e.docId+",,,,"+e.isDeleted},s=function(e,t,n){return e.length},r=function(e){if((!e.type||"attachment"===e.type)&&!e.isDeleted&&e.docId)return emit(e.docId+"")}.toString(),l=s.toString(),a=o.toString(),n={views:{by_attachment:{map:r,reduce:l}}},i="xsj-"+CryptoJS.MD5(JSON.stringify(n)).toString(),n.views.by_attachment.indexCheck=a,n._id="_design/"+i,e.get("_design/"+i,(function(r,o){return o&&(n._rev=o._rev),r||o.views.by_attachment.indexCheck!==a?e.viewCleanup((function(){return e.put(n,(function(e,n){return e&&console.error("\u521b\u5efa attachment \u89c6\u56fe\u51fa\u9519:"+e),t(null,{viewName:i})}))})):t(null,{viewName:i})}))},getDraftView=function(e,t){var n,i,r,o,a,s,l;return i=function(e){return[e.updateDate,e.isDeleted,e.isArchived].join(",,,,")},o=function(e,t,n){return e.length},n=function(e){if(e.type&&!(e.type&&"markdown"!==e.type||e.isDeleted))return emit(!!e.isArchived,{updateDate:e.updateDate,createDate:e.createDate})}.toString(),a=o.toString(),r=i.toString(),s={views:{by_draft:{map:n,reduce:a}}},l="xsj-"+CryptoJS.MD5(JSON.stringify(s)).toString(),s.views.by_draft.indexCheck=r,s._id="_design/"+l,e.get("_design/"+l,(function(n,i){return i&&(s._rev=i._rev),n||i.views.by_draft.indexCheck!==r?e.viewCleanup((function(){return e.put(s,(function(e,n){return e&&console.error("\u521b\u5efa draft \u89c6\u56fe\u51fa\u9519:"+e),t(null,{viewName:l})}))})):t(null,{viewName:l})}))},getColorView=function(e,t){var n,i,r,o,a,s,l;return i=function(e){return e.color+",,,,"+e.isDeleted},o=function(e,t,n){return e.length},n=function(e){if((!e.type||"markdown"===e.type)&&!e.isDeleted&&e.color)return emit(e.color+"",{updateDate:e.updateDate,createDate:e.createDate})}.toString(),a=o.toString(),r=i.toString(),s={views:{by_color:{map:n,reduce:a}}},l="xsj-"+CryptoJS.MD5(JSON.stringify(s)).toString(),s.views.by_color.indexCheck=r,s._id="_design/"+l,e.get("_design/"+l,(function(n,i){return i&&(s._rev=i._rev),n||i.views.by_color.indexCheck!==r?e.viewCleanup((function(){return e.put(s,(function(e,n){return e&&console.error("\u521b\u5efa color \u89c6\u56fe\u51fa\u9519:"+e),t(null,{viewName:l})}))})):t(null,{viewName:l})}))},getContentView=function(e,t){var n,i,r,o,a,s,l;return i=function(e){return e.content+",,,,"+e.isDeleted},o=function(e,t,n){return e.length},n=function(e){if((!e.type||"markdown"===e.type)&&!e.isDeleted&&e.content)return emit(e._id+"",{updateDate:e.updateDate,createDate:e.createDate,content:e.content})}.toString(),a=o.toString(),r=i.toString(),s={views:{by_content:{map:n,reduce:a}}},l="xsj-"+CryptoJS.MD5(JSON.stringify(s)).toString(),s.views.by_content.indexCheck=r,s._id="_design/"+l,e.get("_design/"+l,(function(n,i){return i&&(s._rev=i._rev),n||i.views.by_content.indexCheck!==r?e.viewCleanup((function(){return e.put(s,(function(e,n){return e&&console.error("\u521b\u5efa content \u89c6\u56fe\u51fa\u9519:"+e),t(null,{viewName:l})}))})):t(null,{viewName:l})}))},getSlugView=function(e,t){var n,i,r,o,a,s,l;return o=function(e){return e.slug+",,,,"+e.isDeleted},n=function(e,t,n){return e.length},r=function(e){if((!e.type||"markdown"===e.type)&&!e.isDeleted&&e.slug)return emit(e.slug+"",{updateDate:e.updateDate,createDate:e.createDate})}.toString(),i=n.toString(),a=o.toString(),s={views:{by_slug:{map:r,reduce:i}}},l="xsj-"+CryptoJS.MD5(JSON.stringify(s)).toString(),s.views.by_slug.indexCheck=a,s._id="_design/"+l,e.get("_design/"+l,(function(n,i){return i&&(s._rev=i._rev),n||i.views.by_slug.indexCheck!==a?e.viewCleanup((function(){return e.put(s,(function(e,n){return e&&console.error("\u521b\u5efa slug \u89c6\u56fe\u51fa\u9519:"+e),t(null,{viewName:l})}))})):t(null,{viewName:l})}))},getDateView=function(e,t){var n,i,r,o,a,s,l,c,u,d,p;return i=function(e){return e.createDate+",,,,"+e.isDeleted},s=function(e){var t;if((!e.type||"markdown"===e.type)&&!e.isDeleted&&e.updateDate)try{if((t=new Date(e.updateDate))instanceof Date&&!isNaN(t))return emit([t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds()])}catch(e){e}},c=function(e){return e.updateDate+",,,,"+e.isDeleted},o=function(e,t,n){return e.length},n=function(e){var t;if((!e.type||"markdown"===e.type)&&!e.isDeleted&&e.createDate)try{if((t=new Date(e.createDate))instanceof Date&&!isNaN(t))return emit([t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds()])}catch(e){e}}.toString(),l=s.toString(),a=o.toString(),r=i.toString(),u=c.toString(),d={views:{by_create_date:{map:n,reduce:a},by_update_date:{map:l,reduce:a}}},p="xsj-"+CryptoJS.MD5(JSON.stringify(d)).toString(),d.views.by_create_date.indexCheck=r,d.views.by_update_date.indexCheck=u,d._id="_design/"+p,e.get("_design/"+p,(function(n,i){return i&&(d._rev=i._rev),n||i.views.by_create_date.indexCheck!==r?e.viewCleanup((function(){return e.put(d,(function(e,n){return e&&console.error("\u521b\u5efa\u65f6\u95f4\u89c6\u56fe\u51fa\u9519:"+e),t(null,{viewName:p})}))})):t(null,{viewName:p})}))},getReverseLinkView=function(db,callback){var byReduceFn,byReduceFnStr,byReverseLinkFn,byReverseLinkFnStr,byReverseLinkIndexCheckFn,byReverseLinkIndexCheckFnStr,reverseLinkDDoc,reverseLinkIndexName;return byReverseLinkFn=function(doc){var Utils,linkInfos;if(!(doc.type&&"markdown"!==doc.type||doc.isDeleted))return Utils=eval("'use strict';var Utils = requirejs('./lib/utils'); Utils"),linkInfos=Utils.getLinkInfo("a.md",doc.content),linkInfos.forEach((function(e){return emit(e.link,e)}))},byReduceFn=function(e,t,n){return e.length},byReverseLinkIndexCheckFn=function(e){return e.content+",,,,"+e.isDeleted},byReverseLinkFnStr=byReverseLinkFn.toString(),byReduceFnStr=byReduceFn.toString(),byReverseLinkIndexCheckFnStr=byReverseLinkIndexCheckFn.toString(),reverseLinkDDoc={views:{by_reverse_link:{map:byReverseLinkFnStr,reduce:byReduceFnStr}}},reverseLinkIndexName="xsj-"+CryptoJS.MD5(JSON.stringify(reverseLinkDDoc)).toString(),reverseLinkDDoc.views.by_reverse_link.indexCheck=byReverseLinkIndexCheckFnStr,reverseLinkDDoc._id="_design/"+reverseLinkIndexName,db.get("_design/"+reverseLinkIndexName,(function(e,t){return t&&(reverseLinkDDoc._rev=t._rev),e||t.views.by_reverse_link.indexCheck!==byReverseLinkIndexCheckFnStr?db.viewCleanup((function(){return db.put(reverseLinkDDoc,(function(e,t){return e&&console.error("\u521b\u5efa reverseLink \u89c6\u56fe\u51fa\u9519:"+e),callback(null,{viewName:reverseLinkIndexName})}))})):callback(null,{viewName:reverseLinkIndexName})}))},getUpView=function(e,t){var n,i,r,o,a,s,l;return n=function(e,t,n){return e.length},o=function(e){return!!e.up+",,,,"+e.isDeleted},r=function(e){if((!e.type||"markdown"===e.type)&&!e.isDeleted&&e.up)return emit(e.up)}.toString(),i=n.toString(),a=o.toString(),s={views:{by_up:{map:r,reduce:i}}},l="xsj-"+CryptoJS.MD5(JSON.stringify(s)).toString(),s.views.by_up.indexCheck=a,s._id="_design/"+l,e.get("_design/"+l,(function(n,i){return i&&(s._rev=i._rev),n||i.views.by_up.indexCheck!==a?e.viewCleanup((function(){return e.put(s,(function(e,n){return e&&console.error("\u521b\u5efa up \u89c6\u56fe\u51fa\u9519:"+e),t(null,{viewName:l})}))})):t(null,{viewName:l})}))},getTitleView=function(e,t){var n,i,r,o,a,s,l;return n=function(e,t,n){return e.length},o=function(e){return e.title+",,,,"+e.isDeleted},r=function(e){if(!(e.type&&"markdown"!==e.type||e.isDeleted))return emit(e.title,{updateDate:e.updateDate,createDate:e.createDate})}.toString(),i=n.toString(),a=o.toString(),s={views:{by_title:{map:r,reduce:i}}},l="xsj-"+CryptoJS.MD5(JSON.stringify(s)).toString(),s.views.by_title.indexCheck=a,s._id="_design/"+l,e.get("_design/"+l,(function(n,i){return i&&(s._rev=i._rev),n||i.views.by_title.indexCheck!==a?e.viewCleanup((function(){return e.put(s,(function(e,n){return e&&console.error("\u521b\u5efa title \u89c6\u56fe\u51fa\u9519:"+e),t(null,{viewName:l})}))})):t(null,{viewName:l})}))},buildNormalView=function(e,t,n,i){var r;return r={limit:0},n&&(r.doc_ids=[n.id]),console.time(t),e.query(t,r).then((function(){return console.timeEnd(t),i()})).catch((function(e){return i(e)}))},buildCategoryAndFlagView=function(e,t){return getCategoryAndFlagView(e,(function(e,n){var i;return n?(i=n.viewName,t(null,[i+"/by_category",i+"/by_flag"])):t(e)}))},buildAttachmentView=function(e,t){return getAttachmentView(e,(function(e,n){var i;return n?(i=n.viewName,t(null,[i+"/by_attachment"])):t(e)}))},buildDraftView=function(e,t){return getDraftView(e,(function(e,n){var i;return n?(i=n.viewName,t(null,[i+"/by_draft"])):t(e)}))},buildColorView=function(e,t){return getColorView(e,(function(e,n){var i;return n?(i=n.viewName,t(null,[i+"/by_color"])):t(e)}))},buildContentView=function(e,t){return getContentView(e,(function(e,n){var i;return n?(i=n.viewName,t(null,[i+"/by_content"])):t(e)}))},buildSlugView=function(e,t){return getSlugView(e,(function(e,n){var i;return n?(i=n.viewName,t(null,[i+"/by_slug"])):t(e)}))},buildDateView=function(e,t){return getDateView(e,(function(e,n){var i;return n?(i=n.viewName,t(null,[i+"/by_create_date",i+"/by_update_date"])):t(e)}))},buildReverseLinkView=function(e,t){return getReverseLinkView(e,(function(e,n){var i;return n?(i=n.viewName,t(null,[i+"/by_reverse_link"])):t(e)}))},buildUpView=function(e,t){return getUpView(e,(function(e,n){var i;return n?(i=n.viewName,t(null,[i+"/by_up"])):t(e)}))},buildTitleView=function(e,t){return getTitleView(e,(function(e,n){var i;return n?(i=n.viewName,t(null,[i+"/by_title"])):t(e)}))},getBuildViewNames=function(e,t){var n,i;return n=["query_index/by_plugin","query_index/by_updatedate","query_index/by_updatedate_for_sync","query_index/by_createdate","query_index/by_draftupdatedate","query_index/by_isDeleted","query_index/by_tagNames","query_index/by_combineTagNames"],i=[buildCategoryAndFlagView,buildDateView,buildAttachmentView,buildDraftView,buildSlugView,buildColorView,buildContentView,buildTitleView,buildReverseLinkView],async.mapSeries(i,(function(t,i){return t(e,(function(e,t){return t&&t.forEach((function(e){return n.push(e)})),i()}))}),(function(){return t(null,n)}))},buildViews=function(e,t,n,i){return getBuildViewNames(e,(function(e,r){var o,a,s;return a=null,t&&(a=t.id),s=r,n&&n.length>0&&(s=r.filter((function(e){var t,i,r;for(t=0,i=n.length;t<i;t++)if(r=n[t],e.indexOf(r)>=0)return!0;return!1}))),(o=function(){return window.pouchdbWorkerManager?pouchdbWorkerManager.run({method:"buildViews",data:{doc_id:a,buildViewNames:s}},(function(e){return"function"==typeof i?i():void 0})):(o.delayTime=o.delayTime||6e3,o.delayTime=2*o.delayTime,o.times=o.times||1,o.times++,o.times<5?setTimeout(o,o.delayTime):"function"==typeof i?i():void 0)})()}))},getConditionIdsFn=function(e,t,n,i,r){var o,a,s,l,c,u,d,p;switch(o=function(e,t,n,r,o){var a;return a={reduce:!1,group:!1},i.showUpdateProgressInfo&&(a.showUpdateProgressInfo=i.showUpdateProgressInfo),n instanceof Array&&!r?a.keys=n:a.key=n,e.query(t,a).then((function(e){var t;return t=[],e.rows.length>0&&(t=e.rows),o(t.map((function(e){return e.id})))}))},t){case"tag":return"query_index/by_tagNames",c=n.split(","),p=_.uniq(_.compact(c)).sort(),d=null,void async.mapSeries(p,(function(t,n){return o(e,"query_index/by_tagNames",t,!1,(function(e){return d=null===d?e:d.filter((function(t){return e.indexOf(t)>-1})),n()}))}),(function(){return r(d)}));case"category":return void getCategoryAndFlagView(e,(function(t,a){var s,l;return t?r([]):(l=a.viewName,s={reduce:!0,group:!0},i.showUpdateProgressInfo&&(s.showUpdateProgressInfo=i.showUpdateProgressInfo),e.query(l+"/by_category",s).then((function(t){var i,a;return i=t.rows,a=[],n instanceof Array||(n=[n]),n.slice().forEach((function(e){var t,n;return t=e.indexOf("xsjStartsWith##"),n=!1,0===t&&(n=!0,e=e.substring("xsjStartsWith##".length)),e=e.replace(/^\/*|\/*$/g,""),i.forEach((function(t){var i;if(i=t.key.replace(/^\/*|\/*$/g,""),n){if(0===i.indexOf(e))return a.push(t.key)}else if(i===e)return a.push(t.key)}))})),o(e,l+"/by_category",a,!1,r)})).catch((function(e){return r([])})))}));case"flag":return void getCategoryAndFlagView(e,(function(t,i){var a;return t?r([]):(a=i.viewName,o(e,a+"/by_flag",n,!1,r))}));case"date":return l={},i.showUpdateProgressInfo&&(l.showUpdateProgressInfo=i.showUpdateProgressInfo),moment().isRelativeTimeFormat(n)?(u=moment().relativeTime(n),s=moment()):(a=n.split("/")).length>1?(u=moment(a[0]),s=moment(a[1])):u=s=moment(a[0]),u.isValid()||(u=moment()),s.isValid()||(s=moment()),void queryByCreateDateRange(e,u.toDate(),s.toDate(),l,(function(e,t){return r(e?[]:t.map((function(e){return e.id})))}));default:0}return r([])},fullSearch=function(e,t,n,i){return requirejs("./utils").asyncLoadResources([{id:"js_search_string",filename:"./js/search-string/search-string.js",type:"script"}],(function(){var r,o,a,s,l,c,u,d,p,f;return t=t.replace(/\s*\++\s*/g,"+"),r=n.ids,p=searchString.parse(t),l={},s={},a={},c=[],f=[],o=[],d=function(i){var o,a;return a=[],o=[],async.eachSeries(p.getTextSegments(),(function(i,u){var d;return d=_fullSearch,i.text&&(t.indexOf('"'+i.text+'"')>=0||t.indexOf("'"+i.test+"'")>=0)&&(r=null,d=_normalContentSearch),d(e,i.text,n,(function(e,t){return t&&t.rows.forEach((function(e){var n,r,u,d,p,f,h,m;if(i.negated){if(u=e.id,indexOf.call(o,u)<0)return o.push(e.id)}else{if(l[e.id])for(r in d=e.fieldCountInfo)for(h in m=d[r])f=m[h],(n=l[e.id])[r][h]?n[r][h]+=f:n[r][h]=f;else l[e.id]=e.fieldCountInfo;if(s[e.id]?s[e.id]<e.score&&(s[e.id]=e.score):s[e.id]=e.score,t.queryTerms.forEach((function(e){if(indexOf.call(c,e)<0)return c.push(e)})),p=e.id,indexOf.call(a,p)<0)return a.push(e.id)}})),u()}))}),(function(){return a.forEach((function(e){if(indexOf.call(o,e)<0)return f.push(e)})),i()}))},u=function(t){var i,r;return o=0===p.getTextSegments().length?null:f,r=null,i=[],async.eachSeries(p.getConditionArray(),(function(t,o){return getConditionIdsFn(e,t.keyword,t.value,n,(function(e){return t.negated?e.forEach((function(e){if(indexOf.call(i,e)<0)return i.push(e)})):r=r?r.filter((function(t){return indexOf.call(e,t)>=0})):e,o()}))}),(function(){return null===o?o=r:r&&(o=o.filter((function(e){return indexOf.call(r,e)>=0}))),o=o.filter((function(e){return indexOf.call(i,e)<0})),t()}))},async.series([d,u],(function(){var e,t,n;for(e in n=o,l)t=l[e],a[e]=Math.max.apply(null,Object.keys(t).map((function(e){return Object.keys(t[e]).length})));return n.sort((function(e,t){return a[e]>a[t]?-1:a[e]<a[t]?1:s[e]>s[t]?-1:s[e]<s[t]?1:0})),r&&(n=n.filter((function(e){return r.indexOf(e)>=0}))),i(null,{total_rows:n.length,rows:n.map((function(e){return{id:e,fieldCountInfo:l[e]}})),queryTerms:c})}))}))},countOccurrences=function(e,t){var n,i;for(n=0,i=0;i<e.length;)e.substring(i,i+t.length)===t?(n++,i+=t.length):i++;return n},_normalContentSearch=function(e,t,n,i){var r;return r={include_docs:!1,conflicts:!1,reduce:!1,group:!1},n.ids&&(r.keys=n.ids),n.processInfoFn&&(r.showUpdateProgressInfo=function(e,t,i,r){return n.processInfoFn({processType:"showUpdateProgressInfo",result:{viewSeq:e,dbSeq:t}})}),getContentView(e,(function(n,o){var a;return n?i(n):(a=o.viewName,e.query(a+"/by_content",r).then((function(e){var n;return n=e.rows.map((function(e){var n,i,r,o;return r=e.value,n=countOccurrences(r.content.toUpperCase(),t.toUpperCase()),o=0,n>0&&(o=1),i={title:{},tagNames:{},content:{query:n}},{id:e.id,key:e.key,value:i,score:o,fieldCountInfo:i}})).filter((function(e){return e.score>0})),i(null,{rows:n,queryTerms:[t],total_rows:n.length})})))}))},_normalSearch=function(e,t,n,i){var r,o;return r=function(e,n){var i,r;if(!(e.type&&"markdown"!==e.type||e.isDeleted))return t&&e.content&&e.content.indexOf(t)>=0&&(r=countOccurrences(e.content,t))>0?((i={})[t]=r,n(e._id,{title:{},tagNames:{},content:i})):void 0},o={include_docs:!1,conflicts:!1},n.processInfoFn&&(o.showUpdateProgressInfo=function(e,t,i,r){return n.processInfoFn({processType:"showUpdateProgressInfo",result:{viewSeq:e,dbSeq:t}})}),e.query(r,o).then((function(e){var n;return n=[],e.rows.length>0&&(n=e.rows.map((function(e){return e.score=1,e.fieldCountInfo=e.value,e}))),i(null,{rows:n,queryTerms:[t],total_rows:n.length})}))},_fullSearch=function(e,t,n,i){var r;return(r=function(){var e;return window.pouchdbWorkerManager?(e=n.processInfoFn,delete n.processInfoFn,pouchdbWorkerManager.run({method:"fullSearch",data:{query:t,opts:n||{}}},(function(t){return"function"==typeof e?e(t):void 0}),(function(e){return i(null,e.result)}))):(r.delayTime=r.delayTime||6e3,r.delayTime=2*r.delayTime,r.times=r.times||1,r.times++,r.times<5?setTimeout(r,r.delayTime):i(null,{total_rows:0,rows:[],queryTerms:t}))})()},buildFullSearchView=function(e,t,n,i){var r;return n=n||{},(r=function(){return window.pouchdbWorkerManager?pouchdbWorkerManager.run({method:"buildFullSearchView",data:{buildType:t||"build"}},(function(e){return"function"==typeof n.processInfoFn?n.processInfoFn(e):void 0}),(function(e){return i(e.error,e.result)})):(r.delayTime=r.delayTime||6e3,r.delayTime=2*r.delayTime,r.times=r.times||1,r.times++,r.times<5?setTimeout(r,r.delayTime):i())})()},destroyAllViews=function(e,t){return e.allDocs({startkey:"_design/",endkey:"_design/\uffff"}).then((function(n){var i;return i=[],n.rows.forEach((function(e){return i.push({_id:e.id,_rev:e.value.rev,_deleted:!0})})),e.bulkDocs({docs:i}).then((function(){return e.viewCleanup()})).then((function(e){t(null,e)}))})).catch(t)},queryByCreateDateRange=function(e,t,n,i,r){var o;r||(r=i,i={include_docs:!1}),moment(t).isAfter(n)&&(o=n,n=t,t=o),getDateView(e,(function(o,a){var s,l;return o?r(o):(l=a.viewName,s={reduce:!1,group:!1,startkey:[t.getFullYear(),t.getMonth(),t.getDate()],endkey:[n.getFullYear(),n.getMonth(),n.getDate(),{}],inclusive_end:!0,include_docs:!!i.include_docs},i.showUpdateProgressInfo&&(s.showUpdateProgressInfo=i.showUpdateProgressInfo),e.query(l+"/by_create_date",s).then((function(e){var t;t=[],e.rows.length>0&&(t=e.rows).reverse(),r(null,t)})).catch((function(e){return r(e)})))}))},queryByUpdateDateRange=function(e,t,n,i,r){var o;r||(r=i,i={include_docs:!1}),moment(t).isAfter(n)&&(o=n,n=t,t=o),getDateView(e,(function(o,a){var s,l;return o?r(o):(l=a.viewName,s={reduce:!1,group:!1,startkey:[t.getFullYear(),t.getMonth(),t.getDate()],endkey:[n.getFullYear(),n.getMonth(),n.getDate(),{}],inclusive_end:!0,include_docs:!!i.include_docs},i.showUpdateProgressInfo&&(s.showUpdateProgressInfo=i.showUpdateProgressInfo),e.query(l+"/by_update_date",s).then((function(e){var t;t=[],e.rows.length>0&&(t=e.rows).reverse(),r(null,t)})).catch((function(e){return r(e)})))}))},autoBuildIndexFn=function(e,t){var n,i,r,o,a;return e=e||function(){},i=requirejs("../models/database_auto_index_model"),n=requirejs("../constant"),o=new i,r=o.get("indexNames"),a=1,getBuildViewNames(n.pouchDB,(function(i,o){var s;return s=function(t,i){var s,l;return"fullsearch_index"===t?buildFullSearchView(n.pouchDB,"build",{processInfoFn:function(t){var n;if(t&&"showUpdateProgressInfo"===t.processType)return n=t.result,e(a,r,n.viewSeq,n.dbSeq)}},(function(){return a++,i()})):(s=o.find((function(e){return e.startsWith("xsj")&&(e="xsj/"+e.split("/")[1]),t===e})))?(l={limit:0,beforeUpdateView:function(){},afterUpdateView:function(){},showUpdateProgressInfo:function(t,n,i,o){return e(a,r,t,n)}},n.pouchDB.query(s,l).then((function(){return a++,i()})).catch((function(e){return a++,console.error("error index:::"+e),i()}))):setTimeout((function(){return a++,i()}),1)},async.mapSeries(r,s,(function(){return t()}))}))},module.exports={getCategoryAndFlagView:getCategoryAndFlagView,getAttachmentView:getAttachmentView,getDraftView:getDraftView,getSlugView:getSlugView,getColorView:getColorView,getContentView:getContentView,getDateView:getDateView,getReverseLinkView:getReverseLinkView,getUpView:getUpView,getTitleView:getTitleView,buildViews:buildViews,getBuildViewNames:getBuildViewNames,fullSearch:fullSearch,buildFullSearchView:buildFullSearchView,destroyAllViews:destroyAllViews,queryByCreateDateRange:queryByCreateDateRange,queryByUpdateDateRange:queryByUpdateDateRange,autoBuildIndexFn:autoBuildIndexFn}}}),window.requirejs.define({"lib/pouchdb_worker_manager":function(e,t,n){var i,r,o;i=t("../constant"),t("../lib/utils"),t("../application"),r=t("../lib/notifier"),o=function(){var e,t,n;function o(){}return n=null,t={},e=!1,o.prototype.stopWorker=function(){return n&&(n.terminate(),n=null),e=!1,t={}},o.prototype.startWorker=function(o){return(n=new Worker("./js/workers.js")).addEventListener("message",(function(n){var i,a,s,l;if(i=(a=n&&n.data||{}).id,l=t[i],!a.success){if("run"===a.type&&l)return l.callback({error:a.msg}),delete t[i];s=a.msg;try{s=JSON.stringify(a.msg)}catch(e){n=e,s=a.msg}return r.showMessage("\u63d0\u4ea4\u51fa\u9519: "+s,6e3,"error")}switch(a.type){case"init":return e=!0,"function"==typeof o?o():void 0;case"run":if(l)return a.returnData&&a.returnData.error?l.callback({error:a.returnData}):l.callback(a.returnData),delete t[i];break;case"info":if(l&&l.processInfoFn)return l.processInfoFn(a.returnData);break;default:console.error(a),s=a.msg;try{s=JSON.stringify(a.msg)}catch(e){n=e,s=a.msg}return r.showMessage("\u51fa\u73b0\u6267\u884c\u5f02\u5e38: "+s,6e3,"error")}})),n.onerror=function(e){var t;console.error(e),t=e;try{t=JSON.stringify(e)}catch(e){e,0}return"function"==typeof o&&o(t),r.showMessage("\u7ebf\u7a0b\u51fa\u73b0\u5f02\u5e38: "+t,6e3,"error")},n.postMessage({type:"init",opts:{pouchdbOpt:{name:i.pouchDB.name,adapter:i.pouchDB.adapter}}})},o.prototype.run=function(i,r,o){var a;return o||(o=r,r=null),o=o||function(){},a=uniqueNumber(),e?(n.postMessage({id:a,type:"run",opts:i}),t[a]={opts:i,processInfoFn:r,callback:o}):o({error:"\u6570\u636e\u670d\u52a1\u672a\u6b63\u5e38\u542f\u52a8"})},o}(),n.exports=o}}),window.requirejs.define({"lib/preview_core":function(e,t,n){var i,r,o,a,s,l,c,u,d,p,f,h,m,v,g,w,y,b,x,k,D,C,F,M,T,S,P,j,E,I,O,V,L,A,B,N,R,H,z,q,W,U,Y,J,G,K,X,Q,Z,ee,te,ne,ie,re,oe,ae,se,le,ce,ue,de,pe,fe,he,me,ve,ge,_e,we,ye,be,xe,ke,De,Ce,$e,Fe,Me,Te,Se,Pe=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};l=t("../constant"),x=t("../lib/utils"),b=t("../lib/utils_url"),a=t("../lib/utils_generate_chart"),r=t("../application"),c=t("../lib/notifier"),i=t("../lib/app_resource_core"),t("../lib/resource_core"),pe=t("../lib/dynamic_import/import_parse_depence"),o=t("../lib/cache"),u=t("../lib/nunjucks/core"),w=t("../lib/markdown/video"),h=t("../lib/markdown/audio"),f=t("../lib/markdown/attachment"),v=t("../lib/markdown/ruby"),m=t("../lib/markdown/center"),p=t("../lib/markdown/align"),g=t("../lib/markdown/tableextra"),t("../lib/markdown/nunjucks_inline"),s=t("../lib/code_chunk"),ae=function(e){var t,n;return null==e&&(e=""),e?(n=[],t=function(e){return Math.floor(e)==e&&$.isNumeric(e)},e.split(",").forEach((function(e,i){var r,o,a;return e.indexOf("-")>0?(a=e.split("-"),t(a[0])&&t(a[1])?function(){o=[];for(var e=r=parseInt(a[0]),t=parseInt(a[1]);r<=t?e<=t:e>=t;r<=t?e++:e--)o.push(e);return o}.apply(this).forEach((function(e){return n.push(e+"")})):void 0):n.push(e)})),_.flatten(n)):[]},ge=function(e){var t;return t=/{equation}|\\label|\\ref|\\eqref/gim,!!(e=e||"").match(t)},Se=function(e){var t,n,i,r,o,a,s,l,c,u,d,p,f,h,m;return i=[],n=function(){var t;if(t=i.shift())return t.reverse().forEach((function(t){return e.elementClose(t)}))},s=function(t){return i.length>0&&i[0].push(t),e.elementOpenStart(t)},a=function(t){return i.length>0&&i[0].pop(),e.elementClose(t)},f=function(e){return e.replace(/[^-:\w]/g,"")},p=0,m="",h=!1,r=null,o=[],d=!1,u=!1,t=function(t,n){var i;if(""!==(i=f(t)))return e.attr(i,_.unescape(n))},l=function(e){var t;return t=l.e||document.createElement("textarea"),l.e=t,t.innerHTML=e,0===t.childNodes.length?"":t.childNodes[0].nodeValue},c=new xsjhtmlparser2({oncomment:function(t){var n,i,r,a;return p?o.push("\x3c!--"+t+"--\x3e"):(r=e.currentPointer(),a=(i=e.currentElement()).ownerDocument,r&&"#comment"===r.nodeName?n=r:(n=a.createComment(""),i.insertBefore(n,r)),n.data=t,IncrementalDOM.skipNode())},onopentag:function(n,i){var r,a;if(p)n===m&&p++;else{if("pre"===n)p++,m=n;else if(i["data-vdom-skip"])p++,m=n,i["data-vdom-cache"]&&(h=!0);else{for(r in s(f(n)),i)a=i[r],t(r,a);e.elementOpenEnd(f(n))}i["data-vdom-mathjax"]&&(d=!0)}if(p){for(r in o.push("<"+n+" "),i)a=i[r],o.push(r+'="'+a+'" ');return o.push(" >")}},ontext:function(t){return e.currentPointer(),p?o.push(t):e.text(l(t))},onclosetag:function(t){var n,i,s,l,c,v,g;if(p?o.push("</"+t+">"):a(f(t)),m===t&&p--,!p&&m)return m="",s=e.currentPointer(),l=(i=e.currentElement()).ownerDocument,o.length>0&&(n=o.join(""),o.length=0),s&&s.__xsjHTML&&n!==s.__xsjHTML&&(h=!1),h&&s&&s.dataset&&"true"===s.dataset.vdomSkip?(s&&(s.__xsjHTML=n),h=!1):(s&&"pre"===s.__xsjNodeName&&(c=(r=s).__xsjHTML),r&&c===n||((g=l.createElement("div")).innerHTML=n,(g=g.firstElementChild).__xsjNodeName="pre",g.__xsjHTML=n,r?(v=r.__xsjMathjaxEq,r.replaceWith(g)):i.insertBefore(g,s),d&&(g.__xsjMathjaxEq=ge(n),u=g.__xsjMathjaxEq||v),v&&!u&&(u=!0)),r=null),e.skipNode(),d=!1}},{decodeEntities:!1,lowerCaseAttributeNames:!1,lowerCaseTags:!1}),e.notifications.nodesDeleted=function(e){var t,n,i;for(i=[],t=0,n=e.length;t<n;t++)e[t].__xsjMathjaxEq?i.push(u=!0):i.push(void 0);return i},{needRefreshEquationMathjax:function(){return u},run:function(e){return u=!1,i.unshift([]),c.write(e),n(),c.reset()}}},y=0,Te=function(e){var t;return t=x.stripScripts(e),W.tableExtra&&ye($(t)),t.querySelectorAll("div>br").forEach((function(e){var t;if("DIV"===(t=e.parentElement).tagName&&1===t.childNodes.length)return t.replaceWith(e)})),t.innerHTML},ee=function(e){return e=encodeURI(e),y++,e.toLowerCase().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,"")+"_"+y},xe=function(e,t,n){var i,r,o;null==e&&(e=""),o=e;try{!e&&t[n].level>0&&"inline"===t[n+1].type&&(r=t[n+1]).children&&r.children.length>0&&"text"===r.children[0].type&&(o="<span class='xsj_placeholder_span'></span>")}catch(e){i=e,console.log(i)}return o},T=function(e,t){var n,i,r;if(!e)return-1;for(n=i=0,r=e.length;i<r;n=++i)if(e[n][0]===t)return n;return-1},P=function(e,t){return null==e&&(e=[]),e.push(t),e},S=function(e,t,n){var i;return null==e&&(e=[]),(i=T(e,t))<0?P(e,[t,n]):(e[i][1]=e[i][1]+" "+n,e)},K=function(e){var t,n,i,r;if(!e)return"";for(r="",n=0,i=e.length;n<i;n++)t=e[n],r+=" "+_.escape(t[0])+'="'+_.escape(t[1])+'"';return r},F={},M=0,be=null,O=function(e){try{return JSON.parse(JSON.stringify(e))}catch(t){return t,_.clone(e)}},ke=[],De="",ce={},B=function(e,t,n){return d.cleanCache(n,e)},se=function(e){var t,n,i,r;if(!e)return new o;if(n=e.id,Object.keys(ce).length>50){for(i in ce)ce[i].fileModel.off("attachmentChange",B);ce={}}return(r=ce[n])||(t=new o,ce[n]={cache:t,fileModel:e},e.on("attachmentChange",B),r=ce[n]),r.cache},Ce=[we=">>==([\\\n\\s\\S]*?)==<<",">>~~([\\\n\\s\\S]*?)~~<<",">>\\*\\*([\\\n\\s\\S]*?)\\*\\*<<",">>\\+\\+([\\\n\\s\\S]*?)\\+\\+<<"],_e=null,oe=null,te=null,ve=null,fe=function(){if(_e||(_e=rangy.createCssClassApplier("mark xsj_code_format xsj_code_mark",{normalize:!1})),oe||(oe=rangy.createCssClassApplier("xsj_code_format xsj_code_del",{elementTagName:"del",normalize:!1})),te||(te=rangy.createCssClassApplier("xsj_code_format xsj_code_strong",{elementTagName:"strong",normalize:!1})),!ve)return ve=rangy.createCssClassApplier("xsj_code_format xsj_code_insert",{elementTagName:"ins",normalize:!1})},re=function(e,t){var n,i,r;return i=[],n=0,Ce.forEach((function(n,i){var r;if(n!==t)return r=new RegExp(n,"g"),e=e.replace(r,(function(e,t){return t}))})),r=new RegExp(t,"g"),{text:e.replace(r,(function(e,t,r){var o,a;return a=r-n,o=e.length+r-n-8,n+=8,i.push({start:a,end:o}),t})),offsets:i}},ue=function(e,t,n){var i,r,o,a,s,l,c,u,d,p,f,h,m;for(l={},c=null,i=function(e){return e.container===l.container?{container:c.endContainer.parentElement.nextSibling,offsetInContainer:e.offsetInContainer-l.offsetInContainer,offset:e.offset}:e},p=[],t.forEach((function(e){return p.push(e.start),p.push(e.end)})),m=[],a=s=0,h=(p=x.findOffsets(e,p)).length-1;s<=h;a=s+=2)d=p[a],u=p[a+1],o=i(d),r=i(u),(f=rangy.createRange()).setStart(o.container,o.offsetInContainer),f.setEnd(r.container,r.offsetInContainer),l=u,c=f,m.push(n.applyToRange(f));return m},de=function(e,t){var n,i,o,a,s,l,c,u,d,p,f,h,m,v,g,w,y,b,x,k,D,C,F,M,T,S,P,j,E,I,O,A,B,N,R,H,z,q,U,Y,J,G,K,X,Q,Z,ee;if(k=(v=$(e.firstElementChild)).data("codechunk_lang"),b=v.data("codechunk_hash"),g=v.data("codechunk_args"),x=v.data("codechunk_hide"),w=v.data("codechunk_auto"),y=v.data("codechunk_error"),S=$.trim(v.data("info")),m=(m=v.text()).replace(/^\t+/gm,"    "),p=L(v[0]),S&&"{"!==S[0]&&(p=V(p="language-"+S,r.getAliasLangMap())),I="",(z=function(e){var t,n,i,r,o,a,s,l;if(l={code:!!W.code,linenums:!!W.codeLinenums,startLine:0,fancy:[],warn:[],info:[],error:[],del:[],ins:[],title:!1,className:e?e+" hljs":"nohighlight hljs"},!e)return l;if(e.indexOf("?")<0)return l;for("language-"===(a=e.substring(0,e.indexOf("?")))&&(a="nohighlight"),l.className=a+" hljs",t={},i=r=0,o=(s=e.substring(e.indexOf("?")+1).split("&")).length;r<o;i=++r)t[(n=s[i].split("="))[0]]=n[1];return t.hasOwnProperty("linenums")&&(null===t.linenums||void 0===t.linenums||!0===t.linenums||"true"===t.linenums.toLowerCase()?(l.linenums=!0,l.startLine=0):$.isNumeric(t.linenums)?(l.linenums=!0,l.startLine=parseInt(t.linenums)-1):l.linenums=!1),l.fancy=ae(t.fancy),l.warn=ae(t.warn),l.info=ae(t.info),l.error=ae(t.error),l.del=ae(t.del),l.ins=ae(t.ins),t.title&&(l.title=decodeURI(t.title)||!1),t.hasOwnProperty("code")&&(null===t.code||void 0===t.code||!0===t.code||"true"===t.code.toLowerCase()?l.code=!0:l.code=!1),l}(p)).className.startsWith("language-")&&(I=z.className.substring(9)).endsWith(" hljs")&&(I=I.substring(0,I.lastIndexOf(" hljs"))),F=CryptoJS.MD5($(e).html()).toString()+JSON.stringify(z)+"_code",v.removeClass().addClass(z.className),z.code&&(F+="_formate"),W.highlight&&(F+="_highlight"),d=t.get(F))z.code&&(m=(B=re(m,we)).text),$(e).html(d);else{if(z.code&&(B=re(m,we),C=re(m,">>~~([\\\n\\s\\S]*?)~~<<"),u=re(m,">>\\*\\*([\\\n\\s\\S]*?)\\*\\*<<"),P=re(m,">>\\+\\+([\\\n\\s\\S]*?)\\+\\+<<"),m=B.text,v.text(B.text)),W.highlight&&(hljs.highlightElement(v[0]),z.linenums)){for(function(e){var t,n,i,r,o;for(t=[],n=0,i=(o=e.split("\n")).length;n<i;n++)(r=o[n])&&r.trim()&&t.push(r);return t.join("\n")},H=/<span[\s\S]*?>/g,h=/<\/span>/g,Q=[],l=E=0,O=(T=v.html().split("\n")).length;E<O;l=++E){for(s=T[l],M="",q=l+1+"",Pe.call(z.fancy,q)>=0&&(M="line_mark line_mark_fancy"),U=l+1+"",Pe.call(z.warn,U)>=0&&(M="line_mark line_mark_warn"),Y=l+1+"",Pe.call(z.info,Y)>=0&&(M="line_mark line_mark_info"),J=l+1+"",Pe.call(z.error,J)>=0&&(M="line_mark line_mark_error"),D="",G=l+1+"",Pe.call(z.del,G)>=0&&(D="line_mark_del"),K=l+1+"",Pe.call(z.ins,K)>=0&&(D="line_mark_ins"),X="<li class='li_linenum "+M+" "+D+"' date-linenum='"+(l+1+z.startLine)+"'>",X+=A=Q.join("")+s,N=(R=A.match(H))?R.length:0,Q=[],j=(f=A.match(h))?f.length:0;j<N;)Q.push(R[N-j-1]),X+="</span>",j++;X+="<span style='user-select:none;display:none;'>&nbsp;</span><br class='code_line_break_hack_br'/><hr class='code_line_break_hack_hr code_line_break_hack' style='margin:0;border:0;border-top:0;border-bottom:0;'/></li>",T[l]=X}v.html("<ol start="+(z.startLine+1)+' class="ol_linenums" style="counter-reset: lines '+z.startLine+';">'+T.join("")+"</ol>"),v.addClass("code_linenums")}z.code&&(fe(),B.offsets.length>0&&ue(v[0],B.offsets,_e),C.offsets.length>0&&ue(v[0],C.offsets,oe),u.offsets.length>0&&ue(v[0],u.offsets,te),P.offsets.length>0&&ue(v[0],P.offsets,ve)),z.linenums&&v.find(".li_linenum").each((function(e,t){var n,i;return n=$(t),i=z.startLine+e+1,n.prepend('<span class="li_linenum_before_span li_linenum_before_span_hide">'+i+"</span>")})),t.set(F,$(e).html())}return(i=$(e)).wrap('<div class="xiaoshujiang_code_container"></div>'),(n=i.parent()).data("orign_code",m).data("lang",I),n.attr("data-origin-code",m).attr("data-lang",I),k&&(n.data("codechunk_lang",k),n.addClass("xiaoshujiang_code_chunk")),b&&n.data("codechunk_hash",b),g&&n.data("codechunk_args",g),x&&(n.data("codechunk_hide",x),n.addClass("xiaoshujiang_code_chunk_hide_code")),w&&n.data("codechunk_auto",w),y&&n.data("codechunk_error",y),n.data("codechunk_processed",!1),z.linenums&&(p=(v=$(e.firstElementChild)).attr("class"),o=$("<div>"+v.html()+"</div>"),v.replaceWith(o),o.addClass(p),o.addClass("xiaoshujiang_code"),a=$("<div>"+i.html()+"</div>"),c=i.prop("attributes"),$.each(c,(function(){return a.attr(this.name,this.value)})),i.replaceWith(a),a.addClass("xiaoshujiang_pre"),i=a),z.title&&(ee="string"==typeof(Z=z.title)?Z:"",n.data("title",ee),A=m.split("\n").length,n.prepend("<div class='xiaoshujiang_code_title_container'><span class='xiaoshujiang_code_title'>"+_.escape(ee)+"</span><span class='xiaoshujiang_code_infos'>"+_.escape(I)+"&nbsp;&nbsp;&nbsp;&nbsp;"+A+"\u884c</span></div>")),n},$e=function(e,t){var n,i,o,a,s,l,c,u,d,p,f,h,m,v;if(o=(i=$(e.firstElementChild)).text(),u=t,s=CryptoJS.MD5(u+o).toString()+"_codechunk",d=(f=t.match(/^\{\s*(\"[^\"]*\"|[^\s]*|[^}]*)(.*)}$/))[1].trim(),t=f[2].trim(),'"'===d[0]&&(d=d.slice(1,d.length-1).trim()),d){try{m=JSON.parse("{"+t.replace(/([(\w)|(\-)]+)(:)/g,'"$1"$2').replace(/'/g,'"')+"}")}catch(e){return a=e,void i.data("codechunk_error","\u89e3\u6790\u53c2\u6570 "+t+"  \u51fa\u9519"+a)}return p=!1,(m.line_number||m.linenums)&&(p=m.line_number||m.linenums),m.first_line&&(p=m.first_line),c="",m.fancy&&(c+="&fancy="+m.fancy),m.warn&&(c+="&warn="+m.warn),m.info&&(c+="&info="+m.info),m.error&&(c+="&error="+m.error),m.del&&(c+="&del="+m.del),m.ins&&(c+="&ins="+m.ins),v="",m.title&&(v="&title="+encodeURI(m.title)),h="language-"+d+"?linenums="+p+c+v,l=/\s*hide\s*:\s*true/.test(t),n=/\s*auto\s*:\s*true/.test(t),r.getNonSecurity()||(l=!1,n=!1),i.attr("class",h),i.data("codechunk_lang",d),i.data("codechunk_hide",l),i.data("codechunk_auto",n),i.data("codechunk_args",m),i.data("codechunk_hash",s)}i.data("codechunk_error","\u53c2\u6570 "+u+"  \u672a\u6307\u5b9a\u8bed\u8a00")},L=function(e){var t,n,i,r;if(i="",!(t=e.classList))return"";for(n=0;n<t.length;)if(r=t[n],n++,0===r.indexOf("language-"))return i=r;return i},V=function(e,t){var n,i;return i=/^(language-)([\w!]+)([\?]?.*)/,n=e,e&&(n=e.replace(i,(function(e,n,i,r){return n+(t[i]||i)+r}))),n},X=function(e,t){var n,i,r;if(/^(language-)([\w!]+)([\?]?.*)/,(i=L(e))!==(r=V(i,t)))return(n=e.classList).remove(i),n.add(r)},ye=function(e){var t,n,i,r,o,a,s,l,c,u,d,p;for(r=[],o=[],p=[],e.find("table.table-extra").each((function(e,t){var n,i;return i=$(t),n=null,i.children().each((function(e,t){return $(t).children().each((function(e,t){var i;return(i=$(t)).children().each((function(e,t){var i,a,s,l;if(l="temp",(i=$(t))[0]&&i[0].childNodes&&(1===i[0].childNodes.length&&3===i[0].childNodes[0].nodeType&&(l=i.text()),0===i[0].childNodes.length&&(l="")),l.length){if("^"===l.trim()&&n){if((s=$(n.children()[e])).length)return p.push([s,i])}else if(">"===l.trim()&&(a=i.next()).length)return r.push([i,a])}else if((s=i.prev()).length)return o.push([s,i])})),n=i}))}))})),a=p.length-1;a>=0;)n=(s=p[a])[0],t=s[1],d=(parseInt(n.attr("rowspan"),10)||1)+(parseInt(t.attr("rowspan"),10)||1),n.attr("rowspan",d),t.remove(),a--;for(a=0;a<r.length;)n=(l=r[a])[0],t=l[1],i=(parseInt(n.attr("colspan"),10)||1)+(parseInt(t.attr("colspan"),10)||1),t.attr("colspan",i),n.remove(),a++;for(a=o.length-1,u=[];a>=0;)n=(c=o[a])[0],t=c[1],i=(parseInt(n.attr("colspan"),10)||1)+(parseInt(t.attr("colspan"),10)||1),n.attr("colspan",i),t.remove(),u.push(a--);return u},H=function(e,t,n,i,o){var s,l,c,u,d,p;return p=r.getUserModel(),s=r.getAliasLangMap(),c=!1,(d=p.get("user"))&&d.vip&&(c=!0),l=!1,u=n.meta.title,!n.doc.isSys||"\u66f4\u65b0\u5185\u5bb9"!==u&&"\u5c0f\u4e66\u5320\u7f16\u8f91\u5668\u4f7f\u7528\u624b\u518c"!==u&&"\u5c0f\u4e66\u5320\u8bed\u6cd5\u4f7f\u7528\u624b\u518c"!==u||(l=!0),c&&(l=!0),"client"!==STORY_PLATFORM&&(l=!0),W.toc&&t.find(".mindmap_toc").map((function(e,t){var n,i,r;return l?(n=t.innerHTML,r=t.dataset.info,i=CryptoJS.MD5(r+n).toString()+"_mindmap_toc",t.dataset.hash=i):$(t).removeClass("mindmap_toc").prepend('<strong style="color:red;">\u975e\u4f1a\u5458,\u65e0\u6cd5\u5728\u5ba2\u6237\u7aef\u4f7f\u7528\u601d\u7ef4\u5bfc\u56fe</strong>')})),t.find(".inline-mathjax").map((function(t,n){var i,r,o,a,s,l,c;if(c=n.__xsjNodeName,s=n.__xsjHTML,l=n.__xsjMathjaxEq,i=$(n.firstElementChild),a=L(i[0]),e.MathJax&&0===a.indexOf("language-mathjax!")&&W.mathjax)return r=i.html(),"","span",o=$("<span class='mathjax'  data-vdom-mathjax='true'>"+r+"</span>")[0],$(n).replaceWith(o),o.__xsjNodeName=c,o.__xsjHTML=s,o.__xsjMathjaxEq=l})),t.find("pre").map((function(t,n){var r,o,c,u,d,p,f,h,m,v,g,w,y,b,x,k,D,C,F,M,T,S,P,j,E,I,O,V,A,B,N,R,H,z,q,U,Y;if(n.childElementCount===n.childNodes.length&&"true"!==n.dataset.processed&&(n.dataset.processed="true",Y=n.__xsjNodeName,q=n.__xsjHTML,delete n.__xsjNodeName,delete n.__xsjHTML,(m=$(n.firstElementChild))&&0!==m.length&&"CODE"===m[0].tagName)){if(B=!1,(M=(D=$.trim(m.data("info"))).match(/^\{\s*(\"[^\"]*\"|[^\s]*|[^}]*)(\s*)}$/))&&(B="mathjax"===(C=M[1].trim())||"flow"===C||"sequence"===C||"plot"===C||"wavedrom"===C||"plantuml"===C||"xsjimg"===C||"mindmap"===C)&&m.attr("class","language-"+C+"!"),W.codeChunk&&"{"===D[0]&&"}"===D[D.length-1]&&!B&&$e(n,D),X(m[0],s),0===(F=L(m[0])).indexOf("language-mathjax!")&&W.mathjax)return U=n.__xsjMathjaxEq,v=m.html(),"",N="div",w=$("<div class='mathjax-container' data-vdom-mathjax='true'><"+N+" class='mathjax' >"+v+"</"+N+"></div>")[0],$(n).replaceWith(w),w.__xsjNodeName=Y,w.__xsjHTML=q,w.__xsjMathjaxEq=U;if(0===F.indexOf("language-flow")&&W.flow)return v=m.text(),b=CryptoJS.MD5(v).toString()+"_flow",(r=$("<div class='flow-chart xsj_flow' data-hash='"+b+"'></div>")).text(v),$(n).replaceWith(r),r[0].__xsjNodeName=Y,r[0].__xsjHTML=q;if(window.Diagram&&0===F.indexOf("language-sequence")&&W.sequence){v=m.text(),R=W.sequence__theme,V="",(O=F.indexOf("?"))>0&&(V=F.substring(O+1),R=$.deparam(V).theme),"simple"!==R&&"hand"!==R&&(R="hand"),b=CryptoJS.MD5(v).toString()+V+"_sequence",r=$("<div class='sequence-diagram xsj_sequence' data-hash='"+b+"' data-theme='"+R+"'></div>"),u=i.get(b),$(n).replaceWith(r),r[0].__xsjNodeName=Y,r[0].__xsjHTML=q,"simple"!==R&&"hand"!==R&&(R="simple");try{return u?r.html(u):(d=Diagram.parse(v),r.html(""),d.drawSVG(r[0],{theme:R}),i.set(b,r[0].innerHTML))}catch(e){return g=e,r.html(g.toString())}}else if(window.$.plot&&0===F.indexOf("language-plot!")&&W.plot)try{if(v=m.text(),b=CryptoJS.MD5(v).toString()+"_plot",u=i.get(b),c=$('<div class="plot"></div>'),$(n).replaceWith(c),c[0].__xsjNodeName=Y,c[0].__xsjHTML=q,u)return c.html(u);if((E=JSON.parse(v)).data&&E.options)return j=$.plot(c,E.data,E.options),c.data("plot",j)}catch(e){return g=e,console.error(g)}else{if(l&&e.markmap&&0===F.indexOf("language-mindmap!")&&W.mindmap)return v=$.trim(m.text()),b=CryptoJS.MD5(D+v).toString()+"_mindmap",N="div",w=$("<pre class='mindmap_code mindmap_container' data-hash='"+_.escape(b)+"' data-info='"+_.escape(D)+"'>"+_.escape(v)+"</pre>")[0],$(n).replaceWith(w),w.__xsjNodeName=Y,w.__xsjHTML=q,w.attr("data-origin-code",v),w.attr("data-lang","mindmap");if(e.WaveDrom&&0===F.indexOf("language-wavedrom!")&&W.wavedrom)return v=$.trim(m.text()),b=CryptoJS.MD5(v).toString()+"_wavedrom",N="div",w=$("<div class='wavedrom-container'><"+N+" class='xsj_wavedrom' data-hash='"+b+"'>"+v+"</"+N+"></div>")[0],$(n).replaceWith(w),w.__xsjNodeName=Y,w.__xsjHTML=q,w.attr("data-origin-code",v),w.attr("data-lang","wavedrom");if(e.mermaid&&0===F.indexOf("language-mermaid")&&W.mermaid)return v=$.trim(m.text()),e.checkMermaidParse(v)||(v+="\n"),e.checkMermaidParse(v)?((y=$("<div class='mermaid'></div>")).text(v),y.attr("data-origin-code",v),y.attr("data-lang","mermaid")):y=$("<pre><code>"+e.mermaidError+"</code></pre>"),$(n).replaceWith(y),y[0].__xsjNodeName=Y,y[0].__xsjHTML=q;if(W.plantuml&&0===F.indexOf("language-plantuml!"))return v=$.trim(m.text()),(z=W.plantuml__url)?(A="html",A=z.indexOf("/plantuml/png/")>=0?"image":"html",b=CryptoJS.MD5(v).toString()+"_plantuml_"+A,H=a.getPlantUMLUrl(z,v),w=(u=i.get(b))?$("<div data-hash='"+b+"' data-src='"+H+"' data-type='plantuml' data-resource-type='"+A+"' class='story_remote_resource story_remote_resource_block xsj_plantuml'>\n"+u+"\n</div>"):$("<div data-hash='"+b+"' data-src='"+H+"' data-type='plantuml' data-resource-type='"+A+"' class='story_remote_resource_placeholder story_remote_resource story_remote_resource_block xsj_plantuml'>\n<i class=\"fa fa-spinner fa-spin fa-3x fa-fw margin-bottom\"></i>\n</div>")):w=$("<div data-hash='"+b+"' data-src='"+H+"' data-type='plantuml' data-resource-type='"+A+"' class='story_remote_resource story_remote_resource_block story_remote_resource_error xsj_plantuml'>\n\u56fe\u7247\u751f\u6210\u51fa\u9519\uff0c\u60a8\u6ca1\u6709\u6307\u5b9aplantuml\u670d\u52a1\u5668\u5730\u5740\n</div>"),$(n).replaceWith(w),w[0].__xsjNodeName=Y,w[0].__xsjHTML=q;if(W.xsjimg&&0===F.indexOf("language-xsjimg!")){switch(T={encode:W.xsjimg__encode,url:W.xsjimg__url},(I=F.indexOf("?"))>0&&(P=$.deparam(F.substring(I+1)),T=$.extend({},T,P)),x=v=$.trim(m.text()),T.encode){case"base64":x=btoa(encodeURIComponent(v));break;case"zip":v=unescape(encodeURIComponent(v)),x=deflate(v,9);break;default:x=encodeURIComponent(v)}return(z=T.url)?(A="image",b=CryptoJS.MD5(v).toString()+"_xsjimg_"+A+"_"+F,k=_.template(z,{interpolate:/\{\{(.+?)\}\}/g})({xsjimg:x}),w=(u=i.get(b))?$("<div data-hash='"+b+"' data-src='"+k+"' data-type='xsjimg' data-resource-type='"+A+"' class='story_remote_resource story_remote_resource_block xsj_xsjimg'>\n"+u+"\n</div>"):$("<div data-hash='"+b+"' data-src='"+k+"' data-type='xsjimg' data-resource-type='"+A+"' class='story_remote_resource_placeholder story_remote_resource story_remote_resource_block xsj_xsjimg'>\n<i class=\"fa fa-spinner fa-spin fa-3x fa-fw margin-bottom\"></i>\n</div>")):w=$("<div data-hash='"+b+"' data-src='"+k+"' data-type='xsjimg' data-resource-type='"+A+"' class='story_remote_resource story_remote_resource_block story_remote_resource_error xsj_xsjimg'>\n\u56fe\u7247\u751f\u6210\u51fa\u9519\uff0c\u60a8\u6ca1\u6709\u6307\u5b9a\u56fe\u7247\u670d\u52a1\u5668\u5730\u5740\n</div>"),$(n).replaceWith(w),w[0].__xsjNodeName=Y,w[0].__xsjHTML=q}try{o=de(n,i)}catch(e){g=e,console.log(g)}if(o){if(o[0].__xsjNodeName=Y,o[0].__xsjHTML=q,f=o.data("codechunk_hash"),h=o.data("codechunk_hide"),p=o.data("codechunk_error"))return o.append('<div class="out_put_error">'+_.escape(p)+"</div>");if(f&&void 0!==(S=i.get(f)))return h&&o.html(""),o.append('<div class="out_put">'+S+"</div>"),o.data("codechunk_processed",!0)}}}})),"function"==typeof o?o():void 0},ie=function(e,t){return t.replace(/(<img [^>]*src=['"])([^'"]+)([^>]*>)/gi,(function(t,n,i,r){var o,a,s;if((s=x.validateUrlPath(i))&&"xsjurl"===s.result){0===i.indexOf("./")&&(o=i.substring(2));try{o=decodeURI(o)}catch(e){e,console.error("error fileName"+o)}(a=e.get("url_html_src_"+i))&&(o=_.escape(o),a=_.escape(a),i="'"===r[0]?a+"' name='"+o+"' data-src='"+i:a+'" name="'+o+'" data-src="'+i)}return n+i+r}))},I=function(e,t,n,i,r,o,a){return E(e,t,n,i,r,o,(function(e){return e.find("img").map((function(e,t){var n,i;if(0===(i=t.src).indexOf("data:image"))return n=x.dataURL2ObjectURL(i),t.src=n})),e.find("video").map((function(e,t){var n,i;if("data:"!==(i=t.src||"")&&0===i.indexOf("data:"))return n=x.dataURL2ObjectURL(i),t.src=n})),e.find("audio").map((function(e,t){var n,i;if("data:"!==(i=t.src||"")&&0===i.indexOf("data:"))return n=x.dataURL2ObjectURL(i),t.src=n})),e.find("a.attachment").map((function(e,t){var n,i;if("data:"!==(i=t.href||"")&&0===i.indexOf("data:"))return n=x.dataURL2ObjectURL(i),t.href=n})),a(e)}))},C=function(e,t){var n;if(n="png",t&&0===t.indexOf("data:"))try{n=t.split(";")[0].split("/")[1]}catch(e){e,n="png"}return(e=e.replace(/[\/\\ ]/g,"_")).endsWith("."+n)||(e=e+"."+n),e},j=function(e,t,n,i,r,o,a){return E(e,t,n,i,r,o,(function(e){var t,n,i;return t=e.html(),n={},i=0,e.find("img").map((function(e,t){var r,o,a,s;if(r=$(t),o=Date.now()+(i+++""),s=t.src,a=r.attr("title")||r.attr("name")||o,a=C(a,s),0===s.indexOf("data:image"))return n[o]={cid:o,filename:a,path:s,naturalWidth:t.naturalWidth,naturalHeight:t.naturalHeight,width:t.width,height:t.height},t.src="cid:"+o,t.dataset.cid=o})),e.find("video").map((function(e,t){var r,o,a,s;if(r=$(t),o=Date.now()+(i+++""),s=t.src,a=r.attr("title")||r.attr("name")||o,a=C(a,s),"data:"!==s&&0===s.indexOf("data:"))return n[o]={cid:o,filename:a,path:s},t.src="cid:"+o,t.dataset.cid=o})),e.find("audio").map((function(e,t){var r,o,a,s;if(r=$(t),o=Date.now()+(i+++""),s=t.src,a=r.attr("title")||r.attr("name")||o,a=C(a,s),"data:"!==s&&0===s.indexOf("data:"))return n[o]={cid:o,filename:a,path:s},t.src="cid:"+o,t.dataset.cid=o})),e.find("a.attachment").map((function(e,t){var r,o,a,s;if(r=$(t),o=Date.now()+(i+++""),s=t.href,a=r.attr("title")||r.attr("name")||o,a=C(a,s),"data:"!==s&&0===s.indexOf("data:"))return n[o]={cid:o,filename:a,path:s},t.href="cid:"+o,t.dataset.cid=o})),a(e,n,t)}))},A=function(e){return(e=e||{}).separator=e.separator||"^\n----\n$",e.verticalSeparator=e.verticalSeparator||"^\n--\n$",e.notesSeparator=e.notesSeparator||"note:",e.attributes=e.attributes||"",e},D=function(e,t,n,i,r){var o,a,s,l,c,u,d,p,f;if(null!==t&&void 0!==t.childNodes&&t.childNodes.length>0)for(p=t,s=0,c=0,u=(f=t.childNodes).length;c<u;c++){if(f[c],a=t.childNodes[s],s>0)for(l=s-1;l>=0;){if("function"==typeof(o=t.childNodes[l]).setAttribute&&"BR"!==o.tagName){p=o;break}l-=1}d=e,"section"===a.nodeName&&(d=a,p=a),"function"!=typeof a.setAttribute&&a.nodeType!==Node.COMMENT_NODE||D(d,a,p,i,r),s++}if(t.nodeType===Node.COMMENT_NODE&&!1===k(t,n,i))return k(t,e,r)},k=function(e,t,n){var i,r,o,a,s,l;if(o=new RegExp(n,"mg"),r=new RegExp('([^"= ]+?)="([^"=]+?)"',"mg"),l=e.nodeValue,a=o.exec(l)){for(i=a[1],l=l.substring(0,a.index)+l.substring(o.lastIndex),e.nodeValue=l;s=r.exec(i);)t.setAttribute(s[1],s[2]);return!0}return!1},Q=function(e,t,n,i,o,a,s,l,c){var u,d,p,f,h,m,v,g,_,w,y,b,x,k,C,F,M,T,S,P,j,E;for(t.html(""),w=r.getFileLocalCollection().get({id:a.fileModel.id}),_=0,w&&(_=w.get("cursorPosition")||0),i=A(i),P=new RegExp(i.separator+(i.verticalSeparator?"|"+i.verticalSeparator:""),"mg"),y=new RegExp(i.separator),T=null,k=0,m=a.startLine,b=!1,E=!0,g="",S=[];T=P.exec(n);)M=T[0].split("\n").length,null,!(b=y.test(T[0]))&&E&&S.push([]),g=n.substring(k,T.index-1),b&&E?S.push({content:g,line:m}):S[S.length-1].push({content:g,line:m}),k=P.lastIndex+1,E=b,m=m+g.split("\n").length+M;for((E?S:S[S.length-1]).push({content:n.substring(k),line:m}),j="past",d=null,p=x=0,C=S.length;x<C;p=++x)f=S[p],"",u=$("<section "+i.attributes+"></section>"),t.append(u),f instanceof Array?(v="",f.forEach((function(e,t){var n,i,r;return r=e.content,g=o(r,a),n=$("<section class='section_content'></section>"),e.line>_&&d?(j="future",d.removeClass("past").addClass("present"),d.parent().is("section")&&d.parent().removeClass("past").addClass("present"),d=null):e.line===_?(d=null,j="present",v="present"):e.line<_?(j="past",d=n):e.line>_&&(j="future"),n.addClass(j),a.sourceMap&&(n.attr("data-line",e.line),n.attr("data-indexh",p),n.attr("data-indexv",t),n.attr("data-indexf",0)),n.html(g),u.append(n),i=n[0],D(i,i,null,i.getAttribute("data-element-attributes")||i.parentNode.getAttribute("data-element-attributes")||"\\.element\\s*?(.+?)$",i.getAttribute("data-attributes")||i.parentNode.getAttribute("data-attributes")||"\\.slide:\\s*?(\\S.+?)$")})),u.hasClass("present")||u.addClass(v||j)):(h=f.content,u.addClass("section_content"),f.line>_&&d?(j="future",d.removeClass("past").addClass("present"),d.parent().is("section")&&d.parent().removeClass("past").addClass("present"),d=null):f.line===_?(d=null,j="present"):f.line<_?(j="past",d=u):f.line>_&&(j="future"),u.addClass(j),a.sourceMap&&(u.attr("data-line",f.line),u.attr("data-indexh",p),u.attr("data-indexv",0),u.attr("data-indexf",0)),g=o(h,a),u.html(g),F=u[0],D(F,F,null,F.getAttribute("data-element-attributes")||F.parentNode.getAttribute("data-element-attributes")||"\\.element\\s*?(.+?)$",F.getAttribute("data-attributes")||F.parentNode.getAttribute("data-attributes")||"\\.slide:\\s*?(\\S.+?)$"));H(e,t,s,l,(function(){return"function"==typeof c?c():void 0}))},ne={},G="",q=null,W=null,z=!1,U=null,Y="",Z=null,N={renderMetaTitle:!0,renderMetaTag:!0,renderWrapImgTitle:!0,renderWrapTableTitle:!1,renderWrapDrawIOTitle:!0,renderImgBlock:!0,renderNestImgBlock:!1,renderAutoDetectAttachment:!0,renderLinkAsFootnote:!1,renderTitleLinkAsFootnote:!1,renderNumberedHeading:!1,renderNumberedHeadingOffset:!1,renderNumberedHeadingH1:"",renderNumberedHeadingH2:"",renderNumberedHeadingH3:"",renderNumberedHeadingH4:"",renderNumberedHeadingH5:"",renderNumberedHeadingH6:"",renderNumberedHeadingH7:""},J={h1:"",h2:"",h3:"",h4:"",h5:"",h6:"",h7:""},R=function(e,t,n,i,o){var a,s,c,d,y,b,k,D,C,T,P,j,E,I,V,L,A;for(T in se(t),I=t.getPreviewConfig(r,n),V=I.resultConfig,N=I.previewSet)A=N[T],i.hasOwnProperty(T)&&(N[T]=i[T]);for(E=(N.renderNumberedHeadingOffset||"").split(","),y={},C=P=0,j=E.length;P<j;C=++P)A=E[C],/[0-7]/.test(A)||(A=0),A=A||0,((A=parseInt(A))>7||A<0)&&(A=0),y["h"+(C+1)]=A;return N.defaultNumberedHeading=y,function(){var e,t,n;for(T in"<% function counter(index, str, listType){if(!str){str='%s-'}var num = XSJ.numberedHeading[index]; if (num){var numStr = ListStyleTypeFormatter.format(num, listType, false); print(XSJ.vsprintf(str, [numStr])) }} %>",e=[],J={h1:"",h2:"",h3:"",h4:"",h5:"",h6:"",h7:""})A=J[T],(t=N["renderNumberedHeading"+T.toUpperCase()])?(t="<% "+t+" %>",n=_.template("<% function counter(index, str, listType){if(!str){str='%s-'}var num = XSJ.numberedHeading[index]; if (num){var numStr = ListStyleTypeFormatter.format(num, listType, false); print(XSJ.vsprintf(str, [numStr])) }} %>"+t,{variable:"XSJ"}),e.push(J[T]=n)):e.push(void 0);return e}(),W=V,b={html:V.html,nunjucks:V.nunjucks,xhtmlOut:!0,breaks:!0,langPrefix:"language-",linkify:V.linkify,typographer:V.typographer,_highlight:!0,_strict:!1,_view:"html"},q=window.markdownit(b),(Z=window.markdownit("zero")).enable("reference"),(a=window.markdownit("zero")).set({html:V.html}),a.enable(["text","escape","backticks","emphasis","link","html_inline","entity"]),V.mathjax&&V.mathjax__normal&&q.use(window.markdownitMathjax({beforeInlineMath:'<span class="mathjax" data-vdom-skip="true" data-vdom-mathjax="true">\\(',afterInlineMath:"\\)</span>",beforeDisplayMath:'<div class="mathjax-container" data-vdom-skip="true" data-vdom-mathjax="true"><div class="mathjax">\\[',afterDisplayMath:"\\]</div></div>"})),k=function(e,t){return e[t].markup},V.commonBold||(a.renderer.rules.strong_open=k,a.renderer.rules.strong_close=k),V.commonItalic||(a.renderer.rules.em_open=k,a.renderer.rules.em_close=k),V.abbr&&q.use(window.markdownitAbbr),q.use(window.markdownitContainer,"warning"),V.deflist&&q.use(window.markdownitDeflist),V.emoji&&(q.use(window.markdownitEmoji),a.use(window.markdownitEmoji)),(N.renderTitleLinkAsFootnote||N.renderLinkAsFootnote)&&(V.footnote=!0),V.footnote&&(q.use(window.markdownitFootnote),Z.use(window.markdownitFootnote)),V.strikethrough?(q.enable("strikethrough"),a.enable("strikethrough")):(q.disable("strikethrough"),a.disable("strikethrough")),V.ins&&(q.use(window.markdownitIns),a.use(window.markdownitIns)),V.mark&&(q.use(window.markdownitMark),a.use(window.markdownitMark)),V.sub&&(q.use(window.markdownitSub),a.use(window.markdownitSub)),V.sup&&(q.use(window.markdownitSup),a.use(window.markdownitSup)),V.checkbox&&q.use(window.markdownitTaskLists,{divWrap:!1}),V.decorate||(V.classy&&!V.attrs&&q.use(window.markdownItClassy),V.attrs&&q.use(window.markdownItAttrs)),V.decorate&&q.use(window.markdownitDecorate),V.toc&&q.use(window.markdownitToc,{headMarkdownIt:a}),V.wikilink&&q.use(window.markdownitWikilink),V.table?q.enable("table"):q.disable("table"),V.video&&q.use(w),V.audio&&q.use(h),V.attachment&&q.use(f),V.cjkRuby&&q.use(v),V.align&&q.use(p),V.center&&(q.use(m),a.use(m)),V.tableExtra&&(q.use(g),q.disable("table")),function(e){var t;return t=" ",e&&0!==e.length?(e.forEach((function(e,n){if("class"===e[0])return t+=e[1]+" "})),t):t},q.renderer.rules.emoji=function(e,t,n,r,o){var a;return i=r.previewOptions||{},a=i.convertSvg||!1,window.twemoji.parse(e[t].content,(function(e,t,n){return a?"emoji/twemoji-2.2.1/36x36/"+e+".png":"emoji/twemoji-2.2.1/svg/"+e+".svg"}))},q.renderer.rules.blockquote_open=function(e,t,n,i,r){var o,a,s,l,c,u,d;return d=e[t],u=i.startLine||0,c=i.sourceMap||!1,d.attrJoin("class","markdown_blockquote"),c&&d.map&&0===d.level&&(a=d.map[0]+u,e[t].attrJoin("data-source-line",a),e[t].attrJoin("data-source-line-display","true")),s=e[t+1],o=/^\s*<i\s+class=/i,0===d.level&&"heading_open"===s.type&&(d.attrJoin("class","markdown_blockquote_heading markdown_blockquote_heading_"+s.tag),"inline"===(l=e[t+2]).type&&o.test(l.content)&&d.attrJoin("class","markdown_blockquote_icon")),0===d.level&&"paragraph_open"===s.type&&"inline"===(l=e[t+2]).type&&o.test(l.content)&&d.attrJoin("class","markdown_blockquote_icon"),r.renderToken(e,t,n,i,r)},q.renderer.rules.strong_open=function(e,t,n,i,r){return W.commonBold?"__"===e[t].markup?(e[t].attrJoin("class","markdown_strong_underline"),r.renderToken(e,t,n,i,r)):(e[t].attrJoin("class","markdown_strong_asterisk"),r.renderToken(e,t,n,i,r)):e[t].markup},q.renderer.rules.strong_close=function(e,t,n,i,r){return W.commonBold?r.renderToken(e,t,n,i,r):e[t].markup},q.renderer.rules.em_open=function(e,t,n,i,r){return W.commonItalic?"_"===e[t].markup?(V.cjkEmphasis&&e[t].attrJoin("class","cjk_emphasis"),e[t].attrJoin("class","markdown_em_underline"),r.renderToken(e,t,n,i,r)):(e[t].attrJoin("class","markdown_em_asterisk"),r.renderToken(e,t,n,i,r)):e[t].markup},q.renderer.rules.em_close=function(e,t,n,i,r){return W.commonItalic?r.renderToken(e,t,n,i,r):e[t].markup},q.renderer.rules.hr=function(e,t,n,i,r){var o;switch(o="",e[t].markup[0]){case"-":o="xsj_minus";break;case"_":o="xsj_underline";break;case"*":o="xsj_asterisk"}return e[t].attrJoin("class","xsj_hr "+o),r.renderToken(e,t,n,i,r)},q.renderer.rules.table_open=function(e,t,n,i,r){var o,a;return a=i.startLine||0,(i.sourceMap||!1)&&e[t].map&&0===e[t].level?(o=e[t].map[0]+a,e[t].attrJoin("class","table"),e[t].attrJoin("class","table-striped"),e[t].attrJoin("class","table-celled"),e[t].attrJoin("data-source-line",o),e[t].attrJoin("data-source-line-display","true"),r.renderToken(e,t,n,i,r)):(e[t].attrJoin("class","table"),e[t].attrJoin("class","table-striped"),e[t].attrJoin("class","table-celled"),r.renderToken(e,t,n,i,r))},c=q.renderer.rules.code_inline,q.renderer.rules.code_inline=function(e,t,n,i,r){var o,a;return(o=(a=e[t]).content.match(/^!\${1}(.*?)\${1}$/))?(a.attrJoin("class","language-mathjax! inline"),a.content="$"+o[1]+"$",'<span class="inline-mathjax" data-vdom-skip="true" data-vdom-mathjax="true">'+c(e,t,n,i,r)+"</span>"):c(e,t,n,i,r)},d=q.renderer.rules.fence,q.renderer.rules.fence=function(e,t,n,i,r){var o,a,s,l;return s=i.startLine||0,a=i.sourceMap||!1,"",l=e[t],/^\s*mathjax!/i.test(l.info)&&l.attrJoin("data-vdom-mathjax","true"),a&&l.map&&0===l.level&&(o=l.map[0]+s,e[t].attrJoin("data-source-line",o),e[t].attrJoin("data-source-line-display","true")),""+d(e,t,n,i,r)},s=q.renderer.rules.code_block,q.renderer.rules.code_block=function(e,t,n,i,r){var o,a;return a=i.startLine||0,"",(i.sourceMap||!1)&&e[t].map&&0===e[t].level&&(o=e[t].map[0]+a,e[t].attrJoin("data-source-line",o),e[t].attrJoin("data-source-line-display","true")),""+s(e,t,n,i,r)},q.renderer.rules.image=function(e,n,i,r,o){var a,s,c,u,d,p,f,h,m,v,g,w,y,b,k,D,C,T,P;for(p={},b=0,y=(D=(P=e[n]).attrs).length;b<y;b++)p[(d=D[b])[0]]=d[1];return T=p.title,C=p.src,u=o.renderInlineAsText(P.children,i,r)||"",v=u+="",W.imgSize&&(v=u.replace(/\s+=([\d]*)[xX\*]([\d]*)\s*$/,"")),T=T||v||"",s=C.replace(/[\?#].*/,""),t=r.fileModel,c=r.previewCache,M++,F[M]=P.attrs,f=O(P.attrs),k=_.filter(f,(function(e){var t;return"src"!==(t=e[0])&&"alt"!==t&&"title"!==t&&"width"!==t&&"height"!==t})),a=x.getExt(s).toUpperCase(),0!==n||".TABLE"!==a&&".TABLE.HTML"!==a&&".DRAWIO"!==a&&".DRAWIO.HTML"!==a&&".DRAWIO.SVG"!==a?(a=x.getExt(s,1).toUpperCase())&&N.renderAutoDetectAttachment&&(m=c.get("url_image_attachment_"+C+u+T),Pe.call(l.imageExts,a)<0)?m||"<span class='story_remote_resource_placeholder story_remote_resource story_remote_resource_inline' data-vdom-skip='true' data-attr='"+M+"' data-alt='"+_.escape(u)+"' data-src='"+_.escape(C)+"' data-title='"+_.escape(T)+"' data-type='image_attachment'>\n  <i class=\"fa fa-spinner fa-spin fa-3x fa-fw margin-bottom\"></i>\n</span>":(w="",m=c.get("url_image_"+C+u+T),g=!1,r.parentToken&&(g=r.parentToken.level>1),N.renderNestImgBlock&&(g=!1),0===n&&!g&&N.renderImgBlock?(h="",$.trim(T)||(h="story_image_blank_caption"),w=m||"<div class='story_remote_resource_placeholder story_remote_resource story_remote_resource_block' data-vdom-skip='true'  data-attr='"+M+"' data-alt='"+_.escape(u)+"' data-src='"+_.escape(C)+"' data-title='"+_.escape(T)+"' data-type='image'>\n  <i class=\"fa fa-spinner fa-spin fa-3x fa-fw margin-bottom\"></i>\n</div>","https://markdown.xiaoshujiang.com/img/spinner.gif"===C&&(w='<img src="./img/spinner.gif">'),k=S(k,"class","story_image_container story_block_image"),w="<div "+K(k)+"><div class='story_image'>"+w,N.renderWrapImgTitle&&(w=w+"<br><div class='story_image_caption "+h+"'>"+T+"</div>"),w+="</div></div>"):(w=m||"<span class='story_remote_resource_placeholder story_remote_resource story_remote_resource_inline' data-vdom-skip='true' data-attr='"+M+"' data-alt='"+_.escape(u)+"' data-src='"+_.escape(C)+"' data-title='"+_.escape(T)+"' data-type='image'>\n  <i class=\"fa fa-spinner fa-spin fa-3x fa-fw margin-bottom\"></i>\n</span>",k=S(k,"class","story_inline_image"),w="<span "+K(k)+">"+w+"</span>"),w):(m=c.get("url_xsj_remote_html_"+C+T))||"<div class='story_remote_resource_placeholder story_remote_resource story_remote_resource_block xsj_remote_html_container' data-vdom-skip='true' data-attr='"+M+"' data-alt='"+_.escape(u)+"' data-src='"+_.escape(C)+"' data-title='"+_.escape(T)+"' data-type='xsj_remote_html'>\n  <i class=\"fa fa-spinner fa-spin fa-3x fa-fw margin-bottom\"></i>\n</div>"},q.renderer.rules.link_open=function(e,t,n,i,r){var o;return(o=e[t]).attrJoin("class","xsj_link xsj_"+("auto"===o.info?"auto_link":"manu_link")),r.renderToken(e,t,n,i,r)},q.renderer.rules.paragraph_open=function(e,t,n,i,r){var o,a,s,l;return e[t].tight?"":(s=i.startLine||0,a=i.sourceMap||!1,(l=e[t]).attrJoin("class","xsj_paragraph xsj_paragraph_level_"+l.level),a&&l.map&&0===l.level&&(o=l.map[0]+s,e[t].attrJoin("data-source-line",o),e[t].attrJoin("data-source-line-display","true")),r.renderToken(e,t,n,i,r)+xe("",e,t))},q.core.ruler.push("heading_anchor_id",(function(e){var t,n,i;return t=e.env,n=t.numberedHeading||N.defaultNumberedHeading||{},n=_.clone(n),t.numberedHeading=n,i=e.tokens,_.each(i,(function(e,t){var r,o,a,s;if("heading_open"===e.type&&(a=_.filter(i[t+1].children,(function(e){return"text"===e.type})),s=_.reduce(a,(function(e,t){return e+t.content}),""),r=ee(s),e.xsj_anchor_id=r,e.xsj_anchor_title=s,o=function(e,t){var n,i,r,o;if(N.renderNumberedHeading){for(i=e[t.tag]||0,e[t.tag]=i+1,n=parseInt(t.tag.substring(1))||8;n<8;)n++,y=N.defaultNumberedHeading||{},e["h"+n]=y["h"+n]||0;if(C=0,[],o=J[t.tag])return(r=o({numberedHeading:e,vsprintf:vsprintf}))&&(r='<span class="xsj_numbered_heading">'+r+"</span>"),r}return""},0===e.level))return e.xsj_numbered_heading=o(n,e)}))})),q.renderer.rules.heading_open=function(e,t,n,i,r){var o,a,s,l,c,u,d,p,f,h,m,v,g,_,w;return v=i.startLine||0,m=i.sourceMap||!1,h="",s="",_=e[t],c=$.trim(_.markup)[0],u=function(){switch(c){case"=":return"xsj_heading_equal";case"-":return"xsj_heading_minus";default:return"xsj_heading_hash"}}(),e[t].attrJoin("class",u+" xsj_heading xsj_heading_"+_.tag),a=_.xsj_anchor_id||"",g=_.xsj_anchor_title,a&&(s='<a name="'+a+'" class="blank_anchor_name"></a><a id="'+a+'" class="blank_anchor_id"></a>'),f="",_.attrIndex("id")>=0?(f=_.attrs[_.attrIndex("id")][1])!==a&&(h='<a name="'+f+'" class="blank_anchor_name"></a><a id="'+f+'" class="blank_anchor_id"></a>'):_.attrSet("id",a),d="",(w=uslug(g))!==f&&w!==a&&(d='<a name="'+w+'" class="blank_anchor_name"></a><a id="'+w+'" class="blank_anchor_id"></a>'),o='<div class="xiaoshujiang_element xsj_anchor">\n  '+s+h+d+"\n</div>\n",p=_.xsj_numbered_heading||"",r.renderToken(e,t,n,i,r)+o+"<span class='xsj_heading_content'>"+p,m&&e[t].map&&0===e[t].level&&(l=e[t].map[0]+v,e[t].attrJoin("data-source-line",l),e[t].attrJoin("data-source-line-display","true")),r.renderToken(e,t,n,i,r)+o+"<span class='xsj_heading_content'>"+xe(p,e,t)},q.renderer.rules.heading_close=function(e,t,n,i,r){return"</span>"+r.renderToken(e,t,n,i,r)},q.renderer.rules.ordered_list_open=function(e,t,n,i,r){var o,a,s,l,c;return l=i.startLine||0,a=i.sourceMap||!1,(s=(c=e[t]).attrGet("start"))>1&&(s-=1,c.attrJoin("style","counter-reset: my-awesome-counter "+s+";")),e[t].attrJoin("class","markdown_ol"),a&&e[t].map&&0===e[t].level&&(o=e[t].map[0]+l,e[t].attrJoin("data-source-line",o)),r.renderToken(e,t,n,i,r)},q.renderer.rules.bullet_list_open=function(e,t,n,i,r){var o,a,s;return s=i.startLine||0,a=i.sourceMap||!1,e[t].attrJoin("class","markdown_ul"),a&&e[t].map&&0===e[t].level&&(o=e[t].map[0]+s,e[t].attrJoin("data-source-line",o)),r.renderToken(e,t,n,i,r)},q.renderer.rules.list_item_open=function(e,t,n,i,r){var o,a;return a=i.startLine||0,(i.sourceMap||!1)&&e[t].map&&e[t].level<3&&(o=e[t].map[0]+a,e[t].attrJoin("data-source-line",o)),r.renderToken(e,t,n,i,r)},q.renderer.rules.mark_open=function(e,t,n,i,r){var o,a,s;return e[t].attrJoin("class","mark"),e[t].tag="span",(s=(a=function(){var n,i;for(C=t+1,n=0;C<e.length;){if("mark_close"===(i=e[C]).type){if(!(n>0))return e[C-1];n-=1}else"mark_open"===i.type&&(n+=1);C++}return null}())&&a.content)&&(o=/(.*)([\s]#(?:[\da-f]{3}){1,2})$/gi,s.replace(o,(function(n,i,r){var o;if(r=$.trim(r))return o=x.getBackgroundColor(r),e[t].attrJoin("style","color:"+r+";background-color:"+o),e[t].attrJoin("class","mark_color mark_color_"+r.replace("#","")),a.content=i}))),r.renderToken(e,t,n,i,r)},q.renderer.rules.mark_close=function(){return"</span>"},q.renderer.rules.footnote_block_open=function(e,t,n,i,r){return(n.xhtmlOut?'<hr class="footnotes-sep" />\n':'<hr class="footnotes-sep">\n')+'<div class="footnotes">\n<ol class="footnotes-list">\n'},q.renderer.rules.footnote_block_close=function(){return"</ol>\n</div>\n"},D=[],L=[],V.nunjucks&&!window.nunjucks&&(D.push({id:"nunjuck_js",type:"script",filename:"js/nunjucks/nunjucks.js"}),D.push({id:"numbo_js",type:"script",filename:"js/nunjucks/numbo.js"}),L.push({id:"numbo_zhtw_js",type:"script",filename:"js/nunjucks/numbo.zhTW.js"})),x.asyncLoadResources(D,(function(){return x.asyncLoadResources(L,(function(){return V.nunjucks&&!be&&(be=new u),o()}))}))},me=function(e,t,n,i,r){var o;return o=se(t),i.autoLoadRemoteResource?(0,$(e).find(".story_script_resource_placeholder").map((function(e,t){var n,i,r,a,s,l;switch((n=$(t)).data("type")){case"youtube":if(l=n.data("videoid"),"thumbnail"===n.data("status"))break;return(r=o.get("youtube_"+l))?n.replaceWith('<div class="youtube_container video_container story_script_resource_placeholder" data-vdom-skip="true" data-vdom-cache="true" data-videoid="'+l+'" data-type="youtube" data-status="thumbnail"><img src="'+r+'"/><i class="icon fa fa-youtube-play fa-5x"></i></div>'):(i=n.find("img")[0],s="https://img.youtube.com/vi/"+l+"/hqdefault.jpg",i.onload=function(){return o.set("youtube_"+l,s),n.replaceWith('<div class="youtube_container video_container story_script_resource_placeholder" data-vdom-skip="true" data-vdom-cache="true" data-videoid="'+l+'" data-type="youtube" data-status="thumbnail"><img src="'+s+'"/><i class="icon fa fa-youtube-play fa-5x"></i></div>'),n=null},i.onerror=function(){return n.removeClass("video_container story_script_resource_placeholder story_remote_resource_placeholder"),n.addClass("story_remote_resource_error story_remote_resource story_remote_resource_block"),n.html('<i class="fa fa-times-circle fa-5x fa-pull-left fa-border"></i>\n  \u65e0\u6cd5\u8bbf\u95ee <br/>\n  <a href="https://www.youtube.com/embed/'+l+'" target="_blank">https://www.youtube.com/embed/'+l+"</a>"),n=null},i.src=s);case"vimeo":if(l=n.data("videoid"),"thumbnail"===n.data("status"))break;return(r=o.get("vimeo_"+l))?n.replaceWith('<div class="vimeo_container video_container story_script_resource_placeholder" data-vdom-skip="true" data-vdom-cache="true" data-videoid="'+l+'" data-type="vimeo" data-status="thumbnail"><img src="'+r+'"/><i class="icon fa fa-vimeo-square fa-5x"></i></div>'):$.get("https://vimeo.com/api/v2/video/"+l+".json",(function(e){return s=e[0].thumbnail_large,o.set("vimeo_"+l,s),n.replaceWith('<div class="vimeo_container video_container story_script_resource_placeholder" data-vdom-skip="true" data-vdom-cache="true" data-videoid="'+l+'" data-type="vimeo" data-status="thumbnail"><img src="'+s+'"/><i class="icon fa fa-vimeo-square fa-5x"></i></div>')})).fail((function(e,t,i){return n.removeClass("video_container story_script_resource_placeholder story_remote_resource_placeholder"),n.addClass("story_remote_resource_error story_remote_resource story_remote_resource_block"),n.html('<i class="fa fa-times-circle fa-5x fa-pull-left fa-border"></i>\n  '+t+" : "+i+' <br/>\n  <a href="https://player.vimeo.com/video/'+l+'" target="_blank">https://player.vimeo.com/video/'+l+"</a>"),n=null}));case"slideshare":if(a=n.data("slideshareid"),"thumbnail"===n.data("status"))break;return(r=o.get("slideshare_"+a))?n.replaceWith('<div class="slideshare_container story_script_resource_placeholder story_remote_resource_placeholder story_remote_resource" data-vdom-skip="true" data-vdom-cache="true" data-slideshareid="'+a+'" data-type="slideshare" data-status="thumbnail"><img src="'+r+'"/><i class="icon fa fa-slideshare fa-5x"></i></div>'):$.ajax({type:"GET",url:"//www.slideshare.net/api/oembed/2?url=http://www.slideshare.net/"+a+"&format=json",jsonp:"callback",dataType:"jsonp",crossDomain:!0,headers:{"Access-Control-Allow-Origin":"*"},error:function(e,t,i){return n.removeClass("slideshare_container story_script_resource_placeholder story_remote_resource_placeholder"),n.addClass("story_remote_resource_error story_remote_resource_block"),n.html('<i class="fa fa-times-circle fa-5x fa-pull-left fa-border"></i>\n  '+t+" : "+i+'<br/>\n  <a href="http://www.slideshare.net/'+a+'" target="_blank">http://www.slideshare.net/'+a+"</a>"),n=null},success:function(e){return s=e.thumbnail_url,o.set("slideshare_"+a,s),n.replaceWith('<div class="slideshare_container story_script_resource_placeholder story_remote_resource_placeholder story_remote_resource" data-vdom-skip="true" data-vdom-cache="true" data-slideshareid="'+a+'" data-type="slideshare" data-status="thumbnail"><img src="'+s+'"/><i class="icon fa fa-slideshare fa-5x"></i></div>'),n=null}})}}))):$(e).find(".story_script_resource_placeholder").map((function(e,t){var n;return n=$(t),Fe(n)}))},d={initRemoteResource:he=function(e,t,n,i,o,a){var s,l,c,u,d;return d=se(t),c=i.autoLoadRemoteResource,e=e||document,n||(n=r.getPreviewProfileModel()),u=e.preId,me(e,t,0,i),s=$(e).find(".story_remote_resource_placeholder"),l=function(n,i){var r,a,s,l,p,f,h,m,v,g,w,y,b,k,D;switch((r=$(n)).data("type")){case"slideshare":return v=r.data("slideshareid"),c?i():$.ajax({type:"GET",url:"//www.slideshare.net/api/oembed/2?url=http://www.slideshare.net/"+v+"&format=json",jsonp:"callback",dataType:"jsonp",crossDomain:!0,headers:{"Access-Control-Allow-Origin":"*"},error:function(){return r.removeClass("slideshare_container story_remote_resource story_script_resource_placeholder story_remote_resource_placeholder"),r.html("http://www.slideshare.net/"+v),r=null,i()},success:function(e){var t,n,o,a,s;return o=(t=$(e.html)).closest("iframe"),n=t.closest("div"),a=$('<div class="inner"></div>').append(o),s=o.attr("height")/o.attr("width")*100,a.css("padding-bottom",s+"%"),r.html(a).append(n),r.removeClass("story_script_resource_placeholder story_remote_resource_placeholder"),r=null,i()}});case"plantuml":return g=r.data("src"),p=r.data("hash"),h=r.data("resource-type"),(s=d.get(p))?(console.log("use cache..."),r.html(s),r.removeClass("story_remote_resource_placeholder"),i()):"image"===h?(m="<img src='"+g+"' class='plant_uml_image'/>",r.html(m),r.removeClass("story_remote_resource_placeholder"),d.set(p,m),i()):$.get(g,(function(t){var n,o,a,s;return e.preId===u?(console.log("same uuid"),(o=$("<div></div>")).html(t),s=(n=o.find(">svg")).attr("width"),a=n.attr("height"),n.css({width:"100%",maxWidth:s,maxHeight:a}),t=o.html(),r.html(t),r.removeClass("story_remote_resource_placeholder"),d.set(p,t)):console.log("diff uuid, pass"),i()}),"html").error((function(e){var t,n;return console.log(e),t=e.statusText,n=e.status,c?(r.removeClass("story_remote_resource_placeholder").addClass("story_remote_resource_error"),r.html('<i class="fa fa-times-circle fa-5x fa-pull-left fa-border"></i>'+n+" \u51fa\u9519\uff1a"+t)):(r.removeClass("story_remote_resource_placeholder story_remote_resource"),r.html(n+" \u51fa\u9519\uff1a"+t)),i()}));case"xsjimg":return g=r.data("src"),p=r.data("hash"),h=r.data("resource-type"),(s=d.get(p))?(console.log("use cache..."),r.html(s),r.removeClass("story_remote_resource_placeholder"),i()):"image"===h?(m="<img src='"+g+"' class='xsjimg_image'/>",r.html(m),r.removeClass("story_remote_resource_placeholder"),d.set(p,m),i()):$.get(g,(function(t){return e.preId===u?(console.log("same uuid"),r.html(t),r.removeClass("story_remote_resource_placeholder"),d.set(p,t)):console.log("diff uuid, pass"),i()}),"html").error((function(e){var t,n;return console.log(e),t=e.statusText,n=e.status,c?(r.removeClass("story_remote_resource_placeholder").addClass("story_remote_resource_error"),r.html('<i class="fa fa-times-circle fa-5x fa-pull-left fa-border"></i>'+n+" \u51fa\u9519\uff1a"+t)):(r.removeClass("story_remote_resource_placeholder story_remote_resource"),r.html(n+" \u51fa\u9519\uff1a"+t)),i()}));case"audio":return g=r.data("src"),b=r.data("title"),le(t,g,o,(function(e,t){return e&&c?(r.removeClass("story_remote_resource_placeholder").addClass("story_remote_resource_error"),r.html('<i class="fa fa-times-circle fa-5x fa-pull-left fa-border"></i>'+_.escape(e.msg))):(m="",(m=t.filename?"<audio data-vdom-skip='true' data-vdom-cache='true'  src='"+_.escape(t.url)+"' name='"+_.escape(t.filename)+"' controls>"+_.escape(b)+"</audio>":"<audio data-vdom-skip='true' data-vdom-cache='true'  src='"+_.escape(t.url)+"' controls>"+_.escape(b)+"</audio>")&&(e||d.set("url_audio_"+g,m),r.replaceWith(m))),i()}));case"video":return(w=(g=r.data("src")).split(" ")).length>1&&(g=w[0]),b=r.data("title"),le(t,g,o,(function(e,t){return e&&c?(r.removeClass("story_remote_resource_placeholder").addClass("story_remote_resource_error"),r.html('<i class="fa fa-times-circle fa-5x fa-pull-left fa-border"></i>'+e.msg)):(m="",m=t.filename?"<video data-vdom-skip='true' data-vdom-cache='true'  src='"+t.url+"' name='"+t.filename+"' controls>"+b+"</video>":"<video data-vdom-skip='true' data-vdom-cache='true'  src='"+t.url+"' controls>"+_.escape(b)+"</video>",e||d.set("url_video_"+g,m),r.replaceWith(m)),i()}));case"attachment":return g=r.data("src"),b=r.data("title"),le(t,g,o,(function(e,t){var n,o,a;return e&&c?(r.removeClass("story_remote_resource_placeholder").addClass("story_remote_resource_error"),r.html('<i class="fa fa-times-circle fa-5x fa-pull-left fa-border"></i>'+e.msg)):(o=(n=t.filename||"").substring(n.lastIndexOf("/")+1),o=b||o||b||"\u9644\u4ef6",a=t.filesize||0,m="<a class='attachment' data-vdom-skip='true' data-vdom-cache='true' href='"+t.url+"' name='"+n+"'title='"+b+"' data-size='"+a+'\'>\n  <i class="fa fa-paperclip"></i>\n  <span class="filename">'+_.escape(o)+'</span>\n  <span class="filesize">'+filesize(a)+"</span>\n</a>",e||d.set("url_attachment_"+g+"_"+b,m),r.replaceWith(m)),i()}));case"image_attachment":return g=r.data("src"),b=r.data("title")+"",a=r.data("alt")+"",le(t,g,o,(function(e,t){var n,o,s;return e&&c?(r.removeClass("story_remote_resource_placeholder").addClass("story_remote_resource_error"),r.html('<i class="fa fa-times-circle fa-5x fa-pull-left fa-border"></i>'+e.msg)):(o=(n=t.filename||"").substring(n.lastIndexOf("/")+1),o=b||o||"\u9644\u4ef6",s=t.filesize||0,m="<a class='attachment' data-vdom-skip='true' data-vdom-cache='true' href='"+t.url+"' name='"+n+"'title='"+b+"' data-size='"+s+'\'>\n  <i class="fa fa-paperclip"></i>\n  <span class="filename">'+o+'</span>\n  <span class="filesize">'+filesize(s)+"</span>\n</a>",e||d.set("url_image_attachment_"+g+a+b,m),r.replaceWith(m)),i()}));case"image":return g=r.data("src"),b=r.data("title")+"",a=r.data("alt")+"",k="",f="",l=a,y="",W.imgSize&&(l=a.replace(/\s+=([\d]*)[xX\*]([\d]*)\s*$/,(function(e,t,n){return t&&(k=" width='"+t+"' ",y+="width: "+t+"px;"),n&&(f=" height='"+n+"' ",y+="height: "+n+"px;"),""}))),y&&(y=" style='"+y+"' "),le(t,g,o,(function(e,t){var n,o;return e&&c?(r.removeClass("story_remote_resource_placeholder").addClass("story_remote_resource_error"),r.html('<i class="fa fa-times-circle fa-5x fa-pull-left fa-border"></i>'+_.escape(e.msg))):(o=t.url,n=t.filename||"",m="<img src='"+_.escape(o)+"' data-vdom-skip='true' data-vdom-cache='true' alt='"+_.escape(l)+"' "+k+" "+f+" "+y+" title='"+_.escape(b)+"' name='"+_.escape(n)+"' data-src='"+_.escape(g)+"'/>",e||d.set("url_image_"+g+a+b,m),r.replaceWith(m)),i()}));case"xsj_remote_html":return D=r[0].__xsjNodeName,r[0].__xsjHTML,g=r.data("src"),b=r.data("title"),a=r.data("alt"),le(t,g,o,(function(t,n){var o;return t&&c?(r.removeClass("story_remote_resource_placeholder").addClass("story_remote_resource_error"),r.html('<i class="fa fa-times-circle fa-5x fa-pull-left fa-border"></i>'+_.escape(t.msg)),i()):(o=n.url,n.filename||"",$.get(o,(function(t){var o,a,s,l,c,p,f,h,m;return e.preId===u?(console.log("same uuid"),a=path.dirname(g),s=x.getExt(g).toUpperCase(),p="",t=(t=function(e,t){switch(e){case".TABLE":case".TABLE.HTML":return p="table",x.filterTableContent(t);case".DRAWIO":case".DRAWIO.HTML":return p="drawio",x.filterDrawioDisplayContent(t);case".DRAWIO.SVG":return p="drawio",x.filterDrawioSVGDisplayContent(t);default:return p="",""}}(s,t)).replace(/(<img [^>]*src=['"])([^'"]+)([^>]*>)/gi,(function(e,t,n,i){return 0===n.indexOf(".")&&(n="."+path.resolve("/",a,n)),t+n+i})),h=(c=n.filename||"").substring(c.lastIndexOf("/")+1),h=b||h||"\u9644\u4ef6",m=n.filesize||0,t+='<div class="component_attachment" style="display:none;">\n<a class=\'attachment table_attachment\' href=\''+n.url+"' name='"+c+"'title='"+b+"' data-size='"+m+'\'>\n  <i class="fa fa-paperclip"></i>\n  <span class="filename">'+h+'</span>\n  <span class="filesize">'+filesize(m)+"</span>\n</a>\n</div>",f="",(N.renderWrapDrawIOTitle&&"drawio"===p||N.renderWrapTableTitle&&"table"===p)&&(o="",$.trim(b)||(o="xsj_remote_html_blank_caption"),f="<br><div class='xsj_remote_html_caption "+o+"'>"+b+"</div>"),t='<div class="xsj_remote_html_container story_remote_resource_block" data-vdom-skip="true" data-vdom-cache="true">\n  <div class="xsj_remote_html">\n  '+t+"\n  "+f+"\n  </div>\n</div>",l=$(t)[0],r.replaceWith(l),l.__xsjNodeName=D,d.set("url_xsj_remote_html_"+g+b,t)):console.log("diff uuid, pass"),i()}),"html").error((function(e){var t,n;return console.log(e),t=e.statusText,n=e.status,c?(r.removeClass("story_remote_resource_placeholder").addClass("story_remote_resource_error"),r.html('<i class="fa fa-times-circle fa-5x fa-pull-left fa-border"></i>'+n+" \u51fa\u9519\uff1a"+t)):(r.removeClass("story_remote_resource_placeholder story_remote_resource"),r.html(n+" \u51fa\u9519\uff1a"+t)),i()})))}));default:return i()}},async.mapLimit(s.toArray(),20,l,(function(n){var i,s;return i=$(e).find("img,video,video>source,audio,a.attachment"),s=function(e,n){var i,r,a;if(e.__isInited)return n();switch(i=$(e),e.tagName){case"IMG":case"VIDEO":case"AUDIO":case"SOURCE":return r=i.attr("src"),a=x.validateUrlPath(r),r?le(t,r,o,(function(t,o){var a;return!t&&o&&o.url&&r!==o.url&&(a=o.url,d.set("url_html_src_"+r,a),i.attr("src",a),i.attr("data-src",r),o.filename&&i.attr("name",o.filename),e.__isInited=!0),n()})):n();case"A":return r=i.attr("href"),a=x.validateUrlPath(r),r&&"xsjurl"===a.result?le(t,r,o,(function(t,o){var a;return!t&&o&&o.url&&r!==o.url&&(a=o.url,d.set("url_html_href_"+r,a),i.attr("href",a),e.__isInited=!0),n()})):n();default:return n()}},async.mapLimit(i.toArray(),20,s,(function(n){var o;return i=$(e).find(".xiaoshujiang_code_container.xiaoshujiang_code_chunk"),o=function(e,n){var i,o,a,s,l;return o=(i=$(e)).data("codechunk_auto"),a=i.data("codechunk_hide"),s=i.data("codechunk_processed"),l=o||a,r.getNonSecurity()&&!s&&(l&&c||!c)?Me(e,t,n):n()},async.mapLimit(i.toArray(),20,o,(function(e){return"function"==typeof a?a(e):void 0}))}))}))},replaceScriptResource:Fe=function(e,t){var n,i,r;switch(e.data("type")){case"youtube":return r=e.data("videoid"),n=t?"?autoplay=1":"",e.data("status","loaded"),e.html('<iframe src="https://www.youtube.com/embed/'+r+n+'" frameborder="0" allowfullscreen></iframe>'),e.removeClass("story_script_resource_placeholder");case"vimeo":return r=e.data("videoid"),n=t?"?autoplay=1":"",e.data("status","loaded"),e.html('<iframe src="https://player.vimeo.com/video/'+r+n+'" frameborder="0" allowfullscreen></iframe>'),e.removeClass("story_script_resource_placeholder");case"slideshare":if(t){if(i=e.data("slideshareid"),"thumbnail"!==e.data("status"))break;return e.data("status","loading"),$.ajax({type:"GET",url:"//www.slideshare.net/api/oembed/2?url=http://www.slideshare.net/"+i+"&format=json",jsonp:"callback",dataType:"jsonp",crossDomain:!0,headers:{"Access-Control-Allow-Origin":"*"},error:function(){return e.data("status","error"),e.removeClass("slideshare_container story_script_resource_placeholder story_remote_resource_placeholder"),e.addClass("story_remote_resource_error story_remote_resource_block"),e.html('<i class="fa fa-times-circle fa-5x fa-pull-left fa-border"></i>\n  '+textStatus+" : "+errorThrown+'<br/>\n  <a href="http://www.slideshare.net/'+i+'" target="_blank">http://www.slideshare.net/'+i+"</a>"),e=null},success:function(t){var n,i,r,o,a;return r=(n=$(t.html)).closest("iframe"),i=n.closest("div"),o=$('<div class="inner"></div>').append(r),a=r.attr("height")/r.attr("width")*100,o.css("padding-bottom",a+"%"),e.html(o).append(i),e.data("status","loaded"),e.removeClass("story_script_resource_placeholder story_remote_resource_placeholder"),e=null}})}}},setCustomCss:function(e,t){var n;if(t){if(e)return n=x.parseCssText(e,""),x.importCssString(n.toString(),"custom-css-style",!0,t);$(t).find("#custom-css-style").text("")}},getUrlInfo:le=function(e,t,n,o){var a,s,l,c,u,d;if(c=n.parseClientLocalMedias,a=n.filename||"",s=0,u={},e&&(u=e.get("urlMap")||{}),"error"===(d=x.validateUrlPath(t)).result)return o({msg:d.msg},{url:t});if("normal"===d.result)return u[t]&&!n.disableUrlMap?b.checkLinkAvaliable(t,(function(i,r){return i?(n.disableUrlMap=!0,n.orignUrl=t,t=u[t],console.log("use fallback url......"),le(e,t,n,o)):o(null,{url:t,filename:a,filesize:s})})):ne[t]?void o(null,ne[t]):/^blob:/i.test(t)?void o(null,{url:t,filename:a,filesize:s}):b.checkLinkAvaliable(t,(function(l,c){return l?i.getResource(t,(function(i,l){var c,u;return i?"client"!==STORY_PLATFORM?x.getCrossOrignDomainResource(t,(function(e,n){var i;return e?o(null,{url:t,filename:a,filesize:s}):((i=x.dataURL2Blob(n)).type,s=i.size,o(null,{url:n,filename:a,filesize:s}))})):o(null,{url:t,filename:a,filesize:s}):(c=l.data,u=c.type,a=l.filename,s=c.size,e&&n.createUrlMap&&s<31457280?x.blobToMd5(c,(function(i,d){var p;return p=l.key||r.getUploadFilePath(u,e,a,d,c),e.addAttachment(c,p,u,{fixRepeatFilename:!1},(function(i,r,l,c){return i?"function"==typeof o?o(null,{url:t,filename:a,filesize:s}):void 0:e.setUrlMap(t,r,(function(i){return n.disableUrlMap=!0,n.orignUrl=t,le(e,r,n,o)}))}))})):o(null,{url:t,filename:a,filesize:s}))})):i.getResource(t,(function(e,n){var i;return i=s,c&&c.headers&&(i=c.headers.get("content-length")||s),n&&n.data&&(i=n.data.size),ne[t]={url:t,filename:a,filesize:i},o(null,ne[t])}))}));if(l=function(t,o){0===(a=(a=t).replace(/^\.*\/*/,"")).indexOf("./")&&(a=a.substring(2));try{a=decodeURI(a)}catch(e){e,console.error("error filename:"+a)}return i.getResource(a,(function(i,s){var l,c,u,d,p;return i?((c=document.createElement("a")).setAttribute("href",a),p=c.href,n.disableUrlMap=!0,n.filename=a,le(e,p,n,o)):e?(u=s.data,d=u.type,l=s.filename,x.blobToMd5(u,(function(i,a){var c;return c=s.key||r.getUploadFilePath(d,e,l,a,u),e.addAttachment(u,c,d,{fixRepeatFilename:!1},(function(i,r,a,s){return i?o({msg:"\u627e\u4e0d\u5230\u5730\u5740 "+t+" \u5bf9\u5e94\u7684\u8d44\u6e90"},{url:t}):le(e,"./"+r,n,o)}))}))):o({msg:"\u627e\u4e0d\u5230\u5730\u5740 "+t+" \u5bf9\u5e94\u7684\u8d44\u6e90"},{url:t})}))},e){0===(a=(a=t).replace(/^\.*\/*/,"")).indexOf("./")&&(a=a.substring(2));try{a=decodeURI(a)}catch(e){e,console.error("error filename:"+a)}return e.getAttachObjectByFilename(a,(function(n,i){var u,d;if(i&&(d=i.objectUrl,void 0===(s=i.length)))if(i.data instanceof Blob)s=i.data.size;else if(i.data instanceof String)try{u=atob(i.data),s=u.size}catch(e){e,s=0}if(d)t=d;else{if("client"!==STORY_PLATFORM||!c)return l(t,o);if(d=r.objectUrlCache(t,e))t=d;else{try{t=decodeURI(t)}catch(e){e,console.error("error url:"+t)}if(!(d=r.objectUrlCache(t,e)))return l(t,o);t=d}}return o(null,{url:t,filename:a,filesize:s})}))}return l(t,o)},formatLink:function(e,t){if((t=t||window)&&t.document&&t.document.location)return e.find("a").map((function(e,n){var i,r,o;if(o=(i=$(n)).prop("href"),r=t.document.location.origin+t.document.location.pathname,0!==("function"==typeof o.indexOf?o.indexOf(r):void 0))return i.attr("target","_blank")}))},runCodeChunk:Me=function(e,t,n){var i,r,o,a,l,c,u,d;return null==e&&(e=null),e?(d=se(t),(i=$(e)).hasClass("running")?"function"==typeof n?n():void 0:(o=i.data("orign_code"),l=i.data("codechunk_hide"),a=i.data("codechunk_hash"),(u=i.data("codechunk_args"))?(c=i.data("codechunk_lang"),r=u.cmd||c,i.addClass("running"),i.find(".out_put_error").remove(),s.run(o,"",r,u,(function(e,t,r){var o,s;if(i.removeClass("running"),(o=i.find(".out_put")).length>0&&o.remove(),e)return i.append('<div class="out_put_error">'+_.escape(e)+"</div>"),void("function"==typeof n&&n());switch(l&&i.html(""),o=$('<div class="out_put"></div>'),r.output){case"html":o.append(t);break;case"png":s=Buffer(t).toString("base64"),o.append("<img src='data:image/png;charset=utf-8;base64,"+s+"'>");break;case"none":o.html(""),o.remove(),o=null;break;default:t.length&&(o.append("<pre></pre>"),o.find("pre").text(t))}return o?(i.append(o),d.set(a,o.html())):d.set(a,""),i=null,"function"==typeof n?n():void 0}))):"function"==typeof n?n():void 0)):"function"==typeof n?n():void 0},reInitMdHtml:function(){return z=!0,ce={}},convertFileSrcToDataURL:E=function(e,t,n,i,r,o,a){var s,u;return s=function(){var r,s,u;return s=$(e.document).find("defs"),u=[],i?t.find("svg").map((function(e,t){var n;return n=null,function(){var e,i,r;return e=$(t).clone(),i=s.clone(),e.append(i),$(t).prepend(i),r=$.Deferred(),n=r.promise(),$("<div></div>").append(e),$(t).wrap("<div></div>"),domtoimage.toPng($(t).parent()[0]).then((function(e){var n;return n=CryptoJS.MD5(e).toString()+".png",$(t).parent().replaceWith($('<img class="svg-image" src="'+e+'" name="'+n+'" />')),r.resolve()})).catch((function(e){return r.resolve(),console.err(e)}))},function(){return $(t).removeAttr("xmlns:xlink").removeAttr("xmlns"),n=saveSvgAsPng(t,s,"filename.png",1,(function(e){var n,i,r;return"xsj_plugin_wechat"===o.brand&&(n=x.dataURL2Blob(e)).size<1024&&(console.log(n.size),r="\u8be5\u6587\u4ef6\u7531\u5c0f\u4e66\u5320\u751f\u6210, http://www.xiaoshujiang.com, \u6b22\u8fce\u4f7f\u7528\u5c0f\u4e66\u5320\u7b14\u8bb0\u7cfb\u7edf\uff0c\u4e00\u6b3e\u5f3a\u5927\u7684\u77e5\u8bc6\u7ba1\u7406\u7cfb\u7edf\uff0c\u60a8\u503c\u5f97\u62e5\u6709",r=encodeURIComponent(r),e=writeMetaInfoToPng(e,"zTXt","xsj",r+r+r+r),n=x.dataURL2Blob(e),console.log("after size:",n.size)),i=CryptoJS.MD5(e).toString()+".png",$(t).replaceWith($('<img class="svg-image" src="'+e+'" name="'+i+'" />'))}))}(),u.push(n)})):(r=$('<div style="overflow: hidden; position: absolute; top: 0px; height: 1px; width: auto; padding: 0px; border: 0px; margin: 0px; text-align: left; text-indent: 0px; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal;"><svg></svg></div>'),t.prepend(r),r.find("svg").append(s)),t.find(".plot").map((function(e,t){var n;if(n=$(t).data("plot"))return n.convertToImage()})),$.when.apply(null,u).done((function(){var e;return e=[],t.find("img").map((function(t,i){var r,a,s;if(o.disableLazyLoading||i.setAttribute("loading","lazy"),a=i.src,r=$.Deferred(),0===a.indexOf("data:image"))return 0;if(/^http(s)?:\/\//.test(a)){if(0===a.indexOf(document.location.origin))return s=setTimeout((function(){return c.showMessage("\u6293\u53d6\u56fe\u7247"+_.escape(a)+"\u8d85\u65f6"),r.resolve()}),l.getNetworkResourceTimeout),x.getCrossOrignDomainResource(i.src,(function(e,t){return clearTimeout(s),s=null,e||(i.src=t),r.resolve()})),e.push(r.promise());if(n)return s=setTimeout((function(){return c.showMessage("\u6293\u53d6\u56fe\u7247"+_.escape(a)+"\u8d85\u65f6"),r.resolve()}),l.getNetworkResourceTimeout),x.getCrossOrignDomainResource(i.src,(function(e,t){return clearTimeout(s),s=null,e||(i.src=t),r.resolve()})),e.push(r.promise())}else{if(/^(file|chrome-extension):\/\//.test(a))return s=setTimeout((function(){return c.showMessage("\u6293\u53d6\u56fe\u7247"+_.escape(a)+"\u8d85\u65f6"),r.resolve()}),l.getNetworkResourceTimeout),x.urlToDataURL(i.src,(function(e,t){return clearTimeout(s),s=null,e||(i.src=t),r.resolve()})),e.push(r.promise());if(0===a.indexOf("blob:"))return x.urlToDataURL(a,(function(e,t){return t?(i.src=t,r.resolve()):(console.log("pic not found:"+i.src),r.resolve())})),e.push(r.promise());if("client"===STORY_PLATFORM)return 0}})),t.find("video").map((function(t,n){var i,r,o;if(i=$(n),o=i.attr("src"),r=$.Deferred(),0===o.indexOf("blob:"))return blobURLImgToBase64(o,(function(e){return e?i.attr("src",e):console.error("video no found:"+o),r.resolve()})),e.push(r.promise())})),t.find("audio").map((function(t,n){var i,r,o;if(i=$(n),o=i.attr("src"),r=$.Deferred(),0===o.indexOf("blob:"))return blobURLImgToBase64(o,(function(e){return e?i.attr("src",e):console.error("audio no found:"+o),r.resolve()})),e.push(r.promise())})),t.find("a.attachment").map((function(t,n){var i,r,o;if(i=$(n),o=i.attr("href"),r=$.Deferred(),0===o.indexOf("blob:"))return blobURLImgToBase64(o,(function(e){return e&&"data:"!==e?i.attr("href",e):console.error("attachment no found:"+o),r.resolve()})),e.push(r.promise())})),$.when.apply(null,e).done((function(){return function(e){var n;return n=[],o.convertWebp&&t.find("img").map((function(e,t){var i;if(0===t.src.indexOf("data:image/webp"))return i=$.Deferred(),domtoimage.toPng(t,{width:t.naturalWidth,height:t.naturalHeight}).then((function(e){return t.src=e,i.resolve()})).catch((function(e){return i.resolve(),console.err(e)})),n.push(i.promise())})),o.convertGif&&t.find("img").map((function(e,t){var i;if(0===t.src.indexOf("data:image/gif"))return i=$.Deferred(),domtoimage.toPng(t).then((function(e){return t.src=e,i.resolve()})).catch((function(e){return i.resolve(),console.err(e)})),n.push(i.promise())})),$.when.apply(null,n).done((function(){return e()}))}((function(){return t.find("img").map((function(e,t){var n,i,r,o;if(o=t.src,n=$(t),0===o.indexOf("data:image")&&!$.trim(n.attr("name")))return i=function(e){var t;try{"gif"!==(t=e.split(";")[0].split("/")[1].split("+")[0].toLowerCase())&&"jpg"!==t&&"jpeg"!==t&&"png"!==t&&"svg"!==t&&"webp"!==t&&(t="png"),t="."+t}catch(e){e,t=".png"}return t}(o),r=CryptoJS.MD5(o).toString()+i,n.attr("name",r)})),"function"==typeof a?a(t):void 0}))}))}))},r&&e.FontAwesome&&e.FontAwesome.dom&&(u=e.FontAwesome.dom.i2svg())?u.then((function(){return s()})):s()},convertFileSrcToObjectURL:I,convertFileSrcToCidAndDataURL:j,cleanCache:function(e,t){var n,i,r;if(n=function(e,t){var n,i,r,o,a,s;if(e){for(i=encodeURI(e),s=[],o=0,a=(r=t.keys()).length;o<a;o++)(n=r[o]).startsWith(e)||n.startsWith(i)?s.push(t.set(n,null)):s.push(void 0);return s}return null!=t?t.clean():void 0},t)return n(e,i=se(t));for(e in r=[],ce)i=ce[e],r.push(n(e,i));return r},previewTarget:function(e,t,n,i,o,a){var s,l;return l=se(e),s=function(){var s,c,u,d,p,f,h,m,v,g,w;return g=!0===o.sourceMap,v=o.previewType||"normal",f=!1!==o.needRenderPreview,h=!1!==o.parseClientLocalMedias,o.parseClientLocalMedias=h,y=0,ke=[],De="",d="",n.document.preId=_.uniqueId("PREVIEW_"),p=function(i){return n.autoLoadRemoteResource?he(n.document,e,t,n,o,(function(){return"function"==typeof a?a(i):void 0})):"function"==typeof a?a(i):void 0},t||(t=r.getPreviewProfileModel()),t.get("disableVdomPreview")&&(o.livePreview=!1),n.beforeRenderPreview((function(){})),v=v,w=0,m=function(e){var t;return(t=/^---\s*\n([\s\S]+?)\n---\s*\n*/.exec(e))?(U=x.getMetaData(e),Y=t[0],w=t[0].replace(/\n*$/,"").split("\n").length,e.substring(t[0].replace(/\n*$/,"").length+1)):(U={},Y="",e)},G=Y,u=m(e.get("content")),G!==Y&&(z=!0),s={parseClientLocalMedias:h,sourceMap:g,startLine:w,fileModel:e,previewCache:l,previewOptions:o},z||null===q||o.resetMdHtml?(z=!1,R(0,e,t,o,(function(){return c()})),o.resetMdHtml&&(z=!0)):setTimeout((function(){return c()}),1),c=function(){var t,r,a,c,m,y,b,x,k,D,C,F,M,T,S,P,j,E,I,O,V,L,A;if(Z.parse(u,s),delete s.footnotes,s.title_link_footnote=N.renderTitleLinkAsFootnote,s.link_footnote=N.renderLinkAsFootnote,k={id:(F=e.attributes)._id,createDate:F.createDate,tagNames:F.tagNames,title:F.title,updateDate:F.contentUpdateDate||F.updateDate,content:F.content,isSys:F.isSys},x={meta:U,doc:k,_rootWindow:window},W.nunjucks){b={fileModel:e,env:s,getRender:function(){return q},context:x};try{u=be.render(u,b)}catch(e){D=e,d=u,ke.push(D.toString())}}if(a=function(t,n){return null==n&&(n={parseClientLocalMedias:h,sourceMap:g,startLine:w,fileModel:e,previewCache:l,previewOptions:o}),t=q.render(t,n),t=ie(n.previewCache,t),t=Te(t)},"normal"===v||"pdf"===v){if(u=a(u,s),c=u,j="",(y=e.getCoverUrl())&&(m="<img src='"+y+"'/>",m=ie(s.previewCache,m),j+="<div class='story_cover' style=\"display:none;\">\n"+m+"\n</div>"),U&&((L=_.escape(U.title))&&N.renderMetaTitle&&(j+="<h1 class='story_title'>"+L+"</h1>"),U.tags&&N.renderMetaTag&&(O=$.isArray(U.tags)?U.tags:U.tags.split(","),V=function(){var e,t,n;for(n=[],e=0,t=O.length;e<t;e++)(I=O[e])?(I=_.escape(I),n.push("<span class='tag blue label'>"+I+"</span>")):n.push(void 0);return n}().join(""),j=j+"<div class='story_tags'>"+V+"</div>")),ke.length>0){for(r=[],E=d.split("\n"),M=T=0,S=E.length;T<S;M=++T)t=E[M],r.push('<li class="li_linenum" date-linenum="'+(M+1)+'">'+_.escape(t)+"</li>");P='<div class="xiaoshujiang_code_container preview_error_orign_content"><ol start="1" class="ol_linenums" style="counter-reset: lines 0;">'+r.join("")+"</ol></div>",De=ke.join("<br/>")+P}return C=null,De&&(C={html:De}),o.livePreview?(A=Se(IncrementalDOM),IncrementalDOM.patch(i[0],(function(){return A.run(j+c)})),A.needRefreshEquationMathjax()&&i.find("[data-vdom-mathjax=true]").map((function(e,t){if("PRE"!==t.tagName&&t.__xsjMathjaxEq)return t.innerHTML=t.__xsjHTML}))):i.html(j+c),H(n,i,x,l,(function(){return f?n.renderPreview(W,l,o,x,(function(){return p(C)})):p(C)}))}if("presetation"===v)return Q(n,i,u,U,a,s,x,l,(function(){var e,i,a;if(ke.length>0){for(r=[],a=d.split("\n"),M=i=0,e=a.length;i<e;M=++i)t=a[M],r.push('<li class="li_linenum" date-linenum="'+(M+1)+'">'+_.escape(t)+"</li>");P='<div class="xiaoshujiang_code_container preview_error_orign_content"><ol start="1" class="ol_linenums" style="counter-reset: lines 0;">'+r.join("")+"</ol></div>",De=ke.join("<br/>")+P}return C=null,De&&(C={html:De}),f?n.renderPreview(W,l,o,x,(function(){return p(C)})):p(C)}))}},pe((function(){return s()}))}},n.exports=d}}),window.requirejs.define({"lib/preview_utils":function(e,t,n){var i,r,o,a,s,l=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};a=t("./utils"),t("../application"),r=t("./notifier"),i=t("../views/file_info_view"),s=function(e){var t,n,i,r,o,a,s,c,u,d,p;for(n={a:["href","title","target"],img:["src","alt","title","width","height"],input:["type","value","name","placeholder","checked","disabled"],textarea:["name","placeholder","disabled","readonly"],select:["name","disabled","multiple"],option:["value","selected"],form:["action","method"],script:["src","type"],link:["href","rel"],meta:["name","content","charset"],source:["src","type"],video:["src","controls","poster"],audio:["src","controls"],iframe:["src"]},d=[],s=0,c=(u=e.querySelectorAll("*")).length;s<c;s++)p=(a=u[s]).tagName.toLowerCase(),t=n[p]||[],o=function(){var e,t,n,r;for(r=[],e=0,t=(n=a.attributes).length;e<t;e++)i=n[e],r.push(i.name);return r}(),d.push(function(){var e,n,i;for(i=[],e=0,n=o.length;e<n;e++)r=o[e],l.call(t,r)<0?i.push(a.removeAttribute(r)):i.push(void 0);return i}());return d},(o={}).initContextMenu=function(e){return $(window).on("triggerPreviewContextMenu",(function(t,n,i,r,o,a){var s,l;if(a&&a.frameElement&&a.frameElement.parentElement)return l=$(a.frameElement.parentElement).offset(),s=$.Event("contextmenu",{pageX:i+l.left,pageY:r+l.top,xsjData:{target:o.target,selectedText:n,originalWindow:a}}),$(e).trigger(s)})),$.contextMenu({selector:e,trigger:"none",build:function(e,t){var n,o,l,c,u,d,p;return d=t.xsjData.selectedText,p=t.xsjData.target,o=t.xsjData.originalWindow,n=o.document,l=null,d&&(l={copyAsHtml:{name:"\u590d\u5236\u4e3a html \u7247\u6bb5",disabled:!d,callback:function(){var e,t,i;return e=o.getSelection().getRangeAt(0).cloneContents(),(t=document.createElement("div")).appendChild(e),$(t).find(".xiaoshujiang_element").remove(),s(t),i=t.innerHTML,$(n).one("copy",(function(e){return e.preventDefault(),e.stopPropagation(),e.originalEvent.clipboardData.setData("text/plain",i)})),n.execCommand("copy")}},copyAsEscapeHtml:{name:"\u590d\u5236\u4e3a escaped html \u7247\u6bb5",disabled:!d,callback:function(){var e,t,i,r;return t=o.getSelection().getRangeAt(0).cloneContents(),(i=document.createElement("div")).appendChild(t),$(i).find(".xiaoshujiang_element").remove(),s(i),r=i.innerHTML,(e=$("<div></div>")).text(r),r=e.html(),$(n).one("copy",(function(e){return e.preventDefault(),e.stopPropagation(),e.originalEvent.clipboardData.setData("text/plain",r)})),n.execCommand("copy")}}},"client"===STORY_PLATFORM&&Object.assign(l,{copyAsStyledHtml:{name:"\u590d\u5236\u4e3a\u5e26\u5185\u8054\u6837\u5f0f\u7684 html \u7247\u6bb5",disabled:!d,callback:function(){var e,t,i,r;return n.execCommand("copy"),i=(t=window.nw.Clipboard.get()).get("html"),(e=$("<div></div>")).html(i),e.find(".xiaoshujiang_element, meta").remove(),r=e.html(),t.set([{type:"text",data:r},{type:"html",data:i}])}}})),u={statics:{name:"\u5b57\u6570\u7edf\u8ba1",callback:function(){var e,t,r;return e=d?o.getSelection().getRangeAt(0).cloneContents():n.querySelector(".preview_wrapper").cloneNode(!0),(t=document.createElement("div")).appendChild(e),$(t).find(".xiaoshujiang_element").remove(),r=(r=t.innerText)||n.body.innerText,new i({}).show(r)}}},d&&Object.assign(u,{copy:{name:"\u590d\u5236",disabled:!d,callback:function(){return n.execCommand("copy")}}}),l&&Object.assign(u,{copyAs:{name:"\u590d\u5236\u4e3a ...",items:l}}),p&&p.tagName&&"IMG"===p.tagName&&(c=p.src,/^http[s]?:\/\//i.test(c)&&Object.assign(u,{copyImgLink:{name:"\u590d\u5236\u56fe\u7247\u94fe\u63a5",callback:function(){return $(n).one("copy",(function(e){return e.preventDefault(),e.stopPropagation(),e.originalEvent.clipboardData.setData("text/plain",c)})),n.execCommand("copy")}}}),"client"===STORY_PLATFORM&&Object.assign(u,{copyImg:{name:"\u590d\u5236\u56fe\u7247",callback:function(){return a.urlToDataURL(c,(function(e,t){var n;return e?r.showMessage("\u590d\u5236\u56fe\u7247\u51fa\u9519:"+e,6e3,"error"):(n=a.parseBase64Data(t).type,n=/^image\//i.test(n)?n.substring(6):"png",window.nw.Clipboard.get().set([{type:n,data:t}]))}))}},saveImgAs:{name:"\u56fe\u7247\u53e6\u5b58\u4e3a...",callback:function(){return a.objectURLToBlob(c,(function(e,t){var n,i;return e?r.showMessage("\u4fdd\u5b58\u56fe\u7247\u51fa\u9519:"+e,6e3,"error"):(n=t.type,n=/^image\//i.test(n)?n.substring(6):"png",-1===(i=(i=(i=p.name||p.title||"\u672a\u547d\u540d\u56fe\u7247.png").replace(/^\/*|\/*$/g,"")).substring(i.lastIndexOf("/")+1)).indexOf(".")&&(i=i+"."+n),saveAs(t,i))}))}}})),Object.assign(u,{selectAll:{name:"\u9009\u62e9\u5168\u90e8",callback:function(){return n.execCommand("selectAll")}}}),{items:u}}})},n.exports=o}}),window.requirejs.define({"lib/pwa_manager":function(e,t,n){var i,r;i=!1,r=function(e){var n,r,o;if(!i)return navigator.serviceWorker.controller?(i=!0,r=new MessageChannel,n=t("../views/pwa_install_dialog_view"),(o=new n({isInstall:e})).show((function(){return i=!1,o=null})),navigator.serviceWorker.controller.postMessage({type:"pwaInstall"},[r.port2]),r.port1.onmessage=function(e){switch(e.data.type){case"pwaInstallInfo":return null!=o?o.updateProgress(e.data):void 0;case"pwaInstalled":return null!=o?o.doneProgress(e.data):void 0}}):void 0},n.exports={showInstallView:r}}}),window.requirejs.define({"lib/recently_use_filter_manager":function(e,t,n){var i,r;i=function(){var e;e=[];try{e=JSON.parse(localStorage.getItem("recentlyUseFilters"))}catch(t){t,e=[]}return e instanceof Array||(e=[]),e},r=function(e){return e.length>30&&(e=_.rest(e,e.length-30)),localStorage.setItem("recentlyUseFilters",JSON.stringify(e))},n.exports={getFilters:function(){return i()},addFilter:function(e){var t,n;if(e)return(n=(t=i()).indexOf(e))>=0&&t.splice(n,1),t.push(e),r(t)}}}}),window.requirejs.define({"lib/recently_use_manager":function(e,t,n){var i,r;i=function(e){var t;t=[];try{t=JSON.parse(localStorage.getItem("recentlyUse_"+e))}catch(e){e,t=[]}return t instanceof Array||(t=[]),t},r=function(e,t){return e.length>30&&(e=_.rest(e,e.length-30)),localStorage.setItem("recentlyUse_"+t,JSON.stringify(e))},n.exports={getItems:function(e){return i(e)},addItem:function(e,t){var n,o;if(e)return(o=(n=i(t)).indexOf(e))>=0&&n.splice(o,1),n.push(e),r(n,t)}}}}),window.requirejs.define({"lib/resource_core":function(e,t,n){var i,r,o,a,s,l,c;r=t("../application"),a=t("../lib/notifier"),l=t("../lib/utils"),o=t("../constant"),i=t("./app_resource_core"),c=function(e){return e?(e=e.replace(/ /g,"_")).replace(/[_:!<>'"$[\]()#]+/g,"_"):e},s={uploadResource:function(e,t,n,s,u,d,p){var f,h,m,v,g,_;if(null==e&&(e={}),".PNG"===(m=l.getExt(n,1).toUpperCase())||(".JPEG"===m||".JPG"===m?s="image/jpeg":".WEBP"===m?s="image/webp":".GIF"===m?s="image/gif":".SVG"===m&&(s="image/svg+xml")),d=$.extend({},{fixRepeatFilename:!0,useAppResource:!0,useResourcePlugin:!0},d),u.size&&u.size>o.maxFileSize){if(h="\u4e0a\u4f20\u5931\u8d25:\u6587\u4ef6 '"+n+"' ("+filesize(u.size)+")\u592a\u5927\uff0c \u8d85\u8fc7\u4e86\u5c0f\u4e66\u5320\u7684\u6700\u5927\u4e0a\u4f20\u9650\u5236 ("+filesize(o.maxFileSize||0)+")",a.showMessage(h,6e3,"error"),p){if(d.path)return setTimeout((function(){return p(null,n,d.path,d,d.path)}),1),!0;p(h)}return!1}return n=c(n),d&&!1!==d.fixRepeatFilename&&(d.fixRepeatFilename=!0),g=d&&d.hasOwnProperty("resourceModel")?d.resourceModel:r.getCurrentResourcePluginModel(),d.useResourcePlugin||(g=null),d.fileModel=t||d.fileModel,_=function(t){var o,s;if(s=g.get("name"),o=r.getPlugin(s,"resource",g))return o.saveFile(e,n,u,d,(function(e,r,s,l){return n=r||n,e?a.showMessage("\u4f7f\u7528\u56fe\u5e8a "+(o.displayName||o.name)+" \u4e0a\u4f20\u56fe\u7247\u51fa\u9519:"+e,6e3,"error"):d.useAppResource&&i.createResource(s,n,u.type,u,(function(e,t){return console.log("upload resource center")})),t(e,n,s,d,s)}))},t?(v="",f=function(e){var r;return r=g&&0===s.indexOf("image"),t.addAttachment(u,v,s,{fixRepeatFilename:d.fixRepeatFilename,md5:e,triggerEvent:!r},(function(e,r,o,a){return e||d.useAppResource&&i.createResource(r,n,o.type,o,(function(e,t){return console.log("upload resource center")})),g&&0===s.indexOf("image")?_((function(e,n,i,o,s){return e?"function"==typeof p?p(null,r,"./"+r,o,a):void 0:t.setUrlMap(i,r,(function(t){return"function"==typeof p?p(e,r,i,o,s):void 0}))})):"function"==typeof p?p(null,r,"./"+r,d,a):void 0}))},l.blobToMd5(u,(function(e,i){return v=r.getUploadFilePath(s,t,n,i,u),t.hasAttachment(v)?t.getAttachObjectByFilename(v,(function(e,t){return t&&t.digest&&i===l.base64ToHex(t.digest.substring("md5-".length))&&(d.fixRepeatFilename=!1),f(i)})):f(i)}))):g&&0===s.indexOf("image")?_((function(e,t,n,i,r){return"function"==typeof p?p(e,t,n,i,r):void 0})):"function"==typeof p&&p(null,n,"./"+n,d,"./"+n),!0}},n.exports=s}}),window.requirejs.define({"lib/router":function(e,t,n){var i,r={}.hasOwnProperty;i=t("application"),n.exports=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)r.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,Backbone.Router),t.prototype.routes={"":"home","*default":"home"},t.prototype.home=function(){var e;return(e=$("body")).append(i.homeView.render().$el),e.prepend(i.sidebarView.render().$el),i.homeView.initLayout()},t}()}}),window.requirejs.define({"lib/tmpl_manager":function(e,t,n){var i,r,o,a;r=t("./utils"),i=t("./config_sync"),a=function(e,t){var n,i,o,a,s,l,c,u,d,p,f;return null==t&&(t={prefixTemplateName:""}),o=e.content||"",n=!!(s=r.getMetaData(o)).template_canScript,d=s.template_name||s.template_title||s.title||e.title||"\u672a\u547d\u540d\u6a21\u677f",p=s.template_tags||s.tags||e.tagNames||[],u=s.template_category||s.category||e.category||"",f=s.template_yaml_title||s.title||e.title||"\u672a\u547d\u540d\u6807\u9898",c=s.template_yaml_tags||s.tags||e.tagNames||[],i=s.template_yaml_category||s.category||e.category||"",a=s.template_yaml_emoji||s.emoji||e.emoji||"","string"==typeof c&&(c=c.split(",")),"string"==typeof p&&(p=p.split(",")),s.template_yaml_title&&(o=r.setMetaData(o,"title",f),o=r.setMetaData(o,"template_yaml_title","")),s.template_yaml_tags&&(o=r.setMetaData(o,"tags",c),o=r.setMetaData(o,"template_yaml_tags","")),s.template_yaml_category&&(o=r.setMetaData(o,"category",i),o=r.setMetaData(o,"template_yaml_category","")),s.template_yaml_emoji&&(o=r.setMetaData(o,"emoji",a),o=r.setMetaData(o,"template_yaml_emoji","")),s.template_yaml_createDate&&(o=r.setMetaData(o,"createDate",s.template_yaml_createDate),o=r.setMetaData(o,"template_yaml_createDate","")),s.template_name&&(o=r.setMetaData(o,"template_name","")),s.template_title&&(o=r.setMetaData(o,"template_title","")),s.template_tags&&(o=r.setMetaData(o,"template_tags","")),s.template_category&&(o=r.setMetaData(o,"template_category","")),s.hasOwnProperty("template_canScript")&&(o=r.setMetaData(o,"template_canScript","")),{},l=t.prefixTemplateName||"",{title:f,cssText:e.cssText||"",canScript:n,content:o,templateName:l+d,tagNames:p,category:u,_attachments:e._attachments}},o=function(e,t,n){var r;return r=a(e,t),i.createOrUpdateTemplate(r,(function(e,t){return n(e,r)}))},n.exports={getTmplByDoc:a,createTmplByDoc:o}}}),window.requirejs.define({"lib/user_dict_manager":function(e,t,n){var i,r,o,a,s;i=t("../application"),r=function(e){var t,n,r,o;return"string"==typeof e&&(e=[e]),"string"==typeof(n=(t=i.getApplicationProfileModel()).get("userDicts")||[])&&(n=n.split(",")),o=n.concat(e),r=new Set(o),t.save({userDicts:Array.from(r)})},o=function(e){var t,n,r;return"string"==typeof e&&(e=[e]),"string"==typeof(n=(t=i.getApplicationProfileModel()).get("userDicts")||[])&&(n=n.split(",")),r=n.filter((function(t){return e.indexOf(t)<0})),t.save({userDicts:r})},s=function(){var e;return"string"==typeof(e=i.getApplicationProfileModel().get("userDicts")||[])&&(e=e.split(",")),e},a=function(e){var t;return t=[],CodeMirrorSpellChecker.nspell&&(t=CodeMirrorSpellChecker.nspell.suggest(e)||[]),t},n.exports={addWords:r,deleteWords:o,getWords:s,getSuggestWords:a}}}),window.requirejs.define({"lib/utils":function(e,t,n){var i,r,o,a,s,l,c,u,d,p,f,h,m,v,g,w,y,b,x,k,D,C;r=t("./notifier"),i=t("../constant"),l=t("./markdown/video"),s=t("./markdown/audio"),a=t("./markdown/attachment"),o=t("./pouchdb_index_view_manager"),u=t("./zip"),C=function(e){return e.replace(/[\u200B-\u200D\uFEFF]/g,"")},(c={}).convertToValidFilename=function(e){return(e=C(e)).replace(/[\/|\\:*~?"<>\n\r]/g,"_")},k=function(e){var t,n,i,r,o,a,s,l;for(s=[],i=[].slice.call(e.attributes),e.removeAttribute("allownw"),l=[],o=0,a=i.length;o<a;o++)0===(t=(n=i[o]).name).indexOf("on")?((r={}).attribute=n.name,r.value=n.value,s.push(r),l.push(e.attributes.removeNamedItem(t))):l.push(void 0);return l},D=function(e,t){return t.forEach((function(t){var n,i,r,o,a;for(r=(a=e.getElementsByTagName(t)).length,o=[];r--;)i=(n=a[r]).outerHTML,o.push(n.outerHTML="<pre><code>"+_.escape(i)+"</code></pre>");return o}))},c.stripScripts=function(e,t){var n,i,r,o,a,s,l,c,u,d;for(null==t&&(t={}),(o=(new DOMParser).parseFromString("","text/html").body).innerHTML=e,a=(c=o.getElementsByTagName("meta")).length;a--;)c[a].remove();for(D(o,["webview","object","embed"]),"client"===STORY_PLATFORM&&t.convertIframeToWebview,a=(u=o.getElementsByTagName("script")).length;a--;)r=(n=u[a]).outerHTML,n.outerHTML="<pre><code>"+_.escape(r)+"</code></pre>";for(s=0,l=(i=o.getElementsByTagName("*")).length;s<l;s++)d=i[s],k(d);return o},c.stripStyles=function(e){var t,n,i,r,o,a;for((i=(new DOMParser).parseFromString("","text/html").body).innerHTML=e,r=(o=i.getElementsByTagName("link")).length;r--;)o[r].remove();for(r=(a=i.getElementsByTagName("style")).length;r--;)n=(t=a[r]).outerHTML,t.outerHTML="<pre><code>"+_.escape(n)+"</code></pre>";return i},c.isMobileDevice=function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)},c.parseBase64Data=function(e){return{type:e.substring(e.indexOf(":")+1,e.indexOf(";")),data:e.substring(e.indexOf(",")+1)}},c.parseQueryString=function(e){var t,n,i;return t=e.indexOf(":"),i="",n=e,t>0&&(i=e.substring(0,t),n=e.substring(t+1)),{tag:i,q:n}},c.dataURL2ObjectURL=function(e){var t;return window.URL&&window.URL.createObjectURL&&(t=c.dataURL2Blob(e))?window.URL.createObjectURL(t):""},c.blobToString=function(e,t){var n;return(n=new FileReader).onload=function(){return t(null,n.result)},n.readAsText(e)},c.base642Blob=function(e,t){var n,i,r,o,a,s,l,c,u,d;for(t=t||"",1024,a=(r=atob(e)).length,d=Math.ceil(a/1024),i=new Array(d),u=0;u<d;){for(n=1024*u,s=Math.min(n+1024,a),o=new Array(s-n),c=n,l=0;c<s;)o[l]=r[c].charCodeAt(0),++l,++c;i[u]=new Uint8Array(o),u++}return new Blob(i,{type:t})},c.base64ToHex=function(e){var t,n,i,r;for(i=atob(e),r="",n=0;n<i.length;)r+=2===(t=i.charCodeAt(n).toString(16)).length?t:"0"+t,n++;return r},c.blob2Base64=function(e,t){var n;return(n=new window.FileReader).onloadend=function(){var e,i;return e=(i=n.result).substr(i.indexOf(",")+1),t(null,e)},n.readAsDataURL(e)},c.blob2Text=function(e,t){var n;return(n=new window.FileReader).onloadend=function(){return t(null,n.result)},n.readAsText(e)},c.blob2DataURL=function(e,t){var n;return(n=new window.FileReader).onloadend=function(){var e;return e=n.result,t(null,e)},n.readAsDataURL(e)},c.dataURL2String=function(e){var t,n,i,r,o,a;if(window.URL&&window.URL.createObjectURL){if(o=e.split(",")[0],i=e.split(",")[1],t="",o.indexOf("base64")>=0){a=function(e){var t,n,i,r;for(t=new ArrayBuffer(e.length),n=new Uint8Array(t),i=0,r=e.length;i<r;)n[i]=e.charCodeAt(i),i++;return t};try{n=a(t=atob(i)),t=new TextDecoder("UTF-8").decode(n)}catch(e){r=e,console.error(r),t=""}}else t=unescape(i);return t}},c.dataURL2Blob=function(e){var t,n,i,r,o,a,s,l,c;if(window.URL&&window.URL.createObjectURL){if(a=e.split(",")[0],i=e.split(",")[1],t="",a.indexOf("base64")>=0)try{t=atob(i)}catch(e){r=e,console.error(r),t=""}else t=unescape(i);for(o=a.split(":")[1].split(";")[0],n=new Uint8Array(t.length),s=l=0,c=t.length;0<=c?l<=c:l>=c;s=0<=c?++l:--l)n[s]=t.charCodeAt(s);return new Blob([n],{type:o})}},c.objectURLToArrayBuffer=function(e,t){var n;if(e)return(n=new XMLHttpRequest).open("GET",e,!0),n.responseType="arraybuffer",n.onload=function(e){return 200===this.status||0===this.status?t(null,this.response,this.getResponseHeader("Content-Type")||"image/png"):t("\u8f6c\u6362\u6587\u4ef6\u51fa\u9519")},n.onerror=function(e){return t(e)},n.send();t("\u6ca1\u6709\u63d0\u4f9b\u94fe\u63a5")},c.objectURLToString=function(e,t){var n;return(n=new XMLHttpRequest).open("GET",e,!0),n.responseType="text",n.onload=function(e){return 200===this.status||0===this.status?t(null,this.response):t("\u8f6c\u6362\u6587\u4ef6\u51fa\u9519")},n.onerror=function(e){return t(e)},n.send()},c.objectURLToBlob=function(e,t){var n;return(n=new XMLHttpRequest).open("GET",e,!0),n.responseType="blob",n.onload=function(e){return 200===this.status||0===this.status?t(null,this.response):t("\u8f6c\u6362\u6587\u4ef6\u51fa\u9519")},n.onerror=function(e){return t(e)},n.send()},c.urlToDataURL=function(e,t){var n;return(n=new XMLHttpRequest).open("GET",e,!0),n.responseType="blob",n.onload=function(e){var n,i;return 200===this.status||0===this.status?(n=this.response,(i=new FileReader).onerror=function(e){return t(e)},i.onload=function(e){var n;return n=e.target.result,t(null,n)},i.readAsDataURL(n)):t("\u8f6c\u6362\u6587\u4ef6\u51fa\u9519")},n.onerror=function(e){return t("error"),console.log("error")},n.ontimeout=function(e){return t("tiemout"),console.log("timeout")},n.onabort=function(e){return t("abort"),console.log("abort")},n.send()},c.stringToArrayBuffer=function(e){return(new TextEncoder).encode(e)},c.arrayBufferToBase64=function(e){var t,n,i,r;for(t="",r=(n=new Uint8Array(e)).byteLength,i=0;i<r;)t+=String.fromCharCode(n[i]),i++;return window.btoa(t)},c.base64ToArrayBuffer=function(e){var t,n,i,r;for(r=(t=window.atob(e)).length,n=new Uint8Array(r),i=0;i<r;)n[i]=t.charCodeAt(i),i++;return n.buffer},c.blobToArrayBuffer=function(e,t){var n;return(n=new FileReader).onerror=function(e){return t(e)},n.onload=function(){var e;return e=this.result,t(null,e)},n.readAsArrayBuffer(e)},c.arrayBufferToNodeBuffer=function(e){var t,n,i,r,o;for(t=new Buffer(e.byteLength),o=new Uint8Array(e),n=i=0,r=t.length;i<r;n=++i)t[n],t[n]=o[n];return t},c.nodeBufferToArrayBuffer=function(e){return new Uint8Array(e).buffer},c.blobToMd5=function(e,t){return c.blobToArrayBuffer(e,(function(e,n){var i,r;return n?((r=new SparkMD5.ArrayBuffer).append(n),i=r.end(),t(null,i)):t(e)}))},c.insertImageFile=function(e,t){var n,i;return i=new FileReader,n=e[0],i.onload=function(e){var i,r;return i=e.target.result,r=n.name,t(i,r,n)},i.readAsDataURL(e[0])},c.insertImageFiles=function(e,t){var n;return n=function(e,t){return c.insertImageFile([e],(function(e,n,i){return t(null,{content:e,fileName:n,file:i})}))},async.mapLimit(e,20,n,(function(e,n){return"function"==typeof t?t(e,n):void 0}))},c.insertImageBlob=function(e,t,n){return setTimeout((function(){var i,r;return i="jpg","image/png"===(r=t.type)&&(i="png"),"image/gif"===r&&(i="gif"),"image/svg+xml"===r&&(i="svg"),e=e||uniqueNumber()+"."+i,n(t,e,e)}),5)},c.validateImageFiles=function(e){var t;return e.length>1?(r.showMessage("\u4e00\u6b21\u53ea\u80fd\u9009\u62e9\u4e00\u4e2a\u6587\u4ef6",4e3,"error"),!1):0===e.length?(r.showMessage("\u8bf7\u9009\u62e9\u4e00\u4e2a\u56fe\u7247\u6587\u4ef6",4e3,"error"),!1):(t=e[0],["image/jpeg","image/png","image/gif","image/svg+xml"].indexOf(t.type)<0?(r.showMessage("\u53ea\u80fd\u4e0a\u4f20jpeg,gif,png, svg\u56fe\u7247",4e3,"error"),!1):!(t.size>52428800)||(r.showMessage("\u6587\u4ef6\u6700\u5927\u9650\u523650M",4e3,"error"),!1))},c.checkIsSupportFileType=function(e){var t,n,i;return i=(e=e.toUpperCase()).lastIndexOf("."),n=e.length-i,i>=0&&n<7?(e.substring(0,i),t=e.substring(i+1)):(e,t=""),"MD"===t||"MARKDOWN"===t||"MKD"===t||"TXT"===t||"TEXT"===t||"HTML"===t||"HTM"===t||""===t||"XHTML"===t},c.isMarkdown=function(e){var t,n;return(n=(e=e.toUpperCase()).lastIndexOf("."))>=0?(e.substring(0,n),t=e.substring(n+1)):(e,t=""),"MD"===t||"MARKDOWN"===t||"MKD"===t||""===t},c.isHTML=function(e){var t,n;return(n=(e=e.toUpperCase()).lastIndexOf("."))>=0?(e.substring(0,n),t=e.substring(n+1)):(e,t=""),"HTML"===t||"HTM"===t||"XHTML"===t},c.importFile=function(e,t){var n,i,o,a,s,l,c;for(s=0,l=e.length;s<l&&(!(o=e[s])||(c=o.type.indexOf("/"),a=o.type.substr(0,c),(i=o.name.lastIndexOf("."))>0&&(n=o.name.substring(i).toUpperCase()),[".MD",".MARKDOWN",".HTML"].indexOf(n)>=0&&(a="text"),[".ZIP"].indexOf(n)>=0&&(a="zip"),"text"!==a&&"image"!==a&&"zip"!==a));s++);return t&&a?t(o,a,e):r.showMessage("\u9519\u8bef\u7684\u6587\u4ef6\u683c\u5f0f",4e3,"error")},c.initdragFilesSupport=function(e,t){if("draggable"in document.createElement("span"))return e.on("dragover",(function(e){return e.preventDefault(),e.stopPropagation()})).on("drop",(function(e){var n,i;if(e.preventDefault(),e.stopPropagation(),(i=e.originalEvent).target&&i.target.files&&(n=i.target.files),n||i.dataTransfer&&i.dataTransfer.files&&(n=i.dataTransfer.files),n&&n.length>0)return t(n,e)}))},c.initFileImportSupport=function(e,t){return e.change((function(e){var n,i;if(i=$(this),n=this.files,i.val())return t(n,e)}))},c.asyncLoad=function(e,t){var n,i;return n=document.createElement("script"),i=document.getElementsByTagName("script")[0],n.async=1,n.src=e,i.parentNode.insertBefore(n,i),n.onload=function(){return n.onload=null,"function"==typeof t?t():void 0}},c.asyncLoadResource=function(e,t){var n,i,r,o,a,s,l;if(o=e.id,r=e.filename,l=e.type,!((n=$("#"+o+"_loading")).length>0))return(n=$("#"+o)).length>0?setTimeout((function(){return t()}),10):"script"!==l?"style"===l?(i=$('<link id="'+o+'_loading" rel="stylesheet">'),$("head").append(i),i.attr("href",r),i.one("load",(function(){return i.attr("id",o),"function"==typeof t?t():void 0}))):setTimeout((function(){return t()}),10):(a=document.createElement("script"),s=document.getElementsByTagName("script")[0],e.module||(a.async=1),a.src=r+"?v="+APP_VERSION,s.parentNode.insertBefore(a,s),$(a).attr("id",o+"_loading"),$(a).one("load",(function(){return $(a).attr("id",o),"function"==typeof t?t():void 0})),e.module?a.setAttribute("type","module"):void 0);n.one("load",(function(){return"function"==typeof t?t():void 0}))},c.asyncLoadResources=function(e,t){return 0===e.length?setTimeout((function(){return t()}),10):async.mapLimit(e,20,c.asyncLoadResource,(function(e,n){return"function"==typeof t?t():void 0}))},c.hasCssString=function(e,t){var n,i;if(n=0,(t=t||document).createStyleSheet&&(i=t.styleSheets)){for(;n<i.length;)if(i[n++].owningElement.id===e)return!0}else if(i=t.getElementsByTagName("style"))for(;n<i.length;)if(i[n++].id===e)return!0;return!1},c.getDocumentHead=function(e){return e||(e=document),e.head||e.getElementsByTagName("head")[0]||e.documentElement},c.importCssString=function(e,t,n,i){var r;return i=i||document,t&&c.hasCssString(t,i)?(!0===n&&$(i).find("#"+t).text(e),null):i.createStyleSheet?((r=i.createStyleSheet()).cssText=e,t?r.owningElement.id=t:void 0):((r=i.createElementNS?i.createElementNS("http://www.w3.org/1999/xhtml","style"):i.createElement("style")).appendChild(i.createTextNode(e)),t&&(r.id=t),c.getDocumentHead(i).appendChild(r))},c.importCssUrl=function(e,t,n,i,r){var o,a,s,l;if(i=i||document,o=$(i),(!(a=o.find("#"+t))||!a.hasClass("link_loading"))&&(!(a.length>0)||n))return a.attr("id",t+"_old"),s=$('<link id="'+t+'" class="link_loading" rel="stylesheet">'),o.find("head").append(s),/^blob:/i.test(e)||(e.indexOf("?")>0?e+="&v="+APP_VERSION:e+="?v="+APP_VERSION),l=setTimeout((function(){return s.remove(),null!=a&&a.attr("id",t),s=null}),3e3),s.one("load",(function(){if(clearTimeout(l),l=null,s)return s.removeClass("link_loading"),null!=a&&a.remove(),"function"==typeof r?r():void 0})),s.attr("href",e)},c.parseCssText=function(e,t){var n,i;i=t;try{i=CSSOM.parse(e).toString()}catch(e){n=e,console.log(n);try{i=CSSOM.parse(t).toString()}catch(e){n=e,console.log(n)}}return i},c.importTextFile=function(e,t,n){var i;if(i=new FileReader,e)return i.onload=function(t){return n(e.name,t.target.result)},i.readAsText(e)},c.parseZipFile=function(e,t,n){var r;return r=function(t){var r,o;if(o=t.files[i.zip.metaFilename])n(null,[e]);else{if(o=t.files[i.zip.batchFilename],r={},!o)return n("\u9519\u8bef\u7684 zip \u6587\u4ef6\u683c\u5f0f");o.async("string").then((function(e){var i,o,a;try{r=JSON.parse(e)}catch(e){return e,void n("\u9519\u8bef\u7684 zip \u6587\u4ef6\u683c\u5f0f")}return"zip"===r.type?(a=[],o=r.files||[],i=function(e,n){var i;return(i=t.files[e.name])?i.async("blob").then((function(t){return a.push(new File([t],e.name)),n()})):n()},void async.mapSeries(o,i,(function(){return n(null,a)}))):n("\u9519\u8bef\u7684 zip \u6587\u4ef6\u683c\u5f0f")})).catch((function(){return n("\u9519\u8bef\u7684 zip \u6587\u4ef6\u683c\u5f0f")}))}},c.asyncLoadResources([{id:"js_zip_js",type:"script",filename:"js/jszip/jszip.js"}],(function(){var t;if(t=new FileReader,name,e)return t.onload=function(e){return(new JSZip).loadAsync(e.target.result).then(r)},t.readAsArrayBuffer(e)}))},c.importZipBuffer=function(e,t,n,r){var o,a,s,l,u,d,p,f;return a=[],o={},u=function(e,t){var n;return"",(n=e.files[i.zip.metaFilename])?n.async("string").then((function(e){var n;try{return n=JSON.parse(e),t(null,n)}catch(e){return t(e)}})).catch((function(e){return t(e)})):t("\u9519\u8bef\u7684 zip \u6587\u4ef6\u683c\u5f0f")},l=function(e,t,n){var i;return(i=e.files[t.main])?i.async("string").then((function(e){return n(null,e)})).catch((function(e){return n(e)})):n("\u6587\u4ef6\u635f\u574f")},s=function(e,t,n,i){var r;return(r=e.files[n.filename])?r.async("string").then((function(e){a.push({name:r.name,type:n.type,blob:new Blob([""],{type:n.type})});try{return t=JSON.parse(e),o[r.name]=t,i()}catch(e){return e,i()}})).catch((function(e){return i(e)})):i("\u6587\u4ef6\u635f\u574f")},d=function(e,t,n,i){var r;return(r=e.files[n.filename])?r.async("base64").then((function(e){var t,o;return o="data:"+n.type+";base64,"+e,t=c.dataURL2Blob(o),a.push({name:r.name,type:n.type,blob:t}),i()})).catch((function(e){return i(e)})):i("\u6587\u4ef6\u635f\u574f")},p=function(e,t,n){var i,r,o;return o=t.version||1,r=t.fileResources,2!==o&&(r=[],$.each(t.imgResources,(function(e,t){return r.push({filename:t,type:"image/png"})}))),i=function(n,i){return/_highlights$/i.test(n.filename)?s(e,t,n,i):d(e,0,n,i)},async.mapLimit(r,10,i,n)},f=function(t){return u(t,(function(n,i){return n?r(n):l(t,i,(function(n,s){return n?r(n):p(t,i,(function(t){var n;return t&&console.error(t),n=moment(i.createDate).valueOf(),r(null,e,s,a,{id:i.id||"",cssText:i.cssText||"",urlMap:i.urlMap||{},fileMap:i.fileMap||{},createDate:n,attachmentMetas:o})}))}))}))},c.asyncLoadResources([{id:"js_zip_js",type:"script",filename:"js/jszip/jszip.js"}],(function(){return(new JSZip).loadAsync(t).then(f)}))},c.importZipLink=function(e,t,n){return fetch(e).then((function(e){return e.arrayBuffer()})).then((function(e){return c.importZipBuffer("\u5c0f\u4e66\u5320.zip",e,t,n)})).catch((function(e){return n(e)}))},c.importZipFile=function(e,t,n){var i;if(i=new FileReader,name,e)return i.onload=function(i){return c.importZipBuffer(e.name,i.target.result,t,n)},i.readAsArrayBuffer(e)},c.exportHtmlFile=function(e,t,n,r,o){var a;return a=i.exportHtmlTemplateFile,r.toc&&(a=i.exportTocHtmlTemplateFile),$.get(a,(function(r,a,s){var l,c;return c=_.template(r)({welcome:i.welcome,title:t,style:n,content:e.html()}),e=null,l=new Blob([c],{type:"text/html;charset=utf-8"}),o(null,l,t+".html")}))},c.exportTemplateFile=function(e,t,n,r,o,a){var s;return s=_.template(e)({welcome:i.welcome,title:n,style:r,content:t,meta:o}),a(null,new Blob([s],{type:"text/html;charset=utf-8"}),n+".html")},c.exportInlineStylesheetHtmlFile=function(e,t,n,r,o){var a;return a=i.exportHtmlTemplateFile,r.toc&&(a=i.exportTocHtmlTemplateFile),c.inlineStylesheet(e.html(),n,(function(n,r){return n?o(n):$.get(a,(function(n,a,s){var l,c;return c=_.template(n)({welcome:i.welcome,title:t,style:"",content:r}),e=null,l=new Blob([c],{type:"text/html;charset=utf-8"}),o(null,l,t+".html")}))}))},c.exportZipFile=function(e,n,r,o,a,s,l){var d,p,f,h,m,v,g,w,y,b,x,k;return k=window.requestFileSystem?new u({method:"filesystem"}):new u({method:"blob"}),p=[],f=[],(h={}).main=n+".md",h.title=a.get("title"),h.version=2,h.cssText=a.get("cssText")||"",h.createDate=a.get("createDate"),h.updateDate=a.get("updateDate"),h.slug=a.get("slug"),h.cover=a.get("cover"),h.excerpt=a.get("excerpt"),h.urlMap=a.get("urlMap")||{},h.fileMap=a.get("fileMap")||{},s.containId&&(h.id=a.id||""),d=t("../models/attachment_model"),w=function(e){return a.getAllAttachObjects((function(t,n){var i,o,s,l,c;return null==n&&(n=[]),l=a.get("urlMap")||{},c=Object.values(l),o=a.get("fileMap")||{},s=Object.values(o),i=function(e,t){var n,i,o,l;if(o=e.key,!(f.indexOf(o)>=0))return r.indexOf(o)>=0||c.indexOf(o)>=0||s.indexOf(o)>=0?(i=e.data,k.addFiles({name:o,type:"blob",blob:i},null,null,null,(function(){return f.push(o),p.push({filename:o,type:i.type}),t()}))):/_highlights$/i.test(o)?(l=a.id+"__"+o,(n=new d({_id:l})).fetch({}).then((function(e){var r;return r={ghostHighlights:n.get("ghostHighlights")||{},highlights:n.get("highlights")||[]},i=new Blob([JSON.stringify(r)],{type:"application/json"}),k.addFiles({name:o,type:"blob",blob:i},null,null,null,(function(){return f.push(o),p.push({filename:o,type:i.type}),t()}))})).catch((function(e){return t()}))):t();t()},async.mapLimit(n,20,i,(function(){return e()}))}))},b=(g=function(e){return function(t){var n;return n=function(e,t){var n,i;return i=e.fileName,n=e.content,k.addFiles({name:i,type:"text",content:n},null,null,null,(function(){return t()}))},async.mapSeries(e,n,(function(e,n){return t()}))}})([{fileName:"readme.md",content:"\u6b22\u8fce\u4f7f\u7528[\u5c0f\u4e66\u5320\u7f16\u8f91\u5668](https://markdown.xiaoshujiang.com)"},{fileName:n+".md",content:r}]),y=function(t){var n;return n=function(e,t){var n,i,r,o,a;return n=$(e),o=n.attr("name"),n.attr("name")&&0===(a=n.attr("src")).indexOf("data:image")?(i=a,r=c.parseBase64Data(i),void k.addFiles({name:o,type:"base64",data:a},null,null,null,(function(){return n.attr("src",o),f.push(o),p.push({filename:o,type:r.type}),t()}))):t()},async.mapSeries(e.find("img").toArray(),n,(function(e,n){return t()}))},x=function(t){var n;return n=function(e,t){var n,i,r,o,a;return n=$(e),o=n.attr("name"),n.attr("name")&&"data:"!==(a=n.attr("src"))&&0===a.indexOf("data:")?(i=a,r=c.parseBase64Data(i),void k.addFiles({name:o,type:"base64",data:a},null,null,null,(function(){return n.attr("src",o),f.push(o),p.push({filename:o,type:r.type}),t()}))):t()},async.mapSeries(e.find("video").toArray(),n,(function(e,n){return t()}))},v=function(t){var n;return n=function(e,t){var n,i,r,o,a;return n=$(e),o=n.attr("name"),n.attr("name")&&"data:"!==(a=n.attr("src"))&&0===a.indexOf("data:")?(i=a,r=c.parseBase64Data(i),void k.addFiles({name:o,type:"base64",data:a},null,null,null,(function(){return n.attr("src",o),f.push(o),p.push({filename:o,type:r.type}),t()}))):t()},async.mapSeries(e.find("audio").toArray(),n,(function(e,n){return t()}))},m=function(t){var n;return n=function(e,t){var n,i,r,o,a;return n=$(e),o=n.attr("name"),n.attr("name")&&"data:"!==(a=n.attr("href"))&&0===a.indexOf("data:")?(i=a,r=c.parseBase64Data(i),void k.addFiles({name:o,type:"base64",data:a},null,null,null,(function(){return n.attr("href",o),f.push(o),p.push({filename:o,type:r.type}),t()}))):t()},async.mapSeries(e.find("a.attachment").toArray(),n,(function(e,n){return t()}))},h.fileResources=p,async.waterfall([b,y,x,v,m,w],(function(t,r){return $.get(i.exportHtmlTemplateFile,(function(t,r,a){var s;return s=_.template(t)({welcome:i.welcome,title:n,style:o,content:e.html()}),g([{fileName:n+".html",content:s},{fileName:"xiaoshujiang.json",content:JSON.stringify(h,null,2)}])((function(){return k.getBlob((function(t){return e=null,l(null,t,n+".xsj.zip")}))}))}))}))},c.exportPresetationFile=function(e,t,n,r,o){var a,s,l,d,p,f,h,m,v;return v=window.requestFileSystem?new u({method:"filesystem"}):new u({method:"blob"}),a=[],(s={}).main=t+".md",s.title=t,s.version=2,h=(p=function(e){return function(t){var n;return n=function(e,t){var n,i;return i=e.fileName,n=e.content,v.addFiles({name:i,type:"text",content:n},null,null,null,(function(){return t()}))},async.mapSeries(e,n,(function(e,n){return t()}))}})([{fileName:"readme.md",content:"\u6b22\u8fce\u4f7f\u7528[\u5c0f\u4e66\u5320](https://markdown.xiaoshujiang.com)\uff0c\u5c0f\u4e66\u5320\u662f\u4e00\u6b3e\u672c\u5730\u4f18\u5148\uff0c\u53bb\u4e2d\u5fc3\u5316\uff0c\u5206\u5e03\u5f0f\uff0c\u652f\u6301\u9009\u62e9\u6027\u540c\u6b65\u7684\u5168\u5e73\u53f0\u8986\u76d6\u77e5\u8bc6\u7ba1\u7406\u7b14\u8bb0\u8f6f\u4ef6\u3002"},{fileName:t+".md",content:n}]),f=function(t){var n;return n=function(e,t){var n,i,r,o,s;return n=$(e),o=n.attr("name"),n.attr("name")&&0===(s=n.attr("src")).indexOf("data:image")?(i=s,r=c.parseBase64Data(i),void v.addFiles({name:o,type:"base64",data:s},null,null,null,(function(){return n.attr("src",o),a.push({filename:o,type:r.type}),t()}))):t()},async.mapSeries(e.find("img").toArray(),n,(function(e,n){return t()}))},m=function(t){var n;return n=function(e){var n,i,r,o,s;return n=$(e),o=n.attr("name"),n.attr("name")&&"data:"!==(s=n.attr("src"))&&0===s.indexOf("data:")?(i=s,r=c.parseBase64Data(i),void v.addFiles({name:o,type:"base64",data:s},null,null,null,(function(){return n.attr("src",o),a.push({filename:o,type:r.type}),t()}))):t()},async.mapSeries(e.find("video").toArray(),n,(function(e,n){return t()}))},d=function(t){var n;return n=function(e,t){var n,i,r,o,s;return n=$(e),o=n.attr("name"),n.attr("name")&&"data:"!==(s=n.attr("src"))&&0===s.indexOf("data:")?(i=s,r=c.parseBase64Data(i),void v.addFiles({name:o,type:"base64",data:s},null,null,null,(function(){return n.attr("src",o),a.push({filename:o,type:r.type}),t()}))):t()},async.mapSeries(e.find("audio").toArray(),n,(function(e,n){return t()}))},l=function(t){var n;return n=function(e,t){var n,i,r,o,s;return n=$(e),o=n.attr("name"),n.attr("name")&&"data:"!==(s=n.attr("href"))&&0===s.indexOf("data:")?(i=s,r=c.parseBase64Data(i),void v.addFiles({name:o,type:"base64",data:s},null,null,null,(function(){return n.attr("href",o),a.push({filename:o,type:r.type}),t()}))):t()},async.mapSeries(e.find("a.attachment").toArray(),n,(function(e,n){return t()}))},s.fileResources=a,async.waterfall([h,f,m,d,l],(function(n,a){return $.get(i.exportPresetationTemplateFile,(function(n,a,l){var c,u,d;return d=_.template(n)({welcome:i.welcome,title:t,style:r,content:e.find(">.preview").html()}),e=null,c=p([{fileName:t+".html",content:d},{fileName:"xiaoshujiang.json",content:JSON.stringify(s)}]),u=function(e){var t;return t=function(e,t){return $.get(e,(function(n,i,r){return v.addFiles({name:e,type:"text",content:n},null,null,null,(function(){return t()}))}))},async.mapSeries(["js/reveal.js","js/classList.js","css/reveal/reveal.css","css/reveal/theme/white.css"],t,(function(t,n){return e()}))},async.waterfall([c,u],(function(e,n){return v.getBlob((function(e){return o(null,e,t+".xsj.zip")}))}))}))}))},b={},x="",c.getMetaData=function(e){var t,n,i;if(e===x)return b;if((n=/^---\s*\n([\s\S]+?)\n---\s*\n*/.exec(e))&&x===n[1])return b;if(i={},n&&n[1]){x=n[1];try{(i=jsyaml.load(n[1]))instanceof Object||(i={},x=""),i instanceof Array&&(i={},x="")}catch(e){t=e,console.log(t),x=""}}else x="";return b=i},c.setMetaData=function(e,t,n,i,r){var o,a,s,l;return r=r||{},"string"==typeof n&&n&&(n=$.trim(jsyaml.dump(n,{lineWidth:-1,forceQuotes:r.forceQuotes||!1}))),(a=/^---\s*\n([\s\S]+?)\n---\s*\n+/.exec(e))?(s=e.substring(a[0].length),l=a[0],(o=new RegExp("^"+t+":.*\n","m")).test(l)?l=void 0===n||""===n?l.replace(o,""):l.replace(o,t+": "+n+"\n"):i||void 0!==n&&""!==n&&(l=l.replace(/\n---/,"\n"+t+": "+n+"\n---")),$.trim(l).split("\n").length<=2&&(l=""),e=l+s):i||void 0!==n&&""!==n&&(e="---\n"+t+": "+n+"\n---\n"+e),e},c.getCssMetaData=function(e){var t,n,i;if(i=null,n=/^\/\*{2,}xsjCSSMeta\s*\n([\s\S]+?)\nxsjCSSMeta\*{2,}\/\s*\n+/.exec(e+"\n"))try{(i=jsyaml.load(n[1]))instanceof Object||(i=null),i instanceof Array&&(i=null)}catch(e){t=e,console.log(t)}return i},c.setCssMetaData=function(e,t,n){var i,r,o,a,s;return(s=/^\/\*{2,}xsjCSSMeta\s*\n([\s\S]+?)\nxsjCSSMeta\*{2,}\/\s*\n+/.exec(o=e))?(i=o.substring(s[0].length),r=s[0],(a=new RegExp("^"+t+":.*\n","m")).test(r)?r=void 0===n?r.replace(a,""):r.replace(a,t+": "+n+"\n"):void 0!==n&&(r=r.replace(/xsjCSSMeta\*{2,}\//,t+": "+n+"\nxsjCSSMeta**/")),$.trim(r).split("\n").length<=2&&(r=""),o=r+i):void 0!==n&&(o="/**xsjCSSMeta\n"+t+": "+n+"\nxsjCSSMeta**/\n"+o),o},c.validateUrlPath=function(e){var t;if(!$.trim(e))return{result:"error",msg:"url\u5730\u5740\u4e3a\u7a7a"};if("/"===$.trim(e))return{result:"error",msg:"url\u5730\u5740\u4e3a\u7a7a /"};if("data:"===$.trim(e))return{result:"error",msg:"url\u5730\u5740\u4e3a\u7a7a /"};if(0===e.indexOf("data:")||/^http(s)?:\/\//i.test(e)||0===e.indexOf("blob:")||/^chrome-extension:\/\//i.test(e))return{result:"normal"};if(e.indexOf("../")>=0)return{result:"error",msg:"\u975e\u6cd5\u7684url\u5730\u5740,url\u5730\u5740\u4e0d\u80fd\u5305\u542b ../"};if(0===e.indexOf("//"))return{result:"normal"};if(e.indexOf(":")>=0)return{result:"normal"};if(0===e.indexOf("./")){if(t=e.substring(2),!$.trim(t))return{result:"error",msg:"url\u5730\u5740\u4e3a\u7a7a ./"};if(t.indexOf("./")>=0)return{result:"error",msg:"url\u5730\u5740\u4e0d\u80fd\u5305\u542b\u591a\u4e2a ./"}}return{result:"xsjurl"}},c.getLinkInfo=function(e,t){var n,i,r,o,a;return i=c.isHTML(e),r=c.isMarkdown(e),a=[],r&&(n={html:!0,xhtmlOut:!0,breaks:!0,langPrefix:"language-",linkify:!0,typographer:!0,_highlight:!0,_strict:!1,_view:"html",noRemoteResource:!0},(o=window.markdownit(n)).use(window.markdownitWikilink),o.renderer.rules.link_open=function(e,t,n,i,r){var o,a,s,l;return l=e[t],(a=e[t-1])&&"text"===a.type&&(o=(s=a.content||"").substring(s.length-1),["=","%","~"].indexOf(o)>=0&&l.attrJoin("class","attachment")),r.renderToken(e,t,n,i,r)},t=o.render(t),i=!0),i&&t.replace(/<\s*a[^>]*>(.*?)<\s*\/\s*a>/gi,(function(e,t){var n,i,r,o,s,l,c,u,d,p;if(t=t.replace(/<[^>]+>/g,""),l=/( href="([^"]*)")|( href='([^']*)')/i,p=/( title="([^"]*)")|( title='([^']*)')/i,i=/( class="([^"]*)")|( class='([^']*)')/i,s="",d="",n="",c=e.match(l)){s=c[2]||c[4];try{s=decodeURI(s)}catch(e){r=e,console.log(r)}}if((c=e.match(p))&&(d=c[2]||c[4]),(c=e.match(i))&&(n=c[2]||c[4]),!(n&&n.indexOf("attachment")>=0||/(^data:)|(^blob:)|(^file:)|(^chrome-extension:)|(^#)/i.test(s)))return/^xsjapp:\/\/doc\//i.test(s)&&(s=s.substring(13)),o="",(u=s.lastIndexOf("#"))>0&&(o=s.substring(u+1),s=s.substring(0,u)),s?(s=s.replace(/^[\.\/]*|\/*$/g,""),a.push({link:s,hashTag:o,title:d,text:t})):void 0})),a},c.getResourceData=function(e,t,n){var i,r,o,u,d,p,f;return o=c.isHTML(e),u=c.isMarkdown(e),p=[],u&&(r={html:!0,xhtmlOut:!0,breaks:!0,langPrefix:"language-",linkify:!0,typographer:!0,_highlight:!0,_strict:!1,_view:"html",noRemoteResource:!0},(d=window.markdownit(r)).use(l),d.use(s),d.use(a),t=d.render(t),o=!0),o&&(i=function(e,t,n,i){var r,o,a;if("xsjurl"===!c.validateUrlPath(n).result)return t+n+i;if(0===n.indexOf("./")){r=a=n.substring(2);try{r=decodeURI(a)}catch(e){o=e,console.log(o)}return p.push(r),t+n+i}r=n;try{r=decodeURI(n)}catch(e){o=e,console.log(o)}return p.push(r),t+n+i},t.replace(/(<img [^>]*src=['"])([^'"]+)([^>]*>)/gi,i),t.replace(/(<video [^>]*src=['"])([^'"]+)([^>]*>)/gi,i),t.replace(/(<audio [^>]*src=['"])([^'"]+)([^>]*>)/gi,i),t.replace(/(<a class='attachment' [^>]*href=['"])([^'"]+)([^>]*>)/gi,i),f=Array.from(new Set(p))),n(null,f)},c.tidyHtml=function(e){var t;return window.html_beautify?((t=$("<div></div>").html(e)).find("meta").remove(),t.find("*").removeAttr("style"),e=t.html(),e=html_beautify(e,{indent_inner_html:!1,indent_size:2,indent_char:" ",wrap_line_length:78,brace_style:"expand",unformatted:["a","sub","sup","b","i","u"],preserve_newlines:!0,max_preserve_newlines:5,indent_handlebars:!1}),e=$.trim(e)):e},c.html2markdown=function(e){var t,n,i;(t=$("<div></div>")).html(e),t.find("a").map((function(e,t){var n;if(n=$(t),!$.trim(n.html()))return n.remove()})),t.find("table").map((function(e,t){var n,i,r;if(0===(i=(n=$(t)).find("thead")).length&&(r=n.find("tr")).length>0)return(i=$("<thead></thead>")).append(r.first()),n.prepend(i)})),e=t.html(),n=xsjHtmlClean(e,{replaceStyles:[],allowedTags:["a","abbr","acronym","address","area","b","bdo","big","blockquote","br","caption","center","cite","code","col","colgroup","dd","del","dfn","dl","dt","em","h1","h2","h3","h4","h5","h6","hr","i","img","ins","kbd","li","map","ol","p","pre","q","s","samp","small","strike","strong","sub","sup","table","tbody","td","tfoot","th","thead","tr","tt","u","ul"],allowedAttributes:[["title"],["id"],["class"],["alt"],["src"],["href"],["a"],["start"],["name",["a"]]],removeTags:["basefont","dir","font","frame","frameset","iframe","isindex","menu","noframes"]});try{n=toMarkdown(n,{gfm:!0,converters:[{filter:function(e){return"PRE"===e.nodeName&&"prettyprint"===e.className},replacement:function(e,t){return"\n\n```\n"+t.textContent+"\n```\n\n"}},{filter:"sup",replacement:function(e){return"^"+e+"^"}},{filter:"sub",replacement:function(e){return"~"+e+"~"}},{filter:function(e){return"MARK"===e.nodeName||"SPAN"===e.nodeName&&"mark"===e.getAttribute("class")},replacement:function(e){return"=="+e+"=="}},{filter:function(e){return"A"===e.nodeName&&e.getAttribute("href")},replacement:function(e,t){var n,i;return i=t.getAttribute("href"),n=t.title?' "'+t.title+'"':"",e===i?"<"+i+">":i.match("mailto:"+e)?"<"+e+">":"["+e+"]("+i+n+")"}},{filter:"dl",replacement:function(e){return e}},{filter:"dt",replacement:function(e){return"\n\n"+e}},{filter:"dd",replacement:function(e){return"\n: "+e}}]})}catch(t){t,console.error("html2markdown fail, use remarked"),i={link_list:!1,h1_setext:!0,h2_setext:!0,h_atx_suf:!1,gfm_code:!1,li_bullet:"*",hr_char:"-",indnt_str:"    ",bold_char:"*",emph_char:"_",gfm_del:!0,gfm_tbls:!0,tbl_edges:!1,hash_lnks:!1,br_only:!1};try{n=new remarked(i).render(n)}catch(t){t,console.error("remarked fail, use orign content"),n=e}}return n},c.getGrammarHelpFile=function(e){return $.get("doc/grammar.md",(function(t,n,i){var r;return r=t,imgToDataURL("img/jianzhu.jpg",(function(t,n){var i;return t?e("\u521b\u5efa\u5931\u8d25"):(i=[{blob:c.dataURL2Blob(n),type:"image/jpg",name:"jianzhu.jpg"}],e(null,"\u5c0f\u4e66\u5320\u8bed\u6cd5\u624b\u518c",r,i))}))})).fail((function(t){return e("\u521b\u5efa\u5931\u8d25")}))},c.getUseHelpFile=function(e){return $.get("doc/use.md",(function(t,n,i){var r;return r=t,imgToDataURL("img/jianzhu.jpg",(function(t,n){var i;return t?e("\u521b\u5efa\u5931\u8d25"):(i=[{blob:c.dataURL2Blob(n),type:"image/jpg",name:"jianzhu.jpg"}],e(null,"\u5c0f\u4e66\u5320\u4f7f\u7528\u624b\u518c",r,i))}))})).fail((function(t){return e("\u521b\u5efa\u5931\u8d25")}))},c.getUpdateHelpFile=function(e){return $.get("doc/update.md",(function(t,n,i){return e(null,"\u5c0f\u4e66\u5320\u66f4\u65b0\u8bf4\u660e",t,[])})).fail((function(t){return e("\u521b\u5efa\u5931\u8d25")}))},c.getPptHelpFile=function(e){return $.get("doc/ppt.md",(function(t,n,i){return e(null,"\u5c0f\u4e66\u5320ppt\u4f7f\u7528\u8bf4\u660e",t,[])})).fail((function(t){return e("\u521b\u5efa\u5931\u8d25")}))},c.findOffsets=function(e,t){var n,i,r,o,a,s;if(r=[],!t.length)return r;for(i=t.shift(),a=document.createTreeWalker(e,4,null,!1),o="",s=0;a.nextNode();){for(n=s+(o=a.currentNode.nodeValue||"").length;n>i;){if(r.push({container:a.currentNode,offsetInContainer:i-s,offset:i}),!t.length)return r;i=t.shift()}s=n}for(;i;)r.push({container:a.currentNode,offsetInContainer:o.length,offset:i}),i=t.shift();return r},c.publicEmailFile=function(e,t,n){var r,o;return null==t&&(t={}),t.html=e,o="/publicemailfile","client"===STORY_PLATFORM&&(!!t.useMailServerConfig||(o=i.host+o)),r={type:"POST",dataType:"json",url:o,data:t,success:function(e,t,i){return e.code?n(JSON.stringify(e)):n()},error:function(e,t){return n(t)}},$.ajax(r)},v=function(e,t){var n;return n=[],e.find("img").map((function(e,t){var i;if(0===t.src.indexOf("data:image/svg"))return i=$.Deferred(),domtoimage.toPng(t).then((function(e){return t.src=e,i.resolve()})).catch((function(e){return i.resolve(),console.err(e)})),n.push(i.promise())})),$.when.apply(null,n).done((function(){return t()}))},c.exportDocxFile=function(e,t,n,o,a,s,l){return v(n,(function(){return $.get(i.exportHtmlTemplateFile,(function(u,d,p){var f,h,m,v;return _.template(u),n.find(".attachment").remove(),(f=n.find(".story_tags")).find(".tag").each((function(e,t){var n;if(t.nextElementSibling)return n=document.createTextNode(",  "),f[0].insertBefore(n,t.nextElementSibling)})),m={},h=function(e,t){var n,i,o;return n=$(e),0===(o=e.src||"").indexOf("data:")?(i=c.dataURL2Blob(o),c.blobToMd5(i,(function(o,a){var s;return a&&(m[a]=i,s=n.attr("name")||n.data("src"),i.size/1024/1024>30?(r.showMessage("\u6587\u4ef6("+s+") \u592a\u5927 ("+filesize(i.size)+"), \u8d85\u8fc7\u670d\u52a1\u5668 30M \u6700\u5927\u9650\u5236, \u7cfb\u7edf\u5c06\u5ffd\u7565\u8be5\u6587\u4ef6",6e3,"error"),e.src=""):(e.src="https://markdown.xiaoshujiang.com/img/spinner.gif",n.attr("data-export-file-md5",a),n.attr("data-export-file",!0))),t()}))):t()},v=function(r,c){var d;if(null==r&&(r="0"),null==c&&(c=0),!(c>10))return 1,u={fragment:n.html(),access_token:t,user:e,title:o,style:a,config:JSON.stringify(s),resourceMD5s:Object.keys(m),ignoreResource:r,resourceCacheVersion:1},d=i.exportHost+"/vipexportdocxfile",$.ajax({url:d,type:"POST",data:u,success:function(r,o,a){var s,u,p;return r?r.uuid?(s=i.exportHost+"/getfile?uuid="+r.uuid,l(null,r,s)):r.resourceIds&&r.resourceIds.length>0?(p=function(n,r){var o,a,s;return o=m[n],a=new FormData,s=new File([o],n),a.append("resourcefile",s),a.append("md5",n),a.append("access_token",t),a.append("user_id",e.id||""),a.append("resource_cache_version",1),d=i.exportHost+"/uploadresource",o?$.ajax({url:d,type:"POST",data:a,processData:!1,contentType:!1,success:function(e,t,n){return r()},error:function(e,t){return r()}}):r()},u=function(){return v("1",++c),n=null},async.mapSeries(r.resourceIds,p,u)):l(JSON.stringify(r)):l(JSON.stringify(r))},error:function(e,t){return l(t)}});l("\u4e0a\u4f20\u5931\u8d25, \u7cfb\u7edf\u5185\u90e8\u51fa\u9519,\u8d85\u8fc7\u6700\u5927\u4e0a\u4f20\u6b21\u6570\u9650\u5236, \u8bf7\u4e0e\u7ba1\u7406\u5458\u8054\u7cfb")},async.mapLimit(n.find("img").toArray(),20,h,(function(){return v("0",0)}))}))}))},c.exportPdfFile=function(e,t,n,o,a,s){var l,u,d,p,f;return t.find(".attachment, video, audio").remove(),t.find("img").map((function(e,t){var n,i,r,o,a,s,l,u,d,p,f,h,m,v,g;if(g=(i=$(t)).attr("width"),u=i.attr("height"),t.naturalWidth||i.width(),t.naturalHeight||i.height(),s=i.width(),a=i.height(),o=g||s,r=u||a,0===(h=t.src).indexOf("data:image/svg"))return p='<!DOCTYPE html>\n<html lang="en">\n  <head>\n    <meta charset="UTF-8">\n    <style>\n    html, body{\n      margin: 0;\n      padding: 0;\n      overflow: hidden;\n    }\n    body>svg{\n      width: '+o+"px!important;\n      height: "+r+"px!important;\n    }\n    </style>\n  </head>\n  <body>\n  "+c.dataURL2String(h)+"\n  </body>\n</html>",v=c.stringToArrayBuffer(p),f="data:text/html;base64,"+c.arrayBufferToBase64(v),m=i.attr("style"),l=i.attr("class"),d=i.attr("id"),(n=$("<iframe src='"+f+"'></iframe")).attr("width",o),n.attr("height",r),m&&n.attr("style",m),l&&n.attr("class",l),d&&n.attr("id",d),n.css({border:"0",overflow:"hidden",width:s,height:a,display:"inline-block"}),i.replaceWith(n)})),p={},a.coverImage&&a.coverImageMD5&&(l=c.dataURL2Blob(a.coverImage),u=a.coverImage.split(";")[0],a.coverImage="",l.size/1024/1024>30?(r.showMessage("\u5c01\u9762\u6587\u4ef6\u592a\u5927 ("+filesize(l.size)+"), \u8d85\u8fc7\u670d\u52a1\u5668 30M \u6700\u5927\u9650\u5236, \u7cfb\u7edf\u5c06\u5ffd\u7565\u8be5\u6587\u4ef6",6e3,"error"),a.coverImageMD5=""):(a.coverImageForMD5Prefix=u,p[a.coverImageMD5]=l)),d=function(e,t){var n,i,o;return n=$(e),0===(o=e.src||"").indexOf("data:")?(i=c.dataURL2Blob(o),c.blobToMd5(i,(function(o,a){var s;return a&&(p[a]=i,s=n.attr("name")||n.data("src"),i.size/1024/1024>30?(r.showMessage("\u6587\u4ef6("+s+") \u592a\u5927 ("+filesize(i.size)+"), \u8d85\u8fc7\u670d\u52a1\u5668 30M \u6700\u5927\u9650\u5236, \u7cfb\u7edf\u5c06\u5ffd\u7565\u8be5\u6587\u4ef6",6e3,"error"),e.src=""):(e.src="https://markdown.xiaoshujiang.com/img/spinner.gif",n.attr("data-export-pdf-md5",a),n.attr("data-export-pdf",!0))),t()}))):t()},f=function(r,c){var u,d;if(null==r&&(r="0"),null==c&&(c=0),!(c>10))return 1,u={fragment:t.html(),style:o,access_token:e,title:n,config:JSON.stringify(a),resourceMD5s:Object.keys(p),ignoreResource:r,resourceCacheVersion:1},d="/vipexportpdffile",d=i.exportPdfHost+d,$.ajax({url:d,type:"POST",data:u,success:function(n,r,o){var a,u,h;return n?n.uuid?(a="/getpdffile?uuid="+n.uuid,a=i.exportPdfHost+a,s(null,n,a)):n.resourceIds&&n.resourceIds.length>0?(h=function(t,n){var r,o;return l=p[t],r=new FormData,o=new File([l],t),r.append("resourcefile",o),r.append("md5",t),r.append("access_token",e),r.append("resource_cache_version",1),d="/uploadresource",d=i.exportPdfHost+d,l?$.ajax({url:d,type:"POST",data:r,processData:!1,contentType:!1,success:function(e,t,i){return n()},error:function(e,t){return n()}}):n()},u=function(){return f("1",++c),t=null},async.mapSeries(n.resourceIds,h,u)):s(JSON.stringify(n)):s(JSON.stringify(n))},error:function(e,t){return s(t)}});s("\u4e0a\u4f20\u5931\u8d25, \u7cfb\u7edf\u5185\u90e8\u51fa\u9519,\u8d85\u8fc7\u6700\u5927\u4e0a\u4f20\u6b21\u6570\u9650\u5236, \u8bf7\u4e0e\u7ba1\u7406\u5458\u8054\u7cfb")},async.mapLimit(t.find("img").toArray(),20,d,(function(){return f("0",0)}))},c.compilePdfFile=function(e,t,n,r){return $.get(i.exportPdfTemplateFile,(function(o,a,s){var l,c;return c=_.template(o),e.find(".attachment").remove(),l={type:"POST",dataType:"json",url:"/compilepdffile",data:o={html:c({welcome:i.welcome,title:t,style:n,content:e.html()}),title:t},success:function(e,t,n){return r(null,e)},error:function(e,t){return r(t)}},e=null,$.ajax(l)}))},f=function(e,t,n){var i,r;return i={type:"GET",dataType:"json",url:"/getcrossorigindomainresource",data:{t:r=e},success:function(e,t,i){var r;return(r=e.data)?n(null,r):n("\u56fe\u7247\u65e0\u6cd5\u6293\u53d6",null)},error:function(e,t){return n("\u8f6c\u6362\u56fe\u7247"+r+"\u5931\u8d25",null)}},$.ajax(i)},DOCKER_VERSION&&(f=function(e,t,n){return fetch(document.location.origin+"/getcross/"+e).then((function(e){return e.blob()})).then((function(e){return c.blob2DataURL(e,(function(e,t){return n(e,t)}))})).catch((function(i){return t?f(encodeURI(e),!1,n):n("\u56fe\u7247\u6293\u53d6\u5931\u8d25"+i)}))}),h=function(e,t){return c.urlToDataURL(e,(function(n,i){return!n&&i?t(null,i):f(e,!1,t)}))},c.getCrossOrignDomainResource=function(e,t){return h(e,(function(n,i){return n?h(_.unescape(e),t):t(n,i)}))},m=function(e,t){var n;return n={type:"POST",dataType:"json",url:"/inlinestylesheet",data:e,success:function(e,n,i){var r;return(r=e.data)?t(null,r):t("\u5904\u7406\u6587\u4ef6\u6837\u5f0f\u5173\u8054\u5931\u8d25",null)},error:function(e,n){return t("\u5904\u7406\u6587\u4ef6\u6837\u5f0f\u5173\u8054\u5931\u8d25",null)}},$.ajax(n)},c.inlineStylesheet=function(e,t,n){var i,o,a,s;return o={},a=0,s=function(e,t,n,i){return 0===(n=n||"").indexOf("data:")?(a++,o[a]=n,t+"xsj_internal://"+a+i):t+n+i},i=(i=(i=(i=(i=e.replace(/(<img[^>]*\ssrc=['"])([^'"]+)([^>]*>)/gi,s)).replace(/(<video[^>]*\ssrc=['"])([^'"]+)([^>]*>)/gi,s)).replace(/(<source[^>]*\ssrc=['"])([^'"]+)([^>]*>)/gi,s)).replace(/(<audio[^>]*\ssrc=['"])([^'"]+)([^>]*>)/gi,s)).replace(/(<a[^>]*\shref=['"])([^'"]+)([^>]*>)/gi,s),m({htmlContent:i,stylesheet:t},(function(e,t){var i,a;return e?(r.showMessage("\u5904\u7406\u6587\u4ef6\u6837\u5f0f\u5173\u8054\u5931\u8d25",3e3,"error"),n("\u5904\u7406\u6587\u4ef6\u6837\u5f0f\u5173\u8054\u5931\u8d25",null)):(a=function(e,t,n,i){return 0===(n=n||"").indexOf("xsj_internal://")?t+o[n.substring("xsj_internal://".length)]+i:t+n+i},i=(i=(i=(i=(i=t.replace(/(<img[^>]*\ssrc=['"])([^'"]+)([^>]*>)/gi,a)).replace(/(<video[^>]*\ssrc=['"])([^'"]+)([^>]*>)/gi,a)).replace(/(<source[^>]*\ssrc=['"])([^'"]+)([^>]*>)/gi,a)).replace(/(<audio[^>]*\ssrc=['"])([^'"]+)([^>]*>)/gi,a)).replace(/(<a[^>]*\shref=['"])([^'"]+)([^>]*>)/gi,a),o={},n(null,i))}))},c.pptToken=function(e,t,n,o,a,s){var l,c,u;return c={title:e,htmlContent:t,stylesheet:n,secret:o,socketId:a},u="/ppttoken",l={type:"POST",dataType:"json",url:u=i.host+u,data:c,success:function(e,t,n){return o=e.secret,a=e.socketId,o&&a?s(null,o,a,e.url):(r.showMessage("\u751f\u6210\u6587\u4ef6\u5931\u8d25",3e3,"error"),s("\u751f\u6210\u6587\u4ef6\u5931\u8d25",null))},error:function(e,t){return r.showMessage("\u751f\u6210\u6587\u4ef6\u5931\u8d25",3e3,"error"),s("\u751f\u6210\u6587\u4ef6\u5931\u8d25",null)}},$.ajax(l)},c.pptStop=function(e,t,n){var o,a,s;return a={secret:e,socketId:t},s="/pptstop",o={type:"POST",dataType:"json",url:s=i.host+s,data:a,success:function(e,t,i){return n(null)},error:function(e,t){return r.showMessage("\u505c\u6b62\u5931\u8d25",3e3,"error"),n("\u505c\u6b62\u5931\u8d25",null)}},$.ajax(o)},y={"audio/midi":["mid","midi","kar","rmi"],"audio/mp4":["mp4a","m4a"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx"],"audio/webm":["weba"],"audio/x-matroska":["mka"],"audio/x-mpegurl":["m3u"],"audio/wav":["wav"],"video/3gpp":["3gp"],"video/3gpp2":["3g2"],"video/mp4":["mp4","mp4v","mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/webm":["webm"],"video/x-f4v":["f4v"],"video/x-fli":["fli"],"video/x-flv":["flv"],"video/x-m4v":["m4v"],"video/x-matroska":["mkv","mk3d","mks"],"image/bmp":["bmp"],"image/cgm":["cgm"],"image/g3fax":["g3"],"image/gif":["gif"],"image/ief":["ief"],"image/jpeg":["jpeg","jpg","jpe"],"image/ktx":["ktx"],"image/png":["png"],"image/prs.btif":["btif"],"image/sgi":["sgi"],"image/svg+xml":["svg","svgz"],"image/tiff":["tiff","tif"],"image/vnd.adobe.photoshop":["psd"],"image/vnd.dece.graphic":["uvi","uvvi","uvg","uvvg"],"image/vnd.djvu":["djvu","djv"],"image/vnd.dvb.subtitle":["sub"],"image/vnd.dwg":["dwg"],"image/vnd.dxf":["dxf"],"image/vnd.fastbidsheet":["fbs"],"image/vnd.fpx":["fpx"],"image/vnd.fst":["fst"],"image/vnd.fujixerox.edmics-mmr":["mmr"],"image/vnd.fujixerox.edmics-rlc":["rlc"],"image/vnd.ms-modi":["mdi"],"image/vnd.ms-photo":["wdp"],"image/vnd.net-fpx":["npx"],"image/vnd.wap.wbmp":["wbmp"],"image/vnd.xiff":["xif"],"image/webp":["webp"],"image/x-3ds":["3ds"],"image/x-cmu-raster":["ras"],"image/x-cmx":["cmx"],"image/x-freehand":["fh","fhc","fh4","fh5","fh7"],"image/x-icon":["ico"],"image/x-mrsid-image":["sid"],"image/x-pcx":["pcx"],"image/x-pict":["pic","pct"],"image/x-portable-anymap":["pnm"],"image/x-portable-bitmap":["pbm"],"image/x-portable-graymap":["pgm"],"image/x-portable-pixmap":["ppm"],"image/x-rgb":["rgb"],"image/x-tga":["tga"],"image/x-xbitmap":["xbm"],"image/x-xpixmap":["xpm"],"image/x-xwindowdump":["xwd"]},w={},Object.keys(y).forEach((function(e){return y[e].forEach((function(t){return w[t]=e}))})),c.mimeLookup=function(e){var t;return(t=e.lastIndexOf("."))>=0&&(e=e.substring(t+1)),w[e.toLowerCase()]},c.generateMarkdownFilename=function(e){var t,n;if(e)return t="",(n=e.lastIndexOf("."))>=0&&(t=e.substring(n+1)),t&&/md|markdown|mkd/gi.test(t)?e:e+".md"},c.generateMarkdownTitle=function(e){var t,n;if(e)return t=e.lastIndexOf("."),"",n=e,t>0?(e.substring(t+1),n=e.substring(0,t)):0===t&&(n="\u65b0\u521b\u5efa\u7684\u6587\u4ef6"),n},c.xsjDimmer=function(e,t){var n;return null==t&&(t={}),n=$.extend({},{closable:!1,onHide:function(){return e.data("xsj_dimmer",!1),e.find(".dimmer").empty()},onShow:function(){e.data("xsj_dimmer",!0),e.find(".dimmer").html('<div class="ui indeterminate text loader">\u6570\u636e\u51c6\u5907\u4e2d...</div>'),navigator.onLine}},t),e.dimmer(n)},c.generateXSJSVGLogo=function(e){var t,n,i,r,o,a;for(null==e&&(e=6),o=[],i=t=0,r=e;0<=r?t<=r:t>=r;i=0<=r?++t:--t)n=lorem(100),a=2.1*i+1,o.push('<tspan x="0" y="'+a+'em">'+n+"</tspan>");return'<div style="position:absolute; top:0;left:0;width:100%;height:100%;pointer-events: none;" class="hidden transition">\n  <style>\n  .xsj_background_logo{\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  opacity: 0.1;\n}\n  .xsj_background_logo .text--pattern {\n  font: bold 3.75rem/1 Arial;\n  font-family: "AR PL UKai CN", \'Helvetica Neue\', Helvetica, Arial, sans-serif;\n  fill: #171717;\n}\n  .xsj_background_logo .title {\n  font: 35vmin/1 webfontxiaoshujiang;\n  stroke: #000;\n  stroke-width: 3;\n  fill: url(#pt--text);\n}\n  </style>\n<svg class="xsj_background_logo">\n    <symbol id="s-intro-text">\n        <g class="title">\n            <text text-anchor="middle" x="50%" y="30%" dy=".5em">\n                \u5c0f\u4e66\u5320\n            </text>\n        </g>    \n    </symbol>\n    \n    <pattern id="pt--text" patternUnits="userSpaceOnUse" viewBox="0 0 1500 250" width="420" height="70">\n        <text x="0" y="0" class="text--pattern">\n         '+o.join("")+'\n        </text>\n      </pattern>\n    <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#s-intro-text"></use>\n</svg>\n</div>'},c.removeExtension=function(e){var t;return(t=c.getExt(e))&&(e=e.substring(0,e.length-t.length)),e},p=function(e,t){return e.filter((function(e){var n;return n=function(t,n,i){return t.join(",")===e.join(",")},t.findIndex(n)<0}))},c.complement=function(e,t,n){var i;return window.Worker?((i=new Worker("js/worker/complement.js")).onmessage=function(e){return n(null,e.data),i.terminate(),i=null},i.postMessage([e,t])):setTimeout((function(){return n(null,p(e,t))}),1)},c.getPdfCoverTemplate=function(e,t){var n;return n="/get/pdf_cover_template","client"===STORY_PLATFORM&&(n="https://markdown.xiaoshujiang.com"+n),$.ajax({url:n,type:"POST",data:{config:e}}).done((function(e){return t(null,e)})).fail((function(){return t("\u4e0b\u8f7d\u51fa\u9519")}))},c.rgbatorgb=function(e,t,n,i,r,o,a){return"rgb("+Math.round((1-i)*r+i*e)+","+Math.round((1-i)*o+i*t)+","+Math.round((1-i)*a+i*n)+")"},c.transformPseudoElements=function(e){var t,n,i,r,o,a,s,l,c,u,d,p,f,h,m,v;for(null==e&&(e=window.document),t=$(e),u=/(.+?)([:]{1,2}before|[:]{1,2}after)$/,d=[],r=0,a=(i=e.styleSheets).length;r<a;r++)for(o=0,s=(f=i[r].rules).length;o<s;o++)if(m=(p=f[o]).selectorText,p.style&&(n=p.style.cssText),m&&n)for(c=0,l=(m=m.split(",")).length;c<l;c++)h=m[c],(h=$.trim(h))&&u.test(h)&&(v=h.replace(u,(function(e,n,i){var r;return r="",r=":before"===i||"::before"===i?">.xsj_before":">.xsj_after",0===t.find(n+r).length&&(":before"===i||"::before"===i?t.find(n).prepend("<span class='xsj_before'></span>"):t.find(n).append("<span class='xsj_after'></span>")),n+r}))+"{\n"+n+"\n}",d.push(v));return d.join("\n")},c.getExt=function(e,t,n){var i,r,o;return null==t&&(t=3),null==n&&(n=!0),e=e||"",n&&(e=(e=e.replace(/[\?#].*/,"")).replace(/^[\.\/]*/,"")),e?t<=0?"":(o=e.lastIndexOf("."),e.lastIndexOf("/")>o?"":(r="",o>0&&(r=e.substring(o),i=e.substring(0,o),r=c.getExt(i,t-1,n)+r),r)):""},c.getReferences=function(e){var t,n;return null==e&&(e=""),n={},c.getReferences.preContent===e?n=c.getReferences.references||n:(t={},window.markdownit().parse(e,t),n=t.references||{},c.getReferences.preContent=e,c.getReferences.references=n),n},c.getReferences.preContent=null,c.getReferences.references={},c.getReference=function(e,t){return null==e&&(e=""),null==t&&(t=""),(c.getReferences(e)[t.toUpperCase()]||{}).href||""},c.generateTableHtml=function(e,t){var n,i;return null==e&&(e=3),null==t&&(t=3),n=["<table><tbody>"],function(){i=[];for(var t=1;1<=e?t<=e:t>=e;1<=e?t++:t--)i.push(t);return i}.apply(this).forEach((function(e,i){var r;return n.push("<tr>"),function(){r=[];for(var e=1;1<=t?e<=t:e>=t;1<=t?e++:e--)r.push(e);return r}.apply(this).forEach((function(e,t){return n.push("<td>&nbsp;</td>")})),n.push("</tr>")})),n.push("</tbody></table>"),n.join("")},c.filterTableContent=function(e){var t,n,i,o,a;null==e&&(e=""),i=/((<[\s\/]*script\b[^>]*>)([^>]*)(<\/script>))/gim,t=/((<[\s\/]*style\b[^>]*>)([^>]*)(<\/style>))/gim,e=(e=e.replace(i,"")).replace(t,"");try{(o=(new DOMParser).parseFromString(e,"text/html").getElementsByTagName("table")).length>0&&((a=o[0]).classList.contains("table")||a.classList.add("table"),a.classList.contains("table-celled")||a.classList.add("table-celled"),a.classList.contains("table-component")||a.classList.add("table-component"),e=o[0].outerHTML)}catch(t){n=t,console.error(n),r.showMessage("\u4e0d\u662f\u5408\u6cd5\u7684\u8868\u683c\u6587\u4ef6",6e3,"error"),e=""}return e},c.filterDrawioContent=function(e){var t,n,i,o,a;null==e&&(e=""),o=/((<[\s\/]*script\b[^>]*>)([^>]*)(<\/script>))/gim,t=/((<[\s\/]*style\b[^>]*>)([^>]*)(<\/style>))/gim,e=(e=e.replace(o,"")).replace(t,"");try{(n=(a=(new DOMParser).parseFromString(e,"text/html")).getElementById("xsj_drawio_xml")||a.getElementsByClassName("xsj_drawio_xml")[0])&&(e=n.innerText)}catch(t){i=t,console.error(i),r.showMessage("\u4e0d\u662f\u5408\u6cd5\u7684\u6587\u4ef6",6e3,"error"),e=""}return e},c.filterDrawioDisplayContent=function(e){var t,n,i,o,a,s;null==e&&(e=""),a=/((<[\s\/]*script\b[^>]*>)([^>]*)(<\/script>))/gim,t=/((<[\s\/]*style\b[^>]*>)([^>]*)(<\/style>))/gim,e=(e=e.replace(a,"")).replace(t,"");try{(n=(s=(new DOMParser).parseFromString(e,"text/html")).getElementById("xsj_drawio_svg")||s.getElementsByClassName("xsj_drawio_svg")[0])?e=n.innerHTML:(i=s.getElementById("xsj_drawio_image")||s.getElementsByClassName("xsj_drawio_image")[0])&&(e=i.innerHTML)}catch(t){o=t,console.error(o),r.showMessage("\u4e0d\u662f\u5408\u6cd5\u7684\u6587\u4ef6",6e3,"error"),e=""}return e},c.filterDrawioSVGDisplayContent=function(e){var t,n,i,o,a,s,l;if(null==e&&(e=""),!e.trim())return"";try{a=(new DOMParser).parseFromString(e,"text/html").querySelector("svg"),l=(t=$(a)).attr("width")||"800px",s=parseInt(l)||"800",o=t.attr("height")||"600px",i=parseInt(o)||"600",t.attr("viewBox","0 0 "+s+" "+i),t.attr("width","100%"),t.attr("height","100%"),t[0].classList.add("xsj_svg_viewbox"),t.css("max-width",l),t.css("max-height",o),e=a.outerHTML}catch(t){n=t,console.error(n),r.showMessage("svg \u6587\u4ef6\u4e0d\u7b26\u5408 drawio \u8981\u6c42",6e3,"error"),e=""}return e},c.hideAllPopup=function(){var e;return 0===(e=$("#temp_xsj_popup")).length&&(e=$("<div id='temp_xsj_popup'></div>").appendTo($("body"))),e.popup("hide all")},c.getTransformation=function(e){return e?window.getTransformation(e):{}},d=[],c.createTempFile=function(e,t){var n,i,o,a,s;if(null==e&&(e=""),a="","client"===STORY_PLATFORM){i=require("path"),n=require("fs"),e||(e=i.dirname(process.execPath)),s=e,a=i.join(s,"xsj_"+Date.now()+".md");try{n.writeFileSync(a,(" "+t).substring(1)),d.push(a)}catch(e){o=e,r.showMessage("\u5916\u90e8\u7f16\u8f91\u5668\u6253\u5f00\u5931\u8d25\uff1a"+o,6e3,"error"),a=""}}return a},c.removeAllTempFiles=function(){var e;if("client"===STORY_PLATFORM)return e=require("fs"),d.forEach((function(t){var n;try{return e.unlinkSync(t)}catch(e){return n=e,console.error(n)}})),d.length=0},g={},c.getHeadingInfo=function(e,t){var n,i,r,o,a,s,l,c,u,d,p,f,h,m,v,w;if(p=0,e=(e=function(e){var t;return(t=/^---\s*\n([\s\S]+?)\n---\s*\n*/.exec(e))?(p=t[0].replace(/\n*$/,"").split("\n").length,e.substring(t[0].replace(/\n*$/,"").length+1)):e}(e)).split("\n").map((function(e,t){var n;return n=e[0],["#","~","`"].indexOf(n)>=0?e:""})).join("\n"),w=CryptoJS.MD5(e).toString(),g[w])return g[w];for(r=t||{},s=[],c={},n=0,l=u=0,d=(v=window.markdownit(r).parse(e,{})).length;u<d;l=++u)"heading_close"===(m=v[l]).type&&0===m.level&&"inline"===(o=v[l-1]).type&&(n++,f=_.filter(o.children,(function(e){return"text"===e.type||"code_inline"===e.type})),h=_.reduce(f,(function(e,t){return e+t.content}),""),a={id:n,line:p+o.map[0],level:+m.tag.substr(1,1),content:h},s.push(a),c[n]=a);return(i=Object.keys(g)).length>100&&i.slice(0,i.length/2).forEach((function(e){return delete g[e]})),g[w]={headings:s,idHeadingMaps:c},g[w]},c.getTaskInfo=function(e,t){var n,i,r,o,a,s,l,c,u,d,p,f,h,m,v,g,_,w,y,b,x,k,D;for(null==t&&(t={}),t.html=!0,(i=window.markdownit(t)).use(window.markdownitTaskLists,{divWrap:!1}),_=0,e=function(e){var t;return(t=/^---\s*\n([\s\S]+?)\n---\s*\n*/.exec(e))?(_=t[0].replace(/\n*$/,"").split("\n").length,e.substring(t[0].replace(/\n*$/,"").length+1)):e}(e),k=i.parse(e,{}),y=[],s={},n=0,l=function(e){return!!e&&"inline"===e.type},d=function(e){return!!e&&"paragraph_open"===e.type},c=function(e){return!!e&&"list_item_open"===e.type},p=function(e){return!!e&&!!(e.children&&e.children.length>=4&&"checkbox_input"===e.children[0].type)},u=function(e,t){return l(e[t])&&d(e[t-1])&&c(e[t-2])},function(e,t){return u(e,t)&&p(e[t])},a=f=0,m=k.length;f<m;a=++f)if(x=k[a],u(k,a)){for(r=k[a-2],n++,b=[],h=0,v=(g=k[a].children).length;h<v;h++)"text"===(x=g[h]).type&&b.push(x.content);w={id:n,line:_+r.map[0],content:b.join(""),inlineContent:k[a].content,checked:!1,isNormal:!0},p(k[a])&&(w.isNormal=!1,w.checked=k[a].children[0].meta.checked),y.push(w),s[n]=w}return o=y.filter((function(e){return e.checked})).length,D=y.filter((function(e){return!e.checked})).length,{tasks:y,doneCount:o,undoneCount:D,idTaskMaps:s}},c.getMarkInfo=function(e,t){var n,i,r,o,a,s,l;return null==t&&(t={}),s=[],r={},n=1,l=0,o=(e=function(e){var t;return(t=/^---\s*\n([\s\S]+?)\n---\s*\n*/.exec(e))?(l=t[0].replace(/\n*$/,"").split("\n").length,e.substring(t[0].replace(/\n*$/,"").length+1)):e}(e)).split("\n"),a=/==[^=]+==/g,i=/(.*)([\s]#(?:[\da-f]{3}){1,2})$/gi,n=1,o.forEach((function(e,t){var o,c,u,d,p;for(p=[];d=a.exec(e);)c=(c=d[0]).substring(2,c.length-2),o="",c=c.replace(i,(function(e,t,n){return n=(n=n||"").trim(),o=n,t})),u={id:n++,line:l+t,ch:d.index,content:c,originContent:d[0],color:o||"default"},s.push(u),p.push(r[u.id]=u);return p})),{marks:s,idMarkMaps:r}},c.getCurrentFilterInfo=function(e,t,n){var i,r,o,a;if(/^::/.test(e=e||"")||(n=!0),i=null,!n){if(e.startsWith("::category::")){e=e.substring(12);try{i={id:"temp",name:e=JSON.parse(e),icon:"fas fa-tree",filterType:"category",filterValue:e}}catch(t){t,e=""}}if(e.startsWith("::system::")){e=e.substring(10),o="\u7cfb\u7edf";try{e=JSON.parse(e),r="fas fa-thumbtack";try{(a=JSON.parse(e)).type&&"reverse"===a.type&&(r="fas fa-bezier-curve",o="\u5f15\u7528\u5f53\u524d\u6587\u7ae0\u7684\u6587\u7ae0")}catch(e){e,r="fas fa-thumbtack"}return"seven"!==e&&"three"!==e&&"thirty"!==e&&"thisWeek"!==e&&"lastWeek"!==e&&"thisMonth"!==e&&"lastMonth"!==e||(r="fas fa-clock",o="thirty"===e?"\u6700\u8fd130\u5929\u521b\u5efa":"seven"===e?"\u6700\u8fd17\u5929\u521b\u5efa":"thisWeek"===e?"\u8fd9\u661f\u671f\u521b\u5efa":"lastWeek"===e?"\u4e0a\u661f\u671f\u521b\u5efa":"thisMonth"===e?"\u8fd9\u4e2a\u6708\u521b\u5efa":"lastMonth"===e?"\u4e0a\u4e2a\u6708\u521b\u5efa":"\u6700\u8fd13\u5929\u521b\u5efa"),"sevenUpdate"!==e&&"threeUpdate"!==e&&"thirtyUpdate"!==e&&"thisWeekUpdate"!==e&&"lastWeekUpdate"!==e&&"thisMonthUpdate"!==e&&"lastMonthUpdate"!==e||(r="far fa-clock",o="thirtyUpdate"===e?"\u6700\u8fd130\u5929\u4fee\u6539":"sevenUpdate"===e?"\u6700\u8fd17\u5929\u4fee\u6539":"thisWeekUpdate"===e?"\u8fd9\u661f\u671f\u4fee\u6539":"lastWeekUpdate"===e?"\u4e0a\u661f\u671f\u4fee\u6539":"thisMonthUpdate"===e?"\u8fd9\u4e2a\u6708\u4fee\u6539":"lastMonthUpdate"===e?"\u4e0a\u4e2a\u6708\u4fee\u6539":"\u6700\u8fd13\u5929\u4fee\u6539"),"all"===e&&(r="fas fa-archive",o="\u5168\u90e8"),"archive"===e&&(r="fas fa-briefcase",o="\u5f52\u6863"),"draft"===e&&(r="fas fa-file-signature",o="\u8349\u7a3f"),i={id:"temp",name:o,icon:r,filterType:"system",filterValue:e}}catch(t){t,e=""}}if(e.startsWith("::unionTag::")){e=e.substring(12);try{i={id:"temp",name:"\u5e76\u96c6:"+(e=JSON.parse(e)),icon:"fas fa-tag",filterType:"unionTag",filterValue:e}}catch(t){t,e=""}}if(e.startsWith("::tag::")){e=e.substring(7);try{i={id:"temp",name:e=JSON.parse(e),icon:"fas fa-tag",filterType:"tag",filterValue:e}}catch(t){t,e=""}}if(e.startsWith("::date::")){e=e.substring(8);try{i={id:"temp",name:e=JSON.parse(e),icon:"far fa-clock",filterType:"date",filterValue:e}}catch(t){t,e=""}}}return!i&&e&&(i=t.find((function(t){return t.id===e}))),i||(i={}),i},c.getInternalDocs=function(e,t,n,r){var a,s,l,c,u;return a=i.pouchDB,u=[],s={},c=function(t){return o.getTitleView(a,(function(n,i){var r,o;if(!n)return o=i.viewName,r=[e],a.query(o+"/by_title",{reduce:!1,group:!1,keys:r}).then((function(e){return e.rows.length>0&&e.rows.forEach((function(e){if(!s[e.id])return u.push(e),s[e.id]=!0})),t()})).catch((function(e){return t()}));t()}))},l=function(t){return o.getSlugView(a,(function(n,i){var r,o,l;if(!n)return l=i.viewName,o=[r=e.replace(/^[\.\/]*|\/*$/g,""),"/"+r,"/"+r+"/",r+"/"],a.query(l+"/by_slug",{reduce:!1,group:!1,keys:o}).then((function(e){return e.rows.length>0&&e.rows.forEach((function(e){if(!s[e.id])return u.push(e),s[e.id]=!0})),t()})).catch((function(e){return t()}));t()}))},async.map([c,l],(function(e,t){return e(t)}),(function(){var t;return u.sort((function(e,t){return e.value.updateDate>t.value.updateDate?-1:1})),t=u.slice(0,i.maxFetchFileCount),_.map(t,(function(e){return e.id})),a.allDocs({keys:_.map(t,(function(e){return e.id})),include_docs:!0,conflicts:!0,descending:!0},(function(t,i){if(!t)return r(null,{rows:i.rows,dateNow:n,link:e});r(t)}))}))},c.getRelatedDocs=function(e,t,n){var r,o,a,s,l,u,d,p;return u=t.fileModel,s=t.app,l=t.dateNow,d=t.orignLink,p=[],o=function(t){var n;return n=i.pouchDB,c.getInternalDocs(e,u,l,(function(i,r){var o;return o=e.replace(/^[\.\/]*|\/*$/g,""),n.get(o,(function(e,n){return n&&p.push({type:"internal",id:n._id,title:n.title}),r&&r.rows&&r.rows.length>0&&r.rows.forEach((function(e){return p.push({type:"internal",id:e.id,title:e.doc.title})})),t()}))}))},a=function(t){var n,i,r,o,a,l;return u&&s&&c.checkIsSupportFileType(e)&&(n=s.getCurrentStorePluginModel(),l=u.get("pluginName"),n&&n.get("name")===l&&(a=s.getPlugin(n))&&a.getFileMeta)?(i=function(e){return e=(e=e.replace(/^\/*|\/*$/g,"")).replace(/\/+/g,"/")},r=function(e){var t;return t=(e=i(e)).lastIndexOf("/"),{guid:e.substring(t+1),parentPath:e.substring(0,t)}}(e),o=u.get("parentPath")+"/"+r.parentPath,o=i(o),void a.getFileMeta({},{guid:r.guid,parentPath:o},(function(e,n){return n&&p.push({type:"plugin",guid:n.guid,parentPath:n.parentPath,title:n.name}),t()}))):t()},r=function(t){var n,i,r,o,a;return"client"===STORY_PLATFORM&&u&&s&&c.checkIsSupportFileType(e)?(n=require("fs"),i=require("path"),a="",(r=u.get("fullPath"))&&(a=i.dirname(r)),o=i.resolve(a,d||e),void n.access(o,(function(e){return e||p.push({type:"local",fullPath:o,title:i.basename(o)}),t()}))):t()},async.map([o,a,r],(function(e,t){return e(t)}),(function(){return n(null,{rows:p,dateNow:l,link:e})}))},c.getBackgroundColor=function(e){var t;return 3===(t=$("<div style='background-color:"+e+"'></div>").css("background-color").replace(/^rgba?\(|\s+|\)$/g,"").split(",")).length&&t.push(1),4===t.length?(t[3]=.1*t[3],"rgba("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"):""},c.getCursorByStartsWith=function(e,t){var n;if(n=0,0,-1!==t.split("\n").findIndex((function(t,i){return n=i,t.startsWith(e)})))return{row:n,column:0}},c.getCursorByHashTag=function(e,t){var n,i,r,o,a,s,l,u,d,p;if(l=0,n=0,e.startsWith("^")&&(p=e.substring(1))&&(d=c.getCursorByStartsWith(p,t)))return d;if(e){if(s=-1,a='<a class="xsj_anchor" name="'+_.escape(e)+'"></a>',-1===(s=t.indexOf(a))){r=e;try{r=decodeURIComponent(e)}catch(e){o=e,console.log(o)}u=/\{(?:([a-z0-9]+)(\^[0-9]*)?: ?)?(.*)\}\n?/g,t.replace(u,(function(t,n,i,o,a){if(-1===s&&(o.indexOf("#"+e)>=0||o.indexOf("#"+r)>=0))return s=a}))}if(-1===s&&(u=/^[\t]*#{1,6}[\s\t]+[^\n]*/gm,t.replace(u,(function(t,n){if(-1===s&&(t.indexOf(e)>=0||t.indexOf(r)>=0))return s=n}))),-1===s&&(l=t.split("\n").findIndex((function(t){return!!t.startsWith("#")&&uslug(t.replace(/^#+\s+/,""))===e})))>=0)return{row:l,column:t.split("\n")[l].length-1};-1===s&&-1===(s=t.indexOf(e))&&(s=t.indexOf(r)),l=(i=(t=t.substring(0,s+1)).split("\n")).length-1,n=i.pop().length}return{row:l,column:n}},n.exports=c}}),window.requirejs.define({"lib/utils_color":function(e,t,n){var i;(i={}).getUserColors=function(e){var n,i,r,o,a,s;return null==e&&(e=8),n=t("../application"),i=t("../constant"),r=n.getApplicationProfileModel(),o=$.trim(r.get("cmColorpickerColorSets"))||"",s=i.colorSets.split("|"),a=[],o&&(a=o.split("|")),a=a.concat(s),(a=_.unique(a)).slice(0,e)},n.exports=i}}),window.requirejs.define({"lib/utils_emojis":function(e,t,n){var i;(i={}).getEmojiRegex=function(){return/[#*0-9]\uFE0F?\u20E3|[\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u231A\u231B\u2328\u23CF\u23ED-\u23EF\u23F1\u23F2\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB\u25FC\u25FE\u2600-\u2604\u260E\u2611\u2614\u2615\u2618\u2620\u2622\u2623\u2626\u262A\u262E\u262F\u2638-\u263A\u2640\u2642\u2648-\u2653\u265F\u2660\u2663\u2665\u2666\u2668\u267B\u267E\u267F\u2692\u2694-\u2697\u2699\u269B\u269C\u26A0\u26A7\u26AA\u26B0\u26B1\u26BD\u26BE\u26C4\u26C8\u26CF\u26D1\u26D3\u26E9\u26F0-\u26F5\u26F7\u26F8\u26FA\u2702\u2708\u2709\u270F\u2712\u2714\u2716\u271D\u2721\u2733\u2734\u2744\u2747\u2757\u2763\u27A1\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B55\u3030\u303D\u3297\u3299]\uFE0F?|[\u261D\u270C\u270D](?:\uFE0F|\uD83C[\uDFFB-\uDFFF])?|[\u270A\u270B](?:\uD83C[\uDFFB-\uDFFF])?|[\u23E9-\u23EC\u23F0\u23F3\u25FD\u2693\u26A1\u26AB\u26C5\u26CE\u26D4\u26EA\u26FD\u2705\u2728\u274C\u274E\u2753-\u2755\u2795-\u2797\u27B0\u27BF\u2B50]|\u26F9(?:\uFE0F|\uD83C[\uDFFB-\uDFFF])?(?:\u200D[\u2640\u2642]\uFE0F?)?|\u2764\uFE0F?(?:\u200D(?:\uD83D\uDD25|\uD83E\uDE79))?|\uD83C(?:[\uDC04\uDD70\uDD71\uDD7E\uDD7F\uDE02\uDE37\uDF21\uDF24-\uDF2C\uDF36\uDF7D\uDF96\uDF97\uDF99-\uDF9B\uDF9E\uDF9F\uDFCD\uDFCE\uDFD4-\uDFDF\uDFF5\uDFF7]\uFE0F?|[\uDF85\uDFC2\uDFC7](?:\uD83C[\uDFFB-\uDFFF])?|[\uDFC3\uDFC4\uDFCA](?:\uD83C[\uDFFB-\uDFFF])?(?:\u200D[\u2640\u2642]\uFE0F?)?|[\uDFCB\uDFCC](?:\uFE0F|\uD83C[\uDFFB-\uDFFF])?(?:\u200D[\u2640\u2642]\uFE0F?)?|[\uDCCF\uDD8E\uDD91-\uDD9A\uDE01\uDE1A\uDE2F\uDE32-\uDE36\uDE38-\uDE3A\uDE50\uDE51\uDF00-\uDF20\uDF2D-\uDF35\uDF37-\uDF7C\uDF7E-\uDF84\uDF86-\uDF93\uDFA0-\uDFC1\uDFC5\uDFC6\uDFC8\uDFC9\uDFCF-\uDFD3\uDFE0-\uDFF0\uDFF8-\uDFFF]|\uDDE6\uD83C[\uDDE8-\uDDEC\uDDEE\uDDF1\uDDF2\uDDF4\uDDF6-\uDDFA\uDDFC\uDDFD\uDDFF]|\uDDE7\uD83C[\uDDE6\uDDE7\uDDE9-\uDDEF\uDDF1-\uDDF4\uDDF6-\uDDF9\uDDFB\uDDFC\uDDFE\uDDFF]|\uDDE8\uD83C[\uDDE6\uDDE8\uDDE9\uDDEB-\uDDEE\uDDF0-\uDDF5\uDDF7\uDDFA-\uDDFF]|\uDDE9\uD83C[\uDDEA\uDDEC\uDDEF\uDDF0\uDDF2\uDDF4\uDDFF]|\uDDEA\uD83C[\uDDE6\uDDE8\uDDEA\uDDEC\uDDED\uDDF7-\uDDFA]|\uDDEB\uD83C[\uDDEE-\uDDF0\uDDF2\uDDF4\uDDF7]|\uDDEC\uD83C[\uDDE6\uDDE7\uDDE9-\uDDEE\uDDF1-\uDDF3\uDDF5-\uDDFA\uDDFC\uDDFE]|\uDDED\uD83C[\uDDF0\uDDF2\uDDF3\uDDF7\uDDF9\uDDFA]|\uDDEE\uD83C[\uDDE8-\uDDEA\uDDF1-\uDDF4\uDDF6-\uDDF9]|\uDDEF\uD83C[\uDDEA\uDDF2\uDDF4\uDDF5]|\uDDF0\uD83C[\uDDEA\uDDEC-\uDDEE\uDDF2\uDDF3\uDDF5\uDDF7\uDDFC\uDDFE\uDDFF]|\uDDF1\uD83C[\uDDE6-\uDDE8\uDDEE\uDDF0\uDDF7-\uDDFB\uDDFE]|\uDDF2\uD83C[\uDDE6\uDDE8-\uDDED\uDDF0-\uDDFF]|\uDDF3\uD83C[\uDDE6\uDDE8\uDDEA-\uDDEC\uDDEE\uDDF1\uDDF4\uDDF5\uDDF7\uDDFA\uDDFF]|\uDDF4\uD83C\uDDF2|\uDDF5\uD83C[\uDDE6\uDDEA-\uDDED\uDDF0-\uDDF3\uDDF7-\uDDF9\uDDFC\uDDFE]|\uDDF6\uD83C\uDDE6|\uDDF7\uD83C[\uDDEA\uDDF4\uDDF8\uDDFA\uDDFC]|\uDDF8\uD83C[\uDDE6-\uDDEA\uDDEC-\uDDF4\uDDF7-\uDDF9\uDDFB\uDDFD-\uDDFF]|\uDDF9\uD83C[\uDDE6\uDDE8\uDDE9\uDDEB-\uDDED\uDDEF-\uDDF4\uDDF7\uDDF9\uDDFB\uDDFC\uDDFF]|\uDDFA\uD83C[\uDDE6\uDDEC\uDDF2\uDDF3\uDDF8\uDDFE\uDDFF]|\uDDFB\uD83C[\uDDE6\uDDE8\uDDEA\uDDEC\uDDEE\uDDF3\uDDFA]|\uDDFC\uD83C[\uDDEB\uDDF8]|\uDDFD\uD83C\uDDF0|\uDDFE\uD83C[\uDDEA\uDDF9]|\uDDFF\uD83C[\uDDE6\uDDF2\uDDFC]|\uDFF3\uFE0F?(?:\u200D(?:\u26A7\uFE0F?|\uD83C\uDF08))?|\uDFF4(?:\u200D\u2620\uFE0F?|\uDB40\uDC67\uDB40\uDC62\uDB40(?:\uDC65\uDB40\uDC6E\uDB40\uDC67|\uDC73\uDB40\uDC63\uDB40\uDC74|\uDC77\uDB40\uDC6C\uDB40\uDC73)\uDB40\uDC7F)?)|\uD83D(?:[\uDC08\uDC26](?:\u200D\u2B1B)?|[\uDC3F\uDCFD\uDD49\uDD4A\uDD6F\uDD70\uDD73\uDD76-\uDD79\uDD87\uDD8A-\uDD8D\uDDA5\uDDA8\uDDB1\uDDB2\uDDBC\uDDC2-\uDDC4\uDDD1-\uDDD3\uDDDC-\uDDDE\uDDE1\uDDE3\uDDE8\uDDEF\uDDF3\uDDFA\uDECB\uDECD-\uDECF\uDEE0-\uDEE5\uDEE9\uDEF0\uDEF3]\uFE0F?|[\uDC42\uDC43\uDC46-\uDC50\uDC66\uDC67\uDC6B-\uDC6D\uDC72\uDC74-\uDC76\uDC78\uDC7C\uDC83\uDC85\uDC8F\uDC91\uDCAA\uDD7A\uDD95\uDD96\uDE4C\uDE4F\uDEC0\uDECC](?:\uD83C[\uDFFB-\uDFFF])?|[\uDC6E\uDC70\uDC71\uDC73\uDC77\uDC81\uDC82\uDC86\uDC87\uDE45-\uDE47\uDE4B\uDE4D\uDE4E\uDEA3\uDEB4-\uDEB6](?:\uD83C[\uDFFB-\uDFFF])?(?:\u200D[\u2640\u2642]\uFE0F?)?|[\uDD74\uDD90](?:\uFE0F|\uD83C[\uDFFB-\uDFFF])?|[\uDC00-\uDC07\uDC09-\uDC14\uDC16-\uDC25\uDC27-\uDC3A\uDC3C-\uDC3E\uDC40\uDC44\uDC45\uDC51-\uDC65\uDC6A\uDC79-\uDC7B\uDC7D-\uDC80\uDC84\uDC88-\uDC8E\uDC90\uDC92-\uDCA9\uDCAB-\uDCFC\uDCFF-\uDD3D\uDD4B-\uDD4E\uDD50-\uDD67\uDDA4\uDDFB-\uDE2D\uDE2F-\uDE34\uDE37-\uDE44\uDE48-\uDE4A\uDE80-\uDEA2\uDEA4-\uDEB3\uDEB7-\uDEBF\uDEC1-\uDEC5\uDED0-\uDED2\uDED5-\uDED7\uDEDC-\uDEDF\uDEEB\uDEEC\uDEF4-\uDEFC\uDFE0-\uDFEB\uDFF0]|\uDC15(?:\u200D\uD83E\uDDBA)?|\uDC3B(?:\u200D\u2744\uFE0F?)?|\uDC41\uFE0F?(?:\u200D\uD83D\uDDE8\uFE0F?)?|\uDC68(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D(?:[\uDC68\uDC69]\u200D\uD83D(?:\uDC66(?:\u200D\uD83D\uDC66)?|\uDC67(?:\u200D\uD83D[\uDC66\uDC67])?)|[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uDC66(?:\u200D\uD83D\uDC66)?|\uDC67(?:\u200D\uD83D[\uDC66\uDC67])?)|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\uD83C(?:\uDFFB(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D\uDC68\uD83C[\uDFFC-\uDFFF])))?|\uDFFC(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D\uDC68\uD83C[\uDFFB\uDFFD-\uDFFF])))?|\uDFFD(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D\uDC68\uD83C[\uDFFB\uDFFC\uDFFE\uDFFF])))?|\uDFFE(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D\uDC68\uD83C[\uDFFB-\uDFFD\uDFFF])))?|\uDFFF(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D\uDC68\uD83C[\uDFFB-\uDFFE])))?))?|\uDC69(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?[\uDC68\uDC69]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D(?:[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uDC66(?:\u200D\uD83D\uDC66)?|\uDC67(?:\u200D\uD83D[\uDC66\uDC67])?|\uDC69\u200D\uD83D(?:\uDC66(?:\u200D\uD83D\uDC66)?|\uDC67(?:\u200D\uD83D[\uDC66\uDC67])?))|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\uD83C(?:\uDFFB(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:[\uDC68\uDC69]|\uDC8B\u200D\uD83D[\uDC68\uDC69])\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D[\uDC68\uDC69]\uD83C[\uDFFC-\uDFFF])))?|\uDFFC(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:[\uDC68\uDC69]|\uDC8B\u200D\uD83D[\uDC68\uDC69])\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D[\uDC68\uDC69]\uD83C[\uDFFB\uDFFD-\uDFFF])))?|\uDFFD(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:[\uDC68\uDC69]|\uDC8B\u200D\uD83D[\uDC68\uDC69])\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D[\uDC68\uDC69]\uD83C[\uDFFB\uDFFC\uDFFE\uDFFF])))?|\uDFFE(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:[\uDC68\uDC69]|\uDC8B\u200D\uD83D[\uDC68\uDC69])\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D[\uDC68\uDC69]\uD83C[\uDFFB-\uDFFD\uDFFF])))?|\uDFFF(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:[\uDC68\uDC69]|\uDC8B\u200D\uD83D[\uDC68\uDC69])\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D[\uDC68\uDC69]\uD83C[\uDFFB-\uDFFE])))?))?|\uDC6F(?:\u200D[\u2640\u2642]\uFE0F?)?|\uDD75(?:\uFE0F|\uD83C[\uDFFB-\uDFFF])?(?:\u200D[\u2640\u2642]\uFE0F?)?|\uDE2E(?:\u200D\uD83D\uDCA8)?|\uDE35(?:\u200D\uD83D\uDCAB)?|\uDE36(?:\u200D\uD83C\uDF2B\uFE0F?)?)|\uD83E(?:[\uDD0C\uDD0F\uDD18-\uDD1F\uDD30-\uDD34\uDD36\uDD77\uDDB5\uDDB6\uDDBB\uDDD2\uDDD3\uDDD5\uDEC3-\uDEC5\uDEF0\uDEF2-\uDEF8](?:\uD83C[\uDFFB-\uDFFF])?|[\uDD26\uDD35\uDD37-\uDD39\uDD3D\uDD3E\uDDB8\uDDB9\uDDCD-\uDDCF\uDDD4\uDDD6-\uDDDD](?:\uD83C[\uDFFB-\uDFFF])?(?:\u200D[\u2640\u2642]\uFE0F?)?|[\uDDDE\uDDDF](?:\u200D[\u2640\u2642]\uFE0F?)?|[\uDD0D\uDD0E\uDD10-\uDD17\uDD20-\uDD25\uDD27-\uDD2F\uDD3A\uDD3F-\uDD45\uDD47-\uDD76\uDD78-\uDDB4\uDDB7\uDDBA\uDDBC-\uDDCC\uDDD0\uDDE0-\uDDFF\uDE70-\uDE7C\uDE80-\uDE88\uDE90-\uDEBD\uDEBF-\uDEC2\uDECE-\uDEDB\uDEE0-\uDEE8]|\uDD3C(?:\u200D[\u2640\u2642]\uFE0F?|\uD83C[\uDFFB-\uDFFF])?|\uDDD1(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83E\uDDD1))|\uD83C(?:\uDFFB(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D(?:\uD83D\uDC8B\u200D)?\uD83E\uDDD1\uD83C[\uDFFC-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83E\uDDD1\uD83C[\uDFFB-\uDFFF])))?|\uDFFC(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D(?:\uD83D\uDC8B\u200D)?\uD83E\uDDD1\uD83C[\uDFFB\uDFFD-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83E\uDDD1\uD83C[\uDFFB-\uDFFF])))?|\uDFFD(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D(?:\uD83D\uDC8B\u200D)?\uD83E\uDDD1\uD83C[\uDFFB\uDFFC\uDFFE\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83E\uDDD1\uD83C[\uDFFB-\uDFFF])))?|\uDFFE(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D(?:\uD83D\uDC8B\u200D)?\uD83E\uDDD1\uD83C[\uDFFB-\uDFFD\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83E\uDDD1\uD83C[\uDFFB-\uDFFF])))?|\uDFFF(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D(?:\uD83D\uDC8B\u200D)?\uD83E\uDDD1\uD83C[\uDFFB-\uDFFE]|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83E\uDDD1\uD83C[\uDFFB-\uDFFF])))?))?|\uDEF1(?:\uD83C(?:\uDFFB(?:\u200D\uD83E\uDEF2\uD83C[\uDFFC-\uDFFF])?|\uDFFC(?:\u200D\uD83E\uDEF2\uD83C[\uDFFB\uDFFD-\uDFFF])?|\uDFFD(?:\u200D\uD83E\uDEF2\uD83C[\uDFFB\uDFFC\uDFFE\uDFFF])?|\uDFFE(?:\u200D\uD83E\uDEF2\uD83C[\uDFFB-\uDFFD\uDFFF])?|\uDFFF(?:\u200D\uD83E\uDEF2\uD83C[\uDFFB-\uDFFE])?))?)/},i.getFirstEmojiChar=function(e){var t,n;return"string"!=typeof e&&(e=""),(e=e||"")?(t=i.getEmojiRegex(),(n=e.match(t))&&n.length>0?n[0]:Array.from(e)[0]):""},i.getRandomEmojiChar=function(e){return fetch("./js/modules/emoji-picker-element/data.json").then((function(e){return e.json()})).then((function(t){var n,i;return n="",(i=t.length)>0&&(n=t[_.random(0,i-1)].emoji),e(n)})).catch((function(){return e("")}))},i.supportsEmoji=function(){var e;return(e=document.createElement("canvas").getContext("2d")).canvas.width=e.canvas.height=1,e.fillText("\ud83d\ude17",-4,4),e.getImageData(0,0,1,1).data[3]>0},n.exports=i}}),window.requirejs.define({"lib/utils_font":function(e,t,n){var i;(i={}).registerFontIconStyle=function(e,t){var n,i,r,o;return e?(r="",e.key&&(r=e.key+"_"),i=(r=r.toLowerCase())+e.text.codePointAt(0),(t=t||document).querySelector("#xsj_custom_font_snippet_"+i)?void 0:((o=t.createElement("style")).id="xsj_custom_font_snippet_"+i,o.classList.add("xsj_custom_font_snippet"),n='@font-face {\nfont-family: "xsj_custom_font_'+i+'";\nsrc: url('+e.font+')  format("truetype");\nfont-style: normal;\nfont-weight: normal;\n}\n\n.fas.fa-star.xsj_custom_icon_'+i+":before {\n  font-family: xsj_custom_font_"+i+";\n  content: '"+_.escape(e.text)+"'\n}\n",o.textContent=n,document.head.append(o),i)):""},n.exports=i}}),window.requirejs.define({"lib/utils_generate_chart":function(e,t,n){var i,r,o,a,s,l,c,u,d,p,f,h;t("./utils"),i={},(r=window.markdownit("zero")).enable("table"),i.getPlantUMLUrl=function(e,t){var n;return window.plantumlEncoder?(n=plantumlEncoder.encode(t),/^http(s)?:\/\//.test(e)||"client"!==STORY_PLATFORM||(e.indexOf("/")>0&&(e="/"+e),e="https://www.plantuml.com"+e),_.template(e,{interpolate:/\{\{(.+?)\}\}/g})({uml:n})):""},l=null,(a=function(e){var t,n;return l?setTimeout((function(){return e(null,l)}),1):(a.queue.push(e),a.initing?void 0:(t=$('<iframe src="autopreview.html" frameborder="0" style="width: 100%;height:100%;max-width: 21cm;"></iframe>'),n=t[0],document.body.append(n),a.initing=!0,n.onload=function(){return l=n.contentWindow,a.initing=!1,a.queue.forEach((function(e){return e(null,l)}))}))}).queue=[],a.initing=!1,s=function(e){var t,n,i,r,o,a,s;return e?(s=parseInt(e.width.baseVal.value,10),n=parseInt(e.height.baseVal.value,10),(o=e.id)&&(o=' id="'+o+'" '),(r=e.className.baseVal)&&(r=' class="'+r+'" '),e.viewBox&&(s=parseInt(e.viewBox.baseVal.width,10),n=parseInt(e.viewBox.baseVal.height,10)),i=e.textContent,t="","",a="",e.getAttribute("viewBox")&&(a=' viewBox="'+e.getAttribute("viewBox")+'" '),e.parentElement.classList.contains("MathJax_SVG")&&(t=$(e.ownerDocument).find("#MathJax_SVG_glyphs")[0].outerHTML,a=' viewBox="'+e.getAttribute("viewBox")+'" ',s=e.getAttribute("width"),n=e.getAttribute("height")),a||(a=' viewBox="0 0 '+s+" "+n+'" '),'<svg xmlns="http://www.w3.org/2000/svg" '+o+r+a+' width="'+s+'" height="'+n+'" xmlns:xlink="http://www.w3.org/1999/xlink"><source><![CDATA['+i+"]]></source>"+t+e.innerHTML+"</svg>"):""},o=function(e){var t;return t=s(e),"data:image/svg+xml,"+encodeURIComponent('<?xml version="1.0" encoding="utf-8" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 20010904//EN" "http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd">'+t)},(h=function(e,t,n){if(h.queue.push({target:e,beforeFn:t,afterFn:n}),!h.processing)return h.processing=!0,u((function(){return h.processing=!1}))}).queue=[],h.processing=!1,u=function(e){var t;return h.queue.length>0?(t=h.queue.shift()).beforeFn((function(){return t.target.beforeRenderPreview((function(){return t.target.renderPreview((function(){return t.afterFn((function(){return u(e)}))}))}))})):e()},i.generateSequence=function(e,t,n){return a((function(i,r){var a,l;if(!i)return l=r.document,a=l.querySelector(".xsj_sequence"),h(r,(function(e){return a&&r.$&&r.$(a).html(""),e()}),(function(i){var r,c,u;try{Diagram.parse(e).drawSVG(a,{theme:"simple"})}catch(e){r=e,console.error("get sequence error",r)}return l&&(u=l.querySelector(".xsj_sequence>svg")),u&&(c="svg"===t?s(u):o(u)),n(null,c),i()}))}))},i.generateFlow=function(e,t,n){return a((function(i,r){var a,l;if(!i)return l=r.document,a=l.querySelector(".xsj_flow"),h(r,(function(t){return a&&r.$&&r.$(a).text(e),t()}),(function(e){var i,r;return l&&(r=l.querySelector(".xsj_flow>svg")),r&&(i="svg"===t?s(r):o(r)),n(null,i),e()}))}))},i.generateMermaid=function(e,t,n){return a((function(i,r){var a,l;if(!i)return l=r.document,a=l.querySelector(".mermaid"),h(r,(function(t){return delete a.dataset.processed,a&&r.$&&r.$(a).text(e),t()}),(function(e){var i,r;return l&&(r=l.querySelector(".mermaid>svg")),r&&(i="svg"===t?s(r):o(r)),n(null,i),e()}))}))},c=function(e,t){return a((function(n,i){var r,o;if(!n)return o=i.document,r=o.querySelector(".mathjax_container"),h(i,(function(t){return r&&(r.innerHTML=e),t()}),(function(e){var n;return"",o&&(n=o.querySelectorAll(".mathjax")),t(null,n),e()}))}))},d=[],p=!1,f=function(){var e,t;if(!(p||d.length<=0))return p=!0,t=d.slice(),e=d.map((function(e){var t;return(t=document.createElement("div")).classList.add("mathjax"),t.innerText=e.content,t.outerHTML})).join("\ntttttttttttttttt\n"),d=[],c(e,(function(e,n){if(n)return n.forEach((function(e,n){var i,r,a,l;if(l=e.querySelector(".MathJax_SVG>svg"),r=t[n])return i=r.format,a="",l&&(a="svg"===i?s(l):o(l)),r.callback(null,a)})),p=!1,f()}))},i.generateMathjax=function(e,t,n){return d.push({content:e,format:t,callback:n}),f()},i.generateTable=function(e,t,n){return setTimeout((function(){var t;return t=r.render(e),n(null,t)}),1)},n.exports=i}}),window.requirejs.define({"lib/utils_image":function(e,t,n){var i;(i={}).resizeImageByImgEl=function(e,t){var n,i,r;return r=(i=document.createElement("canvas")).getContext("2d"),n=e.width/e.height,i.width=t,i.height=t/n,r.drawImage(e,0,0,i.width,i.height),i.toDataURL()},i.resizeImage=function(e,t,n){var r;return(r=document.createElement("img")).onload=function(){var e;return e=i.resizeImageByImgEl(r,t),n(null,e)},r.onerror=function(e){return n(e)},r.src=e},n.exports=i}}),window.requirejs.define({"lib/utils_leader_line":function(e,t,n){var i,r,o,a;i=t("./utils"),r={},a=function(e,t,n){return i.asyncLoadResources([{id:"leader_line_js",type:"script",filename:"js/leader-line.min.js"}],(function(){var i,r;if(LeaderLine&&(r=window.getComputedStyle(document.documentElement),i=r.getPropertyValue("--defaultForeground").trim(),n.autoHide&&(i=r.getPropertyValue("--positiveColor").trim()),t&&0!==t.length))return t.forEach((function(t){var r;return r=t[0],t.hasClass("draggable_dialog_content_container")&&(r=LeaderLine.pointAnchor(t[0],{x:0,y:0})),e.forEach((function(e){var t;if(e[0]!==r)return t=new LeaderLine(e[0],r,{color:i,dropShadow:!0,dash:{animation:!0}}),n.autoHide?setTimeout((function(){return t.remove()}),1e3):o.leaderLines.push(t)}))}))}))},(o=_.debounce(a,300,!1)).leaderLines=[],r.showLeaderLine=function(e,t,n){return null==n&&(n={hideOther:!0,autoHide:!1}),e instanceof Array||(e=[e]),t instanceof Array||(t=[t]),n.hideOther&&r.hideLeaderLine(),o(e,t,n)},r.hideLeaderLine=function(){return o.cancel(),o.leaderLines.forEach((function(e){return e.remove()})),o.leaderLines.length=0},n.exports=r}}),window.requirejs.define({"lib/utils_size":function(e,t,n){var i;(i={}).pageSizeMap={A0:[84.1,118.9],A1:[59.4,84.1],A2:[42,59.4],A3:[29.7,42],A4:[21,29.7],A5:[14.8,21],A6:[10.5,14.8],A7:[74,10.5],A8:[52,74],A9:[37,52],B0:[100,141.4],B1:[70.7,100],B2:[50,70.7],B3:[35.3,50],B4:[25,35.3],B5:[17.6,25],B6:[12.5,17.6],B7:[8.8,12.5],B8:[6.2,8.8],B9:[3.3,6.2],B10:[3.1,4.4],C5E:[16.3,22.9],Comm10E:[10.5,24.1],DLE:[10,22],Executive:[19.05,25.4],Folio:[21,33],Ledger:[43.18,27.94],Legal:[21.59,35.56],Letter:[21.59,27.94],Tabloid:[27.94,43.18]},i.viewportSizeMap={auto:["auto","auto"],"100%":["100%","100%"]},i.setViewPortSize=function(e,t,n){var i;return i="","left"===t&&(i="0 auto 0 0"),"right"===t&&(i="0 0 0 auto"),"center"===t&&(i=""),"auto"!==e&&"fit-page"!==e||(e=""),n.css({width:e,margin:i})},n.exports=i}}),window.requirejs.define({"lib/utils_system":function(e,t,n){var i;(i={}).copyClipboard=function(e,t,n){return null==t&&(t={}),$(document).one("copy",(function(i){return i.preventDefault(),i.stopPropagation(),i.originalEvent.clipboardData.setData(t.type||"text/plain",e),n()})),document.execCommand("copy")},n.exports=i}}),window.requirejs.define({"lib/utils_table":function(e,t,n){var i;(i={}).getTableByString=function(e,t){var n,i,r,o,a,s,l;return(t=t||{}).columns=t.columns||0,t.rows=t.rows||0,(a=markdownit("zero")).enable("table"),s=$.trim(a.render(e)),(l=$("<div>"+s+"</div>").find("table")[0])?(n=$(l),i=[],o=!1,r=[],n.find("tr").each((function(e,n){var a;if(a=[],$(n).find("td,th").each((function(e,n){var i;if(o||r.push(n.style.textAlign),0===t.columns||t.columns>0&&e<t.columns)return i=(i=n.innerText||"").replace(/<br\s*[\/]?>/gi,"\n"),a.push(i)})),o=!0,t.rows>0&&e<t.rows&&i.push(a),0===t.rows)return i.push(a)})),n.remove(),n=null,{data:i,aligns:r}):null},n.exports=i}}),window.requirejs.define({"lib/utils_url":function(e,t,n){var i,r,o,a,s,l,c,u,d,p;r=t("./utils"),i=t("../constant"),a=t("./pouchdb_index_view_manager"),o=t("./notifier"),p="https://internal.xiaoshujiang.com",u=/^(http(s?):\/\/)?(www\.)?github\.([a-z])+\/([^\/]+)\/([^\/]+)\/blob\/(.*)/i,(s={}).covertGithubUrl=function(e){var t;return(t=e.match(u))?"https://raw.githubusercontent.com/"+t[5]+"/"+t[6]+"/"+t[7]:e},s.checkLinkAvaliable=function(e,t){var n,i;return e=s.covertGithubUrl(e),i={method:"HEAD",signal:(n=new AbortController).signal},fetch(e,i).then((function(e){return n.abort(),e.status<200||e.status>=300?t("\u8bf7\u6c42\u51fa\u9519\uff1a"+e.status+" "+e.statusText):t(null,e)})).catch((function(e){var i;try{n.abort()}catch(e){i=e,console.log("check link abort",i)}return t(e)}))},s.splitHashTag=function(e){var t,n;return n="",(t=(e=(e=e||"").trim()).indexOf("#"))>=0&&(n=e.substring(t+1),e=e.substring(0,t)),{url:e,hashTag:n}},d=null,s.openTarget=function(e,n){var i,r;try{e=decodeURI(e)}catch(e){}return n||(r=e.split("#"),e=r[0],n=r[1]||""),/^xsjapp:\/\/pdf\//i.test(e)?(i=e.substring(13),t("../views/pdf_popup_manager_view").showPopupView(i,{hashTag:n}),!0):!!/^xsjapp:\/\/doc\//i.test(e)&&(i=e.substring(13),t("../application").getFileCollection().getModelById(i,(function(e,t){return e?o.showMessage("\u6253\u5f00\u6587\u4ef6\u5931\u8d25:"+e,6e3,"error"):t?$(window).trigger("createNewEditor",[t,{groupId:d,callback:function(e,t){var i;if(d=e.id,(i=t.$el.find(".popup_editor_file_tabs .file_item.droppable_file_item.active")[0])&&appHighlightPosByEl(i),n)return s.highlightAnchorId(n,t.editor)}}]):o.showMessage("\u6253\u5f00\u6587\u4ef6\u5931\u8d25: \u627e\u4e0d\u5230\u8be5\u6587\u4ef6",6e3,"error")})),!0)},s.highlightAnchorId=function(e,t){var n,i,r,o,a,s,l,c,u,d,p,f,h;return f=t.getValue(),h=t.display.wrapper,i=$(h),u='<a class="xsj_anchor xsj_anchor_range xsj_anchor_range_start" name="'+e+'"></a>',r='<a class="xsj_anchor xsj_anchor_range xsj_anchor_range_end" name="'+e+'"></a>',d=f.indexOf(u),(o=f.indexOf(r))>=0&&d>=0?(d+=u.length,p=t.posFromIndex(d),a=t.posFromIndex(o),n=i.find(".xsj_anchor_range[name="+e+"]"),t.setSelection(p,a),setTimeout((function(){if(n.length>0)return i.find(".CodeMirror-selected").addClass("xsj_anchor_range_selected"),n.addClass("xsj_anchor_range_hover"),t.state.anchorHovers=t.state.anchorHovers||[],n.each((function(e,n){return t.state.anchorHovers.push(n)}))}),200),!0):(s='<a class="xsj_anchor" name="'+e+'"></a>',(l=f.indexOf(s))>=0&&(c=t.posFromIndex(l),n=i.find(".xsj_anchor[name="+e+"]"),t.setCursor(c),n.addClass("xsj_anchor_range_hover"),t.state.anchorHovers=t.state.anchorHovers||[],n.each((function(e,n){return t.state.anchorHovers.push(n)})),t.highlightPos(c)),!1)},s.getFileModelContent=function(e,t){var n,i,o,a,s,l,c,u,d,p,f,h;return i=e.get("content"),h=e.get("title"),f=e.get("tagNames"),n=e.get("category"),s=e.get("createDate"),p=0,d=-1,0===(c=r.getCursorByHashTag(t,i)).row&&0===c.column?a=(o=(i=e.getRealContent().trim()).split("\n")).slice(0,20):(6,l=(u=c.row)+6,(p=u-6)<0&&(l-=p,p=0),l>=(o=i.split("\n")).length&&(l=o.length-1),a=o.slice(p,l+1),d=u-p),'<h3 class="title">'+_.escape(h)+'</h3>\n<div class="tagNames">'+_.escape(f)+'</div>\n<div class="category">'+_.escape(n)+'</div>\n<div class="createDate">'+moment(s).format("YYYYMMDD hh:mm:ss")+'</div>\n<ol start="'+(p+1)+'">\n  '+a.map((function(e,t){var n;return e=_.escape(e),n="context_line_content",t===d?"<li class='"+(n="preview_context_line_content_current")+"'><h3>"+e+"</h3></li>":"<li class='"+n+"'>"+e+"</li>"})).join("\n")+"\n</ol>"},s.isInternal=function(e){var t,n;e+="",n={origin:p};try{n=new URL(e,p)}catch(e){t=e,console.error(t)}return n.origin===p},s.getInternalDocs=function(e,t,n){var r,o,s,l,c;return t.isCancel||(t.isCancel=function(){return!1}),r=i.pouchDB,c=[],o={},l=function(n){if(!t.isCancel())return a.getTitleView(r,(function(a,s){var l,u;if(!t.isCancel()){if(!a)return u=s.viewName,l=[e],r.query(u+"/by_title",{reduce:!1,group:!1,keys:l,limit:i.maxFetchFileCount,include_docs:!0,showUpdateProgressInfo:t.showUpdateProgressInfo}).then((function(e){var i;if(!t.isCancel())return e.rows.length>0&&(i=e.rows,t.notifier&&t.notifier(i.map((function(e){return e.doc})),{type:"internal",view:"by_title"}),i.forEach((function(e){if(!o[e.id])return c.push(e),o[e.id]=!0}))),n()})).catch((function(e){if(!t.isCancel())return n()}));n()}}))},s=function(n){if(!t.isCancel())return a.getSlugView(r,(function(a,s){var l,u,d;if(!t.isCancel()){if(!a)return d=s.viewName,u=[l=e.replace(/^[\.\/]*|\/*$/g,""),"/"+l,"/"+l+"/",l+"/"],r.query(d+"/by_slug",{reduce:!1,group:!1,keys:u,limit:i.maxFetchFileCount,include_docs:!0,showUpdateProgressInfo:t.showUpdateProgressInfo}).then((function(e){var i;if(!t.isCancel())return e.rows.length>0&&(i=e.rows,t.notifier&&t.notifier(i.map((function(e){return e.doc})),{type:"internal",view:"by_slug"}),i.forEach((function(e){if(!o[e.id])return c.push(e),o[e.id]=!0}))),n()})).catch((function(e){if(!t.isCancel())return n()}));n()}}))},async.mapSeries([l,s],(function(e,t){return e(t)}),(function(){return c.sort((function(e,t){return e.value.updateDate>t.value.updateDate?-1:1})),n(null,{rows:c,dateNow:t.dateNow,link:e})}))},s.getRelatedDocs=function(e,t,n){var o,a,l,c,u,d,p,f,h;return t.isCancel||(t.isCancel=function(){return!1}),p=t.fileModel,u=t.app,d=t.dateNow,f=t.orignLink,h=[],a=function(n){var r,o;if(!t.isCancel())return o=i.pouchDB,r=e.replace(/^[\.\/]*|\/*$/g,""),o.get(r,(function(e,i){if(!t.isCancel())return i&&(t.notifier&&t.notifier([i],{type:"internal",view:"by_id"}),h.push({type:"internal",id:i._id,title:i.title})),n()}))},l=function(n){if(!t.isCancel())return i.pouchDB,s.getInternalDocs(e,t,(function(e,i){if(!t.isCancel())return i&&i.rows&&i.rows.length>0&&i.rows.forEach((function(e){return h.push({type:"internal",id:e.id,title:e.doc.title})})),n()}))},c=function(n){var i,o,a,s,l,c;if(!t.isCancel())return p&&u&&r.checkIsSupportFileType(e)&&(i=u.getCurrentStorePluginModel(),c=p.get("pluginName"),i&&i.get("name")===c&&(l=u.getPlugin(i))&&l.getFileMeta)?(o=function(e){return e=(e=e.replace(/^\/*|\/*$/g,"")).replace(/\/+/g,"/")},a=function(e){var t;return t=(e=o(e)).lastIndexOf("/"),{guid:e.substring(t+1),parentPath:e.substring(0,t)}}(e),s=p.get("parentPath")+"/"+a.parentPath,s=o(s),void l.getFileMeta({},{guid:a.guid,parentPath:s},(function(e,i){if(!t.isCancel())return i&&(t.notifier&&t.notifier([{guid:i.guid,parentPath:i.parentPath,title:i.name},{type:"plugin"}]),h.push({type:"plugin",guid:i.guid,parentPath:i.parentPath,title:i.name})),n()}))):n()},o=function(n){var i,o,a,s,l;if(!t.isCancel())return"client"===STORY_PLATFORM&&p&&u&&r.checkIsSupportFileType(e)?(i=require("fs"),o=require("path"),l="",(a=p.get("fullPath"))&&(l=o.dirname(a)),s=o.resolve(l,f||e),void i.access(s,(function(e){if(!t.isCancel())return e||(t.notifier&&t.notifier([{fullPath:s,title:o.basename(s)}],{type:"local"}),h.push({type:"local",fullPath:s,title:o.basename(s)})),n()}))):n()},async.mapSeries([a,l,c,o],(function(e,t){return e(t)}),(function(){return n(null,{rows:h,dateNow:d,link:e})}))},l={"github.com":"github icon","github.io":"github square icon","youtube.com":"youtube icon","weibo.com":"weibo icon","weixin.com":"weixin icon","wikipedia.org":"wikipedia w icon","stackoverflow.com":"stack overflow icon","stackexchange.com":"stack exchange icon","jsfiddle.net":"jsfiddle icon"},c=function(e){var t,n;return n="",(t=e.match(/^(?:https?:\/\/)?(?:[^@\n]+@)?(?:www\.)?([^:\/\n\?\=]+)/im))&&(t=(n=t[1]).match(/^[^\.]+\.(.+\..+)$/))&&(n=t[1]),n},s.getIconName=function(e){var t;return null==e&&(e=""),(e=e.toLowerCase()).startsWith("xsjapp://doc/")?"file alternate icon":e.startsWith("xsjapp://pdf/")?"file pdf outline icon":(t=c(e),l[t]||"chrome icon")},s.getDirectDocs=function(e,t,n){var o;if(o=i.pouchDB,e)return o.get(e,(function(t,i){var s,l,c,u;return t?n(t):(c=r.getLinkInfo("a.md",i.content).map((function(e){return e.link})),0!==(u=Array.from(new Set(c))).length?(l=u.reduce((function(e,t){return e.push(t),e.push("/"+t),e.push("/"+t+"/"),e.push(t+"/"),e}),[]),s=u.map((function(e){return e.replace(/^[\.\/]*|\/*$/g,"")})),o.allDocs({include_docs:!0,keys:s},(function(t,i){var r,s;return s=[],i.rows.forEach((function(e){if(!e.error&&e.doc)return s.push({doc:e.doc,id:e.id,key:e.key,value:{createDate:e.doc.createDate,updateDate:e.doc.updateDate}})})),r=function(e){return a.getSlugView(o,(function(t,n){var i;if(!t)return i=n.viewName,o.query(i+"/by_slug",{reduce:!1,group:!1,include_docs:!0,keys:l}).then((function(t){return t.rows.forEach((function(e){return s.push(e)})),e()})).catch((function(t){return e(t)}));e(t)}))},function(e){return a.getTitleView(o,(function(t,n){var i;if(!t)return i=n.viewName,o.query(i+"/by_title",{reduce:!1,group:!1,keys:l,include_docs:!0}).then((function(t){return t.rows.forEach((function(e){return s.push(e)})),e()})).catch((function(t){return e(t)}));e(t)}))}((function(t){return t?n(t):r((function(t){var i,r;return t?n(t):(s=s.filter((function(t){return t.id!==e})),r=[],i={},s.forEach((function(e){if(!i[e.id])return i[e.id]=!0,r.push(e)})),n(null,r))}))}))}))):void n(null,[]))}));n(null,[])},n.exports=s}}),window.requirejs.define({"lib/utils_vip":function(e,t,n){var i,r;i=t("../application"),(r={}).isClientVip=function(){var e,t,n;return t=(n=i.getUserModel()).get("user"),e=n.get("token")&&t&&t.vip,"web"===STORY_PLATFORM&&(e=!0),"production"!==ENV&&(e=!0),e},n.exports=r}}),window.requirejs.define({"lib/view_helper":function(e,t,n){}}),window.requirejs.define({"lib/zip":function(e,t,n){var i,r,o;i=t("./notifier"),o=function(e){return"tmp.zip",requestFileSystem(TEMPORARY,4294967296,(function(t){var n;return n=function(){return t.root.getFile("tmp.zip",{create:!0},(function(t){return e(t)}))},t.root.getFile("tmp.zip",null,(function(e){return e.remove(n,n)}),n)}))},r=function(){function e(e){this.method=e.method||"blob",this.method="jszip",this.zipFileEntry=null,this.zipWriter=null}return e.prototype.addFiles=function(e,n,r,a,s){var l,c,u,d,p;return null==n&&(n=$.noop),null==r&&(r=$.noop),null==a&&(a=$.noop),null==s&&(s=$.noop),e instanceof Array||(e=[e]),l=0,d=function(e){return i.showMessage("\u5bfc\u51fa\u51fa\u9519:"+e,6e3,"error")},u=function(){var n,i,o;if(n=e[l],r(n),"blob"===(o=p.method)||"filesystem"===o){switch(i=null,n.type){case"text":i=new zip.TextReader(n.content);break;case"base64":i=new zip.Data64URIReader(n.data);break;default:i=new zip.BlobReader(n.blob||n)}return p.zipWriter.add(n.name,i,(function(){return++l<e.length?u():s()}),a)}return setTimeout((function(){var i;switch(n.type){case"text":p.zipWriter.file(n.name,n.content);break;case"blob":p.zipWriter.file(n.name,n.blob,{binary:!0});break;case"base64":i=t("./utils").parseBase64Data(n.data),p.zipWriter.file(n.name,i.data,{base64:!0})}return a(n),++l<e.length?u():s()}),10)},c=function(e){return zip.createWriter(e,(function(e){return p.zipWriter=e,n(),u()}),d)},(p=this).zipWriter?u():"blob"===this.method?t("./utils").asyncLoadResources([{id:"zip_js_js",type:"script",filename:"js/zipjs/zipjs.js"}],(function(){var e;return e=new zip.BlobWriter,c(e)})):"filesystem"===this.method?t("./utils").asyncLoadResources([{id:"zip_js_js",type:"script",filename:"js/zipjs/zipjs.js"}],(function(){return o((function(e){var t;return p.zipFileEntry=e,t=new zip.FileWriter(p.zipFileEntry),c(t)}))})):t("./utils").asyncLoadResources([{id:"js_zip_js",type:"script",filename:"js/jszip/jszip.js"}],(function(){return setTimeout((function(){return p.zipWriter=new JSZip,n(),u()}),10)}))},e.prototype.getBlobURL=function(e){var t;return(t=this).getBlob((function(n){var i;return i="blob"===t.method||"jszip"===t.method?URL.createObjectURL(n):t.zipFileEntry.toURL(),e(i),t.zipFileEntry=null,t.zipWriter=null}))},e.prototype.getBlob=function(e){var t,n;return"blob"===(t=(n=this).method)||"filesystem"===t?n.zipWriter.close((function(t){return e(t),n.zipFileEntry=null,n.zipWriter=null})):n.zipWriter.generateAsync({type:"blob"}).then((function(t){return e(t),n.zipFileEntry=null,n.zipWriter=null}))},e.prototype.close=function(e){return this,this.zipWriter&&"jszip"!==this.method?(this.zipWriter.close((function(){return"function"==typeof e?e():void 0})),this.zipFileEntry=null,this.zipWriter=null):"function"==typeof e?e():void 0},e}(),n.exports=r}}),window.requirejs.define({"models/app_resource_model":function(e,t,n){var i,r,o,a={}.hasOwnProperty;o=t("./model"),r=t("../constant"),t("../lib/utils"),i=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)a.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.idAttribute="_id",t.prototype.sync=BackbonePouch.sync({db:r.pouchDBAppResource}),t.prototype.initialize=function(){},t.prototype.defaults={type:"resource",filename:"",createDate:uniqueNumber(),updateDate:uniqueNumber(),_attachments:{}},t.getResource=function(e,n){var i;return(i=new t({_id:"URI_"+e})).fetch({options:{get:{attachments:!0,binary:!0}}}).then((function(e){return n(null,i)})).catch((function(e){return n(e)}))},t.createResource=function(e,n,i,r,o){var a,s,l;return e?(s=new t({_id:"URI_"+e}),l=(n=(n=n||"").replace(/\/*$/,"")).lastIndexOf("/"),n=(n=n.substring(l+1))||Date.now(),a=function(e){return e.save({filename:n,_attachments:{attachment:{content_type:i,data:r}}},{force:!0,success:function(e,t,n){return o(null,e)},error:function(e){return o(e)}})},s.fetch().then((function(e){return a(s)})).catch((function(e){return a(s)}))):o("uri \u4e0d\u80fd\u4e3a\u7a7a")},t}(o),n.exports=i}}),window.requirejs.define({"models/application_profile_collection":function(e,t,n){var i,r,o,a={}.hasOwnProperty;o=t("../constant"),r=t("./application_profile_model"),i=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)a.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,Backbone.Collection),t.prototype.localStorage=new Backbone.LocalStorage(o.localStorage.namespace+"-applicationProfile"),t.prototype.model=r,t.prototype.getApplicationProfileModel=function(){return this.fetch(),this.length<=0&&this.create(new r),this.last()},t}(),n.exports=i}}),window.requirejs.define({"models/application_profile_model":function(e,t,n){var i,r,o={}.hasOwnProperty;r=t("../constant"),i=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)o.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,Backbone.Model),t.prototype.defaults={plugin:"",resourcePluginId:"",font:"",syncScrollPreview:!0,syncScrollEditor:!1,showRandomIdiom:!0,windowWidth:600,windowHeight:400,windowLeft:0,windowTop:0,windowMaximize:!1,assetPath:"",imagePath:"images/",audioPath:"audios/",videoPath:"videos/",attachmentPath:"attachments/",fullscreenBackgroundPic:!1,fullscreenPreviewMinimap:!1,cmFullscreenStyleStackFocusLine:!0,cmColorpickerColorSets:r.colorSets,autoAddTag:!0,proxy:"",proxyOn:!1,proxyProtocol:"",proxyHost:"",proxyPort:"",proxyUsername:"",proxyPassword:"",clientResourceRootDir:"",autoCheckNewVersion:!0,skipCheckVersion:"",newFileTemplate:r.defaultNewFile.newFileTemplate,newFileTemplateId:null,defaultSnippet:"\u5f53\u524d\u65f6\u95f4\u662f <% print(moment().format('YYYY\u5e74MM\u6708DD\u65e5 HH\u65f6mm\u5206ss\u79d2'))%>, \n\u60a8\u53ef\u4ee5\u5728 ==\u7247\u6bb5== \u91cc\u8bbe\u7f6e\u7247\u6bb5\u5185\u5bb9\u3002\n",defaultSnippetId:null,storeTreeSort:{},filesSort:{},filesDisplayType:"",exportConfig:"",databaseSyncType:"local",databaseCustomSyncUrl:"",databaseCustomSyncUsername:"",databaseCustomSyncPassword:"",databaseCustomSyncWithCredentials:!1,databaseCustomSyncLive:!0,databaseCustomSyncLiveFull:!1,databaseCustomSyncLiveMax:10,closeBehavior:"default",lockPassword:"",lockTimeout:6,lockWithStart:!1,autoLock:!1,userDicts:[],themeInfo:"",filterInfos:"",currentFilter:"",batchFilenamePattern:""},t}(),n.exports=i}}),window.requirejs.define({"models/attachment_collection":function(e,t,n){var i,r,o,a={}.hasOwnProperty;r=t("./attachment_model"),o=t("../constant"),t("../lib/utils"),t("../lib/notifier"),i=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)a.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,Backbone.Collection),t.prototype.model=r,t.prototype.currentModel=null,t.prototype.sync=BackbonePouch.sync({db:o.pouchDB,fetch:"allDocs",options:{allDocs:{include_docs:!0,limit:o.maxFetchFileCount},changes:{include_docs:!0}}}),t.prototype.setCurrentModel=function(e){return this.currentModel=e},t.prototype._prepareModel=function(e,n){return e instanceof r||!this.currentModel||e._id===this.currentModel.id&&(e=this.currentModel),t.__super__._prepareModel.apply(this,arguments)},t.prototype.parse=function(e){return _.pluck(e.rows,"doc")},t.prototype.getModelByFilename=function(e,t){var n;return(n=this.where({filename:e})).length>0?t(null,n[0]):this.fetch({fetch:"query",update:!0,remove:!1,options:{query:{fun:"query_index/by_attachment_filename",include_docs:!0,limit:1,key:e}},success:function(e,n,i){var r;return 1===n.rows.length?(r=e.get(n.rows[0].id)).get("isArchived")?r.save({isArchived:!1},{force:!0,success:function(e){return t(null,r)},error:function(e){return t(e)}}):t(null,r):t(null,null)},error:function(e){return t(e)}})},t.prototype.createOrUpdateFile=function(e,t,n,i,o,a){var s,l,c;return null==o&&(o={}),(c=new r({_id:e+"__"+t})).fetch().then((function(e){return c.set({updateDate:o.updateDate}),s(c)})).catch((function(e){return c.set({createDate:o.createDate,updateDate:o.updateDate}),s(c)})),l={},o.attachmentMetas&&(l=o.attachmentMetas[t]||l),s=function(r){return r.save(Object.assign(l,{docId:e,filename:t,_attachments:{attachment:{content_type:n,data:i}}}),{force:!0,success:function(e,t,n){return a(null,r=e,n)},error:function(e){return a(e)}})}},t.prototype.comparator=function(e){return e.get("updateDate")},t}(),n.exports=i}}),window.requirejs.define({"models/attachment_model":function(e,t,n){var i,r,o,a,s={}.hasOwnProperty;o=t("./model"),r=t("../constant"),t("../lib/utils"),a=function(e){return e.startsWith("_")&&(e="XSJ"+e),e},i=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)s.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.idAttribute="_id",t.prototype.sync=BackbonePouch.sync({db:r.pouchDB}),t.prototype.initialize=function(){this._isSaving=!1,this._savingFns=[],this._isNeedSave=!1},t.prototype.defaults={docId:"",type:"attachment",filename:"",createDate:uniqueNumber(),updateDate:uniqueNumber(),_attachments:{}},t.createAttachment=function(e,n,i,r,o,s){var l,c,u;return"function"!=typeof s&&(s=o,o={}),o=o||{},u=new t({_id:e+"__"+n}),n=a(n),c=o.attachmentMeta||{},l=function(t){return t.save(Object.assign(c,{docId:e,filename:n,_attachments:{attachment:{content_type:i,data:r}}}),{force:!0,success:function(e,t,n){return s(null,e)},error:function(e){return s(e)}})},u.fetch().then((function(e){return l(u)})).catch((function(e){return l(u)}))},t}(o),n.exports=i}}),window.requirejs.define({"models/collection":function(e,t,n){var i={}.hasOwnProperty;n.exports=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)i.call(t,n)&&(e[n]=t[n]);function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype}(t,Backbone.Collection),t}()}}),window.requirejs.define({"models/database_auto_index_model":function(e,t,n){var i,r={}.hasOwnProperty;i=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)r.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,Backbone.Model),t.prototype.defaults={indexNames:[]},t.prototype.resetDefault=function(){return this.set({indexNames:["fullsearch_index","query_index/by_plugin","query_index/by_updatedate","query_index/by_isDeleted","query_index/by_tagNames","xsj/by_category","xsj/by_create_date","xsj/by_title","xsj/by_slug"]})},t.prototype.checkHasIndexName=function(e){return e.startsWith("xsj")&&(e="xsj/"+e.split("/")[1]),this.get("indexNames").indexOf(e)>=0},t.prototype.addIndexName=function(e){var t;if(e.startsWith("xsj")&&(e="xsj/"+e.split("/")[1]),(t=this.get("indexNames")).indexOf(e)<0)return(t=t.slice()).push(e),this.set({indexNames:t})},t.prototype.removeIndexName=function(e){var t;if(e.startsWith("xsj")&&(e="xsj/"+e.split("/")[1]),(t=this.get("indexNames")).indexOf(e)>=0)return t=t.filter((function(t){return t!==e})),this.set({indexNames:t})},t.prototype.initialize=function(){var e;return(e=localStorage.getItem("databaseAutoIndex"))?this.set(JSON.parse(e)):(this.resetDefault(),localStorage.setItem("databaseAutoIndex",JSON.stringify(this.toJSON()))),this.bind("change",(function(){return localStorage.setItem("databaseAutoIndex",JSON.stringify(this.toJSON()))}))},t}(),n.exports=i}}),window.requirejs.define({"models/editor_profile_collection":function(e,t,n){var i,r,o,a={}.hasOwnProperty;i=t("../constant"),o=t("./editor_profile_model"),r=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)a.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,Backbone.Collection),t.prototype.localStorage=new Backbone.LocalStorage(i.localStorage.namespace+"_editor"),t.prototype.model=o,t.prototype.getEditorProfileModel=function(){return this.fetch(),this.length<=0&&this.create(new o),this.last()},t}(),n.exports=r}}),window.requirejs.define({"models/editor_profile_model":function(e,t,n){var i,r={}.hasOwnProperty;t("../constant"),i=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)r.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,Backbone.Model),t.prototype.defaults=function(){return"codemirror",{pastePlainFileMode:"appendAttachment",momentFormat:"YYYY\u5e74MM\u6708DD\u65e5 HH\u65f6mm\u5206ss\u79d2",tocOrderedList:!1,tocDepthFrom:1,tocDepthTo:7,useWrapMode:!0,fontSize:16,viewportWidth:"web"===STORY_PLATFORM?"21cm":"auto",viewportAlign:"center",mode:"ace/mode/markdown",theme:"ace/theme/solarized_light",editorFont:"",editorType:"codemirror",lineHeight:"",cm_minimap:!0,cm_keyBinding:"default",cm_lineNumbers:!1,cm_lineWrapping:!0,cm_autoCloseBrackets:!0,cm_highlightActive:!0,cm_styleStackFocusLine:!1,cm_showInvisibles:!1,cm_autoCovertHtmlToMarkdown:!0,cm_typewriterScrolling:!0,cm_tabSize:4,cm_smartIndent:!0,cm_indentUnit:4,cm_indentWithTabs:!0,cm_scrollPastEnd:!0,cm_previewPDF:!0,cm_autopreviewHoveredImage:!0,cm_autopreview:!0,cm_autopreview_image:!0,cm_autopreview_link:!0,cm_autopreview_inline:!0,cm_autopreview_hr:!0,cm_autopreview_yaml:!0,cm_autopreview_mathjax:!0,cm_autopreview_table:!0,cm_autopreview_todo:!0,cm_autopreview_fenced_code:!0,cm_autopreview_header:!0,cm_autopreview_html:!0,cm_autopreview_emoji:!1,cm_autopreview_mermaid:!1,cm_autopreiew_flow:!1,cm_autopreview_sequence:!1,cm_autopreview_plantUML:!1,cm_autopreview_toc:!0,cm_autopreview_footnote:!0,cm_autopreview_ruby:!0,cm_autopreviewImage:!1,cm_autopreviewTodoList:!0,cm_activeCursorMathjax:!0,cm_spellChecker:!1,cm_variableHeight:!1,cm_markerColorpicker:!0,cm_inputOffsetTop:0,bindInfos:"",autoSave:{interval:3e3,canAutoSave:!0}}},t}(),n.exports=i}}),window.requirejs.define({"models/file_collection":function(e,t,n){var i,r,o,a,s,l,c,u={}.hasOwnProperty;a=t("./file_model"),i=t("./attachment_collection"),r=t("../constant"),s=t("../lib/utils"),l=t("../lib/utils_emojis"),t("../lib/notifier"),c=function(e,t,n,o){var a,s,l,c;return null==t&&(t=[]),s=null,e&&(s=e.id),l=[],a=new i,c=[],$.each(t,(function(e,t){var i,o;return i=$.Deferred(),o=setTimeout((function(){return i.resolve(),console.log("\u521b\u5efa\u9644\u4ef6\u5931\u8d25"+t)}),r.initFileAttachmentTimeout),a.createOrUpdateFile(s,t.name,t.type,t.blob,n,(function(e,n,a){return clearTimeout(o),o=null,null!=e?console.log("file error :"+t):c.push({name:t.name,type:r.fileContentType.attachment,blob:new Blob([n.id+"__"+n.get("_rev")],{type:"text/plain"})}),i.resolve()})),l.push(i.promise())})),$.when.apply(null,l).done((function(){return"function"==typeof o?o(null,c):void 0}))},o=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)u.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(n,Backbone.Collection),n.prototype.model=a,n.prototype.changedFileModels=[],n.prototype.allFileIds=[],n.prototype.sync=BackbonePouch.sync({db:r.pouchDB,fetch:"allDocs",options:{put:{force:!0},get:{conflicts:!0},allDocs:{include_docs:!0,conflicts:!0,limit:r.maxFetchFileCount},changes:{include_docs:!0,conflicts:!0}}}),n.prototype.parse=function(e,n){var i,r,o;return i=this,"find"===n.fetch?e.docs:(o=t("../application").getAllInstanceFileModels(),r=o.filter((function(e){var t;return(t=i.get(e.cid))||(t=i.get(e.id)),!t})),_.pluck(e.rows,"doc").filter((function(e){return!!e})).map((function(e){return r.find((function(t){return t.id===e._id}))||e})))},n.prototype.getLastModifiedFileModel=function(){return this.last()},n.prototype.getModelById=function(e,n){var i,r,o;if(i=t("../application"),!1,e)return o=i.getAllInstanceFileModels(),(r=o.find((function(t){return t.id===e})))?n(null,r):(r=new a({_id:e})).fetch({options:{get:{conflicts:!0}}}).then((function(){return n(null,r)})).catch((function(e){return n(e)}));n(null,null)},n.prototype.getModelByFullPath=function(e,t){var n;return(n=this.where({fullPath:e})).length>0?t(null,n[0]):this.fetch({fetch:"query",update:!0,remove:!1,options:{query:{fun:"query_index/by_fullPath",include_docs:!0,conflicts:!0,limit:1,key:e}},success:function(e,n,i){var r;return 1===n.rows.length?(r=e.get(n.rows[0].id)).get("isArchived")?r.save({isArchived:!1},{force:!0,success:function(e){return t(null,r)},error:function(e){return t(e)}}):t(null,r):t(null,null)},error:function(e){return t(e)}})},n.prototype.updateFile=function(e,n,i,r,o,a){var l,u,d,p,f,h,m,v,g;if(null==o&&(o={}),l=t("../application"),f=s.getMetaData(i)||{},g=o.tagNames||[],f.tags&&("string"==typeof f.tags?g=function(){var e,t,n,i;for(i=[],e=0,t=(n=f.tags.split(",")).length;e<t;e++)m=n[e],i.push($.trim(m));return i}():$.isArray(f.tags)&&(g=f.tags)),!(u=l.getApplicationProfileModel()).has("autoAddTag")||u.get("autoAddTag"))for(d=0,p=g.length;d<p;d++)(v=g[d])&&l.getTagModel().addTag(v);return h=function(e){var t;return null==e&&(e=[]),t={},e.forEach((function(e,n){var i;return i=e.name,e.name.startsWith("_")&&(i="XSJ"+e.name),t[i]={content_type:e.type,data:e.blob}})),t},c(e,r,o,(function(t,r){var s;return s={content:i,title:n,isArchived:o.isArchived,isDeleted:!1,updateDate:o.updateDate,contentUpdateDate:o.updateDate,syncDate:o.syncDate||o.updateDate||"",tagNames:g,_attachments:h(r)},f&&(f.createDate&&(s.meta_createDate=f.createDate),f.updateDate&&(s.meta_updateDate=f.updateDate),f.slug&&(s.slug=f.slug),f.excerpt&&(s.excerpt=f.excerpt),f.flag&&(s.flag=f.flag+""),f.category&&(s.category=f.category+""),f.idiom&&(s.idiom=f.idiom+""),f.color&&(s.color=f.color+""),f.cover&&(s.cover=f.cover+""),s.meta_published=f.published,s.meta_slug=f.slug,s.meta_link=f.link),e.save(s,{force:!0,success:function(t,n,i){return t.revert(n._rev,(function(t,n){return t?a(t):a(null,e=n,i)}))},error:function(e){return a(e)}})}))},n.prototype.createFile=function(e,n,i,o,a){var u,d,p,f,h,m,v,g,_,w,y;if(null==o&&(o={}),y=this,u=t("../application"),m=s.getMetaData(n)||{},w=o.tagNames||[],m.tags&&("string"==typeof m.tags?w=function(){var e,t,n,i;for(i=[],e=0,t=(n=m.tags.split(",")).length;e<t;e++)g=n[e],i.push($.trim(g));return i}():$.isArray(m.tags)&&(w=m.tags)),m.title&&(e=m.title),!(p=u.getApplicationProfileModel()).has("autoAddTag")||p.get("autoAddTag"))for(f=0,h=w.length;f<h;f++)(_=w[f])&&u.getTagModel().addTag(_);return v=function(e){var t;return null==e&&(e=[]),t={},e.forEach((function(e,n){var i;return i=e.name,e.name.startsWith("_")&&(i="XSJ"+e.name),t[i]={content_type:e.type,data:e.blob}})),t},d=function(t){var r,s;return r={content:n,title:e,guid:o.guid,cssText:o.cssText||"",isSys:!!o.isSys,sysTitle:o.sysTitle,createDate:o.createDate,updateDate:o.updateDate,contentUpdateDate:o.updateDate,parentPath:o.parentPath,syncDate:o.syncDate||"",pluginName:o.pluginName,urlMap:o.urlMap||{},fileMap:o.fileMap||{},tagNames:w},m&&(m.createDate&&(r.meta_createDate=m.createDate),m.updateDate&&(r.meta_updateDate=m.updateDate),m.slug&&(r.slug=m.slug),m.excerpt&&(r.excerpt=m.excerpt),m.flag&&(r.flag=m.flag+""),m.category&&(r.category=m.category+""),m.idiom&&(r.idiom=m.idiom+""),m.color&&(r.color=m.color+""),m.cover&&(r.cover=m.cover+""),m.emoji&&(s=l.getFirstEmojiChar(m.emoji))&&(r.emoji=s+""),r.meta_published=m.published,r.meta_slug=m.slug,r.meta_link=m.link),t&&(r._id=t,r.isArchived=!1,r.isDeleted=!1),y.create(r,{force:!0,skipRevCheck:!t,success:function(e,t,n){return i&&i.length>0?c(e,i,o,(function(t,n){return e.save({_attachments:v(n)},{force:!0,skipRevCheck:!0,success:function(e,t,n){return e.revert(t._rev,(function(e,t){return e?a(e):a(null,t,n)}))},error:function(e){return a(e)}})})):a(null,e,n)},error:function(e){return a(e)}})},o.id?this.fetch({fetch:"allDocs",update:!0,remove:!1,options:{allDocs:{key:o.id,include_docs:!0,conflicts:!0,limit:r.maxFetchFileCount}},success:function(t,r,s){var l;return(l=t.get(o.id))?y.updateFile(l,e,n,i,o,a):d(o.id)},error:function(){return d(o.id)}}):d()},n.prototype._createSysFile=function(e,t,n){var i,r;return null==e&&(e="update_help_file"),null==t&&(t=!1),r=this,i="xsj____"+e,s[{grammar_help_file:"getGrammarHelpFile",use_help_file:"getUseHelpFile",update_help_file:"getUpdateHelpFile",ppt_help_file:"getPptHelpFile"}[e]]((function(e,t,o,a){return r.createFile(t,o,a,{isSys:!0,id:i},n)}))},n.prototype.createGrammarHelpFile=function(e,t){return null==e&&(e=!1),this._createSysFile("grammar_help_file",e,t)},n.prototype.createUseHelpFile=function(e,t){return null==e&&(e=!1),this._createSysFile("use_help_file",e,t)},n.prototype.createUpdateHelpFile=function(e,t){return null==e&&(e=!1),this._createSysFile("update_help_file",e,t)},n.prototype.createPptHelpFile=function(e,t){return null==e&&(e=!1),this._createSysFile("ppt_help_file",e,t)},n.prototype.comparator=function(e,t){var n,i,r;return(n=(i=this.allFileIds||[]).indexOf(e.id))>(r=i.indexOf(t.id))?-1:n<r||e.get("updateDate")>t.get("updateDate")?1:-1},n}(),n.exports=o}}),window.requirejs.define({"models/file_group_tab_collection":function(e,t,n){var i,r,o={}.hasOwnProperty;t("../constant"),r=t("./file_group_tab_model"),i=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)o.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,Backbone.Collection),t.prototype.localStorage=r.localStorage,t.prototype.model=r,t.prototype.getFileGroupTabModel=function(){return this.fetch(),this.length<=0&&this.create(new r),this.last()},t.prototype.getFileGroupTabModelById=function(e,t){var n,i,r;return null==t&&(t={}),(i=this.get({id:e}))||((i=this.create({id:e,name:t.name,type:t.type,activeFile:t.activeFile,files:t.files,emoji:t.emoji,position:t.position},t)).save(),t.initNewCallback&&t.initNewCallback(i),this.length>50&&(n=this.getActive()||"-1",(r=this.filter((function(e){return"file"===e.get("type")&&e.get("activeFile")!==n})))&&r.length>0&&r[0].destroy())),i},t.prototype.getNextFileIdByPos=function(e){var t,n;return e-=1,[],t=null,!1,n=-1,this.forEach((function(i,r){var o;if("file"===i.get("type")){if(o=i.get("activeFile"),!(r<e+1))return r>e+1?(n<0&&(t=o),n=1):(t=o,n=0);if(n<0)return t=o}})),t},t.prototype.getAllFileIds=function(){var e;return e=[],this.forEach((function(t){if(e.push(t.get("activeFile")),"group"===t.get("type"))return(t.get("files")||[]).map((function(t){return e.push(t.id)}))})),_.uniq(_.compact(_.flatten(e)))},t.prototype.getAllConnectedFileModels=function(){var e;return e=[],this.forEach((function(t){return e=e.concat(t.getConnectedFileModels())})),e=_.uniq(_.flatten(e))},t.prototype.changeActive=function(e){return this.localStorage.localStorage().setItem(this.localStorage.name+"_active",e),this.trigger("xsjActive",e,"file")},t.prototype.getActive=function(){return this.localStorage.localStorage().getItem(this.localStorage.name+"_active")},t.prototype.getActiveFile=function(){var e;return e=this.getActive(),this.get(e)},t}(),n.exports=i}}),window.requirejs.define({"models/file_group_tab_model":function(e,t,n){var i,r,o,a={}.hasOwnProperty;i=t("../constant"),o=new Backbone.LocalStorage(i.localStorage.namespace+"_group_tab"),(r=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)a.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,Backbone.Model),t.prototype.localStorage=o,t.prototype._fileModelCache=null,t.prototype.defaults=function(){return{name:"",type:"group",groupType:"temp",groupIcon:"",groupColor:"",groupFontIcon:null,emoji:"",isMax:!1,isMin:!1,isShade:!1,isPinned:!1,position:null,activeFile:null,files:[]}},t.prototype.initialize=function(){var e;return e=this,this._fileModelCache={},this.bind("change:files change:activeFile",(function(t,n,i){var r,o,a,s;if(a=e.get("files"),r=e.get("activeFile"),"group"===e.get("type"))return o=a.map((function(e){return e.id})),r&&(o=o.concat([r])),s=Object.keys(e._fileModelCache).filter((function(e){return o.indexOf(e)<0})),e.clearConnectedFileModels(s||[])}))},t.prototype.getActiveFileInfo=function(){var e,t;if(e=this.get("files")||[],t=this.get("activeFile")||null)return e.find((function(e){return e.id===t}))},t.prototype.clearConnectedFileModels=function(e){var t,n;return n=this,t=this._fileModelCache,e?e instanceof Array||(e=[e]):e=Object.keys(t),e.forEach((function(e){var i;if(i=t[e])return n.stopListening(i),delete t[e]}))},t.prototype.getConnectedFileModels=function(){return Object.values(this._fileModelCache)},t.prototype.connectFileModel=function(e){var t,n,i,r;if(e&&(t=this,!this._fileModelCache[e.id])){if(r=t.get("type"),n=t.get("activeFile"),"file"===r){if(e.id!==n)return;return this._fileModelCache={},this._fileModelCache[e.id]=e,this.listenTo(e,"change:title",(function(){return t.save({name:e.get("title")})})),this.listenTo(e,"change:emoji",(function(){return t.save({emoji:e.get("emoji")})}))}if("group"===r){if(!(i=this.get("files")).find((function(t){return t.id===e.id})))return;return this._fileModelCache[e.id]=e,this.listenTo(e,"change:title",(function(){return i.map((function(t){if(t.id===e.id)return t.name=e.get("title")})),t.save({files:i.slice()})}))}}},t}()).localStorage=o,n.exports=r}}),window.requirejs.define({"models/file_local_collection":function(e,t,n){var i,r,o={}.hasOwnProperty;t("../constant"),r=t("./file_local_model"),i=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)o.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,Backbone.Collection),t.prototype.localStorage=r.localStorage,t.prototype.model=r,t.prototype.getFileLocalModel=function(){return this.fetch(),this.length<=0&&this.create(new r),this.last()},t.prototype.getFileLocalModelByFullPath=function(e){var t;return(t=this.where({fullPath:e})).length>0?t[t.length-1]:null},t.prototype.getFileLocalModelByFileId=function(e){var t;return(t=this.get({id:e}))||(t=this.create({id:e}),this.length>50&&this.first().destroy()),t},t.prototype.destroyAll=function(e){var t;return t=function(e,t){return e.destroy({success:t,error:t})},async.mapSeries(this.models,t,e)},t}(),n.exports=i}}),window.requirejs.define({"models/file_local_model":function(e,t,n){var i,r,o,a={}.hasOwnProperty;i=t("../constant"),o=new Backbone.LocalStorage(i.localStorage.namespace+"_file"),(r=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)a.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,Backbone.Model),t.prototype.localStorage=o,t.prototype.defaults=function(){return{fullPath:"",diskContent:"",title:"",content:"",cursorPosition:0,cursorPositionColumn:0,isLocked:!1,foldInfos:[]}},t}()).localStorage=o,n.exports=r}}),window.requirejs.define({"models/file_model":function(e,t,n){var i,r,o,a,s,l,c,u,d,p,f,h,m=function(e,t){return function(){return e.apply(t,arguments)}},v={}.hasOwnProperty;a=t("./model"),i=t("./attachment_model"),r=t("../constant"),s=t("../lib/utils"),l=t("../lib/utils_emojis"),c=function(e,t){var n,i;for(i in delete(n=_.clone(e))._conflicts,t)if(t[i],void 0!==n[i])return!0},u=function(e){return e.startsWith("_")&&(e="XSJ"+e),e},d=function(e,t){var n,i,r,o,a;for(a=t,(r=s.getExt(t))?(n=t.lastIndexOf(r),i=t.substring(0,n)):(i=t,r=""),o=0;o++,e.hasAttachment(a);)a=r?i+"_"+o+r:i+"_"+o;return a},p=function(e){return s.getMetaData(e)},f=function(e){return function(e){var t;return(t=/^---\s*\n([\s\S]+?)\n---\s*\n*/.exec(e))?e.substring(t[0].replace(/\n*$/,"").length+1):e}(e)},h=function(e,t){var n;return null==t&&(t=200),(n=p(e)).summary?n.summary.substring(0,t):(f(e)||"").substring(0,t)},(o=function(e){function t(){return this.initAttachment=m(this.initAttachment,this),this.getAttachObjectByFilename=m(this.getAttachObjectByFilename,this),t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)v.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.idAttribute="_id",t.prototype.pouch={silent:!0},t.prototype.sync=BackbonePouch.sync({db:r.pouchDB,options:{put:{force:!0},get:{conflicts:!0}}}),t.prototype.saveTitleAndTagsMeta=function(e,t,n){var i,r;return i=this.get("content"),r=s.setMetaData(i,"title",e,!0),r=s.setMetaData(r,"tags",t,!0),this.set({title:e,tagNames:t.split(","),content:r,updateDate:uniqueNumber()}),this.save({},n)},t.prototype.toJSONWithSkipAttachmentData=function(){var e,t,n,i;for(i in t=(n=this.toJSON())._attachments||{})delete(e=t[i]).data,e.stub=!0;return n},t.prototype.get=function(e){var n;return n=t.__super__.get.call(this,e),"title"===e&&"string"!=typeof n&&(n+=""),"emoji"===e&&(n=l.getFirstEmojiChar(n)||"",n=_.escape(n)),n},t.prototype.initialize=function(){var e,t;return this.attachmentMeta={},this.mediaNaturalSizeCache={},this._isSaving=!1,this._savingFns=[],this._isNeedSave=!1,this.bind("change:content change:title",(function(e,t,n){return e.get("createDate")||e.set("createDate",uniqueNumber(),{silent:!0}),e.set("updateDate",uniqueNumber(),{silent:!0}),e.set("contentUpdateDate",uniqueNumber(),{silent:!1})})),t=function(e){var t;return null==e&&(e=""),(t=/^---\s*\n([\s\S]+?)\n---\s*\n*/.exec(e))&&t[1]?t[1]:""},e=_.debounce((function(n,i){var r;if(e.prevInfo&&(r=e.prevInfo.content||"",e.prevInfo=null,t(r)!==t(i)))return n.trigger("yamlChanged")}),2e3,!1),this.bind("change:content",(function(t,n,i){var r,o,a,c,u;if(a=t.previous("content"),t.previous("_id")&&(e.prevInfo||(e.prevInfo={content:a}),e(t,n)),o=s.getMetaData(n))return o.title&&("string"!=typeof o.title&&(o.title=o.title+""),t.set("title",o.title)),o.hasOwnProperty("tags")&&(o.tags?(u=[],"string"==typeof o.tags?u=function(){var e,t,n,i;for(i=[],e=0,t=(n=o.tags.split(",")).length;e<t;e++)c=n[e],i.push($.trim(c));return i}():$.isArray(o.tags)&&(u=o.tags),u=_.filter(u,(function(e){return!!e})),t.set("tagNames",u)):t.set("tagNames",[])),o.createDate&&t.set("meta_createDate",o.createDate),o.updateDate&&t.set("meta_updateDate",o.updateDate),o.hasOwnProperty("slug")&&t.set("slug",o.slug+""),o.hasOwnProperty("excerpt")&&t.set("excerpt",o.excerpt+""),o.hasOwnProperty("flag")&&t.set("flag",o.flag+""),o.hasOwnProperty("cover")&&t.set("cover",o.cover+""),o.hasOwnProperty("idiom")&&t.set("idiom",o.idiom+""),o.hasOwnProperty("color")&&t.set("color",o.color+""),o.hasOwnProperty("category")&&t.set("category",o.category+""),o.hasOwnProperty("emoji")&&(r=l.getFirstEmojiChar(o.emoji)||"",t.set("emoji",r+"")),t.set("meta_published",o.published),t.set("meta_slug",o.slug),t.set("meta_link",o.link)})),this.bind("change",(function(e,t,n){if(c(e.defaults,e.changed))return e._isNeedSave=!0}))},t.prototype.defaults={title:r.defaultNewFile.newFileTitle,type:"markdown",idiom:"",color:"",cover:"",emoji:"",filename:"",content:r.defaultNewFile.newFileContent,cssText:"",guid:"",pluginName:"",syncDate:"",parentPath:"",fullPath:"",diskContent:"",isDeleted:!1,isArchived:!1,createDate:uniqueNumber(),updateDate:uniqueNumber(),contentUpdateDate:"",slug:"",excerpt:"",tagNames:[],category:"",flag:"",isSys:!1,up:!1,sysTitle:"",urlMap:{},fileMap:{},_attachments:{}},t.prototype.addAttachmentMetaCache=function(e,t,n){var i;if(!(n=n||"")||!this.attachmentMeta[e]||this.attachmentMeta[e].digest!==n)return i=window.URL.createObjectURL(t),this.attachmentMeta[e]={key:e,digest:n,length:t.size,type:t.type,data:t,objectUrl:i}},t.prototype.removeAllAttachmentMetaCache=function(){var e,t,n;for(e in n=this.attachmentMeta)(t=n[e].objectUrl)&&window.URL.revokeObjectURL(t);return this.attachmentMeta={}},t.prototype.getAttachObjectByFilename=function(e,t){var n,i,r,o;return i=this,e=u(e),(o=this.attachmentMeta[e])?setTimeout((function(){return t(null,o)}),1):(n=function(){return t(null,i.attachmentMeta[e])},this.getAttachObjectByFilename.sequence?this.getAttachObjectByFilename.sequence.push([e,n]):(this.getAttachObjectByFilename.sequence=[[e,n]],r=function(){var e,t;return(t=(e=i.getAttachObjectByFilename.sequence).shift())&&t[1](),e.length>0?i.initAttachment(e[0][0],r):i.getAttachObjectByFilename.sequence=null},i.initAttachment(e,r)))},t.prototype.getAllAttachObjects=function(e){var t;return t=this.attachments(),async.mapLimit(t,10,this.getAttachObjectByFilename,(function(t,n){return e(t,n)}))},t.prototype.setUrlMap=function(e,t,n){var i;return(i=this.get("urlMap")||{})[e]=t,this.save({urlMap:i},{success:function(){return n()},error:function(e){return n()}})},t.prototype.hasAttachment=function(e){var t;return e=u(e),!!(t=this.attributes._attachments)&&!!t[e]},t.prototype.reInitAttachments=function(e){var t,n;return null==e&&(e={}),t=this.attributes._attachments||{},$.each(e,(n=this,function(e,i){var o,a;if((!(a=t[e])||a.digest!==i.digest)&&(o=i.data)&&o instanceof Blob&&i.content_type!==r.fileContentType.attachment)return n.addAttachmentMetaCache(e,o,i.digest)}))},t.prototype.initAttachment=function(e,t){var n,o,a,l,c;return n=(l=this).get("_attachments")||{},c=setTimeout((function(){return t(),console.log("\u52a0\u8f7d\u9644\u4ef6\u5931\u8d25"+e)}),r.initFileAttachmentTimeout),n[e]?l.attachment(e,(function(u,d){var p;return clearTimeout(c),c=null,null!=u?(console.log("file error :"+e),t()):(p=n[e]||{}).content_type===r.fileContentType.attachment?s.blob2Text(d,(function(n,r){var s,c;return 3!==(s=function(e){var t,n,i;return n=[],i=e.indexOf("__"),(t=e.lastIndexOf("__"))>i&&(n=[e.substring(0,i),e.substring(i+2,t),e.substring(t+2)]),n}(r)).length?(l.addAttachmentMetaCache(e,d,p.digest),t()):(a=s[0]+"__"+s[1],c=s[2],(o=new i({_id:a})).fetch({options:{get:{rev:c,attachments:!0,binary:!0}}}).then((function(n){return d=n._attachments.attachment.data,n._attachments.attachment.content_type,l.addAttachmentMetaCache(e,d,n._attachments.attachment.digest),t()})).catch((function(n){return o.fetch({options:{get:{attachments:!0,binary:!0}}}).then((function(n){return d=n._attachments.attachment.data,n._attachments.attachment.content_type,l.addAttachmentMetaCache(e,d,n._attachments.attachment.digest),t()})).catch((function(n){return console.log("file error :"+e),t()}))})))})):(l.addAttachmentMetaCache(e,d,p.digest),t())})):this.isXSJFake?(a=l.id+"__"+e,void(o=new i({_id:a})).fetch({options:{get:{attachments:!0,binary:!0}}}).then((function(n){var i;return clearTimeout(c),c=null,i=n._attachments.attachment.data,n._attachments.attachment.content_type,l.addAttachmentMetaCache(e,i,n._attachments.attachment.digest),t()})).catch((function(n){return clearTimeout(c),c=null,console.log("file error :"+e),t()}))):(clearTimeout(c),c=null,void t())},t.prototype._internalSave=function(){var e,t;if(!this._isSaving)return this._isSaving=!0,(e=this._savingFns.shift()).fn.apply(this,e.args).done((t=this,function(){if(t._isSaving=!1,t._savingFns.length>0)return t._internalSave()}))},t.prototype.save=function(e,n){var i,r,o,a,s,l,c,u,d;return null==e&&(e={}),null==n&&(n={}),u=this,c=!!n.force,Object.keys(e).length>0&&(c=!0),a=t.__super__.save,u._isNeedSave||c||(console.log("no need save..."),a=function(e,t){return null==t&&(t={}),"function"==typeof t.success?t.success(u,null,t):void 0}),u._isNeedSave=!1,d=n.success,l=n.error,s=$.Deferred(),n.success=function(e,t,n){var i;if(d)try{d.call(n.context,e,t,n)}catch(t){i=t,console.error("save filemodel:"+e.get("title")),console.error(i)}return s.resolve()},n.error=function(e){var t;if(l)try{l.call(n.context,e,n)}catch(e){t=e,console.error("save filemodel:"+u.get("title")),console.error(t)}return s.resolve()},i=[e,n],r=function(e){var n;return(n=new t).set({_id:u.id}),n.fetch({error:function(){return e()},success:function(){return u.isXSJFake&&(delete u.isXSJFake,u.set({_attachments:n.get("_attachments"),createDate:n.get("createDate"),urlMap:n.get("urlMap")},{silent:!0}),u.set("_attachments",n.get("_attachments"))),e(n.get("_rev"))}})},o=function(e,t){return!!t.skipRevCheck?a.call(u,e,t):r((function(n){return n&&u.set({_rev:n},{silent:!0}),a.call(u,e,t)})),s},this._savingFns.push({args:i,fn:o}),this._internalSave()},t.prototype.moveToTrash=function(e){return null==e&&(e={}),this.save({isDeleted:!0,updateDate:uniqueNumber(),contentUpdateDate:uniqueNumber(),guid:"",pluginName:"",syncDate:"",parentPath:"",fullPath:"",diskContent:""},e)},t.prototype.archive=function(e){return null==e&&(e={}),this.save({isArchived:!0,updateDate:uniqueNumber()},e)},t.prototype.destroy=function(e){var n,i,r,o,a,s;return null==e&&(e={}),s=e.success,o=e.error,r=$.Deferred(),a=this,e.success=function(e,t,n){return s&&s.call(n.context,e,t,n),r.resolve()},e.error=function(t){return o&&o.call(e.context,t,e),r.resolve()},n=[e],i=function(e){return t.__super__.destroy.call(a,e),r},this._savingFns.push({args:n,fn:i}),this._internalSave()},t.prototype.revert=function(e,t){var n,i;return n=this.get("_rev"),i=this,this.fetch({success:function(e,r,o){return i.set({_rev:n},{silent:!0}),"function"==typeof t?t(null,i):void 0},error:function(e){return"function"==typeof t?t(e):void 0},options:{get:{rev:e,attachments:!0}}})},t.prototype.getCoverUrl=function(){var e,t,n;return(e=this.get("cover")||"").startsWith("![")&&(n=e.lastIndexOf("("),t=e.lastIndexOf(")"),e=(e=e.substring(n+1,t)).split(" ")[0]),e},t.prototype.getCoverObjectUrl=function(e){var t;if(t=(t=this.getCoverUrl()).replace(/^[\.\/]*/g,""),!/^http[s]?:\/\//i.test(t))return t?this.getAttachObjectByFilename(t,(function(n,i){return e(i?i.objectUrl:t)})):e("");e(t)},t.prototype.addCover=function(e,t,n,i,r){return null==i&&(i={fixRepeatFilename:!0}),this.addAttachment(e,t,n,i,(o=this,function(e,t,n,i){var a;return a={force:!0,success:function(){return r(null,t)},error:function(e){return r(e)}},o.save({cover:t},a)}));var o},t.prototype.addAttachment=function(e,t,n,o,a){var s,l,c;return null==o&&(o={fixRepeatFilename:!0}),o=$.extend({triggerEvent:!0},o),c=this,s=arguments,l=function(e,t,n,o,a){var s,l,p,f;return l=$.Deferred(),f=t,o.fixRepeatFilename&&(f=d(c,t)),t=u(f),p=c.id,new i({_id:c.id+"__"+t}),s=function(n,i,o){var s,u,d;return c.addAttachmentMetaCache(t,e,i.attributes._attachments.attachment.digest),u=new Blob([i.id+"__"+i.get("_rev")],{type:r.fileContentType.attachment}),s=c.attachmentMeta[t],d=null!=s?s.objectUrl:void 0,c.attach(u,t,r.fileContentType.attachment,(function(){return o.triggerEvent&&c.trigger("xsj_filemodel_add_attachment_event",c,t,e,d),l.resolve()})),a(null,t,e,d)},i.createAttachment(p,t,n,e,{attachmentMeta:o.attachmentMeta},(function(e,t){return e?s():s(0,t,o)})),l},this._savingFns.push({args:s,fn:l}),this._internalSave()},t.prototype.deleteAttachment=function(e,t){var n,r,o;return o=this,n=arguments,r=function(e,t){var n,r,a;return e=u(e),n=$.Deferred(),r=function(){return o.removeAttachment(e,(function(){return delete o.attachmentMeta[e],t(),n.resolve()}))},o.id,(a=new i({_id:o.id+"__"+e})).fetch().then((function(){return a.destroy({success:function(){return r()},error:function(){return r()}})})).catch((function(){return r()})),n},this._savingFns.push({args:n,fn:r}),this._internalSave()},t.prototype.getMeta=function(){return s.getMetaData(this.get("content"))},t.prototype.saveMeta=function(e,t,n){var i,r;return i=this.get("content"),r=s.setMetaData(i,e,t),this.save({content:r,updateDate:uniqueNumber()},n)},t.prototype.getCssMeta=function(){return s.getCssMetaData(this.get("cssText"))},t.prototype.saveCssMeta=function(e,t,n){var i,r;return i=this.get("cssText"),r=s.setCssMetaData(i,e,t),this.save({cssText:r,updateDate:uniqueNumber()},n)},t.prototype.getRealContent=function(){return f(this.get("content"))},t.prototype.getSummary=function(e){var t;return null==e&&(e=200),(t=this.get("summary"))?t.substring(0,e):h(this.get("content"),e)},t.prototype.getPreviewConfig=function(e,t){var n,i,o,a,s,l,c,u,d,p;for(n in p={},l=this.getMeta(),s=function(e,t,n){return e&&e.hasOwnProperty("grammar_"+n)?p[n]=!!e["grammar_"+n]:t&&t.hasOwnProperty("grammar_"+n)?p[n]=!!t["grammar_"+n]:(p[n]=r.grammar[n].default,void 0===p[n]?p[n]=!0:void 0)},a=function(e,t,n,i){return e&&e.hasOwnProperty("grammar_"+n+"_options_"+i)?p[n+"__"+i]=e["grammar_"+n+"_options_"+i]:t&&t.hasOwnProperty("grammar_"+n+"_options_"+i)?p[n+"__"+i]=t["grammar_"+n+"_options_"+i]:(p[n+"__"+i]=r.grammar[n].options[i].value,void 0===p[n+"__"+i]?p[n+"__"+i]="":void 0)},u=r.grammar)if(o=u[n],s(l,t.attributes,n),o.options)for(i in d=o.options)d[i],a(l,t.attributes,n,i);return c={renderMetaTitle:t.get("renderMetaTitle"),renderMetaTag:t.get("renderMetaTag"),renderWrapImgTitle:t.get("renderWrapImgTitle"),renderWrapTableTitle:t.get("renderWrapTableTitle"),renderWrapDrawIOTitle:t.get("renderWrapDrawIOTitle"),renderImgBlock:t.get("renderImgBlock"),renderNestImgBlock:t.get("renderNestImgBlock"),renderAutoDetectAttachment:t.get("renderAutoDetectAttachment"),renderLinkAsFootnote:t.get("renderLinkAsFootnote"),renderTitleLinkAsFootnote:t.get("renderTitleLinkAsFootnote"),renderNumberedHeading:t.get("renderNumberedHeading"),renderNumberedHeadingOffset:t.get("renderNumberedHeadingOffset"),renderNumberedHeadingH1:t.get("renderNumberedHeadingH1"),renderNumberedHeadingH2:t.get("renderNumberedHeadingH2"),renderNumberedHeadingH3:t.get("renderNumberedHeadingH3"),renderNumberedHeadingH4:t.get("renderNumberedHeadingH4"),renderNumberedHeadingH5:t.get("renderNumberedHeadingH5"),renderNumberedHeadingH6:t.get("renderNumberedHeadingH6"),renderNumberedHeadingH7:t.get("renderNumberedHeadingH7")},function(e){var t,n;for(t in n=[],c)c[t],e&&e.hasOwnProperty(t)?n.push(c[t]=e[t]):n.push(void 0);return n}(l),{resultConfig:p,previewSet:c}},t}(a)).getMeta=p,o.getSummary=h,o.getRealContent=f,n.exports=o}}),window.requirejs.define({"models/file_tabs_model":function(e,t,n){var i,r={}.hasOwnProperty;i=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)r.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,Backbone.Model),t.prototype.defaults={tabs:[],activeTab:null,maxTabs:20},t.prototype.initialize=function(){var e;return e=localStorage.getItem("fileTabs"),this.bind("change",(function(){return localStorage.setItem("fileTabs",JSON.stringify(this.toJSON()))})),e?this.set(JSON.parse(e)):(this.set(this.defaults),localStorage.setItem("fileTabs",JSON.stringify(this.toJSON())))},t}(),n.exports=i}}),window.requirejs.define({"models/keyboard_profile_model":function(e,t,n){var i,r={}.hasOwnProperty;i=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)r.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,Backbone.Model),t.prototype.defaults={newFile:{name:"\u65b0\u5efa",command:"ctrl+shift+r"},save:{name:"\u4fdd\u5b58",command:"ctrl+s"},saveAs:{name:"\u53e6\u5b58\u4e3a",command:"ctrl+shift+s"},preview:{name:"\u9884\u89c8",command:"ctrl+shift+p"},zenWriter:{name:"\u5199\u4f5c\u6a21\u5f0f",command:"ctrl+shift+1"},zenReader:{name:"\u9605\u8bfb\u6a21\u5f0f",command:"ctrl+shift+2"},toggleStore:{name:"\u6253\u5f00\u6587\u4ef6\u7ba1\u7406\u9762\u677f",command:"ctrl+shift+f"},toggleSidebar:{name:"\u6253\u5f00\u4fa7\u8fb9\u680f",command:"ctrl+shift+b"}},t.prototype.initialize=function(){var e;return e=localStorage.getItem("KeyboardOpts"),this.bind("change",(function(){return localStorage.setItem("KeyboardOpts",JSON.stringify(this.toJSON()))})),e?this.set(JSON.parse(e)):(this.set(this.defaults),localStorage.setItem("KeyboardOpts",JSON.stringify(this.toJSON())))},t.prototype.getKeyByEvent=function(e){var t,n,i;for(t in n=this.attributes)if(i=n[t],jwerty.is(i.command,e))return t;return null},t.prototype.keyFun=function(e){switch(e){case"save":return function(e){return e.preventDefault(),$(window).trigger("saveFileModel")};case"saveAs":return function(e){return e.preventDefault(),$(window).trigger("saveAsFileModel")};case"preview":case"print":return function(e){return e.preventDefault(),e.stopPropagation(),$(window).trigger("togglePreview")};case"zenWriter":return function(e){return e.preventDefault(),$(window).trigger("toggleEditorZenMode",!0)};case"zenReader":return function(e){return e.preventDefault(),$(window).trigger("togglePreviewZenMode",!0)};case"toggleStore":return function(e){return e.preventDefault(),$(window).trigger("toggleStore")}}},t}(),n.exports=i}}),window.requirejs.define({"models/model":function(e,t,n){n.exports=Backbone.Model.extend(BackbonePouch.attachments())}}),window.requirejs.define({"models/preview_profile_collection":function(e,t,n){var i,r,o,a={}.hasOwnProperty;i=t("../constant"),o=t("./preview_profile_model"),r=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)a.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,Backbone.Collection),t.prototype.localStorage=new Backbone.LocalStorage(i.localStorage.namespace+"_preview"),t.prototype.model=o,t.prototype.getPreviewProfileModel=function(){return this.fetch(),this.length<=0&&this.create(new o),this.last()},t}(),n.exports=r}}),window.requirejs.define({"models/preview_profile_model":function(e,t,n){var i,r={}.hasOwnProperty;i=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)r.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,Backbone.Model),t.prototype.initialize=function(){return this.bind("change",(e=this,function(){var t,n,i,r,o;for(o=!1,t=0,r=(i=Object.keys(e.changed)).length;t<r;t++){if("freeLayoutTop"!==(n=i[t])&&"freeLayoutLeft"!==n&&"viewportWidth"!==n&&"viewportAlign"!==n){o=!0;break}if(n.startsWith("grammar_")||n.startsWith("render")){o=!0;break}}if(o)return e.trigger("previewConfigChanged")}));var e},t.prototype.defaults={table:"",delay:300,mathjaxRegex:"$$",aliasLang:"",minimap:!1,codePreviewCss:"auto",systemPreviewCss:"css/preview/default.css",useSystemPreviewCss:!0,userPreviewCssText:"",previewLayoutPosition:"east",disableVdomPreview:!1,freeLayoutTop:100,freeLayoutLeft:100,freeLayoutWidth:100,freeLayoutHeight:200,viewportWidth:"auto",viewportAlign:"center",renderMetaTitle:!0,renderMetaTag:!0,renderImgBlock:!0,renderNestImgBlock:!1,renderWrapImgTitle:!0,renderWrapDrawIOTitle:!0,renderWrapTableTitle:!1,renderAutoDetectAttachment:!0,renderLinkAsFootnote:!1,renderTitleLinkAsFootnote:!1,renderNumberedHeading:!1,renderNumberedHeadingOffset:"",renderNumberedHeadingH1:"counter('h1', '%s\u3001', 'simp-chinese-informal');",renderNumberedHeadingH2:"counter('h2', '%s. ');",renderNumberedHeadingH3:"counter('h2');counter('h3', '%s. ');",renderNumberedHeadingH4:"counter('h2');counter('h3');counter('h4', '%s. ');",renderNumberedHeadingH5:"counter('h2');counter('h3');counter('h4');counter('h5', '%s. ');",renderNumberedHeadingH6:"counter('h2');counter('h3');counter('h4');counter('h5');counter('h6', '%s. ');",renderNumberedHeadingH7:"counter('h2');counter('h3');counter('h4');counter('h5');counter('h6');counter('h7', '%s. ');"},t}(),n.exports=i}}),window.requirejs.define({"models/profile_model":function(e,t,n){var i={}.hasOwnProperty;(function(e){function t(){return t.__super__.constructor.apply(this,arguments)}(function(e,t){for(var n in t)i.call(t,n)&&(e[n]=t[n]);function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype})(t,Backbone.Model),t.prototype.default={theme:"ace/theme/chrome",currentMd:"",pouchDbDocId:"",evernote:{},viewMode:"viewMode-normal",keyBinding:"ace",showInvisibles:!1,bodyFont:"",editorFont:"",showGutter:!1,customCss:"",autosave:{enabled:!0,interval:6e4},current_filename:"\u672a\u547d\u540d\u6587\u4ef6"}})()}}),window.requirejs.define({"models/store_plugin_collection":function(e,t,n){var i,r,o={}.hasOwnProperty;t("../constant"),r=t("./store_plugin_model"),i=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)o.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(n,Backbone.Collection),n.prototype.model=r,n.prototype.localStorage=r.localStorage,n.prototype.getPlugin=function(e){var n,i,r,o,a;return a=null,(r=this.get(e))&&(n=t("../application"),o=r.get("name"),"store"===(i=r.get("kind"))?(a=n.plugins[o]).init(r):"resource"===i&&(a=n.resourcePlugins[o]).init(r)),a},n.prototype.getModelByName=function(e){var t;return e?(t=this.where({name:e})).length>0?t[0]:void 0:null},n.prototype.getEntryTokenByName=function(e){var t;return(t=this.getPluginModelByName(e))?t.get("entryToken"):""},n}(),n.exports=i}}),window.requirejs.define({"models/store_plugin_model":function(e,t,n){var i,r,o,a={}.hasOwnProperty;i=t("../constant"),o=new Backbone.LocalStorage(i.localStorage.namespace+"-storePlugin"),(r=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)a.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,Backbone.Model),t.prototype.localStorage=o,t.prototype.default={name:"",kind:"store",displayName:"",entryToken:"",entryTokenSecret:"",extraInfo:"",username:"",userDisplayName:"",userAvatar:"",email:"",extraSettings:{}},t}()).localStorage=o,n.exports=r}}),window.requirejs.define({"models/tag_model":function(e,t,n){var i,r={}.hasOwnProperty;i=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)r.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,Backbone.Model),t.prototype.initialize=function(){var e;return e=localStorage.getItem("tagNames"),this.bind("change",(function(){return localStorage.setItem("tagNames",JSON.stringify(this.toJSON()))})),e?this.set(JSON.parse(e)):(this.set(this.defaults),localStorage.setItem("tagNames",JSON.stringify(this.toJSON())))},t.prototype.getTags=function(e){var t,n,i,r;switch(t=this.toJSON(),i=Object.keys(t),r=[],e){case"user":r=function(){var e,r,o;for(o=[],e=0,r=i.length;e<r;e++)n=i[e],"user"===t[n].type&&o.push(n);return o}();break;case"auto":r=function(){var e,r,o;for(o=[],e=0,r=i.length;e<r;e++)n=i[e],"auto"===t[n].type&&o.push(n);return o}();break;default:r=i}return r},t.prototype.addTag=function(e,t){var n,i;return null==t&&(t={type:"auto"}),"auto"!==(i=this.get(e)||{type:"auto",count:0}).type&&"auto"===t.type&&(t.type=i.type),t=$.extend({count:0,type:"auto"},i,t),$.isNumeric(t.count)||(n=0),n=parseInt(n),t.count=t.count+1,this.set(e,t)},t.prototype.deleteTag=function(e){return this.unset(e)},t}(),n.exports=i}}),window.requirejs.define({"models/tour_model":function(e,t,n){var i,r={}.hasOwnProperty;i=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)r.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,Backbone.Model),t.prototype.defaults={group_tab_draggable_learned:!1,close_timeline_learned:!1,lock_file_horizontal_tabs_learned:!1,create_group_learned:!1,open_store_learned:!1,stick_filter_mode_learned:!1,drag_outline_learned:!1,only_preview_mode_learned:!1,editor_zen_learned:!1,preview_zen_learned:!1,mark_list_window_learned:!1,protocol_registry_learned:!1,app_and_article_theme_manager_learned:!1,auto_convert_html_to_markdown_learned:!1},t.prototype.initialize=function(){var e;return e=localStorage.getItem("tourInfo"),this.bind("change",(function(){return localStorage.setItem("tourInfo",JSON.stringify(this.toJSON()))})),e?this.set(JSON.parse(e)):(this.set(this.defaults),localStorage.setItem("tourInfo",JSON.stringify(this.toJSON())))},t.prototype.dontPrompt=function(e){return this.set(e,!0)},t.prototype.canPrompt=function(e){return!MINI_WEB&&!this.get(e)},t}(),n.exports=i}}),window.requirejs.define({"models/user_model":function(e,t,n){var i,r={}.hasOwnProperty;(i=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)r.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,Backbone.Model),t.prototype.defaults={token:"",user:{},logoutClearConfig:!1},t.prototype.initialize=function(){var e;return e=localStorage.getItem("user"),this.bind("change",(function(){return localStorage.setItem("user",JSON.stringify(this.toJSON()))})),e?this.set(JSON.parse(e)):(this.set(this.defaults),localStorage.setItem("user",JSON.stringify(this.toJSON())))},t}()).defaultMacStoreUser={token:"mac",user:{id:0,vip:!0,expireDate:moment().add(100,"years").toDate(),isTempVip:!1,emailVerified:!1,email:"macstore@xiaoshujiang.com",configSyncLive:!1,configSyncRange:[],applyingVip:!1}},n.exports=i}}),window.requirejs.define({"views/about_view":function(e,t,n){var i,r,o,a,s,l,c,u,d,p,f,h,m,v,g={}.hasOwnProperty;u=t("./view"),s=t("../constant"),r=t("../application"),m=t("./templates/about"),o=t("./cache_upgrade_dialog_view"),a=t("./client_upgrade_dialog_view"),p=t("../lib/check_new_version"),c=t("../lib/utils"),l=t("../lib/notifier"),v=null,d=null,f=function(){var e,t,n,i;return e={},e="client"===STORY_PLATFORM?{arch:(n=require("os")).arch(),cpus:n.cpus(),endianness:n.endianness(),freemem:n.freemem(),platform:n.platform(),release:n.release(),tmpdir:n.tmpdir(),totalmem:n.totalmem(),type:n.type(),nwjs:{version:process.versions["node-webkit"]}}:{appCodeName:(t=navigator).appCodeName,appName:t.appName,appVersion:t.appVersion,cookieEnabled:t.cookieEnabled,language:t.language,platform:t.platform,product:t.product,productSub:t.productSub,userAgent:t.userAgent,vendor:t.vendor,vendorSub:t.vendorSub},i=window.screen,Object.assign(e,{db:{options:s.pouchDBOptions},screen:{availHeight:i.availHeight,availLeft:i.availLeft,availTop:i.availTop,availWidth:i.availWidth,colorDepth:i.colorDepth,height:i.height,width:i.width,screenLeft:window.screenLeft,screenTop:window.screenTop}}),e},h=function(){var e,t,n;return e=r.getApplicationProfileModel(),t=r.getEditorProfileModel(),n=r.getPreviewProfileModel(),{apm:{storePlugin:e.get("plugin"),font:e.get("font")},epm:{editorType:t.get("editorType"),theme:t.get("theme"),cm_spellChecker:t.get("cm_spellChecker")},ppm:{previewLayoutPosition:n.get("previewLayoutPosition")}}},i=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)g.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(n,e),n.prototype.template=m,n.prototype.getRenderData=function(){var e,t,n,i,o,a,s,l;return t="",i="",n="",s="",r.getNonSecurity()&&(s="checked"),e=APP_VERSION,"client"===STORY_PLATFORM&&(o=require("nw.gui"),l=require("path"),t=o.App.dataPath,n=process.execPath,i=l.join(t,"story_exceptions.log"),window.CLIENT_APP_VERSION&&(e=APP_VERSION+"("+window.CLIENT_APP_VERSION+")")),a="\u5173\u4e8e\u5c0f\u4e66\u5320",MAC_STORE_WEB&&(a="\u5173\u4e8e\u5c0f\u4e66\u5320 Ginkgo",e=window.getMacVersion?window.getMacVersion():"\u6700\u65b0"),{headerStr:a,appVersion:e,dataPath:t,execPath:n,execptionFilePath:i,nonSecurity:s}},n.prototype.className="ui small modal about_xsj_modal",n.prototype.events={"click .client_upgrade_new_version_button":"openClientUpgradeDialogView","click .cache_upgrade_new_version_button":"openCacheUpgradeDialogView","click .pwa_upgrade_button":"openPwaInstallDialogViewFn","click .sw_cache_reset_button":"resetServiceWorkerCacheFileFn","click .open_folder_btn":"openDataPathFolderFn","click .reset_panel_btn":"resetPanelBtn"},n.prototype.resetServiceWorkerCacheFileFn=function(e){var t;if(!(t=$(e.currentTarget)).hasClass("loading"))return t.addClass("loading"),resetServiceWorkerCacheFileFn().then((function(){return l.showMessage("\u91cd\u7f6e\u5b89\u88c5\u6587\u4ef6\u6210\u529f, \u8bf7\u5237\u65b0\u9875\u9762"),t.removeClass("loading")})).catch((function(e){return console.error(e),l.showMessage("\u91cd\u7f6e\u5b89\u88c5\u6587\u5931\u8d25"+e,6e3,"error"),t.removeClass("loading")}))},n.prototype.openPwaInstallDialogViewFn=function(){return t("../lib/pwa_manager").showInstallView(!1)},n.prototype.resetPanelBtn=function(){var e;if(confirm("\u91cd\u7f6e\u540e\u9700\u8981\u91cd\u542f\u5e94\u7528"))return(e=r.homeView.layout).deleteCookie(),e.options.stateManagement.autoSave=!1,"client"!==STORY_PLATFORM?document.location.reload():global.restartXSJApp()},n.prototype.openDataPathFolderFn=function(){var e;return e=require("nw.gui").App.dataPath,nw.Shell.showItemInFolder(e)},n.prototype.openClientUpgradeDialogView=function(){return(new a).show()},n.prototype.openCacheUpgradeDialogView=function(){return(new o).show()},n.prototype.show=function(){var e,t,n,i;return v=this,this.render(),MAC_STORE_WEB&&this.$el.find(".about_tab_content").remove(),"client"===STORY_PLATFORM&&(i=this.$el.find(".new_version"),e=this.$el.find(".cache_upgrade_new_version_button"),t=this.$el.find(".client_upgrade_new_version_button"),n=this.$el.find(".manual_upgrade_new_version_button"),p.checkNewVersion((function(r,o,a,s,l){return r?i.html('<span class="ui compact message error mini">\u8fde\u63a5\u5f02\u5e38</span>'):(i.html(s.version),o?a?e.show():s.autoUpgrade?t.show():(n.find(".client_version").html(s.clientVersion||s.version),n.show()):void 0)}))),"web"===STORY_PLATFORM&&(v.$el.find(".about_tab_content .menu .item[data-tab=client]").remove(),v.$el.find(".about_tab_content .menu .item[data-tab=info]").addClass("active"),v.$el.find(".about_tab_content .tab[data-tab=client]").remove(),v.$el.find(".about_tab_content .tab[data-tab=info]").addClass("active"),(/^https:/i.test(document.location.protocol)||"localhost"===document.location.hostname)&&v.$el.find(".pwa_upgrade_button").after('<a href="javascript:void(0);" class="sw_cache_reset_button ui basic button positive mini">\u91cd\u7f6e\u5b89\u88c5\u6587\u4ef6</a>')),this.$el.modal({closable:!1,onVisible:function(){var e,t,n,i,r;if($("body").dimmer({closable:!1,useCSS:!0}),!MAC_STORE_WEB)return v.$el.find(".xsj_non_security_checkbox").checkbox({onChecked:function(){return $(window).trigger("changeXsjNonSecurityMode",!0)},onUnchecked:function(){return $(window).trigger("changeXsjNonSecurityMode",!1)}}),n=f(),r=h(),t=(t=js_beautify(JSON.stringify(n)))+"\n"+js_beautify(JSON.stringify(r)),v.$el.find(".about_tab_content .tab[data-tab=info] code").text(t),hljs.highlightElement(v.$el.find(".about_tab_content .tab[data-tab=info] code")[0]),v.$el.find(".about_tab_content .menu .item").tab(),e=$(c.generateXSJSVGLogo()),v.$el.append(e),v.$el.parent().addClass("for_ascii_morph"),d||!navigator.onLine||MINI_WEB||(i="/get/ascii_art","client"===STORY_PLATFORM&&(i="http://markdown.xiaoshujiang.com"+i),$.get(i,(function(e){var t,n,i,r;if((n=$(".for_ascii_morph")).length>=1)return t=$("<pre class='ascii_morph' style='z-index:-1;top:0px;overflow:hidden;position:absolute;pointer-events:none;opacity:.3'></pre>"),n.append(t),AsciiMorph(t[0],{x:e.x,y:e.y}),r=1,i=e.data,AsciiMorph.render(i[0]),d=setInterval((function(){return AsciiMorph.morph(i[r]),r++,r%=i.length}),6e3)}))),e.transition("scale");v.$el.find(".about_tab_content").remove()},onHidden:function(){return MAC_STORE_WEB||(v.$el.find(".about_tab_content .menu .item").tab("destroy"),v.$el.find(".xsj_non_security_checkbox").checkbox("destroy")),d&&(clearInterval(d),d=null),$(".for_ascii_morph>.ascii_morph").remove(),v.$el.modal("destroy"),v.remove(),v=null}}),c.asyncLoadResources([{id:"ascii_morph_js",type:"script",filename:"js/asciiMorph.js"},{id:"beautify_js",type:"script",filename:"js/beautify/beautify.js"}],(function(){return v.$el.modal("show")}))},n}(u),n.exports=i}}),window.requirejs.define({"views/ace_editor_minimap_view":function(e,t,n){var i,r,o,a,s,l,c,u,d,p,f,h,m=function(e,t){return function(){return e.apply(t,arguments)}},v={}.hasOwnProperty;r=t("./view"),f=t("./templates/ace_editor_minimap"),h=null,s=function(e){var t,n,i,r;return n=e.clientY-h.startY,r=(t=h.handleStartY+n)/(h.wHeight*(1-h.ratio)),i=h.overflow*r,t=t>0?t:0,h.editor.renderer.scrollToY((t+i)/h.ratio)},o=function(e){return $("html").off("mousemove",s)},u=function(e,t){var n;return n=h.overflow*e,h.$el.find("pre").css("margin-top",-n),h.$el.find(".background").css({top:t*h.ratio-n})},c=function(){var e,t;return e=(t=h.editor.renderer.scrollTop)/(h.cHeight-h.wHeight),u(e,t)},l=function(e){var t,n,i,r,o,a,s,l,c,u;return r=(t=h.$el.find(".code")).parent().width(),h.wWidth=$(h.editor.renderer.container).width(),h.wHeight=$(h.editor.renderer.container).height(),n=h.editor.renderer.lineHeight*h.editor.session.getScreenLength(),i=h.editor.renderer.characterWidth*h.editor.session.getScreenWidth(),h.cHeight=n,h.cWidth=i||h.wWidth,s=(c=Math.floor(h.cHeight*(r/h.cWidth)))-h.wHeight,l=c/h.cHeight,h.scaledHeight=c,h.ratio=l,h.overflow=s>0?s:0,h.$el.find(".background").height(h.wHeight*l),u=h.editor.session.getUseWrapMode(),a=h.editor.getFontSize(),(2*h.editor.renderer.characterWidth-a)/2,o={width:h.cWidth,height:h.cHeight,fontFamily:h.editor.fontName,lineHeight:h.editor.renderer.lineHeight+"px",fontSize:2*h.editor.renderer.characterWidth+"px",transform:"scale("+h.ratio+", "+h.ratio+")"},u?$.extend(o,{wordWrap:"break-word",wordBreak:"break-all",whiteSpace:"pre-wrap"}):$.extend(o,{overflow:"hidden",width:h.wWidth}),t.css(o)},p=function(){var e;if(h)return e=h.editor.getSession().getValue(),h.worker.postMessage({code:e,mode:"markdown"})},d=_.throttle(p,2e3,{leading:!1}),a=null,i=function(e){function t(){return this.preClick=m(this.preClick,this),t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)v.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.className="ace_minimap editor_minimap",t.prototype.template=f,t.prototype.worker=null,t.prototype.unselectableClass="g-unselectable",t.prototype.ratio=0,t.prototype.initialize=function(e){return h=this,this.editor=e.editor,this.worker=new Worker("./js/minimap/worker.js"),a=this.getWorkerResult.bind(this),this.worker.addEventListener("message",a)},t.prototype.events={"click pre":"preClick","mousedown .background":"startDrag"},t.prototype.startDrag=function(e){return h.startY=e.clientY,h.handleStartY=h.$el.find(".background").position().top,$("html").on("mousemove",s).on("mouseup mouseleave",o)},t.prototype.preClick=function(e){var t,n,i;return i=(t=e.clientY-h.$el.find(".background").height()/2)/(h.wHeight*(1-h.ratio)),n=h.overflow*i,t=t>0?t:0,h.editor.renderer.scrollToY((t+n)/h.ratio)},t.prototype.getWorkerResult=function(e){if(h)return this.$el.find(".code").text(e.data.code),l(),c()},t.prototype.resetMap=function(){return this.$el.html(this.template()),this.$el.find(".background").css("height",0)},t.prototype.destroyMinimap=function(){return this.worker&&(a&&(this.worker.removeEventListener("message",a),a=null),this.worker.terminate(),this.worker=null),h.editor.session.off("changeScrollTop",c),h.editor.session.off("change",d),h.remove(),h=null},t.prototype.resize=function(){return l(),c()},t.prototype.initMinimap=function(){return h.editor.session.on("changeScrollTop",c),h.editor.session.on("change",d),d()},t}(r),n.exports=i}}),window.requirejs.define({"views/ace_editor_view":function(e,t,n){var i,r,o,a,s,l,c,u,d,p,f,h,m,v,g={}.hasOwnProperty;l=t("./view"),a=t("../lib/utils"),s=t("../lib/utils_size"),o=t("../application"),i=t("./ace_editor_minimap_view"),m=t("./templates/ace_editor"),c={ace:null,vim:"ace/keyboard/vim",emacs:"ace/keyboard/emacs"},f=s.setViewPortSize,p=function(e){var t,n;return e?(v.editor.fontName=e+", 'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', 'source-code-pro', 'Courier', 'Lucida Console', monospace",t=function(e){return".ace_editor, .codemirror_editor_wrapper .CodeMirror-line, .light_editor{font-family: "+e+"'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', 'source-code-pro', 'Courier', 'Lucida Console', monospace}"},n=a.parseCssText(t(e+", "),t("")),a.importCssString(n,"custom-editor-font-style",!0,document)):($("#custom-editor-font-style").remove(),void(v.editor.fontName="'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', 'source-code-pro', 'Courier', 'Lucida Console', monospace"))},h={bold:{win:"Ctrl-B",mac:"Command-B|Ctrl-B"},italic:{win:"Ctrl-I",mac:"Command-I|Ctrl-I"},mark:{win:"Ctrl-M",mac:"Command-M|Ctrl-M"},link:{win:"Ctrl-L",mac:"Command-L|Ctrl-L"},quote:{win:"Ctrl-Q",mac:"Command-Q|Ctrl-Q"},code:{win:"Ctrl-K",mac:"Command-K|Ctrl-K"},image:{win:"Ctrl-G",mac:"Command-G|Ctrl-G"},olist:{win:"Ctrl-O",mac:"Command-O|Ctrl-O"},ulist:{win:"Ctrl-U",mac:"Command-U|Ctrl-U"},heading:{win:"Ctrl-H",mac:"Command-H|Ctrl-H"},rheading:{win:"Ctrl-Shift-H",mac:"Command-Shift-H|Ctrl-Shift-H"},hr:{win:"Ctrl-R",mac:"Command-R|Ctrl-R"},moment:{win:"Ctrl-.",mac:"Command-.|Ctrl-."},magnet:{win:"Ctrl-Shift-m",mac:"Command-Shift-m|Ctrl-Shift-m"},undo:{win:"Ctrl-Z",mac:"Command-Z"},redo:{win:"Ctrl-Y|Ctrl-Shift-Z",mac:"Command-Y|Command-Shift-Z"}},d=function(e){var t,n,i,r,o;return null==e&&(e=0),!v.editor.getReadOnly()&&(o=v.getCursorPositionXY(),r=v.getScrollTop()+v.documentToScreenRowHeight(o.row+e,o.column),n=v.editor.renderer.lineHeight*v.editor.session.getScreenLength(),t=v.$el.height()/2,(i=Math.round(r-t))+2*t>n&&(i=n-2*t),i<0&&(i=0),v.scrollToY(i))},u=function(e,t){var n;return 0===v.editor.getSelectedText().length&&("insert"===e.action||"remove"===e.action?(n=0,"\n"===e.lines.join("\n")&&(n="insert"===e.action?1:-1),d(n)):void 0)},v=null,r=function(e){var t,n;function r(){return r.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)g.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(r,e),r.prototype.fileModel=null,r.prototype.template=m,r.prototype.className="ace_editor_wrapper main_content_wrapper",r.prototype.editor=null,r.prototype.rootEditorProxy=null,n=null,r.prototype.editorView=null,r.prototype.initialize=function(e){return v=this,this.fileModel=e.fileModel,this.editorView=e.editorView,this.rootEditorProxy=this,this.listenTo(this.model,"change",this.setEditorConfig)},r.prototype.initEditor=function(e,t,n){var i,r,s;return this.render(),this.layout=t,this.$el.appendTo(e),i=this.$el.find(".ace_editor"),r=null,window.aceMarkdown?setTimeout((function(){return r()}),0):a.asyncLoadResources([{id:"ace_js",type:"script",filename:"js/ace/ace.js"}],(function(){return a.asyncLoadResources([{id:"ace_ext_language_tools_js",type:"script",filename:"js/ace/ext-language_tools.js"},{id:"ace_mode_markdown_js",type:"script",filename:"js/ace/mode-markdown.js"},{id:"ace_keybinding_vim_js",type:"script",filename:"js/ace/keybinding-vim.js"},{id:"ace_ext_linking_js",type:"script",filename:"js/ace/ext-linking.js"},{id:"ace_keybinding_emacs_js",type:"script",filename:"js/ace/keybinding-emacs.js"}],(function(){return window.aceMarkdown=!0,r()}))})),s=this,r=function(){var e,t,r;return ace.require("ace/ext/language_tools"),s.editor=ace.edit(i[0].id),e={getCompletions:function(e,t,n,i,r){var o,a,s,l,c,u,d,p,f,h,m;if(!((p=t.doc.getLine(n.row)).indexOf("?"+i)>=0)&&(l=/^````*\s?([\w\!\?]+)$|^~~~~*\s?([\w\!\?]+)$/,a=p.match(l))){for(s=a[0].indexOf(a[1]),c=a[0].substring(0,s),a[1],h=function(){var e,t,n,i;for(n=hljs.listLanguages(!0),i=[],o=e=0,t=n.length;e<t;o=++e)m=n[o],i.push({name:m,value:m});return i}(),f=hljs.listLanguages(!0),o=u=0,d=f.length;u<d;o=++u)m=f[o],h.push({name:m+"?linenums",value:m+"?linenums"});return h.push({name:"mathjax!",value:"mathjax!"}),h.push({name:"wavedrom!",value:"wavedrom!"}),h.push({name:"mermaid!",value:"mermaid!"}),h.push({name:"mindmap!",value:"mindmap!"}),h.push({name:"plot!",value:"plot!"}),h.push({name:"flow!",value:"flow!"}),h.push({name:"sequence!",value:"sequence!"}),h.forEach((function(e){return e.snippetxx=e.value+"\n${0}\n"+c+"\n"})),r(null,h)}}},t={getCompletions:function(e,t,n,i,r){var a,s,l,c,u;if(0===t.doc.getLine(n.row).indexOf("tags: ")){for(l=[],a=0,s=(u=o.getTagModel().getTags()).length;a<s;a++)c=u[a],l.push({name:c,value:c});return r(null,l)}}},s.editor.setOptions({enableBasicAutocompletion:!1,enableLiveAutocompletion:[e,t],enableSnippets:!0,enableLinking:!0}),s.setEditorConfig(),s.setEditorContent(),r=s.editor.session.getUndoManager(),s.undoManager={setCommandMode:function(){},onButtonStateChange:function(){},undo:function(){return r.undo()},redo:function(){return r.redo()},canUndo:function(){return r.hasUndo()},canRedo:function(){return r.hasRedo()}},s.editor.session.on("change",(function(){return v.undoManager.onButtonStateChange()})),s.bindEvent(),s.editor.on("focus",(function(){return v.editorView.setActiveEditorProxy(v)})),s.initContextMenu(),"function"==typeof n?n():void 0}},r.prototype.initContextMenu=function(){var e,t;if(t="none",e=".editor-tool","client"===STORY_PLATFORM&&(t="right",e=".ace_editor"),$.contextMenu({selector:e,trigger:t,build:function(e,t){var n,i,r,o,s,l,c,u;return"client"===STORY_PLATFORM&&(n=window.nw.Clipboard.get(),r=n.get("text"),i=n.get("html")),u=v.editor.getSession().getTextRange(),s={pasteAsTextToMarkdown:{name:"\u5c06\u6587\u672c\u8f6c\u6362\u6210 markdown \u8fdb\u884c\u7c98\u8d34",callback:function(){var e,t,i;return e=a.html2markdown(r),i=n.readAvailableTypes().map((function(e){return{type:e}})),t=n.get(i),n.set(e,"text"),v.editor.focus(),document.execCommand("paste"),n.set(t)}},pasteAsHtmlToMarkdown:{name:"\u5c06\u5bcc\u6587\u672c\u8f6c\u6362\u6210 markdown \u8fdb\u884c\u7c98\u8d34",disabled:!i,callback:function(){var e,t,r;return e=a.html2markdown(i),r=n.readAvailableTypes().map((function(e){return{type:e}})),t=n.get(r),n.set(e,"text"),v.editor.focus(),document.execCommand("paste"),n.set(t)}},pasteAsHtml:{name:"\u76f4\u63a5\u7c98\u8d34html\u7247\u6bb5",disabled:!i,callback:function(){var e,t,r;return e=a.tidyHtml(i),r=n.readAvailableTypes().map((function(e){return{type:e}})),t=n.get(r),n.set(e,"text"),v.editor.focus(),document.execCommand("paste"),n.set(t)}},subsep1:"---------",pasteAsModal:{name:"\u66f4\u591a\u7c98\u8d34 ...",callback:function(){return $("#wmd-html-button").trigger("click")}}},c="\u7c98\u8d34","client"!==STORY_PLATFORM&&(c="\u7c98\u8d34\u4e3a ..."),l={name:c,callback:function(){return v.editor.focus(),"client"===STORY_PLATFORM?document.execCommand("paste"):$("#wmd-html-button").trigger("click")}},o={undo:{name:"\u64a4\u6d88",disabled:!v.undoManager.canUndo(),callback:function(){return v.undoManager.undo()}},redo:{name:"\u91cd\u505a",disabled:!v.undoManager.canRedo(),callback:function(){return v.undoManager.redo()}},sep1:"---------",cut:{name:"\u526a\u5207",disabled:!u,callback:function(){return v.editor.focus(),document.execCommand("cut")}},copy:{name:"\u590d\u5236",disabled:!u,callback:function(){return v.editor.focus(),document.execCommand("copy")}},paste:l},"client"===STORY_PLATFORM&&Object.assign(o,{pasteAs:{name:"\u7c98\u8d34\u4e3a ...",items:s}}),Object.assign(o,{sep2:"---------",selectAll:{name:"\u9009\u62e9\u5168\u90e8",callback:function(){return v.editor.getSession().getSelection().selectAll()}}}),{items:o}}}),"client"!==STORY_PLATFORM)return $(document).on("contextmenu",".ace_editor",(function(t){if(t.ctrlKey)return t.preventDefault(),t.stopPropagation(),$(e).trigger($.Event("contextmenu",{pageX:t.pageX,pageY:t.pageY,data:t.data}))}))},r.prototype.destroyContextMenu=function(){var e;if(e=".editor-tool","client"===STORY_PLATFORM&&(e=".ace_editor"),$.contextMenu("destroy",e),"client"!==STORY_PLATFORM)return $(document).off("contextmenu",".ace_editor")},r.prototype.destroyEditor=function(){var e;return null!=(e=this.aceEditorMinimapView)&&e.destroyMinimap(),this.aceEditorMinimapView=null,this.editor.off("change",u),this.editor.setSession(null),this.editor.destroy(),this.editor.renderer=null,this.editor.container=null,this.editor=null,this.editorView=null,this.remove(),this.destroyContextMenu(),v=null},r.prototype.toggleZenMode=function(e){return e?this.$el.addClass("ui piled segment zen_mode"):this.$el.removeClass("ui piled segment zen_mode")},r.prototype.resize=function(){var e,t;if(this.$el.parent().width()<1024||!this.layout.center.children.layout1.east.state.isClosed?(null!=(t=this.aceEditorMinimapView)&&t.destroyMinimap(),this.aceEditorMinimapView=null):this.aceEditorMinimapView?this.aceEditorMinimapView.resize():!1!==this.model.get("minimap")&&(e=new i({editor:this.editor}),this.$el.before(e.render().$el),e.initMinimap(),this.aceEditorMinimapView=e),this.editor)return this.editor.resize()},t=_.debounce((function(e){return e.resize()}),1e3),r.prototype.changeFileModel=function(e){return this.fileModel=e,this.editor.getSession().setValue(this.fileModel.get("content"))},r.prototype.setEditorContent=function(){if(this.fileModel)return this.editor.getSession().setValue(this.fileModel.get("content"))},r.prototype.setEditorConfig=function(){var e,r,o,a,s,l,d,h;if(o=this.model.get("fontSize")||16,(s=this.model.get("lineHeight"))||(s=1.4*o/16),this.editor.container.style.lineHeight=s,this.editor.getSession().setUseWrapMode(this.model.get("useWrapMode")),this.editor.getSession().setTabSize(this.model.get("tabSize")||4),this.editor.getSession().setUseSoftTabs(this.model.get("softTab")),this.editor.setShowPrintMargin(this.model.get("showPrintMargin")),this.editor.setFontSize(o),this.editor.getSession().setMode(this.model.get("mode")),this.editor.setKeyboardHandler(c[this.model.get("keyBinding")],(h=this,function(){if(n)return h.editor.keyBinding.addKeyboardHandler(n,1)})),r=this.model.get("codeFolding")||"markbeginend",this.editor.session.setFoldStyle(r),this.editor.setShowFoldWidgets("manual"!==r),this.editor.setOption("wrap",this.model.get("softWrap")||"free"),this.editor.setOption("scrollPastEnd",this.model.get("scrollPastEnd")),this.editor.setOption("selectionStyle",this.model.get("selectStyle")?"line":"text"),this.editor.setHighlightActiveLine(this.model.get("highlightActive")),this.editor.setDisplayIndentGuides(this.model.get("displayIndentGuides")||!1),this.editor.setAnimatedScroll(!!this.model.get("animateScroll")),void 0===(a=this.model.get("highlightSelectedWord"))&&(a=!0),this.editor.setHighlightSelectedWord(a),(d=this.model.get("showGutter"))?this.$el.addClass("ace_show_gutter_number"):this.$el.removeClass("ace_show_gutter_number"),this.editor.renderer.setShowGutter(d),this.editor.setShowInvisibles(this.model.get("showInvisibles")),this.model.get("typewriterScrolling")?this.editor.on("change",u):this.editor.off("change",u),p(this.model.get("editorFont")),f(this.model.get("viewportWidth"),this.model.get("viewportAlign"),this.$el),t(this),ace.require("ace/keyboard/vim").CodeMirror.Vim.defineEx("write","w",(function(){return $(window).trigger("saveFileModel")})),!1!==this.model.get("minimap")){if(this.aceEditorMinimapView||this.$el.parent().width()<1024||!this.layout.center.children.layout1.east.state.isClosed)return;return e=new i({editor:this.editor}),this.$el.before(e.render().$el),e.initMinimap(),this.aceEditorMinimapView=e}return null!=(l=this.aceEditorMinimapView)&&l.destroyMinimap(),this.aceEditorMinimapView=null},r.prototype.getValue=function(){return this.editor.session.getValue()},r.prototype.getLength=function(){return this.editor.session.getLength()},r.prototype.getScreenLength=function(){return this.editor.session.getScreenLength()},r.prototype.getRowLength=function(e){return this.editor.session.getRowLength(e)},r.prototype.screenToDocumentRow=function(e){return this.editor.session.screenToDocumentRow(e+1,0)},r.prototype.screenToDocumentRowHeight=function(e){return(e+=1)*this.editor.renderer.lineHeight-this.editor.session.getScrollTop()},r.prototype.documentToScreenRow=function(e){return this.editor.session.documentToScreenRow(e+1,0)},r.prototype.documentToScreenRowHeight=function(e,t){return null==t&&(t=0),(e=this.editor.session.documentToScreenRow(e+1,t))*this.editor.renderer.lineHeight-this.editor.session.getScrollTop()},r.prototype.getScrollTop=function(){return this.editor.session.getScrollTop()},r.prototype.getFirstVisibleRow=function(){return this.editor.getFirstVisibleRow()},r.prototype.getLastVisibleRow=function(e){return this.editor.getLastVisibleRow()},r.prototype.getCursorPositionScreen=function(){return this.editor.getCursorPositionScreen().row},r.prototype.getCursorPosition=function(){return this.editor.getCursorPosition().row},r.prototype.getCursorPositionXY=function(){return this.editor.getCursorPosition()},r.prototype.highlightLines=function(e,t){return this.editor.session.highlightLines(e,t).id},r.prototype.removeMarker=function(e){return this.editor.session.removeMarker(e)},r.prototype.addCommands=function(e){var t;return t=this.editor,Object.keys(e).forEach((function(n){var i,r,o,a;return o=e[n],r=[],i=[],(a=h[n.substring("xsj_".length)])&&(a.mac&&i.push(a.mac),a.win&&r.push(a.win)),o.shortcuts&&o.shortcuts.length>0&&o.shortcuts.forEach((function(e){if(e.aceValue)return"mac"===e.platform?i.push(e.aceValue):r.push(e.aceValue)})),t.commands.addCommand({name:n,bindKey:{win:r.join("|"),mac:i.join("|")},exec:function(e){return o.fn(e)}})}))},r.prototype.execCommand=function(e,t,i){var r;return r=this.editor,n&&n.commands[e]?(i&&(i.preventDefault(),i.stopPropagation()),n.exec(e,r,null!=t?t.args:void 0)):r.commands.commands[e]?(i&&(i.preventDefault(),i.stopPropagation()),r.execCommand(e,null!=t?t.args:void 0)):void 0},r.prototype.bindUserKeyBoard=function(e){var t,i,r,a,s;return n&&(this.editor.keyBinding.removeKeyboardHandler(n),n=null),t=ace.require("./commands/command_manager").CommandManager,i=this.editor.commands.commands,a={},e&&e.length>0&&e.forEach((function(e){var t;if(!e.range||"editor"===(t=e.range)||"all"===t)return e.shortcuts&&e.shortcuts.length>0?e.shortcuts.forEach((function(t){var n;if(t.aceValue)if((n=a[e.command+"::::"+e.args])||(n={winKey:[],macKey:[],bindInfo:e},a[e.command+"::::"+e.args]=n),"mac"===t.platform){if(n.macKey.indexOf(t.aceValue)<0)return n.macKey.push(t.aceValue)}else if(n.winKey.indexOf(t.aceValue)<0)return n.winKey.push(t.aceValue)})):void 0})),r=[],Object.keys(a).forEach((function(e){var t,n,s,l;if(l=e.split("::::"),n=l[0],l[1],s=a[e],t=null,i[n]?t=_.clone(i[n]):o.hasCommand(n)&&(t={name:"___xsj_ace_"+e,readOnly:!0,exec:function(e){var t;if(t=s.bindInfo,o.hasCommand(n))return o.execCommand(t.command,t)}}),t)return s&&s.bindInfo&&s.bindInfo.args&&(t.args=s.bindInfo.args),t.bindKey={win:s.winKey.join("|"),mac:s.macKey.join("|")},r.push(t)})),n=new t(null,r),s=n.handleKeyboard,n.handleKeyboard=function(){var e;return(e=s.apply(n,arguments))&&e.command&&e.command.args&&(e.args=e.command.args),e},this.editor.keyBinding.addKeyboardHandler(n,1)},r.prototype.bindEvent=function(e,t){return this.editor.session.selection.on("changeCursor",(function(){return v.$el.parent().trigger("changeCursor")})),this.editor.session.on("change",(function(){return v.$el.parent().trigger("contentChange")})),this.editor.session.on("changeScrollTop",(function(){return v.$el.parent().trigger("editorScroll")})),this.editor.session.on("changeSelection",(function(){return v.$el.parent().trigger("changeSelection")}))},r.prototype.getSelectionRange=function(){var e,t,n,i;return e=ace.require("ace/range").Range,n=this.editor.selection.getRange(),t=this.editor.session.getTextRange(new e(0,0,n.start.row,n.start.column)),i=this.editor.session.getTextRange(n),this.editor.session.getTextRange(new e(n.end.row,n.end.column,Number.MAX_VALUE,Number.MAX_VALUE)),{start:t.length,end:t.length+i.length}},r.prototype.setSelectionRange=function(e,t){var n,i,r;return r=this.editor.session.doc.indexToPosition(e),i=this.editor.session.doc.indexToPosition(t),n=ace.require("ace/range").Range,this.editor.selection.setSelectionRange(new n(r.row,r.column,i.row,i.column))},r.prototype.scrollToY=function(e){return this.editor.renderer.scrollToY(e)},r.prototype.gotoLine=function(e,t){return null==e&&(e=0),null==t&&(t=0),this.editor.gotoLine(e+1,t+1,!0)},r.prototype.moveCursorTo=function(e,t){return null==e&&(e=0),null==t&&(t=0),this.editor.moveCursorTo(e,t)},r.prototype.focus=function(){return this.editor.focus()},r.prototype.search=function(e){return this.editor.find(e)},r.prototype.setValue=function(e){var t,n,i,r,o,a,s,l,c;return n=new diff_match_patch,r=(c=this.getValue()).length-1,l=Math.min(n.diff_commonPrefix(c,e),r),i=Math.min(n.diff_commonSuffix(c,e),c.length-l,e.length-l),s=e.substring(l,e.length-i),a=this.editor.session.doc.indexToPosition(l),o=this.editor.session.doc.indexToPosition(c.length-i),t=new(0,ace.require("ace/range").Range)(a.row,a.column,o.row,o.column),this.editor.session.replace(t,s)},r.prototype.insertSnippet=function(e){return this.editor.insertSnippet(e)},r.prototype.insertValue=function(e){var t;return t=this.editor.getCursorPosition(),this.editor.session.insert(t,e)},r.prototype.getUndoManager=function(){return this.undoManager},r}(l),n.exports=r}}),window.requirejs.define({"views/add_filter_dialog_view":function(e,t,n){var i,r,o,a,s,l,c,u={}.hasOwnProperty;s=t("./view"),t("../lib/utils"),a=t("../lib/notifier"),r=t("../application"),o=t("../constant"),l=t("./templates/add_filter_dialog"),c=null,i=function(e){var t;function n(){return n.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)u.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(n,e),n.prototype.template=l,n.prototype.className="ui standard story_modal modal",n.prototype.events={"click .help_button":"helpFn","change input[type=radio][name=filterType]":"filterTypeChangedFn"},n.prototype.filterTypeChangedFn=function(e){return"search"===$(e.currentTarget).val()?this.$el.find(".search_message_tip").show():this.$el.find(".search_message_tip").hide()},n.prototype.helpFn=function(){return window.openTarget("http://soft.xiaoshujiang.com/docs/tutorial/filter/")},t=function(e){var t,n;return t=e.find(".filter_icon_dropdown"),n=_.debounce((function(e){var n;return n=$(e.currentTarget).val(),t.dropdown("search",n)}),1e3),t.on("keyup","input[name=search]",n),t.dropdown({saveRemoteData:!1,forceSelection:!1,filterRemoteData:!1,showOnFocus:!1,className:{selected:"skip_selected"},delay:{hide:1e3},onShow:function(){return t.find("input[name=search]")[0].select(),!0},templates:{menu:function(e,t){var n,i;return i=e[t.values]||{},"            ",n=[],$.each(i,(function(e,i){var r;return r=i.selected?"active":"",n.push('<div class="item '+r+'" data-value="'+i[t.value]+'" data-name="'+_.escape(i[t.name])+'"><i class="'+i[t.value]+' fa-fw fa-2x"></i>'+_.escape(i[t.name])+"</div>")})),"            \n"+n.join("")}},onHide:function(t){return(e=$(this)).find(".menu>.menu").empty(),e.dropdown("refreshItems")},apiSettings:{responseAsync:function(e,t){var n,i;return n=function(e){var t;t=localStorage.recent_icons;try{t=JSON.parse(t)}catch(e){t=[]}return t=t.concat(o.fontIcons),e({success:!0,results:t=(t=_.uniq(t,"value")).slice(0,40)})},(i=e.urlData.query)?function(e,t){return function(e){return $.get("fonts/icons.yml").then((function(t,n){var i;return i=jsyaml.load(t),e(null,i)})).fail((function(e){return a.showMessage("\u52a0\u8f7d\u8d44\u6e90\u51fa\u9519",6e3,"error")}))}((function(n,i){var r,o,a,s,l,c,u,d,p;if(c=!1,d=[],e)try{c=new RegExp("(^|\\W)"+e,"gi")}catch(e){c=!1}for(a in i)if(p=a,(o=i[a]).key=a,o.search&&o.search.terms&&o.search.terms.length>0&&(p+=o.search.terms.join(" ")),!c||p.match(c))for(r=0,s=(l=o.styles).length;r<s;r++)switch(l[r]){case"solid":u={name:o.label,value:"fas fa-"+a},d.push(u);break;case"regular":u={name:o.label,value:"far fa-"+a},d.push(u);break;case"brands":u={name:o.label,value:"fab fa-"+a},d.push(u)}return t({success:!0,results:d})}))}(i,t):n(t)}}})},n.prototype.show=function(e){var n,i,o,s;return c=this,this.render(),n=this.$el,i=this.$el.find(".ui.form"),e&&(s={name:e.name,filterType:e.filterType,filterValue:e.filterValue,id:e.id},i.deserialize(s),i.find("input[name=showInHeader]").attr("checked",e.up)),t(this.$el),e&&e.icon&&((o=c.$el.find(".filter_icon_dropdown")).dropdown("set value",e.icon),o.dropdown("set text",'<i class="fa-fw fa-2x '+e.icon+'"></i>')),i.form({fields:{name:{identifier:"name",rules:[{type:"empty",prompt:"\u663e\u793a\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a"}]},filterValue:{identifier:"filterValue",rules:[{type:"empty",prompt:"\u8fc7\u6ee4\u503c\u4e0d\u80fd\u4e3a\u7a7a"}]}},onSuccess:function(){var e,t,i,a,s;a=(o=c.$el.find(".filter_icon_dropdown")).dropdown("get value")||"fas fa-star",t={id:parseInt(n.find("input[name=id]").val().trim())||uniqueNumber(),name:n.find("input[name=name]").val().trim(),filterValue:n.find("input[name=filterValue]").val().trim(),icon:a,filterType:n.find("input[name=filterType]:checked").val(),up:n.find("input[name=showInHeader]").is(":checked"),upTime:Date.now()},i=(e=r.getApplicationProfileModel()).get("filterInfos");try{i=JSON.parse(i)}catch(e){e,i=[]}return(s=i.find((function(e){return t.id===e.id})))?Object.assign(s,t):i.push(t),e.set({filterInfos:JSON.stringify(i)}),e.save(),c.$el.modal("hide")}}),this.$el.modal({closable:!1,onHidden:function(){return i.form("destroy"),(o=c.$el.find(".filter_icon_dropdown")).dropdown("destroy"),c.$el.modal("destroy"),c.remove(),c=null},onApprove:function(){var e;return!1,(e=r.getUserModel().get("user"))&&e.vip||"client"!==STORY_PLATFORM?(i.form("validate form"),!1):(a.showMessage("\u81ea\u5b9a\u4e49\u8fc7\u6ee4\u5668\u53ea\u5bf9\u4f1a\u5458\u7528\u6237\u5f00\u653e\uff0c\u514d\u8d39\u7528\u6237\u53ea\u80fd\u5728 web \u7248\u672c\u4f7f\u7528",6e3,"error"),!1)}}).modal("show")},n}(s),n.exports=i}}),window.requirejs.define({"views/base_popup_view":function(e,t,n){var i,r={}.hasOwnProperty;i=function(e){var t,n;function i(){return i.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)r.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(i,Backbone.View),i.prototype.className="xsj_base_popup",n=null,t=null,i.prototype.initialize=function(e){return this.render(),this.$el.appendTo(e.$target),this.$el.hide()},i.prototype.events={mouseenter:"mouseEnterFn",mouseleave:"mouseLeaveFn"},i.prototype.mouseLeaveFn=function(){return this.hide()},i.prototype.mouseEnterFn=function(){if(t)return clearTimeout(t),t=null},i.prototype.isShow=function(e){return!t&&e===n},i.prototype.afterShow=function(e,t){},i.prototype.show=function(e,i){var r;if(t&&(clearTimeout(t),t=null),e!==n)return n=e,r=i.rect,this.el.style.position="absolute",this.el.style.left=r.left+"px",this.el.style.top=r.bottom+"px",this.el.style.margin="0",this.$el.show(),this.afterShow(e,i)},i.prototype.afterHide=function(){},i.prototype.hide=function(e){var i;return i=this,e?(t&&(clearTimeout(t),t=null),void(n&&(n=null,i.$el.hide(),i.afterHide()))):t?void 0:n?t=setTimeout((function(){return n=null,t=null,i.$el.hide(),i.afterHide()}),100):void 0},i}(),n.exports=i}}),window.requirejs.define({"views/base_window_manager_view":function(e,t,n){var i,r,o,a,s={}.hasOwnProperty;r=t("./view"),t("../application"),a=t("./templates/base_window_manager"),o={},i=function(e){var t,n,i;function r(){return r.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)s.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(r,e),r.prototype.uniqueId=null,r.prototype.template=a,r.prototype.className="draggable_dialog draggable_dialog_animation ui segment raised",r.prototype.isMax=!1,r.prototype.isMin=!1,r.prototype.isPinned=!1,r.prototype.isShade=!1,i=!1,r.prototype.useLocalStorage=!0,r.prototype.initOpts={},r.prototype.local_storage_name="base_window_manager",r.prototype.initialize=function(e){return null==e&&(e={}),void 0!==e.useLocalStorage&&(this.useLocalStorage=e.useLocalStorage),this.initOpts=Object.assign({},{canMin:!1,canMax:!0,canPinned:!0,canShape:!1},e)},r.prototype.events={"click .header_close_button":"close",mousedown:"focus","click .max_or_normal_button":"toggleMax","click .min_or_normal_button":"toggleMin","click .shade_or_normal_button":"toggleShade","click .pinned_button":"togglePin","dblclick .draggable_dialog_header":"dblclickHeaderFn"},r.prototype.dblclickHeaderFn=function(e){return this.toggleMax()},r.prototype.togglePin=function(){var e;return e=this.$el.find(".pinned_button"),this.isPinned?(this.$el.removeClass("draggable_dialog_pinned"),e.addClass("rotated counterclockwise"),e.attr("title","\u53d6\u6d88\u4fdd\u6301\u5728\u6700\u524d\u7aef")):(this.$el.addClass("draggable_dialog_pinned"),e.removeClass("rotated counterclockwise"),e.attr("title","\u4fdd\u6301\u5728\u6700\u524d\u7aef")),this.isPinned=!this.isPinned,this.trigger("togglePin",this.isPinned)},r.prototype.toggleShade=function(){var e,t;return e=this.$el.find(".shade_or_normal_button"),t=this,this.isShade&&!i?(i=!0,this.$el.removeClass("draggable_dialog_shade"),this.$el.one($.support.transition.end,(function(){return i=!1,e.removeClass("down"),e.addClass("up"),e.attr("title","\u6536\u8d77"),t.$el.resizable("enable"),t.isShade=!1,t.trigger("toggleShade",!1)}))):(this.$el.addClass("draggable_dialog_shade"),this.$el.one($.support.transition.end,(function(){return i=!1,e.attr("title","\u5c55\u5f00"),e.removeClass("up"),e.addClass("down"),t.$el.resizable("disable"),t.isShade=!0,t.trigger("toggleShade",!0)})))},r.prototype.toggleMin=function(){var e,t;return e=this.$el.find(".min_or_normal_button"),t=this,this.isMin&&!i?(i=!0,this.$el.show(),this.$el.removeClass("draggable_dialog_min"),this.$el.one($.support.transition.end,(function(){return i=!1,e.removeClass("restore"),e.addClass("minimize"),t.$el.resizable("enable"),t.$el.draggable("enable"),t.isMin=!1,t.trigger("toggleMin",!1),t.focus()}))):(this.$el.addClass("draggable_dialog_min"),this.$el.one($.support.transition.end,(function(){return i=!1,e.attr("title","\u6062\u590d"),e.removeClass("minimize"),e.addClass("restore"),t.$el.resizable("disable"),t.$el.draggable("disable"),t.isMin=!0,t.trigger("toggleMin",!0)})))},r.prototype.toggleMax=function(){var e,t;return e=this.$el.find(".max_or_normal_button"),t=this,this.isMax&&!i?(i=!0,this.$el.removeClass("draggable_dialog_max"),this.$el.one($.support.transition.end,(function(){return i=!1,e.removeClass("restore"),e.addClass("maximize"),e.attr("title","\u6700\u5927\u5316"),t.$el.resizable("enable"),t.$el.draggable("enable"),t.isMax=!1,t.trigger("resize"),t.trigger("toggleMax",!1)}))):this.initOpts.canMax?(this.$el.addClass("draggable_dialog_max"),this.$el.one($.support.transition.end,(function(){return i=!1,e.attr("title","\u6062\u590d"),e.removeClass("maximize"),e.addClass("restore"),t.$el.resizable("disable"),t.$el.draggable("disable"),t.isMax=!0,t.trigger("resize"),t.trigger("toggleMax",!0)}))):void 0},r.prototype.afterRender=function(){var e;return this.initOpts.canPinned||this.$el.find(".pinned_button").hide(),this.initOpts.canShape||this.$el.find(".shade_or_normal_button").hide(),this.initOpts.canMin||this.$el.find(".min_or_normal_button").hide(),this.initOpts.canMax||this.$el.find(".max_or_normal_button").hide(),this.uniqueId=uniqueNumber(),this.$el.attr("id","window_"+this.uniqueId),e=this,this.$el.resizable({containment:"#main",helper:"ui-resizable-helper",handles:"e, s, w, se, nw",start:function(t){return e.$el.removeClass("draggable_dialog_animation"),$("body").addClass("iframe_dimmer")},stop:function(n){var i;return e.$el.addClass("draggable_dialog_animation"),$("body").removeClass("iframe_dimmer"),i=t(e),e.trigger("resize",i),e.trigger("reposition",i)}}),this.$el.draggable({handle:".draggable_dialog_header",cancel:".header_button",start:function(t){return e.$el.removeClass("draggable_dialog_animation"),$("body").addClass("iframe_dimmer")},stop:function(n){var i;return e.$el.addClass("draggable_dialog_animation"),$("body").removeClass("iframe_dimmer"),i=t(e),e.trigger("reposition",i)}}),$.contextMenu({selector:"#window_"+this.uniqueId+" .ui-resizable-handle",build:function(t,n){return{items:{reposition:{name:"\u91cd\u7f6e\u7a97\u53e3\u72b6\u6001",callback:function(){return e.fixPosition()}}}}}})},r.prototype.setTitle=function(e){return this.$el.find(".header_title").text(e).parent().attr("title",e)},t=function(e){var t,n,i,r,a,s;return i=e.$el.offset(),s=(s=e.$el.width())<300?800:s,t=(t=e.$el.height())<500?600:t,a=i.top,n=i.left,a<50&&(a=50,e.$el.css("top",a+"px")),n+s<50&&(n=200-s,e.$el.css("left",n+"px")),r={left:n,top:a,width:s,height:t},e.useLocalStorage&&(localStorage[e.local_storage_name+"_position"]=JSON.stringify(r)),o.position=r,r},r.prototype.hideDimmer=function(){var e;return(e=this.$el.find(".draggable_dialog_content_container_wrapper")).dimmer("hide"),e.find(">.dimmer>.ui.text").html("\u52a0\u8f7d\u4e2d...")},r.prototype.showDimmer=function(e){var t;if((t=this.$el.find(".draggable_dialog_content_container_wrapper")).dimmer("show"),e)return t.find(">.dimmer>.ui.text").html(e)},r.prototype.focus=function(){var e;if(!(e=$(".draggable_dialog_focus")).is(this.$el))return e.removeClass("draggable_dialog_focus"),this.$el.addClass("draggable_dialog_focus"),this.trigger("focus")},r.prototype.show=function(e){return n(this,e)},n=function(e,t){var n,i,r;if(null==t&&(t={}),o.position&&(o.position.left+=40,o.position.top+=40),e.render(),$("#main").append(e.$el),(n=e.$el.find(".draggable_dialog_content_container_wrapper")).dimmer({closable:!1}),n.find(".dimmer").html('<div class="ui indeterminate text loader">\u6570\u636e\u51c6\u5907\u4e2d...</div>'),$(".draggable_dialog_focus").removeClass("draggable_dialog_focus"),e.$el.addClass("draggable_dialog_focus"),e.useLocalStorage){r=localStorage[e.local_storage_name+"_position"],i=localStorage[e.local_storage_name+"_max"],o.isMax="1"===i;try{o.position=JSON.parse(r)}catch(e){e,console.log("error lastPositionInfo",r)}}return t.position&&(o.position=t.position),"boolean"==typeof t.isMax&&(o.isMax=t.isMax),e.fixPosition(o.position,o.isMax)},r.prototype.fixPosition=function(e,t){var n,i,r,a,s,l,c,u;return e=e||{},s=this.initOpts.position||{},c=(c=e.top||s.top||100)<60?60:c,l=(l=e.left||s.left||100)<60?60:l,u=(u=e.width||s.width||800)<300?300:u,a=(a=e.height||s.height||600)<300?300:a,r=(n=$(window)).width(),c>(i=n.height())-60&&(c=i/2),l>r-60&&(l=100),o.position={top:c,left:l,width:u,height:a},this.$el.css(o.position),t&&this.toggleMax(),o.position},r.prototype.close=function(){return this.isMax?(this.useLocalStorage&&(localStorage[this.local_storage_name+"_max"]="1"),o.isMax=!0):(t(this),this.useLocalStorage&&(localStorage[this.local_storage_name+"_max"]="0"),o.isMax=!1),this.$el.draggable("destroy"),this.$el.resizable("destroy"),$.contextMenu("destroy","window_"+this.uniqueId+" .ui-resizable-handle"),this.trigger("beforeClose"),this.$el.remove(),this.trigger("close")},r.prototype.remove=function(){return this.close(),r.__super__.remove.call(this)},r}(r),n.exports=i}}),window.requirejs.define({"views/bind_keyboards_manager_view":function(e,t,n){var i,r,o,a,s,l,c,u,d={}.hasOwnProperty;l=t("./view"),a=t("../lib/notifier"),i=t("../application"),s=t("../lib/utils"),o=t("./bind_system_keyboards_manager_view"),c=t("./templates/bind_keyboards_manager"),u=null,r=function(e){var t,n,r,l,p,f,h,m,v;function g(){return g.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)d.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(g,e),g.prototype.template=c,g.prototype.className="ui fullscreen story_modal modal bind_keyboards_manager_modal",g.prototype.defaultBindKeyboardId=null,t=null,v=null,p={sequenceKeyNames:[],codemirror:[],ace:[]},f=[],g.prototype.initialize=function(){return this.editorProfileModel=i.getEditorProfileModel()},g.prototype.events={"click .save_button":"createOrUpdateBindKeyboardFn","click .new_button":"createNewBindKeyboardFn","click .remove_button":"removeBindKeyboardFn","click .modify_button":"modifyBindKeyboardFn","click .cancel_button":"cancelModifyBindKeyboardFn","click .reset_shortcut_button":"resetShortcutFn","focus .shortcut_input":"focusShortcutInputFn","blur .shortcut_input":"blurShortcutInputFn","click .add_shortcut_button":"addShortcutFn","click .delete_shortcut":"deleteShortcutFn","click .bind_system_keyboards_button":"bindSystemKeyboardsFn","click .help_button":"helpFn"},g.prototype.helpFn=function(){return window.openTarget("http://soft.xiaoshujiang.com/docs/tutorial/shortcuts/")},g.prototype.bindSystemKeyboardsFn=function(e){return e.stopPropagation(),e.preventDefault(),(new o).show()},g.prototype.deleteShortcutFn=function(e){var t,n,i;return t=$(e.currentTarget).parent().parent(),i=t.data("value"),n=null,f.forEach((function(e,t){if(e.value===i)return n=t})),null!==n&&f.splice(n,1),t.remove(),l()},g.prototype.addShortcutFn=function(e){var t,n,i;return 0===p.sequenceKeyNames.length?a.showMessage("\u8bf7\u5148\u6dfb\u52a0\u6309\u952e",6e3,"error"):(i={codeMirrorValue:p.codemirror.join(" "),aceValue:p.ace.join(" "),value:p.sequenceKeyNames.join(" "),lightValue:p.sequenceKeyNames.join(" "),platform:/mac/i.exec(navigator.platform)?"mac":"win"},n=null,f.forEach((function(e,t){if(e.value===i.value)return n=t})),null===n&&(f.push(i),r(i),n=f.length-1),l(),(t=u.$el.find(".shortcuts_container>.shortcut_item:nth-child("+(n+1)+")")).addClass("current_shortcut"),setTimeout((function(){return t.removeClass("current_shortcut")}),4e3),this.resetShortcutFn())},g.prototype.focusShortcutInputFn=function(e){return $(e.currentTarget).attr("placeholder","\u8bf7\u5f00\u59cb\u5b9a\u4e49\u7ec4\u5408\u952e....")},g.prototype.blurShortcutInputFn=function(e){var t;return t=$(e.currentTarget),n(t)},n=function(e){return p.sequenceKeyNames.length>1?e.attr("placeholder","\u53ef\u4ee5\u518d\u70b9\u51fb\u8fd9\u91cc\uff0c\u7ee7\u7eed\u5b9a\u4e49\u987a\u5e8f\u952e"):e.attr("placeholder","\u70b9\u51fb\u8fd9\u91cc\u5f00\u59cb\u5b9a\u4e49\u6309\u952e")},g.prototype.resetShortcutFn=function(){var e;return(e=u.$el.find(".shortcut_input_container")).removeClass("labeled icon"),e.find(".ui.label").remove(),e.find("i").remove(),p={sequenceKeyNames:[],codemirror:[],ace:[]},n(e.find("input[name=shortcut]"))},g.prototype.cancelModifyBindKeyboardFn=function(){return 0===u.$el.find(".bind_keyboards_container tbody tr").length?u.showBlankContainer():u.showBindKeyboardsContainer()},h=function(e){var n,i,r;for(i=0,r=t.length;i<r;i++)if((n=t[i]).id===e)return n;return null},r=function(e){var t,n,i;return n=u.$el.find(".shortcuts_container"),i=e.value.split(" ").map((function(e){return"<kbd>"+_.escape(e)+"</kbd>"})),t=$('<li class="shortcut_item item"><span>'+i.join(" ")+'&nbsp;&nbsp;&nbsp;&nbsp; <i class="link remove red icon delete_shortcut"></i></span>\n<div>codeMirror: '+_.escape(e.codeMirrorValue)+"</div>\n<div>ace: "+_.escape(e.aceValue)+"</div>\n</li>"),n.append(t),t.data("value",e.value)},l=function(){return f.length>0?u.$el.find(".shortcuts_container_wrapper").show():u.$el.find(".shortcuts_container_wrapper").hide()},g.prototype.modifyBindKeyboardFn=function(e){var t,n,i;return n=$(e.currentTarget).parent().parent().parent().data("id"),(t=h(n))?(u.$el.find("input[name=displayName]").val(t.displayName||t.command),u.$el.find("input[name=id]").val(t.id),u.$el.find("input[name=command]").val(t.command),u.$el.find("input[name=commandArgs]").val(t.args||""),i=t.range||"all",u.$el.find("input[name=range][value="+i+"]").prop("checked",!0),u.$el.find(".shortcuts_container").empty(),t.shortcuts.forEach(r),f=t.shortcuts,l(),u.showBindKeyboardContainer()):a.showMessage("\u8bfb\u53d6\u7ed1\u5b9a\u4fe1\u606f\u5931\u8d25:\u6ca1\u6709\u8be5\u7ed1\u5b9a\u4fe1\u606f",6e3,"error")},g.prototype.removeBindKeyboardFn=function(e){var n,i;if(n=$(e.currentTarget).parent().parent().parent(),i=n.data("id"),t=t.filter((function(e){return e.id!==i})),this.save(),n.parent(),n.remove(),0===t.length)return this.showBlankContainer()},g.prototype.showBlankContainer=function(){return u.$el.find(".bind_keyboards_container").hide(),u.$el.find(".bind_keyboard_container").hide(),u.$el.find(".blank_container").show(),u.$el.find(".save_button").hide(),u.$el.find(".cancel_button").hide(),u.$el.find(".new_button").css("display","inline-block")},g.prototype.showBindKeyboardsContainer=function(){return u.$el.find(".bind_keyboards_container").show(),u.$el.find(".bind_keyboard_container").hide(),u.$el.find(".blank_container").hide(),u.$el.find(".save_button").hide(),u.$el.find(".cancel_button").hide(),u.$el.find(".new_button").show()},g.prototype.showBindKeyboardContainer=function(){return u.$el.find(".bind_keyboards_container").hide(),u.$el.find(".bind_keyboard_container").show(),u.$el.find(".blank_container").hide(),u.$el.find(".save_button").show(),u.$el.find(".cancel_button").show(),u.$el.find(".new_button").hide()},g.prototype.createOrUpdateBindKeyboardFn=function(){var e,n,i,r,o,s,l;if(o=$.trim(u.$el.find("input[name=id]").val())||"xsj_"+uniqueNumber(),r=$.trim(u.$el.find("input[name=displayName]").val()),n=$.trim(u.$el.find("input[name=command]").val()),i=$.trim(u.$el.find("input[name=commandArgs]").val()),s=u.$el.find("input[name=range]:checked").val()||"all",p&&p.sequenceKeyNames.length>0&&this.addShortcutFn(),0!==f.length){if(n)return r||(r=n),l=JSON.parse(JSON.stringify(f)),(e=h(o))||(e={id:o},t.push(e)),e.name=n,e.displayName=r,e.args=i,e.command=n,e.range=s,e.shortcuts=l,this.save(),a.showMessage("\u4fdd\u5b58\u6210\u529f"),u._renderBindKeyboards();a.showMessage("\u60a8\u8fd8\u6ca1\u6709\u6307\u5b9a\u6267\u884c\u7684\u547d\u4ee4",6e3,"error")}else a.showMessage("\u60a8\u8fd8\u6ca1\u6709\u6dfb\u52a0\u5feb\u6377\u952e",6e3,"error")},g.prototype._renderBindKeyboard=function(e,t){var n,i;return n=u.$el.find(".bind_keyboards_container_body"),i=$("<div></div>").text(e.displayName||e.command).html()||"\u672a\u547d\u540d",n.append('<tr class="'+e.id+'" data-id="'+e.id+'">\n  <td>'+(t+1)+"</td>\n  <td>"+i+"("+_.escape(e.shortcuts[0].value)+')</td>\n  <td class="center aligned">\n    <div">\n      <div class="ui basic mini button modify_button">\u4fee\u6539</div>\n      <div class="ui basic mini button remove_button">\u5220\u9664</div>\n    </div>\n  </td>\n</tr>')},g.prototype._renderBindKeyboards=function(e){return null==e&&(e=t),u.showBindKeyboardsContainer(),u.$el.find(".bind_keyboards_container_body").empty(),e.forEach(u._renderBindKeyboard)},g.prototype.createNewBindKeyboardFn=function(){return u.showBindKeyboardContainer(),u.$el.find("input[name=id]").val(""),u.$el.find("input[name=displayName]").val(""),u.$el.find("input[name=command]").val(""),u.$el.find("input[name=commandArgs]").val(""),u.$el.find("input[name=range][value=all]").prop("checked",!0),u.$el.find(".shortcuts_container").empty(),f=[],p={sequenceKeyNames:[],codemirror:[],ace:[]},this.resetShortcutFn(),l()},g.prototype.remove=function(){return u.$el.find(".command_dropdown").dropdown("destroy"),u.$el.find(".mousetrap").off("keydown"),v=null,g.__super__.remove.apply(this,arguments),u=null},g.prototype.afterRender=function(){if(u=this,"client"===STORY_PLATFORM)return this.$el.find(".tips").html('<a class="bind_system_keyboards_button" href="#">\u5b9a\u4e49\u7cfb\u7edf\u7ea7\u6309\u952e</a>')},g.prototype.getRenderData=function(){return{}},g.prototype.save=function(){var e;return(e=this.editorProfileModel).set({bindInfos:JSON.stringify(t)}),e.save()},m=function(){var e,t,n,r,o,a,s;for(o in e=u.$el.find(".command_dropdown"),t=u.$el.find(".command_menus_container"),(a=[]).push('<div class="header">\n        <i class="tags icon"></i>\n        \u5c0f\u4e66\u5320\n      </div>'),r=i.homeView.getCommands()||{})r[o],a.push('<div class="item" data-value="'+_.escape(o)+'">'+_.escape(o)+"</div>");for(o in n=i.homeView.editorView.getCommands())n[o],a.push('<div class="item" data-value="'+_.escape(o)+'">'+_.escape(o)+"</div>");for(o in a.push('<div class="header">\n        <i class="tags icon"></i>\n        CodeMirror\n      </div>'),s=CodeMirror.commands)s[o],0!==o.indexOf("xsj_")&&a.push('<div class="item" data-value="'+_.escape(o)+'">'+_.escape(o)+"</div>");return a.push('<div class="header">\n        <i class="tags icon"></i>\n        Ace\n      </div>'),ace.require("./commands/default_commands").commands.forEach((function(e){return o=e.name,a.push('<div class="item" data-value="'+_.escape(o)+'">'+_.escape(o)+"</div>")})),t.append(a.join("")),e.dropdown({fullTextSearch:!0,action:"select",onChange:function(e,t,n){if(n.hasClass("item"))return u.$el.find("input[name=command]").val(e)}})},g.prototype.show=function(){var e;return e=this.editorProfileModel,u=this,this.render(),this.dimmer=s.xsjDimmer(this.$el),u.showBlankContainer(),this.$el.modal({closable:!1,onVisible:function(){return s.asyncLoadResources([{id:"ace_js",type:"script",filename:"js/ace/ace.js"},{id:"codemirror_core_js",type:"script",filename:"js/codemirror.js"}],(function(){var n,i,r,o,a,s,l,c,d;o=e.get("bindInfos");try{o=JSON.parse(o)}catch(e){e,o=[]}return o instanceof Array||(o=[]),(t=o).length>0&&u._renderBindKeyboards(t),i=u.$el.find(".shortcut_input_container"),n=u.$el.find(".mousetrap"),v=new Mousetrap(n[0]),a="",r="",c=function(e){var t,o;return t=e[e.length-1],n.val(""),o=p.sequenceKeyNames,p.codemirror.push(a),p.ace.push(r),t&&(o.push(t),o.length<=1?(i.addClass("labeled icon"),i.prepend('<div class="ui label">'+o.join(" ")+"</div>"),i.append('<i class="close link icon reset_shortcut_button"></i>')):i.find(".ui.label").text(o.join(" "))),setTimeout((function(){if(v)return v.record(c)}),10)},v.record(c),d=ace.require("./lib/event"),s=d.getModifierString,l=ace.require("./lib/keys"),n.on("keydown",(function(e){var t;return e.preventDefault(),e.stopPropagation(),a=CodeMirror.keyName(e),t=l.keyCodeToString(e.keyCode),r=s(e)+t})),m()}))},onHidden:function(){return v=null,u.$el.modal("destroy"),u.remove()}}).modal("show")},g}(l),n.exports=r}}),window.requirejs.define({"views/bind_system_keyboards_manager_view":function(e,t,n){var i,r,o,a,s,l={}.hasOwnProperty;o=t("./view"),r=t("../lib/notifier"),a=t("./templates/bind_system_keyboards_manager"),s=null,i=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)l.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.template=a,t.prototype.className="ui fullscreen story_modal modal bind_system_keyboards_manager_modal",t.prototype.events={"click .save_button":"saveFn"},t.prototype.saveFn=function(){var e,t;if(e=$.trim(this.$el.find("textarea[name=bindInfo]").val()))try{JSON.parse(e)}catch(e){return t=e,void r.showMessage("\u7ed1\u5b9a\u51fa\u9519\uff1a\u5b9a\u4e49\u5185\u5bb9\u4e0d\u7b26\u5408 json \u6570\u636e\u683c\u5f0f("+t+")",6e3,"error")}return localStorage.setItem("clientBindInfo",e),r.showMessage("\u4fdd\u5b58\u7cfb\u7edf\u6309\u952e\u5b9a\u4e49\u6210\u529f\uff0c\u9700\u8981\u4e0b\u6b21\u542f\u52a8\u5c0f\u4e66\u5320\u624d\u4f1a\u751f\u6548",6e3,"info")},t.prototype.remove=function(){return t.__super__.remove.apply(this,arguments),s=null},t.prototype.getRenderData=function(){return{}},t.prototype.show=function(){return s=this,this.render(),this.$el.find("textarea[name=bindInfo]").val(localStorage.getItem("clientBindInfo")||""),this.$el.modal({closable:!1,onHidden:function(){return s.$el.modal("destroy"),s.remove()}}).modal("show")},t}(o),n.exports=i}}),window.requirejs.define({"views/cache_upgrade_dialog_view":function(e,t,n){var i,r,o,a,s,l,c,u,d,p,f,h,m,v,g,_={}.hasOwnProperty;a=t("./view"),t("../constant"),t("../lib/notifier"),o=t("../lib/utils"),t("../application"),h=t("./templates/cache_upgrade_dialog"),l=t("../lib/check_new_version"),m=null,d=!1,p=!1,c=function(e,t,n,i){var r,o;return o=new URL(e),i&&o.pathname.match(i)||(r=o.search?"&":"",o.search=o.search+r+encodeURIComponent(t)+"="+encodeURIComponent(n)),o.toString()},g=function(e){return"_sw-precache",new Map(e.map((function(e){var t,n,i,r;return r=e[0],i=e[1],t=new URL(r,"http://localhost"),n=c(t,"_sw-precache",i,!1),[t.toString(),n]})))},f=function(e){return e.keys().then((function(e){return e.map((function(e){return e.url}))})).then((function(e){return new Set(e)}))},u=function(){var e,t,n,i,a,s;return t=require("fs-extra"),n=require("path"),a=n.resolve(nw.App.dataPath,"Service Worker","node"),m.manifest,i=m.result,(e=m.$el.find(".progress")).show(),0===i.length?Promise.resolve($description.html("\u5f53\u524d\u5df2\u7ecf\u662f\u6700\u65b0\u7248\u672c\uff0c\u4e0d\u9700\u8981\u518d\u66f4\u65b0\u4e86")):(s=g(i),caches.open("sw-precache-v3").then((function(i){return f(i).then((function(l){var c,u;return u=0,c=m.host,Promise.all(Array.from(s.values()).map((function(s){var d,f,h;if(!l.has(s))return d=s.substring("http://localhost".length+1),f=c+d,console.log(f),h=new Request(f,{credentials:"same-origin"}),fetch(h).then((function(l){if(!l.ok)throw new Error("Request for "+s+" returned a response with status "+l.status);return window.cleanResponse(l).then((function(l){return l.arrayBuffer().then((function(c){var f,h,v,g,_;return v={},/\.(html|htm)$/i.test(s)?(l.headers.forEach((function(e,t){return v[e]=t})),v["Content-Type"]="text/html; charset=UTF-8"):v=l.headers,g=(u+=1)/(m.total+r)*100,e.progress("set progress",g),d.startsWith("app")?(_=new Response(c,{statusText:l.statusText,status:l.status,headers:v}),i.put(s,_)):(p=!0,f=o.arrayBufferToNodeBuffer(c),h=(h=d.replace(/^[\/]+/,"")).substring(0,h.indexOf("?")),h=n.resolve(a,h),t.mkdirsSync(n.dirname(h)),t.writeFileSync(h,f))}))}))}))})))}))})))},s=function(){var e,t,n;return e=m.result,n=g(e),t=new Set(n.values()),caches.open("sw-precache-v3").then((function(e){return e.keys().then((function(n){return Promise.all(n.map((function(n){if(!t.has(n.url))return e.delete(n)})))}))}))},v=function(){var e,t,n;return n=m.result,p&&(e=require("fs-extra"),t=require("path").resolve(nw.App.dataPath,"Service Worker","node","xsj.json"),e.writeFileSync(t,JSON.stringify({clientVersion:m.clientSW.version,serviceVersion:m.serviceSW.version}))),caches.open("xsj").then((function(e){var t,i;return(t={})["Content-Type"]="application/json",i={clientVersion:m.clientSW.version,serviceVersion:m.serviceSW.version,precacheConfig:n},e.put("http://localhost/",new Response(JSON.stringify(i),{headers:t,status:200,statusText:"OK"}))}))},r=3,i=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)_.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.template=h,t.prototype.getRenderData=function(){return{appVersion:APP_VERSION}},t.prototype.className="ui small modal",t.prototype.installNewVersionHandle=function(){var e;return e=m.$el.find(".progress"),this.$el.find(".description_detail").html(""),e.progress("set label","\u5f00\u59cb\u4e0b\u8f7d\u65b0\u7248\u672c\u6587\u4ef6..."),e.progress("set progress",1),d=!0,m.$el.find(".cancel").addClass("disabled"),u().then((function(){return e.progress("set progress",(m.total-2)/m.total*100),e.progress("set label","\u6b63\u5728\u6fc0\u6d3b\u65b0\u7248\u672c..."),v()})).then((function(){return e.progress("set progress",(m.total-1)/m.total*100),e.progress("set label","\u66f4\u65b0\u6587\u4ef6\u4e2d..."),s(m.clientSW,m.serviceSW)})).then((function(){var t;return e.progress("set progress",100),e.progress("set label","\u65b0\u7248\u672c\u5b89\u88c5\u5b8c\u6210,\u8bf7\u91cd\u65b0\u542f\u52a8\u5c0f\u4e66\u5320"),t=m.$el.find(".install_new_version_button"),p?t.html("\u624b\u52a8\u91cd\u542f"):t.html("\u91cd\u65b0\u542f\u52a8"),t.addClass("restart"),t.removeClass("loading")})).catch((function(t){return e.progress("set error"),e.progress("set label","\u66f4\u65b0\u51fa\u9519:"+t),d=!1,m.$el.find(".cancel").removeClass("disabled")}))},t.prototype.initialize=function(e){return require("../package.json")},t.prototype.show=function(){var e;return m=this,this.render(),this.$el.find(".progress").progress({percent:0}),e=this.$el.find(".description_detail"),this.$el.modal({closable:!1,onVisible:function(){return $("body").dimmer({closable:!1,useCSS:!0})},onDeny:function(){return!d},onApprove:function(){var e;if(!(e=m.$el.find(".install_new_version_button")).hasClass("loading"))return e.hasClass("restart")?p?nw.App.quit():global.restartXSJApp():(e.addClass("loading"),m.installNewVersionHandle()),!1},onShow:function(){var t;return t=m.$el.find(".new_version"),l.checkNewVersion((function(n,i,a,s,l){var c,u;return n?(t.html(""),e.html('<div class="ui negative message">\n  <div class="header">\n    \u68c0\u6d4b\u65b0\u7248\u672c\u51fa\u9519: '+n+" \n  </div>\n</div>")):(t.html(s.version),i?a?(c=l[0],u=l[1],m.clientSW=c,m.serviceSW=u,m.manifest=s,o.complement(u.precacheConfig,c.precacheConfig,(function(t,n){var i;return m.result=n,m.host=u.host,i=n.length,m.total=i+r,e.html("\u603b\u5171\u9700\u8981\u66f4\u65b0 "+i+" \u4e2a\u6587\u4ef6"),m.$el.find(".install_new_version_button").removeClass("disabled")}))):e.html('\u8bf7\u524d\u5f80 <a href="http://soft.xiaoshujiang.com" target="_blank">\u5c0f\u4e66\u5320\u4e3b\u9875</a> \u4e0b\u8f7d\u6700\u65b0\u7248\u672c\u7684\u5ba2\u6237\u7aef'):e.html("\u5f53\u524d\u5df2\u7ecf\u662f\u6700\u65b0\u7248\u672c\uff0c\u65e0\u9700\u518d\u66f4\u65b0"))}))},onHidden:function(){return!d&&(m.$el.modal("destroy"),m.remove(),m=null)}}).modal("show")},t}(a),n.exports=i}}),window.requirejs.define({"views/calendar_view":function(e,t,n){var i,r,o,a,s={}.hasOwnProperty;r=t("../constant"),o=t("../lib/notifier"),a=t("../lib/pouchdb_index_view_manager"),i=function(){return function(e){var n,i;function l(){return l.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)s.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(l,Backbone.View),l.prototype.className="ui calendar",l.prototype.selectMode="day",l.prototype.rangeInitDate=null,l.prototype.rangeDates=null,i=!1,n={},l.prototype.getDateInfo=function(e){return e?(e=new Date(e.getFullYear(),e.getMonth(),e.getDate()),n[e]):n},l.prototype.events={"mouseover .calendar>table.day td.link":"mouseoverFn"},l.prototype.initialize=function(e){return null==e&&(e={}),this.selectMode=e.selectMode||"day",i=!0},l.prototype.highlightDate=function(e,t){return this.$el.find(".calendar td.link").each((function(n,i){var r,o;return o=(r=$(i)).data("date"),o=moment(o),r.toggleClass("range",o.isBetween(e,t,"day","[]"))}))},l.prototype.mouseoverFn=function(e){var t,n,i;if("range"===this.selectMode&&null!==this.rangeInitDate&&null===this.rangeDates&&(t=moment(this.rangeInitDate),(n=$(e.currentTarget).data("date"))instanceof Date||(n=null),n&&(n=moment(n),!t.isSame(n))))return t.isAfter(n)&&(i=t,t=n,n=i),this.highlightDate(t,n)},l.prototype.showDimmer=function(e){return null==e&&(e="\u52a0\u8f7d\u4e2d"),this.trigger("showDimmer",e)},l.prototype.hideDimmer=function(){return this.trigger("hideDimmer")},l.prototype.changeSelectMode=function(e){return this.selectMode=e||"day",this.$el.find(">.calendar.ui td.range").removeClass("range"),this.rangeInitDate=null,this.rangeDates=null,this.trigger("selectModeChanged",this.selectMode)},l.prototype.remove=function(){return i=!1,this.$el.calendar("destroy"),l.__super__.remove.apply(this,arguments)},l.prototype.render=function(){var e;return e=this,setTimeout((function(){return e._render()}),1)},l.prototype._render=function(e){var s,l,c,u;return u=this,s=this.$el,l=t("../lib/dynamic_import/import_calendar"),c=function(e,t,n,i){return u.showDimmer("\u7d22\u5f15\u4e2d:"+e+" / "+t)},u.showDimmer(),l((function(){var e,t,l;return t=[],l=function(){if(i)return u.hideDimmer(),s.calendar({className:{calendar:"calendar",active:"active",popup:"ui popup",grid:"ui equal width grid",column:"column",table:"ui celled center aligned unstackable table",prev:"prev link",next:"next link",prevIcon:"chevron left icon",nextIcon:"chevron right icon",link:"link",cell:"link",disabledCell:"disabled",weekCell:"disabled",adjacentCell:"adjacent",activeCell:"active",rangeCell:"range",focusCell:"focus",todayCell:"today-cell",today:"today link"},text:{days:["\u65e5","\u4e00","\u4e8c","\u4e09","\u56db","\u4e94","\u516d"],months:["\u4e00\u6708","\u4e8c\u6708","\u4e09\u6708","\u56db\u6708","\u4e94\u6708","\u516d\u6708","\u4e03\u6708","\u516b\u6708","\u4e5d\u6708","\u5341\u6708","\u5341\u4e00\u6708","\u5341\u4e8c\u6708"],monthsShort:["\u4e00","\u4e8c","\u4e09","\u56db","\u4e94","\u516d","\u4e03","\u516b","\u4e5d","\u5341","\u5341\u4e00","\u5341\u4e8c"],today:"\u4eca\u5929",weekNo:"\u661f\u671f"},formatter:{cell:function(e,t,n){}},today:!0,eventClass:"positive",eventDates:t,showWeekNumbers:!0,type:"date",checkInRange:function(e,t){return!(!u.rangeDates||!moment(e).isBetween(u.rangeDates[0],u.rangeDates[1],"day","[]"))},onSelect:function(e,t){var i,r,o;if("day"===t){if("day"===u.selectMode)return u.trigger("dateSelect",e);if(u.rangeDates&&u.changeSelectMode("range"),r=[],u.rangeInitDate){for(i in moment(u.rangeInitDate).isBefore(e)?u.rangeDates=[u.rangeInitDate,e]:u.rangeDates=[e,u.rangeInitDate],n)o=n[i],moment(i).isBetween(u.rangeDates[0],u.rangeDates[1],"day","[]")&&r.push(o);u.trigger("dateRangeSelect",u.rangeDates[0],u.rangeDates[1],r),u.highlightDate(moment(u.rangeDates[0]),moment(u.rangeDates[1]))}else u.rangeInitDate=e,u.trigger("dateRangeSelect",u.rangeInitDate,null);return!1}},selectAdjacentDays:!0})},e=r.pouchDB,a.getDateView(e,(function(i,r){var a;return i?o.showMessage("\u52a0\u8f7d\u7d22\u5f15\u51fa\u9519:"+i,6e3,"error"):(a=r.viewName,e.query(a+"/by_create_date",{reduce:!0,group:!0,group_level:3,showUpdateProgressInfo:c}).then((function(e){return e.rows.forEach((function(e){var i,r;if(e&&e.key)return(i=e.key).unshift(null),r=new(Function.prototype.bind.apply(Date,i)),t.push(r),n[r]=e})),l()})).catch((function(e){return l()})))}))}))},l}()},n.exports=i}}),window.requirejs.define({"views/change_store_plugin_dialog_view":function(e,t,n){var i,r,o,a,s,l,c,u,d={}.hasOwnProperty;a=t("./view"),i=t("../application"),o=t("../lib/notifier"),c=t("./templates/change_store_plugin_dialog"),t("./templates/auth_dialog"),u=null,s=function(e){var t;return e?(t="",e.logo&&(t="<img src='"+e.logo+"' />"),e.icon&&(t='<i class="large icon '+e.icon+'"></i>'),t):""},l=function(e){return window.getSelection().selectAllChildren(e[0])},r=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)d.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.template=c,t.prototype.className="ui standard story_modal modal",t.prototype.events={"click .store_bind_button":"bind","click .store_unbind_button":"unbind","click .store_check_button":"checkStorePlugin","click .store_setting_button":"settingStorePlugin","click .resource_remove_button":"removeResourceFn","click .resource_bind_button":"bindResourceFn","click .resource_check_button":"setDefaultResourceFn","click .plugin_display_name":"modifyDisplayNameFn","keydown .plugin_display_name.plugin_display_name_editable":"enterKeyDisplayNameFn","blur .plugin_display_name.plugin_display_name_editable":"blurDisplayNameFn","click .help_button":"helpFn"},t.prototype.helpFn=function(){return window.openTarget("http://soft.xiaoshujiang.com/docs/tutorial/store/")},t.prototype.modifyDisplayNameFn=function(e){var t,n,i,r,o;if(!(t=$(e.currentTarget)).hasClass("plugin_display_name_editable"))return t.addClass("plugin_display_name_editable"),t.attr("contenteditable",!0),i=t.parent().parent().data("id"),o=(r=u.storePluginCollection.get(i)).get("name"),n=r.get("displayName"),t.text(n||o),t.focus(),l(t)},t.prototype.changeDisplayNameFn=function(e){var t,n,i,r,o;if(e.removeClass("plugin_display_name_editable"),e.attr("contenteditable",!1),t=e.text(),n=e.parent().parent().data("id"),o=(i=u.storePluginCollection.get(n)).get("displayName"),r=i.get("name"),e.text((t||r)+"("+n+")"),t!==o)return i.set("displayName",t),i.save()},t.prototype.blurDisplayNameFn=function(e){var t;return t=$(e.currentTarget),u.changeDisplayNameFn(t)},t.prototype.enterKeyDisplayNameFn=function(e){var t;if(t=$(e.currentTarget),13===e.which)return e.preventDefault(),e.stopPropagation(),u.changeDisplayNameFn(t)},t.prototype.settingStorePlugin=function(e){var t,n,r,o,a,s;if(t=$(e.currentTarget),n=t.parent().parent(),o=n.data("id"),a=u.storePluginCollection.get(o),s=a.get("name"),r=i.getPlugin(a))return r.setting((function(e,t){var i;return i=t.get("displayName")||s,n.find(".plugin_display_name").text(i+"("+o+")")}))},t.prototype.setDefaultResourceFn=function(e){var t,n,i;if(!(t=$(e.currentTarget).parent().parent()).hasClass("default_resource"))return i=t.data("id"),n=t.hasClass("system_resource"),i||n?(u.currentUseResourcePluginId=i,u.$el.find(".positive.button").removeClass("disabled"),u.$el.find(".default_resource").removeClass("default_resource positive"),t.addClass("default_resource positive")):void 0},t.prototype.bindResourceFn=function(e){var t,n,r,a;if(t=$(e.currentTarget),n=u.$el.find(".resource_table_tbody"),r=t.data("name"),a=null,r&&(a=i.getPlugin(r,"resource")),a)return a.authenticate((function(e,t,i,r,l,c){return e?(o.showMessage(e,3e3,"error"),"function"==typeof c?c("\u7ed1\u5b9a\u5931\u8d25"):void 0):u._bindSuccess(t,i,r,a,(function(e,t){var i,r,o,l;return e||(o=t.get("id"),l=t.get("name"),i=t.get("displayName"),r=s(a),n.prepend('<tr class="resource_item resource_item_'+o+' plugin_item" data-id="'+o+'"><td>'+r+'<span class="plugin_display_name">'+(i||l)+"("+o+')</span></td><td class="center aligned"><i class="large check icon resource_check_button outline"></i><i class="icon remove resource_remove_button large"></i></td></tr>')),"function"==typeof c?c(e,t):void 0}))}))},t.prototype.removeResourceFn=function(e){var t,n;if(n=(t=$(e.currentTarget).parent().parent()).data("id"))return u.storePluginCollection.get(n).destroy(),t.remove()},t.prototype.initialize=function(){var e;return this.storePluginCollection=i.getStorePluginCollection(),e=i.getApplicationProfileModel().get("plugin"),this.currentUseStorePluginId=e||"",this.resourceModel=i.getCurrentResourcePluginModel(),this.currentUseResourcePluginId=this.resourceModel?this.resourceModel.get("id"):""},t.prototype.afterRender=function(){var e,t,n,r,o,a,l,c,u,d,p,f,h,m,v,g,_,w,y,b,x,k,D,C,$,F;for(c in k=this.storePluginCollection,this.$el.find(".cards"),n=this.$el.find(".store_table_tbody"),t=this.$el.find(".store_container"),C=i.plugins,b=i.resourcePlugins,D=[],$=[],C)g=c,o=(h=C[c]).displayName,p=s(h),D.push('<div class="ui mini basic button store_bind_button bind_button" title="'+(o||g)+'" data-name="'+g+'">'+p+(o||g)+"</div>");for(t.append(D.join("")),a=0,u=(_=k.where({kind:"store"})).length;a<u;a++)m=(v=_[a]).get("id"),g=v.get("name"),o=v.get("displayName"),(h=C[g])&&(F=m===this.currentUseStorePluginId?"default_store positive":"",x=h.setting?'<i class="large settings icon store_setting_button"></i>':"",p=s(h),$.push('<tr class="store_item store_binded store_item_'+g+" "+F+' plugin_item" data-name="'+g+'" data-id="'+m+'"><td class="store_info">'+p+'<span class="plugin_display_name">'+(o||g)+"("+m+')</span></td><td class="center aligned"><i title="\u8bbe\u7f6e\u5f53\u524d\u5b58\u50a8\u4e3a\u9ed8\u8ba4\u7b2c\u4e09\u65b9\u5b58\u50a8" class="large check icon store_check_button outline"></i>'+x+'<i title="\u53d6\u6d88\u7ed1\u5b9a" class=" red icon remove store_unbind_button large"></i></td></tr>'));for(c in n.append($.reverse().join("")),e=this.$el.find(".resource_container"),y=[],b)h=b[c],p=s(h),y.push('<div class="ui mini basic button resource_bind_button bind_button" title="'+(h.displayName||h.name)+'" data-name="'+h.name+'">'+p+(h.displayName||h.name)+"</div>");for(e.append(y.join("")),r=this.$el.find(".resource_table_tbody"),f=[],l=0,d=(w=k.where({kind:"resource"})).length;l<d;l++)m=(v=w[l]).get("id"),g=v.get("name"),o=v.get("displayName"),this.currentUseResourcePluginId===m?(F="default_resource positive",r.find(".default_resource").removeClass("default_resource positive")):F="",p=s(b[g]),f.push('<tr class="resource_item resource_item_'+m+" "+F+' plugin_item" data-id="'+m+'"><td>'+p+'<span class="plugin_display_name">'+(o||g)+"("+m+')</span></td><td class="center aligned"><i class="large check icon resource_check_button outline"></i><i class=" red icon remove resource_remove_button large"></i></td></tr>');return r.append(f.reverse().join(""))},t.prototype._bindSuccess=function(e,t,n,i,r){var a,s;return a=function(e){return o.showMessage("\u9a8c\u8bc1\u7528\u6237\u5931\u8d25\uff0c\u8bf7\u786e\u8ba4token\u662f\u5426\u6709\u6548"+e,6e3,"error"),"function"==typeof r?r("\u8ba4\u8bc1\u7528\u6237\u5931\u8d25"):void 0},s=function(a){var s,l,c;try{"object"!==typeof n&&(n=JSON.parse(n)),n.shardId=a.shardId,l=JSON.stringify(n)}catch(e){s=e,console.log(s),(n={}).shardId=a.shardId,l=JSON.stringify(n)}return(c=u.storePluginCollection.create({id:Date.now(),name:i.name,kind:i.kind||"store",displayName:n.displayName||i.displayName,entryToken:e,entryTokenSecret:t,extraInfo:l,username:a.username,userDisplayName:a.displayName||a.username,email:a.email})).save(),o.showMessage("\u7ed1\u5b9a\u6210\u529f"),"function"==typeof r?r(null,c):void 0},i.getAccountInfo((function(e,t){return e?(console.error(e),a(e)):s(t)}))},t.prototype.bind=function(e){var t,n,r,a,l,c,d,p;if(t=$(e.currentTarget),n=u.$el.find(".store_table_tbody"),a=t.data("name"))return d=(p=i.getUserModel()).get("user"),r=!1,p.get("token")&&d&&d.vip&&(r=!0),c=this.storePluginCollection.getModelByName(a),!r&&c?void o.showMessage("\u7ed1\u5b9a\u5931\u8d25\uff0c\u975e\u4ed8\u8d39\u7528\u6237\u53ea\u80fd\u540c\u65f6\u7ed1\u5b9a\u4e00\u4e2a\u540c\u7c7b\u578b\u7684\u5b58\u50a8",6e3,"error"):(l=i.getPlugin(a)).authenticate((function(e,t,i,r,a,c){return e?(o.showMessage(e,3e3,"error"),"function"==typeof c?c("\u7ed1\u5b9a\u5931\u8d25"):void 0):u._bindSuccess(t,i,r,l,(function(e,t){var i,r,o,a,u;if(!e)return a=t.get("name"),o=t.get("id"),i=t.get("displayName"),u=l.setting?'<i class="large settings icon store_setting_button"></i>':"",r=s(l),e||n.prepend('<tr class="store_item store_binded store_item_'+a+' plugin_item" data-name="'+a+'" data-id="'+o+'"><td class="store_info">'+r+'<span class="plugin_display_name">'+(i||a)+"("+o+')</span></td><td class="center aligned"><i title="\u8bbe\u7f6e\u5f53\u524d\u5b58\u50a8\u4e3a\u9ed8\u8ba4\u7b2c\u4e09\u65b9\u5b58\u50a8" class="large check icon store_check_button outline"></i>'+u+'<i title="\u53d6\u6d88\u7ed1\u5b9a" class=" red icon remove store_unbind_button large"></i></td></tr>'),"function"==typeof c&&c(e,t),l.init(t);"function"==typeof c&&c(e)}))}))},t.prototype.unbind=function(e){var t,n,r;if(r=(t=$(e.target).parent().parent()).data("id"))return u.currentUseStorePluginId===r&&(u.currentUseStorePluginId="",t.removeClass("default_store positive"),u.$el.find(".system_store").addClass("default_store positive")),(n=u.storePluginCollection.get(r)).get("name"),i.getPlugin(n).signOut((function(){})),u.currentUseStorePluginId===r&&i.getApplicationProfileModel().save({plugin:""}),null!=n&&n.destroy(),o.showMessage("\u53d6\u6d88\u7ed1\u5b9a\u6210\u529f"),t.remove()},t.prototype.checkStorePlugin=function(e){var t,n;return n=(t=$(e.currentTarget).parent().parent()).data("id"),u.$el.find(".ui.positive.button").removeClass("disabled"),u.$el.find(".default_store").removeClass("default_store positive"),u.currentUseStorePluginId!==n?(u.currentUseStorePluginId=n,t.addClass("default_store positive")):u.currentUseStorePluginId=""},t.prototype.show=function(){return u=this,this.render(),this.$el.modal({closable:!1,allowMultiple:!0,onHidden:function(){return u.$el.find(".resource_dropdown_button").dropdown("destroy"),u.$el.modal("destroy"),u.remove(),u=null},onApprove:function(){var e,t,n;return n="",(t=u.storePluginCollection.get(u.currentUseStorePluginId))&&(n=t.get("id")||""),(e=i.getApplicationProfileModel()).set({plugin:n,resourcePluginId:u.currentUseResourcePluginId}),e.set("resourcePluginId",u.currentUseResourcePluginId),e.save()}}).modal("show")},t}(a),n.exports=r}}),window.requirejs.define({"views/client_public_email_dialog_view":function(e,t,n){var i,r,o,a,s,l,c,u={}.hasOwnProperty;s=t("./view"),a=t("../lib/utils"),r=t("../lib/notifier"),i=t("../application"),l=t("./templates/client_public_email_dialog"),c=null,o=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)u.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.template=l,t.prototype.className="ui standard story_modal modal",t.prototype.moreAttachments=[],t.prototype.events={"click .drop-zone":"selectFileFn","click .delete_attachment":"deleteAttachmentFn","click input[name=useMailServerConfig]":"toggleUseMailServerConfigFn","change input[name=mainBody]":"changeMainBodyFn","click input[name=separateTo]":"toggleSeparateToFn"},t.prototype.toggleSeparateToFn=function(e){return $(e.currentTarget).is(":checked")?c.$el.find(".cc_mail_container, .bcc_mail_container").addClass("disabled"):c.$el.find(".cc_mail_container, .bcc_mail_container").removeClass("disabled")},t.prototype.changeMainBodyFn=function(e){var t,n;return n=$(e.currentTarget).val(),t=c.$el.find(".user_main_body_container"),"user"===n?t.removeClass("hide"):t.addClass("hide")},t.prototype.deleteAttachmentFn=function(e){var t,n;return n=(t=$(e.currentTarget).parent()).data("pos"),t.remove(),c.moreAttachments[n]=null},t.prototype.selectFileFn=function(){return c.$el.find("input[name=fileData]").trigger("click")},t.prototype.toggleUseMailServerConfigFn=function(e){var t,n;return n=$(e.currentTarget),t=c.$el.find(".mail_server_config"),n.is(":checked")?t.show():t.hide()},t.prototype.publicEmailFile=function(e,t){var n,o,s,l;return this.dimmer.dimmer("show"),n=function(n,i){var o,s,l,u,d,p,f,h,m,v,g,w,y;if(p=i[0],h=i[1],w=i[2],s=p.attachmentMap||{},!n){switch(l=[],d={host:e.host,port:e.port,tls:e.tls,user:e.user,password:e.password,from:e.from,to:e.to,cc:e.cc,bcc:e.bcc,filename:e.subject||c.model.get("title"),useMailServerConfig:e.useMailServerConfig,attachmentMap:s},e.mainBody){case"user":g=e.userMainBody;break;case"markdown":g=c.model.get("content")||"",g=(g=_.escape(g)).split("\n").join("<br>");break;case"png":s[u="xsj_png"]={cid:u,filename:"xsj_png.png",path:"data:image/png;base64,"+w.base64},g="<p><img src='cid:"+u+"'/></p>";break;default:g=p.content}if(e.attachmentMarkdown&&l.push({filename:c.model.get("title")+".md",content:c.model.get("content")}),e.attachmentPreview&&l.push({filename:c.model.get("title")+".html",encoding:"base64",content:h.base64}),e.attachmentPng&&l.push({filename:c.model.get("title")+".png",encoding:"base64",content:w.base64}),c.moreAttachments&&c.moreAttachments.length>0)for(m=0,v=(y=c.moreAttachments).length;m<v;m++)(o=y[m])&&l.push({filename:o.filename,encoding:"base64",content:o.datauri.split(",")[1]});return d.attachments=l,e.separateTo?(f=e.to.split(","),async.mapLimit(f,10,(function(e,t){var n;return n={},_.extend(n,d,{to:e,cc:"",bcc:""}),a.publicEmailFile(g,n,(function(n){return n?r.showMessage("\u53d1\u9001\u7ed9'"+_.escape(e)+"'\u5931\u8d25\uff1a"+n,6e3,"error"):r.showMessage("\u53d1\u9001\u7ed9'"+_.escape(e)+"'\u6210\u529f\uff1a"),t()}))}),(function(e,n){return c.dimmer.dimmer("hide"),t(e)}))):a.publicEmailFile(g,d,(function(e){return c.dimmer.dimmer("hide"),t(e)}))}t(n)},o=function(t){var n,r;return"preview"!==e.mainBody?t(null,{attachmentMap:{}}):(r=c.model,n={type:"cidAndDataURL",netImage:!0,changeOpenTarget:!0,parseClientLocalMedias:!0,brand:"xsj_email_content"},e.numberedHeading&&(n.renderNumberedHeading=!0),$(window).trigger("convertPreviewFormatForExport",[r,n,function(e,n,o,s){return n.find(".li_linenum").addClass("li_list_style"),n.find(".li_linenum_before_span_hide").remove(),i.getStyleText(r,(function(e,i){return a.inlineStylesheet(n.html(),i,(function(e,n){return t(e,{content:n,type:"text",attachmentMap:o})}))}))}]))},s=function(t){var n,r;return e.attachmentPreview?(r=c.model,n={type:"dataURL",netImage:!0,changeOpenTarget:!0,parseClientLocalMedias:!0,brand:"xsj_email_html"},$(window).trigger("convertPreviewFormatForExport",[r,n,function(e,o){return i.getStyleText(r,(function(e,i){return a.exportHtmlFile(o,r.get("title"),i,n,(function(e,n,i){return a.blob2Base64(n,(function(e,n){return t(e,{base64:n,type:"base64"})}))}))}))}])):t(null,null)},l=function(t){var n,i;return"png"===e.mainBody||e.attachmentPng?(i=c.model,n={type:"dataURL",netImage:!0,changeOpenTarget:!1,parseClientLocalMedias:!0,convertSvg:!1,brand:"xsj_email_picture"},$(window).trigger("convertPreviewFormatForExport",[i,n,function(e,n){var i,r,o;return r=n[0].ownerDocument.documentElement,(i=$(r)).addClass("xiaoshujiang_camera"),(o=i.find(".xiaoshujiang_element")).addClass("xiaoshujiang_element_hide"),domtoimage.toBlob(r).then((function(e){return i.removeClass("xiaoshujiang_camera"),o.removeClass("xiaoshujiang_element_hide"),watermark([e]).blob(watermark.text.lowerRight("\u4e66","bold 48px webfontxiaoshujiang","#2f2f2f",.5))})).then((function(e){return a.blob2Base64(e,(function(e,n){return watermark.destroy(),t(e,{base64:n,type:"base64"})}))})).catch((function(e){return i.removeClass("xiaoshujiang_camera"),o.removeClass("xiaoshujiang_element_hide"),t(e)}))}])):t(null,null)},async.series([o,s,l],n)},t.prototype.show=function(){var e,t,n,i,o,s,l;return c=this,this.render(),(l=localStorage.client_public_email_data)&&(s=JSON.parse(l)),this.dimmer=a.xsjDimmer(this.$el),this.$el.find(".ui.checkbox").checkbox(),e=this.$el,n=c.$el.find(".more_attachments"),i=function(e,t){var i,r;return i=t.name,r=c.moreAttachments.push({filename:i,datauri:e}),n.append('<div class="ui label" data-pos="'+(r-1)+'">'+i+'<i class="close icon delete_attachment link"></i></div>')},o=function(e){return async.eachSeries(e,(function(e,t){return a.insertImageFile([e],(function(e,n,r){return i(e,r),t()}))}),(function(e){if(e)return console.log(e),r.showMessage(""+e,6e3,"error")}))},a.initdragFilesSupport(e.find(".drop-zone"),o),a.initFileImportSupport(e.find('input[type="file"]'),o),t=e.find(".ui.form"),s||(s={}),s.mainBody="preview",s.separateTo="",t.deserialize(s),e.find("input[name=useMailServerConfig]").is(":checked")||e.find(".mail_server_config").hide(),t.find("input[name=subject]").val(c.model.get("title")),t.form({fields:{host:{identifier:"host",depends:"useMailServerConfig",rules:[{type:"empty",prompt:"\u90ae\u7bb1\u670d\u52a1\u5668\u5730\u5740\u4e0d\u80fd\u4e3a\u7a7a"}]},password:{identifier:"password",depends:"useMailServerConfig",rules:[{type:"empty",prompt:"\u5bc6\u7801\u4e0d\u80fd\u4e3a\u7a7a"}]},user:{identifier:"user",depends:"useMailServerConfig",rules:[{type:"empty",prompt:"\u7528\u6237\u540d\u4e0d\u80fd\u4e3a\u7a7a"}]},from:{identifier:"from",depends:"useMailServerConfig",rules:[{type:"empty",prompt:"\u53d1\u4ef6\u4eba\u90ae\u4ef6\u5730\u5740\u4e0d\u80fd\u4e3a\u7a7a"},{type:"email",prompt:"\u8bf7\u8f93\u5165\u4e00\u4e2a\u5408\u6cd5\u7684\u90ae\u4ef6\u5730\u5740"}]},to:{identifier:"to",rules:[{type:"empty",prompt:"\u63a5\u6536\u4eba\u90ae\u4ef6\u5730\u5740\u4e0d\u80fd\u4e3a\u7a7a"},{type:"xsjEmail",prompt:'\u8bf7\u8f93\u5165\u5408\u6cd5\u7684\u90ae\u4ef6\u5730\u5740 xxx@xxx.xx \u6216\u8005 "xxx" &lt;xxx@xxx.com&gt;'}]},cc:{identifier:"cc",optional:!0,rules:[{type:"xsjEmail",prompt:'\u8bf7\u8f93\u5165\u5408\u6cd5\u7684\u90ae\u4ef6\u5730\u5740 xxx@xxx.xx \u6216\u8005 "xxx" &lt;xxx@xxx.com&gt;'}]},bcc:{identifier:"bcc",optional:!0,rules:[{type:"xsjEmail",prompt:'\u8bf7\u8f93\u5165\u5408\u6cd5\u7684\u90ae\u4ef6\u5730\u5740 xxx@xxx.xx \u6216\u8005 "xxx" &lt;xxx@xxx.com&gt;'}]}},onSuccess:function(){var n,i;return i=t.serializeObject(),localStorage.client_public_email_data=JSON.stringify(i),n={host:e.find("input[name=host]").val().trim(),port:e.find("input[name=port]").val().trim()||"25",tls:e.find("input[name=tls]").is(":checked")||!1,user:e.find("input[name=user]").val().trim(),password:e.find("input[name=password]").val().trim(),from:e.find("input[name=from]").val().trim(),to:e.find("input[name=to]").val().trim(),cc:e.find("input[name=cc]").val().trim(),bcc:e.find("input[name=bcc]").val().trim(),subject:e.find("input[name=subject]").val().trim(),mainBody:e.find("input[name=mainBody]:checked").val(),userMainBody:e.find("textarea[name=userMainBody]").val().trim(),attachmentMarkdown:e.find("input[name=attachmentMarkdown]").is(":checked"),numberedHeading:e.find("input[name=numberedHeading]").is(":checked"),attachmentPreview:e.find("input[name=attachmentPreview]").is(":checked"),attachmentPng:e.find("input[name=attachmentPng]").is(":checked"),separateTo:e.find("input[name=separateTo]").is(":checked"),useMailServerConfig:e.find("input[name=useMailServerConfig]").is(":checked")},c.publicEmailFile(n,(function(e){return e?(r.showMessage("\u53d1\u9001\u5931\u8d25\uff1a"+e,6e3,"error"),c.dimmer.dimmer("hide")):(r.showMessage("\u53d1\u9001\u5b8c\u6210"),c.dimmer.dimmer("hide"))}))}}),this.$el.modal({closable:!1,onHidden:function(){var e,n,i;return(e=$("body>.preview_export_wrapper>iframe")).length>0&&(n=e[0].contentDocument,i=e[0].contentWindow,$(n.body).remove(),$(n).off(),$(i).off()),$("body>.preview_export_wrapper").remove(),t.form("destroy"),c.$el.modal("destroy"),c.moreAttachments.length=0,c.remove(),c=null},onApprove:function(){return t.form("validate form"),!1}}).modal("show")},t}(s),n.exports=o}}),window.requirejs.define({"views/client_public_file_dialog_view":function(e,t,n){var i,r,o,a,s,l,c,u,d,p,f,h,m={}.hasOwnProperty;c=t("./view"),l=t("../lib/utils"),o=t("../lib/notifier"),i=t("../application"),r=t("../models/file_model"),f=t("./templates/client_public_file_dialog"),s=t("./select_files_manager_for_batch_dialog_view"),h=null,d=!1,p=function(){return h.$el.modal("setting","transition","horizontal flip"),d=!0,new s({operatorFileDialogView:h,initDocs:h.selectedDocs||[]}).show()},u=function(){var e,t,n;if(h)return d=!1,(e=$("body>.preview_export_wrapper>iframe")).length>0&&(t=e[0].contentDocument,n=e[0].contentWindow,$(t.body).remove(),$(t).off(),$(n).off()),$("body>.preview_export_wrapper").remove(),h.$el.find(".ui.form").form("destroy"),h.$el.modal("destory"),h.remove(),h=null},a=function(e){var t;function n(){return n.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)m.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(n,e),n.prototype.template=f,n.prototype.className="ui standard story_modal modal",n.prototype.selectedDocs=[],n.prototype.publicBlogIdObj={},t=!1,n.prototype.initialize=function(){return this.cheerio=require("cheerio")},n.prototype.events={"click .select_files_button":"selectFilesFn","click .delete_file_button":"deleteSelectedFileFn"},n.prototype.selectFilesFn=function(){return p()},n.prototype.deleteSelectedFileFn=function(e){var t,n,i;return t=$(e.currentTarget).parent().parent(),n=t.data("id"),i=this.selectedDocs.filter((function(e){return e.id!==n})),this.selectedDocs=i,t.remove()},n.prototype.setSelectedDocs=function(e){var t;return this.selectedDocs=e||[],(t=this.$el.find(".selected_files_list")).empty(),this.selectedDocs.forEach((function(e,n){var i;return i=h.publicBlogIdObj[e.id]||"",t.prepend('<div class="item selected_item" data-id="'+_.escape(e.id)+'">\n  <div class="right floated content">\n    <div class="ui icon mini basic  button delete_file_button"><i class="ui icon close"></i></div>\n  </div>\n  <div class="right floated content ui mini input"><input type="text" placeholder="\u535a\u5ba2id" name="blogIds" value="'+_.escape(i)+'"></div>\n  <div class="content">\n    <div class="header">'+_.escape(e.title)+"</div>\n  </div>\n</div>")}))},n.prototype.publicFile=function(e,t,n){var r,a,s,c,u;return u=t.get("title"),c=this.cheerio,s=function(r,a){var s,d;return null==a&&(a=1),d=function(e){var t;return e?(t="",e.res&&(t="statusCode:"+e.res.statusCode,e.res.statusMessage&&(t+="; statusMessage:"+e.res.statusMessage)),"ENOTFOUND"===e.code&&"getaddrinfo"===e.syscall?"Unable to connect to Blog server":e.message&&e.message.startsWith("Unknown XML-RPC tag")?"("+t+")\u670d\u52a1\u5668\u8fd4\u56de\u4e86\u4e0d\u80fd\u8bc6\u522b\u7684\u6807\u7b7e\uff1a"+e.message+"\n"+e.body:e.body?t+"\n"+e+"\n"+e.body:t+"\n"+e):""},s=function(i){var o,s,c,p,f,h,m;for(o in c={title:u,description:i},s=t.getMeta()||{},p=e.publish,s)m=s[o],o.indexOf("weblog_")>=0&&(c[o.substring(7)]=m);if(e.userMeta&&(f=e.userMeta,/^---\s*\n([\s\S]+?)\n---\s*\n*/.exec(f)||(f="---\n"+f+"\n---\n"),h=l.getMetaData(f)))for(o in h)m=h[o],o.indexOf("weblog_")>=0?c[o.substring(7)]=m:c[o]=m;return e.articleId?$.xmlrpc({url:r,methodName:"metaWeblog.editPost",params:[e.articleId,e.user,e.password,c,p]}).done((function(e,t,i){return n()})).fail((function(e,t,i){return n(d(i||e.responseText||t||"server return error"))})):$.xmlrpc({url:r,methodName:"metaWeblog.newPost",params:[a,e.user,e.password,c,p]}).done((function(e,t,i){return n()})).fail((function(e,t,i){return n(d(i||e.responseText||t||"server return error"))}))},e.markdown?s(t.get("content")):$(window).trigger("convertPreviewFormatForExport",[t,{type:"cidAndDataURL",netImage:!1,changeOpenTarget:!0,parseClientLocalMedias:!0,convertSvg:e.convertSvg,brand:"xsj_public"},function(n,u,p){return async.eachSeries(Object.keys(p),(function(t,n){var i,s,c;return i=p[t],s=l.parseBase64Data(i.path),c={name:i.filename,type:s.type,bits:l.base64ToArrayBuffer(s.data)},$.xmlrpc({url:r,methodName:"metaWeblog.newMediaObject",params:[a,e.user,e.password,c]}).fail((function(e,t,n){return o.showMessage("\u4e0a\u4f20\u6587\u4ef6("+i.filename+")\u51fa\u9519\uff1a "+d(n),6e3,"error"),console.log(n)})).done((function(e,t,n){return e instanceof Array&&e.length>0&&(e=e[0]),i.url=e.url})).always((function(){return n()}))}),(function(n){var r,o,a,d,f;for(o in u.find("script").remove(),f=u.html(),r=c.load(f,{decodeEntities:!1}),p)(a=p[o]).url&&(r("img[src='cid:"+o+"']").attr("src",a.url),r("video[src='cid:"+o+"']").attr("src",a.url),r("audio[src='cid:"+o+"']").attr("src",a.url),r("a.attachment[href='cid:"+o+"']").attr("href",a.url));return r(".li_linenum_before_span").remove(),r(".li_linenum").addClass("li_list_style"),f=r.html(),d=function(e){return e=(e="<div "+(e=e.replace(/<style>[\s\S]*?<\/style>/,"")).substring(5)).substring(0,e.length-5)+"div>"},e.inlineStylesheet?i.getStyleText(t,(function(e,t){return l.inlineStylesheet(f,t,(function(e,t){return s(d(t))}))})):s(d(f))}))}])},r=function(e,t,i){var r,a,l;return(r=c.load(e)("api[name=MetaWeblog]")).length<=0?(o.showMessage("\u8be5\u535a\u5ba2\u65e0\u6cd5\u63d0\u4f9bmetaweblog\u63a5\u53e3",6e3,"error"),n("\u63a5\u53e3\u9519\u8bef")):(a=r[0].attribs.apilink,l=r[0].attribs.blogid,s(a,l))},a=function(t,n,i){var o,a,l,u;return(u=(o=c.load(t))("link[rel=EditURI]")).length<=0?o("api[name=MetaWeblog]").length<=0?(a=(a=e.url+"/xmlrpc.php?rsd").replace(/[\/]+/g,"/"),$.get(a,r,"html").fail((function(){return s(a)}))):r(t):(l=u[0].attribs.href,$.get(l,r,"html").fail((function(){return s(l)})))},$.get(e.url,a,"html").fail((function(){return s(e.url)}))},n.prototype.destroy=function(){return u()},n.prototype.hide=function(){return d=!0,h.$el.modal("hide")},n.prototype.show=function(){var e,n,i,a;return h?(h.$el.modal("show"),void(d=!1)):(h=this,this.render(),(a=localStorage.client_public_file_data)&&(i=JSON.parse(a)),h.dimmer=h.$el.find(".story_content").dimmer({closable:!1,onHide:function(){return h.$el.find(".story_content>.dimmer").empty()},onShow:function(){return h.$el.find(".story_content>.dimmer").html('<div class="ui indeterminate text loader">\u6570\u636e\u51c6\u5907\u4e2d...</div>')},template:{dimmer:function(){return $("<div>").attr("class","ui dimmer sticky")}}}),e=this.$el,(n=e.find(".ui.form")).deserialize(i),n.form({fields:{host:{identifier:"host",rules:[{type:"empty",prompt:"\u670d\u52a1\u5668\u5730\u5740\u4e0d\u80fd\u4e3a\u7a7a"}]},password:{identifier:"password",rules:[{type:"empty",prompt:"\u5bc6\u7801\u4e0d\u80fd\u4e3a\u7a7a"}]},user:{identifier:"user",rules:[{type:"empty",prompt:"\u7528\u6237\u540d\u4e0d\u80fd\u4e3a\u7a7a"}]}},onSuccess:function(){var i,a,s,l,c,u,d,p,f,m,v,g,_;if(h.selectedDocs&&0!==h.selectedDocs.length)return c=n.serializeObject(),e.find(".selected_item").map((function(e,t){var n,i,r;return r=(n=$(t)).data("id"),(i=$.trim(n.find("input[name=blogIds]").val()))?h.publicBlogIdObj[r]=i:delete h.publicBlogIdObj[r]})),localStorage.client_public_file_blog_id_map_info=JSON.stringify(h.publicBlogIdObj),localStorage.client_public_file_data=JSON.stringify(c),u=e.find("input[name=host]").val().trim(),/^http[s]?:\/\//i.test(u)||(u="http://"+u),g=e.find("input[name=user]").val().trim(),f=e.find("input[name=password]").val().trim(),v=e.find("input[name=publish]").is(":checked"),p=e.find("input[name=markdown]").is(":checked"),d=e.find("input[name=inlineStylesheet]").is(":checked"),a=e.find("input[name=convertSvg]").is(":checked"),_=e.find("textarea[name=userMeta]").val().trim(),s={url:u,user:g,password:f,publish:v,markdown:p,inlineStylesheet:d,convertSvg:a,userMeta:_},m=1,l=function(e,t){var n;return(n=new r).id=e.id,n.fetch({silent:!0,error:function(e){return o.showMessage("\u9519\u8bef\uff1a"+e,6e3,"error"),t(e)},success:function(i,r){return s.articleId=h.publicBlogIdObj[e.id]||"",h.publicFile(s,i,(function(e){return e||o.showMessage("\u53d1\u9001("+n.get("title")+")\u6210\u529f"),h.$el.find(".story_content>.dimmer>.text").text("\u5904\u7406\u4e2d("+m+++"/"+h.selectedDocs.length+")..."),t(e)}))}})},h.dimmer.dimmer("show"),t=!0,(i=h.$el.find(".ui.positive.button")).addClass("loading"),async.mapSeries(h.selectedDocs,l,(function(e,n){return e?o.showMessage("\u53d1\u5e03\u5931\u8d25\uff1a"+e,6e3,"error"):o.showMessage("\u53d1\u5e03\u5b8c\u6210"),i.removeClass("loading"),t=!1,h.dimmer.dimmer("hide")}));o.showMessage("\u81f3\u5c11\u9009\u62e9\u4e00\u4e2a\u6587\u4ef6",6e3,"error")}}),l.asyncLoadResources([{id:"jquery_xmlrpc_js",type:"script",filename:"js/other/jquery.xmlrpc.js"}],(function(){var e;if(h){try{h.publicBlogIdObj=JSON.parse(localStorage.getItem("client_public_file_blog_id_map_info")),h.publicBlogIdObj||(h.publicBlogIdObj={})}catch(t){e=t,h.publicBlogIdObj={},console.error(e)}return h.setSelectedDocs([{id:h.model.get("_id"),rev:h.model.get("_rev"),title:h.model.get("title")}]),h.$el.modal({onHidden:function(){if(!d)return u()},onApprove:function(){return t||n.form("validate form"),!1}}).modal("show")}})))},n}(c),n.exports=a}}),window.requirejs.define({"views/client_title_bar_view":function(e,t,n){var i,r,o,a,s,l,c,u={}.hasOwnProperty;l=t("./templates/client_title_control_buttons"),i=t("../application"),t("../constant"),o=t("./close_confirm_view"),s=null,c=null,a=null,r=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)u.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,Backbone.View),t.prototype.initialize=function(){return"client"===STORY_PLATFORM&&(s=require("nw.gui"),c=s.Window.get()),a=i.getApplicationProfileModel()},t.prototype.events={"click .client_title_main_button":"mainHome","click .client_title_lock_button":"lockWindow","click .client_title_min_button":"minWindow","click .client_title_max_button":"maxWindow","click .client_title_close_button":"closeWindow","click .client_zoom_btn":"zoomWindow","click .client_title_enter_fullscreen_button":"enterFullscreenWindow","click .client_title_leave_fullscreen_button":"leaveFullscreenWindow"},t.prototype.render=function(){var e;return e=this,this.$el.append(l()),this.$el.find(".client_title_more_button").dropdown({action:function(){},saveRemoteData:!1,forceSelection:!1,filterRemoteData:!1,className:{selected:"skip_selected"},delay:{hide:1e3},onShow:function(){return e.$el.find(".client_title_zoom_level").text(c.zoomLevel)}})},t.prototype.mainHome=function(){return i.sidebarView.$el.sidebar("toggle")},t.prototype.zoomWindow=function(e){switch($(e.currentTarget).data("type")){case"minus":$(window).trigger("clientZoomLevel",[-.25,!0]);break;case"plus":$(window).trigger("clientZoomLevel",[.25,!0]);break;default:$(window).trigger("clientZoomLevel",[0])}return this.$el.find(".client_title_zoom_level").text(c.zoomLevel)},t.prototype.enterFullscreenWindow=function(){return window._tmpMaximizingOrUn=!0,null!=c&&c.enterFullscreen(),$("body").addClass("client_fullscreen_mode"),setTimeout((function(){return window._tmpMaximizingOrUn=!1}),900)},t.prototype.leaveFullscreenWindow=function(){return setTimeout((function(){return $("body").removeClass("client_fullscreen_mode")}),1e3),null!=c?c.leaveFullscreen():void 0},t.prototype.minWindow=function(){return null!=c?c.minimize():void 0},t.prototype.maxWindow=function(){if(c)return a.get("windowMaximize")||!1?null!=c?c.restore():void 0:(c.maximize(),c.blur(),setTimeout((function(){return c.focus()}),1))},t.prototype.lockWindow=function(){var e;if((e=a.get("lockPassword")||"")||(e=prompt("\u8bf7\u8f93\u5165\u9501\u5c4f\u5bc6\u7801")),null!==e)return e&&(console.log(e),i.lockWindow(e)),this.trayWindow()},t.prototype.trayWindow=function(){return window.xsjClientApp.trayWindow()},t.prototype.closeWindow=function(){switch(a.get("closeBehavior")||"default"){case"exit":return nw.App.closeAllWindows();case"tray":return this.trayWindow();default:if(!window.closeConfirmView)return window.closeConfirmView=new o,window.closeConfirmView.show()}},t}(),n.exports=r}}),window.requirejs.define({"views/client_upgrade_dialog_view":function(e,t,n){var i,r,o,a,s,l,c,u,d,p,f,h,m={}.hasOwnProperty;o=t("./view"),t("../constant"),r=t("../lib/notifier"),t("../application"),p=t("./templates/client_upgrade_dialog"),f=null,h=null,l=null,a=null,s=0,d=function(e,t){return e?r.showMessage("\u5347\u7ea7\u5931\u8d25: "+e,6e3,"error"):(r.showMessage("\u4e0b\u8f7d\u5b8c\u6210"),h.runInstaller(t,["--upgrade","copyPath="+h.getAppPath(),"execPath="+h.getAppExec()]),a.App.quit())},u=function(e,t,n){return e?r.showMessage("\u5347\u7ea7\u5931\u8d25: "+e,6e3,"error"):h.unpack(t,d,n)},c=null,i=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)m.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.template=p,t.prototype.getRenderData=function(){return{appVersion:APP_VERSION}},t.prototype.className="ui small modal",t.prototype.initialize=function(e){var t,n;return n=require("node-webkit-updater"),t=require("../package.json"),h=new n(t),a=require("nw.gui")},t.prototype.show=function(){var e,t;return f=this,this.render(),(t=this.$el.find(".progress")).progress({percent:0}),e=this.$el.find(".description"),this.$el.modal({closable:!1,onVisible:function(){return $("body").dimmer({closable:!1,useCSS:!0})},onShow:function(){var n;return n=function(n,i,r,o,a){return n?e.html("\u68c0\u6d4b\u65b0\u7248\u672c\u51fa\u9519: "+n):i?(l=o,(c=h.download((function(e,n){if(t.progress({percent:100}),c)return u(e,n,l),c=null}),l)).on("data",(function(e){var n;return n=(s+=e.length)/c["content-length"]*100,t.progress("set progress",n)}))):e.html("\u5df2\u7ecf\u662f\u6700\u65b0\u7248\u672c")},h.checkNewVersion(n)},onHidden:function(){return f.$el.modal("destroy"),f.remove(),c&&(c.abort(),c=null),f=null,h=null,l=null,a=null,s=0}}).modal("show")},t}(o),n.exports=i}}),window.requirejs.define({"views/close_confirm_view":function(e,t,n){var i,r,o,a,s,l,c,u,d={}.hasOwnProperty;o=t("./view"),t("../constant"),i=t("../application"),l=t("./templates/close_confirm"),c=null,s=null,u=null,a=null,r=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)d.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.template=l,t.prototype.className="ui small modal",t.prototype.events={"click .exit_button":"exitSys","click .tray_button":"traySys"},t.prototype.initialize=function(){return"client"===STORY_PLATFORM&&(s=require("nw.gui"),u=s.Window.get()),a=i.getApplicationProfileModel()},t.prototype.exitSys=function(){return c.$el.find("input[name=saveCloseBehavior]").is(":checked")&&(a.set({closeBehavior:"exit"}),a.save()),null!=u?u.close():void 0},t.prototype.traySys=function(){return c.$el.find("input[name=saveCloseBehavior]").is(":checked")&&(a.set({closeBehavior:"tray"}),a.save()),window.xsjClientApp.trayWindow(),c.$el.modal("hide")},t.prototype.show=function(){var e;return c=this,this.render(),e=function(){return c.$el.modal({onHidden:function(){return window.closeConfirmView=null,c.$el.modal("destroy"),c.remove(),c=null,s=null,u=null,a=null}}).modal("show")},$(".ui.modal.active, .ui.modal.animating").length>0?$("<div></div>").modal("hide all",e):e()},t}(o),n.exports=r}}),window.requirejs.define({"views/cloud_search_view":function(e,t,n){var i,r,o,a,s,l,c,u,d,p,f,h,m,v=function(e,t){for(var n in t)g.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e},g={}.hasOwnProperty;c=t("../lib/notifier"),t("../lib/utils"),i=t("../application"),r=t("./base_window_manager_view"),s=t("../constant"),l=t("../lib/database_sync"),d=function(e){if(e){if(e instanceof TypeError)e=e.toString();else try{e=JSON.stringify(e)}catch(t){t,console.log(e)}return e}},f=function(e,t,n){var i,r,o,a,s,l;return r={},e.__opts.auth&&(l=e.__opts.auth.username,a=e.__opts.auth.password,i=btoa(unescape(encodeURIComponent(l+":"+a))),r.headers={Authorization:"Basic "+i}),o=(o=e.name).replace(/^\/+|\/+$/g,""),t?(s=o+"/_search/search/searchV1?q="+encodeURIComponent(t.replace(/[,\/]/g," ")),n&&(s=s+"&skip="+n)):s=o+"/_search/search/searchV1",fetch(s,r).then((function(e){if(e.status<200||e.status>=300)throw new Error(e.status+":"+e.statusText);return e.json()})).catch((function(e){return e=e.responseText||e,e=d(e),c.showMessage("\u8fde\u63a5\u8fdc\u7a0b\u670d\u52a1\u5668\u51fa\u9519"+e,6e3,"error"),{error:"\u8fde\u63a5\u8fdc\u7a0b\u670d\u52a1\u5668\u51fa\u9519"}}))},p=function(){var e;return e="{\n    \"_id\":\"_design/search\",\n    \"fulltext\": {\n        \"searchV1\": {\n            \"analyzer\":\"perfield:{tags:'keyword',default:'ik'}\",\n            \"index\":\"function(doc) { if (doc.type !== 'markdown' || !!doc.isDeleted || !!doc._deleted) { return null;} var ret=new Document(); ret.add(doc.content);ret.add(doc.title, {field: 'title', type: 'string',store: 'yes',}); ret.add(new Date(doc.createDate), {field: 'createDate', type: 'date', store: 'yes'}); ret.add(new Date(doc.updateDate), {field: 'updateDate', type: 'date', store: 'yes'}); ret.add(doc.category, {field: 'category', type: 'string', store: 'yes'}); ret.add(doc.emoji, {field: 'emoji', type: 'string', store: 'yes'});if (doc.tagNames && doc.tagNames.length > 0) { doc.tagNames.forEach(function(tagName){ret.add(tagName, {field: 'tags', type: 'text', store: 'yes'});})} return ret; }\"\n        }\n    }\n}".trim(),JSON.parse(e)},u=function(e){return p(),!!(e&&e.fulltext&&e.fulltext.search)},m=function(e,t,n){var i;return i=p(),u(t)?n():(t&&t._rev&&(i._rev=t._rev),e.put(i,(function(e){return e=d(e),n(e)})))},h=function(e,t){return e.get("_design/search",(function(n,i){return m(e,i,t)}))},o=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return v(t,e),t.prototype.local_storage_name="cloud_search_window_manager",t}(r),a=function(e){var t,n,r,a,u,d,p;function m(){return m.__super__.constructor.apply(this,arguments)}return v(m,e),m.prototype.className="draggable_dialog_content_container",t=null,d=null,p=null,a="",n="",u={},m.prototype.getManagerWindow=function(){return t},m.prototype.initialize=function(e){return d=this},m.prototype.events={"click .cloud_search_button":"searchFileFn","keydown .cloud_search_input":"enterKeySearchFileFn","change .list_pagination .page_select":"pageNavigationFn","click .list_pagination .page_button":"pageNumNavigationFn","click .file_item":"fileItemSyncFn","click .create_search_button":"createSearchFn","click .return_home_button":"returnHomeFn","click .saved_search_button":"savedSearchStoreFn","click .delete_saved_search_button":"deleteSavedSearchStoreFn"},m.prototype.deleteSavedSearchStoreFn=function(e){var t,n;return e.preventDefault(),e.stopPropagation(),n=(t=$(e.currentTarget).parent().parent()).data("query"),delete u[n],localStorage.setItem("cloud_search_favorite_inputs",JSON.stringify(u)),t.remove()},m.prototype.savedSearchStoreFn=function(e){var t,n;return t=$(e.currentTarget).data("query"),n=u[t],this.$el.find(".cloud_search_input").val(n.query)},m.prototype.returnHomeFn=function(e){return this.$el.find(".cloud_search_files_home").show(),this.$el.find(".cloud_search_files_list").hide()},m.prototype.createSearchFn=function(e){var t,n,i,r,o;return i=this,n=$(e.currentTarget),r=$.trim(this.$el.find(".cloud_search_files_list .cloud_search_input").val()),t=$('<div class="ui  longer mini modal">\n  <i class="close icon"></i>\n  <div class="header">\n    \u6dfb\u52a0\u5feb\u901f\u67e5\u8be2\n  </div>\n  <div class="content">\n<form class="ui form">\n  <div class="field">\n    <label>\u522b\u540d</label>\n    <input type="text" name="name">\n  </div>\n  <div class="field">\n    <label>\u67e5\u8be2\u8bcd</label>\n    <input type="text" name="query" value="'+_.escape(r)+'">\n  </div>\n</form>\n  </div>\n<div class="actions">\n      <div class="ui negative button">\n        \u53d6\u6d88\n      </div>\n      <div class="ui positive button">\n        \u786e\u8ba4\n      </div>\n    </div>\n</div>'),o=!1,t.modal({onApprove:function(){var e,n;if(!(e=t.find(".ui.positive.button")).hasClass("loading"))return n=$.trim(t.find("input[name=name]").val()),r=$.trim(t.find("input[name=query]").val()),n?r?(e.addClass("loading"),u[uniqueNumber()]={name:n,query:r},localStorage.setItem("cloud_search_favorite_inputs",JSON.stringify(u)),setTimeout((function(){return d.renderQuickSearchResult(),e.removeClass("loading"),t.modal("hide"),o=!0}),100),!1):(c.showMessage("\u67e5\u8be2\u8bcd\u4e0d\u80fd\u4e3a\u7a7a",6e3,"error"),!1):(c.showMessage("\u522b\u540d\u4e0d\u80fd\u4e3a\u7a7a",6e3,"error"),!1)},onHidden:function(){var e,r,a,s;if(t.modal("destroy"),t.remove(),o)return s=n.offset(),a=(r=i.$el.find(".return_home_button")).offset(),(e=$("<i class='xsj_flyer icon plus'></i>")).fly({start:{left:s.left,top:s.top},end:{left:a.left,top:a.top},onEnd:function(){return r.transition("clear queue").transition("pulse"),e.remove(),e=null,r=null}})}}).modal("show"),console.log(e)},r=function(e){return i.getFileCollection().getModelById(e,(function(e,t){return e?c.showMessage("\u6253\u5f00\u6587\u4ef6\u5931\u8d25:"+e,6e3,"error"):t?$(window).trigger("createNewEditor",[t,{forceOpen:!0,groupId:n,callback:function(e,t){var i;if(n=e.id,i=t.$el.find(".popup_editor_file_tabs .file_item.droppable_file_item.active")[0])return appHighlightPosByEl(i)}}]):c.showMessage("\u6253\u5f00\u6587\u4ef6\u5931\u8d25: \u627e\u4e0d\u5230\u8be5\u6587\u4ef6",6e3,"error")}))},m.prototype.fileItemSyncFn=function(e){var t,n,i;if(t=$(e.currentTarget),n=t.data("id"),i=!1,t.hasClass("file_item_local_not_found")||(r(n),i=!0),!(t.find(".file_item_syncing").length>0))return t.prepend('<div class="right floated content file_item_syncing">\n  <div class="ui button loading icon basic"></div>\n</div>'),p.get(n,(function(e,o){var a,u,d;if(a=[n],o)for(u in d=o._attachments||{})d[u].content_type===s.fileContentType.attachment&&a.push(n+"__"+u);return l.syncSpecDocIds(a,(function(e){return t.find(".file_item_syncing").remove(),e?c.showMessage("\u6293\u53d6\u6587\u7ae0\u5931\u8d25:"+e,6e3,"error"):(t.removeClass("file_item_local_not_found"),i?void 0:r(n))}))}))},m.prototype.pageNumNavigationFn=function(e){var n;if(this,!(n=$(e.currentTarget)).hasClass("disabled"))return t.showDimmer(),this.searchFile(a,parseInt(n.data("skip"),10),(function(){return t.hideDimmer()}))},m.prototype.pageNavigationFn=function(e){var n;return this,t.showDimmer(),n=$(e.currentTarget),this.searchFile(a,n.val(),(function(){return t.hideDimmer()}))},m.prototype.searchFileFn=function(e){var t,n,i;if(n=$(e.currentTarget),!(i=n.parent()).hasClass("loading"))return t=i.find(".cloud_search_input"),i.addClass("loading"),this.searchFile(t.val(),0,(function(){return i.removeClass("loading")}))},m.prototype.enterKeySearchFileFn=function(e){var t,n;if(t=$(e.currentTarget),n=t.parent(),13===e.keyCode){if(n.hasClass("loading"))return;return n.addClass("loading"),this.searchFile(t.val(),0,(function(){return n.removeClass("loading")}))}},m.prototype.searchFile=function(e,t,n){var i;return i=this,(a=e)?(this.$el.find(".cloud_search_input").val(a),f(p,a,t).then((function(e){var t;return e.error?(c.showMessage(e.error,6e3,"error"),void n()):(t=e.rows.map((function(e){return e.id})),s.pouchDB.allDocs({keys:t,include_docs:!0}).then((function(t){var r;return r={},t.rows.forEach((function(e){var t;if((t=e.doc)&&!t.isDeleted&&!t._deleted)return r[e.key]=!0})),i.renderResult(e,r),n()})))}))):(c.showMessage("\u641c\u7d22\u5185\u5bb9\u4e0d\u80fd\u4e3a\u7a7a",6e3,"error"),void n())},m.prototype.renderResult=function(e,t){var n,i,r,o,a,s,l,c,u;if(this.$el.find(".cloud_search_files_home").hide(),this.$el.find(".cloud_search_files_list").show(),(n=this.$el.find(".cloud_search_files_list_container")).find(".list_results,.list_pagination,.list_blank").remove(),e.total_rows>0){for(r=$("<div class='list_results ui list selection'></div>"),e.rows.forEach((function(e){var n,i,o,a,s,l;return[],n=e.fields.emoji||"",o="large file text outline middle aligned icon alternate",i="",t[e.id]||(i="file_item_local_not_found"),n&&(o+=" file_emoji"),"string"==typeof(a=e.fields.tags||[])&&(a=[a]),a=a instanceof Array?a.map((function(e){return"#"+e})):[],s='<i class="clock outline icon"></i> '+moment(e.fields.createDate).format("YYYY\u5e74MM\u6708DD\u65e5")+'/<time class="file_item_update_date" datetime="'+(l=moment(e.fields.updateDate||new Date).toDate()).toISOString()+'">'+$.timeago(l)+"</time>",r.append('<div class="item file_item '+i+'" data-id="'+_.escape(e.id)+'">\n  <i class="'+o+'">'+n+'</i>\n  <div class="content">\n    <div class="header">\n    '+_.escape(e.fields.title)+'\n    </div>\n    <small class="description">\n    '+s+"\n    <br />\n    "+_.escape(a.join(","))+"\n    </small>\n  </div>\n</div>")})),n.append(r),u=Math.ceil(e.total_rows/e.limit),i=$('<div class="list_pagination">\n  <span class="list_pagination_info">\u603b\u5171 '+e.total_rows+" \u7bc7\u3002\u5f53\u524d\u7b2c</span>\n</div>"),l=function(e,t,n,i){var r,o;return o="",r="",e<=1&&(o="disabled"),e>=t&&(r="disabled"),i.prepend("<span>\n  <i class='page_button icon angle double left link "+o+'\' title="\u9996\u9875" data-skip="0"></i>\n  <i class=\'page_button icon angle left link '+o+'\' title="\u4e0a\u4e00\u9875" data-skip="'+(e-2)*n+"\"></i>\n  <i class='page_button icon angle right link "+r+'\' title="\u4e0b\u4e00\u9875" data-skip="'+e*n+"\"></i>\n  <i class='page_button icon angle double right link "+r+'\' title="\u5c3e\u9875" data-skip="'+(t-1)*n+'"></i>\n</span>')},o=$('<select class="page_select"></select>'),i.append(o),i.append("<span>\u9875 / \u603b\u5171 "+u+" \u9875\u3002</span>"),c=1,s=1;c<=u;)(a=e.skip===(c-1)*e.limit?"selected":"")&&(s=c),o.append('<option value="'+(c-1)*e.limit+'" '+a+">\n  "+c+"\n</option>"),c++;return l(s,u,e.limit,i),n.append(i)}return n.append('<div class="list_blank">\u6ca1\u6709\u627e\u5230\u76f8\u5173\u6587\u7ae0</div>')},m.prototype.show=function(){var e;return(t=new o({canMax:!1,canMin:!1})).show(),this.render(),t.$el.find(".draggable_dialog_content_container_wrapper").append(this.$el),e=this,t.on("beforeClose",(function(){return e.destroySearchResults()})),t.on("close",(function(){return e.trigger("close"),e.remove(),t=null}))},m.prototype.render=function(){var e,i;if(i=this,t.showDimmer(),e=$('<div class="draggable_dialog_content cloud_search_container" style="overflow:hidden; flex-basis: 0;position:initial;">\n<div class="cloud_search_files_container">\n  <div class="cloud_search_files_home">\n    <div class="list_searchs"></div>\n    <div class="ui search">\n      <div class="ui icon input">\n        <input class="prompt cloud_search_input" type="text" placeholder="\u8f93\u5165\u8981\u67e5\u627e\u7684\u5185\u5bb9">\n        <i class="search icon cloud_search_button circular link"></i>\n      </div>\n    </div>\n  </div>\n  <div class="cloud_search_files_list" style="display:none">\n    <div class="ui search " style="display: flex;margin: .3em;">\n      <div class="ui icon input" style="flex:1;">\n        <input class="cloud_search_input" type="text" placeholder="\u8f93\u5165\u8981\u67e5\u627e\u7684\u5185\u5bb9">\n        <i class="search icon cloud_search_button circular link"></i>\n      </div>\n      <i class="plus icon create_search_button link circular_icon" title="\u6dfb\u52a0\u5feb\u901f\u67e5\u8be2"></i>\n      <i class="reply all icon return_home_button link circular_icon" title="\u8fd4\u56de"></i>\n    </div>\n    <div class="cloud_search_files_list_container blurring">\n      <div class="list_results">\u8be6\u7ec6\u7ed3\u679c</div>\n      <div class="list_blank">\u627e\u4e0d\u5230\u641c\u7d22\u7ed3\u679c</div>\n      <div class="list_pagination">\u5206\u9875\u4fe1\u606f</div>\n    </div>\n  </div>\n</div>\n    </div>'),this.$el.html(e),p=l.getTargetDB())return n="group_"+uniqueNumber(),h(p,(function(e){if(!e)return f(p).then((function(e){var n,r;if(e.error)return'<span style="line-height:1.5;">\u60a8\u7684\u6570\u636e\u5e93\u670d\u52a1\u5668\u4e0d\u652f\u6301\u5168\u6587\u641c\u7d22\u529f\u80fd\u3002<br/>\u8bf7\u5b89\u88c5\u5c0f\u4e66\u5320<strong>\u5929\u9a6c\u98de\u5929\u7248</strong>\uff0c\u5b9e\u73b0\u670d\u52a1\u5668\u6570\u636e\u5e93\u5168\u6587\u641c\u7d22\u529f\u80fd\u3002<br/>\u8be6\u7ec6\u6559\u7a0b\u8bf7\u67e5\u770b<a href="https://hub.docker.com/repository/docker/suziwen/dragon" target="_blank">\u8fd9\u91cc</a>\u3002</span>',void t.showDimmer('<span style="line-height:1.5;">\u60a8\u7684\u6570\u636e\u5e93\u670d\u52a1\u5668\u4e0d\u652f\u6301\u5168\u6587\u641c\u7d22\u529f\u80fd\u3002<br/>\u8bf7\u5b89\u88c5\u5c0f\u4e66\u5320<strong>\u5929\u9a6c\u98de\u5929\u7248</strong>\uff0c\u5b9e\u73b0\u670d\u52a1\u5668\u6570\u636e\u5e93\u5168\u6587\u641c\u7d22\u529f\u80fd\u3002<br/>\u8be6\u7ec6\u6559\u7a0b\u8bf7\u67e5\u770b<a href="https://hub.docker.com/repository/docker/suziwen/dragon" target="_blank">\u8fd9\u91cc</a>\u3002</span>');r=localStorage.getItem("cloud_search_favorite_inputs");try{"object"!=typeof(u=JSON.parse(r)||{})&&(u={})}catch(e){n=e,console.log(n)}return i.renderQuickSearchResult(),t.hideDimmer()}));c.showMessage("\u8fde\u63a5\u8fdc\u7a0b\u670d\u52a1\u5668\u51fa\u9519"+e,6e3,"error")}));c.showMessage("\u60a8\u8fd8\u6ca1\u6709\u914d\u7f6e\u81ea\u5b9a\u4e49\u670d\u52a1\u5668",6e3,"error")},m.prototype.renderQuickSearchResult=function(){var e,t,n,i;for(n in(t=this.$el.find(".list_searchs")).empty(),[],e=$('<div class="ui middle aligned selection list ordered"></div>'),u)i=u[n],e.append('<a class="item saved_search_button" data-query="'+n+'">\n<div class="right floated content">\n  <i class="icon close delete_saved_search_button link"></i>\n</div>\n'+_.escape(i.name)+"</a>");return t.append(e)},m.prototype.destroySearchResults=function(){return this.$el},m.prototype.remove=function(){return t=null,d=null,p=null,a="",n="",u={},m.__super__.remove.apply(this,arguments)},m.prototype.close=function(){return t.remove()},m}(Backbone.View),n.exports=a}}),window.requirejs.define({"views/cloud_sync_progress_view":function(e,t,n){var i,r,o,a,s,l=function(e,t){for(var n in t)c.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e},c={}.hasOwnProperty;t("../lib/notifier"),t("../lib/utils"),t("../application"),i=t("./base_window_manager_view"),t("../constant"),a=t("../lib/database_sync"),s=function(){return function(e){var t,n,i,r,o;function a(){return a.__super__.constructor.apply(this,arguments)}return l(a,e),a.prototype.className="sync_info_view",a.prototype.id=null,t=null,n=null,i=null,null,null,o=null,r=!1,a.prototype.initialize=function(e){return this.id=e.id},a.prototype.getTabEl=function(){var e;return e=this.id,$('<i class="active list ul icon only_normal_button link large cloud_sync_progress_tab" data-id="'+e+'" title="'+e+'"></i>')},a.prototype.render=function(){return this.$el.html('<div class="sync_info_progress">\n  <div class="ui active progress sync_info_pull_progress" style="display: none;">\n    <div class="bar">\n      <div class="progress"></div>\n    </div>\n    <div class="label">\u4e0b\u8f7d</div>\n  </div>\n  <div class="ui active progress sync_info_push_progress" style="display: none;">\n    <div class="bar">\n      <div class="progress"></div>\n    </div>\n    <div class="label">\u4e0a\u4f20</div>\n  </div>\n</div>\n<div class="sync_info_messages"></div>\n<div class="ui dimmer">\n  <div class="ui text loader">\u540c\u6b65\u4e2d</div>\n</div>'),n=this.$el.find(".ui.progress.sync_info_pull_progress"),i=this.$el.find(".ui.progress.sync_info_push_progress"),n.progress({percent:0}),i.progress({percent:0}),t=this.$el.find(".sync_info_messages"),this.$el.dimmer("show"),this.hide()},a.prototype.instanceSync=function(e){if(!r){switch(e.listeners,o=e.type){case"pull":n.show();break;case"push":i.show();break;default:n.show(),i.show()}return r=!0}},a.prototype.update=function(e){var r,a,s,l,c,u,d,p,f;switch(e.state){case"start":return this.instanceSync(e);case"processing":return this.$el.dimmer("hide"),a=parseInt(e.checkpointInfo.pending_batch,10)||0,f="pull"===e.type?parseInt(e.targetInfo.update_seq,10)||1:parseInt(e.dbInfo.update_seq,10)||1,void t.prepend("<div>"+moment().format("YYYY-MM-DD hh:mm:ss  ")+" check seq: "+a+"/"+f+" "+e.type+"\n</div>");case"syncing":if(this.instanceSync(e),this.$el.dimmer("hide"),r=l=e.info,c=u=e.targetInfo.info,p=[],s=l.docs,d="download","push"===o&&(d="upload"),"pullpush"===o&&(r=l.change,c=u.change,s=r.docs,"push"===l.direction&&(d="upload")),s.forEach((function(e){if(p.push(e._id),"markdown"===e.type&&p.push(e.title),"attachment"===e.type)return p.push(e.filename)})),t.prepend("<div>"+moment().format("YYYY-MM-DD hh:mm:ss  ")+" "+d+"\n "+_.escape(p.join("\n"))+"</div>"),"download"!==d)return i.progress({percent:100*r.last_seq/e.dbInfo.update_seq});if(r.pending&&c.pending)return n.progress({percent:100*(c.pending-r.pending)/c.pending});if(r.last_seq&&e.targetInfo.update_seq)return n.progress({percent:100*r.last_seq/e.targetInfo.update_seq});break;case"end":return this.$el.dimmer("hide"),t.prepend("<div>finished</div>"),n.progress({percent:100}),i.progress({percent:100});case"fault":return this.$el.dimmer("hide"),t.prepend("<div>error: "+_.escape(e.error)+"</div>")}},a.prototype.hide=function(){return this.$el.hide()},a.prototype.show=function(){return this.$el.show()},a.prototype.destroy=function(){return this.$el.dimmer("destroy"),n.progress("destroy"),i.progress("destroy"),this.remove()},a}(Backbone.View)},r=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return l(t,e),t.prototype.local_storage_name="cloud_sync_progress_window_manager",t}(i),o=function(e){var t,n,i,o;function c(){return c.__super__.constructor.apply(this,arguments)}return l(c,e),c.prototype.className="draggable_dialog_content_container",null,t=null,i=null,o={},n=null,c.prototype.getManagerWindow=function(){return t},c.prototype.initialize=function(e){return i=this},c.prototype.events={"click .cloud_sync_progress_tab":"changeCurrentSyncInfoViewFn"},c.prototype.changeCurrentSyncInfoViewFn=function(e){var t,i;if(i=(t=$(e.currentTarget)).data("id"),o[i]&&n.id!==i)return n.hide(),(n=o[i]).show(),this.$el.find(".cloud_sync_progress_tab").removeClass("active"),t.addClass("active")},c.prototype.show=function(){var e;return(t=new r).show(),this.render(),t.$el.find(".draggable_dialog_content_container_wrapper").append(this.$el),(e=this).initSyncStatus(),t.on("beforeClose",(function(){return e.destroySyncStatus()})),t.on("close",(function(){return e.trigger("close"),e.remove(),t=null}))},c.prototype.render=function(){var e;return t.showDimmer(),e=$('<div class="draggable_dialog_content cloud_sync_progress_container" style="overflow:hidden; flex-basis: 0;position:initial;">\n  <div class="task_tree_container theme_tree_container">\n    <div class="task_tree_container_buttons">\n      <span class="task_tree_buttons cloud_sync_progress_tabs">\n      </span>\n    </div>\n    <div class="task_tree cloud_sync_progress_content_container"></div>\n  </div>\n</div>'),this.$el.html(e),t.hideDimmer()},c.prototype.initSyncStatus=function(){return this.$el,a.on("syncInfo",(function(e){return i.renderSyncInfo(e)}))},c.prototype.destroySyncStatus=function(){var e;for(e in this.$el,a.off("syncInfo"),o)o[e].destroy();return o={},n=null},c.prototype.renderSyncInfo=function(e){var t,i,r;return t=e.id,(i=o[t])||((i=new(s())({id:t})).render(),this.$el.find(".cloud_sync_progress_content_container").append(i.$el),this.$el.find(".cloud_sync_progress_tab").removeClass("active"),r=i.getTabEl(),this.$el.find(".cloud_sync_progress_tabs").prepend(r),o[t]=i,n&&n.hide(),(n=i).show()),i.update(e)},c.prototype.remove=function(){return null,t=null,i=null,c.__super__.remove.apply(this,arguments)},c.prototype.close=function(){return t.remove()},c}(Backbone.View),n.exports=o}}),window.requirejs.define({"views/cloud_sync_view":function(e,t,n){var i,r,o,a,s,l,c,u,d,p,f,h,m,v,g,w,y,b,x,k,D,C,F,M,T,S=function(e,t){return function(){return e.apply(t,arguments)}},P={}.hasOwnProperty;u=t("./view"),i=t("../application"),c=t("../lib/notifier"),M=t("./templates/cloud_sync"),l=t("../lib/database_sync"),s=t("../constant"),o=t("./cloud_sync_progress_view"),r=t("./cloud_search_view"),T=null,d='<i class="bottom right corner user icon sync_type_icon"></i>',MINI_WEB&&!MAC_STORE_WEB&&(d='<i class="bottom right corner user icon sync_type_icon circle"></i>'),F='<i class="refresh loading icon sync_state_icon"></i>',C='<i class="cloud icon sync_state_icon"></i>',D='<i class="soundcloud icon sync_state_icon"></i>',f='<i class="sign red warning icon sync_state_icon"></i>',k='<i class="unlinkify red icon sync_state_icon"></i>',m=function(){var e,t;return T?("xsj"===(e=T.apm.get("databaseSyncType")||"local")&&(t=".xsj_cloud_icons"),"custom"===e&&(t=".custom_cloud_icons"),t||""):""},h=function(){var e,t;return T?("xsj"===(e=T.apm.get("databaseSyncType")||"local")&&(t='<i class="bottom right corner xiaoshujiang icon sync_type_icon"></i>'),"custom"===e&&(t=d),t||""):""},w=!1,g="",v=function(e,t){var n,i;if(!w&&T)switch(i=h(),n=m(),e){case"syncing":return T.$el.find(n).html(F+i);case"synced":return T.apm.get("databaseCustomSyncLive")?T.$el.find(n).html(C+i):T.$el.find(n).html(D+i);case"offline":return T.$el.find(n).html(k+i);case"error":return navigator.onLine?(T.$el.find(n).html(f+i),T.$el.find(n+">.warning.icon").attr("title","\u51fa\u9519\uff1a"+t)):T.$el.find(n).html(k+i)}},p=_.debounce(v,2e3),x=function(){var e,t,n;return w=!0,n=h(),t=m(),e=T.$el.find(t),g=e.html(),e.html(F+n)},y=function(){var e,t;if(w=!1,t=m(),e=T.$el.find(t),g)return e.html(g),g=""},b=function(e){var t,n;return n=h(),t=m(),navigator.onLine?(T.$el.find(t).html(f+n),T.$el.find(t+">.warning.icon").attr("title","\u51fa\u9519\uff1a"+e)):T.$el.find(t).html(k+n)},a=function(e){var t,n;function a(){return this._databaseSyncTypeChangeFn=S(this._databaseSyncTypeChangeFn,this),a.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)P.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(a,e),a.prototype.template=M,a.prototype.className="sync_buttons",t=null,n=null,a.prototype.showSearchViewFn=function(e){return e.preventDefault(),e.stopPropagation(),n?n.getManagerWindow().$el.transition("jiggle"):((n=new r).show(),n.on("close",(function(){return n=null})))},a.prototype.showProgressView=function(){return t?t.getManagerWindow().$el.transition("jiggle"):((t=new o).show(),t.on("close",(function(){return t=null})))},a.prototype.hideProgressView=function(){if(t)return t.close(),t=null},a.prototype.initListenerChanges=function(){var e,t,n;return e=s.pouchDB,n=i.homeView,t=i.getFileCollection(),e.info((function(r,o){return e.changes({live:!0,include_docs:!0,return_docs:!1,conflicts:!0,attachments:!0,binary:!0,since:"now",filter:function(e){return!e._id.startsWith("_design/")}}).on("change",(function(e){var r,o,a,s,l,c,u,d,p,f,h,m,v,g,_;if(u=n.fileModel,null,f=function(e){return"string"!=typeof e&&(e=0),e?(e=e.split("-")[0],parseInt(e,10)||0):0},_=function(e,t){if(f(e.get("_rev"))<f(t._rev))return e.set(t)},u&&u.id,h=i.getAllInstanceFileModels(),"attachment"!==e.doc.type){if(s=t.changedFileModels,m=h.find((function(t){return t.get("_id")===e.id})),e.deleted){if(m)return u===m?m.set({_rev:e.doc._rev}):_(m,e.doc),m.trigger("syncDelayRemove",e.doc)}else if(m){if(e.doc.isDeleted||e.doc.isArchived)return _(m,e.doc),m.trigger("syncDelayRemove",e.doc);if(r=e.doc._rev,c=e.doc.content,g=m.get("_rev"),v=m.get("content"),(l=e.doc._conflicts)&&l.length>0?m.set("_conflicts",l):m.unset("_conflicts"),r!==g)return u===m&&m.reInitAttachments(e.doc._attachments),c!==v&&u!==m&&s.push(e.doc._id),u===m?(d=i.getFileLocalCollection().getFileLocalModelByFileId(m.id))&&!d.get("isLocked")&&_(m,e.doc):_(m,e.doc),m.set({_attachments:e.doc._attachments||{}},{silent:!0})}else if(!e.doc.isDeleted&&!e.doc.isArchived&&(s.push(e.doc._id),t.length<80&&t.allFileIds.indexOf(e.doc._id)<0))return t.add(e.doc)}else if(!e.deleted&&(a=h.find((function(t){return t.get("_id")===e.doc.docId})))){if(p=e.doc.filename,e.doc.highlights)return;e.doc._attachments.attachment&&(o=e.doc._attachments.attachment.data)&&o instanceof Blob&&(a.addAttachmentMetaCache(p,o,e.doc._attachments.attachment.digest),a.trigger("attachmentChange",a,p,"url_image_./"+p))}}))}))},a.prototype.initialize=function(e){var t,n;return T=this,(t=i.getApplicationProfileModel()).bind("change",this._databaseSyncTypeChangeFn,this),t.bind("databaseSyncTypeChanged",this.databaseSyncTypeChangedFn,this),this.apm=t,this.initListenerChanges(),(n=i.getUserModel()).on("change",(function(e,n){if(n=e.changed){if(""===n.token)return;if(n.hasOwnProperty("vip")&&!n.hasOwnProperty("token"))return T.databaseSyncTypeChangeFn(t,!0)}})),l.init(n,t)},a.prototype.events={"click .full_sync_button":"fullSyncFn","click .full_pull_button":"fullPullFn","click .ten_pull_button":"tenPullFn","click .fifty_pull_button":"fiftyPullFn","click .full_push_button":"fullPushFn","click .ten_push_button":"tenPushFn","click .fifty_push_button":"fiftyPushFn","click .tabs_sync_button":"syncAllTabFilesFn","click .xsj_sync_button":"syncAllActiveTabFileFn","click .custom_sync_button":"syncCurrentFileFn","click .cloud_search_button":"showSearchViewFn"},a.prototype.syncAllTabFilesFn=function(e){var t,n,r;if(e.preventDefault(),e.stopPropagation(),!w)return e.ctrlKey&&this.showProgressView(),r=i.getFileGroupTabCollection().getAllFileIds(),n=[],t=s.pouchDB,x(),t.allDocs({include_docs:!0,keys:r}).then((function(e){return e.rows.forEach((function(e){var t,i,r,o;if(e.doc){for(r in i=e.id,n.push(e.id),o=[],t=e.doc._attachments||{})t[r].content_type===s.fileContentType.attachment?o.push(n.push(i+"__"+r)):o.push(void 0);return o}}))})).then((function(){return l.syncSpecDocIds(n,(function(e){return y(),e?(b(e),c.showMessage("\u540c\u6b65\u51fa\u9519:"+e,6e3,"error")):c.showMessage("\u540c\u6b65\u5b8c\u6210")}))})).catch((function(e){return y(),b(e),c.showMessage("\u540c\u6b65\u51fa\u9519:"+e,6e3,"error")}));this.showProgressView()},a.prototype.syncAllActiveTabFileFn=function(e){var t,n;if(e.preventDefault(),e.stopPropagation(),w)this.showProgressView();else if(e.ctrlKey&&this.showProgressView(),i.getUnlimitedLifeMode())this.fullPullFn();else{if(0!==(n=i.homeView.editorView.getAllFileModels(!0)).length)return t=[],n.forEach((function(e){var n,i,r,o;for(r in i=e.get("_id"),t.push(i),o=[],n=e.get("_attachments")||{})n[r].content_type===s.fileContentType.attachment?o.push(t.push(i+"__"+r)):o.push(void 0);return o})),x(),l.syncSpecDocIds(t,(function(e){return y(),e?(b(e),c.showMessage("\u540c\u6b65\u51fa\u9519:"+e,6e3,"error")):(n.map((function(e){return e.trigger("attachmentChange",e)})),c.showMessage("\u540c\u6b65\u5b8c\u6210"))}));c.showMessage("\u6ca1\u6709\u53ef\u540c\u6b65\u7684\u6587\u7ae0",6e3,"error")}},a.prototype.syncCurrentFileFn=function(e){var t,n,r,o,a,u;if(e.preventDefault(),e.stopPropagation(),w)this.showProgressView();else{if(e.ctrlKey&&this.showProgressView(),u=i.homeView,o=u.editorView.getActiveEditorProxy().fileModel){for(a in r=[n=o.get("_id")],t=o.get("_attachments")||{})t[a].content_type===s.fileContentType.attachment&&r.push(n+"__"+a);return x(),l.syncSpecDocIds(r,(function(e){return y(),e?(b(e),c.showMessage("\u540c\u6b65\u51fa\u9519:"+e,6e3,"error")):(o.trigger("attachmentChange",o),c.showMessage("\u540c\u6b65\u5b8c\u6210"))}))}c.showMessage("\u6ca1\u6709\u6b63\u5728\u7f16\u8f91\u7684\u6587\u7ae0",6e3,"error")}},a.prototype.xsjSyncFn=function(e){if($(e.currentTarget),!w)return e.ctrlKey&&this.showProgressView(),x(),l.startXSJSyncCouchdb((function(e){return y(),e?(b(e),c.showMessage("\u540c\u6b65\u51fa\u9519:"+e,6e3,"error")):c.showMessage("\u540c\u6b65\u5b8c\u6210")}));this.showProgressView()},a.prototype.customSyncFn=function(e){var t,n;if(e.preventDefault(),e.stopPropagation(),t=T.apm.get("databaseCustomSyncLive")||!1,n=T.apm.get("databaseCustomSyncLiveMax")||"10",!w)return e.ctrlKey&&this.showProgressView(),x(),t?l.startCustomSyncCouchdb((function(e){return y(),e?(b(e),c.showMessage("\u540c\u6b65\u51fa\u9519:"+e,6e3,"error")):c.showMessage("\u540c\u6b65\u5b8c\u6210")})):l.pullAndPushRecentCountDocs(n,(function(e){return y(),e?(b(e),c.showMessage("\u62c9\u53d6\u51fa\u9519\uff1a"+e,6e3,"error")):c.showMessage("\u62c9\u53d6\u5b8c\u6210")}));this.showProgressView()},a.prototype.fullSyncFn=function(e){if(e.preventDefault(),e.stopPropagation(),w)this.showProgressView();else if(e.ctrlKey&&this.showProgressView(),"client"===STORY_PLATFORM||confirm("\u7531\u4e8e\u6d4f\u89c8\u5668\u7a7a\u95f4\u5927\u5c0f\u9650\u5236\uff0c\u5168\u5e93\u540c\u6b65\u4e0d\u5efa\u8bae\u5728\u6d4f\u89c8\u5668\u4e0b\u6267\u884c\uff0c\u662f\u5426\u7ee7\u7eed\u5168\u5e93\u540c\u6b65"))return x(),l.startFullSyncCouchdb(null,(function(e){return y(),e?c.showMessage("\u540c\u6b65\u51fa\u9519\uff1a"+e,6e3,"error"):c.showMessage("\u540c\u6b65\u5b8c\u6210")}))},a.prototype.fullPullFn=function(e){if(e&&(e.preventDefault(),e.stopPropagation()),w)this.showProgressView();else if(e&&e.ctrlKey&&this.showProgressView(),"client"===STORY_PLATFORM||confirm("\u7531\u4e8e\u6d4f\u89c8\u5668\u7a7a\u95f4\u5927\u5c0f\u9650\u5236\uff0c\u5168\u5e93\u62c9\u53d6\u4e0d\u5efa\u8bae\u5728\u6d4f\u89c8\u5668\u4e0b\u6267\u884c\uff0c\u662f\u5426\u7ee7\u7eed\u5168\u5e93\u62c9\u53d6"))return x(),l.startFullReplicateFromCouchdb((function(e){return y(),e?c.showMessage("\u62c9\u53d6\u51fa\u9519\uff1a"+e,6e3,"error"):c.showMessage("\u62c9\u53d6\u5b8c\u6210")}))},a.prototype.tenPullFn=function(e){if(e.preventDefault(),e.stopPropagation(),!w)return e.ctrlKey&&this.showProgressView(),x(),l.replicateFromCountDocs(10,(function(e){return y(),e?c.showMessage("\u62c9\u53d6\u51fa\u9519\uff1a"+e,6e3,"error"):c.showMessage("\u62c9\u53d6\u5b8c\u6210")}));this.showProgressView()},a.prototype.fiftyPullFn=function(e){if(e.preventDefault(),e.stopPropagation(),!w)return e.ctrlKey&&this.showProgressView(),x(),l.replicateFromCountDocs(50,(function(e){return y(),e?c.showMessage("\u62c9\u53d6\u51fa\u9519\uff1a"+e,6e3,"error"):c.showMessage("\u62c9\u53d6\u5b8c\u6210")}));this.showProgressView()},a.prototype.tenPushFn=function(e){if(e.preventDefault(),e.stopPropagation(),!w)return e.ctrlKey&&this.showProgressView(),x(),l.replicateToCountDocs(10,(function(e){return y(),e?c.showMessage("\u63a8\u9001\u51fa\u9519\uff1a"+e,6e3,"error"):c.showMessage("\u63a8\u9001\u5b8c\u6210")}));this.showProgressView()},a.prototype.fiftyPushFn=function(e){if(e.preventDefault(),e.stopPropagation(),!w)return e.ctrlKey&&this.showProgressView(),x(),l.replicateToCountDocs(50,(function(e){return y(),e?c.showMessage("\u63a8\u9001\u51fa\u9519\uff1a"+e,6e3,"error"):c.showMessage("\u63a8\u9001\u5b8c\u6210")}));this.showProgressView()},a.prototype.fullPushFn=function(e){if(e.preventDefault(),e.stopPropagation(),!w)return e.ctrlKey&&this.showProgressView(),x(),l.startFullReplicateToCouchdb((function(e){return y(),e?c.showMessage("\u63a8\u9001\u51fa\u9519\uff1a"+e,6e3,"error"):c.showMessage("\u63a8\u9001\u5b8c\u6210")}));this.showProgressView()},a.prototype._databaseSyncTypeChangeFn=function(e){return this.databaseSyncTypeChangeFn(e)},a.prototype.databaseSyncTypeChangeFn=function(e,t){var n,r,o,a,s,u,d;if(t||(o=["databaseSyncType","databaseCustomSyncUrl","databaseCustomSyncUsername","databaseCustomSyncPassword","databaseCustomSyncLive","databaseCustomSyncLiveMax"],r=e.changed,function(){var e,t,n;for(t=0,n=o.length;t<n;t++)if(e=o[t],r.hasOwnProperty(e))return!0;return!1}()))switch(s=T.apm.get("databaseSyncType"),(d=i.getUserModel())&&((u=d.get("user"))&&u.vip||(s="local")),T.apm.trigger("databaseSyncTypeChanged",s),a=T.apm.get("databaseCustomSyncLive"),n=function(e){var t;if(e){try{e=JSON.stringify(e)}catch(e){t=e,console.log(t)}return c.showMessage("\u540c\u6b65\u670d\u52a1\u542f\u52a8\u5931\u8d25\uff1a"+e,6e3,"error")}return T.syncType=s,c.showMessage("\u540c\u6b65\u6570\u636e\u529f\u80fd\u5f00\u542f",6e3,"info")},s){case"xsj":return l.startXSJSyncCouchdb(n);case"custom":return a?l.startCustomSyncCouchdb(n):l.stopSyncCouchdb((function(){}));default:return l.stopSyncCouchdb((function(){if(!t)return c.showMessage("\u53d6\u6d88\u540c\u6b65\u6210\u529f",6e3,"info")}))}},a.prototype.databaseSyncTypeChangedFn=function(e){var t,n,r,o;if((n=this.$el.find(".xsj_sync_button")).hide(),(t=this.$el.find(".custom_sync_button")).hide(),(o=i.getUserModel())&&((r=o.get("user"))&&r.vip||(e="local")),"xsj"===e&&n.show(),"custom"===e)return t.show(),".custom_cloud_icons",this.apm.get("databaseCustomSyncLive")?this.$el.find(".custom_cloud_icons").html(C+d):this.$el.find(".custom_cloud_icons").html(D+d)},a.prototype.afterRender=function(){var e,t,n,r,o,a;return n=this.apm.get("databaseSyncType")||"local",r=this.apm.get("databaseCustomSyncLive"),(a=i.getUserModel())&&(o=a.get("user"))&&(o.vip||(n="local")),(t=this.$el.find(".xsj_sync_button")).hide(),(e=this.$el.find(".custom_sync_button")).hide(),"xsj"===n&&t.show(),"custom"===n&&(e.show(),".custom_cloud_icons",r?this.$el.find(".custom_cloud_icons").html(C+d):this.$el.find(".custom_cloud_icons").html(D+d)),this.$el.find(".custom_sync_button").dropdown({on:"hover",delay:{hide:400},action:"select"}),l.on("syncing",(function(){return p.cancel(),v("syncing")})),l.on("synced online",(function(){return p("synced")})),l.on("offline",(function(){return p("offline")})),l.on("fault error",(function(e){return p("error",e)}))},a}(u),n.exports=a}}),window.requirejs.define({"views/codemirror/auto_suggest_copilot_event":function(e,t,n){var i,r;r=function(e,t){var n;return n=function(){},function(){var i;return i=arguments,n(),new Promise((function(r,o){var a;return a=setTimeout((function(){return r(e.apply(null,i))}),t),n=function(){return clearTimeout(a)}}))}}((function(){return"hello world"}),600),i=function(e){var t,n,i,o,a,s,l,c,u;if(!e.getSelection())return t=e.getCursor(),n=e.getDoc(),o=(i=e.indexFromPos(t))-50,l=i+50,a=e.posFromIndex(o),c=e.posFromIndex(l),s=e.getRange(a,t),u=e.getRange(t,c),n.getLine(t.line),n.getLine(t.line-1)||"",n.getLine(t.line+1)||"",e.getModeAt(e.getCursor()),console.log("zzzz",s,u),r(t).then((function(e){return console.log("jprediction result::: ",e)}))},n.exports=i}}),window.requirejs.define({"views/codemirror/auto_suggest_event":function(e,t,n){var i,r,o,a,s,l;t("../../application"),s=t("./auto_suggest_tags_event"),i=t("./auto_suggest_fence_event"),r=t("./auto_suggest_file_event"),a=t("./auto_suggest_mathjax_event"),t("./auto_suggest_copilot_event"),o=function(e){a(e)||s(e)||i(e)||r(e)},l=function(e){return e.on("inputRead",o)},n.exports=l}}),window.requirejs.define({"views/codemirror/auto_suggest_fence_event":function(e,t,n){var i;i=function(e){var t,n,i,r,o,a,s,l;return n=e.getCursor(),a=(i=e.getDoc()).getLine(n.line),e.getModeAt(e.getCursor()),o=/^````*\s?([\w\!\?]+)$|^~~~~*\s?([\w\!\?]+)$/,l=!1,(t=a.match(o))&&(l=!0,r=t[0].indexOf(t[1]),s=t[1],e.showHint({completeSingle:!1,hint:function(e,t){var n,o,a,l,c,u,d,p,f,h,m,v,g,_;for(n=e.getCursor(),c=e.getTokenAt(n),h=i.getLine(n.line),s=h.substring(r),d=h.substring(0,r),l=r,o=c.end,m=function(){var e,t,n,i;for(n=hljs.listLanguages(!0),i=[],a=e=0,t=n.length;e<t;a=++e)_=n[a],i.push({name:_,value:_});return i}(),v=hljs.listLanguages(!0),a=p=0,f=v.length;p<f;a=++p)_=v[a],m.push({name:_+"?linenums",value:_+"?linenums"});return m.push({name:"mathjax!",value:"mathjax!"}),m.push({name:"wavedrom!",value:"wavedrom!"}),m.push({name:"mermaid!",value:"mermaid!"}),m.push({name:"mermaid",value:"mermaid"}),m.push({name:"mindmap!",value:"mindmap!"}),m.push({name:"plot!",value:"plot!"}),m.push({name:"flow!",value:"flow!"}),m.push({name:"sequence!",value:"sequence!"}),(u=new FilteredList(m)).setFilter(s),g=[],u.filtered.forEach((function(e,t){return g.push({text:e.value,xxhintxx:function(e,t,i){return new CodeMirror.templatesHint.Template({template:i.text+"\n${cursor}\n"+d+"\n"}).insert(e,{from:CodeMirror.Pos(n.line,l),to:CodeMirror.Pos(n.line,o)})},render:function(e,t,n){return e.appendChild(document.createTextNode(n.text))}})})),{list:g,from:CodeMirror.Pos(n.line,l),to:CodeMirror.Pos(n.line,o)}}})),l},n.exports=i}}),window.requirejs.define({"views/codemirror/auto_suggest_file_event":function(e,t,n){var i,r,o,a,s;t("../../application"),o=t("../../lib/pouchdb_index_view_manager"),i=t("../../constant"),r=t("../../models/file_model"),s=function(e,t){var n;return(n=function(n,a,s){var l,c,u,d,p;return u=e.linkUrl,p=e.start,c=e.end,l=i.pouchDB,d={list:[],from:t,to:t},o.getTitleView(l,(function(i,o){var s,f;return i?a(d):(f=o.viewName,s={reduce:!1,group:!1,stale:"update_after"},l.query(f+"/by_title",s).then((function(i){var o,s,l,f,h;return l=i.rows.map((function(e){return{docId:e.id,name:e.key,value:e.key}})),(o=new FilteredList(l)).setFilter(u),h=d.list,s=o.filtered.slice(0,20),f=function(e){return n.replaceRange(e,d.from,d.to,"complete")},s.forEach((function(t,n){return h.push({displayText:t.value,text:t.value,hint:function(n,i,o){var a,s;return a=t.docId,(s=new r).id=a,s.fetch({silent:!0,error:function(e){return console.error(e),f(o.text)},success:function(t,n){var i,r,o,a;return o=t.get("slug"),a=(a=t.get("title")||"").replace(/['"\s]*/,"").trim(),i=t.id,r=o||i,a&&(r="wiki"===e.type?r+"|"+a:r+' "'+a+'"'),f(r)}})},render:function(e,t,n){return e.appendChild(document.createTextNode(n.displayText))}})})),d.from={line:t.line,ch:p},d.to={line:t.line,ch:c},a(d)})))}))}).async=!0,n},a=function(e){var t,n,i,r,o,a,l,c;return c=!1,o=e.getCursor(),l=(a=e.getDoc()).getLine(o.line),t=a.getRange({line:o.line,ch:0},o),n=l.substring(o.ch),r=function(){var e,i,r,s,l,c,u,d;return u=t.lastIndexOf("[["),r=t.lastIndexOf("]"),s=t.lastIndexOf("|"),l=null,u>=0&&r<u&&s<u&&(d=u+2,r=o.ch,c=a.getRange({line:o.line,ch:d},o)||"",e=n.indexOf("]]"),i=n.indexOf("["),n.indexOf("|"),e>0&&(i<0||i>=0&&e<i?r+=e:r=o.ch),c.trim()&&(l={start:d,end:r,linkUrl:c,type:"wiki"})),l},(i=function(){var e,i,r,s,l,c,u;return c=t.lastIndexOf("]("),r=t.lastIndexOf(")"),s=null,c>=0&&r<c&&(u=c+2,r=o.ch,l=a.getRange({line:o.line,ch:u},o)||"",e=n.indexOf(")"),i=n.indexOf("["),e>0&&(i<0||i>=0&&e<i?r+=e:r=o.ch),l.trim()&&(s={start:u,end:r,linkUrl:l,type:"markdown"})),s}())||(i=r()),i&&(c=!0,e.showHint({completeSingle:!1,hint:s(i,o)})),c},n.exports=a}}),window.requirejs.define({"views/codemirror/auto_suggest_mathjax_event":function(e,t,n){var i,r,o,a,s;t("../../application"),t("../../lib/pouchdb_index_view_manager"),t("../../constant"),t("../../models/file_model"),i=null,a=null,r=function(e){var t,n;return n=function(e,t){var n,i,r,o,s;return t=t.parentNode,s=null,e.info&&(s=e.info(e)),s?(n=t.getBoundingClientRect(),i=null,null===a?(i=document.createElement("div"),a={el:i,base:s},i.className="CodeMirror-hints-contextInfo",i.innerHTML='<iframe src="mathjaxinfo.html" class="preview_iframe" frameborder="0" style="width: 100%;height:100%;"></iframe>',document.body.appendChild(i),(r=i.querySelector("iframe")).onload=function(){var e,t;if(a)return e=(t=r.contentWindow).document,a.iframeWindow=t,a.iframeDocument=e,e.querySelector("body>.mathjax").innerHTML=a.base,t.init(),t.beforeRenderPreview((function(){return t.renderPreview()}))}):(a.timeout&&(clearTimeout(a.timeout),a.timeout=null),i=a.el,a.base!==s&&(a.base=s,a.iframeWindow&&(o=a.iframeWindow,a.iframeDocument.querySelector("body>.mathjax").innerHTML=a.base,o.beforeRenderPreview((function(){return o.renderPreview()}))))),i.style.top=t.style.top,i.style.left=n.right+"px",i.style.height=n.height+"px",i.style.display="block"):null!==a?(i=a.el).style.display="none":void 0},t=function(){var e;if(null!==a)return a.timeout&&clearTimeout(a.timeout),(e=a.el).style.display="none",a.timeout=setTimeout((function(){return e.parentNode.removeChild(e),a=null}),6e4)},CodeMirror.on(e,"select",(function(e,t){return n(e,t)})),CodeMirror.on(e,"close",(function(){return t()}))},s=function(e,t){var n;return(n=function(n,o,a){var s,l,c,u;return u=e.word,c=e.token,l={list:[],from:{line:t.line,ch:c.start},to:{line:t.line,ch:c.end}},s=function(e){var t,n,i;return n=e.macros.map((function(e){return{name:e.text,value:e.text,snippet:e.snippet,base:e.base,score:e.score||0,thumbnail:e.thumbnail}})),(t=new FilteredList(n)).setFilter(u),i=l.list,t.filtered.slice(0,20).forEach((function(t,n){return i.push({displayText:t.value,text:t.value,base:t.base,thumbnail:t.thumbnail,info:function(t){return e.descriptionObj[t.base]||""},hint:function(e,n,i){var r;return r=t.snippet,new CodeMirror.templatesHint.Template({template:r}).insert(e,{from:l.from,to:l.to})},render:function(e,t,n){var i;if(e.appendChild(document.createTextNode(n.displayText)),n.thumbnail)return(i=new Image).src=n.thumbnail,e.appendChild(i)}})})),r(l),o(l)},i?setTimeout((function(){return s(i)}),1):$.getJSON("js/MathJax/macros.json").then((function(e){return i=e,s(e)})).fail((function(){return o(l)}))}).async=!0,n},o=function(e){var t,n,i,r,o,a,l;if(i=!1,t=e.getCursor(),e.getDoc(),a=e.getTokenTypeAt(t)||"",/tag/i.test(a)&&/xsj-math/i.test(a)){if(r=(o=e.getTokenAt(t)).start,n=t.ch,"\\\\"===(l=o.string.slice(0,n-r)))return e.state.completionActive&&e.state.completionActive.close(),!0;/[^\w\\]/.test(l)&&(l="",r=n=t.ch),e.showHint({completeSingle:!1,hint:s({word:l,token:o},t)}),i=!0}return i},n.exports=o}}),window.requirejs.define({"views/codemirror/auto_suggest_tags_event":function(e,t,n){var i,r;i=t("../../application"),r=function(e){var t,n,r,o,a,s,l,c;return n=e.getCursor(),o=(r=e.getDoc()).getLine(n.line),e.getModeAt(e.getCursor()),c=/^tags: /g,l=!1,o.match(c)&&(l=!0,t=(t=o.replace(/[ ,.]/g,",")).substring(0,n.ch),(a=t.lastIndexOf(","))>=0&&(a+=1,(s=t.substring(a,n.ch))&&e.showHint({completeSingle:!1,hint:function(e,t){var n,o,l,c,u,d,p,f,h,m;return n=e.getCursor(),c=e.getTokenAt(n),d=r.getLine(n.line),a,o=c.end,s=d.substring(a,o),h=i.getTagModel().getTags(),p=function(){var e,t,n;for(n=[],l=e=0,t=h.length;e<t;l=++e)m=h[l],n.push({name:m,value:m});return n}(),(u=new FilteredList(p)).setFilter(s),f=[],u.filtered.forEach((function(e,t){return f.push({text:e.value,render:function(e,t,n){return e.appendChild(document.createTextNode(n.text))}})})),{list:f,from:CodeMirror.Pos(n.line,a),to:CodeMirror.Pos(n.line,o)}}}))),l},n.exports=r}}),window.requirejs.define({"views/codemirror/common_codemirror_editor":function(e,t,n){var i,r,o,a,s,l,c,u,d,p;s=t("../../lib/utils"),o=t("../../lib/notifier"),i=t("../../application"),a=t("../../lib/user_dict_manager"),r=t("../editor_tool_insert_magnet_dialog_view"),u=t("./default_shortcut"),d=u,p=function(e){var t,n,r,o,a,s,l;if(a=!1,(l=i.getTourModel()).canPrompt("auto_convert_html_to_markdown_learned")&&(a=!0),a)return o=(r=e.cursorCoords()).left,s=r.top,n=$('<div class="spotlight_container" style="\nbackground: radial-gradient(circle at '+o+"px "+s+'px, transparent 180px, rgba(0, 0, 0, 0.4) 182px, rgba(0, 0, 0, 0.9) 900px);\n"></div>'),t=$('<div style="position:absolute;left:'+o+"px;top: "+s+'px;z-index:100;">\n  <kbd>\u5c0f\u4e66\u5320\u4e3b\u6309\u94ae \u300b\u8bbe\u7f6e<br/> \u300b\u7f16\u8f91\u5668 \u300bCodemirror <br/>\u300b\u7c98\u8d34\u65f6\uff0c\u81ea\u52a8\u8f6c\u6362\u5bcc\u6587\u672c\u4e3a markdown \u683c\u5f0f </kbd>\n</div>'),$("body").append(t),t.popup({on:"manual",closable:!1,onVisible:function(){var e;return t.css({outline:"3px solid var(--negativeColor)",outlineOffset:"2px",background:"var(--defaultBackground)",transform:"scale(2.5)",transition:"transform 1s, outline 1s"}),$("body").append(n),(e=this).width(400),e.find(".ok").click((function(){return n.remove(),t.popup("destroy"),l.dontPrompt("auto_convert_html_to_markdown_learned"),e.remove(),t.remove()}))},html:'<div class="header">\u63d0\u793a</div><div class="content">\u53d1\u73b0\u526a\u5207\u677f\u5185\u6709<strong>\u7eaf\u6587\u672c</strong>\u548c<strong>\u5bcc\u6587\u672c</strong>\u4e24\u79cd\u683c\u5f0f\uff0c<br/>\u7cfb\u7edf\u9ed8\u8ba4\u4f7f\u7528<strong>\u5bcc\u6587\u672c\u683c\u5f0f</strong>\uff0c\u5e76\u81ea\u52a8\u8f6c\u6362\u6210 markdown \u540e\u8fdb\u884c\u7c98\u8d34\uff0e<br/><br/>\u60a8\u53ef\u4ee5\u5728<strong>\u8bbe\u7f6e</strong>\u91cc\u4fee\u6539\u8be5\u89c4\u5219\uff0c\u4e5f\u53ef\u4ee5\u7528\u5feb\u6377\u952e(<kbd>Ctrl+shift+v</kbd>)\u76f4\u63a5\u7c98\u8d34\u7eaf\u6587\u672c\u7247\u6bb5\uff0e<div><a href="javascript:void(0);" class="ok pull-right">\u77e5\u9053\u4e86</a></div></div>'}).popup("show")},c=function(){return function(){var e,t,n,l,c;function u(e,o){var a;this.editor=e,this.editorView=o,a=this,this.id=uniqueNumber(),this.editor.getWrapperElement().classList.add("xsj_normal_mode"),this.editor.getWrapperElement().classList.add("xsj-codemirror-"+this.id),this.editor.getWrapperElement().classList.add("xsj-codemirror-no-selection-text"),this.editor.getTextArea().classList.add("xsj-codemirror-textarea-"+this.id),this.childrenEditors=[],this.parentEditor=[],this.connectedView=null,n(this.editor),l={canUndo:function(){return a.editor.getDoc().historySize().undo>0},canRedo:function(){return a.editor.getDoc().historySize().redo>0},undo:function(){return a.editor.getDoc().undo()},redo:function(){return a.editor.getDoc().redo()},init:function(){return a.editor.getDoc().clearHistory()},setCommandMode:function(){},onButtonStateChange:function(){}},this.editor.on("change",(function(){if(a.editorView.getActiveEditorProxy()===a.editorProxy)return l.onButtonStateChange()})),this.editor.on("renderLine",(function(e,t,n){})),this.editor.on("paste",(function(e,t){var n,o,l,c,u,d,f;return 2===t.clipboardData.types.length&&(d=t.clipboardData.types,i.getEditorProfileModel().get("cm_autoCovertHtmlToMarkdown")&&d.indexOf("text/html")>=0&&d.indexOf("text/plain")>=0&&(o=t.clipboardData.getData("text/html"))&&(n=s.html2markdown(o)))?(n.indexOf("\n")>0&&(n="\n"+n+"\n"),e.replaceSelection(n),f=[],o.replace(/(<img [^>]*src=['"])([^'"]+)([^>]*>)/gi,(function(e,t,n,i){if(f.indexOf(n)<0)return f.push(n)})),f.length>0?new r({editorView:a.editorView.getActiveEditorView(!0)}).show(n):p(e),t.preventDefault(),void(t.codemirrorIgnore=!0)):(u=e.getSelection())&&u.indexOf("\n")<0&&!/^http[s]?:\/\/|^\.|^\//i.test(u.trim())&&(l=t.clipboardData&&t.clipboardData.getData("Text")||"",(l=$.trim(l)).indexOf("\n")<0&&/^http[s]?:\/\//i.test(l))?(c="["+u+"]("+l+")",e.replaceSelection(c),t.preventDefault(),t.codemirrorIgnore=!0):void 0})),this.editor.on("focus",(function(e,t){return a.editorView.setActiveEditorProxy(a.editorProxy)})),this.editor.on("beforeSelectionChange",(function(e,t){var n,i,r,o,a;for(!1,e.state.cursorMark,n=!1,i=0,r=(a=t.ranges||[]).length;i<r;i++)if((o=a[i]).anchor.line!==o.head.line||o.anchor.ch!==o.head.ch){n=!0;break}return e.getWrapperElement().classList.toggle("xsj-codemirror-no-selection-text",!n)})),this.initContextMenu(),t(this.editor)}return u.prototype.id=null,u.prototype.editor=null,u.prototype.childrenEditors=[],u.prototype.parentEditor=null,u.prototype.editorView=null,u.prototype.connectedView=null,u.prototype.editorProxy=null,l=null,e={},c={},n=function(e){var t,n;if(t="default",(n=e.editorModel)&&(t=n.get("cm_keyBinding")||"default"),"default"!==t)return e.removeKeyMap(CodeMirror.keyMap[t]||t),e.addKeyMap(t)},t=function(e){var t,n;return t=function(t){var i;return e.state.childInFullScreenTimeout&&(clearTimeout(e.state.childInFullScreenTimeout),e.state.childInFullScreenTimeout=null),(i=document.fullscreenElement)&&n.contains(i)?e.state.childInFullScreen=!0:e.state.childInFullScreenTimeout=setTimeout((function(){return e.state.childInFullScreenTimeout=null,e.state.childInFullScreen=!1}),1e3)},(n=e.getWrapperElement()).addEventListener("webkitfullscreenchange",t),n.addEventListener("fullscreenchange",t)},u.prototype.destroyChildren=function(){var e,t;for(t=[];e=this.childrenEditors.shift();)t.push(e.destroy());return t},u.prototype.destroy=function(){var e,t,n;return this.connectedView?this.connectedView.destroy():(this.destroyContextMenu(),e=this.editorView.getActiveEditorProxy(),this.editorProxy===e&&(this.parentEditor?this.editorView.setActiveEditorProxy(this.parentEditor.editorProxy):this.editorView.setActiveEditorProxy(null)),this.parentEditor&&(n=(t=this.parentEditor.childrenEditors||[]).indexOf(this))>-1&&t.splice(n),this.destroyChildren())},u.prototype.resize=function(){var e,t,n,i,r;if(!this.editor.state.childInFullScreen){for(this.editor.refresh(),r=[],t=0,n=(i=this.childrenEditors).length;t<n;t++)e=i[t],r.push(e.resize());return r}},u.prototype.getUndoManager=function(){return l},u.prototype.initContextMenu=function(){var e,t,n,r;if(n=this,r="none",t=".xsj-codemirror-textarea-"+this.id,"client"===STORY_PLATFORM&&(r="right",t=".xsj-codemirror-"+this.id),e=function(e,t){return t.codemirrorIgnore=!0},$.contextMenu({selector:t,trigger:r,events:{preShow:function(e,t){var n;if("true"===(null!=(n=t.xsjTarget||t.target||t.toElement)?n.contentEditable:void 0))return!1},hide:function(){return n.editor.off("keydown",e)},show:function(t){return n.editor.on("keydown",e)}},build:function(e,t){var i,r,c,u,d,p,f,h,m,v,g,_,w,y;return y=t.xsjTarget||t.target||t.toElement,"client"===STORY_PLATFORM&&(i=window.nw.Clipboard.get(),c=i.get("text")||"",r=i.get("html")||""),g=n.editor.getDoc().getSelection(),h={pasteAsText:{name:"\u7eaf\u6587\u672c\u7c98\u8d34",callback:function(){var e,t;return t=i.readAvailableTypes().map((function(e){return{type:e}})),e=i.get(t),i.set(c,"text"),n.editor.focus(),document.execCommand("paste"),i.set(e)}},pasteAsTextToMarkdown:{name:"\u5c06\u6587\u672c\u8f6c\u6362\u6210 markdown \u8fdb\u884c\u7c98\u8d34",callback:function(){var e,t,r;return e=s.html2markdown(c),r=i.readAvailableTypes().map((function(e){return{type:e}})),t=i.get(r),i.set(e,"text"),n.editor.focus(),document.execCommand("paste"),i.set(t)}},pasteAsHtmlToMarkdown:{name:"\u5c06\u5bcc\u6587\u672c\u8f6c\u6362\u6210 markdown \u8fdb\u884c\u7c98\u8d34",disabled:!r,callback:function(){var e,t,o;return e=s.html2markdown(r),o=i.readAvailableTypes().map((function(e){return{type:e}})),t=i.get(o),i.set(e,"text"),n.editor.focus(),document.execCommand("paste"),i.set(t)}},pasteAsHtml:{name:"\u76f4\u63a5\u7c98\u8d34html\u7247\u6bb5",disabled:!r,callback:function(){var e,t,o;return e=s.tidyHtml(r),o=i.readAvailableTypes().map((function(e){return{type:e}})),t=i.get(o),i.set(e,"text"),n.editor.focus(),document.execCommand("paste"),i.set(t)}},subsep1:"---------",pasteAsModal:{name:"\u66f4\u591a\u7c98\u8d34 ...",callback:function(){return $("#wmd-html-button").trigger("click")}}},v="\u7c98\u8d34","client"!==STORY_PLATFORM&&(v="\u7c98\u8d34\u4e3a ..."),m={icon:"fas fa-paste",name:v,callback:function(){return n.editor.focus(),"client"===STORY_PLATFORM?document.execCommand("paste"):$("#wmd-html-button").trigger("click")}},f={},(l.canUndo()||l.canRedo())&&Object.assign(f,{undo:{icon:"fas fa-undo-alt",name:"\u64a4\u6d88",disabled:!l.canUndo(),callback:function(){return l.undo()}},redo:{icon:"fas fa-redo-alt",name:"\u91cd\u505a",disabled:!l.canRedo(),callback:function(){return l.redo()}},sep1:"---------"}),g&&Object.assign(f,{cut:{icon:"fas fa-cut",name:"\u526a\u5207",disabled:!g,callback:function(){return n.editor.focus(),document.execCommand("cut")}},copy:{icon:"fas fa-copy",name:"\u590d\u5236",disabled:!g,callback:function(){return n.editor.focus(),document.execCommand("copy")}}}),y&&"IMG"===y.tagName&&y.src&&(p=y.src,Object.assign(f,{copyImg:{name:"\u590d\u5236\u56fe\u7247",callback:function(){var e,t;return e=function(e){return new Promise((function(t,n){var i;return(i=document.createElement("canvas")).width=e.naturalWidth,i.height=e.naturalHeight,i.getContext("2d").drawImage(e,0,0,i.width,i.height),i.toBlob((function(e){return t(e)}),"image/png")}))},t=function(e){return new Promise((function(t,n){var i;return(i=document.createElement("canvas")).width=e.naturalWidth,i.height=e.naturalHeight,i.getContext("2d").drawImage(e,0,0,i.width,i.height),t(i.toDataURL())}))},CopyImageClipboard.copyImageToClipboard(p).catch((function(){return e(y).then((function(e){return CopyImageClipboard.copyBlobToClipboard(e)}))})).then((function(){return o.showMessage("\u590d\u5236\u56fe\u7247\u6210\u529f")})).catch((function(){return t(y).then((function(e){var t;return t=s.parseBase64Data(e).type,t=/^image\//i.test(t)?t.substring(6):"png",(i=window.nw.Clipboard.get()).set([{type:t,data:e}])})).catch((function(e){return o.showMessage("\u590d\u5236\u56fe\u7247\u51fa\u9519:"+e,6e3,"error")}))}))}},saveImgAs:{name:"\u56fe\u7247\u53e6\u5b58\u4e3a...",callback:function(){saveAs(p,"")}}})),d=function(e){return function(){var t,i,r,o,a;for(o=n.editor.lastLine(),a=[];o>0;)t=CodeMirror.Pos(o--,0),(i=CodeMirror.helpers.fold.markdown(n.editor,t))?("fence"===e&&i.type===e&&n.editor.foldCode(t,null,"fold"),"header"===i.type?(r="h"+i.data.level,e===r?a.push(n.editor.foldCode(t,null,"fold")):a.push(void 0)):a.push(void 0)):a.push(void 0);return a}},Object.assign(f,{foldOrUnfold:{icon:"fas fa-arrows-alt-h",name:"\u6298\u53e0/\u5c55\u5f00...",items:{fold:{name:"\u6298\u53e0",callback:function(){var e,t,i;for(t=n.editor.getCursor().line,i=[];t>0;){if(e=CodeMirror.Pos(t,0),CodeMirror.helpers.fold.markdown(n.editor,e)){n.editor.foldCode(e,null,"fold");break}i.push(t--)}return i}},foldSelection:{name:"\u6298\u53e0\u9009\u4e2d\u533a\u57df",disabled:!g,callback:function(){return n.editor.state.isFoldSelection=!0,n.editor.execCommand("fold")}},foldAll:{name:"\u5168\u90e8\u6298\u53e0",callback:function(){return n.editor.execCommand("foldAll")}},unfoldAll:{name:"\u5168\u90e8\u5c55\u5f00",callback:function(){return n.editor.execCommand("unfoldAll")}},sep1:"---------",foldAllFence:{name:"\u6298\u53e0\u6240\u6709\u4ee3\u7801\u5757",callback:d("fence")},foldAllH1:{name:"\u6298\u53e0\u6240\u6709\u4e00\u7ea7\u6807\u9898",callback:d("h1")},foldAllH2:{name:"\u6298\u53e0\u6240\u6709\u4e8c\u7ea7\u6807\u9898",callback:d("h2")},foldAllH3:{name:"\u6298\u53e0\u6240\u6709\u4e09\u7ea7\u6807\u9898",callback:d("h3")}}},paste:m}),"client"===STORY_PLATFORM&&Object.assign(f,{pasteAs:{icon:"fas fa-paste",name:"\u7c98\u8d34\u4e3a ...",items:h}}),y&&y.classList.contains("cm-spell-error")&&(u=y.innerText)&&(w=(w=a.getSuggestWords(u)).slice(0,5),_={},w.forEach((function(e,i){return _["spellcheckerItem_"+i]={name:e,callback:function(){var i,r,o,a,s,l;for(s=n.editor.coordsChar({left:t.pageX,top:t.pageY}),i=(a=n.editor.doc.getLine(s.line)).indexOf(u),o=0;i>=0;){if(i+u.length>=s.ch){o+=i;break}o+=i+u.length,i=a.indexOf(u,o)}return r={ch:o,line:s.line},l={ch:o+u.length,line:s.line},n.editor.replaceRange(e,r,l)}}})),_.addToUserDict={name:"\u52a0\u5165\u8bcd\u5178",callback:function(){return a.addWords(u),n.editor.refresh()}},Object.assign(f,{spellChecker:{name:"\u62fc\u5199\u68c0\u67e5 ...",items:_}})),g||Object.assign(f,{insertAnchor:{icon:"fas fa-anchor",name:"\u63d2\u5165\u951a\u70b9\u5f15\u7528",callback:function(){return $("#wmd-anchor-button").trigger("click")}},insertMore:{icon:"fas fa-paperclip",name:"\u63d2\u5165 ...",items:{insertDrawIO:{icon:"far fa-object-group",name:"\u7ed8\u56fe\u7ec4\u4ef6",callback:function(){return $("#wmd-drawio-button").trigger("click")}},insertTable:{icon:"fas fa-table",name:"\u8868\u683c\u7ec4\u4ef6",callback:function(){return $("#wmd-ntable-button").trigger("click")}}}}}),Object.assign(f,{sep2:"---------",selectAll:{name:"\u9009\u62e9\u5168\u90e8",callback:function(){return n.editor.execCommand("selectAll")}}}),{items:f}}}),"client"!==STORY_PLATFORM)return $(document).on("contextmenu",".xsj-codemirror-"+this.id,(function(e){var n,r,o,a,s;return s=i.getTourModel(),e.ctrlKey?(e.preventDefault(),e.stopPropagation(),$(t).trigger($.Event("contextmenu",{xsjTarget:e.target||e.toElement,pageX:e.pageX,pageY:e.pageY,data:e.data}))):"web"===STORY_PLATFORM&&s.canPrompt("editor_context_menu_trigger_learned")?(e.preventDefault(),e.stopPropagation(),o=e.pageX,a=e.pageY,r=$('<div class="spotlight_container" style="\nbackground: radial-gradient(circle at '+o+"px "+a+'px, transparent 180px, rgba(0, 0, 0, 0.4) 182px, rgba(0, 0, 0, 0.9) 900px);\n"></div>'),n=$('<div style="position:absolute;left:'+o+"px;top: "+a+'px;z-index:100;">\n  <kbd>Ctrl</kbd> <i class="plus icon"></i> <span>\ud83d\uddb1\ufe0f\u9f20\u6807\u53f3\u952e</span>\n</div>'),$("body").append(n),n.popup({on:"manual",closable:!1,onVisible:function(){var e;return n.css({outline:"3px solid var(--negativeColor)",outlineOffset:"2px",background:"var(--defaultBackground)",transform:"scale(2.5)",transition:"transform 1s, outline 1s"}),$("body").append(r),(e=this).width(300),e.find(".ok").click((function(){return r.remove(),n.popup("destroy"),s.dontPrompt("editor_context_menu_trigger_learned"),e.remove(),n.remove()}))},html:'<div class="header">\u63d0\u793a</div><div class="content">\u6309\u4f4f<kbd>Ctrl</kbd>\u952e\uff0c\u7136\u540e\u4f7f\u7528\u9f20\u6807\u53f3\u952e\uff0c\u5c31\u53ef\u4ee5\u6253\u5f00\u7f16\u8f91\u533a\u7684\u4e0a\u4e0b\u6587\u83dc\u5355\u4e86<div><a href="javascript:void(0);" class="ok pull-right">\u77e5\u9053\u4e86</a></div></div>'}).popup("show")):void 0}))},u.prototype.destroyContextMenu=function(){var e;if(e=".xsj-codemirror-textarea-"+this.id,"client"===STORY_PLATFORM&&(e=".xsj-codemirror-"+this.id),$.contextMenu("destroy",e),"client"!==STORY_PLATFORM)return $(document).off("contextmenu",".xsj-codemirror-"+this.id)},u.prototype.execCommand=function(e,t,n){var i;if(i=this.editor,CodeMirror.commands[t.command])return n&&(n.preventDefault(),n.stopPropagation()),i.execCommand(e)},u.prototype.addCommands=function(t){var i,r,o,a,s,l;for(r=this.editor,e=e||{},Object.keys(t).forEach((function(n){var i,r;if(i=t[n],CodeMirror.commands[n]=function(e,t){var n,r,o,a,s;if(a=null,t&&t.args)switch(n=t.args.split(/\s+/),t.command){case"xsj_table":s=parseInt(n[0],10),o=parseInt(n[1],10),Number.isInteger(o)||(o=s),Number.isInteger(s)&&(a={rows:s,columns:o});break;case"xsj_olist":case"xsj_ulist":case"xsj_tlist":(r=n[0])&&(a={bullet:r})}return i.fn(e,null,a)},(r=d[n.substring("xsj_".length)])&&(r.win&&(e[r.win]=n+""),r.mac&&(e[r.mac]=n+"")),i.shortcuts&&i.shortcuts.length>0)return i.shortcuts.forEach((function(t){if(t.codeMirrorValue)return e[t.codeMirrorValue]=n+""}))})),r.addKeyMap(e),n(r),l=[],o=0,a=(s=this.childrenEditors).length;o<a;o++)i=s[o],l.push(i.addCommands(t));return l},u.prototype.bindUserKeyBoard=function(e){var t,r,o,a,s,l;for(r=this.editor,c=c||{},r.removeKeyMap(c),c={},e&&e.length>0&&e.forEach((function(e){var t;if(!e.range||"editor"===(t=e.range)||"all"===t)return e.shortcuts&&e.shortcuts.length>0?e.shortcuts.forEach((function(t){var n;if(n=t.codeMirrorValue||t.value||t){if(CodeMirror.commands[e.command])return c[n]=function(t){if(CodeMirror.commands[e.command])return CodeMirror.commands[e.command](t,e)};if(i.hasCommand(e.command))return c[n]=function(){return i.hasCommand(e.command)?i.execCommand(e.command,e):CodeMirror.Pass}}})):void 0})),r.addKeyMap(CodeMirror.normalizeKeyMap(c)),n(r),l=[],o=0,a=(s=this.childrenEditors).length;o<a;o++)t=s[o],l.push(t.bindUserKeyBoard(e));return l},u}()},l=function(e,t){return new(c())(e,t)},n.exports=l}}),window.requirejs.define({"views/codemirror/create_freeze_editor":function(e,t,n){var i,r,o,a,s,l,c,u,d,p={}.hasOwnProperty;r=t("../../lib/notifier"),i=t("../../application"),d=t("../../lib/editor/base_codemirror_editor"),s=t("./line_codemirror_widget_view"),u=function(e,t){var n;return 0,(n=e.parent)?(n.parent,t.heightAtLine(e.lineNo()+1,"local")-4):0},o=function(e){return function(t){var n,i,r,o;function a(){return a.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)p.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(a,Backbone.View),a.prototype.fileModel=null,a.prototype.editorView=null,a.prototype.rootEditorProxy=null,a.prototype.commonCodeMirrorEditor=null,a.prototype.editor=null,a.prototype.el=e,o=null,i=null,null,r=null,n=null,a.prototype.events={"click .close_button":"closeFn"},a.prototype.closeFn=function(){return this.destroy()},a.prototype.initialize=function(e){return i=e.hostCommonCodeMirrorEditor,e.initHeight,r=e.initTop,o=e.lineInfo,this.fileModel=e.fileModel,this.editorView=i.editorView,this.rootEditorProxy=i.editorProxy},a.prototype.changeFileModel=function(e){return this.fileModel=e},a.prototype.changeContentRange=function(e,t,n){var r,a,s;return o=e,a=this.editor.getDoc(),(r=i.editor.getDoc()).unlinkDoc(a),s=r.linkedDoc({sharedHist:!0,from:o.from,to:o.to+1}),this.editor.swapDoc(s),this.$el.css({height:t,top:n})},a.prototype.getLineInfo=function(){return o},a.prototype.show=function(){var e,t;return t=this,this.$el.css({left:0,top:r}),this.$el.resizable({helper:"ui-resizable-helper inline-codemirror-resizable-helper",handles:"s",stop:function(e,t){return t.element.css("width","")}}),this.$el.draggable({axis:"y",containment:"parent",handle:".codemirror-widget-draggable-handle"}),e=s(this.$el.find(".codemirror_editor_wrapper")[0],{lineNumbers:!0}),n=new e({fileModel:this.fileModel,model:this.model,commonCodeMirrorEditor:i,beforeDestroyCallback:function(){var e;return t.editorView.removeEditorProxy(t),e=t.editor.getDoc(),i.editor.getDoc().unlinkDoc(e)},destroyCallback:function(){return t.remove()}}),this.editorView.addEditorProxy(this),this.commonCodeMirrorEditor=n.commonCodeMirrorEditor,this.editor=n.editor,this.setLinkedContent(),d(this,this.commonCodeMirrorEditor),this.commonCodeMirrorEditor.editorProxy=this,this.$el.data("freezeCodemirrorView",this)},a.prototype.setLinkedContent=function(){var e;return e=i.editor.getDoc().linkedDoc({sharedHist:!0,from:o.from,to:o.to+1}),this.editor.swapDoc(e)},a.prototype.destroy=function(){if(n)return this.trigger("destroy"),n.destroy(),n=null},a.prototype.remove=function(){return this.$el.resizable("destroy"),this.$el.draggable("destroy"),a.__super__.remove.call(this)},a}()},c=function(e){var t,n,i,r,o,a;if((a=(o=e.getDoc().listSelections()[0]).anchor.line)>(n=o.head.line)&&(a=n,n=o.anchor.line),t=a,(r=n-a)<5)for(;r<5;)r=(n+=1)-(a-=1);return a<0&&(n-=a,a=0),n>(i=e.lastLine())&&(a-=n-i,n=i),a<0&&(a=0),{cursorLine:t,from:a,to:n}},l=function(e,t,n){var i,r,o,a;return n=n||200,i=e.getLineHandle(t.from),a=e.getLineHandle(t.to),r=u(i,e)-i.height,(o=u(a,e)-r)>n&&(o=n),o},a=function(e,t){var n,a,s,d,p,f,h,m,v,g,_,w,y,b,x,k,D;if(s=e.editor,v=(p=(t=t||{}).fileModel||s.fileModel).get("isSys"),g=!1,(k=i.getUserModel().get("user"))&&k.vip&&(g=!0),("web"===STORY_PLATFORM||v||t.forceOpen)&&(g=!0),g)return d=t.editorModel||s.editorModel,s.getCursor(),(w=t.lineInfo)||(w=c(s)),y=w.from,_=s.getLineHandle(y),b=s.getWrapperElement().offsetHeight,h=l(s,w,b/2||200),(m=u(_,s)-s.getDoc().scrollTop)<0&&(m=0),m>=b&&(m=b-h),(a=(n=$(s.getWrapperElement())).find(".freeze-codemirror-widget")).length>0?(x=(f=a.data("freezeCodemirrorView")).getLineInfo()).from!==w.from||x.to!==w.to?f.changeContentRange(w,h,m):f?f.destroy():void 0:(D=uniqueNumber(),a=$('<div class="freeze-codemirror-widget freeze-codemirror-'+D+' codemirror-widget" style="height: '+h+'px;">\n<div class="codemirror-widget-draggable-handle" style="height: 8px; position: absolute; z-index: 11; width: 100%;"></div>\n<div class="codemirror-widget-title"><i class="icon link close close_button"></i></div>\n<div class="codemirror_editor_wrapper" style="height: 100%;">\n  <textarea class="codemirror_editor" name="codemirror_editor" rows="10" cols="30" style="width:100%;height:100%;"></textarea>\n</div>\n  </div>'),n.append(a),(f=new(o(a[0]))({fileModel:p,model:d,lineInfo:w,initHeight:h,initTop:m,hostCommonCodeMirrorEditor:e})).show(),f);r.showMessage("\u975e\u4f1a\u5458\u65e0\u6cd5\u5728\u5ba2\u6237\u7aef\u4f7f\u7528\u9501\u884c\u7f16\u8f91\u5668",6e3,"error")},n.exports=a}}),window.requirejs.define({"views/codemirror/create_inline_editor":function(e,t,n){var i,r,o,a,s,l,c,u=function(e,t){return function(){return e.apply(t,arguments)}},d={}.hasOwnProperty;r=t("../../models/file_local_model"),i=t("../../application"),c=t("../../lib/editor/base_codemirror_editor"),a=t("./line_codemirror_widget_view"),l=function(e,t){return 0,e.parent?t.heightAtLine(e.lineNo()+1,"local")-4:0},o=function(e){return function(t){var n,o,s,p,f,h,m,v,g,w,y,b,x,k;function D(){return this.fullPathChangedFn=u(this.fullPathChangedFn,this),this.clientWatchFileFn=u(this.clientWatchFileFn,this),this.fileModelContentChanged=u(this.fileModelContentChanged,this),D.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)d.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(D,Backbone.View),D.prototype.fileModel=null,D.prototype.editorView=null,D.prototype.rootEditorProxy=null,D.prototype.commonCodeMirrorEditor=null,D.prototype.editor=null,D.prototype.el=e,s=null,w=null,p=null,x=null,g=null,v=0,h=0,f=null,y=null,k=null,D.prototype.isOperating=!1,o=null,n=null,D.prototype.events={"click .close_button":"closeFn","click .open_button":"openFn"},D.prototype.openFn=function(){var e,t,n;return e=this.editor.getCursor(),t=this.rootEditorProxy.commonCodeMirrorEditor.id,n="group_"+t,$(window).trigger("createNewEditor",[this.fileModel,{groupId:n,callback:function(e,t){var i;if(n=e.id,i=t.$el.find(".popup_editor_file_tabs .file_item.droppable_file_item.active")[0])return appHighlightPosByEl(i)},initCursor:{row:e.line,column:e.ch}}]),this.destroy()},D.prototype.closeFn=function(){return this.destroy()},m=function(e){var t;return t=i.getFileLocalCollection(),(s=t.getFileLocalModelByFileId(e.id)).get("isLocked")?s.get("content")&&e.set({content:s.get("content")},{silent:!0}):s.save({content:e.get("content")}),s},D.prototype.initialize=function(e){return k=this,w=e.lineCodemirrorWidget,p=e.hostCommonCodeMirrorEditor,g=e.initWidgetTop,v=e.initRow||0,h=e.initColumn||0,f=e.initCallback,this.fileModel=e.fileModel,this.editorView=p.editorView,this.rootEditorProxy=p.editorProxy,s=m(this.fileModel),n=_.debounce((function(){return s.save(),k.model.get("autoSave").canAutoSave?k.fileModel.save({},{error:function(e){return console.error(e),Notifier.showMessage("\u81ea\u52a8\u4fdd\u5b58\u6587\u7ae0\u5931\u8d25:"+e,6e3,"error"),k.isOperating=!1},success:function(){return k.isOperating=!1,s.save({isLocked:!1})}}):k.isOperating=!1}),k.model.get("autoSave").interval),o=function(){var e;return k.isOperating=!0,e=k.getValue(),k.fileModel.set({content:e,updateDate:Date.now()}),s.set({content:e,isLocked:!0}),n()}},D.prototype.changeFileModel=function(e){return 0},b=function(){var e,t,n;return $(w.node).resizable({helper:"ui-resizable-helper inline-codemirror-resizable-helper",handles:"s",stop:function(e,t){return n(),t.element.css("width","")}}),t=function(){var e,t,n,i;if(w&&(e=w.doc.cm).getLineNumber(w.line)>=0){i=l(w.line,e),t=w.height-4,n=w.doc.cm.display.lineDiv.clientWidth,k.$el.css({width:n-10,height:t,top:i-w.height});try{return w.changed()}catch(e){return e,console.log("skip")}}},n=_.throttle(t,100),e=0,(x=new ResizeObserver((function(t){var i;return t[0].borderBoxSize?(i=t[0].borderBoxSize[0].blockSize)&&e!==i?(e=i,n()):void 0:n()}))).observe(p.editor.display.sizer)},D.prototype.show=function(){var e;return $(w.node),this.$el.css({width:w.node.clientWidth-4-6-10,height:w.height,left:0,top:g,zIndex:100}),b(),e=a(this.$el.find(".codemirror_editor_wrapper"),{lineNumbers:!0}),y=new e({fileModel:this.fileModel,model:this.model,commonCodeMirrorEditor:p,destroyCallback:function(){return k.editorView.removeEditorProxy(k),k.remove()}}),this.commonCodeMirrorEditor=y.commonCodeMirrorEditor,this.editor=y.editor,c(this,this.commonCodeMirrorEditor),this.setEditorContent(),this.initListeners(),v&&this.moveCursorTo(v,h||0),f&&f(this.editor),this.editor.on("change",o),this.commonCodeMirrorEditor.editorProxy=this,this.editorView.addEditorProxy(this),w.inlineCodeMirrorWidgetView=this},D.prototype.fileModelTitleChanged=function(e,t){return k.$el.find(".codemirror-widget-title-content").text(t),s.save({title:t})},D.prototype.fileModelContentChanged=function(e,t){if(t!==k.getValue())return n.cancel(),k.editor.off("change",o),k.setValue(t),k.editor.on("change",o)},D.prototype.destroyListeners=function(){return this.stopListening(this.fileModel),this.stopListening(s),this.unwatchFile()},D.prototype.initListeners=function(){var e;return this.listenTo(this.fileModel,"change:title",this.fileModelTitleChanged),this.listenTo(this.fileModel,"change:content",this.fileModelContentChanged),this.listenTo(s,"change:fullPath",this.fullPathChangedFn),"client"===STORY_PLATFORM&&(e=this.fileModel,i.getClientFileWatchManager().checkConfirmFileLocalModel(s,(function(t,n){if(t)return e.set("content",n)}))),this.watchFile()},D.prototype.clientWatchFileFn=function(e,t){if(!e&&s&&!s.get("isLocked"))return this.fileModel.set("content",t)},D.prototype.unwatchFile=function(){if(s&&"client"===STORY_PLATFORM)return i.getClientFileWatchManager().unwatchFileLocalModel(s,this.clientWatchFileFn)},D.prototype.watchFile=function(){if(s&&"client"===STORY_PLATFORM)return i.getClientFileWatchManager().watchFileLocalModel(s,this.clientWatchFileFn)},D.prototype.fullPathChangedFn=function(e){var t,n;return(t=e.previousAttributes())&&(n=new r(t),i.getClientFileWatchManager().unwatchFileLocalModel(n,this.clientWatchFileFn)),i.getClientFileWatchManager().watchFileLocalModel(e,this.clientWatchFileFn)},D.prototype.destroy=function(){return y&&y.destroy(),y=null},D.prototype.remove=function(){return x.unobserve(p.editor.display.sizer),x=null,this.destroyListeners(),w&&(w.destroyLineCodemirrorWidgetFn&&(w.line.off("delete",w.destroyLineCodemirrorWidgetFn),w.destroyLineCodemirrorWidgetFn=null),w.inlineCodeMirrorWidgetView=null,$(w.node).resizable("destroy"),w.inlineCodeMirrorWidgetView=null,w.clear(),w=null),D.__super__.remove.call(this)},D}()},s=function(e,t){var n,r,a,s,c,u,d,p,f,h,m,v,g,w,y,b,x,k,D,C,F;if(!1,(D=i.getUserModel().get("user"))&&D.vip&&!0,"web"===STORY_PLATFORM&&!0,!!0)return"fallback";if(a=e.editor,u=(t=t||{}).fileModel||a.fileModel,c=t.editorModel||a.editorModel,(b=t.lineNum)||(b=a.getCursor().line),f=t.initRow||0,p=t.initColumn||0,d=t.initCallback,t.fileModel||(f=b,p=0),y=a.getLineHandle(b),w=null,s=function(){if(w&&w.inlineCodeMirrorWidgetView)return w.inlineCodeMirrorWidgetView.destroy()},y.widgets)for(m=0,g=(k=y.widgets).length;m<g;m++)if((v=k[m]).inlineCodeMirrorWidgetView){w=v;break}return x=!0,w&&(x=!1,w.inlineCodeMirrorWidgetView&&u.id!==w.inlineCodeMirrorWidgetView.fileModel.id&&(x=!0),s()),x?(C=uniqueNumber(),r=$('<div class="line-codemirror-placeholder-'+C+'" style="height: 200px;margin-top: 6px;">\n</div>'),F=l(y,a),w=a.addLineWidget(b,r[0],{className:"inline-codemirror-linewidget"}),n=$('<div class="line-codemirror-widget codemirror-widget  line-codemirror-'+C+'" style="height: 200px;">\n<div class="codemirror-widget-title">\n  <i class="icon link close close_button" title="\u5173\u95ed"></i>\n  <span class="codemirror-widget-title-content" title="'+_.escape(u.get("title"))+'">'+_.escape(u.get("title"))+'</span>\n  <i class="clone outline icon link open_button" title="\u5728\u6d6e\u52a8\u7f16\u8f91\u5668\u4e2d\u6253\u5f00"></i>\n</div>\n<div class="codemirror_editor_wrapper" style="height: 100%;">\n  <textarea class="codemirror_editor" name="codemirror_editor" rows="10" cols="30" style="width:100%;height:100%;"></textarea>\n</div>\n  </div> '),a.addWidget({line:b,ch:0},n[0]),(h=new(o(n[0]))({model:c,fileModel:u,initWidgetTop:F,initRow:f,initColumn:p,initCallback:d,lineCodemirrorWidget:w,hostCommonCodeMirrorEditor:e})).show(),y.on("delete",s),w.destroyLineCodemirrorWidgetFn=s,h):void 0},n.exports=s}}),window.requirejs.define({"views/codemirror/create_new_inline_editor":function(e,t,n){var i,r,o;o=t("../../lib/editor/base_codemirror_editor"),i=t("./line_codemirror_widget_view"),r=function(e,t){var n,r,a,s,l,c,u,d,p,f,h,m,v,g;if(a=e.editor,c=(t=t||{}).fileModel||a.fileModel,l=t.editorModel||a.editorModel,s=a.getCursor(),m=a.getLineHandle(s.line),f=null,m.widgets)for(u=0,p=(v=m.widgets).length;u<p;u++)if((d=v[u]).lineCodemirrorWidgetView){f=d;break}return f?(f.lineCodemirrorWidgetView.destroy(),f.lineCodemirrorWidgetView=null):(g=uniqueNumber(),r=$('<div class="line-codemirror-widget line-codemirror-placeholder-'+g+'" style="height: 100px;margin-top: 6px;">\n<div class="codemirror_editor_wrapper" style="height: 100%;">\n  <textarea class="codemirror_editor" name="codemirror_editor" rows="10" cols="30" style="width:100%;height:100%;"></textarea>\n</div>\n  </div>'),f=a.addLineWidget(s.line,r[0],{}),n=r.find(".codemirror_editor_wrapper"),h=new(i(n[0]))({fileModel:c,model:l,commonCodeMirrorEditor:e,editorProxy:e.editorProxy,destroyCallback:function(){return f.lineCodemirrorWidgetView=null,f.clear()}}),f.lineCodemirrorWidgetView=h,o(h,h.commonCodeMirrorEditor),h.commonCodeMirrorEditor.editorProxy=h,h.editor.setOption("viewportMargin",Infinity),h)},n.exports=r}}),window.requirejs.define({"views/codemirror/create_popup_editor":function(e,t,n){var i,r,o,a,s,l,c,u,d,p,f,h,m,v,g,w,y,b,x,k,D,C,F=function(e,t){for(var n in t)M.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e},M={}.hasOwnProperty,T=function(e,t){return function(){return e.apply(t,arguments)}};l=t("../../lib/notifier"),d=t("../../lib/utils"),s=t("../../models/file_local_model"),r=t("../../application"),o=t("../base_window_manager_view"),t("../../constant"),u=t("../table_of_content_view"),c=t("./popup_editor_tour_utils"),i=t("../../lib/app_resource_core"),C=t("../../lib/preview_core"),D=t("../../lib/editor/base_codemirror_editor"),p=t("./common_codemirror_editor"),x=t("./editor_hover_widget"),b=t("./drop_file_event"),y=t("./auto_suggest_event"),k=t("./selection_tippy_event"),h=t("./create_inline_editor"),f=t("./create_freeze_editor"),v=t("./popup_editor_file_tabs_view"),m=function(e){return function(t){var n,i,o,a,s;function l(){return l.__super__.constructor.apply(this,arguments)}return F(l,t),l.prototype.editor=null,l.prototype.fileModel=null,l.prototype.editorView=null,l.prototype.commonCodeMirrorEditor=null,l.prototype.el=e,n=!1,s=null,o=null,i="default",l.prototype.destroy=function(){if(this.commonCodeMirrorEditor.connectedView=null,this.commonCodeMirrorEditor.destroy(),this.editor.setOption("searchbox",!1),this.editor.xsjDestroy(),$(window).off("sidebarHidden",s),s=null,this.remove(),o)return o()},l.prototype.initialize=function(e){var t,i;return this.fileModel=e.fileModel,o=e.destroyCallback,this.editorView=e.editorView,t=a(this.$el.find(".codemirror_editor")[0],this.fileModel,this.model,this),this.editor=t,this.commonCodeMirrorEditor=p(t,this.editorView),this.commonCodeMirrorEditor.addCommands(this.editorView.getCommands()),this.commonCodeMirrorEditor.bindUserKeyBoard(this.editorView.getBindInfos()),this.commonCodeMirrorEditor.connectedView=this,this.setEditorConfig(),this.listenTo(this.model,"change:bindInfos",(i=this,function(){return i.commonCodeMirrorEditor.bindUserKeyBoard(i.editorView.getBindInfos())})),this.listenTo(this.model,"change",function(e){return function(){return n=!0,e.setEditorConfig()}}(this)),this.listenTo(this.model,"refreshEditorProfile",function(e){return function(){return e.setEditorConfig()}}(this)),s=function(){var e;if(t&&n)return e=t.getOption("lineNumbers"),t.setOption("lineNumbers",!e),t.setOption("lineNumbers",e),n=!1},$(window).on("sidebarHidden",s)},a=function(e,t,n,i){var o;return(o=CodeMirror.fromTextArea(e,{mode:CodeMirror.createXSJCodeMirrorMode((function(){return{fileModel:i.fileModel,app:r,editorModel:i.model}})),extraKeys:{Enter:"newlineAndIndentContinueMarkdownList",Tab:"tabAndIndentMarkdownList","Shift-Tab":"shiftTabAndUnindentMarkdownList",F4:function(e){return f(i.commonCodeMirrorEditor)},F3:function(e){return h(i.commonCodeMirrorEditor)}},modeLoader:!0,dragDrop:!0,foldGutter:!0,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"],highlightSelectionMatches:{showToken:!1,annotateScrollbar:!0},maxInvisibles:16,searchbox:!0,lineWrapping:!0,inputStyle:d.isMobileDevice()?"contenteditable":"textarea"})).initXSJApp(r,t,n,i),x(o,{openXSJFileFn:function(e,t){var n,r;return r=t.lineNum,n=d.getCursorByHashTag(t.hashTag,e.get("content")),h(i.commonCodeMirrorEditor,{lineNum:r,fileModel:e,initColumn:n.column,initRow:n.row})}}),b(o),y(o),o.addKeyMap({"Ctrl-Alt-/":"toggleAutopreview","Cmd-Alt-/":"toggleAutopreview"}),o},l.prototype.setEditorConfig=function(){var e,t,n,o,a,s,l,c,u,d,p,f,h,m,v,g,_,w,y,b,x,k,D;this.editor.startOperation(),o=this.model.get("cm_autopreview"),p=this.model.get("cm_autopreview_image"),h=this.model.get("cm_autopreview_link"),f=this.model.get("cm_autopreview_inline"),d=this.model.get("cm_autopreview_hr"),v=this.model.get("cm_autopreview_table"),_=this.model.get("cm_autopreview_yaml"),m=this.model.get("cm_autopreview_mathjax"),g=this.model.get("cm_autopreview_todo"),l=this.model.get("cm_autopreview_fenced_code"),u=this.model.get("cm_autopreview_header"),c=this.model.get("cm_autopreview_html"),s=this.model.get("cm_autopreview_emoji"),a={image:!!p,todolist:!!g,mathjax:!!m,html:!!c,mermaid:!!this.model.get("cm_autopreview_mermaid"),flow:!!this.model.get("cm_autopreview_flow"),sequence:!!this.model.get("cm_autopreview_sequence"),plantUML:!!this.model.get("cm_autopreview_plantUML"),header:!!u,inline:!!f,hr:!!d,table:!!v,link:!!h,fileYaml:!!_,fencedCode:!!l,emoji:!!s,toc:!!this.model.get("cm_autopreview_toc"),footnote:!!this.model.get("cm_autopreview_footnote"),ruby:!!this.model.get("cm_autopreview_ruby"),quote:!0},this.editor.autopreviewConfig=a,o?this.editor.setOption("autopreview",a):this.editor.setOption("autopreview",!1),this.editor.setOption("lineWrapping",this.model.get("cm_lineWrapping")),CodeMirror.optionHandlers.autoCloseBrackets&&this.editor.setOption("autoCloseBrackets",this.model.get("cm_autoCloseBrackets")),CodeMirror.optionHandlers.autoCloseTags&&this.editor.setOption("autoCloseTags",this.model.get("cm_autoCloseBrackets")),CodeMirror.optionHandlers.matchBrackets&&this.editor.setOption("matchBrackets",!0),CodeMirror.optionHandlers.matchTags&&this.editor.setOption("matchTags",!0),this.editor.setOption("scrollPastEnd",this.model.get("cm_scrollPastEnd")),this.editor.setOption("inputOffsetTopWithCursor",this.model.get("cm_inputOffsetTop")),this.editor.setOption("spellCheckerAffUrl","media/en_US.aff"),this.editor.setOption("spellCheckerDicUrl","media/en_US.dic"),D=this.model.get("cm_spellChecker"),this.editor.setOption("spellChecker",D),b=this.model.get("cm_markerColorpicker"),n=r.getApplicationProfileModel(),b?this.editor.setOption("colorpicker",{type:"sketch",onColorSetsChanged:function(e){return null==e&&(e=[]),n.set("cmColorpickerColorSets",e.join("|")),n.save()},colorSets:function(){var e,t;return t=[],(e=$.trim(n.get("cmColorpickerColorSets"))||"")&&(t=e.split("|")),[{colors:t,name:"Input Colors",edit:!0}]},mode:"edit"}):this.editor.setOption("colorpicker",!1),y=this.model.get("cm_lineNumbers"),this.editor.setOption("lineNumbers",y),t=$(this.editor.getGutterElement()),y?t.removeClass("no_linenumers"):t.addClass("no_linenumers"),e=$(this.editor.getWrapperElement()),w=this.model.get("cm_keyBinding")||"default","default"!==i&&this.editor.removeKeyMap(CodeMirror.keyMap[i]||i),"default"!==w&&this.editor.addKeyMap(w),i=w,this.editor.setOption("keyMap",this.model.get("cm_keyBinding")||"default"),this.editor.setOption("typewriterScrolling",this.model.get("cm_typewriterScrolling")),x=this.model.get("fontSize")||16,(k=this.model.get("lineHeight"))||(k=1.4*x/16),e.css("fontSize",x+"px"),e.css("lineHeight",k),this.editor.setOption("styleActiveLine",this.model.get("cm_highlightActive")),this.editor.setOption("activeCursorMathjax",this.model.get("cm_activeCursorMathjax")),this.editor.setOption("styleStackFocusLine",this.model.get("cm_styleStackFocusLine")),this.editor.setOption("showInvisibles",this.model.get("cm_showInvisibles")),this.editor.setOption("smartIndent",this.model.get("cm_smartIndent")),this.editor.setOption("indentWithTabs",this.model.get("cm_indentWithTabs")),this.editor.setOption("tabSize",this.model.get("cm_tabSize")||4),this.editor.setOption("indentUnit",this.model.get("cm_tabSize")||4),this.editor.setOption("typewriterScrolling",this.model.get("cm_typewriterScrolling")),this.editor.endOperation(),this.editor.refresh()},l}(Backbone.View)},a=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return F(t,e),t.prototype.local_storage_name="edit_editor_window_manager",t}(o),w=function(e){return function(n){var o,p,f,h,g,w,y,b,x,M,S,P,j,E,I,O;function V(){return this.fullPathChangedFn=T(this.fullPathChangedFn,this),this.clientWatchFileFn=T(this.clientWatchFileFn,this),V.__super__.constructor.apply(this,arguments)}return F(V,n),V.prototype.className="draggable_dialog_content_container",null,w=null,E=null,"all",x=null,V.prototype.scrollTopMap={},V.prototype.fileModel=null,V.prototype.editorView=null,V.prototype.rootEditorProxy=null,V.prototype.commonCodeMirrorEditor=null,V.prototype.activeCommonCodeMirrorEditor=null,j=null,I=null,O=null,V.prototype.refresh=null,V.prototype.editor=null,V.prototype.isOperating=!1,y=null,b=null,g=null,P=null,o=null,V.prototype.hideNoFileDimmer=function(){return this.$el.removeClass("no_open_file")},V.prototype.showNoFileDimmer=function(){return this.$el.addClass("no_open_file")},V.prototype.fileModelTitleChanged=function(e,t){return w.setTitle(t),x.save({title:t})},V.prototype.fileModelContentChanged=function(e,t){if(t!==I.getValue())return g.cancel(),I.editor.off("change",y),I.editor.off("scroll",b),I.setValue(t),I.editor.on("change",y),I.editor.on("scroll",b)},V.prototype.setActiveEditorProxy=function(e,t){var n;if((n=e?e.commonCodeMirrorEditor:this.commonCodeMirrorEditor)!==this.activeCommonCodeMirrorEditor||t)return this.activeCommonCodeMirrorEditor=n,this.editorView.editorTool.reInitEditorTool(this.activeCommonCodeMirrorEditor.editorProxy),this.getUndoManager().onButtonStateChange(),w.$el.addClass("draggable_dialog_editor_active raised")},M=function(e){return e.activeCommonCodeMirrorEditor||e.commonCodeMirrorEditor},V.prototype.getActiveEditorProxy=function(){return M(this).editorProxy},V.prototype.events={"click .toggle_preview_button":"togglePreviewFn","click .open_toc_button":"toggleTocFn","mousedown .popup_editor_file_tabs":"focusEditorFn"},V.prototype.toggleTocFn=function(e){return O?(I.$el.find(".task_tree_container_buttons").removeClass("toc_opened"),I.editor.off("change",O.refresh),O.destroy(),O=null):(I.$el.find(".task_tree_container_buttons").addClass("toc_opened"),(O=new u({parent:{hide:function(){return I.$el.find(".open_toc_button").trigger("click")}},initDragAndDrop:!0,initWide:!1,setContentFn:function(e){return I.setValue(e)},gotoLineFn:function(e,t){var n;return n=function(){var e,t;if((e=I.editor)&&e.highlightPos)return t=e.getCursor(),e.highlightPos(t)},"top"===e?(I.gotoLine(0),n()):"bottom"===e?(I.gotoLine(I.getLength()-1),n()):(I.gotoLine(e),n()),"function"==typeof t?t():void 0},getFirstVisibleRowFn:function(e){var t,n,i;return t=n=I.getFirstVisibleRow(),e&&(i=I.getLastVisibleRow(),(t=I.getCursorPosition())<n&&(t=n),t>i&&(t=i)),t},getContentFn:function(){return I.getValue()},listenToSyncFn:function(e){return I.$el.on("changeScrollTop",e)},unListenToSyncFn:function(e){return I.$el.off("changeScrollTop",e)}})).render(),this.$el.find(".task_tree_buttons_detail").html(O.$el),t("../../lib/dynamic_import/import_fancytree")((function(){if(O)return O.initToc()})),I.editor.on("change",O.refresh))},V.prototype.focusEditorFn=function(){return p(this)},p=function(e){return e.editorView.getActiveEditorProxy(!1)!==e&&(e.focus(),e.trigger("focus")),e.editorView.setActiveEditorProxy(e.getActiveEditorProxy())},f=function(e,t,n){var i,a;return a=r.getPreviewProfileModel(),t.html(""),(i=$('<iframe src="preview.html" frameborder="0" style="width: 100%;height:100%;"></iframe>').appendTo(t)).one("load",(function(){var t,s,l,c,u,d,p,f;return l=i[0],u=l.contentDocument,p=l.contentWindow,s=p.$||$,p.autoLoadRemoteResource=!0,r.getStyleText(e,(function(e,t){return C.setCustomCss(t,u)})),t=s(u).find(".preview"),o=t,p.requirejs("previews/preview")(p,window),t.on("click",".story_script_resource_placeholder",(function(e){var t;return t=s(e.currentTarget),C.replaceScriptResource(t,e)})),"function"==typeof window.changeOpenTarget&&window.changeOpenTarget(u),STORY_PLATFORM,c=u.createElement("script"),f=u.getElementsByTagName("script")[0],c.async=1,c.src="js/find-in-nw.js",f.parentNode.insertBefore(c,f),c.onload=function(){return p.findInNw.initialize()},d={sourceMap:!0,previewType:"normal",needRenderPreview:!0,parseClientLocalMedias:!0,livePreview:!0},C.previewTarget(e,a,p,t,d,(function(){var e,i,r,o,a;for(a=(o=t.find("[data-source-line]").toArray())[0],e=0,i=o.length;e<i&&(r=o[e],!((parseInt(r.dataset.sourceLine)||0)>n));e++)a=r;if(a)return t.parent()[0].scrollTop=a.offsetTop}))}))},h=function(){if(o)return o.empty(),o.parentsUntil("html").remove(),o=null},V.prototype.hidePreview=function(){return this.$el.find(".popup_preview_wrapper").hide(),h()},V.prototype.showPreview=function(){var e,t;return t=this.getFirstVisibleRow(),(e=this.$el.find(".popup_preview_wrapper")).show(),f(this.fileModel,e,t)},V.prototype.togglePreviewFn=function(e){var t,n,i;return i=(n=$(e.currentTarget)).data("isPreview")||!1,t=this.$el.find(".codemirror_editor_container"),n.data("isPreview",!i),t.toggleClass("codemirror_editor_preview_mode",!i),i?(n.removeClass("edit"),n.addClass("unhide"),this.hidePreview()):(n.removeClass("unhide"),n.addClass("edit"),this.showPreview())},S=function(e){var t;return t=r.getFileLocalCollection(),(x=t.getFileLocalModelByFileId(e.id)).get("isLocked")?x.get("content")&&e.set({content:x.get("content")},{silent:!0}):x.save({content:e.get("content")}),x},V.prototype.initialize=function(e){return I=this,this.fileModel=e.fileModel,this.editorView=e.editorView,this.rootEditorProxy=this,x=S(this.fileModel),g=_.debounce((function(){return x.save(),I.model.get("autoSave").canAutoSave?I.fileModel.save({},{error:function(e){return console.error(e),I.isOperating=!1,l.showMessage("\u81ea\u52a8\u4fdd\u5b58\u6587\u7ae0\u5931\u8d25:"+e,6e3,"error")},success:function(){return I.isOperating=!1,x.save({isLocked:!1})}}):I.isOperating=!1}),I.model.get("autoSave").interval),y=function(){var e;return I.isOperating=!0,e=I.getValue(),I.fileModel.set({content:e,updateDate:Date.now()}),x.set({content:e,isLocked:!0}),g()},b=function(){var e,t;if(e=I.fileModel.id,(t=I.getScrollTop())||(t=1),I.scrollTopMap[e]=t,!I.editor.state.typewriterScrolling||!I.editor.state.typewriterScrolling.scrolling)return I.$el.trigger("changeScrollTop")}},V.prototype.preventEventBubble=function(){var e;return e=r.getKeyboardProfileModel(),this.$el.on("keydown",(function(t){var n;if(n=t.keyCode,27!==E||16===n||17===n||18===n||91===n)return 16!==n&&17!==n&&18!==n&&91!==n&&(E=n),!t.ctrlKey&&!t.altKey||e.getKeyByEvent(t)?void 0:t.stopPropagation();E=n}))},V.prototype.getCursorByHashTag=function(e){var t;return t=this.getValue(),d.getCursorByHashTag(e,t)},V.prototype.initCursor=function(e){var t,n,i,r,o;if(null==e&&(e={}),r=0,t=0,i=[],x&&(r=x.get("cursorPosition")||0,t=x.get("cursorPositionColumn")||0,i=x.get("foldInfos")||[]),e.cursorPosition&&(r=e.cursorPosition,t=0,e.cursorPositionColumn&&(t=e.cursorPositionColumn)),e.foldInfos&&(i=e.foldInfos),e.hashTag&&(n=this.getCursorByHashTag(e.hashTag))&&(r=n.row,t=n.column),this.focus(),this.applyFoldInfos(i),0===r&&0===t||this.moveCursorTo(r,t),o=this.scrollTopMap[this.fileModel.id],(e.hashTag||e.cursorPosition||!o)&&(o=this.documentToScreenRowHeight(r)+this.getScrollTop()-this.$el.height()/2)<0&&(o=1),o)return this.scrollToY(o)},V.prototype.hide=function(){if(w)return w.$el.hide()},V.prototype.show=function(e){var t,n,r;if(null==e&&(e={}),!w)return this.scrollTopMap={},(w=new a({useLocalStorage:!1,canPinned:!0,canMin:!0,canShape:!0})).$el.addClass("draggable_dialog_editor"),w.show(e),this.render(),w.$el.find(".draggable_dialog_content_container_wrapper").append(this.$el),n=this,t=m(this.$el.find(".codemirror_editor_wrapper")[0]),P=new t({model:n.model,fileModel:n.fileModel,editorView:n.editorView,destroyCallback:function(){}}),this.commonCodeMirrorEditor=P.commonCodeMirrorEditor,this.activeCommonCodeMirrorEditor=this.commonCodeMirrorEditor,this.editor=this.commonCodeMirrorEditor.editor,D(this,P.commonCodeMirrorEditor),this.commonCodeMirrorEditor.editorProxy=this,this.editorView.setActiveEditorProxy(this),this.editorView.addEditorProxy(this),this.setEditorContent(),w.setTitle(this.fileModel.get("title")),this.initCursor(e.cursorOpts),this.initListeners(),k(this.editor),this.preventEventBubble(),this.editor.on("change",y),this.editor.on("scroll",b),w.on("resize",(r=this,function(){return r.scrollTopMap={},r.editor.refresh(),n.trigger("resize")})),w.on("reposition",(function(e){return n.trigger("reposition",e)})),w.on("toggleMax",(function(e){return n.trigger("toggleMax",e)})),w.on("toggleMin",(function(e){return n.trigger("toggleMin",e)})),w.on("togglePin",(function(e){return n.trigger("togglePin",e)})),w.on("focus",(function(){return p(n)})),w.$el.on("click",".draggable_dialog_header",(function(e){var t;if(e&&e.currentTarget===e.target&&(t=j.$el.find(".file_item.active")).visible())return c.showTourFn(t)})),w.$el.on("mousedown",".draggable_dialog_header",(function(e){return p(n)})),w.$el.on("copy",function(e){return function(){return i.setCurrentCopiedFileModel(e.getActiveEditorProxy().fileModel||e.fileModel)}}(this)),j.on("tabFilesChanged",(function(e){return n.trigger("tabFilesChanged",e)})),j.on("tabActiveFileChanged",(function(e,t){return n.trigger("tabActiveFileChanged",e,t)})),j.on("tabDragOut",(function(){return n.trigger("tabDragOut")})),j.on("tabDragOver",(function(){return n.trigger("tabDragOver")})),j.on("tabDragDrop",(function(){return n.trigger("tabDragDrop")})),j.on("tabDragStart",(function(){return n.trigger("tabDragStart")})),j.on("tabDragStop",(function(){return n.trigger("tabDragStop")})),j.on("tabDragReceive",(function(){return n.trigger("tabDragReceive")})),w.on("beforeClose",function(e){return function(){return n.trigger("beforeClose"),O&&(O.destroy(),O=null),e.editorView.removeEditorProxy(e),e.editorView.setActiveEditorProxy(e.editorView.editorProxy),e.commonCodeMirrorEditor.destroy(),e.commonCodeMirrorEditor=null,e.activeCommonCodeMirrorEditor=null,e.editor=null,e.editorView=null,j.remove(),P=null}}(this)),w.on("close",(function(){return n.trigger("close"),n.remove(),w=null}));w.$el.show()},V.prototype.render=function(){var t,n;return w.showDimmer(),t=$('<div class="draggable_dialog_content" style="overflow:hidden; flex-basis: 0;">\n  <div class="codemirror_editor_container task_tree_container theme_tree_container">\n    <div class="no_file ui dimmer">\n      <h2 class="ui header">\n        <span style="font-family:webfontxiaoshujiang;font-size: 3rem;">\u5c0f\u4e66\u5320</span>\n      </h2>\n      \u6ca1\u6709\u6253\u5f00\u7684\u6587\u7ae0\uff0c\u53ef\u4ee5\u901a\u8fc7\u62d6\u62fd\uff0c\u5c06\u6587\u7ae0\u5217\u8868\u91cc\u7684\u6587\u7ae0\u653e\u5230\u8be5\u6d6e\u52a8\u7f16\u8f91\u5668\u9875\u7b7e\u4e0a\n    </div>\n    <div class="task_tree_container_buttons draggable_dialog_editor_buttons">\n      <div class="task_tree_buttons">\n        <i class="unhide icon toggle_preview_button link large" title="\u9884\u89c8"></i>\n        <i class="icon content open_toc_button link large" title="\u6587\u6863\u5927\u7eb2"></i>\n      </div>\n      <div class="task_tree_buttons_detail"></div>\n    </div>\n    <div class="codemirror_editor_wrapper" style="height: 100%;z-index:5;">\n      <textarea class="codemirror_editor" name="codemirror_editor" rows="10" cols="30" style="width:100%;height:100%;"></textarea>\n    </div>\n    <div class="preview_wrapper popup_preview_wrapper iframe_wrapper" style="display:none;position:absolute;width: 100%;height:100%;top:0;left:0;z-index:6;background:var(--selectionBackground);">\n    </div>\n  </div>\n</div>'),e&&0!==e.length||this.showNoFileDimmer(),n=v(),(j=new n({fileTabs:e,popupEditorWindowView:this})).render(),t.find(".codemirror_editor_container").append(j.$el),j.changeFileModel(this.fileModel),this.$el.html(t),w.hideDimmer()},V.prototype.changeFileModel=function(e,t){var n,i;return e?(this.hideNoFileDimmer(),n={},(i=j.changeFileModel(e))&&(n={cursorPosition:i.row||0,cursorPositionColumn:i.column||0,foldInfos:i.foldInfos}),this.commonCodeMirrorEditor.destroyChildren(),this.destroyListeners(),this.fileModel.save(),this.fileModel=e,P.fileModel=e,this.editor.changeFileModel(e),x=S(e),$(window).trigger("changeActiveEditorProxy",this),g.cancel(),this.editor.off("change",y),this.editor.off("scroll",b),this.setEditorContent(),this.initCursor(Object.assign({},t,n)),this.editor.on("change",y),this.editor.on("scroll",b),this.initListeners(),w.setTitle(this.fileModel.get("title")),this.$el.find(".toggle_preview_button").data("isPreview")||!1?this.showPreview():void 0):(w.setTitle(""),void this.showNoFileDimmer())},V.prototype.getFileModelIds=function(){var e;return e=[],j&&j.getFileModelIds().forEach((function(t){return e.push(t)})),e},V.prototype.addCommands=function(e){return this.commonCodeMirrorEditor.addCommands(e)},V.prototype.bindUserKeyBoard=function(e){return this.commonCodeMirrorEditor.bindUserKeyBoard(e)},V.prototype.destroyListeners=function(){return this.stopListening(this.fileModel),this.stopListening(x),this.unwatchFile()},V.prototype.initListeners=function(){var e;return this.listenTo(this.fileModel,"change:title",this.fileModelTitleChanged),this.listenTo(this.fileModel,"change:content",this.fileModelContentChanged),this.listenTo(x,"change:fullPath",this.fullPathChangedFn),"client"===STORY_PLATFORM&&(e=this.fileModel,r.getClientFileWatchManager().checkConfirmFileLocalModel(x,(function(t,n){if(t)return e.set("content",n)}))),this.watchFile()},V.prototype.clientWatchFileFn=function(e,t){if(!e&&x&&!x.get("isLocked"))return this.fileModel.set("content",t)},V.prototype.unwatchFile=function(){if(x&&"client"===STORY_PLATFORM)return r.getClientFileWatchManager().unwatchFileLocalModel(x,this.clientWatchFileFn)},V.prototype.watchFile=function(){if(x&&"client"===STORY_PLATFORM)return r.getClientFileWatchManager().watchFileLocalModel(x,this.clientWatchFileFn)},V.prototype.fullPathChangedFn=function(e){var t,n;return(t=e.previousAttributes())&&(n=new s(t),r.getClientFileWatchManager().unwatchFileLocalModel(n,this.clientWatchFileFn)),r.getClientFileWatchManager().watchFileLocalModel(e,this.clientWatchFileFn)},V.prototype.remove=function(){return this.destroyListeners(),j=null,null,w=null,V.__super__.remove.apply(this,arguments)},V.prototype.close=function(){return w.remove()},V.prototype.getWindow=function(){return w},V}(Backbone.View)},g=function(e,t,n,i){return new(w(i))({fileModel:t,model:n,editorView:e})},n.exports=g}}),window.requirejs.define({"views/codemirror/default_shortcut":function(e,t,n){var i;i={bold:{win:"Ctrl-B",mac:"Cmd-B"},italic:{win:"Ctrl-I",mac:"Cmd-I"},mark:{win:"Ctrl-M",mac:"Cmd-M"},link:{win:"Ctrl-L",mac:"Cmd-L"},quote:{win:"Ctrl-Q",mac:"Cmd-Q"},code:{win:"Ctrl-K",mac:"Cmd-K"},image:{win:"Ctrl-G",mac:"Cmd-G"},olist:{win:"Ctrl-O",mac:"Cmd-O"},ulist:{win:"Ctrl-U",mac:"Cmd-U"},heading:{win:"Ctrl-H",mac:"Cmd-H"},rheading:{win:"Shift-Ctrl-H",mac:"Shift-Cmd-H"},moment:{win:"Ctrl-.",mac:"Cmd-."},magnet:{win:"Shift-Ctrl-M",mac:"Shift-Cmd-M"},hr:{win:"Ctrl-R",mac:"Cmd-R"},undo:{win:"Ctrl-Z",mac:"Cmd-Z"},redo:{win:"Ctrl-Y|Shift-Ctrl-Z",mac:"Cmd-Y"}},n.exports=i}}),window.requirejs.define({"views/codemirror/drop_file_event":function(e,t,n){var i,r,o;i=t("../../application"),r=function(e,t){var n;t.xsj_has_focus||(e.connectedView.commonCodeMirrorEditor.editorProxy.focus(),t.xsj_has_focus=!0),n=!1;try{if(0===t.dataTransfer.files.length)return;n=0===t.dataTransfer.files[0].type.indexOf("text")}catch(e){e,n=!0}return"appendText"!==(i.getEditorProfileModel().get("pastePlainFileMode")||"appendAttachment")?(t.xsj_drop_pos&&e.getDoc().setCursor(t.xsj_drop_pos),t.preventDefault()):n?t.stopPropagation():(t.xsj_drop_pos&&e.getDoc().setCursor(t.xsj_drop_pos),t.preventDefault()),!1},o=function(e){return e.on("drop",r)},n.exports=o}}),window.requirejs.define({"views/codemirror/editor_hover_widget":function(e,t,n){var i,r,o,a,s,l,c;a=t("../../lib/utils"),r=t("../../lib/notifier"),i=t("../../application"),c=t("../../lib/preview_core"),o=t("../single_popup_manager_view"),s=function(e,t,n){return c.getUrlInfo(e.fileModel,t,{parseClientLocalMedias:!0},(function(e,i){return n(e?t:i.url)}))},l=function(e,t){var n,l,c,u,d,p,f,h,m;return t=t||{openXSJFileFn:function(e,t){}},l=null,u=$("<div class='ui buttons icon editor_widget_buttons'></div>"),m=u[0],f=function(e){var t;if(null==e&&(e=1e3),!u.data("timeout"))return t=setTimeout((function(){return m.style.top=m.style.visibility="hidden",l&&(l.remove(),l=null),u.removeData("token"),u.removeData("target"),u.removeData("link"),u.removeData("timeout"),u.removeData("inWidget"),u.data("entered",!1)}),e),u.data("timeout",t)},p=uniqueNumber(),h=function(t,n,r){var o,c,d,f,h,m,v,g,w;switch(l&&(l.remove(),l=null),m=n,n=n.replace(/^[\.\/]*/g,""),u=$(t),c=i.getCurrentStorePluginModel(),v=e.fileModel.get("pluginName"),!1,f=a.getExt(n,3).toUpperCase(),w=a.validateUrlPath(n),u.html(""),o=function(e,t,n){if(t.editorModel.get("cm_autopreviewHoveredImage"))return l=$("<div class='image_preview_container'></div>"),e.parent().append(l),s(t,n,(function(t){var n;if(l)return(n=e.offset()).left=0,l.offset(n),l.css({left:0}),null!=l?l.append("<img src='"+t+"' />"):void 0}))},w.result){case"normal":/^http[s]?:\/\//gi.test(n)&&(u.html("<div class='ui button active icon open_target_btn' title='\u6253\u5f00\u94fe\u63a5'><i class='chrome icon'></i></div>"),!0),d=/^evernote:\/\/\/view/gi,c&&c.get("name")===v&&d.test(n)&&(u.html("<div class='ui button active icon open_evernote_target_btn' title='\u6253\u5f00\u94fe\u63a5'><i class='chrome icon'></i></div>\n<div class='ui button active icon edit_evernote_btn' title='\u7f16\u8f91\u6587\u7ae0'><i class='edit icon'></i></div>"),!0),".JPG"!==f&&".JPEG"!==f&&".PNG"!==f&&".WEBP"!==f||(u.html("<div class='ui button active icon edit_image_btn' title='\u7f16\u8f91\u56fe\u7247'><i class='file outline image icon'></i></div>"),o(u,e,n),!0);break;case"xsjurl":i.getUserModel().get("user"),".JPG"!==f&&".JPEG"!==f&&".PNG"!==f&&".WEBP"!==f||e.fileModel.hasAttachment(n)&&(u.html("<div class='ui button active icon edit_image_btn' title='\u7f16\u8f91\u56fe\u7247'><i class='file outline image icon'></i></div>"),o(u,e,n),!0),".DRAWIO"!==f&&".DRAWIO.HTML"!==f&&".DRAWIO.SVG"!==f||(u.html("<div class='ui button active icon edit_drawio_btn' title='\u7f16\u8f91\u7ed8\u56fe'><i class='object group outline icon'></i></div>"),!0),".TABLE"!==f&&".TABLE.HTML"!==f||e.fileModel.hasAttachment(n)&&(u.html("<div class='ui button active icon edit_table_btn' title='\u7f16\u8f91\u8868\u683c'><i class='table icon'></i></div>"),!0)}if(p=uniqueNumber(),g=n.lastIndexOf("#"),h="",g>=0&&(h=n.substring(g+1),n=n.substring(0,g)),n)return a.getRelatedDocs(n,{orignLink:m,fileModel:e.fileModel,app:i,dateNow:p},(function(e,t){var n,i;if(!e&&p===t.dateNow)return i=t.rows,n=[],i.forEach((function(e){if("internal"===e.type&&n.push('<div class="ui button active icon xsj_file_button" data-type=\'internal\' data-id="'+_.escape(e.id)+'" data-line="'+r+'" title="'+_.escape(e.title)+'" data-hash-tag="'+_.escape(h)+'">\n<i class="file alternate outline icon"></i>\n</div>'),"plugin"===e.type&&n.push('<div class="ui button active icon xsj_file_button" data-type=\'plugin\' data-guid="'+_.escape(e.guid)+'" data-parent-path="'+_.escape(e.parentPath)+'" title="'+_.escape(e.title)+'" data-hash-tag="'+_.escape(h)+'">\n<i class="exchange icon"></i>\n</div>'),"local"===e.type)return n.push('<div class="ui button active icon xsj_file_button" data-type=\'local\' data-path="'+_.escape(e.fullPath)+'" title="'+_.escape(e.title)+'" data-hash-tag="'+_.escape(h)+'">\n<i class="hdd outline icon"></i>\n</div>')})),u.append(n.join(""))})),!0},u.on("click",".xsj_file_button",(function(e){var n,o,a,s,l,c,u,d,p;switch(p=(n=$(e.currentTarget)).data("type"),l=n.data("hash-tag")||"",p){case"internal":if(c=n.data("id"),u=n.data("line"),c)return i.getFileCollection().getModelById(c,(function(n,i){var o;return n?r.showMessage("\u6253\u5f00\u6587\u4ef6\u5931\u8d25:"+n,6e3,"error"):i?(o=null,f(1),!e.ctrlKey&&t.openXSJFileFn&&(o=t.openXSJFileFn(i,{hashTag:l,event:e,lineNum:u})),"fallback"===o||e.ctrlKey?$(window).trigger("changeFileModel",[i,{hashTag:l,openInActiveIf:!0}]):void 0):r.showMessage("\u6253\u5f00\u6587\u4ef6\u5931\u8d25: \u627e\u4e0d\u5230\u8be5\u6587\u4ef6",6e3,"error")}));break;case"plugin":if(s=n.data("guid")+"",d=n.data("parentPath")+"",s&&(o=i.getCurrentStorePluginModel(),i.getPlugin(o)))return $(window).trigger("importFileByPlugin",[o,s,d||"",{},function(){}]);break;case"local":if(a=n.data("path"))return $(window).trigger("importFileByPath",[a])}})),u.on("click",".open_evernote_target_btn",(function(){var e,t,n,r,o,a,s,l,c;if(u.data("link")){if(r=(o=(o=u.data("link")).replace(/[\/]*$/,"")).substring(o.lastIndexOf("/")+1),n=(e=i.getCurrentStorePluginModel()).get("extraInfo"),a=e.get("name"),c=null,n)try{n=JSON.parse(n)}catch(e){t=e,console.log(t)}return n&&((c=n.edam_webApiUrlPrefix)||(s=n.shardId)&&("yinxiang"===a?c="https://app.yinxiang.com/shard/"+s+"/":"evernote"===a&&(c="https://www.evernote.com/shard/"+s+"/"))),c?(l=c+"view/notebook/"+r,"client"===STORY_PLATFORM?require("nw.gui").Shell.openExternal(l):window.open(l,"_blank")):void 0}})),u.on("click",".edit_evernote_btn",(function(){var t,n,o,a,s;if(u.data("link")){if(a=(a=u.data("link")).replace(/[\/]*$/,""),o=a.substring(a.lastIndexOf("/")+1),t=e.fileModel.get("guid"),o!==t)return n=i.getCurrentStorePluginModel(),(s=i.getPlugin(n))?(i.homeView.showLoader(null,"\u6587\u7ae0\u52a0\u8f7d\u4e2d"),s.getFileMeta({},{guid:o,parentPath:""},(function(e,t){return e?(i.homeView.hideLoader(null),r.showMessage("\u6253\u5f00\u6587\u4ef6\u51fa\u9519:"+e,6e3,"error")):$(window).trigger("importFileByPlugin",[n,o,t.parentPath||"",{},function(){}])}))):void 0;r.showMessage("\u8be5\u94fe\u63a5\u6307\u5411\u7684\u6587\u7ae0\u4e3a\u5f53\u524d\u6b63\u5728\u4fee\u6539\u7684\u6587\u7ae0",6e3,"warning")}})),u.on("click",".edit_table_btn",(function(){var t;if(u.data("link"))return t=u.data("link"),o.showPopupView("table",{fileModel:e.fileModel,link:t}),!0})),u.on("click",".open_target_btn",(function(){var e;if(u.data("link"))return e=u.data("link"),openTarget(e),!0})),u.on("click",".edit_image_btn",(function(){var t;if(u.data("link"))return t=u.data("link"),o.showPopupView("image",{fileModel:e.fileModel,link:t,operateType:"save"}),!0})),u.on("click",".edit_drawio_btn",(function(){var t;if(u.data("link"))return t=u.data("link"),o.showPopupView("drawio",{fileModel:e.fileModel,link:t}),!0})),e.addWidget({line:0,ch:0},m,!0),m.style.position="absolute",m.style.zIndex=1e5,m.style.visibility="hidden",m.style.top=m.style.left="-1000px",u.removeData("token"),u.removeData("target"),u.removeData("link"),d=e.getWrapperElement(),n=$(d),c=$(e.display.lineDiv),u.on("mousemove",(function(e){var t;return u.data("inWidget",!0),u.data("timeout")&&clearTimeout(u.data("timeout")),t=setTimeout((function(){return u.data("timeout",null),u.data("inWidget",!1)}),200),u.data("timeout",t)})),u.on("click",(function(e){var t;return u.data("timeout")&&clearTimeout(u.data("timeout")),t=setTimeout((function(){return u.data("timeout",null),u.data("inWidget",!1)}),200),u.data("timeout",t)})),c.on("mousemove",_.debounce((function(t){var i,r,o,s,l,c,d,p,v,g;return g=t.target,c=(i=$(g)).hasClass("cm-url"),d=g===m||m.contains(g)||!0===u.data("inWidget"),l=g.innerText,h.timeout?(clearTimeout(h.timeout),void(h.timeout=null)):(d||!c||l===u.data("token")&&g===u.data("target")?d||g===m||m.contains(g)?(u.data("timeout")&&(clearTimeout(u.data("timeout")),u.removeData("timeout")),u.data("entered",!0)):c||"hidden"===m.style.visibility||f():(0,r=i.closest(".CodeMirror-line"),o=r[0].dataset.line||0,l=function(e){var t,n,i,r;for(r=[g.innerText],i=e.previousSibling,n=e.nextSibling,100,t=0;t<100&&i&&1===i.nodeType&&i.classList.contains("cm-url");)t++,r.unshift(i.innerText),i=i.previousSibling;for(;t<100&&n&&1===n.nodeType&&n.classList.contains("cm-url");)t++,r.push(n.innerText),n=n.nextSibling;return r.join("")}(g),s="",i.hasClass("cm-wikilink-url")?(p=(s=$.trim(l.replace(/^[\(\[]*|[\)\]]*$/g,""))).lastIndexOf("|"))>0&&(s=s.substring(0,p)):((v=/\[(.*?)\]/g).test(l)&&l.replace(v,(function(t,n){var i,r;if(n&&(i=e.getDoc().getValue(),r=a.getReference(i,n)))return l=r})),s=(s=$.trim(l.replace(/^[\(\[]*|[\)\]]*$/g,""))).split(" ")[0]),h.timeout=setTimeout((function(){var t,r,a,c;if(h.timeout=null,h(m,s,o))return a=e.getScrollerElement().scrollTop,t=n.offset(),r={left:(c=i.offset()).left-t.left,bottom:c.top+i.height()-t.top+a},u.data("timeout")&&(clearTimeout(u.data("timeout")),u.removeData("timeout")),m.style.visibility="visible",m.style.left=r.left+"px",m.style.top=r.bottom+"px",u.data("token",l),u.data("target",g),u.data("link",s)}),200)),!0)}),200))},n.exports=l}}),window.requirejs.define({"views/codemirror/editor_selection_popup_view":function(e,t,n){var i,r,o,a,s,l,c={}.hasOwnProperty;i=t("../../application"),a=t("../../lib/utils"),s=t("../../lib/utils_color"),o=t("../../lib/notifier"),l=function(e){var t,n,i,r;return t={html:!0,xhtmlOut:!0,breaks:!1,linkify:!0,typographer:!0},(n=window.markdownit(t)).use(window.markdownitWikilink),n.use(window.markdownitMark),i=n.renderInline(e),r=a.stripScripts(i),(r=a.stripStyles(r.innerHTML)).innerText},r=function(e){var t,n,r;function u(){return u.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)c.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(u,Backbone.View),u.prototype.className="editor_selection_tippy_popup_container",u.prototype.tippyPopup=null,u.prototype.initialize=function(e){return this.tippyPopup=e.tippyPopup},u.prototype.events={"click .editor_selection_mark_btn":"markSelectionFn","click .create_book_btn":"createBookFn","click .create_reference_btn":"createReferenceFn"},u.prototype.markSelectionFn=function(e){var t;return t=$(e.currentTarget).data("color"),$("#wmd-mark-button").trigger("click",{color:t}),this._showMarkListTourFn()},u.prototype._showProtocolRegistryFn=function(e){var t,n,r,o,a,s;if(s=i.getTourModel(),o=!1,"client"===STORY_PLATFORM&&s.canPrompt("protocol_registry_learned")){if("darwin"===process.platform)return;o=!0}if("development"===ENV&&s.canPrompt("protocol_registry_learned")&&(o=!0),o)return r=e.pageX,a=e.pageY,n=$('<div class="spotlight_container" style="\nbackground: radial-gradient(circle at '+r+"px "+a+'px, transparent 180px, rgba(0, 0, 0, 0.4) 182px, rgba(0, 0, 0, 0.9) 900px);\n"></div>'),t=$('<div style="position:absolute;left:'+r+"px;top: "+a+'px;z-index:100;">\n  <kbd>\u5c0f\u4e66\u5320\u4e3b\u6309\u94ae \u300b\u8bbe\u7f6e \u300b\u57fa\u672c \u300b\u534f\u8bae\u5524\u9192</kbd>\n</div>'),$("body").append(t),t.popup({on:"manual",closable:!1,onVisible:function(){var e;return t.css({outline:"3px solid var(--negativeColor)",outlineOffset:"2px",background:"var(--defaultBackground)",transform:"scale(2.5)",transition:"transform 1s, outline 1s"}),$("body").append(n),(e=this).width(300),e.find(".ok").click((function(){return n.remove(),t.popup("destroy"),s.dontPrompt("protocol_registry_learned"),e.remove(),t.remove()}))},html:'<div class="header">\u63d0\u793a</div><div class="content">\u5f00\u542f\u534f\u8bae\u5524\u9192\u540e\uff0c\u5c31\u53ef\u4ee5\u5728\u5916\u90e8\u5e94\u7528\u4e0a\uff0c\u76f4\u63a5\u7528 xsjapp:// \u534f\u8bae\uff0c\u5b9a\u4f4d\u5230\u5f53\u524d\u5f15\u7528\u4f4d\u7f6e\u4e0a\u3002<div><a href="javascript:void(0);" class="ok pull-right">\u77e5\u9053\u4e86</a></div></div>'}).popup("show")},u.prototype._showMarkListTourFn=function(){var e,t,n,r,o,s,l,c,u;if(u=i.getTourModel(),"web"===STORY_PLATFORM&&u.canPrompt("mark_list_window_learned")){if(!(n=$(".mark_list_button")).visible())return;if(r=this.tippyPopup.cm,!(s=a.getMarkInfo(r.getValue())))return;if(s.marks.length<2)return;return(e=$(".editor_buttons_wrapper")).css("opacity",1),o=(l=n[0].getBoundingClientRect()).x+l.width/2,c=l.y+l.height/2,t=$('<div class="spotlight_container" style="\nbackground: radial-gradient(circle at '+o+"px "+c+'px, transparent 180px, rgba(0, 0, 0, 0.4) 182px, rgba(0, 0, 0, 0.9) 900px);\n"></div>'),n.popup({on:"manual",closable:!1,position:"bottom left",onVisible:function(){var i;return n.css({color:"var(--negativeColor)",outline:"3px solid var(--negativeColor)",outlineOffset:"2px",transform:"scale(2.5) rotate(-15deg)",transition:"transform 1s, outline 1s"}),$("body").append(t),(i=this).width(300),i.find(".ok").click((function(){return t.remove(),n.popup("destroy"),u.dontPrompt("mark_list_window_learned"),i.remove(),e.css("opacity",""),n.css({color:"",outline:"",outlineOffset:"",transform:""})}))},html:'<div class="header">\u63d0\u793a</div><div class="content">\u70b9\u51fb\u8fd9\u91cc\uff0c\u53ef\u4ee5\u6253\u5f00\u6587\u7ae0\u7684\u9ad8\u4eae\u6e05\u5355\u5217\u8868<div><a href="javascript:void(0);" class="ok pull-right">\u77e5\u9053\u4e86</a></div></div>'}).popup("show")}},t=function(e){return e=e.replace(/[\n\(\)\[\]\s]*/g,"")},n=function(e,t){var n,i,r,o,a,s,c;return r='<a class="xsj_anchor xsj_anchor_range xsj_anchor_range_start" name="'+(i="xsj_"+uniqueNumber())+'"></a>',n='<a class="xsj_anchor xsj_anchor_range xsj_anchor_range_end" name="'+i+'"></a>',o=t.anchor,c=t.head,CodeMirror.cmpPos(t.anchor,t.head)>0&&(o=t.head,c=t.anchor),0===o.ch&&(r+="\n"),0===c.ch&&(n+="\n"),a=e.getRange(o,c),s=l(a),e.replaceRange(r+a+n,o,c),"["+(s=(s=s.replace(/[\n\(\)\[\]\s]*/g,"")).substring(0,10))+"...](xsjapp://doc/"+e.fileModel.id+"#"+i+")",{orignRangeStr:a,rangeStr:s,anchorId:i}},u.prototype.createBookFn=function(e){var i,r,a,s,l;if(this.tippyPopup.cm&&this.tippyPopup&&this.tippyPopup.range)return a=this.tippyPopup.cm,s=(i=n(a,this.tippyPopup.range)).orignRangeStr.split("\n").map((function(e){return"> "+e})).join("\n"),l=a.fileModel.get("title"),l=t(l),r="\n>\n"+s+"\n> \n> ["+l+"](xsjapp://doc/"+a.fileModel.id+"#"+i.anchorId+")\n> \n",$(document).one("copy",(function(e){return e.preventDefault(),e.stopPropagation(),e.originalEvent.clipboardData.setData("text/plain",r),o.showMessage("\u7b14\u8bb0\u590d\u5236\u6210\u529f"),a.focus()})),document.execCommand("copy")},u.prototype.createReferenceFn=function(e){var i,r,a,s;if(this.tippyPopup.cm&&this.tippyPopup&&this.tippyPopup.range)return a=this.tippyPopup.cm,i=n(a,this.tippyPopup.range),s=a.fileModel.get("title"),s=t(s),r="["+s+"](xsjapp://doc/"+a.fileModel.id+"#"+i.anchorId+")",$(document).one("copy",(function(e){return e.preventDefault(),e.stopPropagation(),e.originalEvent.clipboardData.setData("text/plain",r),o.showMessage("\u5f15\u7528\u590d\u5236\u6210\u529f"),a.focus()})),document.execCommand("copy"),this._showProtocolRegistryFn(e)},r=function(){var e,t;return e=s.getUserColors(),t=[],e.forEach((function(e){return t.push('<span class="editor_selection_mark_btn" data-color="'+e+'" style="color: '+e+'"><i class="square full icon link"></i></span>')})),t.push('<span class="editor_selection_mark_btn editor_selection_placeholder_mark_btn" data-color="#000000" title="\u6316\u7a7a\u6548\u679c"><i class="lightbulb outline icon link"></i></span>'),'<div class="editor_selection_mark_btns_container">'+t.join("")+"</div>"},u.prototype.render=function(){return this.$el.html(r()+'\n<div class="ui buttons icon fluid">\n  <div class="ui button create_book_btn">\n   <i class="book icon"></i>\n   \u7b14\u8bb0\n  </div>\n  <div class="ui button create_reference_btn">\n   <i class="linkify icon"></i>\n   \u5f15\u7528\n  </div>\n</div>')},u}(),n.exports=r}}),window.requirejs.define({"views/codemirror/line_codemirror_widget_view":function(e,t,n){var i,r,o,a,s,l,c,u,d={}.hasOwnProperty;o=t("../view"),r=t("../../lib/utils"),i=t("../../application"),a=t("./common_codemirror_editor"),u=t("./editor_hover_widget"),c=t("./drop_file_event"),l=t("./auto_suggest_event"),s=function(e,t){return null==t&&(t={}),function(n){var o,s,p,f,h,m;function v(){return v.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)d.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(v,n),v.prototype.editor=null,v.prototype.fileModel=null,v.prototype.editorView=null,v.prototype.commonCodeMirrorEditor=null,v.prototype.el=e,o=!1,m=null,s=null,f=null,p="default",v.prototype.changeFileModel=function(e){return this.fileModel=e,this.editor.changeFileModel(e)},v.prototype.destroy=function(){if(s&&s(),this.commonCodeMirrorEditor.connectedView=null,this.commonCodeMirrorEditor.destroy(),this.editor.setOption("searchbox",!1),this.editor.xsjDestroy(),$(window).off("sidebarHidden",m),m=null,this.remove(),f)return f()},v.prototype.initialize=function(e){var t,n,i;return this.fileModel=e.fileModel,s=e.beforeDestroyCallback,f=e.destroyCallback,t=e.commonCodeMirrorEditor,this.editorView=t.editorView,n=h(this.$el.find(".codemirror_editor")[0],this.fileModel,this.model,this),this.editor=n,this.commonCodeMirrorEditor=a(n,this.editorView),this.commonCodeMirrorEditor.addCommands(this.editorView.getCommands()),this.commonCodeMirrorEditor.bindUserKeyBoard(this.editorView.getBindInfos()),this.commonCodeMirrorEditor.parentEditor=t,this.commonCodeMirrorEditor.connectedView=this,t.childrenEditors.push(this.commonCodeMirrorEditor),this.setEditorConfig(),this.listenTo(this.model,"change:bindInfos",(i=this,function(){return i.commonCodeMirrorEditor.bindUserKeyBoard(i.editorView.getBindInfos())})),this.listenTo(this.model,"change",function(e){return function(){return o=!0,e.setEditorConfig()}}(this)),this.listenTo(this.model,"refreshEditorProfile",function(e){return function(){return e.setEditorConfig()}}(this)),m=function(){var e;if(n&&o)return e=n.getOption("lineNumbers"),n.setOption("lineNumbers",!e),n.setOption("lineNumbers",e),o=!1},$(window).on("sidebarHidden",m)},h=function(e,t,n,o){var a;return(a=CodeMirror.fromTextArea(e,{mode:CodeMirror.createXSJCodeMirrorMode((function(){return{fileModel:o.fileModel,app:i,editorModel:o.model}})),extraKeys:{Enter:"newlineAndIndentContinueMarkdownList",Tab:"tabAndIndentMarkdownList","Shift-Tab":"shiftTabAndUnindentMarkdownList"},modeLoader:!0,dragDrop:!0,foldGutter:!0,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"],highlightSelectionMatches:{showToken:!1,annotateScrollbar:!0},maxInvisibles:16,searchbox:!0,lineWrapping:!0,inputStyle:r.isMobileDevice()?"contenteditable":"textarea"})).initXSJApp(i,t,n,o),u(a,{openXSJFileFn:function(e,t){var n;return n=r.getCursorByHashTag(t.hashTag,e.get("content")),$(window).trigger("createNewEditor",[e,{initCursor:n}])}}),c(a),l(a),a},v.prototype.setEditorConfig=function(){var e,n,r,o,a,s,l,c,u;this.editor.startOperation(),this.editor.setOption("lineWrapping",this.model.get("cm_lineWrapping")),CodeMirror.optionHandlers.autoCloseBrackets&&this.editor.setOption("autoCloseBrackets",this.model.get("cm_autoCloseBrackets")),CodeMirror.optionHandlers.autoCloseTags&&this.editor.setOption("autoCloseTags",this.model.get("cm_autoCloseBrackets")),CodeMirror.optionHandlers.matchBrackets&&this.editor.setOption("matchBrackets",!0),CodeMirror.optionHandlers.matchTags&&this.editor.setOption("matchTags",!0),this.editor.setOption("inputOffsetTopWithCursor",this.model.get("cm_inputOffsetTop")),this.editor.setOption("spellCheckerAffUrl","media/en_US.aff"),this.editor.setOption("spellCheckerDicUrl","media/en_US.dic"),u=this.model.get("cm_spellChecker"),this.editor.setOption("spellChecker",u),s=this.model.get("cm_markerColorpicker"),r=i.getApplicationProfileModel(),s?this.editor.setOption("colorpicker",{type:"sketch",onColorSetsChanged:function(e){return null==e&&(e=[]),r.set("cmColorpickerColorSets",e.join("|")),r.save()},colorSets:function(){var e,t;return t=[],(e=$.trim(r.get("cmColorpickerColorSets"))||"")&&(t=e.split("|")),[{colors:t,name:"Input Colors",edit:!0}]},mode:"edit"}):this.editor.setOption("colorpicker",!1),a=this.model.get("cm_lineNumbers"),t.hasOwnProperty("lineNumbers")&&(a=t.lineNumbers),this.editor.setOption("lineNumbers",a),n=$(this.editor.getGutterElement()),a?n.removeClass("no_linenumers"):n.addClass("no_linenumers"),e=$(this.editor.getWrapperElement()),o=this.model.get("cm_keyBinding")||"default","default"!==p&&this.editor.removeKeyMap(CodeMirror.keyMap[p]||p),"default"!==o&&this.editor.addKeyMap(o),p=o,this.editor.setOption("keyMap",this.model.get("cm_keyBinding")||"default"),this.editor.setOption("typewriterScrolling",this.model.get("cm_typewriterScrolling")),l=this.model.get("fontSize")||16,(c=this.model.get("lineHeight"))||(c=1.4*l/16),e.css("fontSize",l+"px"),e.css("lineHeight",c),this.editor.setOption("styleActiveLine",this.model.get("cm_highlightActive")),this.editor.setOption("activeCursorMathjax",this.model.get("cm_activeCursorMathjax")),this.editor.setOption("styleStackFocusLine",this.model.get("cm_styleStackFocusLine")),this.editor.setOption("showInvisibles",this.model.get("cm_showInvisibles")),this.editor.setOption("smartIndent",this.model.get("cm_smartIndent")),this.editor.setOption("indentWithTabs",this.model.get("cm_indentWithTabs")),this.editor.setOption("tabSize",this.model.get("cm_tabSize")||4),this.editor.setOption("indentUnit",this.model.get("cm_tabSize")||4),this.editor.setOption("typewriterScrolling",this.model.get("cm_typewriterScrolling")),this.editor.endOperation(),this.editor.refresh()},v}(o)},n.exports=s}}),window.requirejs.define({"views/codemirror/popup_editor_file_tab_view":function(e,t,n){var i,r,o,a,s,l={}.hasOwnProperty;i=t("../../application"),r=t("../../lib/notifier"),a=t("../view"),o=t("./popup_editor_tour_utils"),s=function(){return function(e){var t,n;function a(){return a.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)l.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(a,e),a.prototype.className="link item file_item droppable_file_item",n=null,t=null,a.prototype.events={click:"tabClickFn","click .remove_button":"closeTabFn"},a.prototype.closeTabFn=function(e){return e.preventDefault(),e.stopPropagation(),t(e,n)},a.prototype.tabClickFn=function(e){var t;if(t=$(e.currentTarget),!o.showTourFn(t))return i.getFileCollection().getModelById(n.id,(function(e,t){return e?r.showMessage("\u6253\u5f00\u6587\u4ef6\u5931\u8d25:"+e,6e3,"error"):t?$(window).trigger("changeFileModel",[t,{openInActiveIf:!0,scrollTo:!1}]):r.showMessage("\u6253\u5f00\u6587\u4ef6\u5931\u8d25: \u627e\u4e0d\u5230\u8be5\u6587\u4ef6",6e3,"error")}))},a.prototype.initialize=function(e){return null==e&&(e={}),n=e.fileModelInfo,t=e.closeTabCallbackFn},a.prototype.afterRender=function(){return this.$el.attr("title",n.title),this.model&&(n.emoji=this.model.get("emoji")||n.emoji,n.title=this.model.get("title")||n.title),this.$el.html('<i class="icon remove remove_button"></i>\n<span class="file_emoji">'+(n.emoji||"")+"</span>"+_.escape(n.title)+"\n</div>"),this.$el.data("fileModelInfo",n)},a.prototype.initDraggable=function(){return this.$el.draggable({scope:"files",scroll:!1,cursor:"move",addClasses:!1,appendTo:"body",helper:"clone",delay:150,distance:5,iframeFix:!0,zIndex:1e4})},a.prototype.remove=function(){return this.stopListening(this.model),a.__super__.remove.call(this)},a.prototype.setModel=function(e){var t;if(e&&(this.model&&this.model.cid!==e.cid&&(this.stopListening(this.model),this.model=null),!this.model))return this.model=e,t=this,n.title=e.get("title"),n.emoji=e.get("emoji"),this.$el.html('<i class="icon remove remove_button"></i>\n<span class="file_emoji">'+(this.model.get("emoji")||"")+"</span>"+_.escape(this.model.get("title"))+"\n</div>"),this.listenTo(this.model,"change:title change:emoji",(function(e){return n.title=e.get("title"),n.emoji=e.get("emoji"),t.$el.attr("title",e.get("title")),t.$el.html('<i class="icon remove remove_button"></i>\n<span class="file_emoji">'+(n.emoji||"")+"</span>"+_.escape(n.title)+"\n</div>")}))},a}(a)},n.exports=s}}),window.requirejs.define({"views/codemirror/popup_editor_file_tabs_view":function(e,t,n){var i,r,o,a,s,l,c={}.hasOwnProperty;i=t("../../application"),o=t("../../lib/notifier"),a=t("../view"),r=t("../exports/utils"),s=t("./popup_editor_file_tab_view"),l=function(){return function(e){var t,n,a,l,u,d,p;function f(){return f.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)c.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(f,e),f.prototype.className="popup_editor_file_tabs",f.prototype.fileModel=null,d=null,a=[],t=null,u={},f.prototype.initialize=function(e){return null==e&&(e={}),e.fileTabs&&e.fileTabs.forEach((function(e){return a.push({id:e.id,title:e.name,emoji:e.emoji})})),d=e.popupEditorWindowView},n=function(){var e;return e="#window_"+d.getWindow().uniqueId+" .popup_editor_file_tabs .popup_editor_file_tabs_menu",$.contextMenu("destroy",e)},l=function(e){var t,n,s;return t=null,s=d.getWindow().uniqueId,n="#window_"+s+" .popup_editor_file_tabs .popup_editor_file_tabs_menu",$.contextMenu({selector:n,reposition:function(e){var i;return i=(i=$(e)).parentsUntil(n,n+">.item"),!(!t||!t.is(i))},trigger:"right",zIndex:10,build:function(s,l){var c,u,d,p;if(t=$(l.target),!(u=t.data("fileModelInfo"))){if((t=t.parentsUntil(n,n+">.item")).length<=0)return!1;u=t.data("fileModelInfo")}return!!u&&(p=function(e){var t,n;return t=i.getFileCollection(),n=null,t.getModelById(u.id,(function(t,i){return t?o.showMessage("\u6253\u5f00\u6587\u4ef6\u5931\u8d25:"+t,6e3,"error"):i?e?$(window).trigger("createNewEditor",[i,{groupId:n,callback:function(e,t){var i;if(n=e.id,i=t.$el.find(".popup_editor_file_tabs .file_item.droppable_file_item.active")[0])return appHighlightPosByEl(i)}}]):$(window).trigger("changeFileModel",[i]):o.showMessage("\u6253\u5f00\u6587\u4ef6\u5931\u8d25: \u627e\u4e0d\u5230\u8be5\u6587\u4ef6",6e3,"error")}))},(d={copyAsLink:{icon:"fas fa-link",name:"\u590d\u5236\u4e3a\u94fe\u63a5",callback:function(){var e,t;return t="xsjapp://doc/"+u.id,e="["+u.title+"]("+t+")",$(document).one("copy",(function(t){return t.preventDefault(),t.stopPropagation(),t.originalEvent.clipboardData.setData("text/plain",e),o.showMessage("\u590d\u5236\u94fe\u63a5\u6210\u529f")})),document.execCommand("copy")}}}).openAsMainEditor={icon:"fas fa-columns",name:"\u5728\u9762\u677f\u7f16\u8f91\u5668\u6253\u5f00",callback:function(){return p(!1)}},d.openAsNewPopup={icon:"far fa-window-restore",name:"\u5728\u65b0\u6d6e\u52a8\u7f16\u8f91\u5668\u6253\u5f00",callback:function(){return p(!0)}},c=r.getExportContextMenuItemsFn(e.fileModel,a),d.export={name:"\u5bfc\u51fa...",items:c},{items:d})}})},f.prototype.getFileModelIds=function(){return a.map((function(e){return e.id}))},f.prototype.afterRender=function(){return this.$el.html('<div class="popup_editor_file_tabs_menu_wrapper">\n  <div class="ui vertical menu popup_editor_file_tabs_menu sortable_file_tabs_area"></div>\n</div>'),p(this,a),this.initSortable(),l(this)},f.prototype.initSortable=function(){var e;return e=this,this.$el.find(".popup_editor_file_tabs_menu_wrapper>.menu").sortable({appendTo:"body",connectWith:".sortable_file_tabs_area",scroll:!1,tolerance:"pointer",placeholder:{element:function(e){var t;return t=$.trim(e.text()),$('<div class="droppable_file_item ui-sortable-placeholder dragging_file_item ui-draggable-dragging chrome-tab chrome-tab-file">\n<div class="chrome-tab-favicon">\n  <i class="file alternate outline icon"></i>\n</div>\n<div class="chrome-tab-title">'+_.escape(t)+'</div>\n<div class="chrome-tab-curves">\n  <div class="chrome-tab-curves-left-shadow"></div>\n  <div class="chrome-tab-curves-left-highlight"></div>\n  <div class="chrome-tab-curves-left"></div>\n  <div class="chrome-tab-curves-right-shadow"></div>\n  <div class="chrome-tab-curves-right-highlight"></div>\n  <div class="chrome-tab-curves-right"></div>\n</div>\n</div>')},update:function(){}},helper:function(e,t){var n,i;return $(".dragging_file_item").remove(),$("body").addClass("iframe_dimmer xsj_dragging_item"),i=t.data("fileModelInfo"),(n=$('<div class="dragging_file_item"></div>')).html(i.title),n.data("itemInfo",{id:"file_"+i.id,title:i.title,activeFile:i.id,emoji:i.emoji,type:"file"})},delay:150,distance:5,zIndex:1e4,out:function(t,n){return e.trigger("tabDragOut")},over:function(t,n){return e.trigger("tabDragOver")},drop:function(t,n){return e.trigger("tabDragDrop")},start:function(t,n){return setTimeout((function(){return $(".sortable_file_tabs_area").sortable("refreshPositions")}),1e3),e.trigger("tabDragStart")},stop:function(t,n){if($("body").removeClass("iframe_dimmer xsj_dragging_item"),e.trigger("tabDragStop"),n.helper)return n.helper.remove()},update:function(t,n){var i,r;if(n&&n.item&&n.item[0]&&n.item[0].parentElement&&((i=n.item).addClass("dropped_file_item"),appHighlightPosByEl(i[0]),setTimeout((function(){return i.removeClass("dropped_file_item")}),1e3)),(r=$(this)).sortable("toArray").length===a.length)return a=[],r.find(".file_item").each((function(e,t){return a.push($(t).data("fileModelInfo"))})),a.reverse(),e.trigger("tabFilesChanged",a)},remove:function(t,n){var i,r,o;return i=n.item,r=i.data("fileModelInfo"),a=a.filter((function(e){return e.id!==r.id})),i.data("itemInfo",{id:"file_"+r.id,type:"file",activeFile:r.id,emoji:r.emoji,title:r.title}),o=u[r.id],n.item.data("xsjSortableItem",o),delete u[r.id],e.trigger("tabFilesChanged",a)},receive:function(t,n){var i,r,o,s;if(e.trigger("tabDragReceive"),s=n.item.data("xsjSortableItem"),o=n.helper,s)r=s.$el.data("itemInfo"),o=n.item;else{if(!n.helper)return;r=n.helper.data("itemInfo")}return(i=a.find((function(e){return e.id===r.activeFile})))?(u[i.id].remove(),delete u[i.id]):(i={id:r.activeFile,title:r.title,emoji:r.emoji},a.push(i)),p(e,[i],o).forEach((function(e){return e.addClass("dropped_file_item"),appHighlightPosByEl(e[0]),setTimeout((function(){return e.removeClass("dropped_file_item")}),1e3)})),s&&(n.item.data("xsjSortableItem",""),s.remove(),s=null),e.refresh()}})},f.prototype.changeFileModel=function(e){var n;if(e&&e!==this.fileModel)return this.fileModel=e,(n=a.find((function(t){return t.id===e.id})))||(n={id:e.id,title:e.get("title"),emoji:e.get("emoji")},a.push(n),p(this,[n]),this.trigger("tabFilesChanged",a)),this.trigger("tabActiveFileChanged",n,e),t=n,this.refresh(),n},p=function(e,t,n){var i;return i=[],t.forEach((function(t){var r,o;return r=s(),o=new r({fileModelInfo:t,closeTabCallbackFn:function(){return a=a.filter((function(e){return e.id!==t.id})),delete u[t.id],o.remove(),e.trigger("tabFilesChanged",a)}}),u[t.id]=o,o.render(),n?n.replaceWith(o.$el):e.$el.find(".popup_editor_file_tabs_menu_wrapper>.menu").prepend(o.$el),i.push(o.$el)})),i},f.prototype.remove=function(){var e;if(n(),this.$el.find(".popup_editor_file_tabs_menu_wrapper>.menu").sortable("destroy"),u)for(e in u)u[e].remove();return u={},d=null,f.__super__.remove.apply(this,arguments)},f.prototype.refresh=function(){var e,n;if((e=this.$el.find(".file_item.active")).removeClass("active"),t){if(!(n=u[t.id]))return;if(n.setModel(this.fileModel),(e=n.$el).addClass("active"),!e.visible())return this.$el.scrollTo(e)}},f}(a)},n.exports=l}}),window.requirejs.define({"views/codemirror/popup_editor_tour_utils":function(e,t,n){var i,r,o;r=t("../../lib/utils_leader_line"),i=t("../../application"),o={showTourFn:function(e){var t,n,o,a,s,l,c,u,d,p,f;if((f=i.getTourModel()).canPrompt("group_tab_draggable_learned")&&$(".main_west_wrapper .file-browser-panel").visible())return(t=$("body")).addClass("xsj_dragging_item"),s=e,a=$(".main_west_wrapper .file-browser-panel"),(n=$(".main_tabs_toolbar")).find(".chrome-tab-current")[0].getBoundingClientRect(),d=n[0].getBoundingClientRect(),u=a[0].getBoundingClientRect(),l=(c=s[0].getBoundingClientRect()).x+c.width/2,p=c.y+c.height/2,o=$('<div class="spotlight_container" style="\nbackground: radial-gradient(circle at '+l+"px "+p+'px, transparent 180px, rgba(0, 0, 0, 0.4) 182px, rgba(0, 0, 0, 0.9) 900px);\n">\n  <div class="horizontal_tabs" style="position: absolute;left:'+d.left+"px;top: "+d.top+"px;width: "+d.width+"px;height:"+d.height+'px;border: 2px solid var(--infoColor);">\n    <div class="horizontal_tab" style="position:absolute;left:30px;top:0px;width:100px;height:'+(d.height-4)+'px;outline: 3px dotted var(--positiveColor);outline-offset:-4px;"></div>\n  </div>\n  <div class="store_tabs" style="position:absolute;left:0; top:'+u.top+"px;width: "+u.width+"px;height:"+u.height+'px;border: 2px solid var(--infoColor);">\n    <div class="store_tab" style="position:absolute;left:0; top:'+(u.top+20)+"px;width: "+(u.width-5)+'px;height:50px;outline: 3px dotted var(--positiveColor);outline-offset:-4px;"></div>\n  </div>\n  <div class="group_tabs" style="position:absolute;left: '+(c.left-4)+"px;top:"+(c.top-c.height)+"px;width: "+(c.width+4)+"px;height:"+3*c.height+'px;border: 2px solid var(--infoColor);">\n  </div>\n</div>'),s.popup({on:"manual",closable:!1,position:"bottom left",onVisible:function(){var e;return s.css({outline:"2px solid var(--negativeColor)",outlineOffset:"-2px"}),r.showLeaderLine([o.find(".store_tab"),o.find(".horizontal_tab"),s],[s,o.find(".horizontal_tab")],{hideOther:!1}),t.append(o),(e=this).width(300),e.find(".ok").click((function(){return r.hideLeaderLine(),s.css({outline:"",outlineOffset:""}),t.removeClass("xsj_dragging_item"),o.remove(),s.popup("destroy"),f.dontPrompt("group_tab_draggable_learned"),e.remove()}))},html:'<div class="header">\u63d0\u793a</div><div class="content">\u6309\u4f4f\u6587\u7ae0\u9879\uff0c\u7136\u540e\u62d6\u62fd\u9f20\u6807\uff0c\u60a8\u5c31\u53ef\u4ee5\u5728<strong>\u9875\u7b7e\u680f</strong>,<strong>\u6587\u7ae0\u5217\u8868\u533a</strong>\u53ca<strong>\u6d6e\u52a8\u7f16\u8f91\u5668\u9875\u7b7e\u7ec4</strong>\u4e4b\u95f4\u62d6\u62fd\u6587\u7ae0\u3002<div><a href="javascript:void(0);" class="ok pull-right">\u77e5\u9053\u4e86</a></div></div>'}).popup("show"),!0}},n.exports=o}}),window.requirejs.define({"views/codemirror/selection_tippy_event":function(e,t,n){var i;i=null,n.exports=function(e){var n,r,o,a,s,l,c,u;return n=t("./editor_selection_popup_view"),u=null,l=null,c=null,o=_.debounce((function(t,n,r){if(l=t,c=r||e,u)return i.range=n,i.cm=c,u.show()}),600),s=function(){if(o.cancel(),u)return u.hide()},(a=new n({tippyPopup:i={show:o,hide:s}})).render(),r=e.display.wrapper,u=tippy(r,{content:a.el,allowHTML:!0,appendTo:function(){return document.body},getReferenceClientRect:function(){var e;return l&&c&&(e=c.charCoords(l))?(e.width=10,e.height=10,e):null},onShow:function(e){var t,n,r,o;if(c)return a.render(),t=(r=i.range).anchor,o=r.head,n=c.getRange(t,o),CodeMirror.cmpPos(t,o)>0&&(n=c.getRange(o,t)),n.indexOf("\n")>=0?e.popper.classList.add("multiple_line_selection_tippy"):e.popper.classList.remove("multiple_line_selection_tippy")},arrow:!1,delay:[500,500],trigger:"manual",interactive:!0}),e.on("beforeSelectionChange",(function(e,t){return"*mouse"===t.origin&&t.ranges&&t.ranges[0]&&!t.ranges[0].empty()&&i?(l=t.ranges[0].head,void i.show(l,t.ranges[0],e)):i?i.hide():void 0})),e.on("scroll",(function(){if(i)return i.hide()}))}}}),window.requirejs.define({"views/codemirror_editor_view":function(e,t,n){var i,r,o,a,s,l,c,u,d,p,f,h,m,v,g,w,y,b=function(e,t){for(var n in t)x.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e},x={}.hasOwnProperty;s=t("./view"),o=t("../lib/utils"),a=t("../lib/utils_size"),t("../lib/notifier"),i=t("../application"),v=t("../lib/editor/base_codemirror_editor"),h=t("./codemirror/editor_hover_widget"),f=t("./codemirror/drop_file_event"),p=t("./codemirror/auto_suggest_event"),m=t("./codemirror/selection_tippy_event"),u=t("./codemirror/create_inline_editor"),t("./codemirror/create_new_inline_editor"),c=t("./codemirror/create_freeze_editor"),l=t("./codemirror/common_codemirror_editor"),y=t("./templates/codemirror_editor"),g=function(e){var t,n;if(e)return t=function(e){return".ace_editor, .codemirror_editor_wrapper .CodeMirror-line, .light_editor{font-family: "+e+"'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', 'source-code-pro', 'Courier', 'Lucida Console', monospcodemirror}"},n=o.parseCssText(t(e+", "),t("")),o.importCssString(n,"custom-editor-font-style",!0,document);$("#custom-editor-font-style").remove()},w=a.setViewPortSize,d=function(e,t){return function(n){var r,a,s,d,m;function v(){return v.__super__.constructor.apply(this,arguments)}return b(v,n),v.prototype.editor=null,v.prototype.fileModel=null,v.prototype.commonCodeMirrorEditor=null,v.prototype.el=e,r=!1,a="default",m=null,s=_.debounce((function(e){var n;if(CodeMirror.optionHandlers.minimap)return t.$el.parent().width()<1024?(e.editor.setOption("minimap",!1),void t.$el.parent().removeClass("editor_panel_contain_minimap")):!1!==e.model.get("cm_minimap")?e.editor.state.minimap?void e.editor.state.minimap.refresh():(n=$("<div class='editor_minimap'></div>"),t.$el.after(n),t.$el.parent().addClass("editor_panel_contain_minimap"),e.editor.setOption("minimap",{replaceTarget:n[0]})):(e.editor.setOption("minimap",!1),t.$el.parent().removeClass("editor_panel_contain_minimap"))}),300),v.prototype.initialize=function(n){var i,o,a;return i=n.fileModel,this.fileModel=i,o=d(e,i,this.model,this),this.editor=o,this.commonCodeMirrorEditor=l(o,t.editorView),this.commonCodeMirrorEditor.connectedView=this,this.setEditorConfig(),this.listenTo(this.model,"change",(a=this,function(){return r=!0,a.setEditorConfig()})),this.listenTo(this.model,"refreshEditorProfile",function(e){return function(){return e.setEditorConfig()}}(this)),m=function(){var e;if(o&&r)return e=o.getOption("lineNumbers"),o.setOption("lineNumbers",!e),o.setOption("lineNumbers",e),r=!1},$(window).on("sidebarHidden",m)},v.prototype.destroy=function(){return this.commonCodeMirrorEditor.connectedView=null,this.commonCodeMirrorEditor.destroy(),this.editor.setOption("searchbox",!1),this.editor.setOption("minimap",!1),this.editor.xsjDestroy(),$(window).off("sidebarHidden",m),m=null,this.remove()},d=function(e,t,n,r){var a;return function(e){var t;if(t=e.state.autopreview)return t.isAutopreviewed()?t.disableAutopreview():t.enableAutopreview()},(a=CodeMirror.fromTextArea(e,{mode:CodeMirror.createXSJCodeMirrorMode((function(){return{fileModel:r.fileModel,app:i,editorModel:r.model}})),modeLoader:!0,singleCursorHeightPerLine:!1,spellCheckerAffUrl:"media/en_US.aff",spellCheckerDicUrl:"media/en_US.dic",extraKeys:{Enter:"newlineAndIndentContinueMarkdownList",Tab:"tabAndIndentMarkdownList","Shift-Tab":"shiftTabAndUnindentMarkdownList","Ctrl-Q":function(e){return e.foldCode(e.getCursor())},F4:function(e){return c(r.commonCodeMirrorEditor)},F3:function(e){return u(r.commonCodeMirrorEditor)}},dragDrop:!0,foldGutter:!0,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"],highlightSelectionMatches:{showToken:!1,annotateScrollbar:!0,getMinCharsFn:function(e){var t;return(t=e.getWrapperElement()).classList.contains("CodeMirror-Searching")||t.classList.contains("CodeMirror-full-Searching")?1:2}},maxInvisibles:16,searchbox:!0,inputStyle:o.isMobileDevice()?"contenteditable":"textarea"})).initXSJApp(i,t,n,r),h(a,{openXSJFileFn:function(e,t){var n,i;return i=t.lineNum,n=o.getCursorByHashTag(t.hashTag,e.get("content")),u(r.commonCodeMirrorEditor,{lineNum:i,fileModel:e,initColumn:n.column,initRow:n.row})}}),p(a),f(a),a.on("renderLine",(function(e,t,n){})),a.addKeyMap({"Ctrl-Alt-F":"stackFocusLine","Cmd-Alt-F":"stackFocusLine","Ctrl-Alt-/":"toggleAutopreview","Cmd-Alt-/":"toggleAutopreview","Cmd-/":"autocompleteEmoji","Ctrl-/":"autocompleteEmoji"}),a},v.prototype.initMinimap=function(){return s(this)},v.prototype.setEditorConfig=function(){var e,n,r,o,s,l,c,u,d,p,f,h,m,v,_,y,b,x,k,D,C,F,M;this.editor.startOperation(),o=this.model.get("cm_autopreview"),f=this.model.get("cm_autopreview_image"),m=this.model.get("cm_autopreview_link"),h=this.model.get("cm_autopreview_inline"),p=this.model.get("cm_autopreview_hr"),_=this.model.get("cm_autopreview_table"),b=this.model.get("cm_autopreview_yaml"),v=this.model.get("cm_autopreview_mathjax"),y=this.model.get("cm_autopreview_todo"),c=this.model.get("cm_autopreview_fenced_code"),d=this.model.get("cm_autopreview_header"),u=this.model.get("cm_autopreview_html"),l=this.model.get("cm_autopreview_emoji"),s={image:!!f,todolist:!!y,mathjax:!!v,html:!!u,mermaid:!!this.model.get("cm_autopreview_mermaid"),flow:!!this.model.get("cm_autopreview_flow"),sequence:!!this.model.get("cm_autopreview_sequence"),plantUML:!!this.model.get("cm_autopreview_plantUML"),header:!!d,inline:!!h,hr:!!p,table:!!_,link:!!m,fileYaml:!!b,fencedCode:!!c,emoji:!!l,toc:!!this.model.get("cm_autopreview_toc"),footnote:!!this.model.get("cm_autopreview_footnote"),ruby:!!this.model.get("cm_autopreview_ruby"),quote:!0},this.editor.autopreviewConfig=s,o?this.editor.setOption("autopreview",s):this.editor.setOption("autopreview",!1),this.editor.setOption("lineWrapping",this.model.get("cm_lineWrapping")),CodeMirror.commands.scrollSelectionToCenter&&this.editor.setOption("typewriterScrolling",this.model.get("cm_typewriterScrolling")),CodeMirror.optionHandlers.autoCloseBrackets&&this.editor.setOption("autoCloseBrackets",this.model.get("cm_autoCloseBrackets")),CodeMirror.optionHandlers.autoCloseTags&&this.editor.setOption("autoCloseTags",this.model.get("cm_autoCloseBrackets")),CodeMirror.optionHandlers.matchBrackets&&this.editor.setOption("matchBrackets",!0),CodeMirror.optionHandlers.matchTags&&this.editor.setOption("matchTags",!0),this.initMinimap(),this.editor.setOption("scrollPastEnd",this.model.get("cm_scrollPastEnd")),this.editor.setOption("inputOffsetTopWithCursor",this.model.get("cm_inputOffsetTop")),this.editor.setOption("spellCheckerAffUrl","media/en_US.aff"),this.editor.setOption("spellCheckerDicUrl","media/en_US.dic"),M=this.model.get("cm_spellChecker"),this.editor.setOption("spellChecker",M),D=this.model.get("cm_markerColorpicker"),r=i.getApplicationProfileModel(),D?this.editor.setOption("colorpicker",{type:"sketch",onColorSetsChanged:function(e){return null==e&&(e=[]),r.set("cmColorpickerColorSets",e.join("|")),r.save()},colorSets:function(){var e,t;return t=[],(e=$.trim(r.get("cmColorpickerColorSets"))||"")&&(t=e.split("|")),[{colors:t,name:"Input Colors",edit:!0}]},mode:"edit"}):this.editor.setOption("colorpicker",!1),k=this.model.get("cm_lineNumbers"),this.editor.setOption("lineNumbers",k),n=$(this.editor.getGutterElement()),k?n.removeClass("no_linenumers"):n.addClass("no_linenumers"),e=$(this.editor.getWrapperElement()),x=this.model.get("cm_keyBinding")||"default","default"!==a&&this.editor.removeKeyMap(CodeMirror.keyMap[a]||a),"default"!==x&&this.editor.addKeyMap(x),a=x,this.editor.setOption("keyMap",this.model.get("cm_keyBinding")||"default"),C=this.model.get("fontSize")||16,(F=this.model.get("lineHeight"))||(F=1.4*C/16),e.css("fontSize",C+"px"),e.css("lineHeight",F),g(this.model.get("editorFont")),w(this.model.get("viewportWidth"),this.model.get("viewportAlign"),t.$el),this.editor.setOption("styleActiveLine",this.model.get("cm_highlightActive")),this.editor.setOption("activeCursorMathjax",this.model.get("cm_activeCursorMathjax")),this.editor.setOption("styleStackFocusLine",this.model.get("cm_styleStackFocusLine")),this.editor.setOption("showInvisibles",this.model.get("cm_showInvisibles")),this.editor.setOption("smartIndent",this.model.get("cm_smartIndent")),this.editor.setOption("indentWithTabs",this.model.get("cm_indentWithTabs")),this.editor.setOption("tabSize",this.model.get("cm_tabSize")||4),this.editor.setOption("indentUnit",this.model.get("cm_tabSize")||4),this.editor.endOperation(),this.editor.refresh()},v}(s)},r=function(e){var t,n,r,o;function a(){return a.__super__.constructor.apply(this,arguments)}return b(a,e),a.prototype.fileModel=null,a.prototype.template=y,a.prototype.className="codemirror_editor_wrapper main_content_wrapper",a.prototype.editor=null,a.prototype.rootEditorProxy=null,a.prototype.commonCodeMirrorEditor=null,a.prototype.activeCommonCodeMirrorEditor=null,a.prototype.editorView=null,r=null,n=/gecko\/\d/i.test(navigator.userAgent),o=function(e){var t,n,i;if(r&&r.editor&&e.target===e.currentTarget)return e=e.originalEvent,i=(t=r.editor).getScrollInfo(),n=CodeMirror.wheelEventPixels(e).y,t.scrollTo(i.left,i.top+n),CodeMirror.e_preventDefault(e)},a.prototype.initialize=function(e){return this.fileModel=e.fileModel,this.editorView=e.editorView,this.rootEditorProxy=this},a.prototype.setActiveEditorProxy=function(e){var t;if((t=e?e.commonCodeMirrorEditor:this.commonCodeMirrorEditor)!==this.activeCommonCodeMirrorEditor)return this.activeCommonCodeMirrorEditor=t,this.editorView.editorTool.reInitEditorTool(this.activeCommonCodeMirrorEditor.editorProxy),this.getUndoManager().onButtonStateChange()},t=function(e){return e.activeCommonCodeMirrorEditor||e.commonCodeMirrorEditor},a.prototype.getActiveEditorProxy=function(){return t(this).editorProxy},a.prototype.initEditor=function(e,t,i){var a,s,l,c;return this.render(),this.layout=t,this.$el.appendTo(e),a=this.$el.find("#codemirror_editor"),s=null,setTimeout((function(){return s()}),0),c=this,s=function(){var e;return e=d(a[0],c),r=new e({model:c.model,fileModel:c.fileModel}),c.commonCodeMirrorEditor=r.commonCodeMirrorEditor,c.activeCommonCodeMirrorEditor=c.commonCodeMirrorEditor,c.editor=c.commonCodeMirrorEditor.editor,v(c,c.commonCodeMirrorEditor),c.commonCodeMirrorEditor.editorProxy=c,c.setEditorContent(),l(c.editor,c),m(c.editor),"function"==typeof i?i():void 0},l=function(e,t){return e.on("cursorActivity",(function(e){return t.$el.parent().trigger("changeCursor")})),e.on("change",(function(){return t.$el.parent().trigger("contentChange")})),e.on("refresh",(function(e){return r.initMinimap()})),e.on("beforeSelectionChange",(function(e,n){return t.$el.parent().trigger("changeSelection"),t.$el.parent().trigger("changeCursor")})),e.on("scroll",(function(){if(!e.state.typewriterScrolling||!e.state.typewriterScrolling.scrolling)return t.$el.parent().trigger("editorScroll")}))},n?this.$el.parent().on("DOMMouseScroll",o):this.$el.parent().on("wheel",o)},a.prototype.destroyEditor=function(){return this.$el.parent().off("wheel",o),this.$el.parent().off("DOMMouseScroll",o),r=null,this.commonCodeMirrorEditor.destroy(),this.commonCodeMirrorEditor=null,this.activeCommonCodeMirrorEditor=null,this.editor=null,this.editorView=null,this.remove()},a.prototype.toggleZenMode=function(e){return i.getApplicationProfileModel(),e?this.$el.addClass("ui piled segment zen_mode"):this.$el.removeClass("ui piled segment zen_mode")},a.prototype.changeFileModel=function(e){return this.commonCodeMirrorEditor.destroyChildren(),this.setActiveEditorProxy(this),this.fileModel=e,r.fileModel=e,this.editor.changeFileModel(e),this.setEditorContent()},a.prototype.addCommands=function(e){return this.commonCodeMirrorEditor.addCommands(e)},a.prototype.bindUserKeyBoard=function(e){return this.commonCodeMirrorEditor.bindUserKeyBoard(e)},a}(s),n.exports=r}}),window.requirejs.define({"views/database_index_view":function(e,t,n){var i,r,o,a,s,l,c,u,d={}.hasOwnProperty;l=t("./view"),a=t("../lib/notifier"),i=t("../constant"),t("../application"),r=t("../models/database_auto_index_model"),c=t("./templates/database_index"),s=t("../lib/pouchdb_index_view_manager"),t("../lib/utils"),u=null,o=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)d.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.template=c,t.prototype.databaseAutoIndexModel=null,t.prototype.initialize=function(e){return this.databaseView=e.databaseView,this.databaseAutoIndexModel=new r},t.prototype.events={"click .common_build_button":"buildViewFn","click .fullsearch_build_button":"buildFullSearchViewFn","click .reset_all_build_button":"resetAllBuildFn","click .auto_index":"toggleAutoIndexFn","click .reset_auto_index":"resetAutoIndexFn"},t.prototype.resetAutoIndexFn=function(){return this.databaseAutoIndexModel.resetDefault(),this.$el.find(".database_index_tbody_container tr").each((function(e,t){var n,i;return u.databaseAutoIndexModel.checkHasIndexName(t.dataset.id)?null!=(n=t.querySelector(".auto_index"))&&(n.checked=!0):null!=(i=t.querySelector(".auto_index"))&&(i.checked=!1),!0}))},t.prototype.toggleAutoIndexFn=function(e){var t,n,i;return n=(t=$(e.currentTarget)).is(":checked"),i=t.parent().parent().data("id"),n?this.databaseAutoIndexModel.addIndexName(i):this.databaseAutoIndexModel.removeIndexName(i)},t.prototype.resetAllBuildFn=function(){var e;return e=i.pouchDB,s.destroyAllViews(e,(function(){return console.log(arguments)}))},t.prototype.buildFullSearchViewFn=function(e){var t,n,r,o,l,c,u,d;if(r=$(e.currentTarget),o=r.parent().parent(),t=r.parent(),o.data("id")){if(!o.data("isRuning"))return d=t.html(),t.html('<div class="ui basic button loading"></div>'),o.data("isRuning",!0),n=o.find(".seq_info"),l=r.data("type"),c=i.pouchDB,u={processInfoFn:function(e){var t;if(e&&"showUpdateProgressInfo"===e.processType)return t=e.result,n.html(t.viewSeq+" / "+t.dbSeq)}},s.buildFullSearchView(c,l,u,(function(e){return e&&a.showMessage("\u7d22\u5f15\u51fa\u9519:"+e,6e3,"error"),o.data("isRuning",!1),t.html(d)}));a.showMessage("\u6b63\u5728\u7d22\u5f15\u4e2d...",6e3,"warning")}},t.prototype.buildViewFn=function(e){var t,n,r,o,s,l,c,u,d,p;if(r=$(e.currentTarget),o=r.parent().parent(),t=r.parent(),p=o.data("id")){if(!o.data("isRuning"))return u=t.html(),t.html('<div class="ui basic button loading"></div>'),o.data("isRuning",!0),n=o.find(".seq_info"),l=r.data("type"),d=null,c=i.pouchDB,s=function(){var e;return e={limit:0,beforeUpdateView:function(){},afterUpdateView:function(){},showUpdateProgressInfo:function(e,t,i,r){return n.html(e+" / "+t)}},d&&(e.since=d),c.query(p,e).then((function(){return o.data("isRuning",!1),t.html(u)})).catch((function(e){return a.showMessage("\u7d22\u5f15\u51fa\u9519:"+e,6e3,"error"),o.data("isRuning",!1),t.html(u)}))},"rebuild"===l&&(d=1),"destroy_rebuild"===l?(d=1,c.query(p,{destroy:!0}).then((function(){return s()})).catch((function(e){return a.showMessage("\u5220\u9664\u7d22\u5f15\u51fa\u9519:"+e,6e3,"warning"),s()}))):s();a.showMessage("\u6b63\u5728\u7d22\u5f15\u4e2d...",6e3,"warning")}},t.prototype.remove=function(){return t.__super__.remove.apply(this,arguments),u=null},t.prototype.getRenderData=function(){return{autoFullSearchIndex:this.databaseAutoIndexModel.get("indexNames").indexOf("fullsearch_index")>=0?"checked":""}},t.prototype.afterRender=function(){var e,t,n;return u=this,n=i.pouchDB,u.$el.find(".dimmer").dimmer("show"),t=this.databaseAutoIndexModel,e=this.$el.find(".database_index_tbody_container"),n.info().then((function(i){return s.buildFullSearchView(n,"info",null,(function(t,n){if(n)return e.find(".fullsearch_index_container").find(".seq_info").html(n.seq+" / "+i.update_seq)})),s.getBuildViewNames(n,(function(r,o){return Promise.all(o.map((function(r){var o;return o=t.checkHasIndexName(r)?"checked":"",n.query(r,{info:!0}).then((function(t){return e.append('<tr data-id="'+r+'">\n<td></td>\n<td>'+r+'</td>\n<td class="seq_info">'+t.seq+" / "+i.update_seq+'</td>\n<td class="operater_buttons">\n  <div class="ui basic mini button common_build_button" data-type="build">\u7d22\u5f15</div>\n  <div class="ui basic mini button common_build_button" data-type="rebuild">\u91cd\u65b0\u7d22\u5f15</div>\n  <div class="ui basic mini button common_build_button" data-type="destroy_rebuild">\u5220\u9664\u540e\u91cd\u65b0\u7d22\u5f15</div>\n</td>\n<td>\n  <input type="checkbox" class="auto_index" '+o+"/>\n</td>\n</tr>")}))}))).then((function(){return u.$el.find(".dimmer").dimmer("hide")}))}))}))},t}(l),n.exports=o}}),window.requirejs.define({"views/database_local_view":function(e,t,n){var i,r,o,a,s,l,c,u,d,p,f,h,m,v,g,w={}.hasOwnProperty;p=t("./view"),l=t("../lib/notifier"),a=t("../constant"),o=t("../lib/config_sync"),i=t("../application"),v=t("./templates/database_local"),c=t("../lib/pouchdb_index_view_manager"),r=t("./calendar_view"),d=t("../lib/utils"),u=t("./select_files_manager_for_batch_dialog_view"),g=null,h=function(e,t){var n,i,r,o;i=require("fs"),r=require("path"),n=require("async"),o=function(e,t){return i.lstat(e,(function(a,s){var l;return!a&&s.isDirectory()?(l=s.size,i.readdir(e,(function(i,a){return i?t(i):n.forEach(a,(function(t,n){return o(r.join(e,t),(function(e,t){return l+=t,n(e)}))}),(function(e){return t(e,l)}))}))):t(a,s.size)}))};try{return o(e,(function(e,n){return t(n||0)}))}catch(e){return e,t(0)}},m=function(){var e,t;return e=a.configDBOptions,(t=i.getUserModel()).id?new PouchDB("xiao_config_"+t.id,e):a.pouchDBConfig},f=function(e,t){var n,i,r,o,a;return 5e4,n=new TextDecoder,r=e.size,o="",(i=new FileReader).onload=function(){var e,s,l,c;for(l=(o=n.decode(i.result,{stream:!0})+o).split("\n"),o=l.shift(),l.reverse(),e=0,s=l.length;e<s;e++)if(c=l[e].match(/^\{"seq":\s*(\d+)\s*\}/))return void t(c[1]);return r-=5e4,a()},i.onerror=function(){return console.error(i.error),t(0)},(a=function(){var n,a;return r<=0?(n=o.match(/^\{"seq":\s*(\d+)\s*\}/),void t(n?n[1]:0)):(a=e.slice(r-5e4,r),i.readAsArrayBuffer(a))})()},s=function(e){var t,n;function s(){return s.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)w.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(s,e),s.prototype.template=v,s.prototype.className="ui form",s.prototype.calendarView=null,s.prototype.rangeType="calendar",s.prototype.selectedFileIds=[],s.prototype.selectedDocs=[],s.prototype.loadDatabaseTarget="article",s.prototype.events={"click .dump_button":"dumpPouchDB","click .compact_button":"compactPouchDB","click .destroy_button":"destroyPouchDB","click .destroy_config_button":"destroyConfigPouchDB","click .destroy_app_button":"destroyAppPouchDB","click .load_button":"loadPouchDB","change input[name=rangeType]":"rangeTypeChangeFn","click .picker_select_button":"selectFilesFn","click .open_folder_btn":"openDataPathFolderFn"},s.prototype.openDataPathFolderFn=function(){var e;return e=require("nw.gui").App.dataPath,nw.Shell.showItemInFolder(e)},s.prototype.selectFilesFn=function(e){return this.databaseView.hide(),new u({operatorFileDialogView:this,initDocs:this.selectedDocs||[]}).show()},s.prototype.getRenderData=function(){var e,t,n;return e="","client"===STORY_PLATFORM?(t=require("nw.gui"),require("path"),e=t.App.dataPath,h(e,(n=this,function(e){return n.$el.find(".database_size_container").text(filesize(e))}))):navigator.storage&&navigator.storage.estimate?navigator.storage.estimate().then(function(e){return function(t){return e.$el.find(".database_size_container").text(filesize(t.usage))}}(this)):this.$el.find(".database_size_container").text("\u5f53\u524d\u6d4f\u89c8\u5668\u4e0d\u652f\u6301"),{dataPath:e}},s.prototype.rangeTypeChangeFn=function(e){var t,n,i,r;switch(this,r=$(e.currentTarget).val(),g.selectedFileIds=[],this.rangeType=r,(n=this.$el.find(".select_result_container")).empty(),n.addClass("hidden"),t=this.$el.find(".calendar_select_container"),i=this.$el.find(".picker_select_container"),r){case"all":return t.hide(),i.hide();case"calendar":return i.hide(),t.show();case"picker":return t.hide(),i.show()}},s.prototype.initialize=function(e){return this.databaseView=e.databaseView},s.prototype.loadPouchDB=function(e){var t;return t=$(e.currentTarget),this.loadDatabaseTarget="config"===t.data("value")?"config":"article",g.$el.find("input[type=file]").trigger("click")},s.prototype.destroyConfigPouchDB=function(){var e,t,n;if(n=m(),t=lorem(3,{usePunc:!1}),null!==(e=prompt("\u786e\u8ba4\u662f\u5426\u6e05\u7a7a\u5f53\u524d\u914d\u7f6e\u4e2d\u5fc3\u7684\u6570\u636e\u5e93\uff0c\u6e05\u7a7a\u540e\uff0c\u914d\u7f6e\u6587\u4ef6\u5185\u7684\u6570\u636e\u5c06\u4e0d\u53ef\u6062\u590d(\u4e0d\u5305\u62ec\u6587\u6863)\u3002 \u8bf7\u8f93\u5165'"+t+"' \u5b8c\u6210\u786e\u8ba4\u64cd\u4f5c","")))return e===t?(g.databaseView.dimmer.dimmer("show"),n.destroy().then((function(){var e;return e=localStorage.getItem("user"),localStorage.clear(),localStorage.setItem("user",e),l.showMessage("\u5220\u9664\u6210\u529f, \u8bf7\u91cd\u542f\u5c0f\u4e66\u5320",3e3,"info"),alert("\u5220\u9664\u6210\u529f,\u7cfb\u7edf\u5c06\u91cd\u65b0\u542f\u52a8"),"client"!==STORY_PLATFORM?document.location.reload():global.restartXSJApp()})).catch((function(e){return null!=g&&g.databaseView.dimmer.dimmer("hide"),l.showMessage("\u5220\u9664\u5931\u8d25: "+e,6e3,"error")}))):l.showMessage("\u5220\u9664\u5931\u8d25: \u786e\u8ba4\u7801\u4e0d\u4e00\u81f4",6e3,"error")},s.prototype.destroyAppPouchDB=function(){var e,t,n;if(n=a.pouchDBAppResource,t=lorem(3,{usePunc:!1}),null!==(e=prompt("\u786e\u8ba4\u662f\u5426\u6e05\u7a7a\u5f53\u524d\u8d44\u6e90\u4e2d\u5fc3\u7684\u6570\u636e\u5e93\uff0c\u6e05\u7a7a\u540e\uff0c\u8d44\u6e90\u4e2d\u5fc3\u5185\u7684\u6570\u636e\u5c06\u4e0d\u53ef\u6062\u590d(\u4e0d\u5305\u62ec\u6587\u6863)\u3002 \u8bf7\u8f93\u5165'"+t+"' \u5b8c\u6210\u786e\u8ba4\u64cd\u4f5c","")))return e===t?(g.databaseView.dimmer.dimmer("show"),n.destroy().then((function(){return l.showMessage("\u5220\u9664\u6210\u529f, \u8bf7\u91cd\u542f\u5c0f\u4e66\u5320",3e3,"info"),alert("\u5220\u9664\u6210\u529f,\u7cfb\u7edf\u5c06\u91cd\u65b0\u542f\u52a8"),"client"!==STORY_PLATFORM?document.location.reload():global.restartXSJApp()})).catch((function(e){return null!=g&&g.databaseView.dimmer.dimmer("hide"),l.showMessage("\u5220\u9664\u5931\u8d25: "+e,6e3,"error")}))):l.showMessage("\u5220\u9664\u5931\u8d25: \u786e\u8ba4\u7801\u4e0d\u4e00\u81f4",6e3,"error")},s.prototype.destroyPouchDB=function(){var e,t,n,r;if(n=a.pouchDB,t=lorem(3,{usePunc:!1}),null!==(e=prompt("\u786e\u8ba4\u662f\u5426\u6e05\u7a7a\u5f53\u524d\u6587\u6863\u6570\u636e\u5e93\uff0c\u6e05\u7a7a\u540e\uff0c\u6587\u6863\u6570\u636e\u5c06\u4e0d\u53ef\u6062\u590d(\u4e0d\u5305\u62ec\u8d44\u6e90\u4e2d\u5fc3)\u3002 \u8bf7\u8f93\u5165'"+t+"' \u5b8c\u6210\u786e\u8ba4\u64cd\u4f5c","")))return e===t?(g.databaseView.dimmer.dimmer("show"),(r=i.getFileCollection()).createUpdateHelpFile(!1,(function(e,t){return $(window).trigger("changeFileModel",[t]),n.destroy().then((function(){var e,t;return r.remove(r.models),(e=i.getFileGroupTabCollection()).remove(e.models),i.getFileTabsModel().set({tabs:[],activeTab:""}),t=function(){return l.showMessage("\u5220\u9664\u6210\u529f, \u8bf7\u91cd\u542f\u5c0f\u4e66\u5320",3e3,"info"),alert("\u5220\u9664\u6210\u529f,\u7cfb\u7edf\u5c06\u91cd\u65b0\u542f\u52a8"),"client"!==STORY_PLATFORM?document.location.reload():global.restartXSJApp()},i.getFileLocalCollection().destroyAll(t)})).catch((function(e){return null!=g&&g.databaseView.dimmer.dimmer("hide"),l.showMessage("\u5220\u9664\u5931\u8d25: "+e,6e3,"error")}))}))):l.showMessage("\u5220\u9664\u5931\u8d25: \u786e\u8ba4\u7801\u4e0d\u4e00\u81f4",6e3,"error")},s.prototype.compactPouchDB=function(e){var t,n;if(n=$(e.currentTarget).data("value"),t=a.pouchDB,"config"===n&&(t=o.getConfigDB()),confirm("\u538b\u7f29\u540e\u4fdd\u5b58\u5728\u672c\u5730\u7684\u5386\u53f2\u8bb0\u5f55\u5c06\u88ab\u6e05\u7a7a"))return g.databaseView.dimmer.dimmer("show"),t.compact().then((function(){return null!=g&&g.databaseView.dimmer.dimmer("hide"),l.showMessage("\u538b\u7f29\u6210\u529f",3e3,"info")})).catch((function(e){return null!=g&&g.databaseView.dimmer.dimmer("hide"),l.showMessage("\u538b\u7f29\u5931\u8d25: "+e,6e3,"error")}))},t=function(e){var t,n,i,r,o;if(g.databaseView.dimmer.dimmer("show"),t=g.databaseView.$el.find(">.dimmer>.text"),n=a.pouchDB,"all"!==g.rangeType)return g.selectedFileIds.length>0?(o=g.selectedFileIds.slice(),i=0,r=function(e,r){return i++,t.html("(1/2)\u9644\u4ef6\u7d22\u5f15\u4e2d: "+i+"/"+g.selectedFileIds.length),n.allDocs({include_docs:!0,startkey:e,endkey:e+"\ufff0"}).then((function(t){return t.rows.forEach((function(t){if(t.id!==e&&!t.doc.isDeleted)return o.push(t.id)})),r()})).catch((function(t){return l.showMessage("\u7d22\u5f15\u6587\u4ef6/\u9644\u4ef6\u5931\u8d25: ("+e+")"+t,6e3,"error"),r()}))},void async.mapSeries(g.selectedFileIds,r,(function(){var n;return t.html("(2/2)\u6587\u4ef6\u5199\u5165\u4e2d ..."),n=0,e({batch_size:1,doc_ids:o,showUpdateProgressInfo:function(e){return n+=e.length,t.html("(2/2)\u6587\u4ef6\u5199\u5165\u4e2d: "+n+"/"+o.length)}})}))):(g.databaseView.dimmer.dimmer("hide"),l.showMessage("\u5bfc\u51fa\u5931\u8d25: \u60a8\u9009\u62e9\u7684\u8303\u56f4\u6ca1\u6709\u53ef\u4ee5\u5bfc\u51fa\u7684\u6587\u6863",6e3,"error"));n.info((function(n,i){var r;return r=0,e({batch_size:1,showUpdateProgressInfo:function(e){return r+=e.length,t.html("(2/2)\u6587\u4ef6\u5199\u5165\u4e2d: "+r+"/"+i.doc_count)}})}))},s.prototype.dumpPouchDBByBlob=function(){var e,n,i;return"xsj.dump",e=new xsjStream.BlobStream(null,{readable:!1}),n=null,e.on("finish",(function(){return n=this.toBlob(),console.log("finished ...")})),i=a.pouchDB,g.databaseView.dimmer.dimmer("show"),t((function(t){return i.dump(e,t).then((function(){return null!=g&&g.databaseView.dimmer.dimmer("hide"),l.showMessage("\u5bfc\u51fa\u6210\u529f",3e3,"info"),saveAs(n,moment().format("YYYY-MM-DD")+".xsj")})).catch((function(e){return null!=g&&g.databaseView.dimmer.dimmer("hide"),l.showMessage("\u5bfc\u51fa\u5931\u8d25: "+e,6e3,"error")}))}))},s.prototype.dumpPouchDBConfig=function(){var e,t,n,i;return i=m(),"xsj.dump",t=new xsjStream.BlobStream(null,{readable:!1}),n=null,t.on("finish",(function(){return n=this.toBlob(),console.log("finished ...")})),g.databaseView.dimmer.dimmer("show"),e=g.databaseView.$el.find(">.dimmer>.text"),function(t){return i.info((function(n,i){var r;return r=0,t({batch_size:1,showUpdateProgressInfo:function(t){return r+=t.length,e.html("(2/2)\u6587\u4ef6\u5199\u5165\u4e2d: "+r+"/"+i.doc_count)}})}))}((function(e){return i.dump(t,e).then((function(){return null!=g&&g.databaseView.dimmer.dimmer("hide"),l.showMessage("\u5bfc\u51fa\u6210\u529f",3e3,"info"),saveAs(n,moment().format("YYYY-MM-DD")+".config.xsj")})).catch((function(e){return null!=g&&g.databaseView.dimmer.dimmer("hide"),l.showMessage("\u5bfc\u51fa\u5931\u8d25: "+e,6e3,"error")}))}))},s.prototype.dumpPouchDB=function(e){if(confirm("\u786e\u8ba4\u662f\u5426\u5bfc\u51fa\u6570\u636e\u5e93"))return"config"===$(e.currentTarget).data("value")?void g.dumpPouchDBConfig():window.requestFileSystem?(g.dumpPouchDBByFileSystem((function(){return g.dumpPouchDBByBlob()})),console.log("use filesystem dump")):(g.dumpPouchDBByBlob(),console.log("use blob dump"))},s.prototype.dumpPouchDBByFileSystem=function(e){var n,i,r;return"xsj.dump",i=function(t){return e?e():l.showMessage("\u5bfc\u51fa\u5931\u8d25: "+t,6e3,"error")},r=function(e){var t;return t=function(){return e.root.getFile("xsj.dump",{create:!0},(function(e){return n(e)}))},e.root.getFile("xsj.dump",null,(function(e){return e.remove(t,t)}),t)},n=function(e){var n,i;return n=new xsjStream.FileSystemStream(e),i=a.pouchDB,g.databaseView.dimmer.dimmer("show"),t((function(t){return i.dump(n,t).then((function(){var t;return null!=g&&g.databaseView.dimmer.dimmer("hide"),l.showMessage("\u5bfc\u51fa\u6210\u529f",3e3,"info"),(t=document.createElement("a")).href=e.toURL(),t.download=moment().format("YYYY-MM-DD")+".xsj",t.click()})).catch((function(e){return null!=g&&g.databaseView.dimmer.dimmer("hide"),l.showMessage("\u5bfc\u51fa\u5931\u8d25: "+e,6e3,"error")}))}))},requestFileSystem(window.TEMPORARY,5368709120,r,i)},s.prototype.remove=function(){return this.calendarView&&(this.calendarView.remove(),this.calendarView=null),g.$el.find(".dump_range_input").off("click"),s.__super__.remove.apply(this,arguments),g=null},s.prototype.destroy=function(){return this.databaseView.destroy()},s.prototype.show=function(){return this.databaseView.show()},s.prototype.setSelectedDocs=function(e){var t;return this.selectedFileIds=_.pluck(e,"id"),this.selectedDocs=e,(t=this.$el.find(".select_result_container")).removeClass("hidden"),t.html("\u60a8\u603b\u5171\u9009\u62e9\u4e86 "+e.length+" \u7bc7\u6587\u7ae0")},n=function(e){var t,n;return n=new(r())({selectMode:"range"}),e.calendarView=n,(t=e.$el.find(".calendar_select_container")).append(n.$el),n.render(),n.on("dateRangeSelect",(function(t,n,i){var r,o;return(r=e.$el.find(".select_result_container")).removeClass("hidden"),g.selectedFileIds=[],n?(o=0,i.map((function(e){return o+=e.ids.length,g.selectedFileIds=g.selectedFileIds.concat(e.ids)})),r.html(moment(t).format("YYYYMMDD")+"-"+moment(n).format("YYYYMMDD")+" (\u603b\u5171 "+o+" \u7bc7)")):r.html(moment(t).format("YYYYMMDD")+"-")})),n.on("showDimmer",(function(e){return t.dimmer("show"),t.find(".dimmer").html(' <div class="ui text loader">'+e+"</div>")})),n.on("hideDimmer",(function(){return t.dimmer("hide")}))},s.prototype.afterRender=function(){var e,t,r,o;if(g=this,e=function(e){var t,n,i,r;if(e.length>0){if(i=(n=e[0]).name,d.getExt(i),r=null,t=a.pouchDB,"config"===g.loadDatabaseTarget){if(!i.toLowerCase().endsWith(".config.xsj"))return void alert("\u60a8\u5bfc\u5165\u7684\u4e0d\u662f\u5408\u6cd5\u7684\u914d\u7f6e\u6587\u4ef6, \u914d\u7f6e\u6587\u4ef6\u6587\u4ef6\u540d\u9700\u8981\u4ee5 `.config.xsj` \u7ed3\u5c3e");t=m()}else if(i.toLowerCase().endsWith(".config.xsj"))return void alert("\u60a8\u5bfc\u5165\u7684\u4e0d\u662f\u5408\u6cd5\u7684\u6570\u636e\u6587\u4ef6");return g.databaseView.dimmer.dimmer("show"),f(n,(function(e){var i,o;return e&&(i=g.databaseView.$el.find(">.dimmer>.text"),r=function(t){return i.text("\u5bfc\u5165\u4e2d: "+t+"/"+e)}),o=fileReaderStream(n,{chunkSize:20971520}),t.load(o,{batch_size:1,showUpdateProgressInfo:r}).then((function(){var e,t;if(i=g.databaseView.$el.find(">.dimmer>.text"),t=function(e,t,n,r){return i.html("["+e+"/"+t.length+"]\u7d22\u5f15\u4e2d:"+n+" / "+r)},e=function(){return l.showMessage("\u5bfc\u5165\u6210\u529f,\u8bf7\u91cd\u65b0\u542f\u52a8\u5c0f\u4e66\u5320",3e3,"info"),alert("\u5bfc\u5165\u6210\u529f,\u7cfb\u7edf\u5c06\u91cd\u65b0\u542f\u52a8"),"client"!==STORY_PLATFORM?document.location.reload():global.restartXSJApp()},"article"===g.loadDatabaseTarget)return c.autoBuildIndexFn(t,e);e()})).catch((function(e){return null!=g&&g.databaseView.dimmer.dimmer("hide"),l.showMessage("\u5bfc\u5165\u5931\u8d25: "+e,6e3,"error")}))}))}},d.initFileImportSupport(g.$el.find("input[type=file]"),e),n(g),r=(o=i.getUserModel()).get("user"),t=o.get("token")&&r&&r.vip,"web"===STORY_PLATFORM&&(t=!0),"production"!==ENV&&(t=!0),t)return this.$el.find(".custom_select_container").show()},s}(p),n.exports=s}}),window.requirejs.define({"views/database_service_view":function(e,t,n){var i,r,o,a,s,l,c,u={}.hasOwnProperty;a=t("./view"),o=t("../lib/notifier"),r=t("../lib/miniweb_server"),t("../constant"),t("../application"),l=t("./templates/database_service"),c=null,s=function(e,t){var n,i,r,o,a;return(n=(i=e.$el).find(".miniweb_server_control_btns")).empty(),r=i.find(".miniweb_server_info"),t?(o="http://localhost:"+t.web.port,n.append('<div class="ui button stop_miniweb_server_btn">\u505c\u6b62\u670d\u52a1</div>'),a="",t.password&&(a+="\u7528\u6237\u540d: "+t.username+"<br/>\u5bc6\u7801:"+t.password.replace(/./g,"*")+"<br/>"),r.html("\u5c0f\u4e66\u5320\u73b2\u73d1\u7248\u8bbf\u95ee\u5730\u5740\uff1a "+o+' <a href="'+o+'"><i class="icon chrome"></i></a> <br/>\n\u6570\u636e\u5e93\u670d\u52a1\u5730\u5740: '+o+"/data/user_"+t.user.id+" <br/>\n"+a+"\n\u6ce8: \u5982\u679c\u4e0d\u662f\u672c\u673a\u8bbf\u95ee\uff0c\u8bf7\u5c06 <strong>localhost</strong> \u6362\u6210\u771f\u5b9e\u7684\u53ef\u4ee5\u8bbf\u95ee\u7684 ip \u5730\u5740")):(r.html("\u60a8\u8fd8\u672a\u542f\u52a8\u670d\u52a1"),n.append('<div class="ui button start_miniweb_server_btn">\u542f\u52a8\u670d\u52a1</div>\n<div class="ui button destroy_miniweb_server_btn">\u91cd\u7f6e\u670d\u52a1</div>'))},i=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)u.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.template=l,t.prototype.initialize=function(e){return this.databaseView=e.databaseView},t.prototype.events={"click .start_miniweb_server_btn":"startServerFn","click .stop_miniweb_server_btn":"stopServerFn","click .destroy_miniweb_server_btn":"destroyServerFn"},t.prototype.startServerFn=function(e){var t,n,i,a,l,c;if(n=this,t=$(e.currentTarget),!a)return a=!0,t.addClass("loading"),c=n.$el.find("input[name=webPort]").val(),l=n.$el.find('input[name="username"]').val(),i=n.$el.find('input[name="password"]').val(),l=$.trim(l),i=$.trim(i),c=parseInt(c,10)||0,r.startServer({webPort:c,username:l,password:i},(function(e,t){var i;return i=n.$el.find(".ui.form").serializeObject(),localStorage.miniweb_server_config_data=JSON.stringify(i),e&&o.showMessage("\u542f\u52a8\u5931\u8d25: "+e,6e3,"error"),a=!1,s(n,t)}))},t.prototype.stopServerFn=function(e){var t,n,i;if(n=this,t=$(e.currentTarget),!i)return i=!0,t.addClass("loading"),r.stopServer((function(){return i=!1,s(n,null)}))},t.prototype.destroyServerFn=function(e){var t,n,i;if(n=this,t=$(e.currentTarget),!i)return i=!0,t.addClass("loading"),r.destroyServer((function(){return o.showMessage("\u91cd\u7f6e\u5b8c\u6210 ",6e3,"info"),i=!1,s(n,null)}))},t.prototype.remove=function(){return t.__super__.remove.apply(this,arguments),c=null},t.prototype.getRenderData=function(){return{}},t.prototype.afterRender=function(){var e,t,n;return c=this,e=this.$el.find(".ui.form"),(n=localStorage.miniweb_server_config_data)&&(t=JSON.parse(n)),t||(t={}),$.isNumeric(t.webPort)||(t.webPort=3600),(t.webPort>65500||t.webPort<0)&&(t.webPort=3600),e.deserialize(t),s(c,r.getServer())},t}(a),n.exports=i}}),window.requirejs.define({"views/database_sync_view":function(e,t,n){var i,r,o,a,s,l,c,u,d,p,f,h,m=function(e,t){return function(){return e.apply(t,arguments)}},v={}.hasOwnProperty;l=t("./view"),s=t("../lib/notifier"),i=t("../application"),t("../constant"),r=t("../lib/database_sync"),f=t("./templates/database_sync"),a=t("./database_sync_xsj_view"),h=null,u=function(){var e,t,n,i,r,o,a,s,l;return l=h.$el.find("input[name=syncType]:checked").val(),r=h.$el.find("input[name=customUrl]").val(),o=h.$el.find("input[name=customUsername]").val(),i=h.$el.find("input[name=customPassword]").val(),a=h.$el.find("input[name=customWithCredentials]").is(":checked"),e=h.$el.find("input[name=customLive]").is(":checked"),t=h.$el.find("input[name=customLiveFull]").is(":checked"),((n=parseInt(h.$el.find("input[name=customLiveMax]").val()))>50||n<1)&&(n=10),s={databaseSyncType:l,databaseCustomSyncUrl:r,databaseCustomSyncUsername:o,databaseCustomSyncPassword:i,databaseCustomSyncWithCredentials:a,databaseCustomSyncLiveMax:n,databaseCustomSyncLive:e,databaseCustomSyncLiveFull:t},h.apm.set(s,{silent:!0}),h.apm.trigger("databaseSyncTypeChanged",l),h.apm.trigger("forceSaveToDB",s),h.apm.save()},c=function(){var e,t,n;switch(u(),n=h.apm.get("databaseSyncType"),t=h.apm.get("databaseCustomSyncLive"),h.databaseView.dimmer.dimmer("show"),e=function(e){var t;if(h.databaseView.dimmer.dimmer("hide"),e){try{e=JSON.stringify(e)}catch(e){t=e,console.log(t)}return s.showMessage("\u540c\u6b65\u670d\u52a1\u542f\u52a8\u5931\u8d25\uff1a"+e,6e3,"error")}return h.syncType=n,s.showMessage("\u540c\u6b65\u6570\u636e\u529f\u80fd\u5f00\u542f",6e3,"info")},n){case"xsj":return r.startXSJSyncCouchdb(e);case"custom":return t?r.startCustomSyncCouchdb(e):r.stopSyncCouchdb((function(){return h.databaseView.dimmer.dimmer("hide"),s.showMessage("\u4fee\u6539\u6210\u529f",6e3,"info")}));default:return r.stopSyncCouchdb((function(){return h.syncType=n,h.databaseView.dimmer.dimmer("hide"),s.showMessage("\u53d6\u6d88\u540c\u6b65\u6210\u529f",6e3,"info")}))}},d=function(){var e,t,n,i,r,o,a;return a=null,h.$el.find(".custom_form").form("is valid")&&(n=h.$el.find("input[name=customUrl]").val(),i=$.trim(h.$el.find("input[name=customUsername]").val()),t=$.trim(h.$el.find("input[name=customPassword]").val()),r=h.$el.find("input[name=customWithCredentials]").is(":checked"),o={},i&&(e={username:i,password:t},o.auth=e),o.fetch=function(e,t){return r&&(t.credentials="include"),PouchDB.fetch(e,t)},a=new PouchDB(n,o)),a},p=null,o=function(e){function t(){return this.applySyncFn=m(this.applySyncFn,this),this.applyFullSyncFn=m(this.applyFullSyncFn,this),this.syncTypeChangedFn=m(this.syncTypeChangedFn,this),this.testCustomFn=m(this.testCustomFn,this),t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)v.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.template=f,t.prototype.className="ui container database_sync_container",t.prototype.initialize=function(e){return this.apm=i.getApplicationProfileModel(),this.userModel=i.getUserModel(),this.databaseView=e.databaseView,this.syncType=this.apm.get("databaseSyncType"),h=this},t.prototype.events={"click input[name=syncType]":"syncTypeChangedFn","click .apply_full_sync_button":"applyFullSyncFn","click .apply_sync_button":"applySyncFn","click .test_custom_button":"testCustomFn","dblclick .unlimited_life_mode_trigger_container":"togglePrepareUnlimitedLifeModeFn"},t.prototype.togglePrepareUnlimitedLifeModeFn=function(e){var t;if(!i.getUnlimitedLifeMode()){if(p)return;return this.$el.find(".xsj_segment").css({fontWeight:"bolder"}),(t=e.currentTarget).setAttribute("tabindex","0"),t.focus(),(p=Mousetrap(t)).bind("up up down down left right left right b a enter",(function(){return i.setUnlimitedLifeMode(!0),document.body.classList.add("unlimited_life_mode"),p.reset()}))}},t.prototype.testCustomFn=function(e){var t;return(t=d())?(h.databaseView.dimmer.dimmer("show"),r.checkPouchDBViewIsSame(t,(function(e,t){if(h.databaseView.dimmer.dimmer("hide"),e){try{e=JSON.stringify(e)}catch(t){t,console.log(e)}return s.showMessage("\u6d4b\u8bd5\u51fa\u9519\uff1a"+e,6e3,"error")}return t?s.showMessage("\u6d4b\u8bd5\u6210\u529f\uff1a\u670d\u52a1\u5668\u89c6\u56fe\u4e00\u81f4\uff0c\u53ef\u4ee5\u6b63\u5e38\u4f7f\u7528"):s.showMessage("\u6d4b\u8bd5\u5931\u8d25\uff1a\u670d\u52a1\u5668\u89c6\u56fe\u4e0d\u4e00\u81f4\uff0c\u8bf7\u4f7f\u7528\u4e0a\u9762\u7684\u89c6\u56fe\u8986\u76d6\u670d\u52a1\u5668\u89c6\u56fe",6e3,"error")}))):s.showMessage("\u670d\u52a1\u5668\u5730\u5740\u4e0d\u6b63\u786e",6e3,"error")},t.prototype.syncTypeChangedFn=function(e){var t,n,i,r;return"local"!==(i=!(r=$(e.currentTarget).val()))&&"xsj"!==i&&"custom"!==i||(r="local"),t=this.$el.find(".custom_segment"),n=this.$el.find(".xsj_segment"),"custom"===r?(t.show(),n.hide()):"xsj"===r?(n.show(),t.hide()):(t.hide(),n.hide())},t.prototype.applyFullSyncFn=function(){var e;return(e=d())?(h.databaseView.dimmer.dimmer("show"),r.startFullSyncCouchdb(e,(function(e){return h.databaseView.dimmer.dimmer("hide"),e?s.showMessage("\u540c\u6b65\u5931\u8d25:"+e,6e3,"error"):s.showMessage("\u540c\u6b65\u5b8c\u6210")}))):s.showMessage("\u670d\u52a1\u5668\u5730\u5740\u4e0d\u6b63\u786e",6e3,"error")},t.prototype.applySyncFn=function(){var e,t;return"custom"===(e=this.$el.find("input[name=syncType]:checked").val())?this.$el.find(".custom_form").form("validate form"):"xsj"===e&&MAC_STORE_WEB&&(this.userModel.get("user"),"mac"===(t=this.userModel.get("token"))&&(t=""),!t)?void s.showMessage("\u8bf7\u5148\u767b\u5f55\u5c0f\u4e66\u5320\u5e10\u53f7",6e3,"error"):c()},t.prototype.getRenderData=function(){var e,t;return e="",(this.apm.get("databaseCustomSyncLive")||!1)&&(e="checked"),t="",(this.apm.get("databaseCustomSyncLiveFull")||!1)&&(t="checked"),{initDDoc:r.getDDocStr(),customUrl:this.apm.get("databaseCustomSyncUrl"),customUsername:this.apm.get("databaseCustomSyncUsername"),customPassword:this.apm.get("databaseCustomSyncPassword"),customWithCredentials:this.apm.get("databaseCustomSyncWithCredentials"),customLiveMax:this.apm.get("databaseCustomSyncLiveMax"),customLive:e,customLiveFull:t}},t.prototype.afterRender=function(){var e,t,n,i,r;return h=this,i=this.apm.get("databaseSyncType"),r=this.userModel.get("user"),"mac"===this.userModel.get("token")&&"",(null!=r?r.vip:void 0)||this.$el.addClass("not_vip"),this.$el.find("input[name=syncType][value="+i+"]").prop("checked",!0),e=this.$el.find(".custom_segment"),t=this.$el.find(".xsj_segment"),MAC_STORE_WEB&&((n=new a).render(),t.prepend(n.$el)),this.$el.find(".custom_form").form({fields:{customUrl:{identifier:"customUrl",rules:[{type:"empty",prompt:"\u670d\u52a1\u5668\u5730\u5740\u4e0d\u80fd\u4e3a\u7a7a"}]},customLiveMax:{identifier:"customLiveMax",rules:[{type:"integer[1..50]",prompt:"\u5fc5\u987b\u662f1\u523050\u8303\u56f4\u5185\u7684\u6574\u6570"}]}},onSuccess:function(){return c(),!1}}),"client"!==STORY_PLATFORM&&this.$el.find(".client_only").hide(),"custom"===i?(e.show(),t.hide()):"xsj"===i?(t.show(),e.hide()):(e.hide(),t.hide())},t.prototype.remove=function(){return this.$el.find(".custom_form").form("destroy"),p&&p.reset(),p=null,h=null,t.__super__.remove.apply(this,arguments)},t}(l),n.exports=o}}),window.requirejs.define({"views/database_sync_xsj_view":function(e,t,n){var i,r,o,a,s,l=function(e,t){return function(){return e.apply(t,arguments)}},c={}.hasOwnProperty;s=t("./view"),t("../lib/utils"),o=t("../lib/notifier"),i=t("../application"),r=t("../constant"),a=function(e){function t(){return this.login=l(this.login,this),t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)c.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.className="ui form xsj_form",t.prototype.tagName="form",t.prototype.events={"click .login_button":"login","click .logout_button":"logout"},t.prototype.login=function(e){var t,n,a,s;if(e.preventDefault(),e.stopPropagation(),!(n=$(e.currentTarget)).hasClass("loading")){if(t=this.$el,a=this,(s=t.serializeObject()).email)return n.addClass("loading"),$.ajax({url:r.apiHost+"/api/users/login?include=user",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify(s),method:"POST"}).always((function(){return n.removeClass("loading")})).done((function(e){var t,n,r;return n=i.getUserModel(),(t=e.user).isRealVip=t.vip,t.vip=t.vip||t.isTempVip,MAC_STORE_WEB&&(t.vip=!0),r=$.extend({},t,{token:e.id,user:t}),n.set(r),a.afterRender()})).fail((function(e,t,n){var i;return(i=e.responseJSON)&&i.error?(i=i.error,o.showMessage("\u63d0\u4ea4\u51fa\u9519:"+i.message,6e3,"error")):e.responseText?o.showMessage("\u63d0\u4ea4\u51fa\u9519:"+e.responseText,6e3,"error"):o.showMessage("\u63d0\u4ea4\u51fa\u9519:"+n,6e3,"error")})),!1;o.showMessage("\u90ae\u4ef6\u5730\u5740\u4e0d\u80fd\u4e3a\u7a7a",6e3,"error")}},t.prototype.logout=function(e){var t,n;return e.preventDefault(),e.stopPropagation(),this,n=i.getUserModel(),t={user:{},token:"",logoutClearConfig:!1},MAC_STORE_WEB&&(t=Object.assign(t,n.constructor.defaultMacStoreUser)),n.set(t),this.afterRender(),!1},t.prototype.afterRender=function(){var e,t,n,r;return e=this.$el,n=(r=i.getUserModel()).get("user"),"mac"===(t=r.get("token"))&&(t=""),t?e.html('<div class="field"><label for="">\u5f53\u524d\u7528\u6237</label>'+n.email+'</div>\n<div class="field"><button class="ui button logout_button">\u9000\u51fa</button></div>'):e.html('<div class="field">\n    <label for="email" >\u90ae\u7bb1</label>\n    <input type="text" name="email" value="">\n</div>\n<div class="field">\n    <label for="password" >\u5bc6\u7801</label>\n    <input type="password" name="password" value="">\n</div>\n<div class="field">\n    <button class="ui button login_button">\u767b\u5f55</button>\n</div>')},t}(s),n.exports=a}}),window.requirejs.define({"views/database_view":function(e,t,n){var i,r,o,a,s,l,c,u,d,p,f,h,m,v,g,_={}.hasOwnProperty;c=t("./view"),o=t("./database_local_view"),r=t("./database_index_view"),s=t("./database_sync_view"),a=t("./database_service_view"),t("../lib/notifier"),i=t("../application"),t("../lib/utils"),v=t("./templates/database"),u=null,p=null,d=null,h=null,f=null,g=null,m=!1,l=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)_.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(n,e),n.prototype.template=v,n.prototype.className="ui standard story_modal modal fullscreen",n.prototype.initialize=function(){return this.applicationProfileModel=i.getApplicationProfileModel(),this.editorProfileModel=i.getEditorProfileModel(),this.previewProfileModel=i.getPreviewProfileModel()},n.prototype.events={"click .help_button":"helpFn"},n.prototype.helpFn=function(){return window.openTarget("http://soft.xiaoshujiang.com/docs/tutorial/database/")},n.prototype.afterRender=function(){if(MINI_WEB&&!MAC_STORE_WEB&&this.$el.find(".sync_item").remove(),"client"===STORY_PLATFORM)return this.$el.find(".item.service_item").css("display","")},n.prototype.hide=function(){return m=!0,this.$el.modal("setting","transition","horizontal flip")},n.prototype.destroy=function(){return m=!1,null!=p&&p.remove(),p=null,null!=d&&d.remove(),d=null,null!=h&&h.remove(),h=null,null!=f&&f.remove(),f=null,u=null,g.$el.modal("destroy"),g.remove(),g=null},n.prototype.show=function(){var e,n;return g?(g.$el.modal("show"),void(m=!1)):(g=this,this.render(),this.dimmer=this.$el.dimmer({closable:!1,onHide:function(){return g.$el.find(">.dimmer").empty()},onShow:function(){return g.$el.find(">.dimmer").html('<div class="ui indeterminate text loader">\u6570\u636e\u51c6\u5907\u4e2d...</div>')}}),this.$el.modal({closable:!1,onHidden:function(){if(!m)return g.destroy()},onApprove:function(){return null!=u?u.save():void 0}}),this.$el.find(".ui.menu .item").tab({onFirstLoad:function(e){var t,n,i,l;return"local"===e?(n=g.$el.find(".database_local_tab"),p=new o({databaseView:g}),n.html("").append(p.render().$el),u=p):"index"===e?(t=g.$el.find(".database_index_tab"),d=new r({databaseView:g}),t.html("").append(d.render().$el),u=d):"sync"===e?(l=g.$el.find(".database_sync_tab"),h=new s({databaseView:g}),l.html("").append(h.render().$el),u=h):"service"===e?(i=g.$el.find(".database_service_tab"),f=new a({databaseView:g}),i.html("").append(f.render().$el),u=f):void 0},onLoad:function(e){return"local"===e?u=p:"index"===e?u=d:"sync"===e?u=h:"service"===e?u=f:void 0}}),this.$el.find(".ui.menu .item[data-tab=local]").tab("change tab","local"),e=t("../lib/dynamic_import/import_calendar"),n=t("../lib/dynamic_import/import_pouchdb_replication_stream"),async.map([e,n],(function(e,t){return e(t)}),(function(){return g.$el.modal("show")})))},n}(c),n.exports=l}}),window.requirejs.define({"views/decision_map_window_view":function(e,t,n){var i,r,o,a,s,l=function(e,t){for(var n in t)c.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e},c={}.hasOwnProperty;s=t("../lib/notifier"),t("../lib/utils"),i=t("../application"),r=t("./base_window_manager_view"),t("../constant"),t("../lib/pouchdb_index_view_manager"),o=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return l(t,e),t.prototype.local_storage_name="decision_map_window_manager",t}(r),a=function(e){var t,n,r,a;function c(){return c.__super__.constructor.apply(this,arguments)}return l(c,e),c.prototype.className="draggable_dialog_content_container",n=null,r=null,null,a=null,t=null,function(e,t,n,i){return r.showDimmer("\u7d22\u5f15\u4e2d:"+e+" / "+t)},c.prototype.initialize=function(e){return a=e.initDocs},c.prototype.events={"click .load_github_demo_btn":"loadGithubDemoFn"},c.prototype.loadGithubDemoFn=function(){if(t)return r.showDimmer(),$.getJSON("./media/suziwen_github.json",(function(e){return t.dataLoading(e),r.hideDimmer()}))},c.prototype.show=function(){var e,n,a;if(e=!1,(n=i.getUserModel().get("user"))&&n.vip&&(e=!0),"web"===STORY_PLATFORM&&(e=!0),e)return(r=new o).show(),this.render(),r.$el.find(".draggable_dialog_content_container_wrapper").append(this.$el),r.on("beforeClose",(function(){if(t)return t.destroy(),t=null})),r.on("close",(a=this,function(){return a.trigger("close"),a.remove(),r=null}));s.showMessage("\u8be5\u529f\u80fd\u53ea\u5bf9\u4f1a\u5458\u5f00\u653e",6e3,"error")},c.prototype.render=function(){var e,o,l,c,u;return c=this,l="","web"===STORY_PLATFORM&&(l='<div class="load_github_demo_data_container transition hidden" style="position: absolute;bottom: 0;left: 0;margin: 2em;">\n  <button class="circular ui icon button massive positive load_github_demo_btn" title="\u52a0\u8f7d Github \u6f14\u793a\u6570\u636e">\n    <i class="icon centercode"></i>\n  </button>\n</div>'),u="./tagdecision/index.html","production"!==ENV&&(u="./tagdecisiondev/index.html"),e=$('<div class="draggable_dialog_content iframe_wrapper" style="overflow:hidden;">\n'+l+"\n</div>"),(o=$('<iframe allowfullscreen src="'+u+'" class="preview_iframe" frameborder="0" style="width: 100%;height:100%;"></iframe>').appendTo(e)).one("load",(function(){var e;return e=o[0],e.contentDocument,(n=e.contentWindow).G6Decision.app.default(n,window).initDecisionMap(a,{changeFileModel:function(e,t){return i.getFileCollection().getModelById(e,(function(e,n){return e?s.showMessage("\u6253\u5f00\u6587\u4ef6\u5931\u8d25:"+e,6e3,"error"):n?t?$(window).trigger("createNewEditor",[n]):$(window).trigger("changeFileModel",[n]):s.showMessage("\u6253\u5f00\u6587\u4ef6\u5931\u8d25: \u627e\u4e0d\u5230\u8be5\u6587\u4ef6",6e3,"error")}))},showError:function(e){return s.showMessage("\u52a0\u8f7d\u7ed3\u70b9\u4fe1\u606f\u51fa\u9519:"+e,6e3,"error")},showDimmer:function(e){return r.showDimmer(e)},hideDimmer:function(){return r.hideDimmer()},openTarget:window.openTarget},(function(e,n){if(t=n,"web"===STORY_PLATFORM)return setTimeout((function(){return c.$el.find(".load_github_demo_data_container").transition("horizontal flip")}),3e3)}))})),this.$el.html(e),r.showDimmer()},c.prototype.remove=function(){return n=null,r=null,null,a=null,t=null,c.__super__.remove.apply(this,arguments)},c.prototype.close=function(){return r.remove()},c}(Backbone.View),n.exports=a}}),window.requirejs.define({"views/drawio_component/drawio_manager_view":function(e,t,n){var i,r,o,a,s,l,c,u,d,p,f=function(e,t){return function(){return e.apply(t,arguments)}},h={}.hasOwnProperty;c=t("../view"),l=t("../../lib/utils"),i=t("../../application"),t("../../lib/resource_core"),r=t("../../models/attachment_model"),s=t("../../lib/notifier"),o=t("../../constant"),d=t("./templates/drawio_manager"),t("../../lib/preview_core"),p=null,u=null,a=function(e){function t(){return this.showHistory=f(this.showHistory,this),this.showRevDetail=f(this.showRevDetail,this),this.returnMain=f(this.returnMain,this),this.returnEditor=f(this.returnEditor,this),this.closeWindow=f(this.closeWindow,this),t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)h.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.template=d,t.prototype.className="draggable_dialog_content_container drawio_manager_container",t.prototype.isLoading=!1,t.prototype.isSaving=!1,t.prototype.initValue="",t.prototype.preContent="",t.prototype.hasAutoSave=!1,t.prototype.mode="edit",t.prototype.currentRev=null,t.prototype._debounceAutoSave=null,t.prototype.editor=null,t.prototype.initialize=function(e){return this.fileModel=e.fileModel,this.link=e.link,this.filename=e.link.replace(/^[\.\/]*/g,""),this.popupManager=e.popupManager,this.initValue=e.initValue,p=this},t.prototype.events={"click .ui.cancel.button":"closeWindow","click .return_editor_button":"returnEditor","click .ui.button.positive":"save","click .return_button":"returnMain","click .use_current_version_button":"useCurrentVersion","click .history_button":"showHistory","click .rev_info":"showRevDetail"},t.prototype.closeWindow=function(){return this.popupManager.close()},t.prototype.returnEditor=function(){return this.setMode("edit")},t.prototype.returnMain=function(){return this.setMode("revList")},t.prototype.useCurrentVersion=function(){return this.revContent&&this.setContent(this.revContent),this.setMode("edit")},t.prototype._showRevDetail=function(e,t){var n,i;return this.currentRev=t,n=o.pouchDB,this.showDimmer(),i=this.fileModel.id+"__"+this.filename,n.getAttachment(i,"attachment",{rev:t},(function(n,i){return n?(s.showMessage("\u52a0\u8f7d\u5386\u53f2\u7248\u672c\u51fa\u9519:"+n,6e3,"error"),p.hideDimmer()):l.blobToString(i,(function(n,i){return n?(p.hideDimmer(),s.showMessage("\u52a0\u8f7d\u5386\u53f2\u7248\u672c\u51fa\u9519:"+n,6e3,"error")):(p.hideDimmer(),p.revContent=i,p.rev=t,i=l.filterDrawioDisplayContent(i),e.innerHTML=i)}))}))},t.prototype.showRevDetail=function(e){var t,n;return t=$(e.currentTarget).data("value"),this.setMode("revDetail"),null,n=this.$el.find(".drawio_history_detail_container")[0],p._showRevDetail(n,t)},t.prototype._showHistory=function(){var e,t,n;return t=o.pouchDB,n=this.fileModel.id+"__"+this.filename,(e=this.$el.find(".drawio_history_container tbody")).empty(),this.showDimmer(),t.get(n,{conflicts:!1,revs_info:!0},(function(t,n){var i,r;return t?s.showMessage("\u52a0\u8f7d\u6587\u4ef6\u5386\u53f2\u8bb0\u5f55\u51fa\u9519\uff1a"+t,6e3,"error"):(r=n._revs_info,i=r.length,r.forEach((function(t,n){var r;return r="","missing"===t.status&&(r="error"),e.append("<tr data-value='"+t.rev+"' class='rev_info "+r+"'><td class='rev_index center aligned' data-index='"+(i-n)+"'>"+(i-n)+"</td><td class='rev_detail' colspan='2'>"+t.rev+"</td></tr>")}))),p.hideDimmer()}))},t.prototype.showHistory=function(e){var t;return $(e.currentTarget),"revList"===(t=p.mode)||"revDetail"===t?this.setMode("edit"):(this.setMode("revList"),this._showHistory())},t.prototype.setMode=function(e){var t;switch(p.mode=e,t=this.$el.find(".history_button"),p.revContent=null,p.rev=null,e){case"revList":return this.$el.find(".close_button, .save_button, .save_format").hide(),this.$el.find(".return_button, .use_current_version_button").hide(),this.$el.find(".return_editor_button").show(),t.addClass("blue").removeClass("basic").show(),this.$el.find(".drawio_history_detail_container").hide(),this.$el.find(".drawio_editor_container").hide(),this.$el.find(".drawio_history_container").show();case"revDetail":return this.$el.find(".return_button, .use_current_version_button").show(),this.$el.find(".return_editor_button").hide(),t.addClass("blue").removeClass("basic").show(),this.$el.find(".drawio_history_detail_container").show(),this.$el.find(".drawio_history_container").hide(),this.$el.find(".drawio_editor_container").hide();default:return this.$el.find(".return_button, .use_current_version_button").hide(),this.$el.find(".return_editor_button").hide(),t.removeClass("blue").addClass("basic").show(),this.$el.find(".close_button, .save_button, .save_format").show(),this.$el.find(".drawio_history_detail_container").hide(),this.$el.find(".drawio_history_container").hide(),this.$el.find(".drawio_editor_container").show()}},t.prototype.save=function(){var e;return e="image",e=p.$el.find("input[name=save_format]:checked").val()||e,i.getUserModel().get("user"),p._save(e)},t.prototype._autoSave=function(){var e,t,n,i,o,a,s,l;if(!p.isSaving&&p.editor){if(l=p.editor.getXSJData(),n=l.xml,p.preContent===n)return;return s=p.saveTranformContent("svg",l),a=this.filename,i=this.fileModel.id,o="text/html",/drawio\.svg$|drawio\.png$/i.test(this.filename)&&(o="image/svg+xml"),t=new Blob([s],{type:o}),(e=p.$el.find(".ui.button.positive")).addClass("loading"),r.createAttachment(i,a,o,t,(function(t,i){return p.preContent=n,p.isSaving=!1,p.hasAutoSave=!0,e.removeClass("loading")}))}},t.prototype.saveTranformContent=function(e,t){var n,r,o,a,s,l,c,u,d,p,f,h;return null==e&&(e="svg"),/drawio\.svg$|drawio\.png$/i.test(this.filename)?(u='<div>\n  <div class="xsj_drawio_svg"></div>\n  <div class="xsj_drawio_xml" style="display:none;"></div>\n</div>',(r=$(u)).find(".xsj_drawio_xml").text(t.xml),r.find(".xsj_drawio_svg").html(t.svg),n=r.find("switch>foreignObject>div"),a=r.find("switch>text"),n.addClass("xsj_foreignObject xsj_drawio_foreignObject"),o=r.find(".xsj_drawio_svg>svg"),a.remove(),o[0].setAttribute("content",t.xml),(d=document.implementation.createDocument("","",null).createElement("div")).appendChild(o[0]),'<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n'+d.innerHTML):"svg"===e?(u='<div>\n  <div class="xsj_drawio_svg"></div>\n  <div class="xsj_drawio_xml" style="display:none;"></div>\n</div>',(r=$(u)).find(".xsj_drawio_xml").text(t.xml),r.find(".xsj_drawio_svg").html(t.svg),n=r.find("switch>foreignObject>div"),a=r.find("switch>text"),h=(o=r.find(".xsj_drawio_svg>svg")).attr("width")||"800px",f=parseInt(h)||"800",l=o.attr("height")||"600px",s=parseInt(l)||"600",o.attr("viewBox","0 0 "+f+" "+s),o.attr("width","100%"),o.attr("height","100%"),o[0].classList.add("xsj_svg_viewbox"),o.css("max-width",h),o.css("max-height",l),a.remove(),n.addClass("xsj_foreignObject xsj_drawio_foreignObject"),r[0].outerHTML):(u='<div>\n  <div class="xsj_drawio_image"></div>\n  <div class="xsj_drawio_xml" style="display:none;"></div>\n</div>',(r=$(u)).find(".xsj_drawio_xml").text(t.xml),c=t.png,(null!=(p=i.getUserModel().get("user"))?p.vip:void 0)&&(c=t.png),r.find(".xsj_drawio_image").html("<img class='xsj_drawio_image_html' src='"+c+"' />"),r[0].outerHTML)},t.prototype._save=function(e){var t,n,i,r;if(null==e&&(e="svg"),r="text/html",/drawio\.svg$|drawio\.png$/i.test(this.filename)&&(r="image/svg+xml"),i=this.filename,n=this.fileModel,!p.isSaving)return p.editor?(p.isSaving=!0,(t=p.$el.find(".ui.button.positive")).addClass("loading"),p.editor.getAsyncXSJData((function(o,a){return o?(s.showMessage("\u4fdd\u5b58\u5931\u8d25:"+o,6e3,"error"),p.isSaving=!1,t.removeClass("loading")):function(e,t){var n;return n=l.dataURL2Blob(e.png),watermark([n],{type:"image/png"}).blob(watermark.text.lowerRight("\u4e66","bold 48px webfontxiaoshujiang","#2f2f2f",.5)).then((function(n){return watermark.destroy(),l.blob2DataURL(n,(function(n,i){return e.pngWatermarker=i,t(null,e)}))})).catch((function(e){return watermark.destroy(),t(e)}))}(a,(function(o,a){var l,c,u;return o&&console.error(o),u=p.saveTranformContent(e,a),l=a.xml,p.preContent!==l||p.hasAutoSave?(i||(i=Date.now()+".drawio.html"),c=new Blob([u],{type:r}),n.addAttachment(c,i,r,{fixRepeatFilename:!1},(function(e,i,r,o){return n.trigger("attachmentChange",n,i,"url_image_./"+i),n.trigger("attachmentChange",n,i,"url_xsj_remote_html_./"+i),s.showMessage("\u4fdd\u5b58\u6210\u529f",6e3,"info"),p.preContent=l,p.hasAutoSave=!1,p.isSaving=!1,t.removeClass("loading"),p.closeWindow()}))):(s.showMessage("\u4fdd\u5b58\u6210\u529f",6e3,"info"),p.closeWindow())}))}))):void 0},t.prototype.afterRender=function(){return this.popupManager.setTitle(this.filename)},t.prototype.close=function(){var e;return null!=(e=p.editor)&&e.removeListener("xsjContentChanged"),p.stopListening(),p.editor=null,p=null,null,u=null,this.remove()},t.prototype.reInit=function(e){var t,n,i;if(t=this.fileModel,e.fileModel&&e.fileModel!==this.fileModel&&(this.stopListening(this.fileModel),this.fileModel=e.fileModel),n=this.filename,this.fileModel,this.link=e.link,this.filename=e.link.replace(/^[\.\/]*/g,""),this.popupManager.setTitle(this.filename),n!==this.filename||t.id!==this.fileModel.id)return null!=(i=p.editor)&&i.removeListener("xsjContentChanged",p._debounceAutoSave),p.isLoading=!0,p.showDimmer(),this.loadData((function(e,t){return p.isLoading=!1,e?s.showMessage("\u52a0\u8f7d\u6587\u4ef6\u51fa\u9519:"+e,6e3,"error"):p.setContent(t),p.editor.addListener("xsjContentChanged",p._debounceAutoSave),p.hideDimmer()}))},t.prototype.show=function(e){return this.render(),this.$el.find(".return_button, .return_editor_button, .use_current_version_button").hide(),e.append(this.$el),this.showContent((t=this,function(e){if(t.initValue)return p.editor.initXSJDefaultDiagram({initValue:t.initValue,title:t.fileModel.get("title")})}));var t},t.prototype.showDimmer=function(){return p.popupManager.showDimmer()},t.prototype.hideDimmer=function(e){if(null==e&&(e=!1),e||!p.isLoading)return p.popupManager.hideDimmer()},t.prototype.showContent=function(e){var t,n;return n="drawio/xsj.html","client"===STORY_PLATFORM&&(n+="?cors=.*"),t=$('<iframe src="'+n+'" class="preview_iframe" frameborder="0" style="width: 100%;height:100%;"></iframe>').appendTo(this.$el.find(".drawio_editor_container")),p.isLoading=!0,p.showDimmer(),t.on("load",(function(){var n;n=t[0],n.contentDocument,(u=n.contentWindow).addEventListener("click",(function(){return p.popupManager.focus()})),p._debounceAutoSave=_.debounce((function(){return null!=p?p._autoSave(!0):void 0}),1e4),u.App.main((function(t){return p.editor=t,u.mxClient.IS_CHROMEAPP=!1,p.loadData((function(t,n){return p.isLoading=!1,p.hideDimmer(),t?s.showMessage("\u52a0\u8f7d\u6570\u636e\u5931\u8d25:"+t,6e3,"error"):(n&&p.setContent(n),p.editor.addListener("xsjContentChanged",p._debounceAutoSave)),"function"==typeof e?e(p.editor):void 0}))}))}))},t.prototype.loadData=function(e){var t,n,i,o,a;return o=this.fileModel,a=this.filename,/drawio\.svg$|drawio\.png$/i.test(a)?this.$el.find(".save_format").addClass("drawio_fixed_format"):this.$el.find(".save_format").removeClass("drawio_fixed_format"),(i=new r({_id:o.id+"__"+a})).fetch({options:{get:{attachments:!0}}}).then((function(e){return n(i,t)})).catch((function(e){return n(i,t)})),n=function(e,t){var n,i,r,o,a;return(i=e.get("_attachments"))&&i.attachment?(r=(n=i.attachment).data,a=n.content_type,o=l.base642Blob(r,a),l.blobToString(o,(function(e,n){return t(e,n)}))):t(null,null)},t=function(t,n){return o.getAttachObjectByFilename(a,(function(t,i){var r;return"",(r=null!=i?i.objectUrl:void 0)?l.objectURLToString(r,(function(t,i){return n&&i!==n&&(i=n,s.showMessage("\u60a8\u4e0a\u6b21\u7f16\u8f91\u7684\u6587\u4ef6\u672a\u53ca\u65f6\u4fdd\u5b58\uff0c\u7cfb\u7edf\u81ea\u52a8\u4f7f\u7528\u6700\u65b0\u4e00\u4e2a\u7248\u672c\u7684\u5185\u5bb9\uff0c\u60a8\u53ef\u4ee5\u901a\u8fc7\u5386\u53f2\u8bb0\u5f55\u5207\u6362\u5230\u60f3\u8981\u7684\u7248\u672c\u3002",6e3,"warning")),e(t,i)})):e(null,"")}))}},t.prototype.convertFileDataToTableStr=function(e,t){if(this.editor)return this.editor.convertFileDataToTableStr(e,t)},t.prototype.filterContent=function(e){return/drawio\.svg$|drawio\.png$/i.test(this.filename)?e:l.filterDrawioContent(e)},t.prototype.setContent=function(e){if(e||(e=""),!p.isLoading&&u)return(e=p.filterContent(e))||(e=""),p.preContent=e,p.editor.openLocalFile(e,p.filename,null,!0)},t}(c),n.exports=a}}),window.requirejs.define({"views/drawio_component/templates/drawio_manager":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<div class="draggable_dialog_content">\n<div class="drawio_editor_container iframe_wrapper" style="width:100%;height:100%;overflow:hidden;"></div>\n<div class="drawio_history_container history_container" style="width: 100%; display:none;">\n<table class="ui celled structured table revs_info selectable">\n<thead>\n<tr>\n<th class="one wide"></th>\n<th class="ten wide" colspan="2">\u7248\u672c\u53f7</th>\n</tr>\n</thead>\n<tbody></tbody>\n</table>\n</div>\n<div class="drawio_history_detail_container history_detail_container" style="width: 100%;display:none;overflow:auto;"></div>\n</div>\n<div class="draggable_dialog_footer actions">\n<div class="tips">\n<div class="ui mini basic button history_button icon"><i class="icon history" title="\u5386\u53f2\u8bb0\u5f55"></i></div>\n</div>\n<span class="save_format">\n\u4fdd\u5b58\u683c\u5f0f\uff1a\n<input type="radio" name="save_format" id="save_format_svg" value="svg" checked/>\n<label for="save_format_svg">svg</label>\n<input type="radio" name="save_format" id="save_format_image" value="image"/>\n<label for="save_format_image">\u56fe\u7247</label>\n</span>\n<div class="ui mini basic button return_button">\u8fd4\u56de</div>\n<div class="ui mini basic button return_editor_button">\u53d6\u6d88</div>\n<div class="ui mini basic button use_current_version_button">\u4f7f\u7528\u8be5\u7248\u672c</div>\n<div class="ui cancel mini button close_button">\n\u5173\u95ed\n</div>\n<div class="ui positive mini button save_button">\n<span>\u4fdd\u5b58</span>\n</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/dropdown_tag_name_view":function(e,t,n){var i,r,o,a,s={}.hasOwnProperty;r=t("./view"),t("../constant"),o=t("./templates/dropdown_tag_name"),a=null,i=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)s.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.template=o,t.prototype.className="ui multiple dropdown dropdown_tag_name_container",t.prototype.initialize=function(e){var t,n;return(a=this).getDB=e.getDB,t="",n=function(){var n;if(a&&(n=a.getQueryTags().join(","))!==t)return"function"==typeof e.searchTrigger&&e.searchTrigger(),t=n},a.searchDocument=_.debounce(n,200)},t.prototype.events={"click .tag_recommends .ui.label":"toggleRecommendTag"},t.prototype.toggleRecommendTag=function(e){var t,n;return(t=$(e.currentTarget)).data("value"),n=t.hasClass("active"),a.$el.find(".tag_recommends .ui.label").removeClass("active"),n||t.addClass("active"),a.searchDocument()},t.prototype.show=function(){return a.$el.show()},t.prototype.hide=function(){return a.$el.hide()},t.prototype.init=function(){return a.getDB().query("query_index/by_tagNames",{reduce:!0,group:!0}).then((function(e){var t,n,i,r,o,s,l,c,u,d;if(a){for(d=e.rows,a.tags=_.sortBy(d,"value"),c="",t=0,i=(o=a.tags).length;t<i;t++)c+='<div class="item" data-value="'+(l=o[t]).key+'">\n  '+l.key+"\n</div>";for(function(e,t){return e+","+t.key},u="",n=0,r=(s=_.first(d,5)).length;n<r;n++)u+="<a class='ui label' data-value='"+(l=s[n]).key+"'>"+l.key+"</a>";return u="<span class='ui labels mini'>"+u+"</span>",a.$el.find(".tag_recommends").html(u),a.$el.find(".menu_items").html(c),a.$el.dropdown({maxSelections:5,onChange:function(){var e;if(e=a.$el.dropdown("is visible"),a.$el.find(".tag_recommends .ui.label").removeClass("active"),!e)return a.searchDocument()},onShow:function(){return a.$el.find(".tag_recommends").hide(),!0},onHide:function(){var e;return e=a.$el.dropdown("get value"),_.compact(e.split(",")).length>0?a.$el.find(".tag_recommends").hide():a.$el.find(".tag_recommends").show(),a.searchDocument(),!0}})}})).catch((function(e){return console.log("error")}))},t.prototype.remove=function(){return a.$el.dropdown("destroy"),a=null,t.__super__.remove.call(this)},t.prototype.getQueryTags=function(){var e,t,n,i,r,o;if(o=[],n=a.$el.dropdown("get value"))o=n.split(",");else for(e=0,t=(i=a.$el.find(".tag_recommends .ui.label.active").toArray()).length;e<t;e++)r=i[e],o.push($(r).data("value"));return _.uniq(_.compact(o),!0).sort()},t}(r),n.exports=i}}),window.requirejs.define({"views/editor_buttons_codemirror_view":function(e,t,n){var i,r,o,a,s={}.hasOwnProperty;o=t("./view"),a=t("./templates/editor_buttons_codemirror"),i=t("../application"),r=function(e){var t,n;function r(){return r.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)s.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(r,e),r.prototype.template=a,r.prototype.className="editor_buttons_codemirror ui form",r.prototype.editorProfileModel=null,n=null,t=_.debounce((function(e,t){return n.save(e,t)}),300),r.prototype.initialize=function(){return n=i.getEditorProfileModel(),this.editorProfileModel=n},r.prototype.getRenderData=function(){return{cm_autopreview:this.editorProfileModel.get("cm_autopreview")?"checked":void 0,cm_autopreview_inline:this.editorProfileModel.get("cm_autopreview_inline")?"checked":void 0,cm_autopreview_link:this.editorProfileModel.get("cm_autopreview_link")?"checked":void 0,cm_autopreview_image:this.editorProfileModel.get("cm_autopreview_image")?"checked":void 0,cm_autopreview_header:this.editorProfileModel.get("cm_autopreview_header")?"checked":void 0,cm_autopreview_hr:this.editorProfileModel.get("cm_autopreview_hr")?"checked":void 0,cm_autopreview_table:this.editorProfileModel.get("cm_autopreview_table")?"checked":void 0,cm_autopreview_yaml:this.editorProfileModel.get("cm_autopreview_yaml")?"checked":void 0,cm_autopreview_mathjax:this.editorProfileModel.get("cm_autopreview_mathjax")?"checked":void 0,cm_autopreview_todo:this.editorProfileModel.get("cm_autopreview_todo")?"checked":void 0,cm_autopreview_fenced_code:this.editorProfileModel.get("cm_autopreview_fenced_code")?"checked":void 0,cm_autopreview_emoji:this.editorProfileModel.get("cm_autopreview_emoji")?"checked":void 0,cm_autopreview_html:this.editorProfileModel.get("cm_autopreview_html")?"checked":void 0,cm_autopreview_mermaid:this.editorProfileModel.get("cm_autopreview_mermaid")?"checked":void 0,cm_autopreview_flow:this.editorProfileModel.get("cm_autopreview_flow")?"checked":void 0,cm_autopreview_sequence:this.editorProfileModel.get("cm_autopreview_sequence")?"checked":void 0,cm_autopreview_plantUML:this.editorProfileModel.get("cm_autopreview_plantUML")?"checked":void 0,cm_autopreview_toc:this.editorProfileModel.get("cm_autopreview_toc")?"checked":void 0,cm_autopreview_footnote:this.editorProfileModel.get("cm_autopreview_footnote")?"checked":void 0,cm_autopreview_ruby:this.editorProfileModel.get("cm_autopreview_ruby")?"checked":void 0,cm_typewriterScrolling:this.editorProfileModel.get("cm_typewriterScrolling")?"checked":void 0,cm_minimap:this.editorProfileModel.get("cm_minimap")?"checked":void 0,cm_highlightActive:this.editorProfileModel.get("cm_highlightActive")?"checked":void 0,cm_styleStackFocusLine:this.editorProfileModel.get("cm_styleStackFocusLine")?"checked":void 0,cm_smartIndent:this.editorProfileModel.get("cm_smartIndent")?"checked":void 0,cm_indentWithTabs:this.editorProfileModel.get("cm_indentWithTabs")?"checked":void 0,cm_showInvisibles:this.editorProfileModel.get("cm_showInvisibles")?"checked":void 0,cm_lineNumbers:this.editorProfileModel.get("cm_lineNumbers")?"checked":void 0,cm_autoCloseBrackets:this.editorProfileModel.get("cm_autoCloseBrackets")?"checked":void 0,cm_lineWrapping:this.editorProfileModel.get("cm_lineWrapping")?"checked":void 0,cm_scrollPastEnd:this.editorProfileModel.get("cm_scrollPastEnd")?"checked":void 0,cm_autopreviewHoveredImage:this.editorProfileModel.get("cm_autopreviewHoveredImage")?"checked":void 0,cm_activeCursorMathjax:this.editorProfileModel.get("cm_activeCursorMathjax")?"checked":void 0,cm_spellChecker:this.editorProfileModel.get("cm_spellChecker")?"checked":void 0,cm_markerColorpicker:this.editorProfileModel.get("cm_markerColorpicker")?"checked":void 0,cm_variableHeight:this.editorProfileModel.get("cm_variableHeight")?"checked":void 0}},r.prototype.events={"change input":"inputChangeFn"},r.prototype.inputChangeFn=function(e){var n,i;return"cm_keyBindings"===(i=(n=$(e.currentTarget)).attr("name"))?t("cm_keyBinding",n.val()):t(i,n.is(":checked"))},r.prototype.afterRender=function(){var e;return e=this.editorProfileModel.get("cm_keyBinding"),this.$el.find("input[name=cm_keyBindings][value="+e+"]").prop("checked",!0),this.$el.find(".ui.checkbox").checkbox()},r.prototype.remove=function(){return this.$el.find(".ui.checkbox").checkbox("destroy"),r.__super__.remove.call(this)},r}(o),n.exports=r}}),window.requirejs.define({"views/editor_buttons_config_view":function(e,t,n){var i,r,o,a,s,l,c,u,d,p={}.hasOwnProperty;s=t("./view"),r=t("./editor_buttons_codemirror_view"),u=t("./templates/editor_buttons_config"),i=t("../application"),a=t("../lib/utils_size"),c=a.pageSizeMap,d=a.viewportSizeMap,l=null,o=function(e){var t,n,o,a,s,f,h,m;function v(){return v.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)p.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(v,e),v.prototype.className="icon dropdown ui icon button editor_config_button",v.prototype.template=u,v.prototype.editorView=null,o=null,a=null,s=function(){var e;return e=a.get("fontSize"),parseInt(e)||16},f=function(){var e;return e=a.get("lineHeight"),e=parseFloat(e)||1.4,Math.round(10*e)/10},v.prototype.events={"click .change_font_size_btn":"changeFontSizeFn","click .change_line_height_btn":"changeLineHeightFn","change .editor_viewport_size_select":"changeViewPortSizeSelectFn","change .editor_viewport_align_select":"changeViewPortAlignFn","keyup .editor_viewport_size_input":"changeViewPortSizeFn"},m=_.debounce((function(e){return a.save("viewportWidth",e)}),300),h=_.debounce((function(e){return a.save("viewportAlign",e)}),300),v.prototype.changeViewPortSizeSelectFn=function(e){var t;return t=$(e.currentTarget).val(),this.$el.find(".editor_viewport_size_input").val(t),m(t)},v.prototype.changeViewPortSizeFn=function(e){var t;if(13===e.keyCode)return t=$(e.currentTarget),m(t.val())},v.prototype.changeViewPortAlignFn=function(e){var t;return t=$(e.currentTarget),h(t.val())},t=_.debounce((function(e){return a.save("fontSize",e)}),300),n=_.debounce((function(e){return a.save("lineHeight",e)}),300),v.prototype.changeFontSizeFn=function(e){var n,i,r;return i=(n=$(e.currentTarget)).data("type"),r=n.parent().data("fontSize"),"minus"===i?r>=10&&(r-=1):"plus"===i&&r<30&&(r+=1),l.$el.find(".editor_font_size").html(r),t(r),n.parent().data("fontSize",r)},v.prototype.changeLineHeightFn=function(e){var t,i,r;return i=(t=$(e.currentTarget)).data("type"),r=t.parent().data("lineHeight"),"minus"===i?r>=1&&(r-=.1,r=Math.round(10*r)/10):"plus"===i&&r<=4&&(r+=.1,r=Math.round(10*r)/10),t.parent().data("lineHeight",r),n(r),l.$el.find(".editor_line_height").html(r)},v.prototype.plusFontHeightFn=function(){var e;if((e=f())<=4)return e+=.1,e=Math.round(10*e)/10,a.save("lineHeight",e),l.$el.find(".editor_line_height").html(e)},v.prototype.initialize=function(e){return l=this,this.editorView=e.editorView,a=i.getEditorProfileModel()},v.prototype.afterRender=function(){var e,t;for(e in d)t=d[e],l.$el.find(".editor_viewport_size_select").append('<option value="'+t[0]+'">'+e+"</option>");for(e in c)t=c[e],l.$el.find(".editor_viewport_size_select").append('<option value="'+t[0]+'cm">'+e+"</option>");return this.$el.dropdown({action:function(){},saveRemoteData:!1,forceSelection:!1,filterRemoteData:!1,className:{selected:"skip_selected"},delay:{hide:1e3},onShow:function(){var e,t,n,i,c,u;switch(t=l.editorView.editorType,n=s(),i=f(),u=a.get("viewportWidth"),c=a.get("viewportAlign"),l.$el.find(".editor_font_size_item").data("fontSize",n),l.$el.find(".editor_font_size").html(n),l.$el.find(".editor_line_height_item").data("lineHeight",i),l.$el.find(".editor_line_height").html(i),l.$el.find(".editor_viewport_size_input").val(u),l.$el.find(".editor_viewport_align_select").val(c),e=l.$el.find(".editor_config_container"),t){case"codemirror":(o=new r).render(),e.append(o.$el)}return!0},onHide:function(){if(o)return o.remove(),o=null}})},v}(s),n.exports=o}}),window.requirejs.define({"views/editor_buttons_view":function(e,t,n){var i,r,o,a,s,l,c,u,d,p,f=function(e,t){return function(){return e.apply(t,arguments)}},h={}.hasOwnProperty;d=t("./view"),l=t("./task_list_window_view"),s=t("./mark_list_window_view"),a=t("./link_relation_window_view"),c=t("./toc_dropdown_view"),t("./external_editor_view"),r=t("./editor_buttons_config_view"),t("../lib/notifier"),i=t("../application"),u=t("../lib/utils"),p=t("./templates/editor_buttons"),o=function(e){var t,n,o,d;function m(){return this.changeHistory=f(this.changeHistory,this),this.selectEditor=f(this.selectEditor,this),this.toggleFullScreen=f(this.toggleFullScreen,this),m.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)h.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(m,e),m.prototype.template=p,m.prototype.zen=!1,m.prototype.className="editor_buttons animation_icon_tips_container",m.prototype.fileModel=null,d=null,n=null,o=null,t=null,m.prototype.initialize=function(e){var t,n,r,o;return t=this,n=i.getEditorProfileModel(),r=i.getTourModel(),n.get("editorType"),n.get("writingMode"),this.editorView=e.editorView,this.fileModel=e.editorView.fileModel,$(window).on("execCommand",(function(e,t){if("toggleEditorTocPanel"===t&&d)return d.toggle()})),$(window).on("showTaskListWindow",(function(e,n){return t.showTaskListWindow(n)})),$(window).on("fileModelChanged",(function(e,n){var i;return t.fileModel&&t.fileModel.off("change:_conflicts"),t.fileModel=n,(i=t.fileModel.get("_conflicts"))&&i.length>0?(t.$el.find(".history_button>.icon_tip").html("\u6587\u4ef6\u5b58\u5728\u51b2\u7a81\uff0c\u8bf7\u53ca\u65f6\u5408\u5e76"),t.$el.addClass("editor_buttons_conflicts"),t.$el.find(".history_button_icons").replaceWith('<i class="icons history_button_icons" style="transform: scale(2,2);" title="\u6587\u4ef6\u5b58\u5728\u51b2\u7a81\uff0c\u8bf7\u53ca\u65f6\u5408\u5e76">\n<i class="history icon faa-flash animated faa-slow"></i>\n<i class="bottom right corner warning sign icon"></i>\n</i>')):(t.$el.removeClass("editor_buttons_conflicts"),t.$el.find(".history_button>.icon_tip").html("\u5386\u53f2\u8bb0\u5f55"),t.$el.find(".history_button_icons").replaceWith('<i class="icon history history_button_icons" title="\u5386\u53f2\u8bb0\u5f55">')),n.on("change:_conflicts",(function(e,n){return n&&n.length>0?(t.$el.addClass("editor_buttons_conflicts"),t.$el.find(".history_button_icons").replaceWith('<i class="icons history_button_icons" style="transform: scale(2,2);" title="\u6587\u4ef6\u5b58\u5728\u51b2\u7a81\uff0c\u8bf7\u53ca\u65f6\u5408\u5e76">\n  <i class="history icon faa-flash animated faa-slow"></i>\n  <i class="bottom right corner warning sign icon"></i>\n</i>'),t.$el.find(".history_button>.icon_tip").html("\u6587\u4ef6\u5b58\u5728\u51b2\u7a81\uff0c\u8bf7\u53ca\u65f6\u5408\u5e76")):(t.$el.removeClass("editor_buttons_conflicts"),t.$el.find(".history_button>.icon_tip").html("\u5386\u53f2\u8bb0\u5f55"),t.$el.find(".history_button_icons").replaceWith('<i class="icon history history_button_icons" title="\u5386\u53f2\u8bb0\u5f55">'))}))})),$(window).on("editorZenModeChange",(o=this,function(e,t){var n,i;return o.zen=t,n=o.$el.find(".zen_button>i.icon"),i=o.$el.find(".zen_button"),o.zen?(r.canPrompt("editor_zen_learned")&&setTimeout((function(){return i.popup({on:"manual",position:"bottom right",onRemove:function(){return i.removeClass("active")},onVisible:function(){return i.addClass("active"),this.width(300),this.find(".ok").click((function(){return i.popup("destroy"),r.dontPrompt("editor_zen_learned")}))},html:'<div class="header">\u63d0\u793a</div><div class="content">\u70b9\u51fb\u8fd9\u91cc\u9000\u51fa\u5168\u5c4f<div><a href="javascript:void(0);" class="ok pull-right">\u77e5\u9053\u4e86</a></div></div>',inline:!0}).popup("show")}),1e3),n.attr("title","\u9000\u51fa\u5199\u4f5c\u6a21\u5f0f"),n.removeClass("expand"),n.addClass("compress"),o.$el.find(".editor_buttons_wrapper").removeClass("reverse gooey_effect").addClass("vertical"),o.$el.find(".editor_config_button").addClass("right pointing")):(i.popup("destroy"),n.attr("title","\u5f00\u542f\u5199\u4f5c\u6a21\u5f0f"),n.addClass("expand"),n.removeClass("compress"),o.$el.find(".editor_buttons_wrapper").addClass("reverse gooey_effect").removeClass("vertical"),o.$el.find(".editor_config_button").removeClass("right pointing"))}))},m.prototype.events={"click .zen_button":"toggleFullScreen","click .editor_type_button .item":"selectEditor","click .history_button":"changeHistory","click .task_list_button":"taskListFn","click .mark_list_button":"markListFn","click .link_relation_button":"linkRelationFn"},m.prototype.showMarkListWindow=function(e){if(n?n.fixPosition(e.pos):((n=new s({fileModel:this.fileModel,editorView:this.editorView})).on("close",(function(){return n=null})),n.show(e.pos)),e.model)return setTimeout((function(){return n.highlightNodeArea(e.model)}),1e3)},m.prototype.showTaskListWindow=function(e){if(o?o.fixPosition(e.pos):((o=new l({fileModel:this.fileModel,editorView:this.editorView})).on("close",(function(){return o=null})),o.show(e.pos)),e.model)return setTimeout((function(){return o.highlightNodeArea(e.model)}),1e3)},m.prototype.markListFn=function(e){var t,i,r;return t=$(e.currentTarget),n?n.close():(i={left:(r=t[0].getBoundingClientRect()).left-400,top:r.bottom-200},this.showMarkListWindow({pos:i}))},m.prototype.taskListFn=function(e){var t,n,i;return t=$(e.currentTarget),o?o.close():(n={left:(i=t[0].getBoundingClientRect()).left-400,top:i.bottom-200},this.showTaskListWindow({pos:n}))},m.prototype.linkRelationFn=function(e){var n;return n=$(e.currentTarget),t?t.close():((t=new a({fileModel:this.fileModel,editorView:this.editorView})).show(n),t.on("close",(function(){return t=null})))},m.prototype.toggleFullScreen=function(){return u.hideAllPopup(),this.zen=!this.zen,$(window).trigger("toggleEditorZenMode",this.zen)},m.prototype.afterRender=function(){var e,t,n,o;if(this,i.getPreviewProfileModel().get("previewLayoutPosition"),this.$el.find(".editor_buttons_wrapper"),e=this.$el.find(".editor_config_button_placeholder"),(o=new r({editorView:this.editorView})).render(),e.replaceWith(o.$el),this.$editorTypeBtn=this.$el.find(".editor_type_button"),MINI_WEB,this.$editorTypeBtn.remove(),n=this,(d=new c({initDragAndDrop:!0,tocType:"editor",setContentFn:function(e){return n.editorView.setValue(e)},$container:this.$el.find(".toc_button_placeholder"),gotoLineFn:function(e,t){var i;return i=function(){var e,t;if((e=n.editorView.editorProxy.editor)&&e.highlightPos)return t=e.getCursor(),e.highlightPos(t)},"top"===e?(n.editorView.gotoLine(0),i()):"bottom"===e?(n.editorView.gotoLine(n.editorView.getLength()-1),i()):(n.editorView.gotoLine(e),i()),"function"==typeof t?t():void 0},getFirstVisibleRowFn:function(e){var t,i,r;return t=i=n.editorView.getFirstVisibleRow(),e&&(r=n.editorView.getLastVisibleRow(),(t=n.editorView.getCursorPosition())<i&&(t=i),t>r&&(t=r)),t},getContentFn:function(){return n.editorView.getValue()},listenToSyncFn:function(e){return n.editorView.on("changeScrollTop",e)},unListenToSyncFn:function(e){return n.editorView.off("changeScrollTop",e)},onHideDropdownFn:function(e){return n.editorView.off("change",e.refresh)},onShowDropdownFn:function(e){return n.editorView.on("change",e.refresh)}})).render(),n.fileModel&&(t=n.fileModel.get("_conflicts"))&&t.length>0)return n.$el.find(".history_button>.icon_tip").html("\u6587\u4ef6\u5b58\u5728\u51b2\u7a81\uff0c\u8bf7\u53ca\u65f6\u5408\u5e76"),n.$el.find(".history_button_icons").replaceWith('<i class="icons history_button_icons" style="transform: scale(2,2);" title="\u6587\u4ef6\u5b58\u5728\u51b2\u7a81\uff0c\u8bf7\u53ca\u65f6\u5408\u5e76">\n<i class="history icon faa-flash animated faa-slow"></i>\n<i class="bottom right corner warning sign icon"></i>\n</i>')},m.prototype.selectEditor=function(e){},m.prototype.changeHistory=function(e){return $(window).trigger("showHistory")},m}(d),n.exports=o}}),window.requirejs.define({"views/editor_tool_insert_emoji_view":function(e,t,n){var i,r={}.hasOwnProperty;i=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)r.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,Backbone.View),t.prototype.className="wmd-button ui button icon",t.prototype.editorView=null,t.prototype.initialize=function(e){return this.editorView=e.editorView},t.prototype.render=function(e){var t;return t=this,this.$el.html('<span class="icon_tip">\u8868\u60c5\u7b26\u53f7</span><i class="icon large smile outline"></i>'),'<div class="emoji_picker_container">\n  <emoji-picker data-source="./js/modules/emoji-picker-element/data.json" class="xsj_emoji_picker" style="width: 100%;min-width: fit-content;"></emoji-picker>\n</div>',e.append(this.$el),this.$el.popup({className:{popup:"ui popup flowing"},html:'<div class="emoji_picker_container">\n  <emoji-picker data-source="./js/modules/emoji-picker-element/data.json" class="xsj_emoji_picker" style="width: 100%;min-width: fit-content;"></emoji-picker>\n</div>',hoverable:!0,observeChanges:!1,position:"bottom left",delay:{show:300,hide:300},onCreate:function(){var e;return this,e=function(e){var n;return e.preventDefault(),e.stopPropagation(),n=e.originalEvent.detail,t.editorView.insertValue(n.unicode)},this.on("emoji-click","emoji-picker",e)}})},t}(),n.exports=i}}),window.requirejs.define({"views/editor_tool_insert_html_dialog_view":function(e,t,n){var i,r,o,a,s,l,c={}.hasOwnProperty;o=t("./view"),r=t("../lib/utils"),t("../application"),t("../lib/notifier"),s=t("./templates/editor_tool_insert_html_dialog"),l=null,a=null,i=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)c.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.className="editor_tool_html_dialog ui standard story_modal modal",t.prototype.template=s,t.prototype.initialize=function(e){return l=this},t.prototype.show=function(e,t){var n,i;return this.render(),n=this.$el,(i=n.find(".ui.form")).form({fields:{link:{identifier:"markdown",rules:[{type:"empty",prompt:"markdown\u5185\u5bb9\u4e0d\u80fd\u4e3a\u7a7a"}]}},onSuccess:function(){return t(n.find("textarea[name=markdown]").val()),n.modal("hide"),i.form("destroy")}}),n.modal({closable:!1,onShow:function(){var t,i,o;return(t=n.find("textarea[name=html]")).val(e),(i=n.find("textarea[name=markdown]")).val(r.html2markdown(t.val())),o=_.debounce((function(){return i.val(r.html2markdown(t.val()))}),100),t.on("keydown",o),a=function(e){var t,n,i,o,a;if(l.$el.find("textarea[name=markdown]")[0]!==document.activeElement&&"html"===(o=l.$el.find("input[name=pasteDateType]:checked").val()))return n=(i=e.originalEvent).clipboardData.getData("text/html"),a=i.clipboardData.getData("text/plain"),"html"===o&&(a=n||a,(a=r.tidyHtml(a))&&(a="\n"+a)),(t=l.$el.find("textarea[name=html]")).val($.trim(t.val()+a)),e.preventDefault(),e.stopPropagation()},$(document).on("paste",a)},onHidden:function(){return $(document).off("paste",a),a=null,n.modal("destroy"),n.parent().dimmer("destroy"),n.parent().transition("destroy"),n.remove(),n.parent().remove(),n=null},onDeny:function(){return t(null),!0},onApprove:function(){return i.form("validate form"),!1}}).modal("show")},t}(o),n.exports=i}}),window.requirejs.define({"views/editor_tool_insert_magnet_dialog_view":function(e,t,n){var i,r,o,a,s,l,c,u,d,p,f,h,m={}.hasOwnProperty;u=t("./view"),c=t("../lib/utils"),i=t("../application"),l=t("../lib/resource_core"),s=t("../lib/preview_core"),a=t("../lib/notifier"),r=t("./change_store_plugin_dialog_view"),f=t("./templates/editor_tool_insert_magnet_dialog"),h=null,p=function(e){var t,n,i,r;if(!h)return null;for(t=0,n=(i=h.results).length;t<n;t++)if((r=i[t]).index===e)return r},d=function(e,t){var n,i;return h?(i=e.url,n=function(n,r){var o,a;return h&&h.$el?(o=h.$el.find("tbody"),n?(o.find(".item_"+e.index).addClass("negative"),o.find(".item_"+e.index+" .new_src").html("\u4e0b\u8f7d\u56fe\u7247\u51fa\u9519: "+n+"<i class='frown red icon '></i>").attr("title",""),o.find(".item_"+e.index+">.status").html("<i title='\u91cd\u65b0\u4e0b\u8f7d' class='icon refresh large reload_button' style='cursor:pointer'></i>"),t()):(a=c.dataURL2Blob(r),c.insertImageBlob("",a,(function(n,r,a){var s;return s=o.find(".item_"+e.index).addClass("loaded"),e.network?(s.addClass("positive"),o.find(".item_"+e.index+">.status").html("<i class='large icon checkbox_item check square green outline' style='cursor:pointer'></i>")):o.find(".item_"+e.index+">.status").html("<i class='large icon checkbox_item square outline' style='cursor:pointer'></i>"),e.blobData=n,e.filename=a,t(null,{index:e.index,src:i})})))):t()},e.network?c.getCrossOrignDomainResource(i,(function(e,t){return n(e,t)})):c.objectURLToArrayBuffer(i,(function(e,t,i){var r;return null==i&&(i="image/png"),e?n(e):(r=c.arrayBufferToBase64(t),n(null,"data:"+i+";base64,"+r))}))):t()},o=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)m.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.className="magnet_dialog use_system_resource ui standard story_modal modal",t.prototype.template=f,t.prototype.initialize=function(e){return this.editorView=e.editorView,h=this},t.prototype.events={"click .checkbox_item":"checkItemFn","click .convert_button":"convertFn","click .clean_all_new_src_button":"cleanAllNewSrcFn","click .clean_new_src_button":"cleanNewSrcFn","click .reload_button":"reloadFn","click .toggle_checkbox_all":"toggleAllFn","click .help_button":"helpFn"},t.prototype.helpFn=function(){return window.openTarget("http://soft.xiaoshujiang.com/docs/tutorial/image/")},t.prototype.toggleAllFn=function(e){var t;return(t=$(e.currentTarget)).hasClass("check")?(t.removeClass("check green"),h.$el.find("tr").removeClass("positive"),h.$el.find(".status>i").removeClass("check green")):(t.addClass("check green"),h.$el.find("tr.loaded").addClass("positive"),h.$el.find("tr.loaded .status>i").addClass("check green"))},t.prototype.reloadFn=function(e){var t,n,i;return(t=$(e.currentTarget).parent().parent()).removeClass("negative positive loaded"),t.find(".new_src").html("").attr("title",""),t.find(".status").html('<i class="large spinner icon loading"></i>'),n=t.data("index"),i=p(n),d(i,(function(){if(h&&h.$el)return h.$el.find(".ui.positive.button").removeClass("disabled")}))},t.prototype.cleanNewSrcFn=function(e){return $(e.currentTarget).parent().attr("title","").html("")},t.prototype.cleanAllNewSrcFn=function(e){return h.$el.find(".loaded .new_src").attr("title","").html("")},t.prototype.convertFn=function(e){var t,n,r,o,s,c,u,d,f,m;if(!(t=$(e.currentTarget)).hasClass("loading"))return t.addClass("loading"),d=[],m=h.$el.hasClass("use_system_default"),u=null,s=h.$el.find(".resource_dropdown").dropdown("get value"),f=i.getStorePluginCollection(),"system"!==s&&(u=f.get(s)),o={resourceModel:u},h.$el.find("tr.positive").each((function(e,t){var n,i,r,o;if(i=$(t).data("index"),n=!!$(t).find(".new_src").attr("title"),r=$(t).hasClass("local"),(o=p(i))&&!n&&(!m||!r))return d.push(o)})),r=d.length,n=1,c=function(e,t){var i,a,s,c,u;return u=e.index,i=e.blobData,c=e.filename,a=h.editorView.fileModel,0!==(s=i.type||"image/png").indexOf("image")&&(s="image/png"),h.$el.find(".story_content>.dimmer>.text").text("\u5904\u7406\u4e2d("+n+"/"+r+")..."),l.uploadResource({},a,c,s,i,o,(function(e,i,r,o){var a;return n++,h&&(a=h.$el.find("tbody").find(".item_"+u+" .new_src"),e?(a.html(""),a.addClass("error")):(a.html(r+"<i class='icon remove red clean_new_src_button' title='\u6e05\u7a7a' style='cursor:pointer'></i>").attr("title",r),a.removeClass("error"))),t()}))},d&&d.length>0?(h.dimmer.dimmer("show"),async.mapSeries(d,c,(function(e){return a.showMessage("\u8f6c\u6362\u5b8c\u6210\uff0c\u9009\u62e9\u786e\u5b9a\u540e\uff0c\u5c06\u66ff\u6362\u6b63\u6587\u76f8\u5e94\u7684\u94fe\u63a5"),h&&(t.removeClass("loading"),h.dimmer.dimmer("hide")),t=null}))):(t.removeClass("loading"),a.showMessage({html:'\u81f3\u5c11\u9009\u62e9\u4e00\u5f20\u672a\u8f6c\u6362\u7684\u56fe\u7247<br/>\u67e5\u770b<a href="https://soft.xiaoshujiang.com/docs/tutorial/image/#e59bbee5ba8ae8bf81e7a7bb_14" target="_blank">\u4f7f\u7528\u6559\u7a0b</a>'},6e3,"warn"))},t.prototype.checkItemFn=function(e){var t,n,i;return(i=(n=$(e.currentTarget)).parent().parent()).hasClass("positive")?(i.removeClass("positive"),n.removeClass("check green"),(t=h.$el.find(".toggle_checkbox_all")).hasClass("check")?t.removeClass("check green"):void 0):(i.addClass("positive"),n.addClass("check green"))},t.prototype.show=function(e){var t,n,o,l,u,p,f,m;return this.render(),t=this.$el,n=t.find("tbody"),p=h.editorView.getValue(),l=window.markdownit({html:!0,xhtmlOut:!0,linkify:!0}).render(e||p),f=[],m=[],this.results=f,u=0,l.replace(/(<img [^>]*src=['"])([^'"]+)([^>]*>)/gi,(function(e,t,n,i){if(!/\.html$/i.test(n)&&!/\.table$/i.test(n)&&!/\.drawio$/i.test(n))return m.indexOf(n)<0?m.push(n):void 0})),o=function(e,t){var i;return i=$("<tr> <td colspan=3> "+e+"</td></tr>"),n.append(i),s.getUrlInfo(h.editorView.fileModel,e,{parseClientLocalMedia:!0},(function(n,r){var o,a,s,l,c;return r&&(c=r.url,s=!1,a="local",l='<i class="large spinner icon loading"></i>',0!==e.indexOf("http://")&&0!==e.indexOf("https://")||(s=!0,l='<i class="large spinner icon loading"></i>',a=""),f.push({index:u,src:e,url:c,network:s}),o=$('<tr class="item_'+u+" "+a+'" data-index="'+u+'">\n  <td>\n  <div class="easyzoom easyzoom--overlay">\n      <a href="'+c+'">\n          <img src="'+c+"\" style='max-width: 200px;height: auto;' />\n      </a>\n  </div>\n  </td>\n  <td>\n    <div><label>\u8f6c\u6362\u524d\u5730\u5740:</label><span title='"+e+'\' class="old_src">'+e+'</span></div>\n    <div><label>\u8f6c\u6362\u540e\u5730\u5740:</label><span class="new_src"></span></div>\n  </td>\n  <td class="status">\n    '+l+"\n  </td>\n</tr>"),i.replaceWith(o),o.find(".easyzoom").easyZoom(),u++),t()}))},t.modal({closable:!1,onHidden:function(){return t.find(".resource_dropdown").dropdown("destroy"),h.$el.find(".easyzoom").each((function(e,t){var n;return null!=(n=$(t).data("easyZoom"))?n.teardown():void 0})),t.modal("destroy"),t.remove(),t=null,h=null},onVisible:function(){var e,n,a,s,l,c,u,p,v,g,_;for(h.dimmer=h.$el.find(".story_content").dimmer({closable:!1,onHide:function(){return h.$el.find(".story_content>.dimmer").empty()},onShow:function(){return h.$el.find(".story_content>.dimmer").html('<div class="ui indeterminate text loader">\u6570\u636e\u51c6\u5907\u4e2d...</div>')},template:{dimmer:function(){return $("<div>").attr("class","ui dimmer sticky")}}}),h.$el.find(".easyzoom").easyZoom(),_=i.getStorePluginCollection(),a=i.getCurrentResourcePluginModel(),s=null,n=t.find(".resource_menu"),e=t.find(".resource_dropdown"),a&&(s=a.get("id"),e.find("input").val(s),h.$el.removeClass("use_system_resource")),c=0,u=(g=_.where({kind:"resource"})).length;c<u;c++)p=(v=g[c]).get("displayName")||v.get("name"),l=v.get("id"),n.append('<div class="item" data-value="'+l+'" data-text="'+p+'">'+p+"("+l+")</div>");return setTimeout((function(){return e.dropdown({onChange:function(e,n){return"system"===e?h.$el.addClass("use_system_resource"):"setting"===e?(t.modal("hide"),setTimeout((function(){return(new r).show()}),600)):h.$el.removeClass("use_system_resource")}})}),100),async.mapLimit(m,20,o,(function(e){return f.length>0?(t.find(".convert_button").removeClass("disabled"),async.mapLimit(f,20,d,(function(e,n){return t.find(".ui.positive.button").removeClass("disabled")}))):t.find(".story_content").html("<div class='ui center aligned segment'><i class='smile icon'></i>\u6ca1\u6709\u9700\u8981\u8f6c\u6362\u7684\u7f51\u7edc\u56fe\u7247</div>")}))},onDeny:function(){return!0},onApprove:function(){var e;return[],e=!1,n.find("tr.positive").each((function(t,n){var i,r,o,a;if(a=(i=$(n)).find(".old_src").attr("title"),o=i.find(".new_src").attr("title"),a&&o)return r=decodeURI(a),a!==o&&r!==o&&(p=(p=p.split(a).join(o)).split(r).join(o)),e=!0})),e?(h.editorView.setValue(p),!0):(a.showMessage({html:'\u8bf7\u81f3\u5c11\u9009\u62e9\u4e00\u4e2a\u5df2\u7ecf\u8f6c\u6362\u7684\u56fe\u7247<br/>\u67e5\u770b<a href="https://soft.xiaoshujiang.com/docs/tutorial/image/#e59bbee5ba8ae8bf81e7a7bb_14" target="_blank">\u4f7f\u7528\u6559\u7a0b</a>'},6e3,"error"),!1)}}),c.asyncLoadResources([{id:"easyzoom_js",type:"script",filename:"js/easyzoom/easyzoom.js"},{id:"easyzoom_css",type:"style",filename:"js/easyzoom/easyzoom.css"}],(function(){return t.modal("show")}))},t}(u),n.exports=o}}),window.requirejs.define({"views/editor_tool_insert_moment_dialog_view":function(e,t,n){var i,r,o,a,s={}.hasOwnProperty;o=t("./view"),t("../lib/utils"),i=t("../application"),t("../lib/notifier"),a=t("./templates/editor_tool_insert_moment_dialog"),r=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)s.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.className="moment_dialog ui standard story_modal modal",t.prototype.template=a,t.prototype.initialize=function(e){return this},t.prototype.show=function(e){var t;return this.render(),(t=this.$el).modal({closable:!1,onHidden:function(){return t.find(".ui.dropdown").dropdown("destroy"),t.modal("destroy"),t.remove(),t=null,null},onVisible:function(){var e,n,r,o;return n=t.find("select[name=formate]"),r=i.getEditorProfileModel().get("momentFormat")||"YYYY\u5e74MM\u6708DD\u65e5 HH\u65f6mm\u5206ss\u79d2",(e=n.find("option[value='"+_.escape(r)+"']")).length>0?e.attr("selected","selected"):n.append("<option value='"+_.escape(r)+"' selected='selected'>"+_.escape(r)+"</option>"),o=moment().format(r),t.find(".moment_format_result").text(o),setTimeout((function(){return n.dropdown({allowAdditions:!0,onChange:function(e,n){return t.find(".moment_format_result").text(moment().format(e))}})}),700)},onDeny:function(){return"function"==typeof e&&e(null),!0},onApprove:function(){var n,r,o,a;return n=t.find(".ui.dropdown"),o=t.find("input[name=setDefault]").is(":checked"),a=$.trim(n.dropdown("get value")),r=i.getEditorProfileModel(),a||(a=r.get("momentFormat")||"YYYY\u5e74MM\u6708DD\u65e5 HH\u65f6mm\u5206ss\u79d2"),o&&(r.set("momentFormat",a),r.save()),"function"==typeof e?e(moment().format(a)):void 0}}).modal("show")},t}(o),n.exports=r}}),window.requirejs.define({"views/editor_tool_insert_toc_dialog_view":function(e,t,n){var i,r,o,a,s,l,c,u,d,p,f,h={}.hasOwnProperty;s=t("./view"),a=t("../lib/utils"),i=t("../application"),o=t("../lib/notifier"),c=t("./templates/editor_tool_insert_toc_dialog"),u=null,l=function(e,t,n,i){var r,o,s;return null==t&&(t=1),null==n&&(n=6),null==i&&(i=!1),s=i?"ol":"ul",r=a.getHeadingInfo(e).headings,o=0,r.map((function(e){var i,r,a,l,c;if(c=[],i="toc_item_container",l=[],o===e.level?l=['</li><li class="'+i+'" data-level="'+e.level+'"><a class="toc_item" href="javascript:void(0)" data-line="',e.line,'">',e.content,'</a><i class="icon close link large" style="float: right;"></i></li>']:o<e.level?l=['<a class="toc_item" href="javascript:void(0)" data-line="',e.line,'">',e.content,'</a><i class="icon close link large" style="float: right;"></i></li>']:o>e.level&&(l=['</li><li class="'+i+'" data-level="'+e.level+'"><a class="toc_item" href="javascript:void(0)" data-line="',e.line,'">',e.content,'</a><i class="icon close link large" style="float: right;"></i></li>']),(e.level<t||e.level>n)&&(i+=" toc_item_range_disabled"),e.level>o)for(a=e.level-o,r=0;r<a;)r++,c.push("<"+s+"><li class='"+i+"' data-level='"+e.level+"'>"),o++;else if(e.level<o)for(a=o-e.level,r=0;r<a;)r++,c.push("</li></"+s+">"),o--;return(c=c.concat(l)).join("")})).join("")+new Array(o+1).join("</li></"+s+">")},f=!1,d=1,p=7,r=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)h.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(n,e),n.prototype.className="toc_dialog ui standard story_modal modal",n.prototype.template=c,n.prototype.initialize=function(e){return this.editorView=e.editorView,u=this},n.prototype.events={"click .reversed_select_button":"reversedSelectFn","click .toc_item_container>.close":"disableTocItemFn","change .toc_ordered_list":"toggleOrderedListFn"},n.prototype.getRenderData=function(){return{tocOrderedList:f?"checked":""}},n.prototype.toggleOrderedListFn=function(e){return(f=!f)?$($(".toc_content_container").find("ul").get().reverse()).each((function(){return $(this).replaceWith($("<ol>"+$(this).html()+"</ol>"))})):$($(".toc_content_container").find("ol").get().reverse()).each((function(){return $(this).replaceWith($("<ul>"+$(this).html()+"</ul>"))}))},n.prototype.reversedSelectFn=function(){return u.$el.find(".toc_item_container").toggleClass("toc_item_manual_disabled")},n.prototype.disableTocItemFn=function(e){return $(e.currentTarget).parent().toggleClass("toc_item_manual_disabled")},n.prototype.show=function(e){var n,r,a,s,c;return a=i.getEditorProfileModel(),f=a.get("tocOrderedList"),d=a.get("tocDepthFrom"),p=a.get("tocDepthTo"),this.render(),n=this.$el,r=n.find(".story_content"),s=u.editorView.getValue(),(c=l(s,d,p,f))?(c='<div class="ui mini button right floated reversed_select_button">\u53cd\u9009</div>'+c,r.html(c)):r.html('<div class="ui icon message massive warning">\n  <i class="frown icon"></i>\n  <div class="content">\n    \n    <p>\u60a8\u7684\u6587\u6863\u7ed3\u6784\u770b\u8d77\u6765\u6709\u4e9b\u4e0d\u5408\u7406\u54e6\uff0c\u7cfb\u7edf\u627e\u4e0d\u5230\u76f8\u5173\u7684\u6807\u9898\u4fe1\u606f</p>\n  </div>\n</div>'),n.modal({closable:!1,onHidden:function(){return n.find(".slider-range").slider("destroy"),n.find(".ui.dropdown").dropdown("destroy"),n.modal("destroy"),n.remove(),n=null,u.remove(),u=null},onVisible:function(){return n.find(".slider-range").slider({range:!0,min:1,max:7,values:[1,7],slide:function(e,t){var n,i,o,a,s;for(r.find(".toc_item_range_disabled").removeClass("toc_item_range_disabled"),s=t.values[0],n=t.values[1],d=s,p=n,a=[],i=o=1;o<=7;i=++o)i<s||i>n?a.push(r.find(".toc_item_container[data-level='"+i+"']").addClass("toc_item_range_disabled")):a.push(void 0);return a}})},onDeny:function(){return!0},onApprove:function(){var r;return n.find("input[name=setDefault]").is(":checked"),(r=(r=$(".toc_content_container .toc_item_container").not(".toc_item_manual_disabled,.toc_item_range_disabled")).find(">.toc_item")).length<=0?(o.showMessage("\u6ca1\u6709\u53ef\u4ee5\u751f\u6210\u7684\u5185\u5bb9",6e3,"errpr"),!1):t("../lib/dynamic_import/import_parse_depence")((function(){var t,n,o;return o=[],t={},n=1,r.each((function(e,i){var r,a,s,l,c,u,p;return r=(a=r=$(i)).parent(),s=parseInt(r.data("level")),n<s&&(t[s]=0),p="["+a.text()+"](#"+uslug(a.text())+")",(l=s-d)>=0&&(c="\t".repeat(l),f?(u=t[s]||1,t[s]=u+1,p=u+". "+p):p="* "+p,p=c+p,o.push(p)),n=s})),a=i.getEditorProfileModel(),"function"==typeof e?e(o.join("\n")):void 0}))}}).modal("show")},n}(s),n.exports=r}}),window.requirejs.define({"views/editor_tool_view":function(e,t,n){var i,r,o,a,s,l,c,u,d,p,f,h,m,v,g,w,y,b,x,k,D,C={}.hasOwnProperty;y=t("../lib/utils"),w=t("../lib/utils_table"),o=t("../constant"),i=t("../application"),m=t("../lib/resource_core"),t("../lib/preview_core"),h=t("../lib/pouchdb_index_view_manager"),f=t("../lib/notifier"),b=t("./view"),D=t("./templates/editor_tool"),x=t("./templates/editor_tool_insert_link_dialog"),k=t("./templates/editor_tool_insert_table_dialog"),v=t("./single_popup_manager_view"),l=t("./insert_file_dialog_view"),c=t("./editor_tool_insert_html_dialog_view"),u=t("./editor_tool_insert_magnet_dialog_view"),d=t("./editor_tool_insert_moment_dialog_view"),p=t("./editor_tool_insert_toc_dialog_view"),s=t("./editor_tool_insert_emoji_view"),r=t("../lib/config_sync"),g=t("./snippets_manager_view"),a=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)C.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.className="editor-tool",t.prototype.editor=null,t.prototype.template=D,t.prototype.initialize=function(e){return this.editorView=e.editorView,this.wmdeditor=new Markdown.Editor},t.prototype.changeFileModel=function(e){if(this.editorView.fileModel!==e)return this.editorView.changeFileModel(e)},t.prototype.reInitEditorTool=function(e){return e&&this.editorView.changeEditorProxy(e),this.wmdeditor.initUndoManager(this.editorView)},t.prototype.initEditorTool=function(){var e,t,n,a,b,D,C,F,M,T,S,P,j,E,I,O,V,L,A,B,N;return this.wmdeditor.run(this.editorView),P=this.editorView,$(".wmd-button-row li").addClass("ui button icon").css("left",0).find("span").hide(),e=$(".wmd_button_group1"),$("#wmd-bold-button").append($('<span class="icon_tip">\u52a0\u7c97</span><i class="icon large bold">')).appendTo(e),$("#wmd-italic-button").append($('<span class="icon_tip">\u659c\u4f53</span><i class="icon large italic">')).appendTo(e),(F=$("#wmd-mark-button")).append($('<span class="icon_tip">\u6807\u8bb0\u9ad8\u4eae</span><i class="icon large paint brush">')).appendTo(e),E=null,'<div class="mark_color_container">\n  <div class="ui active centered inline loader"></div>\n</div>',I=F.popup({className:{popup:"ui popup flowing"},html:'<div class="mark_color_container">\n  <div class="ui active centered inline loader"></div>\n</div>',hoverable:!0,observeChanges:!1,position:"bottom left",delay:{show:300,hide:300},onCreate:function(){var e;return this,e=function(e){return e.preventDefault(),e.stopPropagation(),$(e.currentTarget).data("id"),I.popup("hide")},this.on("click",".color_item",e)},onHidden:function(){var e;if(this,e=this.find(".mark_color_container"))return E&&(E.hide(),E.destroy(),E=null),e.html('<div class="ui active centered inline loader"></div>')},onVisible:function(){var e,t,n,r;return this,e=this.find(".mark_color_container"),t=i.getApplicationProfileModel(),n=$.trim(t.get("cmColorpickerColorSets"))||"",r=[],n&&(r=n.split("|")),(E=new CodeMirrorColorPicker.ColorPicker({type:"sketch",mode:"edit",container:e[0],colorSets:function(){return n=$.trim(t.get("cmColorpickerColorSets"))||"",r=[],n&&(r=n.split("|")),[{colors:r,name:"Input Colors",edit:!0}]},color:"black"})).$root.addClass("xsj_only_palette"),E.show({left:0,top:0,hideDelay:-1},"black",(function(e){if(e)return F.trigger("click",{color:e})}))}}),F.on("click",(function(){return I.popup("hide")})),e=$(".wmd_button_group2"),$("#wmd-link-button").append($('<span class="icon_tip">\u94fe\u63a5</span><i class="linkify icon large">')).appendTo(e),$("#wmd-quote-button").append($('<span class="icon_tip">\u5f15\u7528</span><i class="icon large quote right">')).appendTo(e),$("#wmd-footnote-button").append($('<span class="icon_tip">\u811a\u6ce8</span><i class="icon large quote left">')).appendTo(e),$("#wmd-code-button").append($('<span class="icon_tip">\u63d2\u5165\u4ee3\u7801</span><i class="icon large code">')).appendTo(e),$("#wmd-image-button").append($('<span class="icon_tip">\u63d2\u5165\u56fe\u7247</span><i class="file image outline icon large">')).appendTo(e),e=$(".wmd_button_group3"),(S=$("#wmd-ulist-button")).addClass("ui icon dropdown"),'<span class="icon_tip">\u65e0\u5e8f\u5217\u8868</span><i class="unordered icon large list" />\n<div class="menu">\n   <div class="item" data-type=\'ulist\'>\u65e0\u5e8f\u5217\u8868</div>\n   <div class="item" data-type=\'olist\'>\u6709\u5e8f\u5217\u8868</div>\n   <div class="item" data-type=\'task\'>\u5f85\u529e\u5217\u8868</div>\n</div>',S.append('<span class="icon_tip">\u65e0\u5e8f\u5217\u8868</span><i class="unordered icon large list" />\n<div class="menu">\n   <div class="item" data-type=\'ulist\'>\u65e0\u5e8f\u5217\u8868</div>\n   <div class="item" data-type=\'olist\'>\u6709\u5e8f\u5217\u8868</div>\n   <div class="item" data-type=\'task\'>\u5f85\u529e\u5217\u8868</div>\n</div>').appendTo(e),S.dropdown({on:"hover",forceSelection:!1,className:{selected:"skip_selected"},delay:{show:1},action:function(){},onShow:function(){return!0}}),S.find(">.menu>.item").on("click",(function(e){var t;return e.preventDefault(),e.stopPropagation(),t=$(e.currentTarget).data("type"),S.trigger("click",{type:t})})),$("#wmd-html-button").append($('<span class="icon_tip">\uff28\uff34\uff2d\uff2c\u8f6c\u6362\u6210\uff2d\uff21\uff32\uff2b\uff24\uff2f\uff37\uff2e</span><i class="html5 icon large">')).appendTo(e),$("#wmd-anchor-button").append($('<span class="icon_tip">\u951a\u70b9</span><i class="anchor icon large">')).appendTo(e),$("#wmd-toc-button").append($('<span class="icon_tip">\u63d2\u5165\u9759\u6001\u5927\u7eb2</span><i class="content icon large">')).appendTo(e),(M=$("#wmd-moment-button")).addClass("ui icon dropdown"),'<span class="icon_tip">\u63d2\u5165\u5f53\u524d\u65f6\u95f4\u7247\u6bb5</span><i class="wait icon large"></i>\n<div class="menu">\n    <div class="scrolling menu xsj_patch_menu">\n    </div>\n</div>',M.append('<span class="icon_tip">\u63d2\u5165\u5f53\u524d\u65f6\u95f4\u7247\u6bb5</span><i class="wait icon large"></i>\n<div class="menu">\n    <div class="scrolling menu xsj_patch_menu">\n    </div>\n</div>').appendTo(e),M.dropdown({on:"hover",saveRemoteData:!1,forceSelection:!1,filterRemoteData:!1,message:{noResults:"\u8fd8\u6ca1\u6709\u521b\u5efa\u4efb\u4f55\u7247\u6bb5"},className:{selected:"skip_selected"},delay:{hide:1e3},onShow:function(){return!0},templates:{menu:function(e,t){var n,i;return i=e[t.values]||{},"            ",n=[],$.each(i,(function(e,i){var r;return r=i.selected?"active":"",n.push('<div class="item '+r+'" data-value="'+i[t.value]+'" data-name="'+_.escape(i[t.name])+'">'+_.escape(i[t.name])+"</div>")})),"            \n"+n.join("")}},onHide:function(e){var t;return!M.hasClass("xsj_actived")&&((t=$(this)).find(".menu>.menu").empty(),t.dropdown("refreshItems"))},action:function(){},apiSettings:{className:{loading:"skip_loading"},responseAsync:function(e,t){var n,i;return e.urlData.query,n=[],i={type:"snippet",sort:{$lt:[]},score:{$lt:[]},updateDate:{$lt:[]}},r.getSnippets(i,"",!1,(function(e,i){return e?f.showMessage("\u52a0\u8f7d\u7247\u6bb5\u51fa\u9519",6e3,"error"):i.docs.length>0&&i.docs.forEach((function(e){return n.push({name:e.snippetName,value:e._id})})),t({success:!0,results:n})}))}}}),M.find(">.menu>.xsj_patch_menu").on("click",">.item",(function(e){var t;return e.preventDefault(),e.stopPropagation(),t=$(e.currentTarget).data("value"),P.insertSnippet(t)})),M.find(">.menu").on("click",">.message",(function(e){return e.preventDefault(),e.stopPropagation(),(new g).show()})),$("#wmd-magnet-button").append($('<span class="icon_tip">\u56fe\u5e8a\u8f6c\u79fb</span><i class="magnet icon large">')).appendTo(e),$("#wmd-ntable-button").append($('<span class="icon_tip">\u8868\u683c\u7ec4\u4ef6</span><i class="large icons"><i class="table icon"></i><i class="corner attach icon"></i></i>')).appendTo(e),(a=$("#wmd-drawio-button")).addClass("ui icon dropdown"),'<span class="icon_tip">\u7ed8\u56fe\u7ec4\u4ef6</span><i class="large icons"><i class="object group outline icon"></i><i class="corner attach icon"></i></i>\n<div class="menu">\n   <div class="item" data-type=\'new\'>\u521b\u5efa\u65b0\u7684\u7ed8\u56fe</div>\n   <div class="item" data-type=\'toc\'>\u5c06\u5927\u7eb2\u8f6c\u6210\u601d\u7ef4\u5bfc\u56fe</div>\n   <div class="item" data-type=\'selected\'>\u6839\u636e\u7f16\u8f91\u533a\u5185\u9009\u4e2d\u7684\u6587\u5b57\u8f6c\u6210\u601d\u7ef4\u5bfc\u56fe</div>\n</div>',a.append('<span class="icon_tip">\u7ed8\u56fe\u7ec4\u4ef6</span><i class="large icons"><i class="object group outline icon"></i><i class="corner attach icon"></i></i>\n<div class="menu">\n   <div class="item" data-type=\'new\'>\u521b\u5efa\u65b0\u7684\u7ed8\u56fe</div>\n   <div class="item" data-type=\'toc\'>\u5c06\u5927\u7eb2\u8f6c\u6210\u601d\u7ef4\u5bfc\u56fe</div>\n   <div class="item" data-type=\'selected\'>\u6839\u636e\u7f16\u8f91\u533a\u5185\u9009\u4e2d\u7684\u6587\u5b57\u8f6c\u6210\u601d\u7ef4\u5bfc\u56fe</div>\n</div>').appendTo(e),a.dropdown({on:"hover",forceSelection:!1,className:{selected:"skip_selected"},delay:{show:1},action:function(){},onShow:function(){return!0}}),a.find(">.menu>.item").on("click",(function(e){var t,n,i,r,o,s;return e.preventDefault(),e.stopPropagation(),s=$(e.currentTarget).data("type"),r="",t=P.getValue(),o=P.getSelectionRange(),"toc"===s?r=y.getHeadingInfo(t).headings.map((function(e){return{name:e.content,depth:e.level}})):"selected"===s&&o.start!==o.end&&(r=t.substring(o.start,o.end)),n=Math.max(o.start,o.end),i=P.getPositionByIndex(n),P.moveCursorTo(i.row,i.column),a.trigger("click",{value:r})})),(C=$("#wmd-icon-button")).addClass("ui icon dropdown"),'<span class="icon_tip">\u56fe\u6807</span><i class="flag icon large"></i>\n  <div class="menu">\n    <div class="ui search icon input">\n      <i class="search icon"></i>\n      <input type="text" name="search" placeholder="\u67e5\u627e\u56fe\u6807...">\n    </div>\n    <div class="scrolling menu xsj_patch_menu">\n    </div>\n    <div class="divider"></div>\n    <div class="header">\n      <div class="ui form">\n        <div class="inline fields">\n          <label>\u5927\u5c0f</label>\n          <div class="field">\n            <div class="ui radio checkbox">\n              <input type="radio" name="size" checked="checked" value="">\n              <label>1x</label>\n            </div>\n          </div>\n          <div class="field">\n            <div class="ui radio checkbox">\n              <input type="radio" name="size" value="fa-3x">\n              <label>3x</label>\n            </div>\n          </div>\n          <div class="field">\n            <div class="ui radio checkbox">\n              <input type="radio" name="size" value="fa-5x">\n              <label>5x</label>\n            </div>\n          </div>\n          <div class="field">\n            <div class="ui radio checkbox">\n              <input type="radio" name="size" value="fa-10x">\n              <label>10x</label>\n            </div>\n          </div>\n        </div>\n        <div class="inline fields">\n          <label>\u989c\u8272</label>\n          <div class="field">\n             <div class="ui button color_picker_button basic">\n             <i class="square icon"></i>\n             </div>\n             <div class="ui button color_reset_button basic" style="display: none;">\n             <i class="times icon"></i>\n             </div>\n          </div>\n        </div>\n        <div class="inline fields">\n          <label>\u8fb9\u6846</label>\n          <div class="field">\n            <div class="ui radio checkbox">\n              <input type="radio" name="border" checked="checked" value="">\n              <label>\u65e0\u8fb9\u6846</label>\n            </div>\n          </div>\n          <div class="field">\n            <div class="ui radio checkbox">\n              <input type="radio" name="border" value="fa-border">\n              <label>\u6709\u8fb9\u6846</label>\n            </div>\n          </div>\n        </div>\n        <div class="inline fields">\n          <label>\u52a0\u5bbd</label>\n          <div class="field">\n            <div class="ui radio checkbox">\n              <input type="radio" name="wider" checked="checked" value="">\n              <label>\u65e0</label>\n            </div>\n          </div>\n          <div class="field">\n            <div class="ui radio checkbox">\n              <input type="radio" name="wider" value="fa-fw">\n              <label>\u52a0\u5bbd</label>\n            </div>\n          </div>\n        </div>\n        <div class="inline fields">\n          <label>\u6d6e\u52a8</label>\n          <div class="field">\n            <div class="ui radio checkbox">\n              <input type="radio" name="pull" checked="checked" value="">\n              <label>\u65e0</label>\n            </div>\n          </div>\n          <div class="field">\n            <div class="ui radio checkbox">\n              <input type="radio" name="pull" value="fa-pull-left">\n              <label>\u5de6</label>\n            </div>\n          </div>\n          <div class="field">\n            <div class="ui radio checkbox">\n              <input type="radio" name="pull" value="fa-pull-right">\n              <label>\u53f3</label>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>',C.append('<span class="icon_tip">\u56fe\u6807</span><i class="flag icon large"></i>\n  <div class="menu">\n    <div class="ui search icon input">\n      <i class="search icon"></i>\n      <input type="text" name="search" placeholder="\u67e5\u627e\u56fe\u6807...">\n    </div>\n    <div class="scrolling menu xsj_patch_menu">\n    </div>\n    <div class="divider"></div>\n    <div class="header">\n      <div class="ui form">\n        <div class="inline fields">\n          <label>\u5927\u5c0f</label>\n          <div class="field">\n            <div class="ui radio checkbox">\n              <input type="radio" name="size" checked="checked" value="">\n              <label>1x</label>\n            </div>\n          </div>\n          <div class="field">\n            <div class="ui radio checkbox">\n              <input type="radio" name="size" value="fa-3x">\n              <label>3x</label>\n            </div>\n          </div>\n          <div class="field">\n            <div class="ui radio checkbox">\n              <input type="radio" name="size" value="fa-5x">\n              <label>5x</label>\n            </div>\n          </div>\n          <div class="field">\n            <div class="ui radio checkbox">\n              <input type="radio" name="size" value="fa-10x">\n              <label>10x</label>\n            </div>\n          </div>\n        </div>\n        <div class="inline fields">\n          <label>\u989c\u8272</label>\n          <div class="field">\n             <div class="ui button color_picker_button basic">\n             <i class="square icon"></i>\n             </div>\n             <div class="ui button color_reset_button basic" style="display: none;">\n             <i class="times icon"></i>\n             </div>\n          </div>\n        </div>\n        <div class="inline fields">\n          <label>\u8fb9\u6846</label>\n          <div class="field">\n            <div class="ui radio checkbox">\n              <input type="radio" name="border" checked="checked" value="">\n              <label>\u65e0\u8fb9\u6846</label>\n            </div>\n          </div>\n          <div class="field">\n            <div class="ui radio checkbox">\n              <input type="radio" name="border" value="fa-border">\n              <label>\u6709\u8fb9\u6846</label>\n            </div>\n          </div>\n        </div>\n        <div class="inline fields">\n          <label>\u52a0\u5bbd</label>\n          <div class="field">\n            <div class="ui radio checkbox">\n              <input type="radio" name="wider" checked="checked" value="">\n              <label>\u65e0</label>\n            </div>\n          </div>\n          <div class="field">\n            <div class="ui radio checkbox">\n              <input type="radio" name="wider" value="fa-fw">\n              <label>\u52a0\u5bbd</label>\n            </div>\n          </div>\n        </div>\n        <div class="inline fields">\n          <label>\u6d6e\u52a8</label>\n          <div class="field">\n            <div class="ui radio checkbox">\n              <input type="radio" name="pull" checked="checked" value="">\n              <label>\u65e0</label>\n            </div>\n          </div>\n          <div class="field">\n            <div class="ui radio checkbox">\n              <input type="radio" name="pull" value="fa-pull-left">\n              <label>\u5de6</label>\n            </div>\n          </div>\n          <div class="field">\n            <div class="ui radio checkbox">\n              <input type="radio" name="pull" value="fa-pull-right">\n              <label>\u53f3</label>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>').appendTo(e),C.find(".ui.checkbox.radio").checkbox(),B=_.debounce((function(e){var t;return t=$(e.currentTarget).val(),C.dropdown("search",t)}),1e3),C.on("keyup","input[name=search]",B),j=null,C.dropdown({on:"hover",saveRemoteData:!1,forceSelection:!1,filterRemoteData:!1,className:{selected:"skip_selected"},delay:{hide:1e3},onShow:function(){return $(".main_toolbar .layout_dropdown").addClass("xsj_actived"),C.find("input[name=search]")[0].select(),!0},templates:{menu:function(e,t){var n,i;return i=e[t.values]||{},"            ",n=[],$.each(i,(function(e,i){var r;if("query"!==i.type)return r=i.selected?"active":"",n.push('<div class="item '+r+'" data-value="'+i[t.value]+'" data-name="'+_.escape(i[t.name])+'"><i class="'+i[t.value]+' fa-fw fa-2x"></i>'+_.escape(i[t.name])+"</div>")})),"            \n"+n.join("")}},onHide:function(e){var t;return!C.hasClass("xsj_actived")&&($(".main_toolbar .layout_dropdown").removeClass("xsj_actived"),(!j||!j.isColorPickerShow)&&(j&&(j.hide(),j.destroy()),j=null,(t=$(this)).find(".menu>.menu").empty(),t.dropdown("refreshItems")))},action:function(){},apiSettings:{className:{loading:"skip_loading"},responseAsync:function(e,t){var n,i;return n=function(e){var t;t=localStorage.recent_icons;try{t=JSON.parse(t)}catch(e){t=[]}return t=t.concat(o.fontIcons),e({success:!0,results:t=(t=_.uniq(t,"value")).slice(0,40)})},(i=e.urlData.query)?function(e,t){return function(e){return $.get("fonts/icons.yml").then((function(t,n){var i;return i=jsyaml.load(t),e(null,i)})).fail((function(e){return f.showMessage("\u52a0\u8f7d\u8d44\u6e90\u51fa\u9519",6e3,"error")}))}((function(n,i){var r,o,a,s,l,c,u,d,p;if(c=!1,d=[],e)try{c=new RegExp("(^|\\W)"+e,"gi"),d.push({key:"_query",name:"_query",value:e,type:"query"})}catch(e){c=!1}for(a in i)if(p=a,(r=i[a]).key=a,r.search&&r.search.terms&&r.search.terms.length>0&&(p+=r.search.terms.join(" ")),!c||p.match(c))for(o=0,s=(l=r.styles).length;o<s;o++)switch(l[o]){case"solid":u={name:r.label,value:"fas fa-"+a},d.push(u);break;case"regular":u={name:r.label,value:"far fa-"+a},d.push(u);break;case"brands":u={name:r.label,value:"fab fa-"+a},d.push(u)}return t({success:!0,results:d})}))}(i,t):n(t)}}}),C.find(">.menu>.xsj_patch_menu").on("click",">.item",(function(e){var n,i,r,o,a,s,l,c,u;e.preventDefault(),e.stopPropagation(),c=(n=$(e.currentTarget)).data("value"),o=n.data("name"),s=localStorage.recent_icons;try{s=JSON.parse(s)}catch(t){e=t,s=[]}return s.unshift({name:o,value:c}),s=(s=_.uniq(s,"value")).slice(0,40),localStorage.recent_icons=JSON.stringify(s),(l=C.find(".ui.radio.checkbox input[name=size]:checked").val())&&(c+=" "+l),(i=C.find(".ui.radio.checkbox input[name=border]:checked").val())&&(c+=" "+i),(u=C.find(".ui.radio.checkbox input[name=wider]:checked").val())&&(c+=" "+u),(a=C.find(".ui.radio.checkbox input[name=pull]:checked").val())&&(c+=" "+a),c=(r=t.data("color"))?'<i class="'+c+'" style="color: '+r+'"></i>':'<i class="'+c+'"></i>',C.trigger("click",{value:c})})),C.on("click",(function(e,t){if(!t&&(C.toggleClass("xsj_actived"),!C.hasClass("xsj_actived")))return C.dropdown("hide")})),t=C.find(".color_picker_button"),(n=C.find(".color_reset_button")).on("click",(function(e){return t.css("color",""),t.data("color",""),n.css("display","none")})),t.on("click",(function(e){var r,o,a;return r=i.getApplicationProfileModel(),o=$.trim(r.get("cmColorpickerColorSets"))||"",a=[],o&&(a=o.split("|")),(j=new CodeMirrorColorPicker.ColorPicker({type:"sketch",mode:"edit",colorSets:function(){return o=$.trim(r.get("cmColorpickerColorSets"))||"",a=[],o&&(a=o.split("|")),[{colors:a,name:"Input Colors",edit:!0}]},color:"black"})).$root.addClass("xsj_only_palette"),j.show({left:e.clientX,top:e.clientY,hideDelay:2e3},"black",(function(e){return t.css("cssText","color: "+e+" !important; "),t.data("color",e),n.css("display","")}))})),C.find(">.menu").on("click",(function(e){return e.preventDefault(),e.stopPropagation()})),new s({editorView:P}).render(e),T=$("#wmd-table-button"),10,10,V=["<div class='grid_info'></div>"],function(){O=[];for(var e=0;e<=10;e++)O.push(e);return O}.apply(this).forEach((function(e,t){var n,i;return n=[],function(){i=[];for(var e=0;e<=10;e++)i.push(e);return i}.apply(this).forEach((function(e,i){return n.push("<div class='grid_cell' data-row='"+(t+1)+"' data-column='"+(i+1)+"'></div>")})),V.push("<div class='grid_row'>"+n.join("")+"</div>"),n=[]})),A=V.join(""),T.append($('<span class="icon_tip">\u8868\u683c</span><i class="table large icon">')).appendTo(e),L=T.popup({html:A,hoverable:!0,observeChanges:!1,position:"bottom left",delay:{show:300,hide:300},onCreate:function(e){var t;return(t=this).on("mouseout",".grid_cell",(function(e){return t.find(".grid_info").html(""),t.find(".grid_cell").removeClass("filled")})),t.on("click",".grid_cell",(function(e){var t,n,i;return i=(t=$(e.currentTarget)).data("row"),n=t.data("column"),T.trigger("click",{columns:n,rows:i})})),t.on("mouseover",".grid_cell",(function(e){var n,i,r;return n=$(e.currentTarget),r=n.data("row"),i=n.data("column"),t.find(".grid_info").html(r+" x "+i),t.find(".grid_cell").removeClass("filled"),t.find(".grid_cell").each((function(e,t){var n,o,a;if(a=(n=$(t)).data("row"),o=n.data("column"),a<=r&&o<=i)return n.addClass("filled")}))}))}}),T.on("click",(function(){return L.popup("hide")})),(D=$("#wmd-heading-button")).addClass("ui icon dropdown"),'<span class="icon_tip">\u6807\u9898</span><i class="icon large heading" />\n<div class="menu">\n   <div class="item" data-type=\'1\'>\u4e00\u53f7\u6807\u9898</div>\n   <div class="item" data-type=\'2\'>\u4e8c\u53f7\u6807\u9898</div>\n   <div class="item" data-type=\'3\'>\u4e09\u53f7\u6807\u9898</div>\n   <div class="item" data-type=\'4\'>\u56db\u53f7\u6807\u9898</div>\n   <div class="item" data-type=\'5\'>\u4e94\u53f7\u6807\u9898</div>\n   <div class="item" data-type=\'6\'>\u516d\u53f7\u6807\u9898</div>\n</div>',D.append('<span class="icon_tip">\u6807\u9898</span><i class="icon large heading" />\n<div class="menu">\n   <div class="item" data-type=\'1\'>\u4e00\u53f7\u6807\u9898</div>\n   <div class="item" data-type=\'2\'>\u4e8c\u53f7\u6807\u9898</div>\n   <div class="item" data-type=\'3\'>\u4e09\u53f7\u6807\u9898</div>\n   <div class="item" data-type=\'4\'>\u56db\u53f7\u6807\u9898</div>\n   <div class="item" data-type=\'5\'>\u4e94\u53f7\u6807\u9898</div>\n   <div class="item" data-type=\'6\'>\u516d\u53f7\u6807\u9898</div>\n</div>').appendTo(e),D.dropdown({on:"hover",forceSelection:!1,className:{selected:"skip_selected"},delay:{show:1},action:function(){},onShow:function(){return!0}}),D.find(">.menu>.item").on("click",(function(e){var t;return e.preventDefault(),e.stopPropagation(),t=$(e.currentTarget).data("type"),D.trigger("click",{type:t})})),$("#wmd-hr-button").append($('<span class="icon_tip">\u6c34\u5e73\u7ebf</span><i class="icon large minus">')).appendTo(e),(b=$('<li data-i18n="[title]toolbar.find" class="wmd-button ui button icon dropdown" id="wmd-find-button" title="Finding (ctrl+f)" tabindex="0" style="left: 0px;"><span class="icon_tip">\u9875\u5185\u67e5\u627e</span>\n<i class="large icons"><i class="file alternate icon"></i><i class="corner search icon"></i></i>\n<div class="menu transition hidden" tabindex="-1">\n   <div class="item" data-type="find">\u67e5\u627e</div>\n   <div class="item" data-type="replace">\u66ff\u6362</div>\n</div></li>')).appendTo(e),b.dropdown({on:"hover",forceSelection:!1,className:{selected:"skip_selected"},delay:{show:1},action:function(){},onShow:function(){return!0}}),b.on("click",(function(e){return e.preventDefault(),e.stopPropagation(),P.search("")})),b.find(">.menu>.item").on("click",(function(e){var t;return e.preventDefault(),e.stopPropagation(),t=$(e.currentTarget).data("type"),P.search("","replace"===t)})),e=$(".wmd_button_group4"),$("#wmd-undo-button").append($('<span class="icon_tip">\u64a4\u6d88</span><i class="icon large undo">')).appendTo(e),$("#wmd-redo-button").append($('<span class="icon_tip">\u91cd\u505a</span><i class="icon large repeat">')).appendTo(e),this.wmdeditor.hooks.set("insertLinkDialog",(function(e,t){var n,i,r,a,s,l;return l="","client"===STORY_PLATFORM&&(s=window.nw.Clipboard.get().get("text"),/^http[s]?:\/\//i.test(s)&&s.length<1e3&&(l=s)),n=$(x()),i=n.find(".ui.form"),r=i.find("input[name=link]"),a=i.find(".ui.search"),i.form({fields:{link:{identifier:"link",rules:[{type:"empty",prompt:"\u94fe\u63a5\u5730\u5740\u4e0d\u80fd\u4e3a\u7a7a"}]}},onSuccess:function(){return t(e,n.find("input").val()),n.modal("hide")}}),n.modal({onHidden:function(){return a.search("destroy"),i.form("destroy"),n.modal("destroy")},onShow:function(){if(l)return r.val(l)},onVisible:function(){if(a.search({minCharacters:2,searchOnFocus:!1,showNoResults:!1,cache:!1,onSelect:function(e,t){var n,i;return a.search("hide results"),n=e.docId,(i=e.title.replace(/['"\s]*/,"").trim())&&(n=n+' "'+i+'"'),r.val(n),!1},apiSettings:{responseAsync:function(e,t){var n,i;return i=e.urlData.query,n=o.pouchDB,h.getTitleView(n,(function(e,r){var o,a;if(r)return a=r.viewName,o={reduce:!1,group:!1},n.query(a+"/by_title",o).then((function(e){var n,r,o;return r=e.rows.map((function(e){return{docId:e.id,value:e.key}})),(n=new FilteredList(r)).setFilter(i),o=[],n.filtered.slice(0,20).forEach((function(e,t){return o.push({docId:e.docId,title:e.value})})),t({success:!0,results:o})}))}))}}}),l)return setTimeout((function(){return r[0].select(),r[0].focus()}),1)},onDeny:function(){return t(e,null),!0},onApprove:function(){return i.form("validate form"),!1}}).modal("show"),!0})),this.wmdeditor.hooks.set("insertHtmlDialog",(function(e,t){return(new c).show(e,t),!0})),this.wmdeditor.hooks.set("insertAnchorDialog",(N=this,function(e,t){var n,i,r,o;return o=N.editorView.fileModel,n='<a class="xsj_anchor" name="'+(i="xsj_"+uniqueNumber())+'"></a>',r="["+o.get("title")+"](xsjapp://doc/"+o.id+"#"+i+")",$(document).one("copy",(function(e){return e.preventDefault(),e.stopPropagation(),e.originalEvent.clipboardData.setData("text/plain",r),f.showMessage("\u951a\u70b9\u6dfb\u52a0\u6210\u529f,\u5e76\u5df2\u81ea\u52a8\u590d\u5236\u5230\u526a\u5207\u677f")})),document.execCommand("copy"),t(n),!0})),this.wmdeditor.hooks.set("insertNewTableDialog",function(e){return function(t,n){var r,o,a,s,l,c,u,d,p,f,h,m,g,_,w,b,x,k,D;if(i.getUserModel().get("user"),u=e.editorView.fileModel,l=e.editorView,(k=$.trim(e.editorView.getSelectionValue())).indexOf("\n")>0&&(k=""),a=l.getValue(),p="",(x=$.trim(t.selection)||"").split("\n").length>1)m=markdownit({html:!0}),D=$.trim(m.render(x)),p=y.filterTableContent(D);else{if(x&&(w=x.replace(/^[\.\/]*/,""),b=x,(".TABLE"===(c=y.getExt(w,3).toUpperCase())||".TABLE.HTML"===c)&&u.hasAttachment(w)))return v.showPopupView("table",{fileModel:u,link:b}),!0;if((h=$.trim(l.getCursorLineValue()))&&(_=/([!%$=]?\[(.*?)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,s=/^[ ]{0,3}\[(.+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?(?=\s|$)[ \t]*\n?[ \t]*((\n*)["(](.+?)[")][ \t]*)?(?:\n+)/gm,w="",b="",(f=/([!=%$]?\[(.*?)\]\s?\([ \t]*()<?(\S+?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g).test(h)&&h.replace(f,(function(e,t,n,i,r){if(r)return w=r.replace(/^[\.\/]*/,""),b=r})),_.test(h)&&h.replace(_,(function(e,t,n,i){var r;if(i&&(r=y.getReference(a,i)))return w=r.replace(/^[\.\/]*/,""),b=r})),r=h+"\n",s.test(r)&&r.replace(s,(function(e,t,n){if(n)return w=n.replace(/^[\.\/]*/,""),b=n})),w||(b=h.split(" ")[0],w=b.replace(/^[\.\/]*/,"")),w&&(".TABLE"===(c=y.getExt(w,3).toUpperCase())||".TABLE.HTML"===c)&&u.hasAttachment(w)))return v.showPopupView("table",{fileModel:u,link:b}),!0}return g=uniqueNumber(),"text/html",o=new Blob([p],{type:"text/html"}),d=Date.now()+".table.html",y.blobToMd5(o,(function(e,t){var n;return n=i.getUploadFilePath("text/html",u,d,t,o),u.addAttachment(o,n,"text/html",{fixRepeatFilename:!0},(function(e,t,n,i){var r,o;return v.showPopupView("table",{fileModel:u,link:"./"+t}),a=l.getValue(),r=new RegExp('https://markdown.xiaoshujiang.com/img/spinner.gif "(\\[){3}'+g+'(\\]){3}" ',"gmi"),o="./"+t,a=a.replace(r,(function(){return o})),l.setValue(a)}))})),n(null,"!["+(k||"\u8868\u683c")+'](https://markdown.xiaoshujiang.com/img/spinner.gif "[[['+g+']]]" )'),!0}}(this)),this.wmdeditor.hooks.set("insertDrawioDialog",function(e){return function(t,n){var r,o,a,s,l,c,u,d,p,f,h,m,g,_,w,b,x,k,D,C,F;if(i.getUserModel().get("user"),u=e.editorView.fileModel,l=e.editorView,(C=$.trim(e.editorView.getSelectionValue())).indexOf("\n")>0&&(C=""),a=l.getValue(),D=$.trim(t.selection)||"",f=t.value,m=D.split("\n").length>1,p="",!f)if(m)_=markdownit({html:!0}),F=$.trim(_.render(D)),p=y.filterTableContent(F);else{if(D&&(x=D.replace(/^[\.\/]*/,""),k=D,(".DRAWIO"===(c=y.getExt(x,3).toUpperCase())||".DRAWIO.HTML"===c||".DRAWIO.SVG"===c)&&u.hasAttachment(x)))return v.showPopupView("drawio",{fileModel:u,link:k}),!0;if((g=$.trim(l.getCursorLineValue()))&&(b=/([!%$=]?\[(.*?)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,s=/^[ ]{0,3}\[(.+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?(?=\s|$)[ \t]*\n?[ \t]*((\n*)["(](.+?)[")][ \t]*)?(?:\n+)/gm,x="",k="",(h=/([!=%$]?\[(.*?)\]\s?\([ \t]*()<?(\S+?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g).test(g)&&g.replace(h,(function(e,t,n,i,r){if(r)return x=r.replace(/^[\.\/]*/,""),k=r})),b.test(g)&&g.replace(b,(function(e,t,n,i){var r;if(i&&(r=y.getReference(a,i)))return x=r.replace(/^[\.\/]*/,""),k=r})),r=g+"\n",s.test(r)&&r.replace(s,(function(e,t,n){if(n)return x=n.replace(/^[\.\/]*/,""),k=n})),x||(k=g.split(" ")[0],x=k.replace(/^[\.\/]*/,"")),x&&(".DRAWIO"===(c=y.getExt(x,3).toUpperCase())||".DRAWIO.HTML"===c||".DRAWIO.SVG"===c)&&u.hasAttachment(x)))return v.showPopupView("drawio",{fileModel:u,link:k}),!0}return w=uniqueNumber(),"text/html",o=new Blob([p],{type:"text/html"}),d=Date.now()+".drawio.svg",y.blobToMd5(o,(function(e,t){var n;return n=i.getUploadFilePath("text/html",u,d,t,o),u.addAttachment(o,n,"text/html",{fixRepeatFilename:!0},(function(e,t,n,i){var r,o;return v.showPopupView("drawio",{fileModel:u,link:"./"+t,initValue:f}),a=l.getValue(),r=new RegExp('https://markdown.xiaoshujiang.com/img/spinner.gif "(\\[){3}'+w+'(\\]){3}" ',"gmi"),o="./"+t,a=a.replace(r,(function(){return o})),l.setValue(a)}))})),n(null,"!["+(C||"\u7ed8\u56fe")+'](https://markdown.xiaoshujiang.com/img/spinner.gif "[[['+w+']]]" )'),!0}}(this)),this.wmdeditor.hooks.set("insertTocDialog",(function(e,t){return new p({editorView:P}).show(t),!0})),this.wmdeditor.hooks.set("insertMomentDialog",(function(e,t){return(new d).show(t),!0})),this.wmdeditor.hooks.set("insertMagnetDialog",(function(e,t){return new u({editorView:P}).show(),!0})),this.wmdeditor.hooks.set("insertTableDialog",(function(e,t){var n,r,o,a,s,l,c,u,d,p,f;return V=e.rows||4,a=e.columns||4,s=[],function(){d=[];for(var e=1;1<=V?e<=V:e>=V;1<=V?e++:e--)d.push(e);return d}.apply(this).forEach((function(e,t){var n,i;return n=[],function(){i=[];for(var e=1;1<=a?e<=a:e>=a;1<=a?e++:e--)i.push(e);return i}.apply(this).forEach((function(e,t){return n.push("")})),s.push(n),n=[]})),P.editorProxy.editor instanceof CodeMirror&&(r=(c=i.getEditorProfileModel()).get("cm_autopreview"),o=c.get("cm_autopreview_table"),r&&o&&!$.trim(e.selection))?(u=markdownTable(s),void t(e,u)):(n=$(k()),l=n.find(".story_content").dimmer({closable:!1,variation:"inverted",opacity:.4}),n.find(".dimmer").html('<div class="ui indeterminate text loader">\u6570\u636e\u51c6\u5907\u4e2d...</div>'),f=null,p=null,n.modal({onShow:function(){var t;l.dimmer("show"),n.find(".menu>.item").tab({onVisible:function(e){if("second"===e)return s=f.handsontable.getData(),n.find(".markdown>pre").html(markdownTable(s,{align:p}))}}),(t=$('<iframe src="handsontable.html" class="preview_iframe" frameborder="0" style="width: 100%;height:100%;"></iframe>').appendTo(n.find(".handsontable"))).on("load",(function(){var n,i;return l.dimmer("hide"),(n=t[0]).contentDocument,f=n.contentWindow,e.selection&&(i=w.getTableByString(e.selection,e))&&(s=i.data,p=i.aligns),f.createTable({data:e.data||s})}))},dimmerSettings:{opacity:.7},onHidden:function(){return f=null,n.remove()},onDeny:function(){return t(e,null),!0},onApprove:function(){return u=null,f&&(f.handsontable.deselectCell(),s=f.handsontable.getData(),u=markdownTable(s,{align:p})),t(e,u),n.modal("hide"),!0}}).modal("show"),!0)})),this.wmdeditor.hooks.set("insertImageDialog",function(e){return function(t,n){var r,o,a,s,c,u,d,p,h,v;return v=e.wmdeditor,o=e.editorView,h=(h=e.wmdeditor.selectionValue)||o.getSelectionValue(),(h=$.trim(h)).indexOf("\n")>0&&(h=""),a=e.editorView.fileModel,s=function(e){switch(e){case"image":return"!";case"video":return"%";case"audio":return"~";default:return"image"}},v.autoInsertImage?(v.autoInsertFiles?(u=v.autoInsertFiles.length>1,r=v.autoInsertFiles.length,d=o.editorProxy,u&&n(t,null,"",u),p=1,c=function(e,i){return y.insertImageFile([e],(function(e,o,l){var c,v,g,_;if(d.editor&&d.fileModel===a){if(c=y.dataURL2Blob(e),g=l.type.split("/")[0],"image"!==(t=g||"image")&&"video"!==t&&"audio"!==t&&(t="image"),_=uniqueNumber(),v=(v=y.removeExtension(o)||"").replace(/[\[\]\(\)\!]+/g,"_"),m.uploadResource({},a,o,l.type,c,{path:l.path},(function(e,t,n,o){var s,l;return s=a.get("content"),l=new RegExp('https://markdown.xiaoshujiang.com/img/spinner.gif "(\\[){3}'+_+'(\\]){3}" ',"gmi"),s=s.replace(l,(function(){return n})),a.set("content",s),u&&f.showHandling("\u5904\u7406\u4e2d: "+p+++"/"+r),i()}))){if(!u)return n(t,'https://markdown.xiaoshujiang.com/img/spinner.gif "[[['+_+']]]" ',h||v);if(d.editor)return d.insertValue("\n"+s(t)+"["+v+'](https://markdown.xiaoshujiang.com/img/spinner.gif "[[['+_+']]]" )\n')}}else i()}))},async.mapSeries(v.autoInsertFiles,c,(function(){if(r>0&&a.save({},{force:!0,success:function(){return i.getFileLocalCollection().getFileLocalModelByFileId(a.id).set({isLocked:!1})}}),u)return setTimeout((function(){return f.hideHandling()}),1e3)}))):v.autoInsertBlob&&y.insertImageBlob("",v.autoInsertBlob,(function(e,r){var o;if(o=uniqueNumber(),m.uploadResource({},a,r,"image/png",e,{},(function(e,t,n,r){var s,l;if(!e)return s=a.get("content"),l=new RegExp('https://markdown.xiaoshujiang.com/img/spinner.gif "(\\[){3}'+o+'(\\]){3}" ',"gmi"),s=s.replace(l,(function(){return n})),a.set("content",s),a.save({},{force:!0,success:function(){return i.getFileLocalCollection().getFileLocalModelByFileId(a.id).set({isLocked:!1})}})})))return n(t,'https://markdown.xiaoshujiang.com/img/spinner.gif "[[['+o+']]]" ',h)})),v.autoInsertImage=!1,v.autoInsertFiles=null,v.autoInsertBlob=null,v.selectionValue=null):new l({fileModel:a}).show(n,h),!0}}(this)),$(window).on("pasteBlob",function(e){return function(t,n,i,r){return e.wmdeditor.autoInsertImage=!0,e.wmdeditor.autoInsertBlob=n,e.wmdeditor.selectionValue=r,e.wmdeditor.uiManager.doClick(t,e.wmdeditor.uiManager.buttons.image)}}(this)),$(window).on("pasteFiles",function(e){return function(t,n){return e.wmdeditor.autoInsertImage=!0,e.wmdeditor.autoInsertFiles=n,e.wmdeditor.uiManager.doClick(t,e.wmdeditor.uiManager.buttons.image)}}(this))},t}(b),n.exports=a}}),window.requirejs.define({"views/editor_view":function(e,t,n){var i,r,o,a,s,l,c,u,d,p,f,h,m,v,g,w,y,b,x,k=function(e,t){return function(){return e.apply(t,arguments)}},D={}.hasOwnProperty;t("./view"),l=t("./editor_tool_view"),s=t("./editor_buttons_view"),h=t("./statics_count_view"),i=t("./ace_editor_view"),a=t("./codemirror_editor_view"),d=t("./light_editor_view"),g=t("./zen_tabs_view"),r=t("../lib/app_resource_core"),m=t("../lib/utils"),p=t("../lib/notifier"),t("../lib/config_sync"),v=t("../lib/default_xsj_commands"),u=t("../models/file_local_model"),f=t("../lib/editor/popup_editor_manager"),t("../lib/editor/autopreview/index"),b=t("../lib/preview_core"),w=t("../lib/editor/create_active_editor"),y=t("../lib/editor/base_editor"),o=t("../application"),x=null,c=function(e){var t,n,c,C,F,M,T;function S(){return this.fullPathChangedFn=k(this.fullPathChangedFn,this),this.clientWatchFileFn=k(this.clientWatchFileFn,this),S.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)D.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(S,Backbone.View),S.prototype.fileModel=null,S.prototype.prevKeyCode=null,S.prototype.className="editorPanel",S.prototype.editorProxy=null,S.prototype.activeEditorProxy=null,S.prototype.activeDeepEditorProxy=null,S.prototype.isOperating=!1,S.prototype.scrollTopMap={},T={},M=[],c=null,t=null,n=[],S.prototype.clientWatchFileFn=function(e,t){if(!e&&c&&!c.get("isLocked"))return this.fileModel.set("content",t)},S.prototype.initialize=function(e){var t;return this.fileModel=e.fileModel,this.model.bind("change:bindInfos",(t=this,function(){return t.bindUserKeyBoard()})),o.getPreviewProfileModel(),m.asyncLoadResources([{id:"js_codemirror_addons",filename:"./js/codemirror-addons.js",type:"script"}],function(e){return function(){return e.model.trigger("refreshEditorProfile")}}(this))},S.prototype.getCommands=function(){return T},S.prototype.getBindInfos=function(){return M},C=function(e){var t,n,i;return t=(i=e.editorTool).wmdeditor.uiManager.buttons,n=i.wmdeditor.uiManager.doClick,$.each(t,(function(e,t){return T["xsj_"+e]={fn:function(e,i,r){return n(i,t,r)}}}))},S.prototype._setEditorType=function(e,t,n){var r,o,s,l,c;if(MINI_WEB,e="codemirror",this.editorProxy&&(l=this.editorProxy.editorType,e!==l&&(this.editorProxy.destroyEditor(),this.editorProxy=null,this.activeEditorProxy=null)),!this.editorProxy)switch(e){case"ace":return r=new i({model:this.model,fileModel:this.fileModel,editorView:this}),this.editorProxy=r,r.initEditor(this.$el,this.layout,(c=this,function(){var i;return"function"==typeof(i=c.editorProxy).changeWritingMode&&i.changeWritingMode(t),c.editorType=e,c.writingMode=t,"function"==typeof n?n():void 0}));case"light":return s=new d({model:this.model,fileModel:this.fileModel,editorView:this}),this.editorProxy=s,s.initEditor(this.$el,this.layout,function(i){return function(){var r;return"function"==typeof(r=i.editorProxy).changeWritingMode&&r.changeWritingMode(t),i.editorType=e,i.writingMode=t,"function"==typeof n?n():void 0}}(this));default:return o=new a({model:this.model,fileModel:this.fileModel,editorView:this}),this.editorProxy=o,o.initEditor(this.$el,this.layout,function(i){return function(){var r;return"function"==typeof(r=i.editorProxy).changeWritingMode&&r.changeWritingMode(t),i.editorType=e,i.writingMode=t,"function"==typeof n?n():void 0}}(this))}},S.prototype.syncPreview=function(){var e,t,n;return t=this.getFirstVisibleRow(),n=this.documentToScreenRow(t),e=$.Event("editorScrollSync",{xsjOriginalEvent:null}),$(window).trigger(e,n)},S.prototype._initScrollSync=function(){var e,t,n,i;return 37,e=null,i=this,t=function(t,n){var r,o;if(!i.isOperating&&!function(e){var t;for(t=e;t;){if("editorScrollSync"===t.type&&"editor"===t.xsjId)return!0;t=t.xsjOriginalEvent}return!1}(t))return e=t,r=i.getScrollTop(),o=i.screenToDocumentRowHeight(n)+r-37,i.scrollToY(o)},n=_.throttle(t,100),$(window).on("previewScrollSync",n),$(window).on("beforeChangePreviewType",(function(e,t,i,r){return $(window).off("previewScrollSync",n)})),$(window).on("changePreviewType",(function(e,t,i){return $(window).on("previewScrollSync",n)})),this.on("changeScrollTop",function(t){return function(n){var i,r,o;return r=t.getFirstVisibleRow(),o=t.documentToScreenRow(r),i=$.Event("editorScrollSync",{xsjOriginalEvent:e,xsjId:"editor"}),$(window).trigger(i,o),e=null}}(this)),this.on("changeCursor",function(t){return function(n){var i,r;return r=t.getCursorPositionScreen(),i=$.Event("editorScrollSync",{xsjOriginalEvent:e,xsjId:"editor"}),$(window).trigger(i,[r,"changeCursor"]),e=null}}(this))},S.prototype.initEditor=function(e,n){var i,o,a;return this.layout=e,this.preventEventBubble(),this._initScrollSync(),i=this.model.get("editorType")||"codemirror",o=this.model.get("writingMode")||"","light"===i&&"vertical-lr"!==o&&"vertical-rl"!==o&&(o="",i="codemirror"),"horizontal-tb"===o&&(o="",i="codemirror"),this._setEditorType(i,o,(a=this,function(){return y(a),a.setEditorContent(),a.editorButtons=new s({editorView:a}),new h({editorView:a}).initStatics(),a.editorButtons.render().$el.appendTo(a.$el),t=w(a.editorProxy),a.editorTool=new l({editorView:t,fileMode:a.fileMode}),a.editorTool.render().$el.appendTo(a.$el),a.editorTool.initEditorTool(),C(a),a.editorProxy.addCommands(T),a.bindUserKeyBoard(),a._debounceAutoSave=_.debounce((function(){var e;return c.save(),a.model.get("autoSave").canAutoSave?(e=a,a.fileModel.save({},{error:function(t){return console.error(t),p.showMessage("\u81ea\u52a8\u4fdd\u5b58\u6587\u7ae0\u5931\u8d25:"+t,6e3,"error"),e.isOperating=!1},success:function(){return e.isOperating=!1,c.save({isLocked:!1})}})):a.isOperating=!1}),a.model.get("autoSave").interval),a._editorChangeFn=function(){var e;if(a.fileModel)return e=a.editorProxy.getValue(),a.fileModel.set({content:e,updateDate:Date.now()}),c.set({content:e,isLocked:!0}),a.isOperating=!0,a._debounceAutoSave()},a.on("change",a._editorChangeFn),a.saveCursorPosition=function(){var e,t;if(a.fileModel)return e=a.getCursorPositionXY()||{row:0,column:0},t=a.getAllFoldInfos()||[],c?c.save({cursorPosition:a.getCursorPosition()||0,cursorPositionColumn:e.column,foldInfos:t}):void 0},a._editorChangeScrollTopFn=function(){var e,t;return e=a.fileModel.id,(t=a.getScrollTop())||(t=1),a.scrollTopMap[e]=t},a.on("changeScrollTop",a._editorChangeScrollTopFn),new f({editorView:a,model:a.model}),n()})),this.$el.on("copy",function(e){return function(){return r.setCurrentCopiedFileModel(e.getActiveEditorProxy().fileModel||e.fileModel)}}(this))},S.prototype.toggleZenMode=function(e){return e?x=new g({el:this.el,editorView:this}):(null!=x&&x.destroy(),x=null),this.editorProxy.toggleZenMode(e)},F=_.debounce((function(e){var t;return e.scrollTopMap={},null!=(t=e.editorProxy)?t.resize():void 0}),500),S.prototype.resize=function(){return F(this)},S.prototype.initCursor=function(e){var t,n,i,r,o;if(null==e&&(e={}),r=0,t=0,i=[],c&&(r=c.get("cursorPosition")||0,t=c.get("cursorPositionColumn")||0,i=c.get("foldInfos")||[]),e.cursorPosition&&(r=e.cursorPosition,t=0,e.cursorPositionColumn&&(t=e.cursorPositionColumn)),e.foldInfos&&(i=e.foldInfos),e.hashTag&&(n=this.getCursorByHashTag(e.hashTag))&&(r=n.row,t=n.column),this.focus(),this.applyFoldInfos(i),0===r&&0===t||this.moveCursorTo(r,t),o=this.scrollTopMap[this.fileModel.id],(e.hashTag||e.cursorPosition||!o)&&(o=this.documentToScreenRowHeight(r)+this.getScrollTop()-this.$el.height()/2)<0&&(o=1),o)return this.scrollToY(o)},S.prototype.changeFileModel=function(e,t){var n,i,r,a,s,l;if(null==t&&(t={}),(n=$("body>.preview_export_wrapper>iframe")).length>0&&(r=n[0].contentDocument,a=n[0].contentWindow,$(r.body).remove(),$(r).off(),$(a).off()),$(".preview_export_wrapper").remove(),l=this,"function"==typeof this.saveCursorPosition&&this.saveCursorPosition(),this.off("change",this._editorChangeFn),this.off("changeScrollTop",this._editorChangeScrollTopFn),this.stopListening(this.fileModel),this.stopListening(c),this.unwatchFile(),this.fileModel=e,this._debounceAutoSave.cancel(),c&&c.save(),i=o.getFileLocalCollection(),(c=i.getFileLocalModelByFileId(e.id)).get("isLocked")?c.get("content")&&e.set({content:c.get("content")},{silent:!0}):c.save({content:e.get("content")}),null!=(s=this.editorProxy)&&s.changeFileModel(e),this.initCursor(t),this.on("change",this._editorChangeFn),this.on("changeScrollTop",this._editorChangeScrollTopFn),c&&this.listenTo(c,"change:fullPath",this.fullPathChangedFn),this.listenTo(this.fileModel,"change:title",(function(e){if(c)return c.save({title:e.get("title")})})),this.listenTo(this.fileModel,"change:content",(function(e,t){var n;if(n=l.getValue(),i=o.getFileLocalCollection(),c=i.getFileLocalModelByFileId(e.id),t!==n)return l.setValueAndNotTriggerEvent(t)})),this.listenTo(this.fileModel,"attachmentChange",(function(e,t,n){return b.cleanCache(n,e),e.trigger("repreview",e)})),this.editorTool.changeFileModel(this.fileModel),o.resetObjectUrlCache(),"client"===STORY_PLATFORM)return o.getClientFileWatchManager().checkConfirmFileLocalModel(c,(function(t,n){if(t)return e.set("content",n)})),this.watchFile()},S.prototype.unwatchFile=function(){if(c&&"client"===STORY_PLATFORM)return o.getClientFileWatchManager().unwatchFileLocalModel(c,this.clientWatchFileFn)},S.prototype.watchFile=function(){if(c&&"client"===STORY_PLATFORM)return o.getClientFileWatchManager().watchFileLocalModel(c,this.clientWatchFileFn)},S.prototype.fullPathChangedFn=function(e){var t,n;if(t=e.previousAttributes(),"client"===STORY_PLATFORM)return t&&(n=new u(t),o.getClientFileWatchManager().unwatchFileLocalModel(n,this.clientWatchFileFn)),o.getClientFileWatchManager().watchFileLocalModel(e,this.clientWatchFileFn)},S.prototype.on=function(e,t){if("changeCursor"===e&&this.$el.on(e,t),"change"===e&&this.$el.on("contentChange",t),"changeScrollTop"===e&&this.$el.on("editorScroll",t),"changeSelection"===e)return this.$el.on("changeSelection",t)},S.prototype.off=function(e,t){if("changeCursor"===e&&this.$el.off(e,t),"change"===e&&this.$el.off("contentChange",t),"changeScrollTop"===e&&this.$el.off("editorScroll",t),"changeSelection"===e)return this.$el.off("changeSelection",t)},S.prototype.bindUserKeyBoard=function(e){var t;if(!e){e=this.model.get("bindInfos");try{e=JSON.parse(e)}catch(t){e=[]}Object.keys(v).forEach((function(t,n){var i;if("all"===(i=v[t]).range)return i.command=t,e.unshift(i)}))}if(e instanceof Array)return o.homeView.bindUserKeyBoard(e),M=e,null!=(t=this.editorProxy)?t.bindUserKeyBoard(e):void 0},S.prototype.changeEditor=function(e,t,n){return this.off("changeScrollTop",this._editorChangeScrollTopFn),this.scrollTopMap={},this._setEditorType(e,t,(i=this,function(){return i.editorTool.reInitEditorTool(i.editorProxy),i.editorProxy.addCommands(T),i.bindUserKeyBoard(),i.setEditorContent(),i.model.set("editorType",e),i.model.set("writingMode",t),i.model.save(),i.initCursor(),i.on("changeScrollTop",i._editorChangeScrollTopFn),"function"==typeof n?n():void 0}));var i},S.prototype.setValueAndNotTriggerEvent=function(e){var t;return t=this,clearTimeout(this.setValueAndNotTriggerEvent.timer),this._debounceAutoSave.cancel(),this.off("change",this._editorChangeFn),this.editorProxy.setValue(e),c.get("isLocked")||c.save({content:e}),this.setValueAndNotTriggerEvent.timer=setTimeout((function(){return t.on("change",t._editorChangeFn)}),1)},S.prototype.setActiveEditorProxy=function(e){var t;if(this.activeEditorProxy=this.activeEditorProxy||this.editorProxy,this.activeDeepEditorProxy=this.activeDeepEditorProxy||this.activeEditorProxy,this.activeDeepEditorProxy!==e)return $(window).trigger("changeActiveEditorProxy",e),this.activeDeepEditorProxy=e,t=this.activeEditorProxy,e?e.rootEditorProxy?this.activeEditorProxy=e.rootEditorProxy:this.activeEditorProxy=e:this.activeEditorProxy=this.editorProxy,$(".draggable_dialog_editor_active").removeClass("draggable_dialog_editor_active raised"),this.activeEditorProxy.setActiveEditorProxy&&this.activeEditorProxy.setActiveEditorProxy(e,this.activeEditorProxy!==this.editorProxy&&t!==this.activeEditorProxy),e===this.editorProxy&&t!==this.activeEditorProxy?(this.editorTool.reInitEditorTool(this.editorProxy),this.getUndoManager().onButtonStateChange()):void 0},S.prototype.getActiveEditorProxy=function(e){return null==e&&(e=!0),this.activeEditorProxy=this.activeEditorProxy||this.editorProxy,e?this.activeEditorProxy.getActiveEditorProxy&&e?this.activeEditorProxy.getActiveEditorProxy():this.activeEditorProxy:this.activeEditorProxy.rootEditorProxy||this.activeEditorProxy},S.prototype.getActiveEditorView=function(e){var n;return null==e&&(e=!0),(n=this.getActiveEditorProxy(e))===this.editorProxy?this:(t.changeEditorProxy(n),t)},S.prototype.addEditorProxy=function(e){return n.push(e)},S.prototype.removeEditorProxy=function(e){return n=n.filter((function(t){return t!==e}))},S.prototype.getAllEditorProxies=function(e){return null==e&&(e=!0),e?n:n.filter((function(e){return e.rootEditorProxy===e}))},S.prototype.getAllFileModels=function(e){var t,n;return null==e&&(e=!0),t=this.getAllEditorProxies(e),n=[],this.fileModel&&n.push(this.fileModel),t.forEach((function(e){if(n.indexOf(e.fileModel)<0)return n.push(e.fileModel)})),n},S.prototype.preventEventBubble=function(){var e,t;return t=o.getKeyboardProfileModel(),e=this,this.$el.on("keydown",(function(n){var i;if(i=n.keyCode,27!==e.prevKeyCode||16===i||17===i||18===i||91===i)return 16!==i&&17!==i&&18!==i&&91!==i&&(e.prevKeyCode=i),!n.ctrlKey&&!n.altKey||t.getKeyByEvent(n)?void 0:n.stopPropagation();e.prevKeyCode=i}))},S}(),n.exports=c}}),window.requirejs.define({"views/exports/base":function(e,t,n){var i,r,o={}.hasOwnProperty;r=t("../../lib/notifier"),i=function(e){var t;function n(){return n.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)o.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(n,Backbone.View),n.prototype.name="",n.prototype.config={},n.prototype.preference=null,t=null,n.prototype.initialize=function(e,i){return null==i&&(i={}),n.__super__.initialize.call(this),t=i.containerView,this.config=t.exportConfig[this.name]||{}},n.prototype.events=function(){return{"click .fetch_button":"fetchFile","click .batch_fetch_button":"batchFetchFiles"}},n.prototype.batchFetchFiles=function(e){var n,i,r,o,a,s;return e.stopPropagation(),e.preventDefault(),s=$(e.currentTarget).data("key"),o=this.preference.exportFn,a=this.preference.getConfig,i=this.preference.cleanConfig,r={},a&&(r=a(this.$el.find("."+s+"_content")),n=_.clone(r),i&&(n=i(r)),t.exportConfig[s]=n),r.globalSetting=t.exportConfig.globalSetting,t.batchFetchFileDialog(s,r,o)},n.prototype.fetchFile=function(e){var n,i,o,a,s,l,c;return e.stopPropagation(),e.preventDefault(),c=$(e.currentTarget).data("key"),s=this.preference.fn,l=this.preference.getConfig,o=this.preference.cleanConfig,a={},l&&(a=l(this.$el.find("."+c+"_content")),n=_.clone(a),o&&(n=o(a)),t.exportConfig[c]=n),a.globalSetting=t.exportConfig.globalSetting,t.dimmer.dimmer("show"),i=function(e,n){return t.dimmer.dimmer("hide"),e?r.showMessage(e+"",6e3,"error"):n?(saveAs(n.blob||n.url,n.filename),r.showMessage("\u5bfc\u51fa\u6210\u529f")):void 0},s(this.model,a,i)},n.prototype.render=function(){var e,t,n,i,r,o;return o=this.preference,r=this.name,t="",o.generateConfigHtml&&(t=$.isFunction(o.generateConfigHtml)?o.generateConfigHtml(this.config,this.model):o.generateConfigHtml),i="",o.exportFn&&(i='<i class="icons batch_fetch_button " data-key="'+r+'">\n<i class="icon download circular"></i>\n<i class="corner add icon"></i>\n</i>'),n='<div class="title '+(o.defaultClass||"")+'">\n<i class="dropdown icon"></i>\n<span class="title_info">'+o.title+'</span>\n<span class="title_button">\n  '+i+'\n  <i class="icons fetch_button " data-key="'+r+'">\n  <i class="icon download circular" data-key="'+r+'"></i>\n  </i>\n</span>\n</div>\n<div class="content '+r+"_content "+(o.defaultClass||"")+'">\n<p>'+o.description+'</p>\n<p class="config_container"></p>\n</div>',e=$(n),t&&e.find(".config_container").append(t),this.$el.html(e),this.$el.addClass("export_"+r+"_item")},n.prototype.destroy=function(){},n}(),n.exports=i}}),window.requirejs.define({"views/exports/client_pdf":function(e,t,n){var i,r,o,a,s,l,c,u,d,p={}.hasOwnProperty;a=t("../../lib/utils"),t("../../constant"),i=t("../../application"),t("../../lib/app_resource_core"),t("../../lib/utils_size"),r=t("./base"),s=null,l=function(){var e,t;if(c.cache={},s)return t=require("fs-extra"),e=s,t.emptyDir(s,(function(t){if(t)return console.error("emptyDir fail:"+e),console.error(t)})),s=null},d=function(e,t,n){var i;return i=Object.assign({},t),c(e,i,(function(e,t){return n(e,t)}))},u={title:"\u672c\u5730\u5ba2\u6237\u7aefpdf\u5bfc\u51fa",icon:"fas fa-file-pdf fa-fw",description:"\u76f4\u63a5\u672c\u5730pdf\u5bfc\u51fa",clientOnly:!0,exportFn:c=function(e,t,n){var r,o,l;if(l=e.get("_id")+"_"+e.get("_rev")+"_"+JSON.stringify(t),c.cache||(c.cache={}),!(o=c.cache[l]))return r=function(n,i,r){var o,a,l,c,u;return o=n,a=require("fs"),c=require("path"),l=require("fs-extra"),s=c.resolve(nw.App.dataPath,"xsj_temp","client_pdf"),l.ensureDirSync(s),u=c.resolve(s,"client_pdf_"+uniqueNumber()+".pdf"),l.writeFileSync(u,""),o.nw.Window.get().print({autoprint:!0,silent:!0,landscape:!1,marginsType:0,shouldPrintBackgrounds:!0,headerFooterEnabled:!0,mediaSize:{name:"CUSTOM",width_microns:21e4,height_microns:297e3,custom_display_name:"A4",is_default:!0},footerString:" ",headerString:" ",pdf_path:u}),function(n,r){var o;return t={type:"GET",dataType:"json",url:"/pdfInfo",data:o={path:n},success:function(t,s,l){var c,u,d,p,f;return f=new TPDFAnalyst,p=new TPDFOutLineMaker,o=new Uint8Array(a.readFileSync(n)),f.LoadFromStream(o),p.View.PageMode=TPDFPageMode.pmUseOutlines,c=t.data.annotations,function e(t,n,r,o){for(var a=7,s=null,l=r;o>l;l++){var u,d=i[l],f=d[0];if(7==a&&(a=f),n>=f)return l;f>a?l=e(s,a,l,o)-1:(u=c[d[2]])&&(s=t?t.AddChild(d[1],u[0],u[1],"",!1,!1,null):p.OutLine.AddRoot(d[1],u[0],u[1],"",!1,!1,null))}return o}(null,0,0,i.length),u=p.Save(f),d=(e.get("title")||"\u5c0f\u4e66\u5320")+".pdf",r(null,{blob:u,filename:d},t)},error:function(e,t){return r("\u53d6\u5f97pdf\u4fe1\u606f\u5931\u8d25",null)}},$.ajax(t)}(u,(function(e,t,n){return r(e,t)}))},setTimeout((function(){return $(window).trigger("convertPreviewFormatForExport",[e,{width:"210mm",type:"dataURL",mindmap_fixForLink:!0,netImage:!0,convertSvg:t.convertSvg,convertFontIcon:!1,parseClientLocalMedias:!0,brand:"xsj_export_print"},function(o,s){var u,d;return s.find("a.attachment").remove(),s.find("#MathJax_SVG_glyphs path").attr("stroke","none"),s.find(".blank_anchor_name").remove(),u=[],d=1,s.find("h1,h2,h3,h4,h5,h6,h7").map((function(e,t){var n,i;return i=t.tagName.substring(1),n=$(t),u.push([i,$.trim(t.textContent),"n"+d]),n.css("position","relative"),n.prepend('<a href="xsj://n'+d+'" style="height: 3px;border-width: initial !important; border-style: none !important; border-color: initial !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: none !important; background: transparent !important; text-decoration: initial !important; text-shadow: initial !important;"> </a>'),d++})),i.getStyleText(e,t.globalSetting,(function(t,i){var o;return o=i,PopupCenter("preview.html","xsj_pdf_print",400,400,(function(t){var i;return(i=t.$)("head").append('<style type="text/css">\n  '+o+"\n  \n</style>"),t.document.title=e.get("title")||"\u5c0f\u4e66\u5320",i(".preview").replaceWith(s.html()),setTimeout((function(){return t.document.fonts.ready.then((function(){return a.asyncLoadResources([{id:"pdf_design_js",type:"script",filename:"js/pdf-design/pdf-design.js"}],(function(){return r(t,u,(function(e,i){if(t.close(),!e)return c.cache[l]=i,n(null,c.cache[l]);n(e)}))}))}))}),0)}),(function(){return console.log("client pdf unload")}),{show:!1})}))}])}),1e3);setTimeout((function(){return n(null,o)}),10)},fn:d,getConfig:function(e){return{convertSvg:e.find("input[name=convertSvg]").is(":checked")}},generateConfigHtml:function(e,t){var n;return null==e&&(e={}),null==t&&(t=null),n={},$.extend(n,{convertSvg:!1},e),'<div>\n\u5c06svg\u8f6c\u6362\u6210\u56fe\u7247: <input type="checkbox" name="convertSvg" '+(n.convertSvg?"checked":"")+"><br>\n</div>"}},o=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)p.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.name="clientPdf",t.prototype.preference=u,t.prototype.destroy=l,t}(r),n.exports=o}}),window.requirejs.define({"views/exports/docx":function(e,t,n){var i,r,o,a,s,l,c,u,d,p={}.hasOwnProperty;a=t("../../lib/utils"),t("../../constant"),i=t("../../application"),s=t("../../lib/utils_size"),r=t("./base"),d=s.pageSizeMap,c=function(e,t,n){var r,o,s,l;if(l=e.get("_id")+"_"+e.get("_rev")+"_"+JSON.stringify(t),c.cache||(c.cache={}),!(s=c.cache[l]))return r={changeOpenTarget:!0,parseClientLocalMedias:!0},$.extend(r,t),o=function(t){var o,s,u;return navigator.onLine?(r.title||(r.title=e.get("title")),u=i.getUserModel(),s=u.get("user"),o=u.get("token"),i.getStyleText(e,r.globalSetting,(function(i,u){return a.exportDocxFile(s,o,t,e.get("title"),u,r,(function(e,t,i){return e?n(e):i?fetch(i).then((function(e){return e.blob()})).then((function(e){return c.cache[l]=Object.assign({},t,{blob:e,filename:t.filename}),n(null,c.cache[l])})).catch((function(e){return n(e)})):n(t)}))}))):n("\u5bfc\u51fa\u5931\u8d25\uff0c\u8be5\u5bfc\u51fa\u529f\u80fd\u9700\u8981\u8054\u7f51\u72b6\u6001\u4e0b\u624d\u80fd\u4f7f\u7528")},setTimeout((function(){var t,n,i;return i="100%",n="100%",t=function(e){var t,r,o,a,s;return(s=d[e.pageSize])||(s=[21,29.7]),a=e.marginTop||25.4,t=e.marginBottom||25.4,r=e.marginLeft||25.4,o=e.marginRight||25.4,i=s[0],n=s[1],e.pageWidth>0&&(i=e.pageWidth),e.pageHeight>0&&(n=e.pageHeight),i-=(r+o)/10,n-=(a+t)/10,"Landscape"===e.orientation&&(i=s[1],n=s[0],e.pageHeight>0&&(i=e.pageHeight),e.pageWidth>0&&(n=e.pageWidth),i-=(a+t)/10,n-=(r+o)/10),.393700787,72,[.393700787*i*72+"pt",.393700787*n*72+"pt"]}(r),i=t[0],n="100%",$(window).trigger("convertPreviewFormatForExport",[e,{mindmap_fixForLink:!1,width:i,height:n,changeOpenTarget:!0,renderMetaTitle:r.renderMetaTitle,renderMetaTag:r.renderMetaTag,parseClientLocalMedias:!0,type:"dataURL",netImage:!0,convertSvg:!0,convertFontIcon:!0,brand:"xsj_export_docx"},function(e,t){return t.find(".blank_anchor_name").remove(),t.find("#MathJax_SVG_glyphs path").attr("stroke","none"),t.find(".li_linenum_before_span").remove(),t.find(".xiaoshujiang_code_clear").remove(),t.find(".code_line_break_hack_br").replaceWith("<span>&nbsp;</span>"),t.find(".xiaoshujiang_code_container+.xiaoshujiang_code_container").map((function(e,t){var n;if(0===(n=$(t)).find(".xiaoshujiang_code_title_container").length)return n.prepend("<p></p>")})),t.find("blockquote+blockquote").prepend("<p></p>"),t.find(".xiaoshujiang_code_container>.xiaoshujiang_pre>.xiaoshujiang_code>ol.ol_linenums>.li_linenum").css({paddingTop:"0.5em",paddingBottom:"0.5em"}),t.find(".li_linenum").addClass("li_list_style"),o(t)}])}),1e3);setTimeout((function(){return n(null,s)}),10)},u={title:"Word 2007 (docx)",icon:"far fa-file-word fa-fw",defaultClass:"vip",config:{baseFontSize:0},getConfig:function(e){var t;return t=e.find("input[name=baseFontSize]"),{baseFontSize:parseInt(t.val())||0}},generateConfigHtml:function(e,t){var n;return null==e&&(e={}),null==t&&(t=null),n={},$.extend(n,{baseFontSize:0},e),'<div>\n\u5b57\u4f53\u5927\u5c0f\u57fa\u51c6: <input type="text" name="baseFontSize" value="'+n.baseFontSize+'"/><br>\n</div>'},description:"\u5bfc\u51fa\u4e3adocx\u6587\u6863, \u652f\u6301 word 2007 \u4e4b\u540e\u7684\u7248\u672c,\u9700\u8981\u8054\u7f51\u72b6\u6001\u4e0b\u624d\u80fd\u5bfc\u51fa(\u4f1a\u5458), \u6700\u5927\u652f\u6301 32M \u6587\u4ef6\u4e0a\u4f20",exportFn:function(e,t,n){return c(e,Object.assign({},t,{title:e.get("title")||"",coverTitle:e.get("title")||"",password:""}),n)},fn:function(e,t,n){var i;return i={changeOpenTarget:!0,parseClientLocalMedias:!0},$.extend(i,t),c(e,i,(function(e,t){if(n(e,t),t.password)return Notifier.showMessage({html:"\u5bfc\u51fa\u6210\u529f<br/> docx \u52a0\u5bc6\u5bc6\u7801\u4e3a:<br/>"+t.password},1e4,"info")}))}},l=function(){return c.cache={}},o=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)p.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.name="docx",t.prototype.preference=u,t.prototype.destroy=l,t}(r),n.exports=o}}),window.requirejs.define({"views/exports/epub":function(e,t,n){var i,r,o,a,s,l,c,u,d={}.hasOwnProperty;t("../../lib/utils"),o=t("../../constant"),i=t("../../application"),s=t("../../lib/utils_size"),r=t("./base"),u=s.pageSizeMap,l=function(e,t,n,i,r,a){return $.get(o.exportHtmlTemplateFile,(function(s,l,c){var u,d;return u=_.template(s),t.find(".attachment").remove(),s={html:u({welcome:o.welcome,title:n,style:i,content:t.html()}),access_token:e,title:n,config:JSON.stringify(r)},t=null,d=o.exportHost+"/vipexportepubfile",$.ajax({url:d,type:"POST",data:s,success:function(e,t,n){var i;return e&&e.uuid?(i=o.exportHost+"/getfile?uuid="+e.uuid,a(null,{url:i,filename:e.filename,password:obj.password})):a(JSON.stringify(e))},error:function(e,t){return a(t)}})}))},c={title:"Epub",icon:"fas fa-file-archive fa-fw",defaultClass:"vip",config:{baseFontSize:0},getConfig:function(e){var t;return t=e.find("input[name=baseFontSize]"),{baseFontSize:parseInt(t.val())||0}},generateConfigHtml:function(e,t){var n;return null==e&&(e={}),null==t&&(t=null),n={},$.extend(n,{baseFontSize:0},e),'<div>\n\u5b57\u4f53\u5927\u5c0f\u57fa\u51c6: <input type="text" name="baseFontSize" value="'+n.baseFontSize+'"/><br>\n</div>'},description:"\u5bfc\u51fa\u4e3aepub\u6587\u6863, \u9700\u8981\u8054\u7f51\u72b6\u6001\u4e0b\u624d\u80fd\u5bfc\u51fa(\u4f1a\u5458), \u6700\u5927\u652f\u6301 32M \u6587\u4ef6\u4e0a\u4f20",fn:function(e,t,n){var r,o,a;return r={changeOpenTarget:!0,parseClientLocalMedias:!0},$.extend(r,t),a=e,o=function(e){var t,o;return navigator.onLine?(r.title||(r.title=a.get("title")),(o=i.getUserModel()).get("user"),t=o.get("token"),i.getStyleText(a,r.globalSetting,(function(i,o){return l(t,e,a.get("title"),o,r,(function(e,t){if(n(e,t),null!=t?t.password:void 0)return Notifier.showMessage({html:"\u5bfc\u51fa\u6210\u529f<br/> docx \u52a0\u5bc6\u5bc6\u7801\u4e3a:<br/>"+t.password},1e4,"info")}))}))):n("\u5bfc\u51fa\u5931\u8d25\uff0c\u8be5\u5bfc\u51fa\u529f\u80fd\u9700\u8981\u8054\u7f51\u72b6\u6001\u4e0b\u624d\u80fd\u4f7f\u7528")},setTimeout((function(){var t,n,i;return i="100%",n="100%",t=function(e){var t,r,o,a,s;return(s=u[e.pageSize])||(s=[21,29.7]),a=e.marginTop||0,t=e.marginBottom||0,r=e.marginLeft||0,o=e.marginRight||0,i=s[0],n=s[1],e.pageWidth>0&&(i=e.pageWidth),e.pageHeight>0&&(n=e.pageHeight),i-=(r+o)/10,n-=(a+t)/10,"Landscape"===e.orientation&&(i=s[1],n=s[0],e.pageHeight>0&&(i=e.pageHeight),e.pageWidth>0&&(n=e.pageWidth),i-=(a+t)/10,n-=(r+o)/10),.393700787,72,[.393700787*i*72+"pt",.393700787*n*72+"pt"]}(r),i=t[0],n="100%",$(window).trigger("convertPreviewFormatForExport",[e,{mindmap_fixForLink:!0,width:i,height:n,changeOpenTarget:!0,renderMetaTitle:r.renderMetaTitle,renderMetaTag:r.renderMetaTag,parseClientLocalMedias:!0,type:"dataURL",netImage:!0,convertSvg:!1,convertFontIcon:!0,brand:"xsj_export_epub"},function(e,t){return t.find(".blank_anchor_name").remove(),t.find("#MathJax_SVG_glyphs path").attr("stroke","none"),t.find(".li_linenum_before_span").remove(),t.find(".li_linenum").addClass("li_list_style"),o(t)}])}),1e3)}},a=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)d.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.name="epub",t.prototype.preference=c,t}(r),n.exports=a}}),window.requirejs.define({"views/exports/export_file_dialog_view":function(e,t,n){var i,r,o,a,s,l,c,u,d,p,f,h,m,v,g={}.hasOwnProperty;c=t("../view"),l=t("../../lib/utils"),i=t("../../application"),r=t("../../constant"),m=t("../templates/export_file_dialog"),s=t("./select_files_manager_dialog_view"),o=t("./index"),v=null,d=null,f=!1,u=function(){var e,t,n,i;if(null!=d&&d.destroy(),d=null,v)return v.apm.set("exportConfig",JSON.stringify(v.exportConfig)),v.apm.save(),null!=(i=v.$result)&&i.remove(),(e=$("body>.preview_export_wrapper>iframe")).length>0&&(t=e[0].contentDocument,n=e[0].contentWindow,$(t.body).remove(),$(t).off(),$(n).off()),$("body>.preview_export_wrapper").remove(),v.$el.modal("destroy"),v.remove(),v=null},p=function(){var e,t,n,i,o,a;return(o=_.map(r.codeTheme)).unshift({name:"\u4e0d\u8bbe\u7f6e",url:""}),(a=_.map(r.previewTheme)).unshift({name:"\u4e0d\u8bbe\u7f6e",url:""}),i=v.$el.find(".system_preview_select_css_container"),n=$("<select name='systemPreviewCss'></select>"),$.each(a,(function(e,t){return n.append("<option value='"+t.url+"'>"+t.name+"</option>")})),i.append(n),t=v.$el.find(".code_preview_select_css_container"),e=$("<select name='codePreviewCss'></select>"),$.each(o,(function(t,n){return e.append("<option value='"+n.url+"'>"+n.name+"</option>")})),t.append(e),h()},h=function(){var e,t,n,i;return n=(t=v.exportConfig.globalSetting||{}).systemPreviewCss||"",e=t.codePreviewCss||"",i=t.userPreviewCssText||"",v.$el.find(".code_preview_select_css_container>select").val(e),v.$el.find("textarea[name=userPreviewCssText]").val(i),v.$el.find(".system_preview_select_css_container>select").val(n)},a=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)g.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.template=m,t.prototype.className="ui modal standard story_modal export_modal",t.prototype.selectedDocs=[],t.prototype.initialize=function(){var e,t;t=(e=i.getApplicationProfileModel()).get("exportConfig")||"{}";try{t=JSON.parse(t)}catch(e){e,t={}}return this.exportConfig=t,this.apm=e},t.prototype.getRenderData=function(){return{title:"\u5bfc\u51fa\u6587\u4ef6\uff1a"+this.model.get("title")}},t.prototype.events={"click .settings_button":"globalSettingsFn","click .global_settings_ok_button":"saveGlobalSettingsFn","click .global_settings_cancel_button":"cancelGlobalSettingsFn"},t.prototype.saveGlobalSettingsFn=function(e){var t,n,i,r;return e.stopPropagation(),e.preventDefault(),r=v.$el.find("textarea[name=userPreviewCssText]").val()||"",t=v.$el.find("select[name=codePreviewCss]>option:selected").val()||"",i=v.$el.find("select[name=systemPreviewCss]>option:selected").val()||"",(n=v.exportConfig.globalSetting||{}).userPreviewCssText=r,n.codePreviewCss=t,n.systemPreviewCss=i,v.exportConfig.globalSetting=n,v.apm.set("exportConfig",JSON.stringify(v.exportConfig)),v.apm.save(),v.setDisplayMode("")},t.prototype.cancelGlobalSettingsFn=function(e){return v.setDisplayMode(""),h()},t.prototype.setDisplayMode=function(e){var t,n,i,r,o,a;switch(i=v.$el.find(".settings_button"),a=v.$el.find(".export_function_global_settings_container"),n=v.$el.find(".export_function_list_container"),o=v.$el.find(".global_settings_ok_button"),r=v.$el.find(".global_settings_cancel_button"),t=v.$el.find(".basic_close_button"),v.displayMode=e,e){case"setting":return i.addClass("blue"),n.hide(),a.show(),o.css("display","inline-block"),r.css("display","inline-block"),t.hide();default:return i.removeClass("blue"),n.show(),a.hide(),o.hide(),r.hide(),t.css("display","inline-block")}},t.prototype.globalSettingsFn=function(e){return"setting"===v.displayMode?v.setDisplayMode(""):v.setDisplayMode("setting")},t.prototype.batchFetchFileDialog=function(e,t,n){return this.$el.modal("setting","transition","horizontal flip"),f=!0,new s({type:e,exportFileDialogView:this,config:t,exportFn:n,initDocs:this.selectedDocs||[]}).show()},t.prototype.batchFetchFiles=function(e,t){return this.selectedDocs=e,this.$el.find(".batch_fetch_button[data-key="+t+"]").click()},t.prototype.fetchFile=function(e){var t;return null!=(t=this.$el.find(".export_"+e+"_item")[0])&&t.scrollIntoView(),this.$el.find(".fetch_button[data-key="+e+"]").click()},t.prototype.destroy=function(){return u()},t.prototype.afterRender=function(){return d=o(this),this.$el.accordion({duration:0,onOpen:function(){return v.$el.modal("refresh")}}),v.setDisplayMode(""),p()},t.prototype.hide=function(){return f=!0,v.$el.modal("hide")},t.prototype.show=function(e){return v?(v.$el.modal("show"),void(f=!1)):(v=this,this.render(),this.dimmer=l.xsjDimmer(this.$el),this.$el.modal({dimmerSettings:{opacity:.7},closable:!1,onVisible:function(){if(v)return v.$el.modal("setting","transition","scale"),e?setTimeout((function(){return"function"==typeof e&&e(v),e=null}),600):void 0},onHidden:function(){if(!f&&v)return u()}}).modal("show"))},t}(c),n.exports=a}}),window.requirejs.define({"views/exports/html":function(e,t,n){var i,r,o,a,s,l,c,u,d,p={}.hasOwnProperty;a=t("../../lib/utils"),i=t("../../application"),t("../../lib/notifier"),r=t("./base"),l=function(e,t,n){var r;return r={type:"dataURL",netImage:!0,changeOpenTarget:!1,parseClientLocalMedias:!1,brand:"xsj_export_html"},$.extend(r,t),setTimeout((function(){return $(window).trigger("convertPreviewFormatForExport",[e,r,function(t,o){return i.getStyleText(e,r.globalSetting,(function(t,i){return a.exportInlineStylesheetHtmlFile(o,e.get("title"),i,r,(function(e,t,i){return n(e,{blob:t,filename:i})}))}))}])}),1e3)},d=function(e,t,n){return l(e,t,(function(e,t){return n(e,t)}))},s=function(e,t,n){var r;return r={type:"dataURL",netImage:!0,changeOpenTarget:!1,parseClientLocalMedias:!1,brand:"xsj_export_html"},$.extend(r,t),setTimeout((function(){return $(window).trigger("convertPreviewFormatForExport",[e,r,function(t,o){return i.getStyleText(e,r.globalSetting,(function(t,i){return a.exportHtmlFile(o,e.get("title"),i,r,(function(e,t,i){return n(e,{blob:t,filename:i})}))}))}])}),1e3)},u=function(e,t,n){return s(e,t,(function(e,t){return saveAs(t.blob,t.filename),n(null)}))},c={title:"HTML",icon:"fas fa-file-code fa-fw",config:{inlineStylesheet:!1,netImage:!0,convertSvg:!0,convertFontIcon:!1,changeOpenTarget:!1,toc:!1},description:"\u5c06\u5f53\u524d\u6587\u7ae0\u5bfc\u51fa\u4e3ahtml\u683c\u5f0f",exportFn:function(e,t,n){return t.inlineStylesheet?l(e,t,n):s(e,t,n)},fn:function(e,t,n){return t.inlineStylesheet?d(e,t,n):u(e,t,n)},getConfig:function(e){var t,n,i,r,o;return i=e.find("input[name=inlineStylesheet]"),r=e.find("input[name=netImage]"),n=e.find("input[name=convertSvg]"),t=e.find("input[name=changeOpenTarget]"),o=e.find("input[name=toc]"),{inlineStylesheet:i.is(":checked"),netImage:r.is(":checked"),convertSvg:n.is(":checked"),changeOpenTarget:t.is(":checked"),toc:o.is(":checked")}},generateConfigHtml:function(e,t){var n;return null==e&&(e={}),null==t&&(t=null),n={},$.extend(n,{inlineStylesheet:!1,netImage:!0,convertSvg:!0,changeOpenTarget:!1,toc:!1},e),'<div>\ninlineStylesheet:<input type="checkbox" name="inlineStylesheet" '+(n.inlineStylesheet?"checked":"")+'><br>\n\u8f6c\u6362\u7f51\u7edc\u56fe\u7247: <input type="checkbox" name="netImage" '+(n.netImage?"checked":"")+'><br>\n\u5c06svg\u8f6c\u6362\u6210\u56fe\u7247: <input type="checkbox" name="convertSvg" '+(n.convertSvg?"checked":"")+'><br>\n\u5728\u65b0\u7a97\u53e3\u6253\u5f00\u8d85\u94fe\u63a5: <input type="checkbox" name="changeOpenTarget" '+(n.changeOpenTarget?"checked":"")+'><br>\n\u751f\u6210\u5e26\u811a\u672c\u7684\u76ee\u5f55: <input type="checkbox" name="toc" '+(n.toc?"checked":"")+"><br>\n</div>"}},o=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)p.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.name="html",t.prototype.preference=c,t}(r),n.exports=o}}),window.requirejs.define({"views/exports/index":function(e,t,n){var i,r;i=t("./utils"),r=function(e){var t,n,r;return n=i.getExportViewClassiesFn(!0),(t=e.$el.find(".function_form")).html(""),r=[],n.forEach((function(n){var i;return i=new n({model:e.model},{containerView:e}),r.push(i),i.render(),t.append(i.$el)})),{destroy:function(){return r.forEach((function(e){return e.destroy()}))}}},n.exports=r}}),window.requirejs.define({"views/exports/jopp":function(e,t,n){var i,r,o,a,s,l,c,u,d,p,f,h,m,v,g,w=function(e,t){for(var n in t)y.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e},y={}.hasOwnProperty;t("../../lib/utils"),i=t("../../application"),r=t("./base"),d={xsj_jopp:{id:"xsj_jopp",name:"\u5c0f\u4e66\u5320\u9ed8\u8ba4"}},g=[],u={sizeItemId:"",paperWidth:"8.3in",paperHeight:"11.7in",injectCss:"",paperMargin:{top:"15mm",right:"15mm",bottom:"15mm",left:"15mm"},emulateMediaType:"print",disableAutoPageBreakAlgorithm:!1,overrideGlobalSettings:!1,pageSetting:null,scanLazyElementDelay:0,documentInfo:{url:"",origin:"",hostname:"",favIconUrl:""}},p=function(e){return null==e&&(e=document),new Promise((function(t){var n,i,r,o;return r=(n=Array.from(e.images)).length,0,0,0===(o=n.filter((function(e){return!e.complete}))).length?(console.log("\u6240\u6709\u56fe\u7247\u5df2\u52a0\u8f7d\u5b8c\u6210"),t()):(r-o.length,i=0,o.forEach((function(e){return e.loading="",e.addEventListener("load",(function(){if(i++,i===o.length)return console.log("\u6240\u6709\u56fe\u7247\u52a0\u8f7d\u5b8c\u6210"),t()})),e.addEventListener("error",(function(){if(i++,i===o.length)return console.log("\u6240\u6709\u56fe\u7247\u52a0\u8f7d\u5b8c\u6210\uff08\u5305\u542b\u52a0\u8f7d\u5931\u8d25\u7684\u56fe\u7247\uff09"),t()}))})))}))},a=function(e){return function(t,n,r){var o;return o={type:"dataURL",netImage:!0,parseClientLocalMedias:!0,brand:"xsj_export_jopp"},i.getStyleText(t,n.globalSetting,(function(i,a){return $(window).trigger("convertPreviewFormatForExport",[t,o,function(i,o){return PopupCenter("preview.html","xsj_pdf_jopp",793,1123,(function(i){var s,l,c,d;return(s=i.$)("head").append('<style type="text/css">\n  '+a+"\n  body .plot {\n    max-width: 500px;\n    min-width: 400px;\n    min-height: 200px;\n}\nhtml {\n    height: auto !important;\n    overflow: auto !important;\n}\n.preview_wrapper {\n  overflow-x: hidden;\n}\n.preview.html_preview{\n  flex-grow: initial;\n}\n.preview .xiaoshujiang_element {\n    display: none !important;\n}\nbody {\n    height: auto !important;\n    margin: 0 auto !important;\n    overflow: initial !important;\n}\n.preview.html_preview:after{\n  display: none!important;\n}\n* {\n  scroll-padding-top: initial!important;\n  scroll-padding-right: initial!important;\n  scroll-padding-bottom: initial!important;\n  scroll-padding-left: initial!important;\n}\n.story_title, .story_tags, .normal_toc{\n  display: none;\n}\ntable tbody tr td:first-child::before, table tbody tr:first-child td::after, table thead tr:first-child th::after{\n  content: '';\n}\n</style>"),c=null,d=null,l=function(){return window.JOPPInstance.sendMessage(e,{type:"joppActive"}),i.close()},i.document.title=t.get("title")||"\u5c0f\u4e66\u5320",o.find("a.attachment").remove(),s(".preview").replaceWith(o.html()),setTimeout((function(){return p(i.document).then((function(){var r,o,a,s;return r=Object.assign({},u),s=null!=(o=n.sizeItem)?o.id:void 0,(a=m(s))&&(r=Object.assign(r,{sizeItemId:a.id,paperWidth:a.width,paperHeight:a.height,injectCss:a.css,paperMargin:a.margin,emulateMediaType:a.media,disableAutoPageBreakAlgorithm:a.disableAutoPageBreakAlgorithm,pageSetting:a.pageSetting})),r.documentInfo={hostname:n.hostname,url:n.url,origin:n.origin},i.JOPPInstance.sendMessage(e,{type:"joppPrint",printOpts:r},(function(e){return(null!=e?e.functionName:void 0)&&i[e.functionName]?i[e.functionName]().then((function(e){return c={blob:e,filename:t.get("title")+".pdf"}})).catch((function(e){return d=e})).finally((function(){return l()})):(d="\u63d2\u4ef6\u5bfc\u51fa pdf \u51fa\u9519",l())}))}))}),0),i.onunload=function(){return i.onunload=null,d||c?(console.log("unload ",d,c),r(d,c)):(i.close(),r("\u5bfc\u51fa\u671f\u95f4\uff0c\u8bf7\u4e0d\u8981\u5237\u65b0\u6216\u8005\u5173\u95ed\u5f39\u51fa\u9875\u9762"))}}),(function(){}),{show:!0,fullscreen:!0})}])}))}},f={title:"Just One Page PDF",description:'\u4f7f\u7528 Just One Page PDF \u6d4f\u89c8\u5668\u63d2\u4ef6\u5bfc\u51fa PDF<br/>\n<strong><a href="'+(v="https://chromewebstore.google.com/detail/fgbhbfdgdlojklkbhdoilkdlomoilbpl")+'" target="_blank">Just One Page PDF</a></strong> \u662f\u4e00\u6b3e\u5f3a\u5927\u7684 HTML \u8f6c PDF \u6d4f\u89c8\u5668\u63d2\u4ef6\uff0c\u652f\u6301\u81ea\u5b9a\u4e49\u5c3a\u5bf8\uff0c\u6279\u91cf\u6253\u5370\uff0c\u622a\u56fe\u6253\u5370\uff0c\u81ea\u5b9a\u4e49\u5c01\u9762\uff0c\u5e95\u9762\uff0c\u76ee\u5f55\u9875\uff0c\u9875\u7709\u53ca\u9875\u811a\uff0e<br/>\n<a href="https://www.bilibili.com/video/BV1z16XYWELY" target="_blank">\u89c6\u9891\u4ecb\u7ecd</a>',webOnly:!0,config:c={sizeItem:null,hostname:"\u5c0f\u4e66\u5320 + Just One Page PDF",url:v,origin:"https://www.xiaoshujiang.com"},getConfig:function(e){var t;return{sizeItem:{id:(t=e.find("select[name=paperSizeSelector]")).val(),name:t.find(":selected").text()},hostname:e.find("input[name=hostname]").val(),url:e.find("input[name=url]").val(),origin:e.find("input[name=origin]").val()}},generateConfigHtml:function(e,t){var n,i,r,o,a,s,l;for(i in null==e&&(e={}),null==t&&(t=null),n={},$.extend(n,c,e),r=$.extend({},d),s="xsj_jopp",n.sizeItem&&(s=n.sizeItem.id,r[n.sizeItem.id]=n.sizeItem),o=[],r)l=r[i],a="",i===s&&(a="selected"),o.push('<option value="'+i+'" '+a+">"+_.escape(l.name)+"</option>");return'<div>\n  <form class="ui form">\n    <div class="ui blue segment">\n      <div class="inline fields">\n        <div class="field">\n          \u7eb8\u5f20\u5c3a\u5bf8\uff1a\n          <select name="paperSizeSelector">\n            '+o.join("")+'\n          </select>\n        </div>\n      </div>\n      <div class="inline fields">\n        <div class="field twelve wide">\n          Hostname\uff1a<input placeholder="\u4f8b\u5982: \u5c0f\u4e66\u5320+Just One Page PDF" type="text" name="hostname" value="'+(_.escape(n.hostname)||"")+'">\n        </div>\n      </div>\n      <div class="inline fields">\n        <div class="field twelve wide">\n          URL\uff1a<input placeholder="\u4f8b\u5982: '+v+'" type="text" name="url" value="'+(_.escape(n.url)||"")+'">\n        </div>\n      </div>\n      <div class="inline fields">\n        <div class="field twelve wide">\n          Origin\uff1a<input placeholder="\u4f8b\u5982: https://www.xiaoshujiang.com" type="text" name="origin" value="'+(_.escape(n.origin)||"")+'">\n        </div>\n      </div>\n    </div>\n  </form>\n</div>'}},h=function(e,t){return window.JOPPInstance.sendMessage(e,{type:"joppPaperSizeItems"},t)},m=function(e){var t,n,i;if(!e)return null;if(!g)return null;for(t=0,n=g.length;t<n;t++)if(e===(i=g[t]).id)return i;return null},o=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return w(t,e),t.prototype.name="installJOPPPdf",t.prototype.preference={title:f.title,description:f.description,webOnly:f.webOnly,isHelpTip:!0},t.prototype.events={"click .install_jopp_btn":"installJOPPFn"},t.prototype.installJOPPFn=function(e){var t;return e.preventDefault(),e.stopPropagation(),(t=document.createElement("a")).setAttribute("target","_blank"),t.href=v,t.click()},t.prototype.render=function(){var e;return e='<div class="title">\n  <i class="dropdown icon"></i>\n  <span class="title_info">\n    <img class="jopp_logo_img" src="./img/jopp.svg" alt="">\n    \u5b89\u88c5 Just One Page PDF\n  </span>\n  <span class="title_button">\n    <i class="icons install_jopp_btn" style="color: var(--negativeColor);">\n      <i class="icon chrome circular" style="outline: 2px dotted;"></i>\n    </i>\n  </span>\n</div>\n<div class="content">\n  <p>'+f.description+"</p>\n</div>",this.$el.html(e)},t}(Backbone.View),s=function(){var e,t;return t=[],(null!=(e=window.JOPPInstance)?e.extensions:void 0)?(Object.keys(window.JOPPInstance.extensions).forEach((function(e){var n,i,o,s,l;return s=window.JOPPInstance.extensions[e],i=a(s.id),o=function(e,t,n){return i(e,t,(function(e,t){return n(e,t)}))},n={id:s.id,title:'<img class="jopp_logo_img" src="'+(s.icon||"./img/jopp.svg")+'"/>'+s.name+"("+s.id+")",shortTitle:'<img class="jopp_logo_img" src="'+(s.icon||"./img/jopp.svg")+'" style="width: 1em;"/>Just One Page PDF',description:"version: "+s.version,webOnly:!0,fn:o,exportFn:i,config:f.config,getConfig:f.getConfig,generateConfigHtml:f.generateConfigHtml},l=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return w(i,t),i.prototype.name="jopp-"+e,i.prototype.preference=n,i.prototype.render=function(){var e,t;return i.__super__.render.call(this),e=this.$el.find("select[name=paperSizeSelector]"),t=e.val(),h(s.id,(function(n){var i;if(n&&0!==n.length)return g=Array.from(n),console.log("sizeItems::::",n),n=Object.values(d).concat(n),i=[],n.forEach((function(e){return e.id,i.push('<option value="'+e.id+'">'+e.name+"</option>")})),e.html(i.join("")),e.val(t)}))},i}(r),t.push(l)})),t):t},(l=function(){var e;return 0===(e=s()||[]).length?[o]:e}).isFactory=!0,n.exports=l}}),window.requirejs.define({"views/exports/markdown":function(e,t,n){var i,r,o,a,s={}.hasOwnProperty;t("../view"),t("../../lib/notifier"),i=t("./base"),a={title:"Markdown",icon:"fas fa-file-invoice fa-fw",description:"\u5c06\u5f53\u524d\u6587\u7ae0\u5bfc\u51fa\u4e3amarkdown\u683c\u5f0f",fn:function(e,t,n){return o(e,0,(function(e,t){return n(e,t)}))},exportFn:o=function(e,t,n){var i,r;return i=e.get("content"),r=e.get("title")+".md",n(null,{blob:new Blob([i],{type:"text/plain;charset=utf-8"}),filename:r})}},r=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)s.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.name="markdown",t.prototype.preference=a,t}(i),n.exports=r}}),window.requirejs.define({"views/exports/mobi":function(e,t,n){var i,r,o,a,s,l,c,u,d={}.hasOwnProperty;t("../../lib/utils"),o=t("../../constant"),i=t("../../application"),r=t("./base"),s=t("../../lib/utils_size"),u=s.pageSizeMap,l=function(e,t,n,i,r,a){return $.get(o.exportHtmlTemplateFile,(function(s,l,c){var u,d;return u=_.template(s),t.find(".attachment").remove(),s={html:u({welcome:o.welcome,title:n,style:i,content:t.html()}),access_token:e,title:n,config:JSON.stringify(r)},t=null,d=o.exportHost+"/vipexportmobifile",$.ajax({url:d,type:"POST",data:s,success:function(e,t,n){var i;return e&&e.uuid?(i=o.exportHost+"/getfile?uuid="+e.uuid,a(null,{url:i,filename:e.filename,password:obj.password})):a(JSON.stringify(e))},error:function(e,t){return a(t)}})}))},c={title:"Mobi",icon:"fas fa-file-alt fa-fw",defaultClass:"vip",config:{baseFontSize:0},getConfig:function(e){var t;return t=e.find("input[name=baseFontSize]"),{baseFontSize:parseInt(t.val())||0}},generateConfigHtml:function(e,t){var n;return null==e&&(e={}),null==t&&(t=null),n={},$.extend(n,{baseFontSize:0},e),'<div>\n\u5b57\u4f53\u5927\u5c0f\u57fa\u51c6: <input type="text" name="baseFontSize" value="'+n.baseFontSize+'"/><br>\n</div>'},description:"\u5bfc\u51fa\u4e3amobi\u6587\u6863, \u9700\u8981\u8054\u7f51\u72b6\u6001\u4e0b\u624d\u80fd\u5bfc\u51fa(\u4f1a\u5458), \u6700\u5927\u652f\u6301 32M \u6587\u4ef6\u4e0a\u4f20",fn:function(e,t,n){var r,o,a;return r={changeOpenTarget:!0,parseClientLocalMedias:!0},$.extend(r,t),a=e,o=function(e){var t,o;return navigator.onLine?(r.title||(r.title=a.get("title")),(o=i.getUserModel()).get("user"),t=o.get("token"),i.getStyleText(a,r.globalSetting,(function(i,o){return l(t,e,a.get("title"),o,r,(function(e,t){if(n(e,t),null!=t?t.password:void 0)return Notifier.showMessage({html:"\u5bfc\u51fa\u6210\u529f<br/> docx \u52a0\u5bc6\u5bc6\u7801\u4e3a:<br/>"+t.password},1e4,"info")}))}))):n("\u5bfc\u51fa\u5931\u8d25\uff0c\u8be5\u5bfc\u51fa\u529f\u80fd\u9700\u8981\u8054\u7f51\u72b6\u6001\u4e0b\u624d\u80fd\u4f7f\u7528")},setTimeout((function(){var t,n,i;return i="100%",n="100%",t=function(e){var t,r,o,a,s;return(s=u[e.pageSize])||(s=[21,29.7]),a=e.marginTop||0,t=e.marginBottom||0,r=e.marginLeft||0,o=e.marginRight||0,i=s[0],n=s[1],e.pageWidth>0&&(i=e.pageWidth),e.pageHeight>0&&(n=e.pageHeight),i-=(r+o)/10,n-=(a+t)/10,"Landscape"===e.orientation&&(i=s[1],n=s[0],e.pageHeight>0&&(i=e.pageHeight),e.pageWidth>0&&(n=e.pageWidth),i-=(a+t)/10,n-=(r+o)/10),.393700787,72,[.393700787*i*72+"pt",.393700787*n*72+"pt"]}(r),i=t[0],n="100%",$(window).trigger("convertPreviewFormatForExport",[e,{mindmap_fixForLink:!1,width:i,height:n,changeOpenTarget:!0,renderMetaTitle:r.renderMetaTitle,renderMetaTag:r.renderMetaTag,parseClientLocalMedias:!0,type:"dataURL",netImage:!0,convertSvg:!0,convertFontIcon:!0,brand:"xsj_export_docx"},function(e,t){return t.find(".blank_anchor_name").remove(),t.find("#MathJax_SVG_glyphs path").attr("stroke","none"),t.find(".li_linenum_before_span").remove(),t.find(".li_linenum").addClass("li_list_style"),o(t)}])}),1e3)}},a=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)d.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.name="mobi",t.prototype.preference=c,t}(r),n.exports=a}}),window.requirejs.define({"views/exports/pdf":function(e,t,n){var i,r,o,a,s,l,c,u,d,p,f,h,m,v,g,w,y={}.hasOwnProperty;s=t("../../lib/utils"),t("../../constant"),r=t("../../application"),i=t("../../lib/app_resource_core"),l=t("../../lib/utils_size"),o=t("./base"),w=l.pageSizeMap,c="",d="",u="",p="",f="",g=function(e,t){var n,r,o;return n=e.find(".pdf_content"),r=(o=exportMap.pdf).getConfig(n),r=o.cleanConfig(r),s.getPdfCoverTemplate(r,(function(e,r){var o;return e?"function"==typeof t?t(e):void 0:(n.find("input[name=coverTitleFontColor]").val(r.titleColor),n.find("input[name=coverSubTitleFontColor]").val(r.subTitleColor),n.find("input[name=coverAuthorFontColor]").val(r.authorColor),n.find(".cover_image_container").css("background-image","url('"+r.imageDataUri+"')"),c=r.imageDataUri,o=s.dataURL2Blob(r.imageDataUri),s.blobToMd5(o,(function(e,t){var n;if(t)return n="md5files/"+t,i.createResourceIf(n,"generatedCover.png",o.type,o,(function(e,i){return d=n,u=t}))})),"function"==typeof t?t():void 0)}))},m=function(e,t,n){var i,o,a,l;if(l=e.get("_id")+"_"+e.get("_rev")+"_"+JSON.stringify(t),m.cache||(m.cache={}),!(a=m.cache[l]))return i=Object.assign({changeOpenTarget:!0,parseClientLocalMedias:!0},t),$.extend(i,t),o=function(t){var o,a;return navigator.onLine?(i.title||(i.title=e.get("title")),i.toc&&i.deleteContentToc&&t.find(".normal_toc").remove(),t.find("h1,h2,h3,h4,h5,h6").length<2&&(i.toc=!1),(a=r.getUserModel()).get("user"),o=a.get("token"),r.getStyleText(e,i.globalSetting,(function(r,a){return s.exportPdfFile(o,t,e.get("title"),a,i,(function(e,t,i){return e?n(e):i?fetch(i).then((function(e){return e.blob()})).then((function(e){return m.cache[l]=Object.assign({},t,{blob:e,filename:t.filename}),n(null,m.cache[l])})).catch((function(e){return n(e)})):n(t)}))}))):n("\u5bfc\u51fa\u5931\u8d25\uff0c\u8be5\u5bfc\u51fa\u529f\u80fd\u9700\u8981\u8054\u7f51\u72b6\u6001\u4e0b\u624d\u80fd\u4f7f\u7528")},setTimeout((function(){var t,n,r,a,l,c;return c="100%",l="100%",a=function(e){var t,n,i,r,o;return(o=w[e.pageSize])||(o=[21,29.7]),r=e.marginTop||0,t=e.marginBottom||0,n=e.marginLeft||0,i=e.marginRight||0,c=o[0],l=o[1],e.pageWidth>0&&(c=e.pageWidth),e.pageHeight>0&&(l=e.pageHeight),c-=(n+i)/10,l-=(r+t)/10,"Landscape"===e.orientation&&(c=o[1],l=o[0],e.pageHeight>0&&(c=e.pageHeight),e.pageWidth>0&&(l=e.pageWidth),c-=(r+t)/10,l-=(n+i)/10),.393700787,72,[.393700787*c*72+"pt",.393700787*l*72+"pt"]}(i),(t=$("<div></div>")).css({width:a[0],height:a[1]}),$("body").append(t),r=t.width(),n=t.height(),a.push(r),a.push(n),t.remove(),i.actualWidthHeight=a,c=parseFloat(a[0].replace("pt",""))/.77125-5,l="100%",$(window).trigger("convertPreviewFormatForExport",[e,{mindmap_fixForLink:!0,width:c+"pt",height:l,changeOpenTarget:!0,renderMetaTitle:i.renderMetaTitle,renderMetaTag:i.renderMetaTag,parseClientLocalMedias:!0,type:"dataURL",netImage:!0,convertSvg:i.convertSvg,convertFontIcon:!0,brand:"xsj_export_pdf",disableLazyLoading:!0,convertWebp:!0,convertGif:!0},function(e,t){var n;return t.find(".blank_anchor_name").remove(),t.find("a.attachment").remove(),t.find("h1, h2, h3, h4, h5, h6, h7, h8, h9").filter((function(){return!$(this).parent().hasClass("html_preview")})).addClass("wkhtmltopdf_skip_heading"),t.find("#MathJax_SVG_glyphs path").attr("stroke","none"),n=t.width(),t.find(".mermaid_svg.mermaid_type_classDiagram foreignObject").wrap('<g transform="translate(0,0)"></g>'),t.find("svg").map((function(e,t){var i,r,o,a,l,c,u,d,p;if((i=$(t))[0].classList.contains("xsj_svg_viewbox")&&1===(r=i.find(">g")).length&&(p=i[0].getAttribute("viewBox").split(" "),1/.77125,i.attr("width",p[2]*(1/.77125)),i.attr("height",p[3]*(1/.77125)+2),i.css({maxWidth:p[2]*(1/.77125)+"px",maxHeight:p[3]*(1/.77125)+2+"px"}),(d=r.attr("transform"))&&(i[0].removeAttribute("viewBox"),u=s.getTransformation(d),l=$.extend({},u,{translateX:u.translateX*(1/.77125),translateY:u.translateY*(1/.77125),scaleX:u.scaleX*(1/.77125),scaleY:u.scaleY*(1/.77125)}),r.attr("transform","translate("+l.translateX+","+l.translateY+") scale("+l.scaleX+","+l.scaleY+")"))),(!(a=i.attr("width"))||a.indexOf("%")>0)&&(a=i.width()/.77125,i.attr("width",a)),(!(o=i.attr("height"))||o.indexOf("%")>0)&&(o=i.height()/.77125,i.attr("height",o)),a=i.width(),o=i.height(),c=1,a>n&&(c=n/a,a=n,o=o*c+2,i.width(a),i.height(o),i[0].classList.contains("xsj_svg_viewbox")&&1===(r=i.find(">g")).length&&(d=r.attr("transform"))))return u=s.getTransformation(d),l=$.extend({},u,{translateX:u.translateX*c,translateY:u.translateY*c,scaleX:u.scaleX*c,scaleY:u.scaleY*c}),r.attr("transform","translate("+l.translateX+","+l.translateY+") scale("+l.scaleX+","+l.scaleY+")")})),o(t)}])}),1e3);setTimeout((function(){return n(null,a)}),10)},v={title:"PDF",icon:"far fa-file-pdf fa-fw",description:"\u5bfc\u51fa\u5f53\u524d\u6587\u7ae0\u4e3apdf\u683c\u5f0f, \u9700\u8981\u8054\u7f51\u72b6\u6001\u4e0b\u624d\u80fd\u5bfc\u51fa, \u6700\u5927\u652f\u6301 32M \u6587\u4ef6\u4e0a\u4f20",defaultClass:"vip",exportFn:function(e,t,n){return m(e,Object.assign({},t,{title:e.get("title")||"",coverTitle:e.get("title")||"",password:""}),n)},fn:function(e,t,n){var i;return i=Object.assign({changeOpenTarget:!0,parseClientLocalMedias:!0},t),m(e,i,(function(e,t){if(n(e,t),null!=t?t.password:void 0)return Notifier.showMessage({html:"\u5bfc\u51fa\u6210\u529f<br/> pdf \u52a0\u5bc6\u5bc6\u7801\u4e3a:<br/>"+t.password},1e4,"info")}))},cleanConfig:function(e){var t;return delete(t=_.clone(e)).coverImage,delete t.watermarkerImage,t},getConfig:function(e){var t,n,i,r,o,a,s,l,h,m,v,g,_,w,y,b,x,k,D,C,F,M,T,S,P,j,E,I,O,V,L,A,B,N,R,H,z,q,W,U,Y,J,G,K,X,Q,Z,ee,te,ne,ie,re,oe,ae,se,le,ce;return t=e.find("input[name=convertSvg]"),L=Number(e.find("input[name=marginTop]").val()),isNaN(L)&&(L=10),V=Number(e.find("input[name=marginRight]").val()),isNaN(V)&&(V=10),I=Number(e.find("input[name=marginBottom]").val()),isNaN(I)&&(I=10),O=Number(e.find("input[name=marginLeft]").val()),isNaN(O)&&(O=10),ce=Number(e.find("input[name=zoom]").val()),isNaN(ce)&&(ce=1),A=e.find("input[name=orientation]").val(),z=e.find("input[name=pageSize]").val(),q=Number(e.find("input[name=pageWidth]").val()),isNaN(q)&&(q=-1),R=Number(e.find("input[name=pageHeight]").val()),isNaN(R)&&(R=-1),J=e.find("input[name=title]").val(),n=e.find("input[name=background]").is(":checked"),Y=!e.find("input[name=renderMetaTitle]").is(":checked"),U=!e.find("input[name=renderMetaTag]").is(":checked"),H=parseInt(e.find("input[name=pageOffset]").val()),G=e.find("input[name=toc]").is(":checked"),Q=e.find("input[name=tocHeaderText]").val(),X=e.find("input[name=tocDisableDottedLine]").is(":checked"),_=e.find("input[name=deleteContentToc]").is(":checked"),Z=Number(e.find("input[name=tocLevelIndentation]").val()),isNaN(Z)&&(Z=-1),K=$.trim(e.find("textarea[name=tocCustomStyle]").val()),B=e.find("input[name=outline]").is(":checked"),N=Number(parseInt(e.find("input[name=outlineDepth]").val())),isNaN(N)&&(N=4),w=e.find("input[name=footerCenter]").val(),D=e.find("input[name=footerRight]").val(),x=e.find("input[name=footerLeft]").val(),y=e.find("input[name=footerFontName]").val(),b=Number(parseInt(e.find("input[name=footerFontSize]").val())),isNaN(b)&&(b=10),k=e.find("input[name=footerLine]").is(":checked"),C=Number(e.find("input[name=footerSpacing]").val()),isNaN(C)&&(C=-1),F=e.find("input[name=headerCenter]").val(),j=e.find("input[name=headerRight]").val(),S=e.find("input[name=headerLeft]").val(),M=e.find("input[name=headerFontName]").val(),T=Number(parseInt(e.find("input[name=headerFontSize]").val())),isNaN(T)&&(T=10),P=e.find("input[name=headerLine]").is(":checked"),E=Number(e.find("input[name=headerSpacing]").val()),isNaN(E)&&(E=-1),W=e.find("input[name=password]").val(),i=e.find("input[name=cover]").is(":checked"),m=e.find("input[name=coverTitle]").val(),v=e.find("input[name=coverTitleFont]").val(),g=e.find("input[name=coverTitleFontColor]").val(),s=e.find("input[name=coverSubTitle]").val(),l=e.find("input[name=coverSubTitleFont]").val(),h=e.find("input[name=coverSubTitleFontColor]").val(),r=e.find("input[name=coverAuthor]").val(),o=e.find("input[name=coverAuthorFont]").val(),a=e.find("input[name=coverAuthorFontColor]").val(),ee=e.find("input[name=watermarker]").is(":checked"),ne=e.find("input[name=watermarkerLetters]").val(),ie=e.find("input[name=watermarkerLettersFont]").val(),re=e.find("input[name=watermarkerLettersFontColor]").val(),ae=e.find("select[name=watermarkerPosition]").val(),se=Number(e.find("input[name=watermarkerPositionXOffset]").val()),le=Number(e.find("input[name=watermarkerPositionYOffset]").val()),te=Number(e.find("input[name=watermarkerAngle]").val()),oe=Number(e.find("input[name=watermarkerOpacity]").val()),isNaN(te)&&(te=45),isNaN(oe)&&(oe=1),(oe<0||oe>1)&&(oe=1),isNaN(se)&&(se=0),isNaN(le)&&(le=0),{netImage:!0,convertSvg:t.is(":checked"),changeOpenTarget:!1,marginTop:L,marginRight:V,marginBottom:I,marginLeft:O,zoom:ce,orientation:A||"Portrait",pageSize:z||"A4",pageWidth:q,pageHeight:R,title:J,background:n,renderMetaTitle:Y,renderMetaTag:U,pageOffset:H,toc:G,tocHeaderText:Q||"",tocDisableDottedLine:X||!1,deleteContentToc:_,tocLevelIndentation:Z,tocCustomStyle:K,outline:B,outlineDepth:N,footerCenter:w,footerLeft:x,footerRight:D,footerFontName:y||"Arial",footerFontSize:b,footerLine:k||!1,footerSpacing:C,headerCenter:F,headerLeft:S,headerRight:j,headerFontName:M||"Arial",headerFontSize:T,headerLine:P||!1,headerSpacing:E,password:W,cover:i,coverTitle:m,coverTitleFont:v,coverTitleFontColor:g,coverSubTitle:s,coverSubTitleFont:l,coverSubTitleFontColor:h,coverAuthor:r,coverAuthorFont:o,coverAuthorFontColor:a,coverImage:c,coverImagePath:d,coverImageMD5:u,watermarker:ee,watermarkerLetters:ne,watermarkerLettersFont:ie,watermarkerLettersFontColor:re,watermarkerPosition:ae,watermarkerPositionXOffset:se,watermarkerPositionYOffset:le,watermarkerAngle:te,watermarkerOpacity:oe,watermarkerImage:p,watermarkerImagePath:f}},generateConfigHtml:function(e,t){var n,r,o,a,l,h,m,v,g,w;return null==e&&(e={}),null==t&&(t=null),h={},$.extend(h,{netImage:!0,convertSvg:!1,changeOpenTarget:!1,marginTop:10,marginRight:10,marginBottom:10,marginLeft:10,zoom:1,orientation:"Portrait",pageSize:"A4",pageWidth:-1,pageHeiht:-1,title:"",background:!0,renderMetaTitle:!1,renderMetaTag:!1,pageOffset:0,toc:!0,tocHeaderText:"\u76ee\u5f55",tocDisableDottedLine:!1,deleteContentToc:!0,tocLevelIndentation:-1,tocCustomStyle:"",outline:!0,outlineDepth:4,footerCenter:"[page]/[toPage]",footerLeft:"",footerRight:"",footerFontName:"Arial",footerFontSize:10,footerLine:!1,footerSpacing:0,headerCenter:"[section]",headerLeft:"",headerRight:"",headerFontName:"Arial",headerFontSize:10,headerLine:!0,headerSpacing:3,password:"",cover:!0,coverTitle:"",coverTitleFont:"bold 2em/1.2 serif",coverTitleFontColor:"#000000",coverSubTitle:"",coverSubTitleFont:"1.5em/1.1 sans-serif",coverSubTitleFontColor:"#000000",coverAuthor:"\u5c0f\u4e66\u5320",coverAuthorFont:"0.8em/1 serif",coverAuthorFontColor:"#bbbbbb",coverImagePath:"",coverImageMD5:"",watermarker:!0,watermarkerLetters:"\u5c0f\u4e66\u5320",watermarkerLettersFont:"bold 2em/1 serif",watermarkerLettersFontColor:"#000",watermarkerPosition:"mc",watermarkerPositionXOffset:0,watermarkerPositionYOffset:0,watermarkerAngle:315,watermarkerOpacity:1,waterImagePath:""},e),t&&(h.title=t.get("title"),h.coverTitle=h.title),m=h.convertSvg?"checked":"",w=["<select name='watermarkerPosition'>"],[["mc","\u4e2d\u4e2d"],["mr","\u4e2d\u53f3"],["ml","\u4e2d\u5de6"],["tc","\u4e0a\u4e2d"],["tr","\u4e0a\u53f3"],["tl","\u4e0a\u5de6"],["bc","\u4e0b\u4e2d"],["br","\u4e0b\u53f3"],["bl","\u4e0b\u5de6"]].forEach((function(t,n){return e.watermarkerPosition===t[0]?w.push('<option value="'+t[0]+'" selected>'+t[1]+"</option>"):w.push('<option value="'+t[0]+'" >'+t[1]+"</option>")})),w.push("</select>"),g=w.join(),v='<div>\n  <div>\n    \u5c06svg\u8f6c\u6362\u6210\u56fe\u7247: <input type="checkbox" name="convertSvg" '+m+'><br>\n  </div>\n  <div>\n    <form class="ui form">\n    <div class="ui blue segment">\n      <a class="ui ribbon label yellow">\u52a0\u5bc6</a>\n      <div class="field">\n      \u52a0\u5bc6\u5bc6\u7801\uff1a<input type="text" class="pdf_password_input" name="password" value="'+h.password+'">\n      <div class="ui error message pdf_password_message">\n        <div class="header">\u975e\u6cd5\u5bc6\u7801</div>\n        <p>\u5bc6\u7801\u53ea\u80fd\u5305\u542b\u5b57\u6bcd\uff0c\u6570\u5b57\u6216\u70b9\u7b26\u53f7\uff0c\u6700\u5927\u957f\u5ea620\u4e2a\u5b57\u7b26</p>\n      </div>\n      <div class="ui success message pdf_return_password_message">\n        <div class="header">pdf\u5bc6\u7801</div>\n        <p></p>\n      </div>\n      <div class="ui pointing label yellow">\u975e\u4ed8\u8d39\u7528\u6237\u8be5\u57df\u65e0\u6548\uff0c\u6bcf\u6b21\u5bfc\u51fapdf\u65f6\u4f1a\u751f\u6210\u4e00\u4e2a\u968f\u673a\u5bc6\u7801</div>\n      </div>\n    </div>\n    <div class="ui blue segment">\n      <a class="ui ribbon label">\u57fa\u672c</a>\n      <div class="field">\n      pdf\u6807\u9898\uff1a<input type="text" name="title" value="'+h.title+'">\n      <div class="ui pointing label">\u6807\u9898\u4e3a\u7a7a\u65f6\uff0c\u81ea\u52a8\u4f7f\u7528\u6587\u7ae0\u6807\u9898</div>\n      </div>\n      <div class="inline fields">\n        <div class="field">\n        \u8d77\u59cb\u9875\u9875\u7801: <input type="text" name="pageOffset" value="'+h.pageOffset+'">\n        </div>\n        <div class="field">\n        \u4f7f\u7528\u80cc\u666f\u56fe\u7247: <input type="checkbox" name="background" '+(h.background?"checked":"")+'>\n        </div>\n      </div>\n      <div class="inline fields">\n        <div class="field">\n          \u7981\u6b62\u5728\u6b63\u6587\u6e32\u67d3\u5143\u6570\u636e\u6807\u9898: <input type="checkbox" name="renderMetaTitle" '+(h.renderMetaTitle?"":"checked")+'>\n        </div>\n        <div class="field">\n          \u7981\u6b62\u5728\u6b63\u6587\u6e32\u67d3\u5143\u6570\u636e\u6807\u7b7e: <input type="checkbox" name="renderMetaTag" '+(h.renderMetaTag?"":"checked")+'>\n        </div>\n      </div>\n    </div>\n    <div class="ui blue segment">\n      <a class="ui ribbon label yellow">\u5c01\u9762</a>\n      <div class="inline fields">\n      <div class="field">\n      \u751f\u6210\u5c01\u9762: <input type="checkbox" name="cover" '+(h.cover?"checked":"")+'>\n      <a class="ui button mini regenerate_pdf_cover_template_button">\u751f\u6210\u968f\u673a\u4e3b\u9898\u5c01\u9762</a>\n      </div>\n      </div>\n      <div class="three fields">\n      <div class="field">\n      \u5c01\u9762\u4e3b\u6807\u9898: <input type="text" name="coverTitle" value="'+h.coverTitle+'">\n      </div>\n      <div class="field">\n      \u5c01\u9762\u4e3b\u6807\u9898CSS\u5b57\u4f53: <input type="text" name="coverTitleFont" value="'+h.coverTitleFont+'">\n      </div>\n      <div class="field">\n      \u5c01\u9762\u4e3b\u6807\u9898\u5b57\u4f53\u989c\u8272: <input type="text" name="coverTitleFontColor" value="'+h.coverTitleFontColor+'">\n      </div>\n      </div>\n      <div class="three fields">\n      <div class="field">\n      \u5c01\u9762\u6b21\u6807\u9898: <input type="text" name="coverSubTitle" value="'+h.coverSubTitle+'">\n      </div>\n      <div class="field">\n      \u5c01\u9762\u6b21\u6807\u9898CSS\u5b57\u4f53: <input type="text" name="coverSubTitleFont" value="'+h.coverSubTitleFont+'">\n      </div>\n      <div class="field">\n      \u5c01\u9762\u6b21\u6807\u9898\u5b57\u4f53\u989c\u8272: <input type="text" name="coverSubTitleFontColor" value="'+h.coverSubTitleFontColor+'">\n      </div>\n      </div>\n      <div class="three fields">\n      <div class="field">\n      \u5c01\u9762\u4f5c\u8005: <input type="text" name="coverAuthor" value="'+h.coverAuthor+'">\n      </div>\n      <div class="field">\n      \u5c01\u9762\u4f5c\u8005CSS\u5b57\u4f53: <input type="text" name="coverAuthorFont" value="'+h.coverAuthorFont+'">\n      </div>\n      <div class="field">\n      \u5c01\u9762\u4f5c\u8005\u5b57\u4f53\u989c\u8272: <input type="text" name="coverAuthorFontColor" value="'+h.coverAuthorFontColor+'">\n      </div>\n      </div>\n      <div class="ui  segment cover_image_container">\n          <div class="cover_image_button" style="display:none;position:absolute;right:-1rem;"><i class="icon close link delete_pdf_cover_image_button"></i></div>\n          <div style="display: none;"><input type="file" multiple="" name="coverImageData" class="form-control"></div>\n          <p class="drop-zone" >\u6dfb\u52a0\u5c01\u9762\u56fe\u7247</p>\n      </div>\n    </div>\n    <div class="ui blue segment">\n      <a class="ui ribbon label yellow">\u6c34\u5370</a>\n      <div class="inline fields">\n        <div class="field">\n        \u6dfb\u52a0\u6c34\u5370: <input type="checkbox" name="watermarker" '+(h.watermarker?"checked":"")+'>\n        </div>\n        <div class="field">\n        \u4f4d\u7f6e: \n          '+g+'\n        </div>\n        <div class="field">\n        \u504f\u79bbX\u5750\u6807:<input type="text" name="watermarkerPositionXOffset" value="'+h.watermarkerPositionXOffset+'" class="story_mini">mm\n        \u504f\u79bbY\u5750\u6807:<input type="text" name="watermarkerPositionYOffset" value="'+h.watermarkerPositionYOffset+'" class="story_mini">mm\n        </div>\n        <div class="field">\n        \u900f\u660e\u5ea6(0~1,\u652f\u6301\u5c0f\u6570): <input type="text" name="watermarkerOpacity" value="'+h.watermarkerOpacity+'">\n        </div>\n      </div>\n      <div class="ui segment">\n        <div class="four fields">\n          <div class="field">\n          \u6c34\u5370\u6587\u5b57: <input type="text" name="watermarkerLetters" value="'+h.watermarkerLetters+'">\n          </div>\n          <div class="field">\n          \u6c34\u5370\u6587\u5b57CSS\u5b57\u4f53: <input type="text" name="watermarkerLettersFont" value="'+h.watermarkerLettersFont+'">\n          </div>\n          <div class="field">\n          \u6c34\u5370\u6587\u5b57\u989c\u8272: <input type="text" name="watermarkerLettersFontColor" value="'+h.watermarkerLettersFontColor+'">\n          </div>\n          <div class="field">\n          \u6c34\u5370\u503e\u659c\u89d2\u5ea6: <input type="text" name="watermarkerAngle" value="'+h.watermarkerAngle+'">\n          </div>\n        </div>\n        <div class="ui horizontal divider">\n          \u6216\u8005\n        </div>\n        <div class="ui  segment watermarker_image_container">\n            <div class="watermarker_image_button" style="display:none;position:absolute;right:-1rem;"><i class="icon close link delete_pdf_watermarker_image_button"></i></div>\n            <div style="display: none;"><input type="file" multiple="" name="watermarkerImageData" class="form-control"></div>\n            <p class="drop-zone" >\u6dfb\u52a0\u6c34\u5370\u56fe\u7247</p>\n        </div>\n      </div>\n    </div>\n    <div class="ui blue segment">\n      <a class="ui ribbon label">layout</a>\n      <div class="inline fields">\n      <div class="field">\n      \u9875\u8fb9\u8ddd\uff1a\u4e0a<input type="text" name="marginTop" value="'+h.marginTop+'" class="story_mini">mm\n      </div>\n      <div class="field">\n          \u53f3<input type="text" name="marginRight" value="'+h.marginRight+'" class="story_mini">mm\n      </div>\n      <div class="field">\n          \u4e0b<input type="text" name="marginBottom" value="'+h.marginBottom+'" class="story_mini">mm\n      </div>\n      <div class="field">\n          \u5de6<input type="text" name="marginLeft" value="'+h.marginLeft+'" class="story_mini">mm\n      </div>\n      </div>\n      <div class="two fields">\n        <div class="field">\n          \u5c3a\u5bf8\u7c7b\u578b\uff1a <input type="text" name="pageSize" value="'+h.pageSize+'">\n          <div class="ui pointing label">\n          \u652f\u6301\u7684\u7c7b\u578b\u6709: A0,A1,A2,A3,A4,A5,A6,A7,A8,A9 <br/>B0,B1,B2,B3,B4,B5,B6,B7,B8,B9,B10<br/>C5E,Comm10E,DLE, Executive,Folio,Ledger,Legal, Letter,Tabloid\n          </div>\n        </div>\n        <div class="field">\n          \u65b9\u5411:  <input type="text" name="orientation" value="'+h.orientation+'">\n          <div class="ui pointing label">\n          \u652f\u6301\u7684\u7c7b\u578b\u6709:Portrait,Landscape \n          </div>\n        </div>\n      </div>\n    </div>\n    <div class="ui blue segment">\n      <a class="ui ribbon label">\u5927\u7eb2</a>\n      <div class="inline fields">\n      <div class="field">\n      \u751f\u6210\u5927\u7eb2: <input type="checkbox" name="outline" '+(h.outline?"checked":"")+'>\n      </div>\n      <div class="field">\n      \u5927\u7eb2\u5c42\u6b21: <input type="text" name="outlineDepth" value="'+h.outlineDepth+'">\n      </div>\n      </div>\n    </div>\n    <div class="ui blue segment">\n      <a class="ui ribbon label">\u76ee\u5f55</a>\n      <div class="inline fields">\n      <div class="field">\n      \u751f\u6210\u76ee\u5f55: <input type="checkbox" name="toc" '+(h.toc?"checked":"")+'>\n      </div>\n      <div class="field">\n      \u76ee\u5f55\u62ac\u5934: <input type="text" name="tocHeaderText" value="'+h.tocHeaderText+'">\n      </div>\n      <div class="field">\n      \u7981\u7528\u76ee\u5f55\u70b9\u7ebf: <input type="checkbox" name="tocDisableDottedLine" '+(h.tocDisableDottedLine?"checked":"")+'>\n      </div>\n      <div class="field">\n      \u76ee\u5f55\u5c42\u7ea7\u7f29\u8fdb: <input type="text" name="tocLevelIndentation" value="'+h.tocLevelIndentation+'" class="story_mini">mm\n      </div>\n      </div>\n      <div class="field">\n      \u7981\u7528\u6b63\u6587 toc \u8bed\u6cd5: <input type="checkbox" name="deleteContentToc" '+(h.deleteContentToc?"checked":"")+'>\n      </div>\n      <div class="field">\n      \u76ee\u5f55\u81ea\u5b9a\u4e49 css \u6837\u5f0f <a href="https://github.com/suziwen/blogxiaoshujiang/blob/master/2017-9-24%20%E5%B0%8F%E4%B9%A6%E5%8C%A0%20pdf%20%E5%AF%BC%E5%87%BA%E8%87%AA%E5%AE%9A%E4%B9%89%20css%20%E6%95%99%E7%A8%8B.md" target="_blank">\u67e5\u770b\u6559\u7a0b</a>\n      <textarea width="100%" name="tocCustomStyle">'+_.escape(h.tocCustomStyle)+'</textarea>\n      <div class="ui pointing label yellow">\u975e\u4ed8\u8d39\u7528\u6237\u8be5\u57df\u65e0\u6548</div>\n      </div>\n    </div>\n    <div class="ui blue segment">\n      <a class="ui ribbon label">\u9875\u7709\u9875\u811a</a>\n      <div class="ui message">\n      <ul class="list">\n        <li>\u9875\u7709\uff0c\u9875\u811a\u652f\u6301\u7684\u53d8\u91cf\u6709:[page],[frompage],[topage],[webpage],[section],[subsection],[date],[isodate],[time],[title],[doctitle],[sitepage],[sitepages]</li>\n        <li>\u76ee\u524d\u670d\u52a1\u5668\u63d0\u4f9b\u7684\u4e2d\u6587\u5b57\u4f53\u6709\uff1a"\u534e\u6587\u7ec6\u9ed1", "Microsoft YaHei", "\u9ed1\u4f53", "SimSun", "AR PL UKai CN", "NSimSun", "Songti SC"\u7b49\u5b57\u4f53\uff0c\u9875\u7709\u9875\u811a\u5b57\u4f53\u8bbe\u7f6e\u4e0d\u652f\u6301\u5b57\u4f53\u5217\u8868\u591a\u9009\uff0c\u586b\u5199\u65f6\u8bf7\u53bb\u6389\u5f15\u53f7,\u53ea\u9700\u8981\u8f93\u5165\u5b8c\u6574\u7684\u5b57\u4f53\u540d\u79f0</li>\n      </ul>\n      </div>\n      <div class="three fields">\n        <div class="field">\n        \u5de6\u9875\u7709\u6587\u5b57: <input type="text" name="headerLeft" value="'+h.headerLeft+'">\n        </div>\n        <div class="field">\n        \u4e2d\u9875\u7709\u6587\u5b57: <input type="text" name="headerCenter" value="'+h.headerCenter+'">\n        </div>\n        <div class="field">\n        \u53f3\u9875\u7709\u6587\u5b57: <input type="text" name="headerRight" value="'+h.headerRight+'">\n        </div>\n      </div>\n      <div class="inline fields">\n        <div class="field">\n        \u9875\u7709\u5b57\u4f53: <input type="text" name="headerFontName" value="'+h.headerFontName+'">\n        </div>\n        <div class="field">\n        \u9875\u7709\u5b57\u4f53\u5927\u5c0f: <input type="text" name="headerFontSize" value="'+h.headerFontSize+'" class="story_mini">px\n        </div>\n      </div>\n      <div class="inline fields">\n        <div class="field">\n        \u9875\u7709\u4e0e\u6b63\u6587\u95f4\u9694: <input type="text" name="headerSpacing" value="'+h.headerSpacing+'" class="story_mini">mm\n        </div>\n        <div class="field">\n        \u662f\u5426\u663e\u793a\u9875\u7709\u4e0e\u6b63\u6587\u7684\u5206\u9694\u7ebf: <input type="checkbox" name="headerLine" '+(h.headerLine?"checked":"")+'>\n        </div>\n      </div>\n      <div class="three fields">\n        <div class="field">\n        \u5de6\u9875\u811a\u6587\u5b57: <input type="text" name="footerLeft" value="'+h.footerLeft+'">\n        </div>\n        <div class="field">\n        \u4e2d\u9875\u811a\u6587\u5b57: <input type="text" name="footerCenter" value="'+h.footerCenter+'">\n        </div>\n        <div class="field">\n        \u53f3\u9875\u811a\u6587\u5b57: <input type="text" name="footerRight" value="'+h.footerRight+'">\n        </div>\n      </div>\n      <div class="inline fields">\n        <div class="field">\n        \u9875\u811a\u5b57\u4f53: <input type="text" name="footerFontName" value="'+h.footerFontName+'">\n        </div>\n        <div class="field">\n        \u9875\u811a\u5b57\u4f53\u5927\u5c0f: <input type="text" name="footerFontSize" value="'+h.footerFontSize+'" class="story_mini">px\n        </div>\n      </div>\n      <div class="inline fields">\n        <div class="field">\n        \u9875\u811a\u4e0e\u6b63\u6587\u95f4\u9694: <input type="text" name="footerSpacing" value="'+h.footerSpacing+'" class="story_mini">mm\n        </div>\n        <div class="field">\n        \u662f\u5426\u663e\u793a\u9875\u811a\u4e0e\u6b63\u6587\u7684\u5206\u9694\u7ebf: <input type="checkbox" name="footerLine" '+(h.footerLine?"checked":"")+">\n        </div>\n      </div>\n    </div>\n    </form>\n  </div>\n</div>",r=$(v),a=function(e){var t;if(e.length>0)return t=e[0],s.insertImageFile([t],(function(e,t,r){var o;return o=s.dataURL2Blob(e),s.blobToMd5(o,(function(e,t){var n;if(t)return n="md5files/"+t,i.createResourceIf(n,r.name,o.type,o,(function(e,i){return d=n,u=t}))})),c=e,n.css("background-image","url('"+e+"')"),n.find(".cover_image_button").show()}))},(n=r.find(".cover_image_container")).find(".drop-zone").on("click",(function(){return n.find("input[name=coverImageData]").trigger("click")})),s.initdragFilesSupport(n.find(".drop-zone"),a),s.initFileImportSupport(n.find('input[type="file"]'),a),h.coverImagePath&&i.getResource(h.coverImagePath,(function(e,t){if(t)return s.blob2DataURL(t.data,(function(e,t){return c=t,d=h.coverImagePath,u=h.coverImageMD5,n.css("background-image","url('"+t+"')"),n.find(".cover_image_button").show()}))})),l=function(e){var t;if(e.length>0)return t=e[0],s.insertImageFile([t],(function(e,t,n){var r;return r=s.dataURL2Blob(e),s.blobToMd5(r,(function(e,t){var o;if(t)return o="md5files/"+t,i.createResourceIf(o,n.name,r.type,r,(function(e,t){if(t)return f=o}))})),p=e,o.css("background-image","url('"+e+"')"),o.find(".watermarker_image_button").show()}))},(o=r.find(".watermarker_image_container")).find(".drop-zone").on("click",(function(){return o.find("input[name=watermarkerImageData]").trigger("click")})),s.initdragFilesSupport(o.find(".drop-zone"),l),s.initFileImportSupport(o.find('input[type="file"]'),l),h.watermarkerImagePath&&i.getResource(h.watermarkerImagePath,(function(e,t){if(t)return s.blob2DataURL(t.data,(function(e,t){return p=t,f=h.watermarkerImagePath,o.css("background-image","url('"+t+"')"),o.find(".watermarker_image_button").show()}))})),r}},h=function(){return c="",d="",u="",p="",f="",m.cache={}},a=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)y.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.name="pdf",t.prototype.preference=v,t.prototype.events=function(){return Object.assign({},t.__super__.events.call(this),{"click .delete_pdf_cover_image_button":"deletePdfCoverImageFn","click .delete_pdf_watermarker_image_button":"deletePdfWatermarkerImageFn","click .regenerate_pdf_cover_template_button":"regeneratePdfCoverTemplateFn","blur .pdf_password_input":"validPasswordFn"})},t.prototype.validPasswordFn=function(e){var t,n,i,r;if(e.stopPropagation(),e.preventDefault(),n=(t=(i=$(e.currentTarget)).parent()).find(".pdf_password_message"),r=$.trim(i.val())){if(!/^[a-z0-9.]+$/i.test(r))return n.show(),t.addClass("error");if(r.length>20)return n.show(),void t.addClass("error")}return t.removeClass("error"),n.hide()},t.prototype.regeneratePdfCoverTemplateFn=function(e){var t;if(e.stopPropagation(),e.preventDefault(),!(t=$(e.currentTarget)).hasClass("loading"))return t.addClass("loading"),g(this.$el,(function(){return t.removeClass("loading")}))},t.prototype.deletePdfCoverImageFn=function(e){var t,n;return e.stopPropagation(),e.preventDefault(),(t=$(e.currentTarget).parent()).hide(),(n=t.parent()).css("background-image",""),n.find("input[name=coverImageData]").val(""),c="",d="",u=""},t.prototype.deletePdfWatermarkerImageFn=function(e){var t,n;return e.stopPropagation(),e.preventDefault(),(t=$(e.currentTarget).parent()).hide(),(n=t.parent()).css("background-image",""),n.find("input[name=watermarkerImageData]").val(""),p="",f=""},t.prototype.render=function(){var e;if(t.__super__.render.call(this),!((e=r.getUserModel().get("user"))&&e.vip)&&"client"===STORY_PLATFORM&&"production"===window.ENV)return this.$el.find(".batch_fetch_button").remove()},t.prototype.destroy=h,t}(o),n.exports=a}}),window.requirejs.define({"views/exports/png":function(e,t,n){var i,r,o,a,s={}.hasOwnProperty;i=t("./base"),a={title:"\u56fe\u7247",icon:"far fa-file-image fa-fw",config:{width:"21cm"},getConfig:function(e){return{width:e.find("input[name=width]").val()}},generateConfigHtml:function(e,t){var n;return null==e&&(e={}),null==t&&(t=null),n={},$.extend(n,{width:"21cm"},e),'<div>\n\u56fe\u7247\u5bbd\u5ea6: <input type="text" name="width" value="'+_.escape(n.width)+'"><br>\n</div>'},description:"\u5bfc\u51fa\u4e3apng\u56fe\u7247",fn:function(e,t,n){return o(e,t,(function(e,t){return n(e,t)}))},exportFn:o=function(e,t,n){var i,r;return i={type:"dataURL",netImage:!0,changeOpenTarget:!1,parseClientLocalMedias:!0,convertSvg:!1,convertFontIcon:!1,disableLazyLoading:!0,brand:"xsj_export_png",width:"21cm"},$.extend(i,t),r=e.get("title")+".png",setTimeout((function(){return $(window).trigger("convertPreviewFormatForExport",[e,i,function(e,t){var i,o,a;return o=t[0].ownerDocument.documentElement,(i=$(o)).addClass("xiaoshujiang_camera"),(a=i.find(".xiaoshujiang_element")).addClass("xiaoshujiang_element_hide"),domtoimage.toBlob(o).then((function(e){return i.removeClass("xiaoshujiang_camera"),a.removeClass("xiaoshujiang_element_hide"),watermark([e]).blob(watermark.text.lowerRight("\u4e66","bold 48px webfontxiaoshujiang","#2f2f2f",.5))})).then((function(e){return watermark.destroy(),n(null,{blob:e,filename:r})})).catch((function(e){return i.removeClass("xiaoshujiang_camera"),a.removeClass("xiaoshujiang_element_hide"),n(e)}))}])}),1e3)}},r=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)s.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.name="png",t.prototype.preference=a,t}(i),n.exports=r}}),window.requirejs.define({"views/exports/ppt":function(e,t,n){var i,r,o,a,s,l,c={}.hasOwnProperty;a=t("../../lib/utils"),i=t("../../application"),r=t("./base"),l={title:"PPT(Reval)",icon:"far fa-file-powerpoint fa-fw",config:{netImage:!1,convertSvg:!1,convertFontIcon:!0,changeOpenTarget:!1},description:"\u5c06\u5f53\u524d\u6587\u7ae0\u6253\u5305\u6210reveal\u683c\u5f0f\u7684\u6f14\u793a\u6587\u6863(\u9700\u8981\u7b26\u5408\u4e00\u5b9a\u7684\u8bed\u6cd5\u89c4\u5219,\u53ef\u67e5\u770bppt\u5e2e\u52a9\u624b\u518c)",fn:function(e,t,n){return s(e,t,(function(e,t){return n(e,t)}))},exportFn:s=function(e,t,n){var r;return r={type:"dataURL",netImage:!0,previewType:"presetation",changeOpenTarget:!1,parseClientLocalMedias:!0,brand:"xsj_export_ppt"},$.extend(r,t),setTimeout((function(){return $(window).trigger("convertPreviewFormatForExport",[e,r,function(t,o){return i.getStyleText(e,r.globalSetting,(function(t,i){return a.exportPresetationFile(o,e.get("title"),e.get("content"),i,(function(e,t,i){return n(e,{blob:t,filename:i})}))}))}])}),1e3)}},o=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)c.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.name="ppt",t.prototype.preference=l,t}(r),n.exports=o}}),window.requirejs.define({"views/exports/print":function(e,t,n){var i,r,o,a,s={}.hasOwnProperty;r=t("./base"),i=t("../../application"),a={title:"\u6253\u5370",icon:"fas fa-print fa-fw",description:"\u76f4\u63a5\u6253\u5370\u5f53\u524d\u6587\u7ae0",fn:function(e,t,n){var r;return r=function(t,i){var r;return n(),r=$("body>.preview_export_wrapper>iframe")[0].contentWindow,"client"===STORY_PLATFORM?PopupCenter("preview.html","xsj_pdf_print",400,400,(function(n){var r;return(r=n.$)("head").append('<style type="text/css">\n  '+i+"\n  \n</style>"),n.document.title=e.get("title")||"\u5c0f\u4e66\u5320",r(".preview").replaceWith(t.html()),setTimeout((function(){return n.document.fonts.ready.then((function(){return n.nw.Window.get().print({autoprint:!1,footerString:" ",headerString:" "}),setTimeout((function(){return n.close()}),100)}))}),0)}),$.noop,{show:!0,fullscreen:!0}):r.print()},setTimeout((function(){var n;return n="client"===STORY_PLATFORM,$(window).trigger("convertPreviewFormatForExport",[e,{type:"dataURL",mindmap_fixForLink:!0,netImage:n,convertSvg:t.convertSvg,convertFontIcon:!1,parseClientLocalMedias:!0,brand:"xsj_export_print"},function(n,o){return o.find("a.attachment").remove(),o.find("#MathJax_SVG_glyphs path").attr("stroke","none"),o.find(".blank_anchor_name").remove(),i.getStyleText(e,t.globalSetting,(function(e,t){return r(o,t)}))}])}),1e3)},getConfig:function(e){return{convertSvg:e.find("input[name=convertSvg]").is(":checked")}},generateConfigHtml:function(e,t){var n;return null==e&&(e={}),null==t&&(t=null),n={},$.extend(n,{convertSvg:!1},e),'<div>\n\u5c06svg\u8f6c\u6362\u6210\u56fe\u7247: <input type="checkbox" name="convertSvg" '+(n.convertSvg?"checked":"")+"><br>\n</div>"}},o=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)s.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.name="print",t.prototype.preference=a,t}(r),n.exports=o}}),window.requirejs.define({"views/exports/select_files_manager_dialog_view":function(e,t,n){var i,r,o,a,s,l,c,u,d,p,f,h,m,v,g,w,y,b,x,k,D,C,F,M=function(e,t){return function(){return e.apply(t,arguments)}},T={}.hasOwnProperty;f=t("../view"),d=t("../../lib/utils_url"),p=t("../../lib/utils"),i=t("../../application"),s=t("../../lib/notifier"),h=t("../../lib/zip"),r=t("../../constant"),D=t("../templates/select_files_manager_dialog"),a=t("../../models/file_model"),l=t("../select_files_document_manager_dialog_view"),u=t("../selected_files_dialog_view"),o=t("../dropdown_tag_name_view"),C=null,w=null,x=null,k=null,y=null,g=function(){var e;return C?(e=C.$el.find(".clean_search_input_wrapper"),C.$el.find(".search_input").val()?e.removeClass("blank"):e.addClass("blank")):null},F=_.throttle(g,1e3),b=!1,m=function(){if(C)return C.$dimmer.dimmer("show"),C.$el.find(".close, .page_nav_container").hide(),C.$el.find(".search_container,.search_type_check,.dropdown_tag_name_container").hide(),C.$el.find(".return_export_button,.batch_export_button,.cancel.button").hide(),C.$el.find(".cancel_batch_export_button").html("\u53d6\u6d88\u5bfc\u51fa").show()},v=function(){if(C)return C.$el.find(".close, .page_nav_container").show(),C.$dimmer.dimmer("hide"),C.$el.find(".search_container,.search_type_check,.dropdown_tag_name_container").show(),C.$el.find(".return_export_button,.batch_export_button,.cancel.button").show(),C.$el.find(".cancel_batch_export_button").hide()},c=function(e){function t(){return this.searchDocumentEnter=M(this.searchDocumentEnter,this),this.searchDocument=M(this.searchDocument,this),this.cleanSearchInput=M(this.cleanSearchInput,this),t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)T.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.template=D,t.prototype.className="ui fullscreen story_modal modal story_modal_scroll files_manager_dialog_view",t.prototype.initDocs=[],t.prototype.inSearchMode=!1,t.prototype.events={"click .search_button":"searchDocument","keydown .search_input":"searchDocumentEnter","click .clean_search_input_wrapper":"cleanSearchInput","click .search_type_check":"toggleFullSearch","click .return_export_button":"returnExportDialogView","click .batch_export_button":"batchExportFiles","click .cancel_batch_export_button":"cancelBatchExport"},t.prototype.cancelBatchExport=function(e){return b=!0,C.$el.find(".cancel_batch_export_button").html("\u6b63\u5728\u53d6\u6d88\u4e2d...")},t.prototype.batchExportFiles=function(e){var t,n,o,l,c,u,d,f;return u=k.getSelectedFiles(),t=i.getApplicationProfileModel(),l=this.$el.find("select.filename-pattern-selector").val(),t.set({batchFilenamePattern:l}),0===u.length?s.showMessage("\u8bf7\u9009\u62e9\u81f3\u5c11\u4e00\u4e2a\u6587\u4ef6\u7528\u4e8e\u5bfc\u51fa",6e3,"error"):(m(),f=window.requestFileSystem?new h({method:"filesystem"}):new h({method:"blob"}),k.processStatus("start"),n=[],o=function(e,t){var i,r,o,d;return d=u.length,o=(r=_.indexOf(u,e))/d,k.processStatus("start_file",{id:e,percent:o,total:d,finished:r}),b?t("\u53d6\u6d88\u5bfc\u51fa"):((i=new a).id=e,i.fetch({silent:!0,error:function(n){return s.showMessage("\u9519\u8bef\uff1a"+n,6e3,"error"),k.processStatus("fail_file",{id:e}),t(n)},success:function(i,r){return C.exportFn(i,C.config,(function(r,o){var a;return o||(r="\u5bfc\u51fa\u5931\u8d25\uff0c\u672a\u751f\u6210\u6587\u4ef6"),r?(k.processStatus("fail_file",{id:e}),t(r)):(a=function(e){var t,n,r,o;switch(t=e,l){case"timestamp":t=moment(i.get("createDate")).format("YYYY-MM-DD hh:mm:ss")+"-"+t;break;case"id":n=p.getExt(e,3,!1),r="-"+i.id+"("+moment(i.get("createDate")).format("YYYY-MM-DD hh:mm:ss")+")",n?(o=e.lastIndexOf(n),t=e.substring(0,o)+r+e.substring(o)):t=e+r}return t}(o.filename),a=p.convertToValidFilename(c(a)),n.push({name:a}),f.addFiles({name:a,type:"blob",blob:o.blob},null,null,null,(function(){return k.processStatus("success_file",{id:e,info:o}),t(r,{})})))}))}}))},d=[],c=function(e,t){var n,i,r;return null==t&&(t=0),t>0?(i=p.getExt(e,3,!1))?(r=e.lastIndexOf(i),n=e.substring(0,r)+"("+t+")"+e.substring(r)):n=e+"("+t+")":n=e,d.indexOf(n)>=0?c(e,++t):(d.push(n),n)},f.addFiles({name:"readme.md",type:"text",content:"\u6b22\u8fce\u4f7f\u7528[\u5c0f\u4e66\u5320\u7f16\u8f91\u5668](https://markdown.xiaoshujiang.com)"},null,null,null,(function(){return async.mapSeries(u,o,(function(e,t){var i;return e||b?(b?(b=!1,s.showMessage("\u53d6\u6d88\u5bfc\u51fa")):s.showMessage("\u5bfc\u51fa\u5931\u8d25\uff1a"+e,6e3,"error"),f.close(),f=null):(i={version:1,type:C.type,files:n},f.addFiles({name:r.zip.batchFilename,type:"text",content:JSON.stringify(i,null,2)},null,null,null,(function(){return f.getBlob((function(e){return saveAs(e,"\u5c0f\u4e66\u5320.zip"),s.showMessage("\u5bfc\u51fa\u6210\u529f"),f=null}))}))),k.processStatus("end"),v()}))})))},t.prototype.returnExportDialogView=function(e){return C.$el.modal("setting","transition","horizontal flip"),C.exportFileDialogView.selectedDocs=k.docs,C.exportFileDialogView.show(),C.exportFileDialogView=null},t.prototype.toggleFullSearch=function(e){var t,n;return n=$(e.currentTarget),this.inSearchMode=!this.inSearchMode,t=this.$el.find(".search_container"),this.inSearchMode?(null!=y&&y.hide(),t.show(),n.addClass("active")):(null!=y&&y.show(),t.hide(),n.removeClass("active"))},t.prototype.cleanSearchInput=function(){return this.$el.find(".search_input").val(""),this.$el.find(".clean_search_input_wrapper").addClass("blank")},t.prototype.searchDocument=function(){var e,t,n;if(x)return t=this.$el.find(".search_input").val(),e=!1,1===this.$el.find(".use_fullsearch").length&&this.$el.find(".use_fullsearch").checkbox("is checked")&&(e=!0),n=y.getQueryTags(),this.inSearchMode||(t=""),x.search(t,n,e)},t.prototype.searchDocumentEnter=function(e){var t,n,i;return 13!==e.which&&13!==e.keyCode||x&&(n=this.$el.find(".search_input").val(),t=!1,1===this.$el.find(".use_fullsearch").length&&this.$el.find(".use_fullsearch").checkbox("is checked")&&(t=!0),i=y.getQueryTags(),this.inSearchMode||(n=""),x.search(n,i,t)),F()},t.prototype.initialize=function(e){return(C=this).exportFileDialogView=e.exportFileDialogView,C.type=e.type,C.config=e.config,C.exportFn=e.exportFn,C.initDocs=e.initDocs},t.prototype.afterRender=function(){var e;return this.$el.find(".cancel_batch_export_button").hide(),e=i.getApplicationProfileModel().get("batchFilenamePattern"),this.$el.find("select.filename-pattern-selector").val(e)},t.prototype.addFile=function(e){return k.addFile(e)},t.prototype.removeFile=function(e){return k.removeFile(e)},t.prototype.fileRemoved=function(e){return x.fileRemoved(e)},t.prototype.getSelectedFiles=function(){return k.getSelectedFiles()},t.prototype.showDimmer=function(e){if(this.$dimmer.dimmer("show"),e)return this.$el.find(".dimmer>.ui.text").html(e)},t.prototype.hideDimmer=function(){return this.$dimmer.dimmer("hide"),this.$el.find(".dimmer>.ui.text").html("\u6570\u636e\u51c6\u5907\u4e2d...")},t.prototype.show=function(){var e,t,n,i;return this.render(),this.$dimmer=this.$el.find(".story_content").dimmer({closable:!1}),this.$el.find(".dimmer").html('<div class="ui indeterminate text loader">\u6570\u636e\u51c6\u5907\u4e2d...</div>'),this.showDimmer(),n=!1,e=!1,this.$el.modal({closable:!1,transition:"horizontal flip",onVisible:function(){return n=!0,w&&!e&&(null!=w&&"function"==typeof w.refresh&&w.refresh(),e=!0),C.$el.modal("setting","transition","scale")},onHidden:function(){return null!=x&&x.remove(),x=null,null!=k&&k.remove(),k=null,null!=y&&y.remove(),y=null,w=null,C.$el.modal("destroy"),C.remove(),$("body").dimmer({closable:!1,useCSS:!0}),C.exportFileDialogView&&C.exportFileDialogView.destroy(),C=null}}).modal("show"),t=null,0===this.initDocs.length&&(t=this.exportFileDialogView.model.id),t=null,d.getDirectDocs(t,null,(i=this,function(t,a){return a&&a.length>0&&0===i.initDocs.length&&(i.initDocs=a.map((function(e){return{id:e.doc._id,rev:e.doc._rev,title:e.doc.title}}))),(k=new u({model:i.exportFileDialogView.model,selectFilesManagerDialogView:i,initDocs:i.initDocs})).render(),i.$el.find(".ui.menu .item").tab({onFirstLoad:function(t){var i;if(null!=w&&"function"==typeof w.unactive&&w.unactive(),"document"===t)return i=C.$el.find(".document_tab"),x=new l({selectFilesManagerDialogView:C}),i.html("").append(x.render().$el),w=x,!e&&n&&(null!=w&&"function"==typeof w.refresh&&w.refresh(),e=!0),C.$el.find(".search_type_check").show(),(y=new o({getDB:function(){return r.pouchDB},searchTrigger:function(){return C.searchDocument()}})).render(),C.$el.find(".dropdown_tag_name_placeholder").replaceWith(y.$el),y.init()},onLoad:function(e){if(null!=w&&"function"==typeof w.unactive&&w.unactive(),"document"===e)return w=x,C.$el.find(".search_type_check").show(),null!=y?y.show():void 0}}),i.$el.find(".ui.menu .item[data-tab=document]").tab("change tab","document")}))},t}(f),n.exports=c}}),window.requirejs.define({"views/exports/user_html":function(e,t,n){var i,r,o,a,s,l,c,u={}.hasOwnProperty;a=t("../../lib/utils"),i=t("../../application"),r=t("./base"),c=function(e,t,n){return l(e,t,(function(e,t){return n(e,t)}))},s={title:"\u81ea\u5b9a\u4e49 HTML \u6a21\u677f\u5bfc\u51fa",icon:"far fa-file-code fa-fw",config:{netImage:!0,convertSvg:!0,convertFontIcon:!1,changeOpenTarget:!1,template:'<!DOCTYPE html><html lang="en"><head>\n<title> <%=title%>---<%=welcome%></title>\n  <meta charset="utf-8">\n<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">\n<meta name="viewport" content="width=device-width, initial-scale=1.0">\n<meta name="description" content="()">\n<style type="text/css">\n<%=style%>\n</style>\n</head><body>\n<div><div class="preview" id="wmd-preview">\n<%=content%>\n</div></div>\n</body></html>'},defaultClass:"active",description:"\u4f7f\u7528\u81ea\u5b9a\u4e49\u7684\u6a21\u677f\u5bfc\u51fahtml,\u652f\u6301\u7684\u53d8\u91cf\u6709content, title, welcome, style, meta, \u4f7f\u7528\u7684\u8bed\u6cd5\u4e3aunderscore\u91cc\u7684template",exportFn:l=function(e,t,n){var r;return r={type:"dataURL",netImage:!0,changeOpenTarget:!1,parseClientLocalMedias:!1,brand:"xsj_export_html"},$.extend(r,t),setTimeout((function(){return $(window).trigger("convertPreviewFormatForExport",[e,r,function(t,o){return i.getStyleText(e,r.globalSetting,(function(t,i){return a.exportTemplateFile(r.template,o.html(),e.get("title"),i,e.getMeta(),(function(e,t,i){return n(e,{blob:t,filename:i})}))}))}])}),1e3)},fn:function(e,t,n){return c(e,t,n)},getConfig:function(e){var t,n,i,r;return i=e.find("input[name=netImage]"),n=e.find("input[name=convertSvg]"),t=e.find("input[name=changeOpenTarget]"),r=e.find("textarea[name=template]"),{netImage:i.is(":checked"),convertSvg:n.is(":checked"),changeOpenTarget:t.is(":checked"),template:r.val()}},generateConfigHtml:function(e,t){var n,i,r,o,a,s;return null==e&&(e={}),null==t&&(t=null),n={},$.extend(n,{netImage:!0,convertSvg:!0,template:'<!DOCTYPE html><html lang="en"><head>\n<title> <%=title%>---<%=welcome%></title>\n  <meta charset="utf-8">\n<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">\n<meta name="viewport" content="width=device-width, initial-scale=1.0">\n<meta name="description" content="()">\n<style type="text/css">\n<%=style%>\n</style>\n</head><body>\n<div><div class="preview" id="wmd-preview">\n<%=content%>\n</div></div>\n</body></html>'},e),s=n.netImage?"checked":"",o=n.convertSvg?"checked":"",r=n.changeOpenTarget?"checked":"",(a=document.createElement("textarea")).textContent=n.template,i=a.innerHTML,a=null,'<div>\n\u8f6c\u6362\u7f51\u7edc\u56fe\u7247: <input type="checkbox" name="netImage" '+s+'><br>\n\u5c06svg\u8f6c\u6362\u6210\u56fe\u7247: <input type="checkbox" name="convertSvg" '+o+'><br>\n\u5728\u65b0\u7a97\u53e3\u6253\u5f00\u8d85\u94fe\u63a5: <input type="checkbox" name="changeOpenTarget" '+r+'><br>\n</div>\n<div>\n<textarea width="100%" name="template">'+i+"</textarea>\n</div>"}},o=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)u.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.name="userHtml",t.prototype.preference=s,t}(r),n.exports=o}}),window.requirejs.define({"views/exports/utils":function(e,t,n){var i,r,o,a,s,l,c,u,d,p,f,h,m,v,g,_,w;l=t("./markdown"),a=t("./html"),m=t("./word"),v=t("./zip"),p=t("./ppt"),d=t("./png"),c=t("./mobi"),o=t("./epub"),r=t("./docx"),u=t("./pdf"),s=t("./jopp"),h=t("./user_html"),i=t("./client_pdf"),f=t("./print"),g=[l,a,m,v,p,d,c,o,r,u,s,h,i,f],w=function(e){var t;return t=[],g.forEach((function(e){return e.isFactory?e().forEach((function(e){return t.push(e)})):t.push(e)})),t.filter((function(t){var n,i,r;if((r=(n=t.prototype).preference).webOnly&&"web"!==STORY_PLATFORM)return!1;if(r.clientOnly&&"client"!==STORY_PLATFORM)return!1;if(i=!1,MINI_WEB&&(i=!0),MAC_STORE_WEB&&(i=!1),r.isHelpTip&&!e)return!1;if(i){if("installJOPPPdf"===n.name)return!0;if(/^jopp-/i.test(n.name))return!0;if(["html","markdown","zip","png","userHtml","print"].indexOf(n.name)<0)return!1}return!MAC_STORE_WEB||"print"!==n.name}))},_=function(e,t){var n,i,r,o;return i=w(!1),o={},r=!1,(null!=t?t.length:void 0)>1&&(r=!0),n=function(n){return function(){return $(window).trigger("exportFileModel",[e,n,t])}},i.forEach((function(e){var t,i;if(i=(t=e.prototype).preference,!r||i.exportFn)return o["export_"+t.name]={name:i.shortTitle||i.title||t.name,icon:i.icon||"",callback:n(t.name)}})),o},n.exports={getExportViewClassiesFn:w,getExportContextMenuItemsFn:_}}}),window.requirejs.define({"views/exports/word":function(e,t,n){var i,r,o,a,s={}.hasOwnProperty;i=t("./base"),o={title:"Word 2003 (doc)",icon:"fas fa-file-word fa-fw",description:"\u5c06\u5f53\u524d\u6587\u7ae0\u5bfc\u51fa\u4e3a doc \u683c\u5f0f, \u4ec5\u652f\u6301 word 2003 \u4e4b\u524d\u7684\u7248\u672c",fn:function(e,t,n){return a(e,0,(function(e,t){return saveAs(t.blob,t.filename),n(e)}))},exportFn:a=function(e,t,n){return setTimeout((function(){return $(window).trigger("convertPreviewFormatForExport",[e,{type:"dataURL",netImage:!0,parseClientLocalMedias:!0,brand:"xsj_export_word"},function(t,i){return i.wordExport(e.get("title"),(function(e,t,i){return n(e,{blob:t,filename:i})}))}])}),1e3)}},r=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)s.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.name="word",t.prototype.preference=o,t}(i),n.exports=r}}),window.requirejs.define({"views/exports/zip":function(e,t,n){var i,r,o,a,s,l,c={}.hasOwnProperty;a=t("../../lib/utils"),i=t("../../application"),r=t("./base"),s={title:"Zip",icon:"far fa-file-archive fa-fw",config:{netImage:!1,convertSvg:!1,convertFontIcon:!0,changeOpenTarget:!1},getConfig:function(e){return{netImage:e.find("input[name=netImage]").is(":checked")}},generateConfigHtml:function(e,t){var n;return null==e&&(e={}),null==t&&(t=null),n={},$.extend(n,{netImage:!0},e),'<div>\n\u8f6c\u6362\u7f51\u7edc\u56fe\u7247: <input type="checkbox" name="netImage" '+(n.netImage?"checked":"")+">\n</div>"},description:"\u5c06\u5f53\u524d\u6587\u7ae0\u6253\u5305\u6210zip\u683c\u5f0f",fn:function(e,t,n){return l(e,t,(function(e,t){return n(e,t)}))},exportFn:l=function(e,t,n){var r;return r={type:"dataURL",netImage:!0,convertSvg:!1,convertFontIcon:!0,changeOpenTarget:!1,parseClientLocalMedias:!0,brand:"xsj_export_zip",containId:!0},$.extend(r,t),setTimeout((function(){return $(window).trigger("convertPreviewFormatForExport",[e,r,function(t,o){return i.getStyleText(e,r.globalSetting,(function(t,i){return a.exportZipFile(o,a.convertToValidFilename(e.get("title")),e.get("content"),i,e,r,(function(e,t,i){return n(e,{blob:t,filename:i})}))}))}])}),1e3)}},o=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)c.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.name="zip",t.prototype.preference=s,t}(r),n.exports=o}}),window.requirejs.define({"views/external_editor_view":function(e,t,n){var i,r,o,a,s,l={}.hasOwnProperty;o=t("./view"),t("../lib/utils"),t("../application"),r=t("../lib/notifier"),a=t("./templates/external_editor"),s=null,i=function(e){var t,n,i,o;function c(){return c.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)l.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(c,e),c.prototype.template=a,c.prototype.className="ui standard story_modal modal",o=[],i=null,t=null,n=null,c.prototype.initialize=function(e){return this.editorView=e.editorView},c.prototype.afterRender=function(){return i=this.$el.find(".external_editor_modify_container"),t=this.$el.find(".external_editor_detail_container"),n=this.$el.find(".external_editor_list_container"),this.showEditors()},c.prototype.events={"click .modify_button":"modifyEditor","click .save_modify_button":"submitModifyEditor","click .cancel_modify_button":"cancelModifyEditor","click .add_button":"addEditor","click .delete_button":"deleteEditor"},c.prototype.showEditors=function(){var e;return i.hide(),t.hide(),n.show(),(e=n.find(">tbody")).html(""),o.length>0?o.forEach((function(t,n){return e.append("<tr>\n  <td> "+(n+1)+" </td>\n  <td> "+t.name+'</td>\n  <td>\n    <div">\n      <div class="ui basic mini button modify_button" data-id='+t.id+'>\u4fee\u6539</div>\n      <div class="ui basic mini button delete_button" data-id='+t.id+'>\u5220\u9664</div>\n    </div">\n  </td>\n</tr>')})):this.showModifyEditor()},c.prototype.deleteEditor=function(e){var t,n,i,r,a;for(i=$(e.currentTarget).data("id"),a=[],n=0,r=o.length;n<r;n++)(t=o[n]).id!==i&&a.push(t);return o=a,localStorage.setItem("externalEditors",JSON.stringify(o)),this.showEditors()},c.prototype.modifyEditor=function(e){var t,n;if(n=$(e.currentTarget).data("id"),t=this.getEditorById(n))return this.showModifyEditor(t)},c.prototype.showModifyEditor=function(e){return i.show(),t.hide(),n.hide(),e?(i.find("input[name=id]").val(e.id),i.find("input[name=editorName]").val(e.name),i.find("textarea[name=executeStr]").val(e.value)):(i.find("input[name=id]").val(""),i.find("input[name=editorName]").val(""),i.find("textarea[name=executeStr]").val("")),o.length>0?i.find(".cancel_modify_button").show():i.find(".cancel_modify_button").hide()},c.prototype.showDetailEditor=function(e){return i.hide(),t.show(),n.hide()},c.prototype.cancelModifyEditor=function(){return this.showEditors()},c.prototype.submitModifyEditor=function(){var e,t,n,a;if(n=parseInt($.trim(i.find("input[name=id]").val())),a=$.trim(i.find("input[name=editorName]").val()),t=$.trim(i.find("textarea[name=executeStr]").val()),e=null,a&&t)return n&&(e=this.getEditorById(n)),e?(e.name=a,e.value=t):(e={id:Date.now(),name:a,value:t},o.unshift(e)),localStorage.setItem("externalEditors",JSON.stringify(o)),this.showEditors();r.showMessage("\u540d\u79f0\u548c\u547d\u4ee4\u4e0d\u80fd\u4e3a\u7a7a",6e3,"error")},c.prototype.getEditorById=function(e){var t,n,i;for(n=0,i=o.length;n<i;n++)if((t=o[n]).id===e)return t;return null},c.prototype.addEditor=function(){return this.showModifyEditor()},c.getExternalEditors=function(){var e;e=localStorage.getItem("externalEditors");try{e=JSON.parse(e)}catch(t){t,e=[]}return $.isArray(e)||(e=[]),e},c.prototype.show=function(e){return s=this,o=c.getExternalEditors(),this.render(),this.$el.modal({onHidden:function(){return s.$el.modal("destroy"),s.remove(),s=null}}).modal("show")},c}(o),n.exports=i}}),window.requirejs.define({"views/external_preview_view":function(e,t,n){var i,r,o,a,s,l,c,u,d=function(e,t){return function(){return e.apply(t,arguments)}},p={}.hasOwnProperty;a=t("./view"),i=t("../application"),o=t("../lib/notifier"),c=t("./templates/external_preview_view"),l=t("../lib/preview_core"),u=null,s=function(e,t,n){var i,r,o,a,s,l,c,u,d,p,f,h,m,v,g,_,w,y,b,x,k,D;switch(n){case"presetation":return r=[],f=e.getLength(),k=0,i=t.getPreviewContainer(),x=i.find("section.section_content"),d=x.length,x.each((function(e,t){var n,i,o,a,s,l;for(l=(n=$(t)).data("line"),0!==k&&(k=l),o=e+1>=d?f:$(x[e+1]).data("line")-1,i=a=k,s=o;a<=s?i<=s:i>=s;a<=s?++i:--i)r.push({indexh:n.data("indexh"),indexv:n.data("indexv"),indexf:n.data("indexf")});return k=l})),r;default:for((i=t.getPreviewContainer()).height(),h=[],r=[],m=[],v=i.scrollTop(),f=e.getLength(),_=e.getScreenLength(),D=0,p=l=0,w=f-1;0<=w?l<=w:l>=w;p=0<=w?++l:--l)h.push(D),D+=e.getRowLength(p);for(h.push(D),s=c=0,y=_-1;0<=y?c<=y:c>=y;s=0<=y?++c:--c)r.push(-1);for(m.push(0),r[0]=0,i.find("[data-source-line]").each((function(e,t){var n,i;if(""!==(i=(n=$(t)).attr("data-source-line"))&&(i=h[i],!(m.indexOf(i)>=0)))return 0!==i&&m.push(i),r[i]=Math.round(n.offset().top+v)})),m.push(_),r[_]=i[0].scrollHeight,g=0,s=u=1,b=_-1;1<=b?u<=b:u>=b;s=1<=b?++u:--u)-1===r[s]?(o=m[g],a=m[g+1],r[s]=Math.round((r[a]*(s-o)+r[o]*(a-s))/(a-o))):g++;return r}},r=function(e){function t(){return this._changeFileModel=d(this._changeFileModel,this),this.createNewExternalPreviewWindow=d(this.createNewExternalPreviewWindow,this),t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)p.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.template=c,t.prototype.className="external_preview_view",t.prototype.nextId=1,t.prototype.previewWindows={},t.prototype.initialize=function(e){var t;return u=this,this.resetScrollMap=e.resetScrollMap,this.previewView=e.previewView,this.fileModel=e.previewView.fileModel,this.listenTo(this.model,"change:codePreviewCss change:systemPreviewCss change:useSystemPreviewCss change:userPreviewCssText",(t=this,function(){var e,n,r,o;for(e in o=[],r=t.previewWindows)n=r[e],o.push(i.getStyleText(t.fileModel,(function(e,t){return l.setCustomCss(t,n.previewDocument)})));return o})),$(window).on("createNewExternalPreviewWindow",this.createNewExternalPreviewWindow),$(window).on("fileModelChanged",this._changeFileModel),this.startSyncPreview()},t.prototype.createNewExternalPreviewWindow=function(){var e,t,n,i;if(!(Object.keys(this.previewWindows).length>5))return i=$(window).width()/2,e=$(window).height()/2,this,n=u.previewView.previewType,t=u.nextId,u.nextId++,PopupCenter("viewer.html","xsj_"+t,i,e,(function(e){var i,r,o;return e.GLOBALID="xsj_"+t,i=e.$,u.previewWindows["xsj_"+t]={openerWindow:e,nextId:t},$(e).one("unload",(function(){var t,n;if(e.GLOBALID)return n=u.previewWindows[e.GLOBALID],console.log("before unload external viewer"),delete u.previewWindows[e.GLOBALID],console.log("unload external viewer"),(t=n.$target).empty(),t.parentsUntil("html").remove(),e=null})),"presetation"===n?(o=i(".xsj_viewer"),(r=i('<iframe allowfullscreen src="presetation.html" class="preview_iframe" frameborder="0" style="width: 100%;height:100%;"></iframe>').appendTo(o)).one("load",(function(){var n;return(n=r[0].contentWindow).autoLoadRemoteResource=!0,u._initPresetationPreviewOnload(e,n,t)}))):(o=i(".xsj_viewer"),(r=i('<iframe allowfullscreen src="p.html" class="preview_iframe" frameborder="0" style="width: 100%;height:100%;"></iframe>').appendTo(o)).one("load",(function(){var n;return(n=r[0].contentWindow).autoLoadRemoteResource=!0,u._initHtmlPreviewOnload(e,n,t)})))}));o.showMessage("\u65e0\u6cd5\u518d\u521b\u5efa\u66f4\u591a\u7684\u65b0\u9884\u89c8\u7a97\u53e3\u4e86",6e3,"error")},t.prototype.stopSyncPreview=function(){var e,t;for(e in t=this.previewWindows)t[e].$target.empty();if(this.fileModel)return this.stopListening(this.fileModel)},t.prototype._preview=function(){return $.each(this.previewWindows,(function(e,t){var n,i,r;return r=t.previewWindow,n=t.$target,i={sourceMap:!0,previewType:u.previewType,needRenderPreview:!0,parseClientLocalMedias:!0,livePreview:!0},l.previewTarget(u.fileModel,null,r,n,i,(function(e){if("normal"===u.previewType&&$(previewDocument).find(".preview .xiaoshujiang_code_container").map((function(e,t){var n,i,r,o,a,s,l,c;if(s=((i=$(t)).data("orign_code")||"").split("\n").length,l=i.data("title")||"",a=i.data("lang"),r=i.data("codechunk_lang"),!i.data("codechunk_hide"))return o="",r&&(o='<a class="xiaoshujiang_code_run_button hljs-keyword" title="\u8fd0\u884c\u4ee3\u7801"><i class="fa fa-play"></i></a>'),c="",l||(c="xiaoshujiang_contain_title"),n=$('<div class="xiaoshujiang_code_buttons xiaoshujiang_element '+c+'">\n  <a class="xiaoshujiang_code_collapse_button hljs-keyword" title="\u6298\u53e0\u4ee3\u7801"><i class="fa fa-minus-square-o"></i></a>\n  <a class="xiaoshujiang_code_expand_button hljs-keyword" title="\u5c55\u5f00\u4ee3\u7801"><i class="fa fa-plus-square-o"></i></a>\n  <a class="xiaoshujiang_code_raw_button hljs-keyword" title="\u67e5\u770b\u539f\u6587"><i class="fa fa-code"></i></a>\n  <a class="xiaoshujiang_code_download_button hljs-keyword" title="\u4e0b\u8f7d\u4ee3\u7801"><i class="fa fa-download"></i></a>\n  <a class="xiaoshujiang_code_image_button hljs-keyword" title="\u62cd\u7167\u6210\u4ee3\u7801\u56fe\u7247"><i class="fa fa-camera"></i></a>\n  '+o+'\n  <span class="xiaoshujiang_code_title">'+l+'</span>\n  <span class="xiaoshujiang_code_infos">'+a+"&nbsp;&nbsp;&nbsp;&nbsp;"+s+"\u884c</span>\n</div>"),i.prepend(n)})),"presetation"===u.previewType)return r.initRevealjs()}))}))},t.prototype.startSyncPreview=function(){var e,t,n;try{this._preview()}catch(e){t=e,console.log(t)}if(e=_.debounce((n=this,function(){return n._preview()}),this.model.get("delay")),this.fileModel)return this.listenTo(this.fileModel,"change:content",e),this.listenTo(this.fileModel,"change:cssText",function(e){return function(){var t,n,r,o;for(t in o=e.previewWindows)r=o[t],n=r.previewDocument,i.getStyleText(e.fileModel,(function(e,t){return l.setCustomCss(t,n)}));return e._preview()}}(this))},t.prototype._initPresetationPreviewOnload=function(e,t,n){var r,o,a,c,d,p,f,h;return u.previewType="presetation",t.requirejs("previews/preview")(t),o=u.fileModel,a=t.document,i.getStyleText(o,(function(e,t){return l.setCustomCss(t,a)})),(r=$(a).find(".slides")).on("click",".story_script_resource_placeholder",(function(e){var t;return t=$(e.currentTarget),l.replaceScriptResource(t,e)})),d=u.previewWindows["xsj_"+n],p=null,f=function(e){var t,n,r;if(!0===i.getApplicationProfileModel().get("syncScrollEditor")&&!isChangingPreviewType)return r=function(e){var t;return e.indexh<=0?1:(p||(p=s(this.previewView.editorView,d,"presetation")),t=0,_.find(p,(function(n){return t++,n.indexh===e.indexh&&n.indexv===e.indexv})),t)}({indexh:e.indexh,indexv:e.indexv}),n=$.Event("previewScrollSync",{xsjOriginalEvent:t}),$(window).trigger(n,r),null},h=_.throttle(f,100),t.Reveal.addEventListener("slidechanged",h),$.extend(d,{previewWindow:t,previewDocument:a,$target:r,scrollMap:p,getPreviewContainer:function(){return $(a).find("body>div>.preview").parent()},resetScrollMap:function(){return p=null}}),c={sourceMap:!0,previewType:"presetation",needRenderPreview:!0,parseClientLocalMedias:!0,livePreview:!0},l.previewTarget(o,null,t,r,c,(function(e){return t.initRevealjs()}))},t.prototype._initHtmlPreviewOnload=function(e,t,n){var r,o,a,c,d,p,f,h,m;return u.previewType="normal",t.requirejs("previews/preview")(t),a=u.fileModel,c=t.document,o=$(c).find(".preview"),p=u.previewWindows["xsj_"+n],o.on("click",".xiaoshujiang_code_container>.xiaoshujiang_code_buttons>.xiaoshujiang_code_collapse_button",(function(e){return(o=$(e.currentTarget)).parent().parent().addClass("xiaoshujiang_code_container_collapse")})),o.on("click",".xiaoshujiang_code_container>.xiaoshujiang_code_buttons>.xiaoshujiang_code_expand_button",(function(e){return(o=$(e.currentTarget)).parent().parent().removeClass("xiaoshujiang_code_container_collapse")})),o.on("click",".xiaoshujiang_code_container>.xiaoshujiang_code_buttons>.xiaoshujiang_code_run_button",(function(e){var t;return t=(o=$(e.currentTarget)).parent().parent(),l.runCodeChunk(t[0],a)})),o.on("click",".xiaoshujiang_code_container>.xiaoshujiang_code_buttons>.xiaoshujiang_code_raw_button",(function(e){var t,n,i;return o=$(e.currentTarget),n=o.parent().parent().data("orign_code"),i=o.parent().parent().width(),t=(t=o.parent().parent().height())>400?400:t,PopupCenter("./code.html","\u5c0f\u4e66\u5320",i,t,(function(e){return $(e.document.body).text(n)}))})),o.on("click",".xiaoshujiang_code_container>.xiaoshujiang_code_buttons>.xiaoshujiang_code_download_button",(function(e){var t,n;return n=(o=$(e.currentTarget)).parent().parent().data("orign_code"),"\u4ee3\u7801\u7247\u6bb5.txt",t=new Blob([n],{type:"text/plain;charset=utf-8"}),window.saveAs(t,"\u4ee3\u7801\u7247\u6bb5.txt")})),o.on("click",".xiaoshujiang_code_container>.xiaoshujiang_code_buttons>.xiaoshujiang_code_image_button",(function(e){var t,n,i,r,a;return o=$(e.currentTarget),r=[],$(c).find("style").each((function(e,t){return r.push($(t).text())})),t=o.parent().parent(),i=t.data("lang")||"\u4ee3\u7801\u6bb5",a=t.width(),n=(n=t.height())>400?400:n,PopupCenter("./image.html","\u5c0f\u4e66\u5320",a,n,(function(e){return $(e.document.head).append("<style type='text/css'>"+r.join("\n")+"</style>"),$(e.document.body).append(t.outerHTML()),e.converImage(null,(function(t,n){return e.close(),t?alert(t):window.saveAs(n,i+".png")}))}))})),o.on("click",".story_image img",(function(t){var n,i,r;return n=$(t.currentTarget),i=[],r=0,o.find(".story_image img").map((function(e,t){var o;if((o=$(t)).is(n)&&(r=e),o.attr("src"))return i.push({title:o.attr("title")||o.attr("alt")||"",href:o.attr("src")})})),e._blueimp=e.blueimp.Gallery(i,{index:r,slideLoadingClass:"ui loader slide-loading"})})),o.on("click",".story_script_resource_placeholder",(function(e){var t;return t=$(e.currentTarget),l.replaceScriptResource(t,e)})),i.getStyleText(a,(function(e,t){return l.setCustomCss(t,c)})),r=o.parent(),scrollMap,m=this,f=function(){var e,t,n;if(!0===i.getApplicationProfileModel().get("syncScrollEditor")&&!isChangingPreviewType)return n=function(e){var t,n;return e<=0?1:(n||(n=s(m.previewView.editorView,p,"normal")),t=0,_.find(n,(function(n){return t++,n>=e})),t=(t-=3)<0?0:t)}(r.scrollTop()),t=$.Event("previewScrollSync",{xsjOriginalEvent:e}),$(window).trigger(t,n),null},h=_.throttle(f,100),this.syncEditor=h,r.on("scroll",h),$(t).on("resize",(function(){return null})),$.extend(p,{previewWindow:t,previewDocument:c,$target:o,scrollMap:scrollMap,getPreviewContainer:function(){return $(c).find("body>div>.preview").parent()},resetScrollMap:function(){return null}}),d={sourceMap:!0,previewType:"normal",needRenderPreview:!0,parseClientLocalMedias:!0,livePreview:!0},l.previewTarget(a,null,t,o,d,(function(e){return $(c).find(".preview .xiaoshujiang_code_container").map((function(e,t){var n,i,r,o,a,s,l,c;if(s=((i=$(t)).data("orign_code")||"").split("\n").length,l=i.data("title")||"",a=i.data("lang"),r=i.data("codechunk_lang"),!i.data("codechunk_hide"))return o="",r&&(o='<a class="xiaoshujiang_code_run_button hljs-keyword" title="\u8fd0\u884c\u4ee3\u7801"><i class="fa fa-play"></i></a>'),c="",l||(c="xiaoshujiang_contain_title"),n=$('<div class="xiaoshujiang_code_buttons xiaoshujiang_element '+c+'">\n  <a class="xiaoshujiang_code_collapse_button hljs-keyword" title="\u6298\u53e0\u4ee3\u7801"><i class="fa fa-minus-square-o"></i></a>\n  <a class="xiaoshujiang_code_expand_button hljs-keyword" title="\u5c55\u5f00\u4ee3\u7801"><i class="fa fa-plus-square-o"></i></a>\n  <a class="xiaoshujiang_code_raw_button hljs-keyword" title="\u67e5\u770b\u539f\u6587"><i class="fa fa-code"></i></a>\n  <a class="xiaoshujiang_code_download_button hljs-keyword" title="\u4e0b\u8f7d\u4ee3\u7801"><i class="fa fa-download"></i></a>\n  <a class="xiaoshujiang_code_image_button hljs-keyword" title="\u62cd\u7167\u6210\u4ee3\u7801\u56fe\u7247"><i class="fa fa-camera"></i></a>\n  '+o+'\n  <span class="xiaoshujiang_code_title">'+l+'</span>\n  <span class="xiaoshujiang_code_infos">'+a+"&nbsp;&nbsp;&nbsp;&nbsp;"+s+"\u884c</span>\n</div>"),i.prepend(n)}))}))},t.prototype._changeFileModel=function(e,t){var n,r,o,a,s,c,d,p;for(r in(n=null!=(d=u.openerWindow)?d._blueimp:void 0)&&(n.close(),n.resetThumbnailCaches(),u.openerWindow._blueimp=null),this.stopSyncPreview(),this.fileModel=t,p=this.previewWindows)c=p[r],a=c.previewDocument,i.getStyleText(t,(function(e,t){return l.setCustomCss(t,a)}));return this.startSyncPreview(),o=t.getMeta(),"presentation"===(s=o.preview_previewType||"normal")&&(s="presetation"),$.each(this.previewWindows,(function(e,t){var n,i,r,o,l,c,d;if(i=(c=t.openerWindow).$,d=t.previewWindow,a=t.previewDocument,n=t.$target,l=e,s!==this.previewType)switch(n.empty(),n.parentsUntil("html").remove(),(o=i(".xsj_viewer")).empty(),s){case"presetation":return(r=i('<iframe allowfullscreen src="presetation.html" class="preview_iframe" frameborder="0" style="width: 100%;height:100%;"></iframe>').appendTo(o)).one("load",(function(){var e;return e=r[0],(d=e.contentWindow).autoLoadRemoteResource=!0,u._initPresetationPreviewOnload(c,d,l)}));default:return(r=i('<iframe allowfullscreen src="p.html" class="preview_iframe" frameborder="0" style="width: 100%;height:100%;"></iframe>').appendTo(o)).one("load",(function(){var e;return e=r[0],(d=e.contentWindow).autoLoadRemoteResource=!0,u._initHtmlPreviewOnload(c,d,l)}))}}))},t}(a),n.exports=r}}),window.requirejs.define({"views/file_attachments_manager_view":function(e,t,n){var i,r,o,a,s,l,c,u,d=function(e,t){return function(){return e.apply(t,arguments)}},p={}.hasOwnProperty;s=t("./view"),o=t("../lib/notifier"),a=t("../lib/utils"),i=t("../application"),t("../lib/resource_core"),c=t("./templates/file_attachments_manager"),l=!1,u=null,r=function(e){function n(){return this.openGallery=d(this.openGallery,this),n.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)p.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(n,e),n.prototype.template=c,n.prototype.className="ui modal standard story_modal",n.prototype.events={"click .file_gallery .center-cropped":"openGallery","click .delete_button":"_deleteFile","click .info_button":"_info","click .attach_button":"_attach","click .archive_button":"_archive","click .draft_button":"_draft","click .detail_button":"_detail","click .cover_button":"setCover","click .remove_button":"removeAttachment","click .download_button":"downloadAttachment","click .add_attachments_button":"addAttachment"},n.prototype._deleteFile=function(e){var t,n,i;return t=u.model.attributes._id,i=u.model.attributes._rev,null!=(n=u.filesDocumentManager)?n.deleteFile(t,i):void 0},n.prototype._info=function(e){var t,n,i;return t=u.model.attributes._id,i=u.model.attributes._rev,null!=(n=u.filesDocumentManager)?n.info(t,i):void 0},n.prototype._attach=function(e){var t,n,i;return t=u.model.attributes._id,i=u.model.attributes._rev,null!=(n=u.filesDocumentManager)?n.attach(t,i):void 0},n.prototype._archive=function(e){var t,n,i;return t=u.model.attributes._id,i=u.model.attributes._rev,null!=(n=u.filesDocumentManager)?n.archive(t,i,(function(){return u.$el.find(".archive_button").removeClass("archive_button").addClass("draft_button").html("\u91cd\u65b0\u8349\u7a3f")})):void 0},n.prototype._draft=function(e){var t,n,i;return t=u.model.attributes._id,i=u.model.attributes._rev,null!=(n=u.filesDocumentManager)?n.draft(t,i,(function(){return u.$el.find(".draft_button").removeClass("draft_button").addClass("archive_button").html("\u5f52\u6863")})):void 0},n.prototype._detail=function(e){var t,n,i;return t=u.model.attributes._id,i=u.model.attributes._rev,null!=(n=u.filesDocumentManager)?n.detail(t,i):void 0},n.prototype.addAttachment=function(e){return u.$el.find("input[type=file]").trigger("click")},n.prototype.removeAttachment=function(e){var t,n;return e.stopPropagation(),e.preventDefault(),n=(t=$(e.currentTarget).parent().parent()).data("key"),u.model.deleteAttachment(n,(function(){})),l=!0,t.remove(),0===u.$el.find(".card").length&&u._setBlankHtml(),o.showMessage("\u5220\u9664\u9644\u4ef6"+n+"\u6210\u529f")},n.prototype.downloadAttachment=function(e){var t,n;return e.stopPropagation(),e.preventDefault(),t=$(e.currentTarget).parent().parent(),n=t.data("key"),u.model.getAttachObjectByFilename(n,(function(e,t){var i,r;return null!=t?t.objectUrl:void 0,r=n.substring(n.lastIndexOf("/")+1),(i=null!=t?t.data:void 0)?saveAs(i,r):o.showMessage("\u4e0b\u8f7d\u5931\u8d25: \u627e\u4e0d\u5230\u8be5\u6587\u4ef6",6e3,"error")}))},n.prototype.setCover=function(e){var t,n,i,r,a,s;return e.stopPropagation(),e.preventDefault(),r=u.model.get("cover"),t=(i=$(e.currentTarget)).parent().parent().parent(),a=t.data("key"),n=i.parent(),s={force:!0,success:function(e){if(u.$el.find(".main_cover .cover_tip").html("\u8bbe\u7f6e\u5c01\u9762"),u.$el.find(".main_cover").removeClass("main_cover"),e.get("cover")===a)return n.addClass("main_cover"),u.$el.find(".main_cover .cover_tip").html("\u53d6\u6d88\u5c01\u9762")},error:function(e){return o.showMessage("error: "+e,6e3,"error")}},a===r?u.model.save({cover:""},s):u.model.save({cover:a},s)},n.prototype.initialize=function(e){return null==e&&(e={}),this.hideCallbackFn=e.hideCallbackFn,this.filesDocumentManager=e.filesDocumentManager,u=this},n.prototype.getRenderData=function(){return{title:this.model.get("title")}},n.prototype.openGallery=function(e){var n,i,r,o,a,s;return r=$(e.currentTarget),n=this.$el.find(".file_gallery .center-cropped"),o=[],a=0,n.map((function(e,t){var n;return(n=$(t)).is(r)&&(a=e),o.push({title:n.parent().find(">.content").text()||"",href:n.data("url"),thumbnail:n.data("url")})})),i=this.$el.parent(),s=i.attr("style"),t("../lib/dynamic_import/import_blueimp_gallery")((function(){return blueimp.Gallery(o,{index:a,slideLoadingClass:"ui loader slide-loading",onopen:function(){return i.attr("style","display: none !important")},onclosed:function(){return i.attr("style",s),i=null}})}))},n.prototype.afterRender=function(){var e;return e=i.getCurrentFileMode(),this.model.id===e.id&&this.$el.find(".archive_button, .draft_button").remove(),this.model.attributes.isArchived?this.$el.find(".archive_button").remove():this.$el.find(".draft_button").remove(),a.initdragFilesSupport(this.$el.find(".add_attachments_button"),(function(e){return a.insertImageFiles(e,(function(e,t){if(!e)return t.forEach((function(e){var t,n,r,o;return n=e.content,e.path,r=e.file,o=r.type,t=a.dataURL2Blob(n),a.blobToMd5(t,(function(e,n){var a;return a=i.getUploadFilePath(o,u.model,r.name,n,t),u.model.addAttachment(t,a,r.type,null,(function(e,t,n,i){var r;return r=u.$el.find(".ui.cards"),l=!0,u.renderAttachment(r,t,i,!0)}))}))}));o.showMessage("error: +"+e,6e3,"error")}))})),a.initFileImportSupport(this.$el.find('input[type="file"]'),(function(e){return a.insertImageFiles(e,(function(e,t){if(!e)return t.forEach((function(e){var t,n,r,o;return n=e.content,e.path,r=e.file,o=r.type,t=a.dataURL2Blob(n),a.blobToMd5(t,(function(e,n){var a;return a=i.getUploadFilePath(o,u.model,r.name,n,t),u.model.addAttachment(t,a,r.type,null,(function(e,t,n,i){var r;return r=u.$el.find(".ui.cards"),l=!0,u.renderAttachment(r,t,i,!0)}))}))}));o.showMessage("error: +"+e,6e3,"error")}))}))},n.prototype.hide=function(){return this.$el.modal("hide")},n.prototype.renderAttachment=function(e,t,n,i){var r,o,a,s,l;if(null==i&&(i=!1),this._setGallary(),this.model.hasAttachment(t))return a=t.substring(t.lastIndexOf(".")+1).toUpperCase(),l=(s=this.model.get("cover")===t)?"main_cover":"",o=s?"\u53d6\u6d88\u5c01\u9762":"\u8bbe\u7f6e\u5c01\u9762","\u5c01\u9762",r=_.contains(["JPG","JPEG","PNG","GIF","SVG"],a)?$('<div class="card" data-key="'+t+'">\n  <div class="center-cropped" style="background-image: url(\''+n+'\');" data-url="'+n+'"></div>\n  <div class="content">'+t+'</div>\n  <div class="extra content">\n    <span class="right floated cover '+l+'">\n      <span class="cover_text">\u5c01\u9762</span>\n      <span class="cover_tip">'+o+'</span>\n      <i class="flag icon cover_button"></i>\n    </span>\n  </div>\n  <div class="ui bottom attached buttons basic">\n    <div class="ui button icon remove_button">\n    <i class="icon remove"></i>\n    \u5220\u9664\n    </div>\n    <div class="ui button icon download_button">\n    <i class="icon download"></i>\n    \u4e0b\u8f7d\n    </div>\n  </div>\n  </div>'):$('<div class="card" data-key="'+t+'">\n  <div class="content">'+t+'</div>\n  <div class="ui bottom attached buttons basic">\n    <div class="ui button icon remove_button">\n    <i class="icon remove"></i>\n    \u5220\u9664\n    </div>\n    <div class="ui button icon download_button">\n    <i class="icon download"></i>\n    \u4e0b\u8f7d\n    </div>\n  </div>\n  </div>'),i?e.prepend(r):e.append(r)},n.prototype._setBlankHtml=function(){return this.$el.find(".blank_html").show(),this.$el.find(".file_gallery").hide()},n.prototype._setGallary=function(){return this.$el.find(".blank_html").hide(),this.$el.find(".file_gallery").show()},n.prototype.show=function(e,t){var n,i;return null==t&&(t=!1),i=this,this.render(),e&&(this.$el.addClass(e),this.$el.find(".hide_manage_buttons").removeClass("hide_manage_buttons")),this.$el.modal({allowMultiple:!0,onVisible:function(){var e;if(t&&(e=u.$el.find(".card[data-key='"+t+"']"),t=!1,e.addClass("green"),1===e.length))return u.$el.find(".content").scrollTo(e,800,{offset:-50}),e.transition({animation:"tada",duration:"3s",onComplete:function(){return e.removeClass("green")}})},onHidden:function(){if("function"==typeof i.hideCallbackFn&&i.hideCallbackFn(u.model,u,l),l&&(l=!1),i.remove(),u===(i=null))return u=null}}),n=this.$el.find(".ui.cards"),this.model.getAllAttachObjects((function(e,t){return t&&0!==t.length?t.forEach((function(e){return i.renderAttachment(n,e.key,e.objectUrl)})):i._setBlankHtml()})),this.$el.modal("show")},n}(s),n.exports=r}}),window.requirejs.define({"views/file_browser/file_browser_page_nav_view":function(e,t,n){var i,r,o,a,s,l,c,u,d,p,f,h,m,v,g,w=function(e,t){return function(){return e.apply(t,arguments)}},y={}.hasOwnProperty;t("../../models/file_collection"),r=t("../../constant"),t("../../lib/utils"),t("../../lib/utils_leader_line"),i=t("../../application"),c=t("../../lib/notifier"),u=t("../../lib/pouchdb_index_view_manager"),p=t("../view"),d=t("../tags_map_window_view"),l=t("../link_map_window_view"),o=t("../decision_map_window_view"),s=t("./file_browser_quick_filter_view"),g=t("./templates/file_browser_page_nav"),f=function(e,t,n){var i,r;return null==n&&(n=!0),r=e,i=function(e){return r.$dimmer.dimmer("hide"),c.showMessage("\u52a0\u8f7d\u5217\u8868\u51fa\u9519"+e,6e3,"error"),r.setIsSearching(!1)},t=_.unique(t),r.fileCollection.fetch({fetch:"allDocs",update:!0,remove:n,silent:!0,options:{allDocs:{keys:t,include_docs:!0,conflicts:!0}},success:function(){return r.fileCollection.sort(),r.addAll(),r.$dimmer.dimmer("hide"),r.$el.trigger("pageFetched"),r.setIsSearching(!1)},error:i})},m=function(e,t,n,i){return t?(t=t.slice(),"asc"===n&&t.reverse(),void i(null,t)):u.getTitleView(e,(function(r,o){var a,s;return o?(s=o.viewName,a={reduce:!1,group:!1},e.query(s+"/by_title",a).then((function(e){return e.rows.length>0?(t=e.rows.sort((function(e,t){return e.key.localeCompare(t.key,"en-u-kn-true")})).map((function(e){return e.id})),"asc"===n&&t.reverse(),void i(null,t)):i()})).catch((function(){return i()}))):i()}))},h=function(e,t,n,i){return t?(t=t.slice(),"asc"===n&&t.reverse(),void i(null,t)):u.getDateView(e,(function(r,o){var a,s;return o?(s=o.viewName,a={reduce:!1,group:!1},e.query(s+"/by_create_date",a).then((function(e){return e.rows.length>0?(t=e.rows.map((function(e){return e.id})),"asc"===n&&t.reverse(),void i(null,t)):i()})).catch((function(){return i()}))):i()}))},v=function(e,t,n,i){var r;return t?(t=t.slice(),"asc"===n&&t.reverse(),void i(null,t)):("query_index/by_updatedate",r={reduce:!1,group:!1},e.query("query_index/by_updatedate",r).then((function(e){return e.rows.length>0?(t=e.rows.map((function(e){return e.id})),"asc"===n&&t.reverse(),void i(null,t)):i()})).catch((function(){return i()})))},a=function(e){var t;function n(){return this.sortFileSelected=w(this.sortFileSelected,this),n.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)y.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(n,e),n.prototype.fileBrowserView=null,n.prototype.className="file_browser_page_nav_container animation_icon_tips_container",n.prototype.template=g,n.prototype.currentPage=0,n.prototype.perpage=30,n.prototype.quickFilterView=null,n.prototype.allFileIds=[],n.prototype.titleSortIds=null,n.prototype.createDateSortIds=null,n.prototype.updateDateSortIds=null,t=function(e){var t;return(t=new s({pageNavView:e})).render(),t},n.prototype.initialize=function(e){return this.fileBrowserView=e.fileBrowserView},n.prototype.events={"click .first_page_button":"firstPageFn","click .prev_page_button":"prevPageFn","click .next_page_button":"nextPageFn","click .last_page_button":"lastPageFn","click .page_info_button .menu .item":"gotoPageFn","click .sort_button":"sortFileSelected","click .display_button":"displayTypeSelected","click .tags_map_window_button":"showTagsMapWindowFn","click .link_map_window_button":"showLinkMapWindowFn","click .decision_map_window_button":"showDecisionMapWindowFn"},n.prototype.displayTypeSelected=function(e){var t,n,r;return this,n=i.getApplicationProfileModel(),"default"!==(r=(t=$(e.currentTarget)).data("display_type"))&&"abundant"!==r&&"simple"!==r&&(r="default"),this.$el.find(".display_info_buttons").find(".active").removeClass("active"),t.addClass("active"),n.set({filesDisplayType:r})},n.prototype.sortFileSelected=function(e){var t,n,r,o,a,s,l;return this,a=(o=i.getApplicationProfileModel()).get("filesSort")||{},a=Object.assign({},a),l=(n=$(e.currentTarget)).data("sort_type"),s=n.data("sort_by"),(t=this.$el.find(".sort_info_buttons")).find(".active>i").remove(),t.find(".active").data("sort_by","").removeClass("active"),n.addClass("active"),"by_default"===l?(n.data("sort_by",""),n.append('<i class="circle icon"></i>'),a.sortType="by_default",a.sortBy=""):(a.sortType=l,s&&"asc"!==s?(a.sortBy="asc",n.data("sort_by","asc"),n.append('<i class="long arrow up icon"></i>')):(a.sortBy="desc",n.data("sort_by","desc"),n.append('<i class="long arrow down icon"></i>'))),o.set({filesSort:a}),o.save(),(r=this.fileBrowserView.getQueryInfo())?this.fileBrowserView.searchFile(r.query):this.fileBrowserView.refreshFilterFiles()},n.prototype.showDecisionMapWindowFn=function(e){var t;if(e.preventDefault(),e.stopPropagation(),!(t=$(e.currentTarget)).hasClass("loading"))return t.addClass("loading"),r.pouchDB.allDocs({include_docs:!0,keys:this.allFileIds}).then((function(e){var n;return t.removeClass("loading"),n=e.rows.map((function(e){return e.doc})),new o({initDocs:n}).show()}))},n.prototype.showTagsMapWindowFn=function(e){return e.preventDefault(),e.stopPropagation(),new d({usedDocIds:this.allFileIds}).show()},n.prototype.showLinkMapWindowFn=function(e){var t;if(e.preventDefault(),e.stopPropagation(),!(t=$(e.currentTarget)).hasClass("loading"))return t.addClass("loading"),r.pouchDB.allDocs({include_docs:!0,keys:this.allFileIds}).then((function(e){var n,r,o;return t.removeClass("loading"),(o=e.rows.map((function(e){return e.doc}))).sort((function(e,t){return e.createDate-t.createDate})),n=i.homeView.editorView,r=i.homeView.editorView.getActiveEditorProxy().fileModel,new l({fileModel:r,editorView:n,initDocs:o}).show()}))},n.prototype.prevPageFn=function(){return this.currentPage-=1,this.currentPage<0&&(this.currentPage=0),this.fetchFiles()},n.prototype.nextPageFn=function(){var e;return this.currentPage+=1,e=Math.ceil(this.allFileIds.length/this.perpage)-1,this.currentPage>e&&(this.currentPage=e),this.fetchFiles()},n.prototype.firstPageFn=function(){return this.currentPage=0,this.fetchFiles()},n.prototype.hasPrevPage=function(){return 0!==this.currentPage},n.prototype.hasNextPage=function(){return this.currentPage*this.perpage+this.perpage<this.allFileIds.length},n.prototype.lastPageFn=function(){return this.currentPage=Math.ceil(this.allFileIds.length/this.perpage)-1,this.fetchFiles()},n.prototype.gotoPageFn=function(e){var t,n,i;return t=$(e.currentTarget),n=Math.ceil(this.allFileIds.length/this.perpage)-1,(i=parseInt(t.data("value"))||0)<0&&(i=0),i>n&&(i=n),this.currentPage=i,this.fetchFiles()},n.prototype.afterRender=function(){var e,n,r,o,a;if(a=this,(r=this.$el.find(".page_info_button")).dropdown({onShow:function(){var e,t,n;return e=r.find(".menu"),!((t=Math.ceil(a.allFileIds.length/a.perpage))<=0)&&(e.empty(),function(){n=[];for(var e=0;0<=t?e<t:e>t;0<=t?e++:e--)n.push(e);return n}.apply(this).forEach((function(t){return e.append('<div class="item '+(a.currentPage===t?"active":void 0)+'" data-value="'+t+'">'+(t+1)+"</div>")})),!0)}}),(n=this.$el.find(".display_info_buttons")).dropdown({action:"nothing",onShow:function(){var e;return n.find(".active").removeClass("active"),"default"!==(e=i.getApplicationProfileModel().get("filesDisplayType"))&&"abundant"!==e&&"simple"!==e&&(e="default"),n.find(".display_"+e+"_button").addClass("active")}}),(o=this.$el.find(".sort_info_buttons")).dropdown({action:"nothing",onShow:function(){var e,t,n,r;return o.find(".active>i").remove(),o.find(".active").removeClass("active"),(t=i.getApplicationProfileModel().get("filesSort"))?(r=t.sortType||"by_default",n=t.sortBy||"desc"):(r="by_default",n="desc"),(e=o.find("."+r+"_button")).addClass("active"),"by_default"===r?e.append('<i class="circle icon"></i>'):"asc"===n?e.append('<i class="long arrow up icon"></i>'):e.append('<i class="long arrow down icon"></i>')}}),this.quickFilterView=t(this),this.fileBrowserView.storeView.$el.find(">.content").append(this.$el),this.fileBrowserView.$el.append(this.quickFilterView.$el),e=this.$el.find(".analysis_buttons"),!DOCKER_VERSION&&!GITHUB_PAGE_WEB)return e.dropdown({action:"nothing"});e.remove()},n.prototype.fetchFiles=function(e){var t,n,i,r;return null==e&&(e=!0),this.fileBrowserView.$dimmer.dimmer("show"),n=(r=this.currentPage*this.perpage)+this.perpage,i=this.allFileIds.slice(r,n),f(this.fileBrowserView,i,e),this.allFileIds.length<this.perpage?this.$el.addClass("empty_pages"):this.$el.removeClass("empty_pages"),(t=this.$el.find(".page_statics_info")).html("\u6587\u7ae0\u603b\u6570:"+this.allFileIds.length),t.attr("title","\u6587\u7ae0\u603b\u6570:"+this.allFileIds.length),this.$el.find(".page_button").removeClass("disabled"),this.$el.find(".current_page").html(this.currentPage+1),0===this.currentPage&&this.$el.find(".first_page_button, .prev_page_button").addClass("disabled"),n>=this.allFileIds.length&&this.$el.find(".last_page_button, .next_page_button").addClass("disabled"),this.$el.trigger("page",{allFileIds:this.allFileIds.slice(),currentPage:this.currentPage,perpage:this.perpage,fileIds:i.slice()})},n.prototype.addFile=function(e){if(this.allFileIds.indexOf(e)<0)return this.allFileIds.push(e)},n.prototype.removeFile=function(e){var t;return t=this.allFileIds.indexOf(e),this.allFileIds.splice(t,1)},n.prototype.resetFiles=function(){return this.allFileIds=[],this.currentPage=0,this.titleSortIds=null,this.createDateSortIds=null,this.updateDateSortIds=null},n.prototype.initFiles=function(e,t){var n,o,a,s,l;return s=this,o=r.pouchDB,n=i.getApplicationProfileModel(),a=n.get("filesSort")||{sortType:"by_default"},function(e){switch(a.sortType){case"by_create_date":return h(o,s.createDateSortIds,a.sortBy,e);case"by_update_date":return v(o,s.updateDateSortIds,a.sortBy,e);case"by_title":return m(o,s.titleSortIds,a.sortBy,e);default:return e()}}((l=this,function(n,i){var r,o;return r=_.map(e,(function(e){return e.id})),o=l.fileBrowserView.upFiles,i&&i.length>0&&r.sort((function(e,t){return i.indexOf(t)-i.indexOf(e)})),r.sort((function(e,t){return o.indexOf(t)-o.indexOf(e)})),l.quickFilterView.initFiles(r,t)}))},n.prototype.showFiles=function(e,t){return this.allFileIds=e,this.fileBrowserView.fileCollection.allFileIds=e,this.currentPage=0,this.$el.find(".total_page").html(Math.ceil(this.allFileIds.length/this.perpage)),this.fetchFiles(t)},n}(p),n.exports=a}}),window.requirejs.define({"views/file_browser/file_browser_quick_filter_view":function(e,t,n){var i,r,o,a,s,l,c={}.hasOwnProperty;a=t("../view"),s=t("../../lib/utils_vip"),i=t("../../constant"),o=t("../../lib/pouchdb_index_view_manager"),l=t("./templates/file_browser_quick_filter"),r=function(e){var t,n,r,a,u,d,p,f,h,m,v,g,w,y,b;function x(){return x.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)c.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(x,e),x.prototype.pageNavView=null,x.prototype.className="file_browser_quick_filter_container",x.prototype.template=l,t=[],u=[],b=[],r=[],n=[],a=null,f=function(e){var t;return t=i.pouchDB,o.getCategoryAndFlagView(t,(function(n,i){return n?(console.error(n),e()):(i.viewName,t.query("query_index/by_tagNames",{reduce:!0,group:!0}).then((function(t){var n;return n=t.rows,(n=_.sortBy(n,"value")).reverse(),b=n,e(null,n)})).catch((function(t){return console.error(t),e()})))}))},p=function(e){var t;return t=i.pouchDB,o.getDateView(t,(function(n,i){var o;return n?(console.error(n),e()):(o=i.viewName,t.query(o+"/by_create_date",{reduce:!0,group:!0,group_level:3}).then((function(t){var n;return n=t.rows,r=n,e(null,n)})).catch((function(t){return console.error(t),e()})))}))},d=function(e){var t;return t=i.pouchDB,o.getColorView(t,(function(i,r){var o;return i?(console.error(i),e()):(o=r.viewName,t.query(o+"/by_color",{reduce:!0,group:!0}).then((function(t){var i;return i=t.rows,n=i,e(null,i)})).catch((function(t){return console.error(t),e()})))}))},m=function(e,t){return e.filter((function(e){return t.includes(e)}))},h=function(e){var n;return n={},e.forEach((function(e){var i;if((i=m(t,e.ids)).length>0)return n[e.key]=i})),n},v=!1,w={colors:{},tags:{},createDates:{}},y="count",g={colors:[],tags:[],createDates:[]},x.prototype.initialize=function(e){var t;return this.pageNavView=e.pageNavView,t=this,a=_.debounce((function(e){return t.searchTags(e)}),600,!1)},x.prototype.events={"click .suggestion_tag_btn":"toggleSuggestionTagFn","click .suggestion_color_btn":"toggleSuggestionColorFn","click .suggestion_create_date_btn":"toggleSuggestionCreateDateFn","click .reset_suggestion_btn":"resetSuggestionFn","click .sortby_btn":"sortByFn","click .close_search_input_wrapper":"closeSearchPanel","click .search_btn":"openSearchPanel","keyup .search_input":"instanceFilterResultFn"},x.prototype.instanceFilterResultFn=function(e){var t;return t=$(e.currentTarget).val(),a(t)},x.prototype.sortByFn=function(e){var t,n;if(n=(t=$(e.currentTarget)).data("type"),y!==n)return y=n,this.$el.find(".sortby_btn").removeClass("active"),t.addClass("active"),this.searchTags("")},x.prototype.resetSuggestionFn=function(e){return this.resetQuickFilter(),this.refreshFiles(!0)},x.prototype.toggleSuggestionCreateDateFn=function(e){var t,n,i;return n=(t=$(e.currentTarget)).data("key"),(i=g.createDates.indexOf(n))>=0?(g.createDates.splice(i,1),t.removeClass("active")):(g.createDates.push(n),t.addClass("active")),this.refreshFiles(!0)},x.prototype.toggleSuggestionColorFn=function(e){var t,n,i;return n=(t=$(e.currentTarget)).data("key"),(i=g.colors.indexOf(n))>=0?(g.colors.splice(i,1),t.removeClass("active")):(g.colors.push(n),t.addClass("active")),this.refreshFiles(!0)},x.prototype.toggleSuggestionTagFn=function(e){var t,n,i;return n=(t=$(e.currentTarget)).data("key"),(i=g.tags.indexOf(n))>=0?(g.tags.splice(i,1),t.removeClass("active")):(g.tags.push(n),t.addClass("active")),this.refreshFiles(!0)},x.prototype.renderQuickFilterInfo=function(){var e,t,n,i;if(g.colors.length>0||g.tags.length>0||g.createDates.length>0){for(e in n=["\u4e8c\u6b21\u8fc7\u6ee4\u540e\uff0c\n\u603b\u5171\u6709 ("+u.length+") \u7bc7\u6587\u7ae0\uff0c\u8fc7\u6ee4\u89c4\u5219:"],g)(i=g[e])&&i.length>0&&n.push(e+": "+i.join(" \u6216 "));return t=_.escape(n.join("\n")),this.$el.find(".suggestion_info_container").html("<i class='info circle icon link big reset_suggestion_btn' title='"+t+"'></i>")}return this.$el.find(".suggestion_info_container").empty(),this.$el.find(".active").removeClass("active")},x.prototype.refreshFiles=function(e){return u=[],g.colors.length>0||g.tags.length>0||g.createDates.length>0?(t.forEach((function(e){var t,n;for(t in g)if(n=g[t],w[t]&&n.find((function(n){return!!w[t][n]&&w[t][n].indexOf(e)>=0})))return void u.push(e)})),this.pageNavView.showFiles(u,e)):(u=t,this.pageNavView.showFiles(u,e)),this.renderQuickFilterInfo()},x.prototype.renderSuggestionColors=function(){var e,t,r,o,a,s,l;for(r in s=h(n),w.colors=s,o=[],l=i.systemColors.map((function(e){return"var(--"+e+")"})),s)t=s[r],l.indexOf(r)<0&&o.push({key:r,ids:t});return o.sort((function(e,t){return e.ids.length-t.ids.length>0?-1:1})),a=(o=o.slice(0,8)).map((function(e){var t,n;return n="\u5171("+(t=e.ids.length)+")\u7bc7\u6587\u7ae0",t>99&&(t="99+"),'<a class="ui label colored_label user_colored_label suggestion_color_btn" title="'+n+'" data-key="'+_.escape(e.key)+'" style="--labelColor: '+_.escape(e.key)+'">'+t+"</a>"})),e='<div class="suggestion_container">\n  <div class="ui mini circular labels suggestion_colors_container">\n  '+l.map((function(e){var n,i;return n="",i="\u8be5\u989c\u8272\u8fd8\u6ca1\u6709\u76f8\u5173\u6587\u7ae0",(t=s[e])&&(i="\u5171("+(n=t.length)+")\u7bc7\u6587\u7ae0",n>99&&(n="99+")),'<a class="ui label colored_label system_colored_label suggestion_color_btn" title="'+i+'" data-key="'+_.escape(e)+'" style="--labelColor: '+_.escape(e)+'">'+n+"</a>"})).join("")+"\n  "+a.join("")+'\n  </div>\n  <div class="suggestion_control_container">\n    <div class="ui icon input search_input_wrapper fluid">\n      <i class="circle remove icon link close_search_input_wrapper" title="\u5173\u95ed\u67e5\u8be2"></i>\n        <input type="text" placeholder="\u8fc7\u6ee4..." class="search_input">\n        <i class="circular search link icon search_tags"></i>\n    </div>\n    <div class="ui buttons suggestion_control_btns_container">\n      <div class="ui button icon sortby_btn" data-type="tagname" title="\u6309\u6807\u7b7e\u540d\u79f0\u6392\u5e8f">\n        <i class="sort alphabet down icon"/>\n      </div>\n      <div class="ui button icon sortby_btn active" data-type="count" title="\u6309\u6807\u7b7e\u4e0b\u6587\u7ae0\u6570\u6392\u5e8f"> <i class="sort numeric down icon"/>\n      </div>\n      <div class="ui button icon search_btn" title="\u641c\u7d22\u6807\u7b7e"> <i class="filter icon"/>\n      </div>\n    </div>\n  </div>\n  <div class="suggestion_info_container">\n  </div>\n</div>',this.$el.append(e),this.$el.find(".search_input_wrapper").hide()},x.prototype.openSearchPanel=function(){return this.$el.find(".search_input_wrapper").show(),this.$el.find(".suggestion_control_btns_container").hide()},x.prototype.closeSearchPanel=function(){return this.$el.find(".search_input_wrapper").hide(),this.$el.find(".suggestion_control_btns_container").show(),this.searchTags(""),this.$el.find(".search_input_wrapper .search_input")},x.prototype.searchTags=function(e){var t,n,i,r,o,a,s;for(r in null==e&&(e=""),n=[],o=w.tags)i=o[r],n.push({key:r,ids:i});return e&&(s=n.map((function(e){return{key:e.key,name:e.key,value:e.key,ids:e.ids,count:e.ids.length,score:e.ids.length}})),(t=new FilteredList(s)).setFilter(e),n=t.filtered.map((function(e){return{key:e.key,ids:e.ids}}))),a=this.generateSuggestionTagItems(n),this.$el.find(".suggestion_tags_container").html(""+a.join(""))},x.prototype.generateSuggestionTagItems=function(e){var t,n;return n=n||y,t=e.slice(),"tagname"===n?t.sort((function(e,t){return e.key.localeCompare(t.key,"en-u-kn-true")>0?-1:1})):t.sort((function(e,t){return e.ids.length-t.ids.length>0?-1:1})),(t=t.slice(0,200)).map((function(e){var t,n,i;return i="("+(t=e.ids.length)+"\u7bc7)"+(n=_.escape(e.key)),t>99&&(t="99+"),'<a class="ui label suggestion_tag_btn" title="'+i+'" data-key="'+n+'">\n  <span class="suggestion_tag_content">'+n+"</span>("+t+")</a>"}))},x.prototype.renderSuggestionTags=function(){var e,t,n,i,r;for(n in i=h(b),w.tags=i,e=[],i)t=i[n],e.push({key:n,ids:t});return r='<div class="suggestion_tags_container ui small tag labels">\n'+this.generateSuggestionTagItems(e).join("")+"\n</div>",this.$el.append(r)},x.prototype.renderSuggestionCreateDates=function(){var e,t,n,i,o;for(t in i=h(r),w.createDates=i,n=[],i)e=i[t],n.push({key:t,ids:e});return n.sort((function(e,t){return e.ids.length-t.ids.length>0?-1:1})),o='<div class="suggestion_tags_container ui mini tag labels">\n'+(n=n.slice(0,20)).map((function(e){var t;return(t=e.ids.length)>99&&(t="99+"),'<a class="ui label suggestion_tag_btn" data-key="'+_.escape(e.key)+'">'+_.escape(e.key)+"("+t+")</a>"})).join("")+"\n</div>",this.$el.append(o)},x.prototype.resetQuickFilter=function(){return g={colors:[],tags:[],createDates:[]}},x.prototype.initFiles=function(e,n){var i;return t=e.slice(),u=t,i=this,this.$el.empty(),s.isClientVip()&&t.length>20&&(this.$el.html('<span><i class="spinner loading icon"></i>\u4e8c\u6b21\u8fc7\u6ee4\u7d22\u5f15\u4e2d...</span>'),v||(v=!0,async.parallel([f,p,d],(function(){return v=!1,i.$el.empty(),i.renderSuggestionTags(),i.renderSuggestionColors()})))),this.resetQuickFilter(),this.refreshFiles(n)},x}(a),n.exports=r}}),window.requirejs.define({"views/file_browser/file_browser_system_file_item_view":function(e,t,n){var i,r,o,a,s,l,c,u,d=function(e,t){return function(){return e.apply(t,arguments)}},p={}.hasOwnProperty;l=t("../view"),r=t("../file_attachments_manager_view"),a=t("../file_info_manager_view"),i=t("../../application"),s=t("../../lib/utils"),t("../../constant"),u=t("./templates/file_browser_system_file_item"),c=null,o=function(e){var t;function n(){return this.changeFile=d(this.changeFile,this),this.deleteFile=d(this.deleteFile,this),this.archiveFile=d(this.archiveFile,this),this.fileAttachmentsManager=d(this.fileAttachmentsManager,this),this.changeFileInfo=d(this.changeFileInfo,this),n.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)p.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(n,e),n.prototype.className="item droppable_file_item ",n.prototype.template=u,n.prototype.filterInfo=null,n.prototype.staticsInfo=null,n.prototype.queryTerms=null,t=function(e,t){var n,i,r,o,a,s;switch(null==t&&(t={}),r=!1,t.filterType){case"tag":a=t.filterValue.split(","),o=e.get("tagNames")||[],r=_.every(a,(function(e){return _.contains(o,e)}));break;case"category":s=!1,0===(n=t.filterValue).indexOf("xsjStartsWith##")&&(s=!0,n=n.substring("xsjStartsWith##".length)),n=n.replace(/^\/*|\/*$/g,""),s?r=(e.get("category")||"").indexOf(n)>=0:(i=[n,"/"+n,n+"/","/"+n+"/"],r=_.contains(i,e.get("category")));break;case"flag":r=t.filterValue===e.get("flag");break;default:r=!0}return r},n.prototype.initialize=function(e){var t,n,r,o,a,s;return t=this,this.fileBrowserView=e.fileBrowserView,this.filterInfo=e.filterInfo,this.staticsInfo=e.staticsInfo,this.queryTerms=e.queryTerms,this.model.bind("change:title",this.refreshTitle,this),a=_.debounce((function(){return t.renderItem()}),500),this.model.bind("change:tagNames",a,this),this.model.bind("change:category",a,this),this.model.bind("change:createDate",a,this),this.model.bind("change:updateDate",a,this),this.model.bind("change:isArchived",a,this),o=_.debounce((function(){return t.refreshEmoji()}),500),this.model.bind("change:emoji",o,this),r=_.debounce((function(){return t.refreshColor()}),500),this.model.bind("change:color",r,this),this.model.bind("change:pluginName",this.renderPluginInfo,this),s=_.debounce(this.refreshStatus,500),this.model.bind("change:contentUpdateDate",s,this),this.model.bind("change:_rev",this.refreshSyncStatus,this),this.model.bind("change:up",this.refreshUpStatus,this),this.model.bind("syncDelayRemove",this.syncDelayRemove,this),this.model.bind("clientLocalDiskChange",s,this),n=i.getApplicationProfileModel(),this.listenTo(n,"change:filesDisplayType",(function(){return t.renderItem()}))},n.prototype.renderItem=function(){var e,n;switch(n=i.getApplicationProfileModel().get("filesDisplayType")||"default",e=this.$el.find(".file_info_title"),t(this.model,this.filterInfo)?e.removeClass("not_in_filter"):e.addClass("not_in_filter"),this.$el.find(">.content>.description").remove(),this.refreshTaskInfo(),n){case"abundant":return this.renderAbundant();case"simple":return this.renderSimple()}},n.prototype.events={"click .delete_file":"deleteFile","click .archive_file":"archiveFile","click .file_info_task":"openTaskWindowFn",click:"changeFile",mouseenter:"enterFileFn",mouseleave:"leaveFileFn"},n.prototype.syncDelayRemove=function(e){var t,n,i,r,o;if(t=this,r=e.isDeleted,i=e.isArchived,n="item_sync_delay_remove",r?n+=" item_sync_delay_delete":i&&(n+=" item_sync_delay_archive",(this.filterInfo||this.queryTerms)&&(n="")),n)return this.$el.find(">.content").one($.support.transition.end,(function(){var e,n;if(t&&(null!=(e=t.model.collection)&&e.remove(t.model),t=null,n))return clearTimeout(n),null})),o=setTimeout((function(){var e;if(t)return null!=(e=t.model.collection)&&e.remove(t.model),t=null,clearTimeout(o),o=null}),2e3),this.$el.addClass(n)},n.prototype.renderSimple=function(){var e,t,n,i;return e=this.$el.find(".file_info_title"),i=(n=moment(this.model.get("updateDate")||new Date).toDate()).toISOString(),t='<i class="clock outline icon"></i> '+moment(this.model.get("createDate")).format("YYYY\u5e74MM\u6708DD\u65e5")+'/<time class="file_item_update_date" datetime="'+i+'">'+$.timeago(n)+"</time>",e.parent().append('<small class="description">'+t+"</small>"),e.parent().find(".file_item_update_date").timeago()},n.prototype.renderAbundant=function(){var e,t,n,i,r,o,a;return e=this.$el.find(".file_info_title"),a=(o=moment(this.model.get("updateDate")||new Date).toDate()).toISOString(),r='<i class="clock outline icon"></i> '+moment(this.model.get("createDate")).format("YYYY\u5e74MM\u6708DD\u65e5")+'/<time class="file_item_update_date" datetime="'+a+'">'+$.timeago(o)+"</time>",t="",this.model.get("category"),n="",(i=this.model.get("tagNames"))&&(n="<br/>"+_.escape(i.map((function(e){return"#"+e})).join(","))),e.parent().append('<small class="description">'+r+t+n+"</small>"),e.parent().find(".file_item_update_date").timeago()},n.prototype.refreshTitle=function(){var e;return(e=this.$el.find(".file_info_title")).text(this.model.get("title")),e.attr("title",this.model.get("title"))},n.prototype.refreshTaskInfo=function(){var e,t,n;if(this.$el.find(">.content>.file_info_task").remove(),!this.model.get("isArchived"))return e=this.$el.find(".file_info_title"),n=this.model.get("content"),(t=this.$el).data("taskInfo",null),requestAnimationFrame((function(){var i,r,o;if((r=s.getTaskInfo(n))&&r.tasks.length>0&&(o=0,i=0,r.tasks.map((function(e){if(!e.isNormal&&(o++,e.checked))return i++})),o&&o!==i))return t.data("taskInfo",r),t.find(">.content>.file_info_task").remove(),e.parent().prepend('<div class="file_info_task">'+i+"/"+o+"</div>")}))},n.prototype.refreshUpStatus=function(){return!!this.model.get("up")?this.$el.addClass("up_file_item"):this.$el.removeClass("up_file_item")},n.prototype.refreshColor=function(){var e;return(e=this.model.get("color"))?this.el.style.setProperty("--articleColor",e):this.el.style.removeProperty("--articleColor")},n.prototype.refreshEmoji=function(){var e,t;return t=this.model.get("emoji"),e=this.$el.find(".file_info_icon"),t?(e.html(t),e.addClass("file_emoji")):(e.removeClass("file_emoji"),e.html(""))},n.prototype.refreshStatus=function(){var e,t,n,r,o,a,s,l,c,u,d;return a=i.getFileLocalCollection().get(this.model.id),s="",o="",t=this.model.get("content"),a&&(s=a.get("fullPath")||"",o=a.get("diskContent")||""),u=i.getCurrentStorePluginModel(),e=this.$el.find(".file_info_icon"),s&&t!==o?e.hasClass("unsync")?void 0:e.addClass("unsync"):u?(r=u.get("name"),c=this.model.get("pluginName"),d=this.model.get("syncDate"),n=this.model.get("contentUpdateDate"),l=this.model.get("guid"),c&&c===r?l?d&&n&&n!==d?e.addClass("unsync"):e.removeClass("unsync new_file_unsync"):e.addClass("new_file_unsync"):e.removeClass("unsync new_file_unsync")):(e=this.$el.find(".file_info_icon")).removeClass("unsync new_file_unsync")},n.prototype.renderPluginInfo=function(){var e,t,n,r,o,a;return n="",(t=i.getFileLocalCollection().get(this.model.id))&&(n=t.get("fullPath")||""),a=this.model.get("pluginName"),o=i.plugins[a],r=(e=this.$el.find(".file_info_icon")).hasClass("unsync"),e.removeClass(),e.addClass("icon file_info_icon"),r&&e.addClass("unsync"),o||n?o?e.addClass(o.icon):e.addClass("hdd outline"):e.addClass("file text outline alternate")},n.prototype.getRenderData=function(){var e,t,n,i,r,o;if(r=this.model.get("tagNames"),n="",this.fileBrowserView.isSelectedFileModel(this.model)&&(n="selected_file_item"),o=this.model.get("title"),this.staticsInfo&&this.staticsInfo.content){for(e in i=0,t=this.staticsInfo.content)i+=t[e];i&&(o=o+"("+i+")")}return{title:o,tagNames:r,selectedClass:n,upClass:"up_file_item"}},n.prototype.refreshSyncStatus=function(){var e,t;if(this.model.collection&&(e=this.model.collection.changedFileModels||[],t=this.model.get("_id"),e.indexOf(t)>=0&&this.fileBrowserView.fileModel!==this.model))return this.$el.find(">.content").addClass("sync_changed")},n.prototype.afterRender=function(){return this.$el.attr("id",this.model.cid),this.$el.attr("data-value",this.model.cid),this.fileBrowserView.fileModel&&this.fileBrowserView.fileModel.cid===this.model.cid&&this.$el.addClass("active"),(this.filterInfo||this.queryTerms||this.model.get("isArchived"))&&this.$el.find(".archive_file").remove(),this.renderPluginInfo(),this.refreshStatus(),this.refreshEmoji(),this.refreshColor(),this.renderItem(),this.refreshSyncStatus(),this.refreshUpStatus(),this,this.initDraggable()},n.prototype.initDraggable=function(){var e;return e=this,this.$el.draggable({connectToSortable:".sortable_file_tabs_area",scroll:!1,cursor:"move",addClasses:!1,appendTo:"body",start:function(){return setTimeout((function(){return $(".sortable_file_tabs_area").sortable("refreshPositions")}),1e3)},stop:function(){return $("body").removeClass("iframe_dimmer xsj_dragging_item")},helper:function(t,n){var i,r;return $(".dragging_file_item").remove(),$("body").addClass("iframe_dimmer xsj_dragging_item"),r=e.model.get("title"),(i=$('<div class="dragging_file_item droppable_file_item">'+_.escape(r)+"</div>")).data("itemInfo",{id:"file_"+e.model.id,type:"file",activeFile:e.model.id,title:r,emoji:e.model.get("emoji")}),i},delay:150,revert:"invalid",distance:5,zIndex:1e4})},n.prototype.changeFileInfo=function(e){return e.stopPropagation(),e.preventDefault(),new a({model:this.model}).show()},n.prototype.fileAttachmentsManager=function(e){return e.stopPropagation(),e.preventDefault(),new r({model:this.model}).show()},n.prototype.archiveFile=function(e){var t,n,i,r;return e.stopPropagation(),e.preventDefault(),this,r=$(e.currentTarget).offset(),i=(t=$(".main_filter_button")).offset(),(n=$("<i class='xsj_flyer icon suitcase'></i>")).fly({start:{left:r.left,top:r.top},end:{left:i.left,top:i.top},onEnd:function(){return t.transition("clear queue").transition("pulse"),n.remove(),n=null,t=null}}),this.model.archive()},n.prototype.openTaskWindowFn=function(e){var t;return t=$(e.currentTarget)[0].getBoundingClientRect(),$(window).trigger("showTaskListWindow",[{pos:{left:t.right,top:t.top},model:this.model}])},n.prototype.deleteFile=function(e){return this,e.stopPropagation(),e.preventDefault(),this.model.moveToTrash()},n.prototype.changeFile=function(e){var t,n,r,o,a,s,l,u,d,p,f,h,m,v,g,_;if(e.stopPropagation(),e.preventDefault(),this,o=this.fileBrowserView.fileModel||{},e.ctrlKey)d=this.fileBrowserView.el.getBoundingClientRect(),$(window).trigger("createNewEditor",[this.model,{position:{left:d.right+200,top:d.top+100},groupId:c,callback:function(e,t){var n;if(c=e.id,n=t.$el.find(".popup_editor_file_tabs .file_item.droppable_file_item.active")[0])return appHighlightPosByEl(n)}}]);else if(e.shiftKey)this.fileBrowserView.toggleSelectedFileModel(this.model)?this.$el.addClass("selected_file_item"):this.$el.removeClass("selected_file_item");else{if(a=null,(h=this.$el.data("taskInfo"))&&(_=h.tasks.filter((function(e){return!e.isNormal&&!e.checked}))).length>0&&(f=0,this.model.id===o.id&&(s=i.homeView.editorView,f=s.getCursorPosition()),(g=_.find((function(e){return e.line>f})))||(g=_[0]),a=g.line,f>0))return u=s.getValue().split("\n")[a],s.gotoLine(a,u.length-1),void((r=s.editorProxy.editor)&&r.highlightPos&&r.highlightPos({line:a,ch:0}));this.fileBrowserView.resetSelectedFileModels(),$(window).trigger("changeFileModel",[this.model,{openInActiveIf:!1,cursorPosition:a,scrollTo:!1,leaderLine:{source:this.$el}}])}if(this.$el.trigger("clickFile",{model:this.model,type:"click"}),this.model.id!==o.id&&(v=i.getTourModel(),"web"===STORY_PLATFORM&&v.canPrompt("lock_file_horizontal_tabs_learned")&&0===$(".lock_file_horizontal_tabs").length)){if(!(t=$(".lock_file_horizontal_tabs_btn")).visible())return;return l=(p=t[0].getBoundingClientRect()).x+p.width/2,m=p.y+p.height/2,n=$('<div class="spotlight_container" style="\nbackground: radial-gradient(circle at '+l+"px "+m+'px, transparent 180px, rgba(0, 0, 0, 0.4) 182px, rgba(0, 0, 0, 0.9) 900px);\n"></div>'),t.popup({on:"manual",closable:!1,position:"bottom left",onVisible:function(){var e;return t.css({outline:"3px solid var(--negativeColor)",outlineOffset:"2px",transform:"scale(2.5) rotate(-15deg)",transition:"transform 1s, outline 1s"}),$("body").append(n),(e=this).width(300),e.find(".ok").click((function(){return n.remove(),t.popup("destroy"),v.dontPrompt("lock_file_horizontal_tabs_learned"),e.remove(),t.css({outline:"",outlineOffset:"",transform:""})}))},html:'<div class="header">\u63d0\u793a</div><div class="content">\u9664\u4e86\u901a\u8fc7\u6587\u7ae0\u5217\u8868\u53ef\u4ee5\u5207\u6362\u6587\u7ae0\uff0c\u4e5f\u53ef\u4ee5\u70b9\u51fb\u8fd9\u91cc\uff0c\u6253\u5f00\u9875\u7b7e\u680f\uff0c\u5b9e\u73b0\u7c7b\u4f3c\u6d4f\u89c8\u5668\u7684\u9875\u7b7e\u64cd\u4f5c\u6548\u679c<div><a href="javascript:void(0);" class="ok pull-right">\u77e5\u9053\u4e86</a></div></div>'}).popup("show")}},n.prototype.enterFileFn=function(e){return e.preventDefault(),this,this.staticsInfo&&this.fileBrowserView.showTempSearchResultOutlineWindow(this.queryTerms,this.model.get("title"),this.model.get("content")),this.$el.trigger("enterFile",{model:this.model,type:"enter"})},n.prototype.leaveFileFn=function(e){return e.preventDefault(),this,this.fileBrowserView.hideLeaderLine(),this.fileBrowserView.hideTempSearchResultOutlineWindow(),this.$el.trigger("leaveFile",{model:this.model,type:"leave"})},n.prototype.remove=function(){return this.$el.draggable("destroy"),this.model.off(null,null,this),n.__super__.remove.call(this)},n}(l),n.exports=o}}),window.requirejs.define({"views/file_browser/file_browser_view":function(e,t,n){var i,r,o,a,s,l,c,u,d,p,f,h,m,v,g,w,y,b,x,k,D=function(e,t){return function(){return e.apply(t,arguments)}},C={}.hasOwnProperty;c=t("../../models/file_collection"),r=t("../../constant"),h=t("../../lib/utils"),u=t("../../lib/utils_leader_line"),i=t("../../application"),p=t("../../lib/notifier"),f=t("../../lib/pouchdb_index_view_manager"),m=t("../view"),d=t("../modify_file_attribute_dialog_view"),s=t("./file_browser_system_file_item_view"),a=t("./file_browser_page_nav_view"),o=t("../exports/utils"),b=t("./templates/file_browser"),y=[],w=!1,x=null,k=null,v=function(e,t){var n,i,r;for(n=0,r=e.length;n<r;n++)if((i=e[n]).$el.is(t))return i;return null},g=function(e,t){var n,i,r;for(n=0,r=e.length;n<r;n++)if((i=e[n]).model.id===t)return i;return null},l=function(e){var t,n,l,m,F,M,T;function S(){return this.addOne=D(this.addOne,this),S.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)C.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(S,e),S.prototype.className="file_browser_panel_container",S.prototype.template=b,S.prototype.storeView=null,S.prototype.pageNavView=null,S.prototype.isEmptyFiles=null,t=null,new c,S.prototype.upFiles=[],M=null,n=null,T=[],S.prototype.getQueryInfo=function(){return M},S.prototype.events={"mouseenter .file_info_task":"mouseenterFileInfoTaskFn","mouseleave .file_info_task":"mouseleaveFileInfoTaskFn","click .next_list_nav_btn":"nextPageFn","click .prev_list_nav_btn":"prevPageFn"},S.prototype.nextPageFn=function(e){return this.pageNavView.nextPageFn()},S.prototype.prevPageFn=function(){return this.pageNavView.prevPageFn()},S.prototype.mouseleaveFileInfoTaskFn=function(e){k&&(clearTimeout(k),k=null),x.hideWithInteractivity(e)},S.prototype.mouseenterFileInfoTaskFn=function(e){var n,r,o,a,s,l,c,u;k&&(clearTimeout(k),k=null),x.clearDelayTimeouts(),a=e.currentTarget,n=(r=$(a)).parentsUntil(".file-browser-panel",".file-browser-panel>.item"),o=v(y,n),(s=r.parent().parent().data("taskInfo"))&&(u=s.tasks.filter((function(e){return!e.isNormal})),c=[],u.map((function(e){return c.push('<li data-id="'+e.id+'"><div class="ui checkbox"><input class="task_input" type="checkbox" '+(e.checked?"checked":"")+'/><label class="task_input_label">'+_.escape(e.content)+"</label></div></li>")})),t=o.el,(l=document.createElement("div")).classList.add("tippy_task_container"),l.innerHTML='<i class="icon suitcase link archive_btn"title="\u5f52\u6863"></i>\n<div class="ui divider"></div>\n<ol class="tippy_task_list" >'+c.join("\n")+"</ol>",l.onclick=function(e){var t,n,r,a,l,c,u,d,p,f,h;if(e.stopPropagation(),(h=e.target).classList.contains("archive_btn"))o&&((a=o.model).archive(),h.remove());else if(d=h.classList.contains("task_input"),p=h.classList.contains("task_input_label"),(d||p)&&(l=h.parentElement.parentElement.dataset.id+"",(f=s.idTaskMaps[l])&&o))if(a=o.model,c=f.line,u=(n=a.get("content").split("\n"))[c],d&&(u=u.replace(/^([>\s]*(?:[\-\+\*]|\d+\.)\s\[)([xX\s])(\]\s.*)/,(function(e,t,n,i){return t+(/x/i.test(n)?" ":"x")+i})),n[c]=u,a.save({content:n.join("\n"),updateDate:Date.now()})),(r=i.homeView.editorView).fileModel===a){if(r.gotoLine(c,u.length-1),(t=r.editorProxy.editor)&&t.highlightPos)return t.highlightPos({line:c,ch:0})}else if(p)return $(window).trigger("changeFileModel",[a,{openInActiveIf:!1,cursorPosition:c,scrollTo:!1}])},l.onmouseenter=function(){return k&&(clearTimeout(k),k=null),x.clearDelayTimeouts()},l.onmouseleave=function(){return k&&(clearTimeout(k),k=null),x.hide()},x.setContent(l),k=setTimeout((function(){return k=null,x.show()}),600))},S.prototype.initialize=function(e){var t,n;return this.storeView=e.storeView,this.fileCollection=e.fileCollection,this.fileModel=e.fileModel,this.listenTo(this.fileCollection,"add",(n=this,function(e){var t,i;return n.addOne(e),t=n,i=function(){if(e.off("change:_id",i),e.id)return t.pageNavView.addFile(e.id)},e.id?t.pageNavView.addFile(e.id):e.on("change:_id",i)})),this.listenTo(this.fileCollection,"remove",function(e){return function(t){var n,r;return null!=(n=i.getFileLocalCollection().get(t.id))&&n.destroy(),null!=(r=g(y,t.id))&&r.remove(),y.splice(y.indexOf(r),1),r=null,e.pageNavView.removeFile(t.id),e.removeSelectedFileModel(t)}}(this)),t=this,this.listenTo(this.fileCollection,"reset",(function(){return t.addAll(),t.changeFileModel(t.fileModel)}))},S.prototype.getSelectedFileModels=function(){return T},S.prototype.isSelectedFileModel=function(e){return T.findIndex((function(t){return t.id===e.id}))>=0},S.prototype.removeSelectedFileModel=function(e){var t;if((t=T.findIndex((function(t){return t.id===e.id})))>=0)return T.splice(t,1)},S.prototype.toggleSelectedFileModel=function(e){var t;return(t=T.findIndex((function(t){return t.id===e.id})))>=0?(T.splice(t,1),!1):(T.push(e),!0)},S.prototype.resetSelectedFileModels=function(){return T.length=0,this.$el.find(".selected_file_item").removeClass("selected_file_item")},S.prototype.setIsSearching=function(e){return w=e},S.prototype.changeFileModel=function(e,t){var n,i,r,o;if(null==t&&(t={}),e&&(this.fileModel=e,r=e.cid,i=this.fileCollection.changedFileModels,o=e.get("_id"),i.indexOf(o)>=0&&(this.fileCollection.changedFileModels=_.without(i,o),this.$el.find(".file-browser-panel>.item[id="+r+"]>.content").removeClass("sync_changed")),this.$el.find(".file-browser-panel>.item.active").removeClass("active"),this.$el.find(".file-browser-panel>.item[id="+r+"]").addClass("active"),t.scrollTo)){if(n=this.$el.find(".file-browser-panel"),$("#"+r).visible())return;return n.scrollTo("#"+r,300)}},S.prototype.refreshFile=function(){return this.fileCollection.sort(),this.addAll()},S.prototype.refreshFilterFiles=function(){return this.filterFiles(n)},S.prototype.getCurrentFilterInfo=function(){return n||{filterType:"system",filterValue:"draft",id:"temp",name:"\u8349\u7a3f"}},S.prototype.filterFiles=function(e,t){var i,o,a,s,l,c,u,d,h,m,v,g,y,b,x,k,D,C,$,F,M;switch(null==t&&(t=!0),(M=this).pageNavView.resetFiles(),n=e,{type:{$eq:"markdown"},isDeleted:{$eq:!1}},u=function(e){return M.$dimmer.dimmer("hide"),p.showMessage("\u52a0\u8f7d\u5217\u8868\u51fa\u9519"+e,6e3,"error"),w=!1},D=function(e,t,n,i){return M.$dimmer.find(".ui.text").html("\u7d22\u5f15\u4e2d:"+e+" / "+t)},g=function(e,n,i){var o,a;return o=r.pouchDB,a={reduce:!1,group:!1,showUpdateProgressInfo:D},n instanceof Array&&!i?a.keys=n:a.key=n,o.query(e,a).then((function(e){var n,i;return i=[],e.rows.length>0&&(n=e.rows,(i=_.sortBy(n,(function(e){return e.value.updateDate}))).reverse()),M.pageNavView.initFiles(i,t)}))},d="default",e&&e.filterType&&(d=e.filterType),d){case"system":M.$dimmer.dimmer("show"),w=!0,l=r.pouchDB,$=C=e.filterValue;try{(C=JSON.parse(C)).type&&($=C.type)}catch(e){e,$=C}switch(x=function(e,n,i){var r,o;return null==i&&(i="create"),o={showUpdateProgressInfo:D},r=f.queryByCreateDateRange,"update"===i&&(r=f.queryByUpdateDateRange),r(l,e,n,o,(function(e,n){return e?u(e):M.pageNavView.initFiles(n,t)}))},$){case"reverse":return k=C.value,f.getReverseLinkView(l,(function(e,n){var i,r,o;return e?u(e):(o=n.viewName,r=[],k.forEach((function(e){return e=e.replace(/^\/+|\/+$/g,""),r.push(e),r.push("/"+e),r.push(e+"/"),r.push("/"+e+"/")})),i={keys:r,reduce:!1,group:!1,showUpdateProgressInfo:D},l.query(o+"/by_reverse_link",i).then((function(e){return M.pageNavView.initFiles(e.rows,t)})))}));case"up":return f.getUpView(l,(function(e,n){var i,r;return e?u(e):(r=n.viewName,i={reduce:!1,group:!1,descending:!1,showUpdateProgressInfo:D},l.query(r+"/by_up",i).then((function(e){return M.upFiles=[],e.rows.forEach((function(e){return M.upFiles.push(e.id)})),M.pageNavView.initFiles(e.rows,t)})))}));case"thirty":return c=new Date,x(moment().subtract(30,"days").toDate(),c);case"seven":return c=new Date,x(moment().subtract(7,"days").toDate(),c);case"three":return c=new Date,x(moment().subtract(3,"days").toDate(),c);case"thisWeek":case"thisWeekUpdate":return x(moment().startOf("week").toDate(),c=moment().endOf("week").toDate(),"thisWeekUpdate"===$?"update":void 0);case"lastWeek":case"lastWeekUpdate":return x(moment().subtract(1,"weeks").startOf("week").toDate(),c=moment().subtract(1,"weeks").endOf("week").toDate(),"lastWeekUpdate"===$?"update":void 0);case"thisMonth":case"thisMonthUpdate":return x(moment().subtract(1,"months").startOf("month").toDate(),c=moment().subtract(1,"months").endOf("month").toDate(),"thisMonthUpdate"===$?"update":void 0);case"lastMonth":case"lastMonthUpdate":return x(moment().startOf("month").toDate(),c=moment().endOf("month").toDate(),"lastMonthUpdate"===$?"update":void 0);case"thirtyUpdate":return c=new Date,x(moment().subtract(30,"days").toDate(),c,"update");case"sevenUpdate":return c=new Date,x(moment().subtract(7,"days").toDate(),c,"update");case"threeUpdate":return c=new Date,x(moment().subtract(3,"days").toDate(),c,"update");case"archive":return f.getDraftView(l,(function(e,n){var i,r;return e?u(e):(r=n.viewName,i={reduce:!1,group:!1,descending:!1,key:!0,showUpdateProgressInfo:D},l.query(r+"/by_draft",i).then((function(e){return M.pageNavView.initFiles(e.rows,t)})))}));case"all":return h="query_index/by_updatedate",l=r.pouchDB,y={reduce:!1,group:!1,showUpdateProgressInfo:D},l.query(h,y).then((function(e){var n,i;return i=[],e.rows.length>0&&(n=e.rows,i=_.sortBy(n,(function(e){return e.key[0]})),M.pageNavView.updateDateSortIds=i.map((function(e){return e.id})),i.reverse()),M.pageNavView.initFiles(i,t)}));default:return w=!1,this.searchFile("",t)}break;case"tag":case"unionTag":return M.$dimmer.dimmer("show"),w=!0,h="query_index/by_tagNames",b=e.filterValue.split(","),F=_.uniq(_.compact(b)).sort(),o=null,l=r.pouchDB,v=function(e,t){return l.query(h,{key:e,reduce:!1,group:!1,showUpdateProgressInfo:D}).then((function(e){var n,i;return i=e.rows,o?"unionTag"===d?i.forEach((function(e){var t;if(t=function(t){return t.id===e.id},o.findIndex(t)<0)return o.push(e)})):(n=i.map((function(e){return e.id})),o=o.filter((function(e){return n.indexOf(e.id)>-1}))):o=i,t()})).catch((function(e){return p.showMessage("\u52a0\u8f7d\u6587\u4ef6\u51fa\u9519"+e,6e3,"error"),t()}))},async.mapSeries(F,v,(function(){var e;return e=[],o.length>0&&(e=_.sortBy(o,(function(e){return e.value.updateDate}))).reverse(),M.pageNavView.initFiles(e,t)}));case"category":return M.$dimmer.dimmer("show"),w=!0,l=r.pouchDB,f.getCategoryAndFlagView(l,(function(t,n){var i;return t?u(t):(i=n.viewName,l.query(i+"/by_category",{reduce:!0,group:!0,showUpdateProgressInfo:D}).then((function(t){var n,r,o;return n=t.rows,o=[],(r=e.filterValue)instanceof Array||(r=[r]),r.slice().forEach((function(e){var t,i;return t=e.indexOf("xsjStartsWith##"),i=!1,0===t&&(i=!0,e=e.substring("xsjStartsWith##".length)),e=e.replace(/^\/*|\/*$/g,""),n.forEach((function(t){var n;if(n=t.key.replace(/^\/*|\/*$/g,""),i){if(0===n.indexOf(e))return o.push(t.key)}else if(n===e)return o.push(t.key)}))})),g(i+"/by_category",o)})).catch((function(e){return u(e)})))}));case"flag":return M.$dimmer.dimmer("show"),w=!0,l=r.pouchDB,f.getCategoryAndFlagView(l,(function(t,n){var i;return t?u(t):(i=n.viewName,g(i+"/by_flag",e.filterValue))}));case"date":return M.$dimmer.dimmer("show"),w=!0,l=r.pouchDB,a=(m=function(e){return e?moment(e).toDate():null})((s=e.filterValue.split("-"))[0]),i=m(s[1])||a,y={showUpdateProgressInfo:D},f.queryByCreateDateRange(l,a,i,y,(function(e,n){return e?u(e):M.pageNavView.initFiles(n,t)}));case"search":return M.$dimmer.dimmer("show"),w=!0,l=r.pouchDB,y={processInfoFn:function(e){var t;if(e&&"showUpdateProgressInfo"===e.processType)return t=e.result,M.$dimmer.find(".ui.text").html("\u7d22\u5f15\u4e2d:"+t.viewSeq+" / "+t.dbSeq)}},f.fullSearch(l,e.filterValue,y,(function(e,n){return M.pageNavView.initFiles(n.rows,t)}));default:return this.searchFile("",t)}},S.prototype._fullSearch=function(e,t,n){var i,o,a;return a=this,i=r.pouchDB,a.$dimmer.dimmer("show"),o={processInfoFn:function(e){var t;if(e&&"showUpdateProgressInfo"===e.processType)return t=e.result,a.$dimmer.find(".ui.text").html("\u7d22\u5f15\u4e2d:"+t.viewSeq+" / "+t.dbSeq)}},n&&n.ids&&(o.ids=n.ids),f.fullSearch(i,e,o,(function(n,i){return M={query:e,queryTerms:i.queryTerms,statics:i.rows.reduce((function(e,t){return e[t.id]=t.fieldCountInfo,e}),{})},a.pageNavView.initFiles(i.rows,t),M&&M.queryTerms&&i.rows.length>0?a.$el.one("pageFetched",(function(){var e;if(e=a.fileCollection.last())return a.showSearchResultOutlineWindow(M.queryTerms,e.get("title"),e.get("content"),e)})):a.hideSearchResultOutlineWindow()}))},S.prototype._normalSearch=function(e,t){var n,i,o,a,s,l,c;return c=this,n=r.pouchDB,a=h.parseQueryString(e),l=a.tag,o=a.q,c.$dimmer.dimmer("show"),i=function(e,t){if(!(e.type&&"markdown"!==e.type||e.isDeleted))return l&&e.tagNames&&e.tagNames.length>0&&e.tagNames.join(",").indexOf(l)>=0||o&&e.title&&e.title.indexOf(o)>=0?t(e._id):void 0},s={include_docs:!1,conflicts:!1,descending:!0,showUpdateProgressInfo:function(e,t,n,i){return c.$dimmer.find(".ui.text").html("\u7d22\u5f15\u4e2d:"+e+" / "+t)}},n.query(i,s).then((function(e){var n;return n=[],e.rows.length>0&&(n=e.rows),c.pageNavView.initFiles(n,t)}))},S.prototype.searchFile=function(e,t,i){var o,a,s,l;if(null==e&&(e=""),null==t&&(t=!0),!w)return w=!0,(l=this).pageNavView.resetFiles(),M=null,n=null,o=r.pouchDB,s=function(e,t,n,i){return l.$dimmer.find(".ui.text").html("\u7d22\u5f15\u4e2d:"+e+" / "+t)},e?this._fullSearch(e,t,i):(l.$dimmer.dimmer("show"),"query_index/by_draftupdatedate",a={include_docs:!1,conflicts:!1,descending:!0,showUpdateProgressInfo:s},void o.query("query_index/by_draftupdatedate",a).then((function(e){var n,i;return i=[],e.rows.length>0&&(n=e.rows,i=n),l.initUpFiles((function(e){return l.pageNavView.initFiles(i,t)}))})))},S.prototype.initUpFiles=function(e){var t,n;return t=r.pouchDB,this.upFiles=[],n=this.upFiles,f.getUpView(t,(function(i,r){var o,a;return i?e(i):(a=r.viewName,o={reduce:!1,group:!1,descending:!1,stale:"update_after"},t.query(a+"/by_up",o).then((function(t){return t.rows.forEach((function(e){return n.push(e.id)})),e(null,n)})))}))},S.prototype.addOne=function(e){var t,i;if(i=null,M&&M.statics[e.id]&&(i=M.statics[e.id]),t=new s({model:e,fileBrowserView:this,filterInfo:n,staticsInfo:i,queryTerms:M?M.queryTerms:null}),y.push(t),this.$el.find(".file-browser-panel").prepend(t.render().$el),this.isEmptyFiles)return this.$el.find(".list_nav_container").remove()},S.prototype.addAll=function(){for(var e;y.length>0;)null!=(e=y.pop())&&e.remove(),e=null;return this.resetSelectedFileModels(),this.fileCollection.each(this.addOne)},S.prototype.addListNav=function(){var e,t;return e=this,t=function(){var t,n,i,r;return e.isEmptyFiles=!1,e.$el.find(".list_nav_container").remove(),t=$('<div class="list_nav_container"></div>'),'<div class="ui buttons fluid list_nav_btns_container huge">\n  <div class="ui icon button prev_list_nav_btn"><i class="chevron circle left icon"></i>\u4e0a\u4e00\u9875</div>\n  <div class="ui icon button next_list_nav_btn">\u4e0b\u4e00\u9875<i class="chevron circle right icon"></i></div>\n</div>',(e.pageNavView.hasPrevPage()||e.pageNavView.hasNextPage())&&(n=$('<div class="ui buttons fluid list_nav_btns_container huge">\n  <div class="ui icon button prev_list_nav_btn"><i class="chevron circle left icon"></i>\u4e0a\u4e00\u9875</div>\n  <div class="ui icon button next_list_nav_btn">\u4e0b\u4e00\u9875<i class="chevron circle right icon"></i></div>\n</div>'),e.pageNavView.hasPrevPage()||n.find(".prev_list_nav_btn").remove(),e.pageNavView.hasNextPage()||n.find(".next_list_nav_btn").remove(),t.append(n)),r='<i class="hourglass icon huge"/>',e.pageNavView.currentPage>0&&(r='<i class="hourglass half icon huge"/>',e.pageNavView.hasNextPage()||(r='<i class="hourglass end huge icon"/>')),0===e.pageNavView.currentPage&&(r='<i class="hourglass start huge icon"/>',e.pageNavView.hasNextPage()||(r="          ")),0===e.pageNavView.allFileIds.length?(e.isEmptyFiles=!0,r='<i class="hourglass outline huge icon"/> \u6ca1\u6709\u76f8\u5173\u7684\u6587\u7ae0'):e.pageNavView.allFileIds.length>20&&(r="<div class='list_nav_info_statics_container'>\u6587\u7ae0\u603b\u6570: "+e.pageNavView.allFileIds.length+" \u7bc7</div>"+r),i='<div class="list_nav_info_container">\n  '+r+"\n</div>",t.append(i),0===e.pageNavView.allFileIds.length&&t.find(".list_nav_info_container").css("opacity",1),e.$el.find(".file-browser-panel").append(t)},this.pageNavView.$el.on("page",(function(){return t()})),t()},m=function(e,t){var n,i;return n=null,i=!1,$.contextMenu({selector:".file-browser-panel",reposition:function(e){var t;return t=(t=$(e)).parentsUntil(".file-browser-panel",".file-browser-panel>.item"),!(!n||!n.is(t))},trigger:"right",zIndex:10,events:{hide:function(){return e.find(".context_menu_selected_item").removeClass("context_menu_selected_item"),i||t.resetSelectedFileModels(),i=!1,n=null}},build:function(e,r){var a,s,l,c,u,f,h,m;if(0===(s=T.slice()).length){if((n=(n=$(r.target)).parentsUntil(".file-browser-panel",".file-browser-panel>.item")).length<=0)return!1;(l=n.data("value"))&&(f=t.fileCollection.get(l)),f&&s.push(f),n.addClass("context_menu_selected_item")}return 0!==s.length&&((h={copyAsLink:{icon:"fas fa-link",name:"\u590d\u5236\u4e3a\u94fe\u63a5",callback:function(){var e,t;return e=s.map((function(e){var t,n;return t=e.id,e.getMeta().slug||e.get("slug")||t,n="xsjapp://doc/"+t,"["+(e.get("title")||"\u672a\u547d\u540d\u6587\u4ef6")+"]("+n+")"})),t="",1===e.length?t=e[0]:(e=e.map((function(e){return"- "+e})),t=e.join("\n")),$(document).one("copy",(function(e){return e.preventDefault(),e.stopPropagation(),e.originalEvent.clipboardData.setData("text/plain",t),p.showMessage("\u590d\u5236\u94fe\u63a5\u6210\u529f")})),document.execCommand("copy")}},changeAttribute:{icon:"fas fa-sliders-h",name:"\u4fee\u6539\u5c5e\u6027",callback:(m=function(e,n){return function(){return new d({fileCollection:t.fileCollection}).show(e,n)}})(s)}}).selectAllItems={icon:"far fa-object-group",name:"\u9009\u62e9\u5168\u90e8",callback:function(){return i=!0,T.length=0,y.forEach((function(e){return T.push(e.model),e.$el.addClass("selected_file_item")}))}},u=s.map((function(e){return{id:e.attributes._id,rev:e.attributes._rev,title:e.get("title")}})),c=o.getExportContextMenuItemsFn(s[0],u),h.exports={icon:"fas fa-file-export",name:"\u5bfc\u51fa...",items:c},h.openAsNewPopup={icon:"far fa-window-restore",name:"\u5728\u65b0\u6d6e\u52a8\u7f16\u8f91\u5668\u6253\u5f00",callback:function(){var e;return e=null,n&&(e={leaderLine:{source:n}}),$(window).trigger("createNewEditor",[s,e])}},1===s.length&&(a=s[0],h.changeAttribute={icon:"fas fa-sliders-h",name:"\u4fee\u6539\u5c5e\u6027...",items:{changeCurrentAttribute:{name:"\u4fee\u6539:"+_.escape(a.get("title")),callback:m(s)},changeCurrentPagesAttribute:{name:"\u4fee\u6539\u5f53\u524d\u9875\u4e0b\u6587\u7ae0\u7684\u6240\u6709\u5c5e\u6027(\u603b\u5171("+t.fileCollection.length+"))",callback:m(t.fileCollection.models)},changeAllAttribute:{name:"\u4fee\u6539\u5f53\u524d\u8fc7\u6ee4\u5668\u4e0b\u6240\u6709\u6587\u7ae0\u7684\u5c5e\u6027(\u603b\u5171"+t.fileCollection.allFileIds.length+"\u7bc7)",callback:m(t.fileCollection.models,t.fileCollection.allFileIds)}}},h.filterByReverse={icon:"fas fa-bezier-curve",name:"\u67e5\u627e\u5f15\u7528\u8be5\u6587\u7ae0\u7684\u6240\u6709\u6587\u7ae0",callback:function(){return $(window).trigger("changeFilterInfo",["reverse",a.attributes])}},a.get("isArchived")||!1?h.cancelArchive={icon:"fas fa-file-signature",name:"\u91cd\u65b0\u653e\u5165\u8349\u7a3f\u7bb1",callback:function(){return a.save({isArchived:!1},{force:!0})}}:h.archive={icon:"fas fa-suitcase",name:"\u5f52\u6863",callback:function(){return a.archive()}},a.get("up")||!1?h.cancelUp={icon:"fas fa-thumbtack disabled icon",name:"\u53d6\u6d88\u7f6e\u9876",callback:function(){var e;return e=g(y,a.id),t.$el.find(".file-browser-panel>.item:not(.up_file_item)").first().before(e.$el),a.save({up:!1},{force:!0,success:function(){var e;return e=t.upFiles.indexOf(a.id),t.upFiles.splice(e,1),t.fileCollection.sort({silent:!0})}})}}:h.up={icon:"fas fa-thumbtack",name:"\u7f6e\u9876",callback:function(){return a.save({up:Date.now()},{force:!0,success:function(){var e;return t.upFiles.push(a.id),e=g(y,a.id),t.$el.find(".file-browser-panel").prepend(e.$el),t.fileCollection.sort({silent:!0})}})}}),h.trash={icon:"fas fa-trash",name:"\u5220\u9664",callback:function(){return s.map((function(e){return e.moveToTrash()}))}},{items:h})}})},S.prototype.afterAttach=function(){var e;return e=this,$(window).on("changeActiveEditorProxy",(function(t,n){var i,r;if(e.$el.find(".file-browser-panel>.item.edit_active").removeClass("edit_active"),n&&n.editorView.editorProxy!==n&&(i=n.fileModel,e.fileModel&&e.fileModel.id!==i.id))return r=i.cid,e.$el.find(".file-browser-panel>.item[id="+r+"]").addClass("edit_active")})),$(window).on("keyup",(function(t){if(27===t.which&&0!==T.length)return e.resetSelectedFileModels()})),$(window).on("fileModelChanged",(function(t,n){if(M&&M.queryTerms&&e.fileCollection.allFileIds.indexOf(n.id)>=0)return e.showSearchResultOutlineWindow(M.queryTerms,n.get("title"),n.get("content"),n)})),m(this.$el,this),F(this.$el,this)},F=function(e,n){return x=tippy(e[0],{content:"",allowHTML:!0,appendTo:function(){return document.body},getReferenceClientRect:function(){return t?t.getBoundingClientRect():null},arrow:!1,delay:[500,500],placement:"right",trigger:"manual",interactive:!0}),e.tippy},l=function(e){var t;return(t=new a({fileBrowserView:e})).render(),e.pageNavView=t,e.addListNav()},S.prototype.afterRender=function(){var e;return e=this,this.$dimmer=$('<div class="ui dimmer transition hidden"><div class="ui text loader">\u52a0\u8f7d\u4e2d</div></div>'),this.$el.append(this.$dimmer),this.$dimmer.dimmer({onShow:function(){return e.$dimmer.find(".ui.text").html("\u52a0\u8f7d\u4e2d")}}),this.addAll(),this.changeFileModel(this.fileModel),this.storeView.$el.find(">.content").append(this.$el),l(this)},S.prototype.showLeaderLine=function(e,t){return u.showLeaderLine(e,t)},S.prototype.hideLeaderLine=function(){return u.hideLeaderLine()},S.prototype.showTempSearchResultOutlineWindow=function(e,t,n){return this.storeView.showTempSearchResultOutlineContainer(e,t,n)},S.prototype.hideTempSearchResultOutlineWindow=function(){return this.storeView.hideTempSearchResultOutlineContainer()},S.prototype.hideSearchResultOutlineWindow=function(){return this.storeView.hideSearchResultOutlineContainer()},S.prototype.showSearchResultOutlineWindow=function(e,t,n,i){return this.storeView.showSearchResultOutlineContainer(e,t,n,i)},S}(m),n.exports=l}}),window.requirejs.define({"views/file_browser/templates/file_browser":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<div class="ui list file-browser-panel shadow_scroll_effect"></div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/file_browser/templates/file_browser_page_nav":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<div class="ui icon vertical buttons mini animation_icon_tips reverse">\n<div class="ui icon button analysis_buttons dropdown">\n<span class="icon_tip">\u7edf\u8ba1\u5206\u6790</span>\n<i class="chart bar outline icon" title="\u7edf\u8ba1\u5206\u6790"></i>\n<div class="menu">\n<div class="item tags_map_window_button analysis_button">\n<i class="blackberry icon"></i>\n\u6807\u7b7e\u7ec4\u5408\u5173\u7cfb\u56fe</div>\n<div class="item decision_map_window_button analysis_button">\n<i class="keycdn icon"></i>\n\u6807\u7b7e\u51b3\u7b56\u56fe</div>\n<div class="item link_map_window_button analysis_button">\n<i class="hubspot icon"></i>\n\u94fe\u63a5\u5173\u7cfb\u56fe</div>\n</div>\n</div>\n\n<div class="ui icon button display_info_buttons dropdown">\n<span class="icon_tip">\u663e\u793a\u65b9\u5f0f</span>\n<i class="film icon" title="\u663e\u793a\u65b9\u5f0f"></i>\n<div class="menu">\n<div class="item display_default_button display_button" data-display_type="default">\u7cfb\u7edf\u9ed8\u8ba4</div>\n<div class="item display_simple_button display_button" data-display_type="simple">\u7b80\u5355\u6a21\u5f0f</div>\n<div class="item display_abundant_button display_button" data-display_type="abundant">\u4e30\u5bcc\u6a21\u5f0f</div>\n</div>\n</div>\n\n<div class="ui icon button sort_info_buttons dropdown">\n<span class="icon_tip">\u6392\u5e8f\u65b9\u5f0f</span>\n<i class="sort icon" title="\u6392\u5e8f\u65b9\u5f0f"></i>\n<div class="menu">\n<div class="item by_default_button sort_button" data-sort_type="by_default">\u7cfb\u7edf\u9ed8\u8ba4</div>\n<div class="item by_create_date_button sort_button" data-sort_type="by_create_date">\u521b\u5efa\u65f6\u95f4</div>\n<div class="item by_update_date_button sort_button" data-sort_type="by_update_date">\u66f4\u65b0\u65f6\u95f4</div>\n<div class="item by_title_button sort_button" data-sort_type="by_title">\u6587\u7ae0\u6807\u9898</div>\n</div>\n</div>\n\n<div class="ui icon button page_info_button dropdown">\n<span class="icon_tip page_statics_info"></span>\n<div class="page_info_container">\n<span class="current_page"></span>/<span class="total_page"></span>\n</div>\n<div class="menu">\n<div class="item">0</div>\n</div>\n</div>\n<div class="ui icon button page_button first_page_button disabled">\n<span class="icon_tip">\u9996\u9875</span>\n<i class="icon angle double up" title="\u9996\u9875">\n</i>\n</div>\n<div class="ui icon button page_button prev_page_button disabled">\n<span class="icon_tip">\u4e0a\u4e00\u9875</span>\n<i class="icon angle up" title="\u4e0a\u4e00\u9875">\n</i>\n</div>\n<div class="ui icon button page_button next_page_button">\n<span class="icon_tip">\u4e0b\u4e00\u9875</span>\n<i class="icon angle down " title="\u4e0b\u4e00\u9875">\n</i>\n</div>\n<div class="ui icon button page_button last_page_button">\n<span class="icon_tip">\u5c3e\u9875</span>\n<i class="icon angle double down " title="\u5c3e\u9875">\n</i>\n</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/file_browser/templates/file_browser_quick_filter":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return"<div>\n</div>\n"},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/file_browser/templates/file_browser_system_file_item":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){var o,a=null!=t?t:e.nullContext||{},s=n.helperMissing,l=e.escapeExpression;return'<div class="file_info_color"></div>\n<i class="file text outline icon file_info_icon '+l("function"==typeof(o=null!=(o=n.selectedClass||(null!=t?t.selectedClass:t))?o:s)?o.call(a,{name:"selectedClass",hash:{},data:r}):o)+" "+l("function"==typeof(o=null!=(o=n.upClass||(null!=t?t.upClass:t))?o:s)?o.call(a,{name:"upClass",hash:{},data:r}):o)+'"></i>\n<div class="content">\n<div class="file-info">\n<div class="mini ui button icon circular archive_file" title="\u5f52\u6863"><i class=" suitcase icon"></i> </div>\n<div class="mini ui button icon circular delete_file" title="\u5220\u9664"><i class=" trash icon"></i> </div>\n</div>\n<div class="file_info_title" title="'+l("function"==typeof(o=null!=(o=n.title||(null!=t?t.title:t))?o:s)?o.call(a,{name:"title",hash:{},data:r}):o)+'">'+l("function"==typeof(o=null!=(o=n.title||(null!=t?t.title:t))?o:s)?o.call(a,{name:"title",hash:{},data:r}):o)+"</div>\n</div>\n"},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/file_detail_view":function(e,t,n){var i,r,o,a,s,l,c,u,d,p={}.hasOwnProperty;s=t("./view"),t("../lib/utils"),o=t("../application"),t("../lib/notifier"),u=t("./templates/file_detail"),l=t("../lib/preview_core"),d=null,c="markdown",r=null,i=null,a=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)p.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.template=u,t.prototype.className="ui standard story_modal modal",t.prototype.events={"click .delete_button":"_deleteFile","click .info_button":"_info","click .attach_button":"_attach","click .archive_button":"_archive","click .draft_button":"_draft","click .detail_button":"_detail","click .preview_button":"togglePreviewMode"},t.prototype.showMarkdownDetail=function(){return d.$el.find(".preview_button").attr("title","markdown\u67e5\u770b"),d.$el.find(".preview_button .icon").removeClass("unhide").addClass("align left"),d.$el.find(".file_detail_content").show(),d.$el.find(".file_detail_preview").hide()},t.prototype.showPreviewDetail=function(){if(d.$el.find(".preview_button").attr("title","web\u67e5\u770b"),d.$el.find(".preview_button .icon").addClass("unhide").removeClass("align left"),d.$el.find(".file_detail_content").hide(),d.$el.find(".file_detail_preview").show(),0===d.$el.find(".file_detail_preview iframe").length)return d.initPreview()},t.prototype.togglePreviewMode=function(){return"web"===c?(c="markdown",d.showMarkdownDetail()):(c="web",d.showPreviewDetail())},t.prototype._deleteFile=function(e){var t,n,i;return t=d.model.attributes._id,i=d.model.attributes._rev,null!=(n=d.filesDocumentManager)?n.deleteFile(t,i):void 0},t.prototype._info=function(e){var t,n,i;return t=d.model.attributes._id,i=d.model.attributes._rev,null!=(n=d.filesDocumentManager)?n.info(t,i):void 0},t.prototype._attach=function(e){var t,n,i;return t=d.model.attributes._id,i=d.model.attributes._rev,null!=(n=d.filesDocumentManager)?n.attach(t,i):void 0},t.prototype._archive=function(e){var t,n,i;return t=d.model.attributes._id,i=d.model.attributes._rev,null!=(n=d.filesDocumentManager)?n.archive(t,i,(function(){return d.$el.find(".archive_button").removeClass("archive_button").addClass("draft_button").html("\u91cd\u65b0\u8349\u7a3f")})):void 0},t.prototype._draft=function(e){var t,n,i;return t=d.model.attributes._id,i=d.model.attributes._rev,null!=(n=d.filesDocumentManager)?n.draft(t,i,(function(){return d.$el.find(".draft_button").removeClass("draft_button").addClass("archive_button").html("\u5f52\u6863")})):void 0},t.prototype._detail=function(e){var t,n,i;return t=d.model.attributes._id,i=d.model.attributes._rev,null!=(n=d.filesDocumentManager)?n.detail(t,i):void 0},t.prototype.initialize=function(e){return null==e&&(e={}),this.hideCallbackFn=e.hideCallbackFn,this.queryTerms=e.queryTerms,this.filesDocumentManager=e.filesDocumentManager,d=this},t.prototype.getRenderData=function(){var e,t,n,i;return n=this.model.attributes,i=this.queryTerms,e=$("<div></div>").text(n.content).html(),t=$("<div></div>").text(n.title).html(),i.forEach((function(n){var i;if(n)return i=new RegExp("("+n+")","gi"),e=e.replace(i,"<mark>$1</mark>"),t=t.replace(i,"<mark>$1</mark>")})),{title:t,content:e}},t.prototype.afterRender=function(){var e;return e=o.getCurrentFileMode(),this.model.id===e.id&&this.$el.find(".archive_button, .draft_button").remove(),this.model.attributes.isArchived?this.$el.find(".archive_button").remove():this.$el.find(".draft_button").remove()},t.prototype.hide=function(){return this.$el.modal("hide")},t.prototype.show=function(e){var t;return this.render(),e&&(this.$el.addClass(e),this.$el.find(".hide_manage_buttons").removeClass("hide_manage_buttons")),t=this,this.$el.modal({allowMultiple:!0,onVisible:function(){return"markdown"===c?d.showMarkdownDetail():d.showPreviewDetail()},onHidden:function(){if(i&&(i.empty(),i.parentsUntil("html").remove(),i=null),r=null,t.$el.modal("destroy"),t.remove(),"function"==typeof t.hideCallbackFn&&t.hideCallbackFn(t.model,t),d===t)return d=null},onApprove:function(){return!1}}).modal("show")},t.prototype.initPreview=function(){var e;return"presentation"===(e=d.model.getMeta().preview_previewType||"normal")&&(e="presetation"),"presetation"===e?d._initPPTPreview():d._initHtmlPreview()},t.prototype._initPPTPreview=function(){var e;return(e=this.$el.find(".file_detail_preview")).html(""),(r=$('<iframe src="presetation.html" frameborder="0" style="width: 100%;height:100%;"></iframe>').appendTo(e)).one("load",(function(){var e,t,n,a;return e=r[0],t=e.contentDocument,(a=e.contentWindow).autoLoadRemoteResource=!0,o.getStyleText(d.model,(function(e,n){return l.setCustomCss(n,t)})),(i=$(t).find(".slides")).on("click",".story_script_resource_placeholder",(function(e){var t;return t=$(e.currentTarget),l.replaceScriptResource(t,e)})),n={sourceMap:!1,previewType:"presetation",needRenderPreview:!0,parseClientLocalMedias:!0},l.previewTarget(d.model,null,a,i,n,(function(){return a.initRevealjs()}))}))},t.prototype._initHtmlPreview=function(){var e;return(e=this.$el.find(".file_detail_preview")).html(""),(r=$('<iframe src="preview.html" frameborder="0" style="width: 100%;height:100%;"></iframe>').appendTo(e)).one("load",(function(){var e,t,n,a;return e=r[0],t=e.contentDocument,(a=e.contentWindow).requirejs("previews/preview")(a,window),a.autoLoadRemoteResource=!0,o.getStyleText(d.model,(function(e,n){return l.setCustomCss(n,t)})),(i=$(t).find(".preview")).on("click",".story_script_resource_placeholder",(function(e){var t;return t=$(e.currentTarget),l.replaceScriptResource(t,e)})),n={sourceMap:!1,previewType:"normal",needRenderPreview:!0,parseClientLocalMedias:!0},l.previewTarget(d.model,null,a,i,n,(function(){return 1}))}))},t}(s),n.exports=a}}),window.requirejs.define({"views/file_history_dialog_view":function(e,t,n){var i,r,o,a,s,l,c,u,d={}.hasOwnProperty,p=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};o=t("./view"),r=t("../lib/notifier"),c=t("./templates/file_history_dialog"),u=null,l=null,a=function(e,t){var n,i;return n=(i=new diff_match_patch).diff_main(e,t),i.diff_cleanupSemantic(n),i.diff_prettyHtml(n)},s=function(e){var t,n,i;return n=e.split("-")[0],t=u.$el.find(".rev_index[data-index="+n+"]"),(i=parseInt(t.attr("rowspan"))||0)>0&&t.attr("rowspan",i-1),u.$el.find("tr[data-value="+e+"]").remove(),u.conflicts=_.without(u.conflicts,e)},i=function(e){var t;function n(){return n.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)d.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(n,e),n.prototype.className="ui standard modal story_modal file_history_modal fullscreen",n.prototype.template=c,n.prototype.isInRevDetail=!1,n.prototype.conflicts=[],t=!0,n.prototype.docId=null,n.prototype.content=null,n.prototype.isContentInited=!1,n.prototype.title=null,n.prototype.db=null,n.prototype.onHideFn=null,n.prototype.initialize=function(e){return u=this,this.docId=e.docId,this.content=e.content,this.title=e.title,this.isContentInited=e.isContentInited,this.db=e.db,this.onHideFn=e.onHideFn},n.prototype.events={"click .rev_info":"showRevDetail","click .close_conflicts_button":"closeAllConflictsFn","click .close_conflict_button":"closeConflictFn","click .detail_close_conflict_button":"detailCloseConflictFn"},n.prototype.closeConflictFn=function(e){var t,n,i,o;if(e.stopPropagation(),e.preventDefault(),t=$(e.currentTarget).parent().parent(),n=t.data("value"),i=u.db,o=u.docId,n&&!(p.call(u.conflicts,n)<0))return i.remove(o,n,(function(e,t){return e?r.showMessage("\u5173\u95ed\u51b2\u7a81\u5206\u652f\u5931\u8d25: "+e,6e3,"error"):(u.conflicts=_.without(u.conflicts,n),0===u.conflicts.length&&u.$el.find(".close_conflicts_button").hide(),s(n)),u.returnRevsInfo()}))},n.prototype.detailCloseConflictFn=function(e){var t,n,i;if(e.stopPropagation(),e.preventDefault(),t=u.currentRev,n=u.db,i=u.docId,t&&!(p.call(u.conflicts,t)<0))return n.remove(i,t,(function(e,n){return e?r.showMessage("\u5173\u95ed\u51b2\u7a81\u5206\u652f\u5931\u8d25: "+e,6e3,"error"):(s(t),u.conflicts=_.without(u.conflicts,t),u.returnRevsInfo())}))},n.prototype.closeAllConflictsFn=function(e){var t,n;return e.stopPropagation(),e.preventDefault(),t=u.db,n=u.docId,async.map(u.conflicts,(function(e,i){return t.remove(n,e,(function(t,n){return u.conflicts=_.without(u.conflicts,e),s(e),i()}))}),(function(){return r.showMessage("\u51b2\u7a81\u5206\u652f\u5173\u95ed\u5b8c\u6210"),u.$el.find(".close_conflicts_button").hide()}))},n.prototype.showDiff=function(){var e;return e=a(u.content,u.revContent),u.$el.find(".file_content").html(e)},n.prototype.showOrignRev=function(){return u.$el.find(".file_content").text(u.revContent)},n.prototype.showRevDetail=function(e){var n,i,o;if(n=u.$el.find(".file_history_content_container"),u.$el.find(".close_conflicts_button").hide(),!(i=$(e.currentTarget)).hasClass("processing")){if(i.addClass("processing"),!i.hasClass("positive"))return n.find("tr.rev_info.positive").removeClass("positive"),i.addClass("positive"),l=i.data("value"),p.call(u.conflicts,l)>=0?u.$el.find(".detail_close_conflict_button").show():u.$el.find(".detail_close_conflict_button").hide(),this.currentRev=l,o=u.db,this.content,o.get(this.docId,{rev:l},(function(e,o){var a;return i.removeClass("processing"),e?r.showMessage("\u52a0\u8f7d\u5386\u53f2\u7248\u672c\u51fa\u9519:"+e,6e3,"error"):(a=function(){return u.revContent=u.generateContent(o),u.isInRevDetail=!0,t?u.showDiff():u.showOrignRev(),u.$el.find(".file_info").transition("fade left",500,(function(){return u.$el.modal("refresh")})),u.$el.find(".show_diff_checkbox").removeClass("hidden"),u.$el.find(".select_button").show(),n.addClass("file_history_content_container_in_detail")},n.hasClass("file_history_content_container_in_detail")?u.$el.find(".file_info").transition("fade right",500,(function(){return a()})):a())}));setTimeout((function(){return i.removeClass("positive"),i.removeClass("processing"),u.returnRevsInfo()}),600)}},n.prototype.generateContent=function(e){var t;return delete(t=JSON.parse(JSON.stringify(e)))._id,delete t._rev,delete t._revs_info,JSON.stringify(t,null,4)},n.prototype.returnRevsInfo=function(e){var t,n;return e&&(e.stopPropagation(),e.preventDefault()),(n=u.$el.find(".file_history_content_container")).find("tr.rev_info.positive").removeClass("positive"),this.currentRev=null,u.$el.find(".file_info").transition("fade left",500,(function(){return n.removeClass("file_history_content_container_in_detail")})),u.isInRevDetail=!1,(t=u.$el.find(".show_diff_checkbox")).checkbox("set checked"),t.addClass("hidden"),u.$el.find(".select_button").hide(),u.$el.find(".detail_close_conflict_button").hide(),0===u.conflicts.length?u.$el.find(".close_conflicts_button").hide():u.$el.find(".close_conflicts_button").show()},n.prototype.getRenderData=function(){return{title:this.title}},n.prototype.afterRender=function(){var e,n,i,o;return n=u.db,e=this.$el.find("tbody"),this.$el.find(".show_diff_checkbox").checkbox({onChecked:(o=this,function(){if(t=!0,o.isInRevDetail)return o.showDiff()}),onUnchecked:function(e){return function(){if(t=!1,e.isInRevDetail)return e.showOrignRev()}}(this)}),this.$el.find(".show_compact_checkbox").checkbox({onChecked:function(e){return function(){return e.$el.addClass("show_compact_doc")}}(this),onUnchecked:function(e){return function(){return e.$el.removeClass("show_compact_doc")}}(this)}),u.$el.find(".detail_close_conflict_button").hide(),u.$el.find(".close_conflicts_button").hide(),i=function(e,t,i){return n.get(t,{rev:i},(function(t,n){var i;if(!t)return i=n.updateDate,e.find(".rev_updatedate").html(moment(i).format("YYYY-MM-DD HH:mm:ss"))}))},n.get(this.docId,{conflicts:!0,revs_info:!0},(function(t,n){var o,a,s;return t?r.showMessage("\u52a0\u8f7d\u6587\u4ef6\u5386\u53f2\u8bb0\u5f55\u51fa\u9519\uff1a"+t,6e3,"error"):(s=n._revs_info,a=n._conflicts||[],u.isContentInited||(u.content=u.generateContent(n),u.isContentInited=!0),u.conflicts=a,o=s.length,s.forEach((function(t,r){var s,l,c,u;return u="","missing"===t.status&&(u="error"),l=[],a.forEach((function(e,n){var i;if(i=e.split("-")[0],t.rev.startsWith(i+"-"))return l.push(e)})),c="",l.length>0&&(c="rowspan='"+(l.length+1)+"'",u+=" conflict"),s=$("<tr data-value='"+t.rev+"' class='rev_info "+u+"'><td "+c+" class='rev_index' data-index='"+(o-r)+"'>"+(o-r)+"</td><td class='rev_updatedate'></td><td class='rev_detail' colspan='2'>"+t.rev+"</td></tr>"),"missing"===t.status?(s.find(".rev_updatedate").html(t.rev),s.find(".rev_detail").html("")):i(s,n._id,t.rev),e.append(s),l.forEach((function(t,r){return s=$("<tr data-value='"+t+"' class='rev_info warning'><td class='rev_updatedate'></td><td class='rev_detail'>"+t+"</td><td class='right aligned rev_buttons'><span class='ui basic button blue mini close_conflict_button'>\u5173\u95ed\u8be5\u51b2\u7a81\u5206\u652f</span></td></tr>"),i(s,n._id,t),e.append(s)}))})),a.length>0&&u.$el.find(".close_conflicts_button").show(),setTimeout((function(){return null!=u?u.$el.modal("refresh"):void 0}),1e3))}))},n.prototype.hide=function(){if(u)return this.$el.modal("hide")},n.prototype.revertVersion=function(e){var t;return(t=u.db).get(this.docId,{rev:e}).then((function(e){return t.get(u.docId).then((function(n){return e._rev=n._rev,t.put(e)}))})).then((function(e){return u.hide()})).catch((function(e){return r.showMessage("\u7248\u672c\u5207\u6362\u5931\u8d25: "+u.docId,6e3,"error")})),!1},n.prototype.show=function(){return this.render(),this.$el.modal({onHidden:function(){return t=!0,u&&("function"==typeof u.onHideFn&&u.onHideFn(),u.remove()),u=null},onApprove:function(){return u.revertVersion(l)}}),this.$el.modal("show")},n}(o),n.exports=i}}),window.requirejs.define({"views/file_horizontal_tabs_view":function(e,t,n){var i,r,o,a,s,l,c,u={}.hasOwnProperty;i=t("../application"),c=t("./templates/file_horizontal_tabs"),s=t("./view"),o=t("../lib/notifier"),a=t("./set_persist_group_dialog_view"),l=t("../lib/chrome-tabs"),r=function(e){var t,n,r,s,d,p,f,h,m,v;function g(){return g.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)u.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(g,e),g.prototype.className="file_horizontal_tabs_wrapper",g.prototype.template=c,r=null,t=null,f=!1,n=null,m=null,v={},d={},function(e,t,n){var i;if((i=d[t.id])&&i.cid!==t.cid&&(e.stopListening(i),delete d[t.id]),!d[t.id])return d[t.id]=t,e.listenTo(t,"change:title",(function(e){return n.save({name:e.get("title")})})),e.listenTo(t,"change:emoji",(function(e){return n.save({emoji:e.get("emoji")})}))},g.prototype.initialize=function(){var e;return r=i.getFileGroupTabCollection(),e=this,r.getActiveFile()||i.homeView.showNoFileDimmer(),this.listenTo(r,"add",(function(t){var n,o,a,s,l,c;if(n=e.addOne(t),"file"===t.get("type")&&(r.getActiveFile()||(e.clickTabFn.loading=!0,i.getFileCollection().getModelById(t.get("activeFile"),(function(t,n){if(e.clickTabFn.loading=!1,n&&i.homeView.fileModel!==n)return $(window).trigger("changeFileModel",[n])})))),"group"===t.get("type")&&(c=i.getTourModel()).canPrompt("create_group_learned")&&$(".lock_file_horizontal_tabs").length>0&&n.visible())return a=(s=n[0].getBoundingClientRect()).x+s.width/2,l=s.y+s.height/2,o=$('<div class="spotlight_container" style="\nbackground: radial-gradient(circle at '+a+"px "+l+'px, transparent 180px, rgba(0, 0, 0, 0.4) 182px, rgba(0, 0, 0, 0.9) 900px);\n"></div>'),n.popup({on:"manual",closable:!1,position:"bottom left",onVisible:function(){var e;return n.css({outline:"3px solid var(--negativeColor)",outlineOffset:"2px"}),$("body").append(o),(e=this).width(300),e.find(".ok").click((function(){return o.remove(),n.popup("destroy"),c.dontPrompt("create_group_learned"),e.remove(),n.css({outline:"",outlineOffset:""})}))},html:'<div class="header">\u63d0\u793a</div><div class="content">\u53f3\u952e\u8be5\u9875\u7b7e,\u6253\u5f00\u4e0a\u4e0b\u6587\u83dc\u5355\u540e\uff0c\u9009\u62e9<strong>\u8bbe\u7f6e\u56fa\u5b9a\u7ec4</strong>\uff0c\u53ef\u4ee5\u628a\u6d6e\u52a8\u7f16\u8f91\u5668\u8f6c\u6362\u6210\u56fa\u5b9a\u7ec4<div><a href="javascript:void(0);" class="ok pull-right">\u77e5\u9053\u4e86</a></div></div>'}).popup("show")})),this.listenTo(r,"remove",(function(t,n,o){var a,s,l,c;return e=this,c=o.index,l=null,s=!1,a=r.getActive(),t.id===a&&(s=!0,l=r.getNextFileIdByPos(c)),t.stopListening(),e.removeOne(t),t.destroy(),l?((t=r.get("file_"+l)).attributes,e.clickTabFn.loading=!0,i.getFileCollection().getModelById(l,(function(t,n){return e.clickTabFn.loading=!1,$(window).trigger("changeFileModel",[n])}))):s?$(window).trigger("changeFileModel",[]):void 0})),this.listenTo(r,"xsjActive",(function(t,n){return e.setActive(t,n)})),$(window).on("fileModelChanged",(function(e,t){var n;return n=r.getFileGroupTabModelById("file_"+t.id,{name:t.get("title"),emoji:t.get("emoji"),type:"file",activeFile:t.id}),r.changeActive(n.id),n.connectFileModel(t)}))},g.prototype.events={"chromeTabUpdate .chrome-tabs-shell":"updateTabFn","chromeTabClose .chrome-tabs-shell":"removeTabFn","chromeTabAdd .chrome-tabs-shell":"addTabFn","click .chrome-tab-close":"closeTabFn","mouseup .chrome-tab":"mouseUpTabFn","click .chrome-tab":"clickTabFn"},p=function(e,t){var n,o,a;return n=(r=i.getFileGroupTabCollection()).get(e.id),o=n.attributes,"file"===(a=e.type)?i.getFileCollection().getModelById(o.activeFile,(function(e,n){var i,r,o,a,s,l,c;if(n)return r=$.trim(n.getRealContent()),c=n.get("title"),l=n.get("tagNames"),i=n.get("category"),a=n.get("createDate"),o=r.split("\n").filter((function(e){return!!$.trim(e)})).slice(0,20),0,s='<h3 class="title">'+_.escape(c)+'</h3>\n<div class="tagNames">'+_.escape(l)+'</div>\n<div class="category">'+_.escape(i)+'</div>\n<div class="createDate">'+moment(a).format("YYYYMMDD hh:mm:ss")+'</div>\n<ol start="1">\n  '+o.map((function(e,t){return"context_line_content","<li class='context_line_content'>"+(e=_.escape(e))+"</li>"})).join("\n")+"\n</ol>",n.getCoverObjectUrl((function(e){return t(s,n,e)}))})):"group"===a?setTimeout((function(){var e;return 0,e='<ol start="1">\n  '+o.files.map((function(e){return""+e.name})).map((function(e,t){return"preview_context_line_content","<li class='preview_context_line_content'>"+(e=_.escape(e))+"</li>"})).join("\n")+"\n</ol>",t(e)}),1):void 0},g.prototype.removeTabFn=function(e,t){return r.remove(t.id)},g.prototype.addTabFn=function(e,t){return r.getFileGroupTabModelById(t.id,{name:t.title,type:"file",activeFile:t.activeFile,emoji:t.emoji},{silent:!0})},g.prototype.updateTabFn=function(e,t){if(r.localStorage.records&&r.localStorage.records.length===t.length)return r.localStorage.records=t,r.localStorage.save(),r.models.sort((function(e,n){return t.indexOf(e.id)-t.indexOf(n.id)})),r.trigger("xsjSort")},g.prototype.clickTabFn=function(e){var t,a,s,l,c,u;if(e.preventDefault(),e.stopPropagation(),u=(t=$(e.currentTarget)).data().tabData,s=r.get(u.id),l=s.attributes,c=this,!this.clickTabFn.loading)return t.addClass("chrome-tab-loading"),a=i.getFileCollection(),l.activeFile?(this.clickTabFn.loading=!0,a.getModelById(l.activeFile,(function(e,i){var r;return t.removeClass("chrome-tab-loading"),c.clickTabFn.loading=!1,e?o.showMessage("\u6253\u5f00\u6587\u4ef6\u5931\u8d25:"+e,6e3,"error"):i?"group"===l.type?$(window).trigger("createNewEditor",[i,{groupId:l.id}]):"file"===l.type&&((r=i.get("title"))&&r!==l.name&&s.save({name:r}),l.activeFile!==n)?$(window).trigger("changeFileModel",[i]):void 0:o.showMessage("\u6253\u5f00\u6587\u4ef6\u5931\u8d25: \u627e\u4e0d\u5230\u8be5\u6587\u4ef6",6e3,"error")}))):void 0},g.prototype.mouseUpTabFn=function(e){var t;if(2===e.which)return t=$(e.currentTarget).data().tabData,r.remove(t.id)},g.prototype.closeTabFn=function(e){var t;if(this,e.preventDefault(),e.stopPropagation(),"temp"!==(t=$(e.currentTarget).parent().data().tabData).groupType)return r.remove(t.id);$(window).trigger("destroyGroupEditor",[t.id])},h=function(e,s){return $.contextMenu({selector:".file_horizontal_tabs",trigger:"right",zIndex:10,events:{show:function(){return s.addClass("horizontal_tabs_contextmenu")},hide:function(){return s.removeClass("horizontal_tabs_contextmenu")}},build:function(e,s){var l,c,u;return l=(l=$(s.target)).parentsUntil(".chrome-tabs",".chrome-tabs>.chrome-tab"),!!(u=l.data("tabData"))&&(c={copyAsLink:{icon:"fas fa-link",name:"\u590d\u5236\u4e3a\u94fe\u63a5",callback:function(){var e,t,n,a,s,l;return l=(t=r.get(u.id)).get("type"),s=[],n=[],"file"===l?n.push(t.get("activeFile")):"group"===l&&t.get("files").forEach((function(e){return n.push(e.id)})),s=[],e=i.getFileCollection(),a=function(t,n){return e.getModelById(t,(function(e,t){var i,r;return t&&(t.getMeta().slug||t.get("slug")||t.id,i="xsjapp://doc/"+t.id,r=t.get("title")||"\u672a\u547d\u4ee4\u6587\u4ef6",s.push("["+r+"]("+i+")")),n()}))},async.map(n,a,(function(){var e;return 0===s.length&&s.push("["+t.get("anme")+"]("+t.get("activeFile")+")"),e="",1===s.length?e=s[0]:(s=s.map((function(e){return"- "+e})),e=s.join("\n")),$(document).one("copy",(function(t){return t.preventDefault(),t.stopPropagation(),t.originalEvent.clipboardData.setData("text/plain",e),o.showMessage("\u590d\u5236\u94fe\u63a5\u6210\u529f")})),document.execCommand("copy")}))}},closeOtherFile:{name:"\u5173\u95ed\u5176\u4ed6\u6587\u4ef6",callback:function(){var e;return e=r.filter((function(e){var t;return t=e.get("type"),!e.get("isPinned")&&(n!==e.id&&(u.id!==e.id&&"file"===t))})),r.remove(e)}}},r.find((function(e){return"group"===e.get("type")}))&&(c.minAllGroup={name:"\u6700\u5c0f\u5316\u6240\u6709\u7ec4",callback:function(){return r.filter((function(e){var t;return t=e.get("type"),e.get("groupType"),"group"===t})).forEach((function(e){return $(window).trigger("minGroupEditor",[e.id])}))}}),r.length>2&&(c.closeAll={icon:"far fa-times-circle",name:"\u5173\u95ed\u6240\u6709",callback:function(){var e,i,o;return i=[],o=r.filter((function(e){var t;return t=e.get("type"),e.get("groupType"),n!==e.id&&("group"===t?(i.push(e),!1):!e.get("isPinned"))})),r.remove(o),i.forEach((function(e){return $(window).trigger("destroyGroupEditor",[e.id])})),e=t.find(".chrome-tabs").sortable("toArray",{attribute:"data-id"}),r.localStorage.records=e}}),"group"===u.type?(c.persistGroup={icon:"fas fa-window-restore",name:"\u8bbe\u7f6e\u56fa\u5b9a\u7ec4",callback:function(){var e,t;if(e=!1,(t=i.getUserModel().get("user"))&&t.vip&&(e=!0),"web"===STORY_PLATFORM&&(e=!0),e)return(new a).show(u.id);o.showMessage("\u975e\u4f1a\u5458\u65e0\u6cd5\u5728\u5ba2\u6237\u7aef\u4f7f\u7528\u8be5\u529f\u80fd",6e3,"error")}},c.destroyGroup={icon:"fas fa-window-close",name:"\u9500\u6bc1\u7ec4",callback:function(){return $(window).trigger("destroyGroupEditor",[u.id,{destroy:!0}])}}):"file"===u.type&&(c.openAsNewPopup={icon:"far fa-window-restore",name:"\u5728\u65b0\u6d6e\u52a8\u7f16\u8f91\u5668\u6253\u5f00",callback:function(){return i.getFileCollection().getModelById(u.activeFile,(function(e,t){return e?o.showMessage("\u6253\u5f00\u6587\u4ef6\u5931\u8d25:"+e,6e3,"error"):t?$(window).trigger("createNewEditor",[t]):o.showMessage("\u6253\u5f00\u6587\u4ef6\u5931\u8d25: \u627e\u4e0d\u5230\u8be5\u6587\u4ef6",6e3,"error")}))}},c.togglePinned={icon:"fas fa-thumbtack "+(u.isPinned?"disabled":void 0)+" icon",name:u.isPinned?"\u53d6\u6d88\u9501\u5b9a":"\u9501\u5b9a",callback:function(){return r.get(u.id).save({isPinned:!u.isPinned})}}),{items:c})}})},g.prototype.afterRender=function(){return t=this.$el.find(".chrome-tabs-shell")},g.prototype.setActiveFileModel=function(e){var t;if(this.setActive("file_"+e.id),(t=r.get("file_"+e.id))&&e)return t.connectFileModel(e)},g.prototype.setActive=function(e,i){return null==i&&(i="file"),"file"===i?(n=e,l.activeTab(t,e)):l.activeGroupTab(t,e)},s=function(e){var n,i,r;if(e.changed)return i=e.get("name")||"  ",r=e.get("type")||"group",n=e.get("groupType"),"group"===r&&(i="("+(e.get("files")||[]).length+") "+i),l.addOrUpdateNewTab(t,{id:e.id,type:r,groupType:n,activeFile:e.get("activeFile"),title:i,emoji:e.get("emoji"),isPinned:!!e.get("isPinned")})},g.prototype.addOne=function(e){var n,i,r,o,a,c;return a=e.get("name")||" ",c=e.get("type")||"group",i=e.get("groupType"),"group"===c&&(a="("+(e.get("files")||[]).length+") "+a),n=l.addOrUpdateNewTab(t,{id:e.id,type:c,groupType:i,activeFile:e.get("activeFile"),title:a,emoji:e.get("emoji"),isPinned:!!e.get("isPinned")}),e.off("change",s),e.on("change",s),r=tippy(n[0],{content:_.escape(a),allowHTML:!0,onCreate:function(e){return e._isFetching=!1},onTrigger:function(t){var i;if(!t._isFetching)return t._isFetching=!0,i=n.data().tabData,p(i,(function(n,r,o){var a,s,l,c,u,d;return n='<div style="align-self: start;">'+n+"</div>",t._isFetching=!1,(d=t.popper.querySelector(".tippy-box")).classList.remove("file_popup_tip_with_cover"),"group"===i.type?(l="book icon",s="var(--base02)",u="var(--base05)","persist"===i.groupType&&(l=e.get("groupIcon")||l,n+='<span class="preview_context_line_content_group" style="text-shadow: 1px 1px 1px '+(s=e.get("groupColor")||s)+'"><i class="'+l+'" style="color: '+(u="white")+';"></i></span>'),d.style.background=s,d.style.color=u,d.style.setProperty("--lighterBackground",s),d.style.setProperty("--selectionBackground",s)):(d.style.background=null,d.style.color=null,d.style.outline=null,d.style.removeProperty("--lighterBackground"),d.style.removeProperty("--selectionBackground"),r&&((a=r.get("color"))&&(d.style.setProperty("--selectionBackground",a),d.style.outline="2px solid var(--selectionBackground)"),o&&(d.classList.add("file_popup_tip_with_cover"),d.style.background="url("+o+")")),i.emoji&&(n+='<span class="preview_context_line_content_emoji"><i class="i icon file_emoji">'+i.emoji+"</i></span>")),c='<div class="file_horizontal_preview_context_line_content_container preview_context_line_content_container">\n  '+n+"\n</div>",t.setContent(c)}))}}),v[e.id]=r,o=Object.values(v),m?m.setInstances(o):m=tippy.createSingleton(o,{allowHTML:!0,placement:"bottom",arrow:!1,delay:[500,100],animation:"shift-toward-extreme",moveTransition:"transform 0.2s ease-out",overrides:["onTrigger"]}),n},g.prototype.removeOne=function(e){var n,i;if(i=v[e.id],delete v[e.id],m.setInstances(Object.values(v)),i&&i.destroy(),e.off("change",s),l.destroyTab(t,e.id),"file"===e.get("type")&&(n=d[e.get("activeFile")]))return this.stopListening(n),delete d[e.get("activeFile")]},g.prototype.addAll=function(e){var t;return t=this,e.forEach((function(e,n){if(!(n>100))return t.addOne(e)}))},g.prototype.show=function(){if(!f)return f=!0,l.init({$shell:t,minWidth:45,maxWidth:160}),t.find(".chrome-tab-blank").remove(),this.addAll(r.models),h(0,this.$el)},g}(s),n.exports=r}}),window.requirejs.define({"views/file_info_manager_view":function(e,t,n){var i,r,o,a,s,l,c,u,d={}.hasOwnProperty;a=t("./view"),t("../lib/utils"),i=t("../application"),o=t("../lib/notifier"),c=t("./templates/file_info_manager"),u=null,l=!1,s=!1,r=function(e){var t;function n(){return n.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)d.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(n,e),n.prototype.template=c,n.prototype.className="ui standard story_modal modal",t=null,n.prototype.events={"click .delete_button":"_deleteFile","click .info_button":"_info","click .attach_button":"_attach","click .archive_button":"_archive","click .draft_button":"_draft","click .detail_button":"_detail","click .plugin_button":"disconnectPlugin","click .local_button":"disconnectLocal"},n.prototype.disconnectPlugin=function(){return l=!l,u.$el.find(".plugin_info_description").toggleClass("deleted")},n.prototype.disconnectLocal=function(){return s=!s,u.$el.find(".plugin_info_description").toggleClass("deleted")},n.prototype._deleteFile=function(e){var t,n,i;return t=u.model.attributes._id,i=u.model.attributes._rev,null!=(n=u.filesDocumentManager)?n.deleteFile(t,i):void 0},n.prototype._info=function(e){var t,n,i;return t=u.model.attributes._id,i=u.model.attributes._rev,null!=(n=u.filesDocumentManager)?n.info(t,i):void 0},n.prototype._attach=function(e){var t,n,i;return t=u.model.attributes._id,i=u.model.attributes._rev,null!=(n=u.filesDocumentManager)?n.attach(t,i):void 0},n.prototype._archive=function(e){var t,n,i;return t=u.model.attributes._id,i=u.model.attributes._rev,null!=(n=u.filesDocumentManager)?n.archive(t,i,(function(){return u.$el.find(".archive_button").removeClass("archive_button").addClass("draft_button").html("\u91cd\u65b0\u8349\u7a3f")})):void 0},n.prototype._draft=function(e){var t,n,i;return t=u.model.attributes._id,i=u.model.attributes._rev,null!=(n=u.filesDocumentManager)?n.draft(t,i,(function(){return u.$el.find(".draft_button").removeClass("draft_button").addClass("archive_button").html("\u5f52\u6863")})):void 0},n.prototype._detail=function(e){var t,n,i;return t=u.model.attributes._id,i=u.model.attributes._rev,null!=(n=u.filesDocumentManager)?n.detail(t,i):void 0},n.prototype.initialize=function(e){var n;return null==e&&(e={}),this.hideCallbackFn=e.hideCallbackFn,this.filesDocumentManager=e.filesDocumentManager,n=i.getFileLocalCollection(),t=n.get(this.model.id),u=this},n.prototype.afterRender=function(){var e;return this.pluginInfo(),this.otherInfo(),e=i.getCurrentFileMode(),this.model.id===e.id&&this.$el.find(".archive_button, .draft_button").remove(),this.model.attributes.isArchived?this.$el.find(".archive_button").remove():this.$el.find(".draft_button").remove()},n.prototype.otherInfo=function(){var e,t,n;return e=this.$el.find(".other_info_description"),t=new Date(this.model.get("createDate")),n=new Date(this.model.get("updateDate")),e.html("<div>\u521b\u5efa\u65f6\u95f4: "+t.toLocaleString()+"</div>\n<div>\u66f4\u65b0\u65f6\u95f4: "+n.toLocaleString()+"</div>")},n.prototype.pluginInfo=function(){var e,n,r,o,a,s;return r=this.model,s=this.model.get("pluginName"),n=null,t&&(n=t.get("fullPath")),a=i.plugins[s],e=this.$el.find(".plugin_info_description"),a||n?a?(o=r.attributes.parentPath||"","local"!==a.name?e.html("<li>\u5f53\u524d\u7ed1\u5b9a\uff1a"+a.displayName+"("+a.name+")</li>\n<li>\u8def\u5f84: "+o+"/"+r.attributes.guid+'</li>\n<div class="ui basic button plugin_button"><i class="close icon disconnect_plugin"></i> \u53d6\u6d88\u8be5\u6587\u4ef6\u7684\u7ed1\u5b9a\u5173\u7cfb</div>'):e.html("<li>\u5f53\u524d\u7ed1\u5b9a\uff1a"+a.displayName+"("+a.name+")</li>\n<li>\u8def\u5f84: "+o+"/"+r.attributes.guid+"</li>\n<li>\u672c\u5730\u5b8c\u6574\u8def\u5f84: "+n+'</li>\n<div class="ui basic button plugin_button"><i class="close icon disconnect_plugin"></i> \u53d6\u6d88\u8be5\u6587\u4ef6\u7684\u7ed1\u5b9a\u5173\u7cfb</div>')):e.html("<li>\u5f53\u524d\u5173\u8054\u6253\u5f00\u672c\u5730\u6587\u4ef6</li>\n<li>\u8def\u5f84: "+n+'</li>\n<div class="ui basic button local_button"><i class="close icon disconnect_local"></i> \u53d6\u6d88\u8be5\u6587\u4ef6\u7684\u672c\u5730\u5173\u8054</div>'):e.html("\u8be5\u6587\u4ef6\u8fd8\u672a\u8fdb\u884c\u7ed1\u5b9a")},n.prototype.hide=function(){return this.$el.modal("hide")},n.prototype.show=function(e){var n,i,r,a,c,d;return l=!1,s=!1,this.render(),e&&(this.$el.addClass(e),this.$el.find(".hide_manage_buttons").removeClass("hide_manage_buttons")),n=this.$el,i=n.find(".ui.form"),c=this.model.get("tagNames")||[],a={title:this.model.get("title"),tagNames:c.join(",")},i.deserialize(a),i.form({fields:{title:{identifier:"title",rules:[{type:"empty",prompt:"\u6807\u9898\u4e0d\u80fd\u4e3a\u7a7a"}]}},onSuccess:(d=this,function(){var e;return e={title:n.find("input[name=title]").val().trim(),tagNames:(c=n.find("input[name=tagNames]").val().trim()).split(",")},l&&("local"===e.pluginName&&t&&t.set({fullPath:"",diskContent:""}),e.pluginName="",e.guid="",e.parentPath=""),s&&t&&t.set({fullPath:"",diskContent:""}),d.model.set(e),d.model.save({},{force:!0,error:function(e){return o.showMessage("error: "+e,6e3,"error")},success:function(e,t){return"function"==typeof u.hideCallbackFn&&u.hideCallbackFn(e,u),u.$el.modal("hide")}})})}),r=this,this.$el.modal({allowMultiple:!0,onHidden:function(){if(r.remove(),u===r)return u=null},onApprove:function(){return i.form("validate form"),!1}}).modal("show")},n}(a),n.exports=r}}),window.requirejs.define({"views/file_info_view":function(e,t,n){var i,r,o,a,s={}.hasOwnProperty;r=t("./view"),t("../lib/utils"),t("../application"),t("../lib/notifier"),o=t("./templates/file_info"),a=null,i=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)s.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.template=o,t.prototype.className="ui standard story_modal modal",t.prototype.show=function(e){var t,n,i,r,o;return e=e||this.model.get("content")||"",a=this,this.render(),(t=this.$el.find(".file_statistics_container")).append("<tr><td>\u603b\u957f\u5ea6</td><td>"+e.length+"</td></tr>"),o=(e.match(/\S.*/g)||[]).length,t.append("<tr><td>\u6bb5\u843d\u6570</td><td>"+o+"</td></tr>"),r=(e.match(/[^\s\W]+/g)||[]).length,t.append("<tr><td>\u82f1\u6587\u5355\u8bcd\u6570</td><td>"+r+"</td></tr>"),i=(e.match(/[^\s\W]/g)||[]).length,t.append("<tr><td>\u82f1\u6587\u5b57\u7b26\u6570</td><td>"+i+"</td></tr>"),n=(e.match(/[\u4e00-\u9fa5]/g)||[]).length,t.append("<tr><td>\u4e2d\u6587\u5b57\u6570</td><td>"+n+"</td></tr>"),this.$el.modal({onHidden:function(){return a.$el.modal("destroy"),a.remove(),a=null}}).modal("show")},t}(r),n.exports=i}}),window.requirejs.define({"views/file_list_by_url_view":function(e,t,n){var i,r,o,a,s,l,c,u={}.hasOwnProperty;i=t("../application"),o=t("../models/file_model"),s=t("../lib/utils"),a=t("../lib/utils_url"),l=t("./codemirror/create_inline_editor"),c=function(e,t,n){var i,r,o;if(e&&e.connectedView&&e.connectedView.commonCodeMirrorEditor&&(i=e.connectedView.commonCodeMirrorEditor),i)return o=n.lineNum,r=s.getCursorByHashTag(n.hashTag,t.get("content")),l(i,{lineNum:o,fileModel:t,initColumn:r.column,initRow:r.row,initCallback:function(e){return e.highlightPos({line:r.row,ch:r.column},{autoHideTimeout:2e3})}})},r=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)u.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,Backbone.View),t.prototype.className="file_list_selected_container",t.prototype.url="",t.prototype.hashTag="",t.prototype.fileModel=null,t.prototype.editor=null,t.prototype.cancelProcess=!1,t.prototype.docs={},t.prototype.initOpts={},t.prototype.events={mousemove:"mousemoveFn",mouseleave:"mouseleaveFn","mouseenter .item":"hoverItemFn","click .item":"clickItemFn"},t.prototype.clickItemFn=function(e){var t,n,r,o,l,u,d,p,f,h,m,v,g,_,w;if(g=this,_=(t=$(e.currentTarget)).data("type"),w=t.data("uid"),o=this.docs[w],d=this.hashTag,n=this.initOpts.bookmarker.find())switch(m=n.from.line,_){case"www":if(!a.openTarget(o,d))return window.openTarget(o);break;case"self":return h={line:(f=s.getCursorByHashTag(o,g.fileModel.get("content"))).row,ch:f.column},g.editor.getDoc().setCursor(h),g.editor.highlightPos(h);case"internal":if(p=o._id)return i.getFileCollection().getModelById(p,(function(t,n){var i,r,o;return t?Notifier.showMessage("\u6253\u5f00\u6587\u4ef6\u5931\u8d25:"+t,6e3,"error"):n?(null,e.ctrlKey?(f=s.getCursorByHashTag(d,n.get("content")),o=null,(r=g.editor)&&r.connectedView&&r.connectedView.commonCodeMirrorEditor&&(i=r.connectedView.commonCodeMirrorEditor,o="group_"+i.id),$(window).trigger("createNewEditor",[n,{groupId:o,callback:function(e,t){var n;if(o=e.id,t.focus(),n=t.$el.find(".popup_editor_file_tabs .file_item.droppable_file_item.active")[0])return appHighlightPosByEl(n)},initCursor:f}])):"fallback"===c(g.editor,n,{hashTag:d,event:e,lineNum:m})?n.id===g.fileModel.id?(f=s.getCursorByHashTag(d,g.fileModel.get("content")),g.editor.getDoc().setCursor({line:f.row,ch:f.column})):$(window).trigger("changeFileModel",[n,{hashTag:d,openInActiveIf:!0}]):void 0):Notifier.showMessage("\u6253\u5f00\u6587\u4ef6\u5931\u8d25: \u627e\u4e0d\u5230\u8be5\u6587\u4ef6",6e3,"error")}));break;case"plugin":if(u=t.data("guid")+"",v=t.data("parentPath")+"",u&&(r=i.getCurrentStorePluginModel(),i.getPlugin(r)))return $(window).trigger("importFileByPlugin",[r,u,v||"",{},function(){}]);break;case"local":if(l=t.data("path"))return $(window).trigger("importFileByPath",[l])}},t.prototype.hoverItemFn=function(e){var t,n,i,r,s;if(s=(t=$(e.currentTarget)).data("uid"),r=t.data("type"),(i=this.docs[s])&&this.initOpts.showLinkPopupContent){switch(n="",r){case"internal":n=a.getFileModelContent(new o(i),this.hashTag)}return n?this.initOpts.showLinkPopupContent(this.initOpts.bookmarker,s,uniqueNumber(),n):void 0}},t.prototype.mousemoveFn=function(){if(this.initOpts.cancelDestroyLinkTimeout)return this.initOpts.cancelDestroyLinkTimeout()},t.prototype.mouseleaveFn=function(){if(this.initOpts.delayDestroyLink)return this.initOpts.delayDestroyLink(this.initOpts.bookmarker)},t.prototype.initialize=function(e){var t;return this.cancelProcess=!1,this.docs={},this.initOpts=e,this.url=e.url,(t=this.url.lastIndexOf("#"))>=0&&(this.hashTag=this.url.substring(t+1),this.url=this.url.substring(0,t)),this.fileModel=e.fileModel,this.editor=e.editor},t.prototype.render=function(){var e,t,n;return this.$el.html('<div class="ui vertical menu loading"></div>'),this.url&&!a.isInternal(this.url)&&(n=uniqueNumber(),this.docs[n]=this.url,e=a.getIconName(this.url),this.$el.find(".menu").append('<a class="item" data-uid="'+n+'" data-type="www" title="'+_.escape(this.url)+'"><i class="'+e+'"></i>'+_.escape(this.url)+"</a>")),t=!this.url,this.url&&this.url===this.fileModel.id&&(t=!0),this.hashTag&&t&&(n=uniqueNumber(),this.docs[n]=this.hashTag,this.$el.find(".menu").append('<a class="item" data-uid="'+n+'" data-type="self"><i class="hashtag icon"></i>'+_.escape(this.hashTag)+"</a>")),this.refreshData()},t.prototype.show=function(e){var t;return this.render(),t=e.getBoundingClientRect(),this.$el.css({position:"absolute",zIndex:2e3,left:t.x,top:t.y+t.height}),$(document.body).append(this.$el)},t.prototype.destroy=function(){return this.cancelProcess=!0,this.remove()},t.prototype.refreshData=function(){var e,t,n;if(e=this,t=uniqueNumber(),n=function(){if(e.$el.find(".menu").removeClass("loading"),0===e.$el.find(".menu>.item").length)return e.$el.find(".menu").append('<div class="item disabled">\u8be5\u94fe\u63a5\u6ca1\u6709\u5bf9\u5e94\u6587\u7ae0</div>')},this.url)return a.getRelatedDocs(this.url,{orignLink:e.initOpts.url,fileModel:e.fileModel,app:i,dateNow:t,isCancel:function(){return e.cancelProcess},notifier:function(t,n){return t.map((function(t){var i,r;if(r=n.type+"_"+t._id,!e.docs[r]){switch(e.docs[r]=t,i="frown",n.type){case"internal":i="file alternate";break;case"plugin":i="yinxiang";break;case"local":i="hdd"}if("internal"===n.type)return e.$el.find(".menu").append('<a class="item" data-uid="'+_.escape(r)+'" data-type="'+n.type+'"><i class="icon '+i+'"></i>'+_.escape(t.title)+"\n</a>")}}))}},(function(){return n()}));n()},t}(),n.exports=r}}),window.requirejs.define({"views/file_model_history_dialog_view":function(e,t,n){var i,r,o={}.hasOwnProperty;i=t("../constant"),r=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)o.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.initialize=function(e){return t.__super__.initialize.apply(this,arguments),this.db=i.pouchDB,this.docId=this.model.id,this.content=this.model.get("content"),this.title=this.model.get("title"),this.isContentInited=!0},t.prototype.generateContent=function(e){return e.content},t.prototype.revertVersion=function(e){var t;return t=this,$(window).trigger("revertFileModel",[t.model,e,function(e){if(!e)return t.hide()}]),!1},t}(t("./file_history_dialog_view")),n.exports=r}}),window.requirejs.define({"views/file_tabs_view":function(e,t,n){var i,r,o,a,s,l,c=function(e,t){return function(){return e.apply(t,arguments)}},u={}.hasOwnProperty;i=t("../application"),s=t("./templates/file_tabs"),a=t("./view"),o=t("../lib/notifier"),l=null,r=function(e){function t(){return this.tabClick=c(this.tabClick,this),this.removeOtherTab=c(this.removeOtherTab,this),this.removeTab=c(this.removeTab,this),this.mouseenterTab=c(this.mouseenterTab,this),this.mouseenterMenu=c(this.mouseenterMenu,this),t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)u.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.className="file_tabs nav_tabs ui top right pointing dropdown",t.prototype.template=s,t.prototype.events={"click .file_tab":"tabClick","click .file_item_tab":"tabClick","click .remove_tab":"removeTab","click .remove_other_tab":"removeOtherTab","mouseenter .file_tab":"mouseenterTab","mouseenter .menu":"mouseenterMenu"},t.prototype.mouseenterMenu=function(e){return this.$menu.find(".file_item_tab_hover").removeClass("file_item_tab_hover")},t.prototype.mouseenterTab=function(e){var t;if(t=$(e.currentTarget).data("id"),this.$menu.find(".file_item_tab_hover").removeClass("file_item_tab_hover"),t)return this.$menu.scrollTo(this.$menu.find(".file_item_tab[data-id="+t+"]").addClass("file_item_tab_hover"))},t.prototype.removeTab=function(e){var t,n,i,r,o,a,s,l;if(e.preventDefault(),e.stopPropagation(),s=$(e.currentTarget).parent().data("id")){for(l=this.fileTabsModel.get("tabs")||[],t=this.fileTabsModel.get("activeTab"),a=-1,i=r=0,o=l.length;r<o;i=++r)if(l[i].id===s){a=i;break}if(a>=0&&t!==l[a].id)return(n=_.clone(l)).splice(a,1),this.fileTabsModel.set({tabs:n}),this.$fileTabsWrapper.html(""),this.$menu.html(""),this.refresh()}},t.prototype.removeOtherTab=function(e){var t,n,i,r,o,a,s;for(s=this.fileTabsModel.get("tabs")||[],n=this.fileTabsModel.get("activeTab"),t=null,i=r=0,o=s.length;r<o;i=++r)if((a=s[i]).id===n){t=a;break}if(t)return this.fileTabsModel.set({tabs:[t]}),this.$fileTabsWrapper.html(""),this.$menu.html(""),this.refresh()},t.prototype.getFileModelById=function(e,t){var n;return(n=this.fileCollection.where({_id:e})).length>0?setTimeout((function(){return"function"==typeof t?t(n[0]):void 0}),0):this.fileCollection.fetch({update:!0,remove:!1,options:{allDocs:{key:e,include_docs:!0,limit:1}},success:function(e,n,i){var r;return 1===n.rows.length?(r=e.get(n.rows[0].id),"function"==typeof t?t(r):void 0):(o.showMessage("\u6587\u4ef6\u5df2\u7ecf\u88ab\u5220\u9664",6e3,"error"),"function"==typeof t?t():void 0)},error:function(){return o.showMessage("\u6587\u4ef6\u5df2\u7ecf\u88ab\u5220\u9664",6e3,"error"),"function"==typeof t?t():void 0}})},t.prototype.tabClick=function(e){var t;if(e.preventDefault(),e.stopPropagation(),t=$(e.currentTarget).data("id"))return this.getFileModelById(t,(function(e){if(e)return $(window).trigger("changeFileModel",e)}))},t.prototype.initialize=function(e){var t;return l=this,this.fileCollection=i.getFileCollection(),this.fileTabsModel=i.getFileTabsModel(),this.listenTo(this.fileCollection,"remove",(t=this,function(e){var n,i,r,o,a,s,l;for(s=e.get("_id"),a=-1,i=r=0,o=(l=t.fileTabsModel.get("tabs")||[]).length;r<o;i=++r)l[i].id===s&&(a=i);if(a>=0)return(n=_.clone(l)).splice(a,1),t.fileTabsModel.set({tabs:n}),t.$fileTabsWrapper.html(""),t.$menu.html(""),t.refresh()})),$(window).on("fileModelDeleted fileModelArchived",function(e){return function(t,n){var i,r,o,a,s,l,c;for(o=n.get("_id"),l=-1,r=a=0,s=(c=e.fileTabsModel.get("tabs")||[]).length;a<s;r=++a)if(c[r].id===o){l=r;break}if(l>=0)return(i=_.clone(c)).splice(l,1),e.fileTabsModel.set({tabs:i}),e.$fileTabsWrapper.html(""),e.$menu.html(""),e.refresh()}}(this)).on("editorZenModeChange",function(e){return function(t,n){if(!n)return e.$fileTabsWrapper.html(""),e.$menu.html(""),e.refresh()}}(this)).on("previewZenModeChange",function(e){return function(t,n){if(!n)return e.$fileTabsWrapper.html(""),e.$menu.html(""),e.refresh()}}(this)),$(window).on("fileModelChanged",function(e){return function(t,n){var i,r,o,a,s;if(e.stopListening(),r=n.get("_id"),s=e.fileTabsModel.get("tabs")||[],a=e.fileTabsModel.get("maxTabs"),o=_.find(s,(function(e){return e.id===r})),e.listenTo(n,"change:title",(function(t){return o&&(o.name=n.get("title")),e.fileTabsModel.set({tabs:s,activeTab:r}),e.$fileTabsWrapper.html(""),e.$menu.html(""),e.refresh()})),o?o.name=n.get("title")||"\u672a\u547d\u540d\u6587\u4ef6":r&&(o={id:r,name:n.get("title")||"\u672a\u547d\u540d\u6587\u4ef6"},s.push(o)),s.length>a&&(s=_.rest(s,s.length-a)),e.fileTabsModel.set({tabs:s,activeTab:r}),e.$fileTabsWrapper.html(""),e.$menu.html(""),e.refresh(),!(i=e.$menu.find(".active")).visible())return e.$menu.scrollTo(i)}}(this))},t.prototype._refreshFileTab=function(){var e,t,n,i,r,o,a;for(a=this.fileTabsModel.get("tabs")||[],t=this.fileTabsModel.get("activeTab"),r=[],n=0,i=a.length;n<i;n++)e="","remove",(o=a[n])&&o.id===t&&(e="active","circle"),r.push(this.$fileTabsWrapper.append('<div class="ui file_tab empty circular label '+e+'" data-id="'+o.id+'" title="'+_.escape(o.name)+'"></div>'));return r},t.prototype._refreshMenuTab=function(){var e,t,n,i,r,o,a,s,l;for(l=this.fileTabsModel.get("tabs")||[],t=this.fileTabsModel.get("activeTab"),a=[],n=0,i=l.length;n<i;n++)e="",o="remove",r="remove_tab",(s=l[n])&&s.id===t&&(e="active",o="circle",r="current_tab"),a.push(this.$menu.append('<div class="item file_item_tab '+e+'" data-id="'+s.id+'" title="'+_.escape(s.name)+'">'+_.escape($.trim(s.name).substring(0,20))+'<i class="'+r+" icon "+o+'"></i></div>'));return a},t.prototype.refresh=function(){return this._refreshMenuTab(),this._refreshFileTab()},t.prototype.afterRender=function(){var e;return this.$fileTabsWrapper=this.$el.find(".file_tabs_wrapper"),this.$menu=this.$el.find(".menu"),this.$menu.on("mouseenter",(function(){return!0})).on("mouseleave",(function(){return!0})),this.$menu.sortable({stop:(e=this,function(t,n){var i;return i=[],e.$menu.find(".file_item_tab").each((function(e,t){var n,r,o;if(o=(n=$(t)).data("id"),r=n.text(),o&&r)return i.push({id:o,name:r})})),e.fileTabsModel.set({tabs:i}),e.$fileTabsWrapper.html(""),e._refreshFileTab()})}),this.refresh(),this.$el.dropdown({onHide:function(){var e;return(!(e=l.$menu.data("modulePopup"))||!e.is.visible())&&$(".main_toolbar_container").removeClass("file_tabs_menu_opened")},onShow:function(){return $(".main_toolbar_container").addClass("file_tabs_menu_opened")},on:"hover",action:function(){}}),this.$el.off("blur")},t}(a),n.exports=r}}),window.requirejs.define({"views/file_timeline_view":function(e,t,n){var i,r,o,a,s,l,c,u,d,p,f,h,m,v,g,w,y,b,x,k=function(e,t){return function(){return e.apply(t,arguments)}},D={}.hasOwnProperty;d=t("./view"),l=t("../lib/notifier"),i=t("../application"),r=t("../constant"),u=t("../lib/utils"),a=t("../models/file_model"),c=t("../lib/pouchdb_index_view_manager"),g=t("../lib/filetime_demo_datas"),b=t("../lib/filetime_sequence_show_github_content"),x=t("./templates/file_timeline"),h={},p=[],f={},y=function(){var e,t,n;for(t in n=[],f)e=f[t],window.URL.revokeObjectURL(e),n.push(delete f[t]);return n},v=function(e,t){var n,i,r,o,s;return(s=document.querySelector(".vis-item-script-"+e))&&s.parentElement&&s.parentElement.parentElement?(r=s.dataset.docid,i=h[r],o=s.parentElement.parentElement,i?"demo"===i.xsjType?(n=i.cover,i.coverUrl=n,o.style.backgroundImage="url("+n+")",s.remove(),void t()):f[i._id]?(n=f[i._id],i.coverUrl=n,o.style.backgroundImage="url("+n+")",s.remove(),void t()):new a(i).getCoverObjectUrl((function(e){return s.remove(),e&&(i&&(i.coverUrl=e),o.style.backgroundImage="url("+e+")",f[r]=e),t()})):void t()):t()},m=function(){var e;if(!(m.running||p.length<=0))return m.running=!0,e=p.shift(),v(e[0],(function(){return m.running=!1,m()}))},window._xsjLoadArticleCoverFn=function(e){return p.push([e]),m()},w=function(e){var t,n,i,r,o,a,s,l,c;return i=(c=d3.timeFormatLocale({dateTime:"%a %b %e %X %Y",date:"%Y/%-m/%-d",time:"%H:%M:%S",periods:["\u4e0a\u5348","\u4e0b\u5348"],days:["\u661f\u671f\u65e5","\u661f\u671f\u4e00","\u661f\u671f\u4e8c","\u661f\u671f\u4e09","\u661f\u671f\u56db","\u661f\u671f\u4e94","\u661f\u671f\u516d"],shortDays:["\u661f\u671f\u65e5","\u661f\u671f\u4e00","\u661f\u671f\u4e8c","\u661f\u671f\u4e09","\u661f\u671f\u56db","\u661f\u671f\u4e94","\u661f\u671f\u516d"],months:["\u4e00\u6708","\u4e8c\u6708","\u4e09\u6708","\u56db\u6708","\u4e94\u6708","\u516d\u6708","\u4e03\u6708","\u516b\u6708","\u4e5d\u6708","\u5341\u6708","\u5341\u4e00\u6708","\u5341\u4e8c\u6708"],shortMonths:["1","2","3","4","5","6","7","8","9","10","11","12"]})).format(".%L"),a=c.format(":%S"),r=c.format("%I:%M"),n=c.format("%I %p"),t=c.format("%a %d"),s=c.format("%b %d"),o=c.format("%B"),l=c.format("%Y"),d3.timeSecond(e)<e?i(e):d3.timeMinute(e)<e?a(e):d3.timeHour(e)<e?r(e):d3.timeDay(e)<e?n(e):d3.timeMonth(e)<e?d3.timeWeek(e)<e?t(e):s(e):d3.timeYear(e)<e?o(e):l(e)},o=function(){var e,t,n,i,r,o,a,s,l,c,u,d,p,f;function h(t){u=t.width,c=t.timelineInstance,(l=d3.select(".d3-brush-svg")).append("defs").append("clipPath").attr("id","clip").append("rect").attr("class","clip-rect"),(r=l.append("g").attr("class","context")).append("g").attr("class","filter_line_group").append("path").attr("class","filter_line_path"),r.append("g").attr("class","all_group"),r.append("g").attr("class","filter_group"),r.append("g").attr("class","axis axis--x").attr("transform","translate(0,"+(o-20)+")"),r.append("g").attr("class","brush").on("wheel",(function(){var t,i,o,a,s,l;if(s=d3.event.wheelDelta,l=2,s<0&&(l=-l),e&&n.prev){if(t=r.select(".brush"),o=(a=n.prev.map((function(e,t){return 0===t?d(e)-l:1===t?d(e)+l:void 0})))[1]-a[0],s>0&&o>1e3)return;if(o>1e3&&(o=1e3,i=a[0]+a[1],a=[(i/=2)-499,i+499]),o>4)return t.call(e.move,a)}})),e=d3.brushX().on("end",n),s=d3.line().curve(d3.curveMonotoneX),this.setSize()}return l=null,u=null,o=100,20,d=null,f=null,p=null,s=null,r=null,c=null,e=null,500,a=!0,t={allDatas:[],filterDatas:[],rangeDate:{start:moment().add(-10,"days").toDate(),end:moment().add(10,"days")}},i=function(e,n,i){var r;return null==i&&(i=300),r=(r=a?t.filterDatas:t.allDatas).slice(),{getPrevRangeDate:function(){var t,o,a,s,l;for(r.reverse(),o=0,a=0,l=[],s=e;a<r.length&&o<i;)s=(t=r[a]).date,moment(e).isAfter(t.date)&&(o+=t.count,0===l.length&&o>0&&l.push(t.date)),a++;return 0===l.length?(s=moment(n).add(-3,"months").toDate(),moment(e).isBefore(s)&&(s=e),[s,n]):(s===l[0]&&r[a]&&(s=moment(r[a].date).add(1,"days").toDate()),a===r.length&&(s=moment(s).add(-3,"months").toDate()),l=[s,moment(e).add(-1,"days").toDate()])},getBeforeDate:function(){var t,o,a;for(r.reverse(),o=0,a=0,null;a<r.length&&o<i;)(t=r[a]).date,moment(n).isAfter(t.date)&&(o+=t.count),a++;return a<r.length?r[a].date:e},getNextRangeDate:function(){var t,o,a,s,l;for(o=0,a=0,l=[],s=n;a<r.length&&o<i;)s=(t=r[a]).date,moment(n).isBefore(t.date)&&(o+=t.count,0===l.length&&o>0&&l.push(t.date)),a++;return 0===l.length?(s=moment(e).add(3,"months").toDate(),moment(n).isAfter(s)&&(s=n),[e,n]):(s===l[0]&&r[a]&&(s=moment(r[a].date).add(-1,"milliseconds").toDate()),a===r.length&&(s=moment(s).add(3,"months").toDate()),l=[moment(n).add(1,"days").toDate(),s])},getAfterDate:function(){var t,o,a,s;for(o=0,a=0,s=null;a<r.length&&o<i;)s=(t=r[a]).date,moment(e).isBefore(t.date)&&(o+=t.count),a++;return s||n},checkIsSuit:function(){var t,o,a;for(o=0,a=0;a<r.length;)t=r[a],a++,moment(t.date).isBetween(e,n)&&(o+=t.count);return o<i}}},n=function(){var o,a,s,l,u,p,f;if(!d3.event.sourceEvent||"zoom"!==d3.event.sourceEvent.type)return s=-1,d3.event.sourceEvent&&(s=d3.event.sourceEvent.offsetX),n.prev||(n.prev=[t.rangeDate.start,t.rangeDate.end]),l=n.prev,(f=d3.event.selection)&&(l=f.map(d.invert,d)),a=i(l[0],l[1]),n.skipRangeChecked||a.checkIsSuit()?(n.skipRangeChecked=!1,n.prev=l,t.rangeDate={start:l[0],end:l[1]},c.setOptions({start:l[0],end:l[1]})):(o=r.select(".brush"),p=n.prev.map((function(e){return e.getTime()})),u=l.map((function(e){return e.getTime()})),void(p.indexOf(u[0])>=0?(l[0]=a.getBeforeDate(),o.transition().duration(500).ease(d3.easeLinear).call(e.move,[d(l[0]),d(l[1])]),n.skipRangeChecked=!0):p.indexOf(u[1])>=0?(l[1]=a.getAfterDate(),o.transition().duration(500).ease(d3.easeLinear).call(e.move,[d(l[0]),d(l[1])]),n.skipRangeChecked=!0):(s>0&&s===f[0]?l[1]=a.getAfterDate():l[0]=a.getBeforeDate(),o.transition().duration(500).ease(d3.easeLinear).call(e.move,[d(l[0]),d(l[1])]),n.skipRangeChecked=!0)))},h.prototype.prev=function(o){var a,s,l,c;return null==o&&(o=50),l=t.rangeDate,c=(s=i(l.start,l.end,o).getPrevRangeDate())[0],a=s[1],r.select(".brush").transition().duration(500).ease(d3.easeLinear).call(e.move,[d(c),d(a)]),n.skipRangeChecked=!0},h.prototype.next=function(o){var a,s,l,c;return null==o&&(o=50),l=t.rangeDate,c=(s=i(l.start,l.end,o).getNextRangeDate())[0],a=s[1],r.select(".brush").transition().duration(500).ease(d3.easeLinear).call(e.move,[d(c),d(a)]),n.skipRangeChecked=!0},h.prototype.move=function(t,n){var i,o;return o=d(t),n?i=d(n):(i=o+10,o-=10),r.select(".brush").transition().duration(500).ease(d3.easeLinear).call(e.move,[o,i])},h.prototype.setSize=function(t,n){return t&&(u=t),n&&(o=n),l.attr("width",u),l.attr("height",o),l.select(".clip-rect").attr("width",u).attr("height",o),d=d3.scaleTime().range([0,u]),f=d3.scaleLinear().range([o-20,0]),p=d3.axisBottom(d).tickFormat(w),e.extent([[0,0],[u,o]]),s.x((function(e){return d(e.date)})).y((function(e){return f(e.count)}))},h.prototype.shineDocs=function(e,t){var n;return null==t&&(t={}),(n=d3.select(".d3-flashing-stars").selectAll(".shooting_star").data(e,(function(e){return moment(e.createDate).format("YYYYMMDD")}))).enter().append("div").attr("class","shooting_star").style("top","100px").style("left",(function(e){return d(moment(e.createDate).toDate())+"px"})).transition().duration(3e3).ease(d3.easeLinear),n.transition().style("opacity",1),n.exit().transition().duration(1500).ease(d3.easeLinear).style("top","10px").style("opacity",0).remove()},h.prototype.changeData=function(e,n,i){return t={allDatas:e,filterDatas:n,rangeDate:i}},h.prototype.render=function(n){var i,l,c,u,h,m,v,g,_;return a=n,i=t.allDatas,h=t.filterDatas,v=t.rangeDate,n&&(i=h),0===(c=i.slice()).length&&c.concat([{date:moment().add(2,"months").toDate()},{date:moment().add(-2,"months").toDate()}]),u=d3.extent(c,(function(e){return e.date})),moment(u[0]).diff(u[1],"days")<35&&(u=[moment(u[0]).add(-1,"months").toDate(),moment(u[1]).add(1,"months").toDate()]),u=[moment(u[0]).add(-1,"months").toDate(),moment(u[1]).add(1,"months").toDate()],d.domain(u),f.domain([0,d3.max(i,(function(e){return e.count}))]),n&&(i=i.map((function(e){return Object.assign({},e,{count:0})}))),l=r.select(".all_group"),m=r.select(".filter_group"),_=function(e){return e.attr("height",(function(e,t){return o-20-f(e.count)})).attr("y",(function(e,t){return f(e.count)})).attr("width",(function(e){var t;return(t=d(d3.timeDay.offset(e.date,10))-d(e.date))>5&&(t=5),t})).attr("x",(function(e,t){var n;return n=d(d3.timeDay.offset(e.date,10))-d(e.date),d(n>5?e.date:d3.timeDay.offset(e.date,-5))}))},(g=function(e,t,n){var i,r;return i=(r=e.selectAll("rect").data(t,(function(e){return e.date}))).enter().append("rect").attr("class",(function(e){return"path "+n})),_(i),i=r.transition().duration(500).ease(d3.easeLinear),_(i),r.exit().remove()})(l,i,"all"),g(m,h,"filter"),r.select(".filter_line_path").datum(h).transition().duration(500).ease(d3.easeLinear).attr("d",s),r.select(".axis").transition().duration(500).ease(d3.easeLinear).call(p),r.select(".brush").call(e).transition().duration(500).ease(d3.easeLinear).call(e.move,[d(v.start),d(v.end)])},h}(),s=function(e){var t,n,s,d,m,v,w,C,F,M,T,S,P,j,E,I,O,V,L,A,B,N,R,H,z,q,W,U,Y,J,G,K;function X(){return this.clearFilterInfo=k(this.clearFilterInfo,this),this.setFilterInfo=k(this.setFilterInfo,this),X.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)D.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(X,e),X.prototype.className="file_timeline_container",X.prototype.template=x,L=!1,A=!1,T=[],B=[],P=null,E=null,C={allDemoDocs:[],filterIds:[],groupByMonth:{},groupByDay:{},groupByYear:{}},G=null,J=null,S=null,U=null,Y=null,m=null,s=null,R=!1,H=null,z={start:moment().add(-10,"days").toDate(),end:moment().add(10,"days")},N=0,V=!0,M=!0,d=null,w=null,F=null,X.prototype.initialize=function(e){return F=e.fileBrowserView},X.prototype.events={"click .hide-filtered-file-btn":"toggleFilteredFileVisibleFn","click .toggle-file-timeline-btn":"toggleFileTimelineFn","click .close-file-timeline-btn":"closeFileTimelineFn","click .refresh-btn":"refreshTimelineFn","click .prev-btn":"prevTimelineFn","click .next-btn":"nextTimelineFn","click .helper-btn":"showHelperFn","click .config-btn":"showConfigFn","click .config-save-btn":"saveConfigFn","click .close-config-btn":"hideConfigFn","click .close-demo-helper-btn":"closeHelperFn","click .load-github-demo-btn":"loadGithubDemoFn","click .view-video-btn":"viewVideoFn",mouseenter:"enterTimelineFn",mouseleave:"leaveTimelineFn","mouseleave .vis-timeline":"leaveVisTimelineFn","mouseover .vis-timeline":"overVisTimelineFn","wheel .vis-timeline .vis-item.vis-box":"mouseWheelFn","click .vis-timeline":"clickVistimelineFn"},X.prototype.mouseWheelFn=function(e){var t;if(m)return e=e.originalEvent,t=CodeMirror.wheelEventPixels(e).y,m.firstElementChild.scrollTop+=t},X.prototype.clickVistimelineFn=function(e){var t;if((t=e.toElement||e.originalEvent.target)&&t.classList.contains("vis-timeline"))return this.leaveTimelineFn(null,1)},X.prototype.overVisTimelineFn=function(e){var t;if((t=e.toElement||e.originalEvent.target)&&t.classList.contains("vis-timeline")){if(!w)return this.leaveTimelineFn(null,6e3)}else if(w)return clearTimeout(w),w=null},X.prototype.leaveVisTimelineFn=function(e){var t;if((t=e.toElement||e.originalEvent.target)&&t.classList.contains("vis-timeline-container")&&w)return clearTimeout(w),w=null},X.prototype.enterTimelineFn=function(e){return w&&(clearTimeout(w),w=null),$(document.body).addClass("file_timeline_hover")},X.prototype.leaveTimelineFn=function(e,t){return null==t&&(t=600),d&&d(),this,w&&clearTimeout(w),w=setTimeout((function(){return $(document.body).removeClass("file_timeline_hover"),w=null}),t)},X.prototype.viewVideoFn=function(e){return window.openTarget("http://soft.xiaoshujiang.com/blog/file_manager/timeline_firefly/")},X.prototype.loadGithubDemoFn=function(e){var t,n;if(n=this,!(t=$(e.currentTarget)).hasClass("loading"))return t.addClass("loading"),g((function(e){return T=(C=e).filterIds,t.removeClass("loading"),n.refresh(6,{initCallback:function(){return s.prev(j())}})}))},X.prototype.closeHelperFn=function(e){var t,n,r,o,a,s,l;if(localStorage.setItem("file_timeline_helper_off","true"),this.$el.removeClass("file_timeline_container_helper"),n=this.$el.find(".helper-btn"),setTimeout((function(){return n.transition("tada")}),100),(l=i.getTourModel()).canPrompt("close_timeline_learned"))return o=(a=(t=$(".d3-brush-controller-container"))[0].getBoundingClientRect()).x+a.width/2,s=a.y+a.height/2,r=$('<div class="spotlight_container" style="\npointer-events: none;\nbackground: radial-gradient(circle at '+o+"px "+s+'px, transparent 180px, rgba(0, 0, 0, 0.4) 182px, rgba(0, 0, 0, 0.9) 900px);\n"></div>'),t.popup({on:"manual",closable:!1,position:"top left",inline:!0,onVisible:function(){var e,n;return $("body").append(r),(n=this).width(300),e=n.find(".ok"),d=function(){return d=null,r.remove(),t.popup("destroy"),n.remove()},e.click((function(){return d(),l.dontPrompt("close_timeline_learned")}))},html:'<div class="header">\n\u63d0\u793a</div>\n<div style="position:absolute;bottom: -100VH;left:-100VW;width: 200VW;height:200VH;"></div>\n<div class="content" style="padding-bottom: 25px;">\u70b9\u51fb<i class="paper plane icon big"></i>\u6309\u94ae\uff0c\u3000\u53ef\u4ee5\u6253\u5f00\u6216\u8005\u5173\u95ed\u8424\u706b\u866b\u6a21\u5f0f<br/>\n\u70b9\u51fb<i class="icon lightbulb big"></i>\u6309\u94ae\uff0c\u3000\u53ef\u4ee5\u63a7\u5236\u8fc7\u6ee4\u663e\u793a\u5185\u5bb9\n<div style="position:absolute;"><a href="javascript:void(0);" class="ok pull-right">\u77e5\u9053\u4e86</a></div>\n</div>'}).popup("show")},X.prototype.showHelperFn=function(e){return this.$el.addClass("file_timeline_container_helper")},X.prototype.hideConfigFn=function(e){return this.$el.find(".file-timeline-config-container-wrapper").remove()},X.prototype.saveConfigFn=function(e){var t,n;if(e.preventDefault(),e.stopPropagation(),t=this.$el.find(".file-timeline-config-container-wrapper input[name=pageMaxCount]"),!((n=parseInt(t.val())||50)<0||n>300))return localStorage.setItem("file_timeline_page_max_count",n),this.hideConfigFn();l.showMessage("\u6bcf\u4e2a\u65f6\u95f4\u6bb5\u663e\u793a\u6587\u7ae0\u6570\u53ea\u80fd\u57281\u5230300\u4e4b\u95f4",6e3,"error")},j=function(){var e;return((e=parseInt(localStorage.getItem("file_timeline_page_max_count")||50))<0||e>300)&&(e=50),e},X.prototype.showConfigFn=function(e){var t;return this.$el.append('<div class="file-timeline-config-container-wrapper">\n  <div class="file-timeline-config-container">\n    <i class="icon close close-config-btn link"></i>\n    <form class="ui form mini">\n      <div class="inline field">\n        <label>\u6bcf\u4e2a\u65f6\u95f4\u6bb5\u663e\u793a\u6761\u6570</label>\n        <input type="text" placeholder="50(1-300\u4e4b\u95f4)" name="pageMaxCount">\n      </div>\n      <div class="ui submit button config-save-btn mini positive">\u4fdd\u5b58</div>\n    </form>\n  </div>\n</div>'),t=j(),this.$el.find(".file-timeline-config-container-wrapper input[name=pageMaxCount]").val(t)},X.prototype.prevTimelineFn=function(e){return s.prev(j())},X.prototype.nextTimelineFn=function(e){return s.next(j())},X.prototype.refreshTimelineFn=function(e){var t,n;if(C=null,n=$(e.currentTarget),!(t=this.$el.find(".d3-brush-container")).hasClass("d3-brush-refresh-animation"))return t.addClass("d3-brush-refresh-animation"),n.addClass("loading"),setTimeout((function(){return n.removeClass("loading"),t.removeClass("d3-brush-refresh-animation")}),3e3),q(moment(z.start).toDate(),moment(z.end).toDate(),this),this.refresh(6)},X.prototype.closeFileTimelineFn=function(e){return this.$el.find(".toggle-file-timeline-btn").trigger("click")},X.prototype.toggleFileTimelineFn=function(e){var t,n,r;if(n=!1,(r=i.getUserModel().get("user"))&&r.vip&&(n=!0),"web"===STORY_PLATFORM&&(n=!0),n||l.showMessage("\u8be5\u529f\u80fd\u53ea\u5bf9\u4f1a\u5458\u5f00\u653e",6e3,"error"),!(t=$(e.currentTarget)).hasClass("plane-flying"))return M?localStorage.setItem("file_timeline_on","false"):localStorage.setItem("file_timeline_on","true"),M=!M,t.addClass("plane-flying"),this.$el.toggleClass("file_timeline_container_hidden",!M),setTimeout((function(){return t.toggleClass("on-state",M),t.removeClass("plane-flying")}),1e3),M?this.show():this.hide()},X.prototype.toggleFilteredFileVisibleFn=function(e){return V=!V,localStorage.setItem("file_timeline_hide_filtered_file",V?"true":"false"),this.$el.toggleClass("file_timeline_filtered_container",V),q(moment(z.start).toDate(),moment(z.end).toDate(),this),this.refresh(6)},X.prototype.afterRender=function(){var e,t;return Y=this.$el.find(".vis-timeline-controller-container")[0],U=this.$el.find(".vis-timeline-container")[0],localStorage.getItem("file_timeline_helper_off")||this.$el.addClass("file_timeline_container_helper"),"false"===localStorage.getItem("file_timeline_on")&&(M=!1),e=!1,(t=i.getUserModel().get("user"))&&t.vip&&(e=!0),"web"===STORY_PLATFORM&&(e=!0),e||(M=!1),M?this.$el.find(".toggle-file-timeline-btn").addClass("on-state"):this.$el.addClass("file_timeline_container_hidden"),"false"===localStorage.getItem("file_timeline_hide_filtered_file")&&(V=!1),this.$el.toggleClass("file_timeline_filtered_container",V)},X.prototype.hide=function(){return L=!1},X.prototype.show=function(e){var t,n,r,o;if(null==e&&(e={}),t=!1,(r=i.getUserModel().get("user"))&&r.vip&&(t=!0),"web"===STORY_PLATFORM&&(t=!0),t&&M&&(o=this.$el.width(),n=this,!L))return L=!0,u.asyncLoadResources([{id:"vis_js",type:"script",filename:"js/vis.js"},{id:"d3_v4_js",type:"script",filename:"js/d3.js"},{id:"vis_css",type:"style",filename:"css/vis.css"}],(function(){var t,i;if(t={},L)return i=8,G||(i=7,n.initTimeline(),n.initContextMenu()),s||(n.initBrush(),e.initCallback&&(t.initCallback=e.initCallback)),o!==N||A?(A&&(i|=4),A=!1,n.refresh(i,t),N=o):void 0}))},X.prototype.shineDocs=function(e,t){if(null==t&&(t={}),L&&s){if(s.shineDocs(e,t),t.focus)return this.focusItem(e[0],t)}else if(t.focus&&e&&e[0])return P=e[0]._id},X.prototype.changePageInfo=function(e){var t;return t=0,_.isEqual(T,e.allFileIds)||(T=e.allFileIds.slice()||[],t|=5),_.isEqual(e.fileIds,B)||(B=e.fileIds||[],t|=2),C=null,A=!0,this.refresh(t)},X.prototype.refresh=function(e,t){var i,r,o;if(null==t&&(t={}),r=this,L&&s&&(this.shineDocs([]),e&&(8&e&&(G.redraw(),o=this.$el.width(),s.setSize(o),s.render(V)),(1&e||2&e)&&(y(),V?q(moment(z.start).toDate(),moment(z.end).toDate(),this):(i=n(J),J.update(i))),4&e)))return A=!1,this.groupByDateLevel(3,(function(n,i){var o,a,l,c;return l=3,V?(a=[],i.forEach((function(e){var t,n,i;if(e&&e.key&&(t=e.key.slice(),n=e.ids,i=0,n.forEach((function(e){if(T.indexOf(e)>=0)return i++})),i>0))return t.unshift(null),2===t.length&&t.push(0),t=new(Function.prototype.bind.apply(Date,t)),a.push(t)})),c=d3.extent(a)):c=d3.extent(i,(function(e){var t;return(t=e.key.slice()).unshift(null),new(Function.prototype.bind.apply(Date,t))})),(o=Math.abs(moment(c[0]).diff(moment(c[1]),"days")))>600&&(l=2),o>7300&&(l=1),r.groupByDateLevel(l,(function(n,i){var r,c,u;if(r=[],c=[],a=[],i.forEach((function(e){var t,n,i,o;if(e&&e.key&&(t=e.key.slice(),i=e.ids,o=0,n=[],i.forEach((function(e){if(T.indexOf(e)>=0)return n.push(e),o++})),t.unshift(null),2===t.length&&t.push(0),t=new(Function.prototype.bind.apply(Date,t)),r.push({date:t,count:e.value}),(o>0||!V)&&c.push({ids:n,date:t,count:o}),o>0))return a.push(t)})),c.length>0&&1&e&&(o=Math.abs(moment(z.end).diff(z.start,"days")),1===l&&o<92&&(o=92),2===l&&o<62&&(o=62),3===l&&o<2&&(o=2),u=d3.max(a),z={start:moment(u).add(-o/2,"days").toDate(),end:moment(u).add(o/2,"days").toDate()}),s.changeData(r,c,z),s.render(V),t.initCallback)return t.initCallback()}))}))},X.prototype.changeFileModel=function(e,t){var n;if(!(n=h[e])||"demo"!==n.xsjType)return i.getFileCollection().getModelById(e,(function(e,n){return e?l.showMessage("\u6253\u5f00\u6587\u4ef6\u5931\u8d25:"+e,6e3,"error"):n?t?$(window).trigger("createNewEditor",[n,{groupId:E,callback:function(e,t){var n;if(E=e.id,n=t.$el.find(".popup_editor_file_tabs .file_item.droppable_file_item.active")[0])return appHighlightPosByEl(n)}}]):$(window).trigger("changeFileModel",[n]):l.showMessage("\u6253\u5f00\u6587\u4ef6\u5931\u8d25: \u627e\u4e0d\u5230\u8be5\u6587\u4ef6",6e3,"error")}));window.openTarget(e)},X.prototype.queryByCreateDateRange=function(e,t,n){var i;return i=r.pouchDB,this,p.length=0,c.queryByCreateDateRange(i,e,t,{include_docs:!0},(function(i,r){var o;if(!i)return o=r||[],C&&C.allDemoDocs&&C.allDemoDocs.forEach((function(n){var i;if((i=moment(n.createDate)).isAfter(e)&&i.isBefore(t))return o.push({doc:n,id:n._id,key:[i.year(),i.month(),i.date(),i.hour(),i.minute(),i.second()]})})),n(null,o);n(i)}))},X.prototype.groupByDateLevel=function(e,t){var n;return n=r.pouchDB,c.getDateView(n,(function(i,r){var o;return i?l.showMessage("\u52a0\u8f7d\u7d22\u5f15\u51fa\u9519:"+i,6e3,"error"):(o=r.viewName,n.query(o+"/by_create_date",{reduce:!0,group:!0,group_level:e}).then((function(n){var i,r,o,a,s,l;if(s=n.rows,C&&C.allDemoDocs)for(r in a=C.groupByYear,i="YYYY",2===e&&(a=C.groupByMonth,i="YYYYMM"),3===e&&(a=C.groupByDay,i="YYYYMMDD"),l=[],s.forEach((function(e){var t,n;if((n=e.key.slice()).unshift(null),n=moment(n),t=a[n.format(i)])return e.value+=t.value,e.ids=e.ids.concat(t.ids),l.push(n.format(i))})),a)o=a[r],l.indexOf(r)<0&&s.push(o);return t(null,s)})).catch((function(e){return l.showMessage("\u52a0\u8f7d\u6570\u636e\u51fa\u9519:"+e,6e3,"error"),t(e)})))}))},X.prototype.initBrush=function(){var e;return e=this.$el.width(),s=new o({width:e,timelineInstance:G})},K=function(e,t){var i,r;return r=e.startDate,i=e.endDate,e.fileTimelineView.queryByCreateDateRange(r,i,(function(i,r){var o,a;return r&&(h={},J.clear(),a=r.filter((function(e){return!V||T.indexOf(e.id)>=0})).map((function(e){var t,n,i,r,o;return n=e.doc,h[e.id]=e.doc,r="demo"===n.xsjType?'<i class="github icon"></i>':'<i class="file alternate outline icon"></i>',n.emoji&&(r='<i class="icon file_emoji">'+n.emoji+"</i>"),t=r+'<span class="vis-item-header">'+_.escape(e.doc.title)+"</span>",n.idiom&&(t+='<div class="vis-item-idiom">'+_.escape(n.idiom)+"</div>"),!(n.coverUrl||f[n._id])&&n.cover&&(i="<html>\n<body>\n  <script>window.parent._xsjLoadArticleCoverFn('"+(o=uniqueNumber())+"')<\/script>\n</body>\n</html>",t+='<iframe class="vis-item-iframe vis-item-script-'+o+'" data-docid="'+_.escape(n._id)+'" srcdoc="'+i+'"></iframe>'),{id:e.id,content:t,start:moment(e.doc.createDate).toDate()}})),o=n(a),J.add(o),V?e.fileTimelineView.$el.find(".d3-range-count").html(a.length+"/"+T.length):e.fileTimelineView.$el.find(".d3-range-count").html(r.filter((function(e){return T.indexOf(e.id)>=0})).length+"/"+r.length),L||(A=!0)),t()}))},(t=function(){var e;if(!t.isRunning)return t.isRunning=!0,e=t.args.shift(),K(e,(function(){if(t.isRunning=!1,t.args.length>0)return t()}))}).args=[],q=function(e,n,i){return t.args.length=0,t.args.push({startDate:e,endDate:n,fileTimelineView:i}),t()},X.prototype.initContextMenu=function(){return"none",".vis-timeline-controller-container",$.contextMenu({selector:".vis-timeline-controller-container",appendTo:U,trigger:"none",build:function(e,t){return{items:t.menuData.menuInfo}}})},I=function(){return m?(m.parentElement.removeChild(m),void(m=null)):m&&m.classList.contains("visible")?(m.classList.remove("visible"),m=null):void 0},O=function(){var e;if((e=U.querySelector(".file_timeline_cover_container"))&&e.classList.contains("visible"))return e.classList.remove("visible")},X.prototype.initTimeline=function(){var e,t,n,i,r,o,a,s;return s=this,o=(a=moment()).clone().add(-4,"weeks"),r=a.clone(),J=new vis.DataSet([{id:"now",content:"today",start:moment().format("YYYY-MM-DD")}]),i=new vis.DataSet([{id:"all",content:""},{id:"filter",content:""}]),G=new vis.Timeline(U,J,i,{locale:"zh-cn",start:o.format("YYYY-MM-DD"),end:r.format("YYYY-MM-DD"),zoomMin:864e5,zoomMax:321408e6,moveable:!1,zoomable:!1,autoResize:!1,tooltip:{followMouse:!0,overflowMethod:"flip",template:function(e){var t,n,i;return n="",(t=h[e.id])&&((i=F.getQueryInfo())&&F.showTempSearchResultOutlineWindow(i.queryTerms,t.title,t.content),n='<div class="file_timeline_item_tooltip_container">\n<div>\u6807\u9898: '+_.escape(t.title)+"</div>\n<div>\u6807\u7b7e: "+_.escape(t.tagNames.join(","))+'</div>\n<div style="border-bottom: 1px solid">\u65f6\u95f4: '+moment(t.createDate).format("YYYY-MM-DD")+"/"+moment(t.updateDate).format("YYYY-MM-DD")+"</div>\n</div>"),n}}}),t=function(e){var t;if((t=e.item)&&!R&&G.itemSet.getItemById(t))return O(),I(),s.changeFileModel(t,e.event.ctrlKey)},n=function(e){var t;(t=e.item)&&G.itemSet.getItemById(t)},G.on("click",(function(e){return t.timer=setTimeout((function(){return n.prevent||t(e),clearTimeout(n.timer),n.prevent=!1}),200)})),G.on("doubleClick",(function(e){return clearTimeout(t.timer),clearTimeout(n.timer),n.prevent=!0,n(e),n.timer=setTimeout((function(){return n.prevent=!1}),200)})),G.on("contextmenu",(function(e){var t,n,i,r,o;if(n=e.event,e.event.preventDefault(),(r=e.item)&&(i=G.itemSet.getItemById(r)))return i.isCluster?void 0:(o={editor:{callback:function(){return s.changeFileModel(i.id)},name:"\u5728\u7f16\u8f91\u5668\u4e2d\u6253\u5f00"},createEditor:{callback:function(){return s.changeFileModel(i.id,!0)},name:"\u5728\u6d6e\u52a8\u7f16\u8f91\u5668\u4e2d\u6253\u5f00"}},(t=h[r])&&"demo"===t.xsjType&&(o={open:{callback:function(){return window.openTarget(r)},name:"\u8bbf\u95ee: "+r}}),$(Y).trigger($.Event("contextmenu",{pageX:n.pageX,pageY:n.pageY,menuData:{menuInfo:o}})))})),G.on("itemover",(function(e){return v([e.item])})),G.on("itemout",(function(e){return v([])})),e=null,G.on("rangechanged",(function(t){var n;return R=!0,H&&clearTimeout(H),H=setTimeout((function(){return H=null,R=!1}),600),n=!0,e||(e=z),moment(t.start).isBetween(e.start,e.end)&&moment(t.end).isBetween(e.start,e.end)&&(n=!1),n?(q(moment(t.start).toDate(),moment(t.end).toDate(),s),e={start:t.start,end:t.end}):s.$el.find(".d3-range-count").html(G.getVisibleItems().length),s.$el.find(".d3-range-dates").html("<div>\n<div>"+moment(t.start).format("YYYY-MM-DD")+"</div>\n<div>"+moment(t.end).format("YYYY-MM-DD")+"</div>\n</div>"),z={start:t.start,end:t.end}}))},n=function(e){return e.map((function(e){var t,n,i,r,o,a,s,l,c;if(i=h[e.id],t=[],s=[],S&&i)switch(S.type){case"tag":for(c=S.value.split(","),r=i.tagNames||[],o=0,a=c.length;o<a;o++)if(l=c[o],r.indexOf(l)>=0){t.push("xsj-filtered");break}break;case"title":i.title.indexOf(S.value)>=0&&t.push("xsj-filtered")}return i&&(i.idiom&&t.push("xsj-item-idiom"),i.cover&&t.push("xsj-item-cover"),i.theme&&t.push("xsj-item-theme"),T.indexOf(i._id)>=0?(t.push("xsj-list-filtered"),e.group="filter"):(t.push("xsj-list-all"),e.group="all"),B.indexOf(i._id)>=0&&t.push("xsj-list-page-filtered"),P&&i._id===P&&t.push("xsj-focus-item"),i.color&&s.push("--visTimelineItemColor: "+i.color),(n=i.coverUrl||f[i._id])&&s.push("background-image: url("+n+")")),e.className=t.join(" "),s.length>0&&(e.style=s.join(";")),e}))},W=function(e){var t,n,i,r;return G.setSelection([]),e&&0!==e.length?(G.setSelection(e),i=e[0],t=h[i],n=F.$el.parent().width(),r=function(e){var r,o,a,s,l;return s=(s=$.trim(t.idiom)).split("\n").filter((function(e){return!!$.trim(e)})).join("\n"),e||s?((r=U.querySelector(".file_timeline_cover_container"))||((r=document.createElement("div")).classList.add("file_timeline_cover_container"),r.innerHTML='<div class="file_timeline_cover_idiom"><span class="file_timeline_cover_idiom_text"></span></div><img class="file_timeline_cover_image file_timeline_cover_image_current" data-id="'+_.escape(i)+'"/>',U.append(r)),r.style.left="-"+n+"px",o=r.querySelector(".file_timeline_cover_image_current"),l=null,o.dataset.id!==i&&(o.classList.remove("file_timeline_cover_image_current"),o.classList.add("file_timeline_cover_image_old"),l=o,(o=document.createElement("img")).classList.add("file_timeline_cover_image"),o.classList.add("file_timeline_cover_image_current"),o.dataset.id=i,r.prepend(o)),a=function(){var e,t;if(t=r.querySelector(".file_timeline_cover_idiom_text"),e=r.querySelector(".file_timeline_cover_idiom"),s?(e.classList.add("visible"),t.innerText=s):e.classList.remove("visible"),l)return l.classList.add("hidden"),setTimeout((function(){return l.remove()}),1e3)},e?(o.src=e,o.onload=function(){return r.classList.add("visible"),a(),"undefined"!=typeof _fileModel&&null!==_fileModel?_fileModel.removeAllAttachmentMetaCache():void 0},o.onerror=function(){return O(),a(),"undefined"!=typeof _fileModel&&null!==_fileModel?_fileModel.removeAllAttachmentMetaCache():void 0}):(r.classList.add("visible"),a(),void("undefined"!=typeof _fileModel&&null!==_fileModel&&_fileModel.removeAllAttachmentMetaCache()))):O()},function(){var e,r;if((m=U.querySelector(".file_timeline_content_container"))||((m=document.createElement("div")).classList.add("file_timeline_content_container"),m.innerHTML='<div class="file_timeline_content shadow_scroll_effect"></div>',U.append(m)),m.style.left="-"+n+"px",m.classList.add("visible"),(e=m.querySelector(".file_timeline_content")).dataset.id!==i&&(e.dataset.id=i,e.innerText=a.getRealContent(t.content.trim().replace(/\n{2,}/g,"\n")),e.scrollTop=0,"demo"===t.xsjType))return(r=document.createElement("i")).className="spinner loading icon",e.append(r),b(t,(function(){if(e.removeChild(r),t.fullContent)return e.innerText=t.fullContent}))}(),setTimeout((function(){var e;return e=t.coverUrl||f[t._id],r(e)}),100)):(O(),void I())},v=_.debounce(W,100),X.prototype.focusItem=function(e,t){var n,i,r,o;if(null==t&&(t={}),P&&(i=P,e&&e._id===P&&(i=null),i&&(o=J.get(i))&&(n=(n=o.className.split(" ")).filter((function(e){return"xsj-focus-item"!==e})),o.className=n.join(" "),J.update(o))),e)return r=e._id,P=r,(o=J.get(r))?(o.className.indexOf("xsj-focus-item")<0&&(o.className+=" xsj-focus-item"),J.update(o)):t.scrollTo?s.move(moment(e.createDate).toDate()):void 0;P=null},X.prototype.focusTime=function(e){return s.move(moment(e).toDate())},X.prototype.setFilterInfo=function(e){var t,i;return(t=Y.querySelector(".vis-timeline-filter-btn"))||(U.classList.add("vis-timeline-filter"),(t=document.createElement("div")).classList.add("vis-timeline-filter-btn","btn"),t.addEventListener("click",this.clearFilterInfo),Y.prepend(t)),S=e,t.innerHTML='<i class="fa fa-window-close-o"></i> <i class="fa fa-tags"></i> '+S.value,i=n(J),J.update(i)},X.prototype.clearFilterInfo=function(){var e,t;return S=null,(e=Y.querySelector(".vis-timeline-filter-btn"))&&(e.removeEventListener("click",this.clearFilterInfo),Y.removeChild(e)),U.classList.remove("vis-timeline-filter"),t=n(J),J.update(t)},X.prototype.getFilterInfo=function(){return S},X.prototype.destroy=function(){return $.contextMenu("destroy",".vis-timeline-controller-container"),G.destroy(),null,G=null,J=null,S=null,U=null,Y=null,m=null},X.prototype.resize=function(){},X}(d),n.exports=s}}),window.requirejs.define({"views/files_trash_manager_dialog_view":function(e,t,n){var i,r,o,a,s,l,c,u,d,p={}.hasOwnProperty;l=t("./view"),t("../lib/utils"),o=t("../lib/notifier"),i=t("../constant"),u=t("./templates/files_trash_manager_dialog"),s=t("../lib/pouchdb_index_view_manager"),a=t("./page_nav_view"),d=null,c=null,r=function(e){var t;function n(){return n.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)p.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(n,e),n.prototype.template=u,n.prototype.className="ui fullscreen story_modal modal files_trash_manager_dialog_view",n.prototype.pageNavView=null,t=function(e,t,n,i){return d.showDimmer("\u7d22\u5f15\u4e2d:"+e+" / "+t)},n.prototype.events={"click .undo_delete_button":"undoDeleteFile","click .delete_button":"deleteFile","click .all_delete_button":"deleteAllFiles","click .all_undo_delete_button":"undoAllDeleteFiles"},n.prototype.deleteAllFiles=function(e){return d.showDimmer("\u5904\u7406\u4e2d"),c.query("query_index/by_isDeleted").then((function(e){var t,n;return t=[],e.rows.length>0?(n=[],e.rows.forEach((function(e){var r,o,a;for(a in(o=e.value)._deleted=!0,n.push(o),r=o._attachments||{})r[a].content_type===i.fileContentType.attachment&&t.push(o._id+"__"+a);return o._attachments={}})),c.allDocs({keys:t}).then((function(e){return e.rows.forEach((function(e,t){if(!e.error)return n.push({_id:e.id,_rev:e.value.rev,_deleted:!0,_attachments:{}})})),c.bulkDocs(n).then((function(){var e,t;return e=d.$el.find(">.dimmer>.ui.text"),t=function(t,n,i,r){return e.html("["+t+"/"+n.length+"]\u7d22\u5f15\u4e2d:"+i+" / "+r)},s.autoBuildIndexFn(t,(function(){return o.showMessage("\u5220\u9664\u5b8c\u6210"),d.hideDimmer(),d._setBlankHtml()}))}))}))):(d.hideDimmer(),o.showMessage("\u6ca1\u6709\u9700\u8981\u64a4\u6d88\u7684\u6587\u7ae0"))}))},n.prototype.undoAllDeleteFiles=function(e){return d.showDimmer("\u5904\u7406\u4e2d"),c.query("query_index/by_isDeleted",{include_docs:!0}).then((function(e){var t;return e.rows.length>0?(t=[],e.rows.forEach((function(e){var n;return(n=e.doc).isDeleted=!1,n.updateDate=Date.now(),t.push(n)})),c.bulkDocs(t).then((function(){var e,t;return e=d.$el.find(">.dimmer>.ui.text"),t=function(t,n,i,r){return e.html("["+t+"/"+n.length+"]\u7d22\u5f15\u4e2d:"+i+" / "+r)},s.autoBuildIndexFn(t,(function(){return d.hideDimmer(),o.showMessage("\u6062\u590d\u5b8c\u6210"),d._setBlankHtml()}))}))):(d.hideDimmer(),o.showMessage("\u6ca1\u6709\u9700\u8981\u64a4\u6d88\u7684\u6587\u7ae0"))}))},n.prototype._setBlankHtml=function(){return d.hideDimmer(),d.$el.find(".trash_buttons").remove(),d.$el.find(".blank_html").show(),d.$el.find(".files_table").hide()},n.prototype.deleteFile=function(e){var t,n,r,a;return t=$(e.currentTarget),a=(n=t.parent().parent()).data("id"),n.data("rev"),r=[],c.get(a).then((function(e){var t,a,s;for(s in r.push({_id:e._id,_rev:e._rev,_deleted:!0,_attachments:{}}),t=[],a=e._attachments||{})a[s].content_type===i.fileContentType.attachment&&t.push(e._id+"__"+s);return c.allDocs({keys:t}).then((function(e){return e.rows.forEach((function(e,t){if(!e.error)return r.push({_id:e.id,_rev:e.value.rev,_deleted:!0,_attachments:{}})})),c.bulkDocs(r).then((function(){var e;return e=n.parent(),n.transition({animation:"fly left",onComplete:function(){if(n.remove(),0===e.find("tr").length)return d._setBlankHtml()}})})).catch((function(e){return o.showMessage(e,6e3,"error")}))})).catch((function(e){return o.showMessage(e,6e3,"error")}))})).catch((function(e){return o.showMessage(e,6e3,"error")}))},n.prototype.undoDeleteFile=function(e){var t,n,i;return t=$(e.currentTarget),i=(n=t.parent().parent()).data("id"),n.data("rev"),c.get(i).then((function(e){return e.isDeleted=!1,e.updateDate=Date.now(),c.put(e)})).then((function(){var e;return e=n.parent(),n.transition({animation:"fly right",onComplete:function(){if(n.remove(),0===e.find("tr").length)return d._setBlankHtml()}})})).catch((function(e){return o.showMessage(e,6e3,"error")}))},n.prototype.changeDocs=function(e){var t;if(d)return(t=this.$el.find("tbody")).html(""),e.forEach((function(e,n){return t.append('<tr data-id="'+e._id+'" data-rev="'+e._rev+'">\n  <td>'+(n+1+d.pageNavView.currentPage*d.pageNavView.perpage)+"</td>\n  <td>"+_.escape(e.title)+'</td>\n  <td class="center aligned">\n    <i class="large green undo icon undo_delete_button link" title=\'\u53d6\u6d88\u5220\u9664\'></i>\n    <i class="large red remove icon delete_button link" title=\'\u5f7b\u5e95\u5220\u9664\'></i>\n  </td>\n</tr>')}))},n.prototype.show=function(){return this.render(),this.$dimmer=this.$el.dimmer({closable:!1}),this.$el.find(".dimmer").html('<div class="ui indeterminate text loader">\u6570\u636e\u51c6\u5907\u4e2d...</div>'),this.$el.modal({closable:!1,onVisible:function(){return d.loadAllIds((function(e){var t;if(d)return(t=new a({allFileIds:e,inst:d})).render(),d.$el.find(".trash_buttons").after(t.$el),t.fetchFiles(),d.pageNavView=t}))},onHidden:function(){return d.pageNavView&&d.pageNavView.remove(),d.$el.modal("destroy"),d.$el.dimmer("destroy"),d.$el.parent().transition("destroy"),d.remove(),d.$el.parent().remove(),d=null}}).modal("show")},n.prototype.showDimmer=function(e){if(this.$dimmer.dimmer("show"),e)return this.$el.find(">.dimmer>.ui.text").html(e)},n.prototype.hideDimmer=function(){return this.$dimmer.dimmer("hide"),this.$el.find(">.dimmer>.ui.text").html("\u6570\u636e\u51c6\u5907\u4e2d...")},n.prototype.loadAllIds=function(e){return this.showDimmer(),(c=i.pouchDB).query("query_index/by_isDeleted",{descending:!0,showUpdateProgressInfo:t}).then((function(t){var n;return(n=t.rows).length>0?e(n.map((function(e){return e.id}))):d._setBlankHtml()})).catch((function(e){return o.showMessage("\u52a0\u8f7d\u6587\u4ef6\u51fa\u9519"+e,6e3,"error")}))},n.prototype.afterRender=function(){return d=this,this.$el.find(".files_table").show(),this.$el.find(".blank_html").hide()},n}(l),n.exports=r}}),window.requirejs.define({"views/filter_buttons_view":function(e,t,n){var i,r,o,a=function(e,t){return function(){return e.apply(t,arguments)}},s={}.hasOwnProperty;t("./view"),i=t("../application"),t("../constant"),t("../lib/notifier"),o=t("../lib/utils"),r=function(e){var t,n;function r(){return this.refreshCurrentFilter=a(this.refreshCurrentFilter,this),this.refreshFilterInfos=a(this.refreshFilterInfos,this),r.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)s.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(r,Backbone.View),r.prototype.className="filter_buttons ui buttons mini",n=null,t=null,r.prototype.initialize=function(e){var n;return n=i.getApplicationProfileModel(),t=n.get("currentFilter"),/^::/.test(t)&&(t="",n.save({currentFilter:""})),this.refreshFilterInfos(),this.fileBrowserView=e.fileBrowserView,this.listenTo(n,"change:filterInfos",this.refreshFilterInfos),this.listenTo(n,"change:currentFilter",this.refreshCurrentFilter)},r.prototype.events={"click .up_filter_button":"changeUpFilterFn","click .current_filter_button":"changeUpFilterFn"},r.prototype.changeUpFilterFn=function(e){var t;return e.preventDefault(),e.stopPropagation(),"temp"!==(t=$(e.currentTarget).data("value"))&&this.setCurrentFilterFn(t),this.triggerCurrentFilter()},r.prototype.triggerCurrentFilter=function(e,i){var r;return null==i&&(i=!0),r=o.getCurrentFilterInfo(t,n,e),this.fileBrowserView.filterFiles(r,i)},r.prototype.refreshUpFilters=function(){var e,t;return this.$el.find(".up_filter_button").remove(),t=[],(e=n.slice()).sort((function(e,t){return t.upTime-e.upTime})),e.filter((function(e){return!!e.up})).forEach((function(e,n){if(e.up&&n<5)return t.push('<div class="ui button icon filter_button up_filter_button" data-value="'+e.id+'" title="'+_.escape(e.name)+'">\n  <i class="'+e.icon+' fa-lg"></i>\n</div>')})),t.length>0&&this.$el.append(t.join("")),this.refreshCurrentFilter()},r.prototype.setCurrentFilterFn=function(e){var r;return r=n.find((function(t){return t.id===e})),t=r?r.id:null,i.getApplicationProfileModel().save({currentFilter:t})},r.prototype.refreshFilterInfos=function(){var e;e=i.getApplicationProfileModel(),n=e.get("filterInfos");try{n=JSON.parse(n)}catch(e){e,n=[]}return t=e.get("currentFilter"),this.refreshUpFilters()},r.prototype.refreshCurrentFilter=function(){var e,r,a,s,l;return a=i.getApplicationProfileModel(),t=a.get("currentFilter"),(l=(s=o.getCurrentFilterInfo(t,n)).id)?(this.$el.find(".filter_button.filter_active").removeClass("filter_active"),(e=this.$el.find(".filter_button[data-value="+l+"]")).length>1&&(r=e.first(),e.not(r).remove(),e=r),0===e.length?(this.$el.find(".current_filter_button").remove(),e=$('<div class="ui button icon filter_button current_filter_button" data-value="'+l+'">\n  <i class="'+s.icon+' fa-lg"></i>\n</div>'),this.$el.prepend(e)):e.hasClass("current_filter_button")?e.is("[data-value=temp]")&&e.find(">i").removeClass().addClass(s.icon+" fa-lg"):this.$el.find(".current_filter_button").remove(),e.addClass("filter_active")):(this.$el.find(".filter_button.filter_active").removeClass("filter_active"),this.$el.find(".current_filter_button").remove())},r}(),n.exports=r}}),window.requirejs.define({"views/filter_category_tab_view":function(e,t,n){var i,r,o,a,s,l,c,u=function(e,t){for(var n in t)d.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e},d={}.hasOwnProperty;t("./view"),t("../application"),i=t("../constant"),s=t("../lib/notifier"),l=t("../lib/pouchdb_index_view_manager"),a=function(e){var t;function n(){return n.__super__.constructor.apply(this,arguments)}return u(n,e),n.prototype.className="header",n.prototype.parentView=null,t=null,n.prototype.events={"keyup .filter_search_container>input":"instanceFilterResultFn"},n.prototype.initialize=function(e){var n;return this.parentView=e.parentView,n=this,t=_.debounce((function(e){var t;return t=n.parentView.$el.fancytree("getTree"),e?t.filterNodes(e,!1):t.clearFilter()}),600,!1)},n.prototype.instanceFilterResultFn=function(e){var n;return n=$(e.currentTarget).val(),t(n)},n.prototype.show=function(){return this.$el.show()},n.prototype.hide=function(){return this.$el.hide()},n}(Backbone.View),c=_.debounce((function(e,t){var n,i,r;return r=(i=$.ui.fancytree.getNode(e)).getParentList(),n=[],r&&r.forEach((function(e){return n.push(e.title)})),n.push(i.title),n.length>0?t.$el.find(".filter_tooltip_bar_content").text(n.join(" / ")):t.$el.find(".filter_tooltip_bar_content").text("")}),100),o=function(e){var t;function n(){return n.__super__.constructor.apply(this,arguments)}return u(n,e),n.prototype.className="header filter_category_footer filter_footer",n.prototype.parentView=null,t=!1,n.prototype.events={"click .toggle_expand_button":"toggleExpandFn"},n.prototype.initialize=function(e){return this.parentView=e.parentView,this},n.prototype.toggleExpandFn=function(e){var n,i;return n=$(e.currentTarget),t=!t,i=n.find(".icon"),t?(i.removeClass("add"),i.addClass("minus"),n.attr("title","\u5168\u90e8\u6298\u53e0"),this.parentView.$el.fancytree("getRootNode").visit((function(e){return e.setExpanded(!0)}))):(i.removeClass("minus"),i.addClass("add"),n.attr("title","\u5168\u90e8\u5c55\u5f00"),this.parentView.$el.fancytree("getRootNode").visit((function(e){return e.setExpanded(!1)})))},n.prototype.show=function(){return this.$el.show()},n.prototype.hide=function(){return this.$el.hide()},n}(Backbone.View),r=function(e){var n,r,d;function p(){return p.__super__.constructor.apply(this,arguments)}return u(p,e),p.prototype.className="categorys_filter_tree_container theme_tree_container",p.prototype.type="category",p.prototype.footerView=null,p.prototype.headerView=null,d=!1,r=function(e){var t;return t=new a({parentView:e}),e.headerView=t,t.render(),t.$el.html('<div class="ui icon search input fluid filter_search_container">\n   <i class="search icon"></i>\n   <input type="text" placeholder="\u8f93\u5165\u641c\u7d22\u8bcd...">\n </div>'),e.filterDropdownView.$el.find(".tab_header").after(t.$el)},n=function(e){var t;return t=new o({parentView:e}),e.footerView=t,t.render(),t.$el.html('<div class="ui button filter_help_button icon" title="\u5e2e\u52a9"><i class="question circle outline icon"></i></div>\n<div class="ui button toggle_expand_button icon right floated" title="\u5168\u90e8\u5c55\u5f00"><i class="add circle icon"></i></div>\n<div class="filter_tooltip_bar">\n  <div class="filter_tooltip_bar_content">\n  </div>\n</div>'),e.filterDropdownView.$el.find(">.menu").append(t.$el)},p.prototype.initialize=function(e){var o,a,c;return c=this,this.filterDropdownView=e.filterDropdownView,this.fileBrowserView=e.fileBrowserView,this.$target=e.$target,this.render(),this.$dimmer=this.$target.find(".dimmer"),this.$dimmer.dimmer({onShow:function(){return c.$dimmer.find(".ui.text").html("\u52a0\u8f7d\u4e2d")}}),this.$dimmer.dimmer("show"),this.$target.append(this.$el),a=function(e,t,n,i){return c.$dimmer.find(".ui.text").html("\u7d22\u5f15\u4e2d:"+e+" / "+t)},o=i.pouchDB,t("../lib/dynamic_import/import_fancytree")((function(){return l.getCategoryAndFlagView(o,(function(e,t){var i;return e?s.showMessage("\u52a0\u8f7d\u7d22\u5f15\u51fa\u9519:"+e,6e3,"error"):(i=t.viewName,o.query(i+"/by_category",{reduce:!0,group:!0,showUpdateProgressInfo:a}).then((function(e){var t,i,o,a,s,l;if(c.filterDropdownView)return c.$dimmer.dimmer("hide"),i=e.rows,t={},i.reduce((function(e,t){var n;return e[n=(n=t.key.replace(/^\/*|\/*$/g,"")).replace(/\/+/g,"/")]?e[n]+=t.value:e[n]=t.value,e}),t),a={},i.forEach((function(e){var t,n;return(t=e.key.replace(/^[\/]*|[\/]*$/g,"").replace(/\/+/g,"/").split(/[\/]/)).length,n=a,t.forEach((function(e,t){return n[e]||(n[e]={}),n=n[e]}))})),(s=function(e,n,i){var r,o,a,l,c,u;for(l in i&&(i+="/"),c=[],n)u=n[l],o=t[a=i+l],0===Object.keys(u).length?c.push(e.push({title:l,key:a,count:o,goto:!!o,folder:!1})):(r=[],e.push({title:l,key:a,count:o,goto:!!o,folder:!0,children:r}),c.push(s(r,u,a)));return c})((l={title:"\u6839\u76ee\u5f55",key:"/",children:[]}).children,a,""),o={click:function(e,t){var n;return(n=$(e.originalEvent.target)).hasClass("xsj_goto_button")?(e.preventDefault(),e.stopPropagation(),c.filterDropdownView.setCurrentFilterFn("::category::"+JSON.stringify(t.node.key)),c.filterDropdownView.triggerCurrentFilter()):n.hasClass("xsj_goto_more_button")?(e.preventDefault(),e.stopPropagation(),c.filterDropdownView.setCurrentFilterFn("::category::"+JSON.stringify("xsjStartsWith##"+t.node.key)),c.filterDropdownView.triggerCurrentFilter()):t.node.folder?void 0:(c.filterDropdownView.setCurrentFilterFn("::category::"+JSON.stringify(t.node.key)),c.filterDropdownView.triggerCurrentFilter())},extensions:["wide","glyph","xsjcounter","xsjgotobtn","filter"],filter:{mode:"dimm"},clickFolderMode:3,source:l,wide:{levelOfs:"20px"},glyph:{map:{doc:"far fa-folder",checkbox:"fa fa-square-o",checkboxSelected:"fa fa-check-square-o",checkboxUnknown:"fa fa-square",error:"fa fa-warning",expanderClosed:"fa fa-caret-right",expanderLazy:"fa fa-angle-right",expanderOpen:"fa fa-caret-down",folder:"far fa-folder",folderOpen:"far fa-folder-open",loading:"fa fa-spinner fa-pulse"}}},c.$el.fancytree(o),d=!0,r(c),n(c)})).catch((function(e){return c.$dimmer.dimmer("hide"),s.showMessage("\u52a0\u8f7d\u5217\u8868\u51fa\u9519:"+e,6e3,"error")})))}))}))},p.prototype.events={"mouseenter span.fancytree-title":"mouseenterTreeNodeFn"},p.prototype.mouseenterTreeNodeFn=function(e){return c(e,this.footerView)},p.prototype.destroy=function(){return d&&this.$el.fancytree("destroy"),d=!1,this.hide(),this.filterDropdownView=null,this.fileBrowserView=null,this.footerView&&(this.footerView.remove(),this.footerView=null),this.headerView&&(this.headerView.remove(),this.headerView=null),this.remove()},p.prototype.show=function(){if(this.$target.show(),this.footerView&&this.footerView.show(),this.headerView)return this.headerView.show()},p.prototype.hide=function(){if(this.$target.hide(),this.footerView&&this.footerView.hide(),this.headerView)return this.headerView.hide()},p}(Backbone.View),n.exports=r}}),window.requirejs.define({"views/filter_custom_tab_view":function(e,t,n){var i,r,o,a,s,l,c,u,d,p=function(e,t){for(var n in t)f.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e},f={}.hasOwnProperty;t("./view"),r=t("../application"),o=t("../constant"),u=t("../lib/notifier"),i=t("./add_filter_dialog_view"),d=t("./tags_map_window_view"),c=t("./link_map_window_view"),a=t("./decision_map_window_view"),l=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return p(t,e),t.prototype.className="header",t.prototype.parentView=null,t.prototype.events={"click .add_filter_button":"addFilterFn","click .tags_map_window_button":"showTagsMapWindowFn","click .link_map_window_button":"showLinkMapWindowFn","click .decision_map_window_button":"showDecisionMapWindowFn"},t.prototype.initialize=function(e){return this.parentView=e.parentView},t.prototype.showDecisionMapWindowFn=function(e){var t;if(!(t=$(e.currentTarget)).hasClass("loading"))return t.addClass("loading"),o.pouchDB.allDocs({include_docs:!0}).then((function(e){var n;return t.removeClass("loading"),n=e.rows.map((function(e){return e.doc})).filter((function(e){return"markdown"===e.type})),new a({initDocs:n}).show()}))},t.prototype.showTagsMapWindowFn=function(){return new d({}).show()},t.prototype.showLinkMapWindowFn=function(e){var t;if(!(t=$(e.currentTarget)).hasClass("loading"))return t.addClass("loading"),o.pouchDB.allDocs({include_docs:!0}).then((function(e){var n,i,o;return t.removeClass("loading"),(o=e.rows.map((function(e){return e.doc})).filter((function(e){return"markdown"===e.type}))).sort((function(e,t){return e.createDate-t.createDate})),n=r.homeView.editorView,i=r.homeView.editorView.getActiveEditorProxy().fileModel,new c({fileModel:i,editorView:n,initDocs:o}).show()}))},t.prototype.addFilterFn=function(){return this.parentView.filterDropdownView.getFilterInfos().length>50?u.showMessage("\u6dfb\u52a0\u5931\u8d25\uff0c\u6700\u591a\u6dfb\u52a0 50 \u4e2a\u8fc7\u6ee4\u5668",6e3,"error"):(new i).show()},t.prototype.show=function(){return this.$el.show()},t.prototype.hide=function(){return this.$el.hide()},t}(Backbone.View),s=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return p(t,e),t.prototype.className="custom_filter_container",t.prototype.type="system",t.prototype.footerView=null,t.prototype.initialize=function(e){var t;return this.filterDropdownView=e.filterDropdownView,this.fileBrowserView=e.fileBrowserView,this.$target=e.$target,this.render(),t=new l({parentView:this}),this.footerView=t,t.render(),t.$el.html('<div class="ui button filter_help_button icon" title="\u5e2e\u52a9"><i class="question circle outline icon"></i></div>\n<div class="ui button add_filter_button icon right floated" title="\u6dfb\u52a0\u65b0\u7684\u8fc7\u6ee4\u89c4\u5219"><i class="edit icon"></i></div>'),this.filterDropdownView.$el.find(">.menu").append(t.$el)},t.prototype.destroy=function(){return this.filterDropdownView=null,this.fileBrowserView=null,this.footerView.remove(),this.footerView=null,this.remove()},t.prototype.show=function(){return this.$target.show(),this.footerView.show()},t.prototype.hide=function(){return this.$target.hide(),this.footerView.hide()},t}(Backbone.View),n.exports=s}}),window.requirejs.define({"views/filter_date_tab_view":function(e,t,n){var i,r,o,a,s=function(e,t){for(var n in t)l.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e},l={}.hasOwnProperty;t("../application"),t("../constant"),t("../lib/notifier"),t("../lib/utils"),t("../lib/pouchdb_index_view_manager"),i=t("./calendar_view"),a=_.debounce((function(e,t,n){var i,r,o,a,s,l,c,u,d;if(l=$(e.currentTarget).data("date"),c="",a=null,u=0,"range"===n.selectMode&&n.rangeInitDate)for(o in s=n.rangeInitDate,r=n.getDateInfo(),a=n.rangeDates?n.rangeDates:moment(s).isBefore(l)?[s,l]:[l,s],r)d=r[o],moment(o).isBetween(a[0],a[1],"day","[]")&&(u+=d.ids.length);return a||(i=n.getDateInfo(l))&&(u=i.ids.length),c=a?moment(a[0]).format("YYYY/MM/DD")+"-"+moment(a[1]).format("YYYY/MM/DD")+" (\u603b\u5171 "+u+" \u7bc7)":moment(l).format("YYYY/MM/DD")+" (\u603b\u5171 "+u+" \u7bc7)",t.$el.find(".filter_tooltip_bar_content").text(c)}),100),o=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return s(t,e),t.prototype.className="header filter_date_footer filter_footer",t.prototype.parentView=null,t.prototype.events={"click .toggle_range_button":"toggleRangeModeFn"},t.prototype.initialize=function(e){return this.parentView=e.parentView},t.prototype.toggleRangeModeFn=function(e){return $(e.currentTarget),this.parentView.calendarView.changeSelectMode("day"===this.parentView.calendarView.selectMode?"range":"day")},t.prototype.updateSelectModeStatus=function(e){return this.$el.find(".toggle_range_button").toggleClass("active","range"===e)},t.prototype.show=function(){return this.$el.show()},t.prototype.hide=function(){return this.$el.hide()},t}(Backbone.View),r=function(e){var t;function n(){return n.__super__.constructor.apply(this,arguments)}return s(n,e),n.prototype.className="date_filter_table_container scrolling menu",n.prototype.type="date",n.prototype.calendarView=null,t=function(e){var t;return t=new o({parentView:e}),e.footerView=t,t.render(),t.$el.html('<div class="ui button filter_help_button icon" title="\u5e2e\u52a9"><i class="question circle outline icon"></i></div>\n<div class="ui button toggle_range_button icon right floated" title="\u8fdb\u5165\u65f6\u95f4\u8303\u56f4\u9009\u62e9\u6a21\u5f0f"><i class="calendar plus outline icon"></i></div>\n<div class="filter_tooltip_bar">\n  <div class="filter_tooltip_bar_content">\n  </div>\n</div>'),e.filterDropdownView.$el.find(">.menu").append(t.$el)},n.prototype.changeFilterFn=function(e){return this.filterDropdownView.setCurrentFilterFn("::date::"+JSON.stringify(e)),this.filterDropdownView.triggerCurrentFilter()},n.prototype.initialize=function(e){var n,r;return r=this,this.filterDropdownView=e.filterDropdownView,this.fileBrowserView=e.fileBrowserView,this.$target=e.$target,this.render(),this.$dimmer=this.$target.find(".dimmer"),this.$dimmer.dimmer({onShow:function(){return r.$dimmer.find(".ui.text").html("\u52a0\u8f7d\u4e2d")}}),this.$dimmer.dimmer("show"),this.$target.append(this.$el),(n=new(i())({selectMode:"day"})).render(),this.calendarView=n,$("<div class='ui calendar'></div>"),this.$el.append(n.$el),n.on("showDimmer",(function(e){return r.$dimmer.find(".ui.text").html(e)})),n.on("hideDimmer",(function(){return r.$dimmer.dimmer("hide")})),n.on("dateSelect",(function(e){return r.changeFilterFn(moment(e).format("YYYYMMDD"))})),n.on("dateRangeSelect",(function(e,t){if(t)return r.changeFilterFn(moment(e).format("YYYYMMDD")+"-"+moment(t).format("YYYYMMDD"))})),n.on("selectModeChanged",(function(e){return r.footerView.updateSelectModeStatus(e)})),t(this)},n.prototype.events={"mouseenter .calendar>table.day td.link":"mouseenterDateNodeFn"},n.prototype.mouseenterDateNodeFn=function(e){return a(e,this.footerView,this.calendarView,this)},n.prototype.destroy=function(){return this.calendarView&&(this.calendarView.remove(),this.calendarView=null),this.hide(),this.filterDropdownView=null,this.fileBrowserView=null,this.footerView&&(this.footerView.remove(),this.footerView=null),this.remove()},n.prototype.show=function(){if(this.$target.show(),this.footerView)return this.footerView.show()},n.prototype.hide=function(){if(this.$target.hide(),this.footerView)return this.footerView.hide()},n}(Backbone.View),n.exports=r}}),window.requirejs.define({"views/filter_dropdown_view":function(e,t,n){var i,r,o,a,s,l,c,u,d,p,f,h,m,v,g=function(e,t){return function(){return e.apply(t,arguments)}},w={}.hasOwnProperty;m=t("./view"),r=t("../application"),t("../constant"),p=t("../lib/notifier"),h=t("../lib/utils"),f=t("../lib/recently_use_filter_manager"),i=t("./add_filter_dialog_view"),o=t("./files_trash_manager_dialog_view"),u=t("./filter_recently_tab_view"),s=t("./filter_custom_tab_view"),a=t("./filter_category_tab_view"),d=t("./filter_tag_tab_view"),l=t("./filter_date_tab_view"),v=t("./templates/filter_dropdown"),c=function(e){var t,n,c,m,y,b,x,k,D;function C(){return this.refreshFilterInfos=g(this.refreshFilterInfos,this),this.refreshCurrentFilter=g(this.refreshCurrentFilter,this),C.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)w.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(C,e),C.prototype.template=v,C.prototype.className="ui button icon filter_button main_filter_button dropdown icon",b=null,t=null,n=null,m=null,c=null,x=null,k=null,y=null,D=null,C.prototype.initialize=function(e){var t,n;return t=r.getApplicationProfileModel(),this.refreshFilterInfos(),this.fileBrowserView=e.fileBrowserView,this.listenTo(t,"change:filterInfos",this.refreshFilterInfos),this.listenTo(t,"change:currentFilter",this.refreshCurrentFilter),$(window).on("changeFilterInfo",(n=this,function(e,t,i){var o,a,s,l,c;switch(t){case"tag":c=i,n.setCurrentFilterFn("::tag::"+JSON.stringify(c));break;case"reverse":a={type:"reverse",value:[]},(o=i)||r.homeView.fileModel&&(o=r.homeView.fileModel.attributes),o&&(a.value.push(o._id),a.value.push(o.title),(l=o.slug)&&a.value.push(l)),s=JSON.stringify(JSON.stringify(a)),n.setCurrentFilterFn("::system::"+s)}return n.triggerCurrentFilter()}))},C.prototype.events={"click .up_help_button":"upHelpFn","click .reverse_help_button":"reverseHelpFn","click .delete_filter_button":"deleteFilterFn","click .edit_filter_button":"editFilterFn","click .set_up_filter_button":"upFilterFn","click .xsj_patch_menu>.item":"useFilterFn","click .xsj_patch_menu>.item>.ui.buttons>.ui.button":"useFilterFn","click .list_filter_button":"changeListFilterFn","click >.menu":"preventPopapFn","click .filter_help_button":"filterHelpFn",click:"changeUpFilterFn"},C.prototype.filterHelpFn=function(){return window.openTarget("http://soft.xiaoshujiang.com/docs/tutorial/filter/")},C.prototype.changeUpFilterFn=function(e){var t;if((t=$(e.currentTarget)).toggleClass("xsj_actived"),!t.hasClass("xsj_actived"))return t.dropdown("hide")},C.prototype.changeListFilterFn=function(e){var t,n,i,o,a,s,l;if(!(n=$(e.currentTarget)).hasClass("active"))return this.$el.find(".list_filter_button.active").removeClass("active"),n.addClass("active"),l=n.data("type"),this.changeListFilter(l),(s=r.getTourModel()).canPrompt("stick_filter_mode_learned")?(i=(o=this.el.getBoundingClientRect()).x+o.width/2,a=o.y+o.height/2,t=$('<div class="spotlight_container" style="\nbackground: radial-gradient(circle at '+i+"px "+a+'px, transparent 80px, rgba(0, 0, 0, 0.4) 182px, rgba(0, 0, 0, 0.9) 900px);\n">\n  <div style="position: absolute;left: '+i+"px;top: "+a+'px; display: inline-block;">\n    <div class="ui success message">\n      <div class="header">\u70b9\u51fb\u8be5\u6309\u94ae\uff0c\u53ef\u4ee5\u9501\u5b9a\u8fc7\u6ee4\u5668\u9875\u9762</div>\n      <div class="ui button primary ok_button">\u77e5\u9053\u4e86</div>\n    </div>\n  </div>\n</div>'),$("body").append(t),this.$el.addClass("xsj_actived"),t.find(".ok_button").click((function(){return s.dontPrompt("stick_filter_mode_learned"),t.remove()}))):void 0},C.prototype.changeListFilter=function(e){var t,i,r,o,p;if(n){if(n.type===e)return;n.hide()}switch(t=this.$el.find(".categorys_filter_container"),i=this.$el.find(".customs_filter_container"),o=this.$el.find(".recently_filter_container"),p=this.$el.find(".tags_filter_container"),r=this.$el.find(".date_filter_container"),e){case"category":c||(c=new a({fileBrowserView:this.fileBrowserView,filterDropdownView:this,$target:t})),n=c;break;case"recently":x||(x=new u({fileBrowserView:this.fileBrowserView,filterDropdownView:this,$target:o})),n=x;break;case"tag":k||(k=new d({fileBrowserView:this.fileBrowserView,filterDropdownView:this,$target:p})),n=k;break;case"date":y||(y=new l({fileBrowserView:this.fileBrowserView,filterDropdownView:this,$target:r})),n=y;break;default:m||(m=new s({fileBrowserView:this.fileBrowserView,filterDropdownView:this,$target:i})),this.$el.find(".menu>.menu").empty(),this.$el.dropdown("refreshItems"),this.$el.dropdown("queryRemote",""),m.type=e,n=m}return n.show()},C.prototype.preventPopapFn=function(e){return e.preventDefault(),e.stopPropagation()},C.prototype.useFilterFn=function(e){var t;if(e.preventDefault(),e.stopPropagation(),t=$(e.currentTarget).data("value"))if('::system::"recycle"'!==t){if('::function::"create"'!==t)return"draft"===t&&(t=""),this.setCurrentFilterFn(t),this.triggerCurrentFilter()}else(new o).show()},C.prototype.upFilterFn=function(e){var n,i,o,a;if(e.preventDefault(),e.stopPropagation(),n=$(e.currentTarget).parent(),(o=n.data("value"))&&(a=b.find((function(e){return e.id===o}))))return!a.up&&b.filter((function(e){return e.up})).length>=5?void p.showMessage("\u7f6e\u9876\u5931\u8d25\uff0c\u6700\u591a\u652f\u6301 5 \u4e2a\u8fc7\u8651\u5668\u7f6e\u9876",6e3,"error"):(a.up=!a.up,a.upTime=Date.now(),i=r.getApplicationProfileModel(),a.up||a.id!==t||(t=""),a.up?n.addClass("up_filter"):n.removeClass("up_filter"),i.save({currentFilter:t,filterInfos:JSON.stringify(b)}))},C.prototype.setCurrentFilterFn=function(e){return f.addFilter(e),r.getApplicationProfileModel().save({currentFilter:e})},C.prototype.refreshCurrentFilter=function(){var e;return e=r.getApplicationProfileModel(),t=e.get("currentFilter")},C.prototype.editFilterFn=function(e){var t,n,r;if(e.preventDefault(),e.stopPropagation(),t=$(e.currentTarget).parent(),n=t.data("value"))return r=b.find((function(e){return e.id===n})),(new i).show(r)},C.prototype.deleteFilterFn=function(e){var n,i,o,a;return e.preventDefault(),e.stopPropagation(),n=$(e.currentTarget).parent(),(o=n.data("value"))&&(a=_.filter(b,(function(e){return e.id!==o})),o===t&&(t=null),(i=r.getApplicationProfileModel()).set(),i.save({currentFilter:t,filterInfos:JSON.stringify(a)})),n.remove()},C.prototype.getFilterInfos=function(){return b},C.prototype.refreshFilterInfos=function(){var e;e=r.getApplicationProfileModel(),b=e.get("filterInfos");try{b=JSON.parse(b)}catch(e){e,b=[]}return t=e.get("currentFilter")},C.prototype.reverseHelpFn=function(e){return e.preventDefault(),e.stopPropagation(),window.openTarget("http://soft.xiaoshujiang.com/docs/tutorial/internal_link/")},C.prototype.upHelpFn=function(e){return e.preventDefault(),e.stopPropagation(),window.openTarget("http://soft.xiaoshujiang.com/docs/tutorial/article_pinned/")},C.prototype.triggerCurrentFilter=function(){var e;return e=h.getCurrentFilterInfo(t,b),this.fileBrowserView.filterFiles(e)},C.prototype.initFilterBtns=function(e){var t,i;return i=this,this.render(),e.replaceWith(this.$el),(t=this.$el).dropdown({on:"hover",saveRemoteData:!1,forceSelection:!1,filterRemoteData:!1,forceSelection:!1,className:{selected:"skip_selected"},delay:{show:1,hide:2e3},templates:{menu:function(e,t){var n,i;return i=e[t.values]||{},"            ",n=[],i.length>7,$.each(i,(function(e,i){var o,a,s,l,c,u,d;if(o=i.selected?"active":"",s=i.info,"system"===i.type)switch(i[t.value]){case"reverse":return l={type:"reverse",value:[]},(a=r.homeView.fileModel)&&(l.value.push(a.id),(u=a.get("slug"))&&l.value.push(u)),c=JSON.stringify(JSON.stringify(l)),n.push('<div class="item" data-value=\'::system::'+_.escape(c)+'\'>\n  <i class="fas fa-bezier-curve icon user_icon"></i>\n  <i class="question circle outline right floated icon reverse_help_button help_button"></i>\n  '+i[t.name]+"\n</div>"),n.push('<div class="divider"></div>');case"recycle":return n.push('<div class="item" data-value=\'::system::"recycle"\'>\n  <i class="recycle icon user_icon"></i>\n  '+i[t.name]+"\n</div>");case"up":return n.push('<div class="item" data-value=\'::system::"up"\'>\n  <i class="fas fa-thumbtack icon user_icon"></i>\n  <i class="question circle outline right floated icon up_help_button help_button"></i>\n  '+i[t.name]+"\n</div>");case"recentUpdateDate":return n.push('<div class="item" data-value=\'::system::"thirtyUpdate"\'>\n  <i class="clock outline icon user_icon"></i>\n  \u6700\u8fd1\n  <div class="ui buttons">\n    <div class="ui button" data-value=\'::system::"threeUpdate"\'>3</div>/\n    <div class="or" data-text="/"></div>\n    <div class="ui button" data-value=\'::system::"sevenUpdate"\'>7</div>/\n    <div class="or" data-text="/"></div>\n    <div class="ui button" data-value=\'::system::"thirtyUpdate"\'>30</div>\n  </div>\n  \u5929\u66f4\u65b0\u7684\u6587\u7ae0\n</div>');case"nameRangeUpdateDate":return n.push('<div class="item" data-value=\'::system::"thisMonthUpdate"\'>\n  <i class="clock outline icon user_icon"></i>\n  <div class="ui buttons icon">\n    <div class="ui button" data-value=\'::system::"thisWeekUpdate"\'>\u8fd9\u661f\u671f</div>/\n    <div class="or" data-text="/"></div>\n    <div class="ui button" data-value=\'::system::"lastWeekUpdate"\'>\u4e0a\u661f\u671f</div>/\n    <div class="or" data-text="/"></div>\n    <div class="ui button" data-value=\'::system::"thisMonthUpdate"\'>\u8fd9\u4e2a\u6708</div>\n  </div>\n  \u66f4\u65b0\u7684\u6587\u7ae0\n</div>');case"recentCreateDate":return n.push('<div class="item" data-value=\'::system::"thirty"\'>\n  <i class="fas fa-clock icon user_icon"></i>\n  \u6700\u8fd1\n  <div class="ui buttons">\n    <div class="ui button" data-value=\'::system::"three"\'>3</div>/\n    <div class="or" data-text="/"></div>\n    <div class="ui button" data-value=\'::system::"seven"\'>7</div>/\n    <div class="or" data-text="/"></div>\n    <div class="ui button" data-value=\'::system::"thirty"\'>30</div>\n  </div>\n  \u5929\u521b\u5efa\u7684\u6587\u7ae0\n</div>');case"nameRangeCreateDate":return n.push('<div class="item" data-value=\'::system::"thisMonth"\'>\n  <i class="fas fa-clock icon user_icon"></i>\n  <div class="ui buttons icon">\n    <div class="ui button" data-value=\'::system::"thisWeek"\'>\u8fd9\u661f\u671f</div>/\n    <div class="or" data-text="/"></div>\n    <div class="ui button" data-value=\'::system::"lastWeek"\'>\u4e0a\u661f\u671f</div>/\n    <div class="or" data-text="/"></div>\n    <div class="ui button" data-value=\'::system::"thisMonth"\'>\u8fd9\u4e2a\u6708</div>\n  </div>\n  \u521b\u5efa\u7684\u6587\u7ae0\n</div>');case"main":return n.push('<div class="item" data-value=\'::system::"draft"\'>\n  <div class="ui buttons icon huge">\n    <div class="ui button" data-value=\'::system::"draft"\'>\n      <i class="fas fa-file-signature icon user_icon"></i>\n      \u8349\u7a3f\n    </div>/\n    <div class="or" data-text="/"></div>\n    <div class="ui button" data-value=\'::system::"archive"\'>\n      <i class="fas fa-briefcase icon user_icon"></i>\n      \u5f52\u6863\n    </div>/\n    <div class="or" data-text="/"></div>\n    <div class="ui button" data-value=\'::system::"all"\'>\n      <i class="fas fa-archive icon user_icon"></i>\n      \u5168\u90e8\n    </div>\n  </div>\n</div>')}else{if("function"!==i.type)return d=s.up?"up_filter":"",n.push('<div class="item '+o+" "+d+'" data-value="'+i[t.value]+'" data-name="'+_.escape(i[t.name])+'">\n<i class="right floated icon close delete_filter_button link"></i>\n<i class="right floated icon edit edit_filter_button link"></i>\n<i class="right floated close set_up_filter_button arrow up icon link alternate circle outline"></i>\n<i class="'+s.icon+' icon user_icon"></i>\n'+_.escape(i[t.name])+"\n  </div>");switch(i[t.value]){case"create":return n.push('<div class="item" data-value=\'::function::"'+i[t.value]+'"\'>\n  <i class="info circle icon"></i>\n  '+i[t.name]+"\n</div>")}}})),"            \n"+n.join("")}},action:function(){},onShow:function(){return i.changeListFilter(),$(".main_west_wrapper").css({zIndex:"6"}),$(".store>.store_buttons").css({overflow:"visible"}),D&&(clearTimeout(D),D=null),$(".store").addClass("dropdown_open"),!0},onHide:function(e){var i;return!t.hasClass("xsj_actived")&&(D&&(clearTimeout(D),D=null),D=setTimeout((function(){return $(".main_west_wrapper").css({zIndex:"0"}),$(".store>.store_buttons").css({overflow:""}),$(".store").removeClass("dropdown_open")}),1e3),(i=$(this)).find(".list_filter_button.active").removeClass("active"),i.find(".list_filter_button[data-type=system]").addClass("active"),i.find(".menu>.menu").empty(),i.dropdown("refreshItems"),n=null,null!=m&&m.destroy(),m=null,null!=c&&c.destroy(),c=null,null!=x&&x.destroy(),x=null,null!=k&&k.destroy(),k=null,null!=y&&y.destroy(),y=null)},apiSettings:{className:{loading:"skip_loading"},responseAsync:function(e,t){return setTimeout((function(){var e;return e=[],n&&"custom"===n.type?(b.forEach((function(t){return e.push({name:t.name,value:t.id,type:"custom",info:t})})),0===e.length&&e.push({name:"\u4f60\u8fd8\u672a\u521b\u5efa\u4efb\u4f55\u81ea\u5b9a\u4e49\u8fc7\u6ee4\u5668",value:"create",type:"function"})):(e.unshift({name:"\u56de\u6536\u7ad9",type:"system",value:"recycle"}),e.unshift({name:"\u5f15\u7528\u5f53\u524d\u6587\u7ae0\u7684\u6587\u7ae0",type:"system",value:"reverse"}),e.unshift({name:"\u7f6e\u9876\u7684\u6587\u7ae0",type:"system",value:"up"}),e.unshift({name:"\u6700\u8fd1\u4fee\u6539\u7684\u6587\u7ae0",type:"system",value:"recentUpdateDate"}),e.unshift({name:"\u6700\u8fd1\u521b\u5efa\u7684\u6587\u7ae0",type:"system",value:"recentCreateDate"}),e.unshift({name:"\u4fee\u6539\u7684\u6587\u7ae0",type:"system",value:"nameRangeUpdateDate"}),e.unshift({name:"\u521b\u5efa\u7684\u6587\u7ae0",type:"system",value:"nameRangeCreateDate"}),e.unshift({name:"main",type:"system",value:"main"})),t({success:!0,results:e})}),1)}}})},C}(m),n.exports=c}}),window.requirejs.define({"views/filter_recently_tab_view":function(e,t,n){var i,r,o,a,s={}.hasOwnProperty;i=t("../application"),a=t("../lib/utils"),o=t("../lib/recently_use_filter_manager"),r=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)s.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,Backbone.View),t.prototype.className="recently_use_filter_list_container scrolling menu",t.prototype.type="recently",t.prototype.events={"click .item":"changeFilterFn"},t.prototype.applyFilter=function(e){return this.filterDropdownView.setCurrentFilterFn(e),this.filterDropdownView.triggerCurrentFilter()},t.prototype.changeFilterFn=function(e){var t;return e.preventDefault(),e.stopPropagation(),$(e.target),t=$(e.currentTarget).data("value"),this.applyFilter(t)},t.prototype.initialize=function(e){return this,this.filterDropdownView=e.filterDropdownView,this.fileBrowserView=e.fileBrowserView,this.$target=e.$target,this.render(),this.$target.append(this.$el)},t.prototype.renderItems=function(e){var t;return t=[],e.forEach((function(e){if(e&&e.id)return t.push('<div data-value="'+_.escape(e.id)+'" class="item"><i class="'+e.icon+' fa-lg icon"></i>'+_.escape(e.name)+"</div>")})),this.$el.html(t.reverse().join(""))},t.prototype.destroy=function(){return this.hide(),this.filterDropdownView=null,this.fileBrowserView=null,this.remove()},t.prototype.show=function(){var e,t,n;n=o.getFilters(),e=i.getApplicationProfileModel(),t=e.get("filterInfos");try{t=JSON.parse(t)}catch(e){e,t=[]}return n=n.map((function(e){var n;return"temp"===(n=a.getCurrentFilterInfo(e,t)).id&&(n.id=e),n})),this.renderItems(n),this.$target.show()},t.prototype.hide=function(){return this.$target.hide()},t}(),n.exports=r}}),window.requirejs.define({"views/filter_tag_tab_view":function(e,t,n){var i,r,o,a,s,l,c,u,d=function(e,t){for(var n in t)p.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e},p={}.hasOwnProperty;t("../application"),i=t("../constant"),s=t("../lib/notifier"),l=t("../lib/pouchdb_index_view_manager"),u=t("./tags_map_window_view"),c=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return d(t,e),t.prototype.className="selected_tags_list",t.prototype.parentView=null,t.prototype.events={"click .unselected_tag_button":"unSelectedTagFn"},t.prototype.initialize=function(e){return this.parentView=e.parentView},t.prototype.unSelectedTagFn=function(e){var t;return e.preventDefault(),e.stopPropagation(),t=$(e.currentTarget).parent().data("value"),this.parentView.toggleSelectedTag(t)},t.prototype.toggleSelectedTag=function(e){var t;return(t=this.$el.find(".selected_tag[data-value="+CSS.escape(e)+"]")).length>0?t.remove():this.$el.append('<div class="selected_tag" data-value="'+e+'"><i class="times circle outline icon link unselected_tag_button"></i>'+e+"</div>")},t}(Backbone.View),o=function(e){var t;function n(){return n.__super__.constructor.apply(this,arguments)}return d(n,e),n.prototype.className="header",n.prototype.parentView=null,t=null,n.prototype.events={"keyup .filter_search_container>input":"instanceFilterResultFn"},n.prototype.initialize=function(e){var n;return this.parentView=e.parentView,n=this,t=_.debounce((function(e){return n.parentView.renderTags(e)}),600,!1)},n.prototype.instanceFilterResultFn=function(e){var n;return n=$(e.currentTarget).val(),t(n)},n.prototype.show=function(){return this.$el.show()},n.prototype.hide=function(){return this.$el.hide()},n}(Backbone.View),r=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return d(t,e),t.prototype.className="header",t.prototype.parentView=null,t.prototype.events={"click .apply_button":"applyFilterFn","click .tags_map_window_button":"showTagsMapWindowFn"},t.prototype.initialize=function(e){return this.parentView=e.parentView,this},t.prototype.showTagsMapWindowFn=function(){var e,t;return e={},(t=this.parentView.getSelectedTags())&&t.length>0&&(e={usedTags:t}),new u(e).show()},t.prototype.applyFilterFn=function(e){var t;return t=$(e.currentTarget).data("type"),this.parentView.applyTagsFilter(null,t)},t.prototype.updateApplyFilterButtonStatus=function(e){var t,n,i,r,o,a,s;if(a=Object.keys(e),t=this.$el.find(">.ui.button.apply_button"),a.length<1)return t.css("display","none");for(i in n=null,s=null,e)e[i],r=this.parentView.getTagInfo(i),o=r.ids,n?(n=n.filter((function(e){return o.indexOf(e)>=0})),o.forEach((function(e){if(s.indexOf(e)<0)return s.push(e)}))):(n=o,s=o);return t.find(".union_count").html("("+s.length+")"),t.find(".intersection_count").html("("+n.length+")"),t.css("display","")},t.prototype.show=function(){return this.$el.show()},t.prototype.hide=function(){return this.$el.hide()},t}(Backbone.View),a=function(e){var t,n,a,u,p,f,h;function m(){return m.__super__.constructor.apply(this,arguments)}return d(m,e),m.prototype.className="tags_filter_list_container scrolling menu",m.prototype.type="tag",t={},n=[],h={},f="",m.prototype.events={"click .item":"changeFilterFn"},u=function(e){var t;return t=new o({parentView:e}),e.headerView=t,t.render(),t.$el.html('<div class="ui icon search input fluid filter_search_container">\n   <i class="search icon"></i>\n   <input type="text" placeholder="\u8f93\u5165\u641c\u7d22\u8bcd...">\n </div>'),e.filterDropdownView.$el.find(".tab_header").after(t.$el)},a=function(e){var t;return t=new r({parentView:e}),e.footerView=t,t.render(),t.$el.html('<div class="ui button filter_help_button icon" title="\u5e2e\u52a9"><i class="question circle outline icon"></i></div>\n<div class="ui button apply_button icon right floated" title="\u4ea4\u96c6" data-type="intersection" style="display:none;outline: 1px dashed; outline-offset: -1px;">\n  <i class="filter icon"></i>\u4ea4\u96c6<span class="intersection_count"></span>\n</div>\n<div class="ui button apply_button icon right floated" title="\u5e76\u96c6" data-type="union" style="display:none;">\n  <i class="vertically flipped filter icon"></i>\u5e76\u96c6<span class="union_count"></span>\n</div>'),e.filterDropdownView.$el.find(">.menu").append(t.$el)},p=function(e){var t;return t=new c({parentView:e}),e.selectedTagView=t,t.render(),e.$target.append(t.$el)},m.prototype.getTagInfo=function(e){return t[e]},m.prototype.toggleSelectedTag=function(e){var t;return t=this.$el.find(".item[data-value="+CSS.escape(e)+"]>i"),h[e]?(delete h[e],t.removeClass("check")):(h[e]=!0,t.addClass("check")),this.selectedTagView.toggleSelectedTag(e),this.footerView.updateApplyFilterButtonStatus(h)},m.prototype.getSelectedTags=function(){return Object.keys(h)},m.prototype.applyTagsFilter=function(e,t){var n,i;if(0!==(e=e||Object.keys(h)).length)return i=e.join(","),n="::tag::"+JSON.stringify(i),"union"===t&&(n="::unionTag::"+JSON.stringify(i)),this.filterDropdownView.setCurrentFilterFn(n),this.filterDropdownView.triggerCurrentFilter()},m.prototype.changeFilterFn=function(e){var t,n,i,r,o;return e.preventDefault(),e.stopPropagation(),t=$(e.target),n=$(e.currentTarget),i=null!=t?t.hasClass("icon"):void 0,e.ctrlKey&&(i=!0),Object.keys(h).length>0&&(i=!0),r=n.data("value"),i?this.toggleSelectedTag(r):(o=[r],this.applyTagsFilter(o))},m.prototype.initialize=function(e){var r,o,c;return c=this,this.filterDropdownView=e.filterDropdownView,this.fileBrowserView=e.fileBrowserView,this.$target=e.$target,this.render(),this.$dimmer=this.$target.find(".dimmer"),this.$dimmer.dimmer({onShow:function(){return c.$dimmer.find(".ui.text").html("\u52a0\u8f7d\u4e2d")}}),this.$dimmer.dimmer("show"),this.$target.append(this.$el),p(this),r=i.pouchDB,o=function(e,t,n,i){return c.$dimmer.find(".ui.text").html("\u7d22\u5f15\u4e2d:"+e+" / "+t)},l.getCategoryAndFlagView(r,(function(e,i){return e?s.showMessage("\u52a0\u8f7d\u7d22\u5f15\u51fa\u9519:"+e,6e3,"error"):(i.viewName,r.query("query_index/by_tagNames",{reduce:!0,group:!0,showUpdateProgressInfo:o}).then((function(e){var i;if(c.filterDropdownView)return c.$dimmer.dimmer("hide"),i=e.rows,n=[],t={},(i=_.sortBy(i,"value")).forEach((function(e){return t[e.key]=e,n.push(e.key)})),h={},c.renderTags(),u(c),a(c)})).catch((function(e){return c.$dimmer.dimmer("hide"),s.showMessage("\u52a0\u8f7d\u5217\u8868\u51fa\u9519:"+e,6e3,"error")})))}))},m.prototype.renderTags=function(e){var i,r,o;return f=e||"",r=[],o=n.map((function(e){var n;return{name:(n=t[e]).key,value:n.key,count:n.value,score:n.value}})),(i=new FilteredList(o)).setFilter(f),i.filtered.forEach((function(e){var t;return t=h[e.name]?"check":"",r.push('<div data-value="'+_.escape(e.name)+'" class="item"><i class="ui square outline right floated icon '+t+'"></i>'+e.name+(e.count?"("+e.count+")":"")+"</div>")})),this.$el.html(r.join(""))},m.prototype.destroy=function(){return t={},n=[],h=[],this.hide(),this.filterDropdownView=null,this.fileBrowserView=null,this.footerView&&(this.footerView.remove(),this.footerView=null),this.headerView&&(this.headerView.remove(),this.headerView=null),this.selectedTagView&&(this.selectedTagView.remove(),this.selectedTagView=null),this.remove()},m.prototype.show=function(){if(this.$target.show(),this.footerView&&this.footerView.show(),this.headerView)return this.headerView.show()},m.prototype.hide=function(){if(this.$target.hide(),this.footerView&&this.footerView.hide(),this.headerView)return this.headerView.hide()},m}(Backbone.View),n.exports=a}}),window.requirejs.define({"views/home_view":function(e,t,n){var i,r,o,a,s,l,c,u,d,p,f,h,m,v,g,w,y,b,x,k,D,C,F,M,T,S,P,j,E,I,O,V,L,A,B,N,R,H=function(e,t){return function(){return e.apply(t,arguments)}},z={}.hasOwnProperty;x=t("./view"),R=t("./templates/home"),d=t("../lib/notifier"),i=t("../application"),b=t("../lib/utils"),c=t("../lib/utils_leader_line"),I=t("../lib/dynamic_import/import_parse_depence"),p=t("../lib/pouchdb_index_view_manager"),o=t("../constant"),y=t("./store_view"),a=t("./editor_view"),u=t("./main_toolbar_view"),m=t("./preview_view"),w=t("./save_as_dialog_view"),f=t("./preview_center_view"),s=t("./exports/export_file_dialog_view"),g=t("./save_all_unsync_dialog_view"),l=t("./file_model_history_dialog_view"),t("../models/editor_profile_model"),t("../models/file_model"),t("models/file_collection"),t("../models/preview_profile_model"),h=t("./preview_free_layout_dialog_view"),v=t("./preview_viewer_manager_view"),r=t("../lib/config_sync"),k=t("../lib/default_xsj_commands"),N=function(e){var t;if((t=N.prevUrl||"")&&/^blob:/i.test(t)&&window.URL.revokeObjectURL(t),N.prevUrl=null,e&&/^data:/i.test(e))try{e=b.dataURL2ObjectURL(e),N.prevUrl=e}catch(t){t,console.log("error theme url:",e)}return document.documentElement.style.setProperty("--themeBackgroundImage",e?"url("+e+")":null)},j=function(e){return $.getJSON("css/themes.json").then((function(t,n){var i,r,o;for(i in r={},t)(o=t[i]).colors&&(r[i]=o);return e(null,r)})).fail((function(t){return e(t,{})}))},E=function(e,t){var n,i,r,o,a;for(i in a={},e)(n=e[i]).key=i,"dark"===t?n.dark&&(a[i]=n):"light"===t&&n.dark||(a[i]=n);return(r=(o=Object.keys(a)).length)<=0?null:a[o[_.random(0,r-1)]]},A=function(e){var t,n;if(e)return t=function(e){return"body{font-family: "+e+"'Helvetica Neue', Helvetica, Arial, sans-serif;}\n.ui.button, .ui.header, body, h1, h2, h3, h4, h5{\nfont-family: "+e+"'Helvetica Neue', Helvetica, Arial, sans-serif;\n}\n.ui.category.search>.results .category>.name, .ui.modal>.header, .ui.popup>.header, .ui.search>.results .result .title, .ui.search>.results>.message .header{\nfont-family: "+e+"'Helvetica Neue', Helvetica, Arial, sans-serif;\n}\n.ui.accordion .title:not(.ui), .ui.card>.content>.header, .ui.cards>.card>.content>.header, .ui.items>.item>.content>.header, .ui.message .header, .ui.statistic>.label, .ui.statistic>.value, .ui.statistics .statistic>.label, .ui.statistics .statistic>.value{\nfont-family: "+e+"'Helvetica Neue', Helvetica, Arial, sans-serif;\n  }"},n=b.parseCssText(t(e+", "),t("")),b.importCssString(n,"custom-body-font-style",!0,document);$("#custom-body-font-style").text("")},B=function(e){var t;if(e)return t=b.parseCssText(e,""),b.importCssString(t,"custom-global-style",!0,document);$("#custom-global-style").text("")},V=function(e,t,n){var i,r,o;return t=t||{},o=e.thumbnailBackground,r=e.resources,(i=e.path)||(i="css/themes/templates/default-background.css"),r||(o=null,i="css/themes/templates/no-background.css"),e.resources&&(e.resources.backgroundImage||(o=null,i="css/themes/templates/no-background.css")),o&&$(".pusher_background").append('<div class="pusher_thumbnail"></div>'),$.get(i).done((function(i,a,s){var l,c;return c={},l=function(e,t){var n;return n=r[e],o&&"backgroundImage"===e&&(n=o),b.urlToDataURL(n,(function(n,i){return i&&(c[e]=i),t()}))},async.mapLimit(Object.keys(r),10,l,(function(){var r,a,s,l,u,d,p;if(l={resources:c,backgroundCss:"background-image: var(--themeBackgroundImage, none);",thumbnailCss:"",baseThemeCss:"",extraCss:""},e.baseColors){for(u in a=[":root {"],d=e.baseColors)p=d[u],a.push("  --"+u+": "+p+";");a.push("}"),l.baseThemeCss=a.join("\n")}return e.extraCss&&(l.extraCss=e.extraCss),o&&(l.thumbnailCss=".pusher_background>.pusher_thumbnail {\n  position: absolute;\n  top: 0px;\n  bottom: 0px;\n  left: 0px;\n  right: 0px;\n  opacity: 1;\n  transition: all 1s;\n  background-repeat: no-repeat;\n  background-size: cover;\n  background-position: center;\n  background-image: url("+c.backgroundImage+");\n}"),l.backgroundCss?N(c.backgroundImage):N(null),r=_.template(i)(l),s=window.URL.createObjectURL(new Blob([r])),t.downloadFirst?o?b.urlToDataURL(e.resources.backgroundImage,(function(e,n){return b.importCssUrl(s,"story_theme",!0,document,(function(){return N(n),$(".pusher_background>.pusher_thumbnail").css("opacity",0),"function"==typeof t.callback?t.callback():void 0}))})):b.importCssUrl(s,"story_theme",!0,document,(function(){})):b.importCssUrl(s,"story_theme",!0,document,(function(){if(o)return b.urlToDataURL(e.resources.backgroundImage,(function(e,t){return N(t),$(".pusher_background>.pusher_thumbnail").css("opacity",0)}))})),n()}))})).fail((function(e){return n(e)}))},L=function(e){var t,n,i;return(t=document.getElementsByTagName("meta").namedItem("theme-color"))&&t.remove(),n="white",e.dark&&(n="black"),e.colors&&(n=e.colors.base00),(i=document.createElement("meta")).name="theme-color",i.content=n,document.head.appendChild(i),document.documentElement.style.setProperty("--themeColor",n)},O=function(e,t,n){var i,o,a,s;null==n&&(n={}),a=null;try{a=JSON.parse(e)}catch(e){a=null}if(a&&"object"==typeof a&&(L(a),o=a.key,$("body").toggleClass("app_dark_theme",!!a.dark),o))return t.removeClass((function(e,t){var n,i;if(t)return n=t.split(/\s+/),function(){var e,t,r;for(r=[],e=0,t=n.length;e<t;e++)0===(i=n[e]).indexOf("story-theme-")&&r.push(i);return r}().join(" ")})).addClass("story-theme-"+o),i="css/themes/base16-"+o+".css",a.path&&(i=a.path),$(".pusher_background>.pusher_thumbnail").remove(),(s=a.template)?V(s,n,(function(e){})):a.themeId?r.getTheme(a.themeId,{attachments:!0,binary:!1},(function(e,t){var i,r,o;if(t)return s={path:t.templatePath,resources:{}},t.baseTheme&&t.baseTheme.colors&&(s.baseColors=t.baseTheme.colors,L(t.baseTheme)),t.extraCssText&&(s.extraCss=t.extraCssText),(r=(i=t._attachments||{}).backgroundImage)&&(s.resources.backgroundImage="data:"+r.content_type+";base64,"+r.data),(o=i.thumbnail)&&(s.thumbnailBackground="data:"+o.content_type+";base64,"+o.data),V(s,n,(function(e){}))})):(N(null),b.importCssUrl(i,"story_theme",!0))},C=37,S=function(){var e;if(e=$(window).width(),!screenfull.isFullscreen)return e<=768?($(".wmd_button_group1").appendTo($(".wmd_button_group1_layout_container")),$(".wmd_button_group2").appendTo($(".wmd_button_group2_layout_container")),$(".wmd_button_group3").appendTo($(".wmd_button_group3_layout_container")),$(".wmd_button_group4").appendTo($(".wmd_button_group4_layout_container"))):768<e&&e<=992?($(".wmd_button_group1").appendTo($(".wmd_button_group1_container")),$(".wmd_button_group2").appendTo($(".wmd_button_group2_layout_container")),$(".wmd_button_group3").appendTo($(".wmd_button_group3_layout_container")),$(".wmd_button_group4").appendTo($(".wmd_button_group4_container"))):992<e&&e<=1199?($(".wmd_button_group1").appendTo($(".wmd_button_group1_container")),$(".wmd_button_group2").appendTo($(".wmd_button_group2_container")),$(".wmd_button_group3").appendTo($(".wmd_button_group3_layout_container")),$(".wmd_button_group4").appendTo($(".wmd_button_group4_container"))):($(".wmd_button_group1").appendTo($(".wmd_button_group1_container")),$(".wmd_button_group2").appendTo($(".wmd_button_group2_container")),$(".wmd_button_group3").appendTo($(".wmd_button_group3_container")),$(".wmd_button_group4").appendTo($(".wmd_button_group4_container")))},P=_.throttle(S,1e3),T=null,D=!1,M=null,F=null,n.exports=function(e){var n,x;function S(){return this.hideLoader=H(this.hideLoader,this),this.showLoader=H(this.showLoader,this),this.showNoFileDimmer=H(this.showNoFileDimmer,this),S.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)z.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(S,e),S.prototype.id="main",S.prototype.className="root xsj_no_scroll_container",S.prototype.events={"click .create_new_file_button":"createNewFileFn","click .show_store_button":"showStoreFn","mouseenter .ui.dimmer.no_file .create_new_file_button":"mouseenterCreateNewFileBtnFn","mouseenter .ui.dimmer.no_file .show_store_button":"mouseenterShowStoreBtnFn"},S.prototype.createNewFileFn=function(){return $(window).trigger("newFileModel")},S.prototype.showStoreFn=function(){return i.execCommand("toggleFileListPanel")},S.prototype.mouseenterCreateNewFileBtnFn=function(e){var t;if(t=$(".main_function_buttons .ui.button.new_file")[0])return appHighlightPosByEl(e.currentTarget,{skipIfHighlighting:!0}),appHighlightPosByEl(t,{autoHideTimeout:3e3,offsetTop:20})},S.prototype.mouseenterShowStoreBtnFn=function(e){var t;if((t=$(".no_open_file>.ui-layout-resizer-west-closed>.ui-layout-toggler-west-closed")[0])||(t=$(".no_open_file .store_footer>.close_store_button")[0]),t)return appHighlightPosByEl(e.currentTarget,{skipIfHighlighting:!0}),appHighlightPosByEl(t,{autoHideTimeout:3e3,offsetTop:20})},S.prototype.template=R,S.prototype.layout=null,x={},n=!1,S.prototype.initialize=function(e){return this.initFileModel=e.fileModel,this.fileCollection=i.getFileCollection(),this.storeView=new y({fileModel:null,fileCollection:this.fileCollection}),this.editorView=new a({model:i.getEditorProfileModel()}),this.mainToolbarView=new u({model:null}),this.previewView=new m({model:i.getPreviewProfileModel()}),this.previewCenterView=new f({previewView:this.previewView}),this.applicationProfileModel=i.getApplicationProfileModel()},S.prototype.showNoFileDimmer=function(e){return null==e&&(e='\u8fd8\u672a\u6253\u5f00\u4efb\u4f55\u6587\u7ae0\uff0c<br/>\u70b9\u51fb\u5de6\u4e0a\u89d2\u7684<span class="ui button icon create_new_file_button positive tiny" style="margin:0 1em;"><i class="icon edit"></i>\u65b0\u5efa</span>\u6309\u94ae,\u521b\u5efa\u6587\u7ae0\uff0c\n  <br/>\u6216\u8005\u70b9\u51fb<span class="ui button show_store_button tiny positive" style="margin: 0 1em;">\u6587\u7ae0\u5217\u8868</span>\u6253\u5f00\u6587\u7ae0\u3002'),this.$loader.addClass("no_file"),this.$el.addClass("no_open_file"),this.$loader.html('<div class="center">\n  <h2 class="ui header">\n    <span style="font-family:webfontxiaoshujiang;font-size: 3rem;">\u5c0f\u4e66\u5320</span>\n  </h2>\n  <div><p style="text-align: left;line-height: 3;">'+e+"</p></div>\n</div>"),this.$loader.show(),$(".title_button").hide()},S.prototype.showLoader=function(e,t){var n;if(t=t||"\u5904\u7406\u4e2d...",this.$loader.removeClass("no_file"),this.$el.removeClass("no_open_file"),this.$loader.html("<div class='ui large text loader'>"+t+"</div>"),this.$loader.show("fast"),e)return(n=this.$loader.data("jqXHR"))&&n.abort(),this.$loader.data("jqXHR",e)},S.prototype.hideLoader=function(e){if(this.$loader.removeClass("no_file"),this.$el.removeClass("no_open_file"),this.$loader.hide("fast"),e)return this.$loader.data("jqXHR")===e&&null,this.$loader.data("jqXHR","")},S.prototype.revertFileModel=function(e,t,n){var i;return i=this,e.revert(t,(function(t,r){return t?(d.showMessage("\u6062\u590d\u7248\u672c\u51fa\u73b0\u9519\u8bef:"+t,6e3,"error"),n(t)):(e===i.fileModel&&(i.changeFileModel(e),i=null),e.save({},{force:!0,success:function(){return"function"==typeof n?n(null):void 0},error:function(e){return"function"==typeof n?n(null):void 0}}))}))},S.prototype.changeFileModel=function(e,t){var n,r,o,a,s,l,u,d,p;if(null==t&&(t={scrollTo:!0,callback:null,openInActiveIf:!1}),t.openInActiveIf&&this.editorView.getActiveEditorProxy(!1)!==this.editorView.editorProxy)return(n=this.editorView.getActiveEditorView(!1)).changeFileModel(e,t),void(t.leaderLine&&(p=t.leaderLine,c.showLeaderLine(p.source,[n.editorProxy.$el],{autoHide:!0})));if(e){var f;this.fileModel&&this.stopListening(this.fileModel),this.fileModel=e,o=_.debounce((f=this,function(){var e,t;return t=f.fileModel.get("title"),(e=f.fileModel.get("fullPath"))&&(t=t+"("+e+")"),$("title, .client_title_info").text(t)}),2e3),this.listenTo(this.fileModel,"change:title",o),r=_.debounce(function(e){return function(){var t,n,r,o,a;if(!e.applicationProfileModel.has("autoAddTag")||e.applicationProfileModel.get("autoAddTag")){for("string"==typeof(a=e.fileModel.get("tagNames")||"")&&(a=a.split(",")),r=[],t=0,n=a.length;t<n;t++)(o=a[t])&&r.push(i.getTagModel().addTag(o));return r}}}(this),5e3),this.listenTo(this.fileModel,"change:tagNames",r),d=this.fileModel.get("isSys"),this.previewView.changeFileModel(this.fileModel),this.editorView.changeFileModel(this.fileModel,t),this.mainToolbarView.changeFileModel(this.fileModel);try{this.storeView.changeFileModel(this.fileModel,t)}catch(e){a=e,console.error(a)}return d&&!$("body").hasClass("only_preview_mode")?$(window).trigger("toggleLinePathMode",!0):$(window).trigger("toggleLinePathMode",!1),$(window).trigger("fileModelChanged",[e]),t&&t.callback&&t.callback(e,this.editorView,this.editorView),u=this.fileModel.get("title"),(l=this.fileModel.get("fullPath"))&&(u=u+"("+l+")"),$("title, .client_title_info").text(u),this.hideLoader(),s=this.fileModel.getMeta(),this.changeTempTheme(s.theme)}this.showNoFileDimmer()},S.prototype.initLayout=function(e){var t,r,o,a,s,l,c,u,d,p,f,m;return this.$el.find(">.ui-layout-west").replaceWith(this.storeView.render().$el),this.storeView.afterAttach(),this.$el.append(this.mainToolbarView.render().$el),i.delayFns.push((m=this,function(){return m.mainToolbarView.afterAttach()})),i.delayFns.push(function(e){return function(){var t,n;return n=e.applicationProfileModel.get("themeInfo"),"development"!==ENV||"web"!==STORY_PLATFORM||n||(t=e.$el,$.getJSON("css/random-themes.json?fver="+moment().format("YYYY-MM-DD"),(function(e,n,i){var r,o,a,s,l,c,u,d;for(s in u=[null],e)"xsj"===(a=e[s]).author&&(a.key=s,a.value=s,u.push(a));if(d=u.length,l=_.random(0,d-1),(c=u[l])&&(O(JSON.stringify(c),t,{downloadFirst:!0}),(r=$(".editor_buttons")).addClass("editor_buttons_active"),'.editor_buttons.editor_buttons_active{ opacity: 1;}\n.editor_buttons_active .editor_theme_button{\n  background-image: var(--vip-background-image);\n}\n.editor_buttons_active .editor_theme_button>.icon_tip{\n  opacity: 1!important;\n  visibility: visible!important;\n  font-size: 1.5em;\n  padding: 2em!important;\n  background-image: var(--vip-background-image);\n  top: -1.5em!important;\n  font-weight: bolder!important;\n}\n.editor_buttons_active .editor_theme_button>.icon_tip:before{\n  content: "\u70b9\u51fb\u8fd9\u91cc: ";\n}',b.importCssString('.editor_buttons.editor_buttons_active{ opacity: 1;}\n.editor_buttons_active .editor_theme_button{\n  background-image: var(--vip-background-image);\n}\n.editor_buttons_active .editor_theme_button>.icon_tip{\n  opacity: 1!important;\n  visibility: visible!important;\n  font-size: 1.5em;\n  padding: 2em!important;\n  background-image: var(--vip-background-image);\n  top: -1.5em!important;\n  font-weight: bolder!important;\n}\n.editor_buttons_active .editor_theme_button>.icon_tip:before{\n  content: "\u70b9\u51fb\u8fd9\u91cc: ";\n}',"editor_buttons_temp_css",!0),r.one("click",".editor_theme_button",(function(){return r.removeClass("editor_buttons_active"),$("#editor_buttons_temp_css").remove()}))),"development"===ENV)return(o=$("<div class='ui button' style='position: fixed; bottom:0;right: 0;z-index: 100000;'>next theme</div>")).on("click",(function(){if(l+=1,c=u[l%=d])return O(JSON.stringify(c),t)})),$("body").append(o)}))),O(n,e.$el)}}(this)),f=(t=$(window)).width(),p=t.height(),console.log("init width, height:::::"),console.log(t.width(),window.innerWidth,window.outerWidth),console.log(t.height(),window.innerHeight,window.outerHeight),o=this.applicationProfileModel.get("windowWidth"),r=this.applicationProfileModel.get("windowHeight"),l=this.applicationProfileModel.get("font"),A(l),a=this.applicationProfileModel.get("css"),B(a),u=this.previewView.layoutPosition,s=_.debounce((function(e){var t;return(t=e.width())<10&&(t=10),document.documentElement.style.setProperty("--filePanelWidth",t+"px")}),600),c={stateManagement__enabled:!0,stateManagement__includeChildren:!0,onload_start:function(e,t,i){var r,o,a,s,l,c;if((s=i.north)&&s.initHidden&&(s.initHidden=!1,s.initClosed=!1),e.state.stateData.center){for(a in r=e.state.stateData.center.children.layout1,o=u,"free"===u&&n&&(o="east"),l=[],r)c=r[a],"center"!==a?a===o?l.push(c.initHidden=!1):(c.initClosed=!0,l.push(c.initHidden=!0)):l.push(void 0);return l}},enableCursorHotkey:!1,fxName:"none",west__size:300,west__minSize:100,west__maxSize:.5,west__closable:!0,west__togglerLength_open:0,west__spacing_open:5,west__onresize_end:function(e){return function(){return s(e.storeView.$el)}}(this),west__onopen_end:function(e){return function(){return e.layout.west.state.isSliding?e.storeView.$el.addClass("slide_open"):e.storeView.$el.removeClass("slide_open")}}(this),north__size:37,north__closable:!0,north__togglerLength_open:0,north__spacing_open:1,north__resizable:!1,center__maskIframesOnResize:!0,center__onresize_end:function(e){return function(){return e.editorView.resize()}}(this),center__childOptions:{fxName:"none",enableCursorHotkey:!1,maskIframesOnResize:!0,center__onresize_end:function(e){return function(){return e.editorView.resize()}}(this),east__size:.5,east__maxSize:.9,east__onopen_end:function(e){return function(){return e.previewView.startSyncPreview("east")}}(this),east__onclose_start:function(e){return function(){return e.previewView.previewButtonsView.tocDropdownView.hide(),e.previewView.stopSyncPreview("east"),!0}}(this),east__initHidden:!0,west__size:200,west__maxSize:.9,west__onopen_end:function(e){return function(){return e.previewView.startSyncPreview("west")}}(this),west__onclose_start:function(e){return function(){return e.previewView.previewButtonsView.tocDropdownView.hide(),e.previewView.stopSyncPreview("west"),!0}}(this),west__initHidden:!0,north__size:200,north__maxSize:.9,north__onopen_end:function(e){return function(){return e.previewView.startSyncPreview("north")}}(this),north__onclose_start:function(e){return function(){return e.previewView.previewButtonsView.tocDropdownView.hide(),e.previewView.stopSyncPreview("north"),!0}}(this),north__initHidden:!0,south__size:200,south__maxSize:.9,south__onopen_end:function(e){return function(){return e.previewView.startSyncPreview("south")}}(this),south__onclose_start:function(e){return function(){return e.previewView.previewButtonsView.tocDropdownView.hide(),e.previewView.stopSyncPreview("south"),!0}}(this),south__initHidden:!0}},d=t.width(),"client"===STORY_PLATFORM&&(d=nw.Window.get().width||d),(d<=768||768<d&&d<=929)&&(c.west__initHidden=!0),b.isMobileDevice()&&delete c.west__maxSize,console.log("set auto load false",o,f,r,p,this.applicationProfileModel.get("windowMaximize")),"client"===STORY_PLATFORM&&(o===f&&r===p||this.applicationProfileModel.get("windowMaximize")||(c.stateManagement__autoLoad=!1)),"free"!==this.previewView.layoutPosition&&d>768&&(c.center__childOptions[(this.previewView.layoutPosition||"east")+"__initHidden"]=!1),this.layout=this.$el.layout(c),this.layout.children.center.layout1.options.onresizeall_start=function(){return!n},$("body").css("overflow-y","hidden"),this.editorView.initEditor(this.layout,function(t){return function(){var n,r,o;return i.delayFns.push((function(){return P(),I((function(){}))})),(r=new h({model:t.previewView.model,previewView:t.previewView,resetScrollMap:function(){return this.previewView.resetScrollMap()}})).render(),r.$el.hide(),t.$el.append(r.$el),t.previewView.initPreview(t.editorView,t.layout,{east:t.$el.find(".ui-layout-center .ui-layout-east"),south:t.$el.find(".ui-layout-center .ui-layout-south"),west:t.$el.find(".ui-layout-center .ui-layout-west"),north:t.$el.find(".ui-layout-center .ui-layout-north"),free:r}),t.previewCenterView.initPreiewCenterButtons(),(o=new v({model:t.previewView.model,previewView:t.previewView})).render(),t.$el.append(o.$el),t.changeFileModel(t.initFileModel),t.bindEvent(),n=t,i.delayFns.push((function(){if(b.isMobileDevice())return b.asyncLoadResources([{id:"hammer_js",type:"script",filename:"js/hammer/hammer.js"}],(function(){return n.bindMobileEvent()}))})),e()}}(this))},S.prototype.getCommands=function(){return x},S.prototype.addCommands=function(){var e;return e=i.getKeyboardProfileModel(),Mousetrap.reset(),Object.keys({}).forEach((function(t,n){var r,o;if(r=e.attributes[t],(o=e.keyFun(t))&&(x[t]={shortcut:r.command,fn:function(e,t){return o(t)}},r.command))return Mousetrap.bind(r.command,(function(e){if(!i.sidebarView.isOpen())return x[t].fn(i,e)}))})),Object.keys(k).forEach((function(e,t){var n;if(n=k[e],x[e]={fn:n.fn},n.shortcuts&&n.shortcuts.length>0)return n.shortcuts.forEach((function(t){return t=t.value||t,Mousetrap.bind(t,(function(t){if(!i.sidebarView.isOpen())return x[e].fn(i,t,n)}))}))}))},S.prototype.execCommand=function(e,t,n){if(!i.sidebarView.isOpen())return n=n||window.event||{preventDefault:function(){},stopPropagation:function(){}},(e=x[e])?e.fn(i,n,t):void 0},S.prototype.bindUserKeyBoard=function(e){var t;if(this.addCommands(),t=this.editorView,e&&e.length>0)return e.forEach((function(e){var n;if(!e.range||"app"===(n=e.range)||"all"===n)return e.shortcuts&&e.shortcuts.length>0?e.shortcuts.forEach((function(n){if(n.value)return Mousetrap.bind(n.value,(function(n){if(!i.sidebarView.isOpen())return x[e.command]?x[e.command].fn(i,n,e):t.getActiveEditorView().execCommand(e.command,e,n)}))})):void 0}))},S.prototype.bindMobileEvent=function(){var e,t,n;return e=this.layout,t=this.previewView,n=this.layout.center.state.innerWidth-10,this.$el.hammer().bind("swipeleft",(function(){if(!screenfull.isFullscreen)return e.west.state.isClosed&&t.isClosed()?(t.open(!1),setTimeout((function(){return t.mobileSlideOpen()}),100)):e.west.state.isClosed?void 0:e.hide("west")})),this.$el.hammer().bind("swiperight",(function(){if(!screenfull.isFullscreen)return e.west.state.isClosed&&t.isClosed()?(e.show("west",!1),setTimeout((function(){return e.slideOpen("west"),e.sizePane("west",n)}),100)):t.isClosed()?void 0:t.close()}))},S.prototype.changeTempTheme=function(e){var t,n;if(t=this,n=function(){var e;if(t.changeTempTheme.prevTempTheme)return t.changeTempTheme.prevTempTheme=null,e=t.applicationProfileModel.get("themeInfo")||o.defaultThemeInfo,O(e,t.$el)},e){if(/^theme_|^xsj-/i.test(e)||(e="theme_"+e),"client"!==STORY_PLATFORM&&/^xsj-/i.test(e)&&(e=null),t.changeTempTheme.prevTempTheme!==e){if(t.changeTempTheme.prevTempTheme=e,!/^xsj-/i.test(e))return r.getTheme(e,{},(function(i,r){var o,a;return r?(o=r.baseTheme&&r.baseTheme.dark,a={key:e,name:r.themeName,author:"user",themeId:r._id,dark:!!o},O(JSON.stringify(a),t.$el,{downloadFirst:!0})):n()}));$.getJSON("css/themes.json").then((function(i,r){var o;return(o=i[e])?(o.key=e,O(JSON.stringify(o),t.$el,{downloadFirst:!0})):n()})).fail((function(e){return n(),console.error("error load themeInfos"+e)}))}}else n()},S.prototype.bindEvent=function(){var e,a,c,u,f,h,m,v,y,x,k,S,I;this.listenTo(this.applicationProfileModel,"change:themeInfo",(I=this,function(e,t){if(O(t,I.$el),I.changeTempTheme.prevTempTheme)return I.changeTempTheme.prevTempTheme=null})),this.listenTo(this.applicationProfileModel,"exploreTheme",function(e){return function(t){var n,i;if(null==t&&(t={}),!j.loading)return i=e.applicationProfileModel,n=e,'<div class="ui indicating progress active" data-percent="74">\n  <div class="bar" style="width:74%;"></div>\n  <div class="label">\u4e3b\u9898\u5207\u6362\u4e2d...</div>\n</div>',d.showHandling('<div class="ui indicating progress active" data-percent="74">\n  <div class="bar" style="width:74%;"></div>\n  <div class="label">\u4e3b\u9898\u5207\u6362\u4e2d...</div>\n</div>'),j.loading=!0,j((function(e,a){var s;return e?(d.showMessage("\u5207\u6362\u4e3b\u9898\u5931\u8d25:"+e,6e3,"error"),d.hideHandling(),void(j.loading=!1)):(s=E(a,"light"),$.getJSON(o.host+"/css/random-themes.json?v="+moment().format("YYYY-MM-DD"),(function(e,a,l){var c,u,p,f,h,m,v,g,w,y;for(f in g=[],e)"xsj"===(u=e[f]).author&&(u.key=f,u.value=f,g.push(u));if(y=g.length,h=_.random(0,y-1),v=g[h])return v.template.baseColors||(v.template.baseColors=s.colors),v.remote?(c={},p=function(e,t){return fetch(e.url).then((function(e){return e.blob()})).then((function(n){return c[e.key]={data:n,content_type:n.type},t()})).catch(t)},w={_id:t.themeId||"theme_random",themeName:t.themeName||"\u968f\u673a\u751f\u6210\u7684\u4e3b\u9898",tagNames:v.tagNames||[],extraCssText:v.template.extraCss||"",baseTheme:{id:s.key,name:s.name,dark:s.dark,colors:s.colors},_attachments:c},m=[{key:"backgroundImage",url:o.host+"/"+v.template.resources.backgroundImage},{key:"thumbnail",url:o.host+"/"+v.template.thumbnailBackground}],void async.mapLimit(m,10,p,(function(e){return e?(d.showMessage("\u5207\u6362\u4e3b\u9898\u5931\u8d25:"+e,6e3,"error"),d.hideHandling(),j.loading=!1):r.createOrUpdateTheme(w,(function(e,r){return v={name:w.themeName,author:"user",themeId:r.id,key:r.id,dark:!!s.dark},t.setDefault&&i.save({themeInfo:JSON.stringify(v)}),O(JSON.stringify(v),n.$el),d.hideHandling(),j.loading=!1}))}))):(i.save({themeInfo:JSON.stringify(v)},{silent:!0}),O(JSON.stringify(v),n.$el,{downloadFirst:!0,callback:function(){return d.hideHandling(),j.loading=!1}}))})))}))}}(this)),$(window).on("refreshTheme",function(e){return function(){var t;return t=i.getApplicationProfileModel().get("themeInfo"),O(t,e.$el)}}(this)),this.listenTo(this.applicationProfileModel,"change:font change:css",function(e){return function(){var t,n;return n=e.applicationProfileModel.get("font"),A(n),t=e.applicationProfileModel.get("css"),B(t)}}(this)),this.listenTo(this.applicationProfileModel,"change:autoLock change:lockTimeout",function(e){return function(){return e.applicationProfileModel.get("autoLock")?i.startAutoLock():i.stopAutoLock()}}(this)),this.listenTo(this.applicationProfileModel,"change:proxyOn change:proxyProtocol change:proxyHost change:proxyPort change:proxyUsername change:proxyPassword",(function(){return i.initProxy()})),e=this.previewView.$el.find(".preview_line"),this.editorView.on("change",function(e){return function(){if(e.previewView.resetScrollMap(),e.applicationProfileModel.get("syncScrollEditor"),e.applicationProfileModel.get("syncScrollPreview"),D)return $(window).trigger("toggleLinePathMode",!1)}}(this)),$(window).on("sidebarHidden",function(e){return function(){if(e.layout&&e.layout.state)return $(window).trigger("resize."+e.layout.state.id)}}(this)),$(window).on("previewRendered",function(e){return function(){return e.editorView.$el.trigger("changeCursor")}}(this)),$(window).on("moveCursorTo",function(e){return function(t,n){return e.editorView.moveCursorTo(n,0)}}(this)),$(window).on("changeFileModel",function(e){return function(t,n,r){var o,a,s;return null==r&&(r={scrollTo:!0}),o=e,e.fileModel?(a=i.getFileLocalCollection(),(s=a.getFileLocalModelByFileId(e.fileModel.id)).get("isLocked")&&e.fileModel.set({content:s.get("content")}),e.fileModel.save({},{success:function(){return s.save({isLocked:!1}),r.saveCurrentFileModelSuccess?r.saveCurrentFileModelSuccess((function(){return o.changeFileModel(n,r)})):o.changeFileModel(n,r)},error:function(e){return d.showMessage("\u5207\u6362\u6587\u4ef6\u5931\u8d25"+e,6e3,"error")}})):o.changeFileModel(n,r)}}(this)),$(window).on("toggleOnlyPreviewMode",function(e){return function(t,i,r){var o;if(null==r&&(r={}),!0===i){if(i===n)return;n=!0}else if(!1===i){if(i===n)return;n=!1}else n=!n;return n?(localStorage.setItem("only_preview_mode","true"),$("body").addClass("only_preview_mode"),$(window).trigger("toggleLinePathMode",!1),e.previewView.open(!0),"free"===e.previewView.layoutPosition?(e.previewView.changeLayoutPosition("east"),$(window).trigger("changePreviewLayoutPosition","east")):void 0):(localStorage.setItem("only_preview_mode","false"),$("body").removeClass("only_preview_mode"),r.showPreview||e.previewView.close(!1),o=e.layout.center.children.layout1,setTimeout((function(){return o.resizeAll()}),200))}}(this)),$(window).on("newFileModel",function(e){return function(t,n,i){var o,a,s,l;return o=e,$(window).trigger("toggleOnlyPreviewMode",!1),s=function(e,t){var n,i;return i=o.applicationProfileModel.get("newFileTemplateId")||"",n=o.applicationProfileModel.get("newFileTemplate")||"",e||(e=i),e?r.getTemplate(e,{attachments:!0,binary:!0,statistics:!0},(function(e,i){return t(null,e?{canScript:!0,content:_.template(n)({})}:i)})):setTimeout((function(){return t(null,{canScript:!0,content:_.template(n)({})})}),1)},l=function(e,t){var n,i,r,a,s,l,c,u,p,f,h,m,v,g;if(a={content:n=t.content||""},t.title&&(v=t.title||"",t.canScript&&(v=_.template(v)({})),a.title=v),t.cssText&&(i=t.cssText||"",t.canScript&&(i=_.template(i)({})),a.cssText=i),t.tagNames&&(a.tagNames=t.tagNames),s=[],t._attachments)for(r in f=t._attachments)g=f[r],s.push({name:r,type:g.content_type,blob:g.data});return(l=b.getMetaData(n)).title&&(a.title=l.title),(m=o.storeView.storePluginModel)&&(h=m.get("name"),p="",o.storeView.storePluginView?(c=o.storeView.storePluginView.getActiveNode())&&((u=c.data.obj).isVirtualNode||(p=u.parentPath||"",c.isFolder()&&(p=p?p+"/"+u.guid:u.guid)),"-1"===p&&(p="")):o.fileModel&&o.fileModel.get("pluginName")===h&&(p=o.fileModel.get("parentPath")),a=$.extend(a,{pluginName:h,parentPath:p})),o.fileCollection.createFile(a.title,a.content,s,a,(function(e,t,n){return e?d.showMessage("\u521b\u5efa\u6587\u4ef6\u5931\u8d25:"+e,6e3,"error"):$(window).trigger("changeFileModel",[t])}))},a=function(e,t){return e.canScript?_.template(e.content||"",{async:!0})({}).then((function(n){return e.content=n,t(null,e)})).catch((function(e){return d.showMessage("\u521b\u5efa\u6587\u4ef6\u5931\u8d25:"+e,6e3,"error"),console.error("\u52a0\u8f7d\u6a21\u677f\u51fa\u9519\uff1a",e)})):t(null,e)},i?a(i,l):s(n,(function(e,t){return a(t,l)}))}}(this)),$(window).on("importFileByPlugin",function(e){return function(t,n,r,a,s,l){var c,u,p,f,h,m,v,g;return null==s&&(s={}),u=e,f=!!s.forceUpdate,m=i.getPlugin(n),p=i.getFileLocalCollection(),v={pluginName:n.get("name"),entryToken:n.get("entryToken"),entryTokenSecret:n.get("entryTokenSecret"),extraInfo:n.get("extraInfo")},h=u.fileCollection.where({pluginName:v.pluginName,guid:r,parentPath:a||""}),g=function(e){var t,n,i;if(m.watchPath&&(i=m.watchPath({guid:r,parentPath:a})))return t=(n=p.getFileLocalModelByFileId(e.id)).get("diskContent"),n.set({fullPath:i}),t||n.set({diskContent:h[0].get("content")}),n.save()},h.length>0&&!f?(u.fileModel!==h[0]&&(g(h[0]),$(window).trigger("changeFileModel",h[0])),"function"==typeof l?l():void 0):(c=function(e){var t;return t=setTimeout((function(){return d.showMessage("\u8fde\u63a5\u8d85\u65f6"),i.homeView.hideLoader()}),o.getNetworkResourceTimeout),m.getFile({},{guid:r,parentPath:a},(function(n,r){if(clearTimeout(t),t=null,n){if("object"==typeof n)try{n=JSON.stringify(n)}catch(e){}return d.showMessage("\u52a0\u8f7d\u51fa\u9519"+n,6e3,"error"),i.homeView.hideLoader(null)}return(s=$.extend(r,v)).updateDate||(s.updateDate=Date.now()),s.syncDate=s.updateDate,s.contentUpdateDate=s.updateDate,e(r,s)}))},u.fileCollection.fetch({fetch:"query",update:!0,remove:!1,options:{query:{fun:"query_index/by_plugin",include_docs:!0,limit:1,key:[v.pluginName,r,a||""]}},success:function(e,t,n){var o;return 1===t.rows.length?(o=e.get(t.rows[0].id)).get("isArchived")||f?c((function(e,t){return o.get("content")!==e.markdownContent||f?u.fileCollection.updateFile(o,e.name,e.markdownContent,e.resources,{isArchived:!1,updateDate:Date.now()},(function(e,t,n){if(e){try{e=JSON.stringify(e)}catch(e){}return d.showMessage("\u52a0\u8f7d\u51fa\u9519"+e,6e3,"error"),"function"==typeof l?l():void 0}return g(t),$(window).trigger("changeFileModel",t),"function"==typeof l?l():void 0})):o.save({isArchived:!1},{force:!0,success:function(e){return g(e),$(window).trigger("changeFileModel",e),"function"==typeof l?l():void 0},error:function(e){try{e=JSON.stringify(e)}catch(e){}return d.showMessage("\u52a0\u8f7d\u51fa\u9519"+e,6e3,"error"),"function"==typeof l?l():void 0}})})):(g(o),$(window).trigger("changeFileModel",o),"function"==typeof l?l():void 0):c((function(e,t){var n;return m.watchPath&&(n=m.watchPath({guid:r,parentPath:a}))&&(t.file={path:n}),$(window).trigger("importFile",[e.name,e.markdownContent,e.resources,t,function(e,t){return d.showMessage("\u6253\u5f00\u6587\u4ef6"+e.get("title")),i.homeView.hideLoader(null),$(window).trigger("changeFileModel",e),"function"==typeof l?l():void 0}])}))},error:function(){return c((function(e,t){var n;return m.watchPath&&(n=m.watchPath({guid:r,parentPath:a}))&&(t.file={path:n}),$(window).trigger("importFile",[e.name,e.markdownContent,e.resources,t,function(e,t){return d.showMessage("\u6253\u5f00\u6587\u4ef6"+e.get("title")),i.homeView.hideLoader(null),$(window).trigger("changeFileModel",e),"function"==typeof l?l():void 0}])}))}}),i.homeView.showLoader(null,"\u52a0\u8f7d\u6570\u636e\u4e2d"))}}(this)),$(window).on("importFile",function(e){return function(t,n,r,o,a,s){var l,c,u,p;return null==a&&(a={}),u=e,p=i.getFileLocalCollection(),l=function(){var t,l,c,f;return"client"===STORY_PLATFORM&&a.file&&a.file.path?(c=a.file.path,a.fullPath=c,a.diskContent=r,(t=p.getFileLocalModelByFullPath(c))&&(l=t.get("id"),f=t.get("diskContent")),u.fileCollection.getModelById(l,(function(e,l){var h,m,v,g,_,w,y,b,x,k,D;if(e){if(console.log("\u52a0\u8f7d\u6587\u4ef6\u51fa\u9519:"+e),"object"==typeof e)try{e=JSON.stringify(e)}catch(e){}return d.showMessage("\u521b\u5efa\u6587\u4ef6\u5931\u8d25:"+e,6e3,"error"),u.hideLoader(null)}if(x=i.getStorePluginCollection(),k=i.getCurrentStorePluginModel()||x.getModelByName("local"),v=r,b="","",y="",h=Date.now(),k){_=k.get("extraInfo");try{_=JSON.parse(_)}catch(e){g=e,console.log(g)}m=_.path,0===c.indexOf(m)&&(b="local",n,0!==(y=require("path").dirname(c.substring(m.length))).indexOf("/")&&0!==y.indexOf("\\")||(y=y.substring(1)))}return l?(w=l.get("content"),D={updateDate:h,syncDate:h,contentUpdateDate:h},v!==f&&(D.content=v),w||(D.content=v),b&&(D.pluginName=b,D.guid=a.guid||n,D.parentPath=y),l.save(D,{success:function(){return s(l,a)}})):u.fileCollection.createFile(n,r,o,{pluginName:b,guid:a.guid||n,parentPath:y,syncDate:h,updateDate:h,contentUpdateDate:h,createDate:a.createDate||h,attachmentMetas:a.attachmentMetas},(function(e,n,i){if(e){if("object"==typeof e)try{e=JSON.stringify(e)}catch(e){}return d.showMessage("\u521b\u5efa\u6587\u4ef6\u5931\u8d25:"+e,6e3,"error"),u.hideLoader(null)}return(t=p.getFileLocalModelByFileId(n.id)).save({fullPath:c,diskContent:r,content:r}),s(n,i)}))}))):e.fileCollection.createFile(n,r,o,a,(function(n,i,o){if(n){if("object"==typeof n)try{n=JSON.stringify(n)}catch(e){}return d.showMessage("\u521b\u5efa\u6587\u4ef6\u5931\u8d25:"+n,6e3,"error"),e.hideLoader(null)}return(t=p.getFileLocalModelByFileId(i.id)).save({fullPath:c,diskContent:r,content:r}),s(i,o)}))},e.fileModel?((c=p.getFileLocalModelByFileId(e.fileModel.id)).get("isLocked")&&e.fileModel.set({content:c.get("content")}),e.fileModel.save({},{error:function(e){return d.showMessage("\u4fdd\u5b58\u6587\u4ef6\u5931\u8d25"+e,6e3,"error")},success:function(){return c.save({isLocked:!1}),l()}})):l()}}(this)),$(window).on("saveAsFileModel",function(e){return function(t){var n,r,o,a,s;if(!($(".save_new_story_modal, .save_as_dialog_model").length>0||(o=!1,f.timeout&&(clearTimeout(f.timeout),o=!0),f.timeout=setTimeout((function(){return f.timeout=null}),1e3),o)))return r=(r=e.editorView.getActiveEditorProxy().fileModel)||e.fileModel,s=e.storeView,(n=e.storeView.storePluginModel)?(a=i.getPlugin(n),f(!0,r,a,(function(e,t,n,i){return t===a&&s.refreshFolder(n,i),s=null}))):new w({model:r}).show((function(e){return e.saveFile({},r,{saveAs:!0},(function(t,n,i){var o,a,s;if((o=$("body>.preview_export_wrapper>iframe")).length>0&&(a=o[0].contentDocument,s=o[0].contentWindow,$(a.body).remove(),$(a).off(),$(s).off()),$("body>.preview_export_wrapper").remove(),t){if("object"==typeof t)try{t=JSON.stringify(t)}catch(e){}return d.showMessage("\u4fdd\u5b58\u5931\u8d25: "+t,6e3,"error")}return d.showMessage("\u4fdd\u5b58\u6210\u529f"),r.set({pluginName:e.name,syncDate:n.updateDate,updateDate:n.updateDate,contentUpdateDate:n.updateDate,parentPath:n.parentPath,guid:n.guid})}))}))}}(this)),$(window).on("saveAllUnsync",function(e){return function(t){var n,r,o,a;return n=e.storeView.storePluginModel,o=n.get("name"),r=i.getPlugin(n),(a=e.fileCollection.filter((function(e){var t,n,i;return t=e.get("pluginName"),i=e.get("syncDate"),n=e.get("contentUpdateDate"),o===t&&i&&n&&i!==n}))).length>0?new g({models:a,plugin:r}).show(f):d.showMessage("\u5f53\u524d\u7ed1\u5b9a\u4e0b\u6ca1\u6709\u672a\u540c\u6b65\u7684\u6587\u7ae0",3e3,"warning")}}(this)),$(window).on("saveFileModel",function(e){return function(t,n){var r,o,a,s,l,c,u;if(null==n&&(n=!1),!($(".save_new_story_modal, .save_as_dialog_model").length>0||(a=!1,f.timeout&&(clearTimeout(f.timeout),a=!0),f.timeout=setTimeout((function(){return f.timeout=null}),1e3),a)))return o=(o=e.editorView.getActiveEditorProxy().fileModel)||e.fileModel,u=e.storeView,r=e.storeView.storePluginModel,l=o.get("pluginName"),s=null,r&&r.get("name")!==l&&(n=!0),r&&!n&&(c=r,s=i.getPlugin(c)),f(!1,o,s,(function(e,t,n,i){return t===s&&u.refreshFolder(n,i),u=null}))}}(this)),f=function(e,t,n,r){var a,s,l,c;return null==e&&(e=!1),a=function(e,t,n,i){var o,a,s;return(o=$("body>.preview_export_wrapper>iframe")).length>0&&(a=o[0].contentDocument,s=o[0].contentWindow,$(a.body).remove(),$(a).off(),$(s).off()),$("body>.preview_export_wrapper").remove(),"function"==typeof r?r(e,t,n,i):void 0},s=i.getFileLocalCollection(),(l=s.getFileLocalModelByFileId(t.id)).get("isLocked")&&t.set({content:l.get("content")}),c=t.get("content")||"",l.get("fullPath")?l.set({diskContent:l.get("content")}):l.set({diskContent:""}),t.save({},{force:!0,error:function(e){return d.showMessage("\u4fdd\u5b58\u5931\u8d25: "+e,6e3,"error"),a(e)},success:function(i,r){var s,u,f,h,m;if(l.save({isLocked:!1}),m=["by_title","by_slug","by_draftupdatedate","by_tagNames","by_plugin","by_create_date"],p.buildViews(o.pouchDB,t,m,(function(e){if(e)return console.error(e)})),t.get("pluginName"),"client"===STORY_PLATFORM&&(u=require("fs"),f=l.get("fullPath")))try{u.writeFileSync(f,(" "+c).substring(1))}catch(e){s=e,d.showMessage("\u4fdd\u5b58\u5931\u8d25\uff1a"+s,6e3,"error")}return t.trigger("clientLocalDiskChange"),n?(h=function(e){var i,r,o,s;return r=t.get("guid"),o=t.get("parentPath"),s=t.get("title")||"",i=!1,e.guid===r&&e.parentPath===o||(i=!0),i&&(s=b.generateMarkdownTitle(e.name)||s||"\u672a\u547d\u540d\u6587\u4ef6"),t.set({guid:e.guid,parentPath:e.parentPath,createDate:e.createDate},{silent:!0}),t.set({title:s,pluginName:n.name,updateDate:e.updateDate,contentUpdateDate:e.updateDate,syncDate:e.updateDate}),t.save({},{force:!0,error:function(e){return d.showMessage("\u4fdd\u5b58\u5931\u8d25: "+e,6e3,"error"),a(e)},success:function(t,r){return a(null,n,e,i),d.showMessage("\u4fdd\u5b58\u6210\u529f")}})},n.saveFile({},t,{saveAs:e},(function(e,t,i){if(e){if("object"==typeof e)try{e=JSON.stringify(e)}catch(e){}return d.showMessage("\u4fdd\u5b58\u5931\u8d25: "+e,6e3,"error"),a(e)}return n===i?h(t):(d.showMessage("\u4fdd\u5b58\u6210\u529f"),a())}))):(d.showMessage("\u4fdd\u5b58\u6210\u529f"),a())}})},k=function(e){return function(n){var i,r,o,a,s;return o=!1!==(o=e.applicationProfileModel.get("fullscreenBackgroundPic")&&!1),e.editorView.editorProxy.$el.removeClass("zen_background_img_mode"),e.editorView.toggleZenMode(n),null!=T&&T.destroy(),T=null,"function"==typeof(r=e.editorView.$el.find(".zen_background")).rippler&&r.rippler("destroy"),null!=r&&r.remove(),e.layout.options,a=e.previewView,n?(d.showMessage("\u5f00\u542f\u5199\u4f5c\u6a21\u5f0f\uff0c\u6309(esc)\u952e\u9000\u51fa ",1e3),e.layout.saveCookie(),e.layout.options.stateManagement.autoSave=!1,e.layout.hide(e.layout.west.name),e.layout.hide(e.layout.north.name),a.close(),o&&(i=$("<img class='zen_background_img' style='width:100%;height:100%;position:absolute;'>"),(r=$('<div class="zen_background rippler rippler-img rippler-bs-primary" style="width:100%;height:100%;position:absolute;"></div>')).append(i),e.editorView.$el.prepend(r),e.editorView.editorProxy.$el.addClass("zen_background_img_mode"),t("../lib/dynamic_import/import_zen_background_depence")((function(){var e,t,n,o;return r.rippler({effectClass:"rippler-effect",effectSize:16,addElement:"div",duration:800}),(t=i[0]).crossOrigin="anonymous",navigator.onLine||"client"!==STORY_PLATFORM?(n=_.sample(function(){for(o=[],e=1;e<=35;e++)o.push(e);return o}.apply(this)),t.src="http://soft.xiaoshujiang.com/static_img/"+n+".jpg",i=null,r=null):(t.onload=function(){var e;return e=this,setTimeout((function(){return(T=new RainyDay({image:e,enableSizeChange:!1,parentElement:r[0]})).rain([[0,2,200],[3,3,1]],3e4),e=null,i=null,r=null}),3e3)},t.src="./img/zen/3.jpg")})))):(e.layout.show(e.layout.west.name,!1),e.layout.show(e.layout.north.name,!1),a.open(!1),s=e.layout.readCookie(),e.layout.loadState(s,!0),e.layout.options.stateManagement.autoSave=!0,screenfull.zenType=""),e.editorView.focus()}}(this),S=function(e){return function(n){var i,r,o,a,s;return o=!1!==(o=e.applicationProfileModel.get("fullscreenBackgroundPic")&&!1),e.previewCenterView.toggleZenMode(n),a=e.previewView,null!=T&&T.destroy(),T=null,"function"==typeof(r=e.previewCenterView.$el.find(".zen_background")).rippler&&r.rippler("destroy"),null!=r&&r.remove(),e.layout.options,n?(d.showMessage("\u5f00\u542f\u9605\u8bfb\u6a21\u5f0f\uff0c\u6309(esc)\u952e\u9000\u51fa ",1e3),e.layout.saveCookie(),e.layout.options.stateManagement.autoSave=!1,e.layout.hide(e.layout.west.name),e.layout.hide(e.layout.north.name),a.close(),e.editorView.$el.hide(),e.previewCenterView.$el.removeClass("hide"),o?(i=$("<img class='zen_background_img' style='width:100%;height:100%;position:absolute;'>"),(r=$('<div class="zen_background  rippler rippler-img rippler-bs-primary" style="width:100%;height:100%;position:absolute;"></div>')).append(i),e.previewCenterView.$el.prepend(r),t("../lib/dynamic_import/import_zen_background_depence")((function(){var e,t,n,o;return r.rippler({effectClass:"rippler-effect",effectSize:16,addElement:"div",duration:800}),(t=i[0]).crossOrigin="anonymous",navigator.onLine||"client"!==STORY_PLATFORM?(n=_.sample(function(){for(o=[],e=1;e<=35;e++)o.push(e);return o}.apply(this)),t.src="http://soft.xiaoshujiang.com/static_img/"+n+".jpg",i=null,r=null):(t.onload=function(){var e;return e=this,setTimeout((function(){return(T=new RainyDay({image:e,enableSizeChange:!1,parentElement:r[0]})).rain([[0,2,200],[3,3,1]],3e4),e=null,i=null,r=null}),3e3)},t.src="./img/zen/3.jpg")}))):void 0):(e.layout.show(e.layout.west.name,!1),e.layout.show(e.layout.north.name,!1),a.open(!1),s=e.layout.readCookie(),e.layout.loadState(s,!0),e.layout.options.stateManagement.autoSave=!0,e.editorView.$el.show(),e.previewCenterView.$el.addClass("hide"),screenfull.zenType="",e.editorView.focus())}}(this),screenfull.enabled&&document.addEventListener(screenfull.raw.fullscreenchange,(function(){return"editor"===screenfull.zenType?($(window).trigger("editorZenModeChange",screenfull.isFullscreen),k(screenfull.isFullscreen)):"preview"===screenfull.zenType?($(window).trigger("previewZenModeChange",screenfull.isFullscreen),S(screenfull.isFullscreen)):void 0})),$(window).on("toggleEditorZenMode",(function(e,t,n){return screenfull.enabled?(screenfull.zenType="editor",screenfull.toggle()):k(t)})),$(window).on("togglePreviewZenMode",(function(e,t,n){return screenfull.enabled?(screenfull.zenType="preview",screenfull.toggle()):S(t)})),m=null,c=$(window).width(),h=window.screen.width,a={west:!0,westSize:h/4,preview:!0,previewSize:{width:h/3,height:h/3,size:h/3}};try{x=JSON.parse(localStorage.getItem("layoutResizeState"))}catch(e){y=e,x={}}return $.extend(a,x),u=function(e){return function(){var t,n,i,r;if(!$("body").hasClass("only_preview_mode")&&(t=$(window),m&&(clearTimeout(m),m=null),r=t.width(),c!==r&&(P(),t.height(),(n=e.layout).children.center.layout1,i=e.previewView,!screenfull.isFullscreen))){if(r<=768){if(c<=768)return void(c=r);"free"!==i.layoutPosition&&(c>992&&(a.west=!n.state.west.isClosed,a.westSize=n.state.west.size),c>768&&(a.preview=!i.isClosed(),a.previewSize=i.containerSize(),localStorage.setItem("layoutResizeState",JSON.stringify(a))),n.hide(n.west.name),i.close())}else if(768<r&&r<=992){if(768<c&&c<=992)return void(c=r);"free"!==i.layoutPosition&&(c>992&&(a.west=!n.state.west.isClosed,a.westSize=n.state.west.size,localStorage.setItem("layoutResizeState",JSON.stringify(a))),n.hide(n.west.name),m=setTimeout((function(){var e;return"object"==typeof(e=a.preview&&a.previewSize)&&e.size>1&&(e={width:e.width,height:e.height,size:"50%"}),i.open(e)}),100))}else{if(c>992)return void(c=r);"free"!==i.layoutPosition&&(n.show(n.west.name,a.west),a.westSize&&n.sizePane("west",a.westSize),768<c&&c<=992&&(a.preview=!i.isClosed(),a.previewSize=i.containerSize(),localStorage.setItem("layoutResizeState",JSON.stringify(a))),m=setTimeout((function(){var e;return"object"==typeof(e=a.preview&&a.previewSize)&&e.size>1&&(e={width:e.width,height:e.height,size:"50%"}),i.open(e)}),100))}return c=r}}}(this),v=_.debounce(u,100),$(window).resize(v),$(window).on("changeEditor",function(e){return function(t,n,i){if("light"===n&&"vertical-lr"!==i&&"vertical-rl"!==i&&(i="",n="codemirror"),"horizontal-tb"===i&&(i="",n="codemirror"),e.editorView.editorType!==n||e.editorView.writingMode!==i)return e.editorView.changeEditor(n,i)}}(this)),$(window).on("exportFileModel",function(e){return function(t,n,i,r){var o;return o=!1,(null!=r?r.length:void 0)>1&&(o=!0),n=n||e.fileModel,new s({model:n}).show((function(e){if(i)return o?e.batchFetchFiles(r,i):e.fetchFile(i)}))}}(this)),$(window).on("changeXsjNonSecurityMode",(function(e,t){return null==t&&(t=!1),i.setNonSecurity(t),$("body").toggleClass("non_security",t)})),$(window).on("toggleStore",function(e){return function(t){var n;if(n=e.layout,!screenfull.isFullscreen)return n.west.state.isClosed?(n.show("west",!1),setTimeout((function(){return n.open("west")}),100)):n.close("west")}}(this)),$(window).on("togglePreview",function(e){return function(t){var n,i;if(!screenfull.isFullscreen)return e.layout,n=e.previewView,i=$(window).width(),n.isClosed()?i<=768?(n.open(!1),setTimeout((function(){return n.slideOpen()}),100)):n.open(!0):i<=768?(n.slideClose(),setTimeout((function(){return n.close(!0)}),100)):n.close(!1)}}(this)),$(window).on("convertPreviewFormatForExport",(function(e,t,n,i){return $(window).trigger("convertPreview",[t,n,i])})),$(window).on("changePreviewLayoutPosition",function(e){return function(t,n){return C=e.editorView.el.getBoundingClientRect().top}}(this)),$(window).on("changePreviewType",(function(e,t,n){return"presetation"===t||"pdf"===t?$(window).trigger("toggleLinePathMode",!1):$(window).trigger("toggleLinePathMode",D),$(window).trigger("previewTypeChange",t)})),$(window).on("toggleLinePathMode",function(t){return function(n,i,r){var o,a,s,l,c,u,d,p;"east"!==t.previewView.layoutPosition&&(i=!1);try{"presentation"===t.fileModel.getMeta().preview_previewType&&(i=!1)}catch(e){y=e,console.log(y)}if(D=i,s=t.editorView,(e=t.previewView.$el.find(".preview_line")).hide(),t.previewView.$el.find(".preview_wrapper").removeClass("preview_wrapper_line_path"),0!==(o=t.previewView.getPreviewContainer()).length)return l=null,d="http://www.w3.org/2000/svg",u=function(){var t,n,i,r,a,l;return l=e.width(),i=e.height(),(a=document.createElementNS&&document.createElementNS(d,"svg"))&&!a.createSVGRect&&(a=null),(t=$(a)).html(""),t.width(l),t.height(i),e.html("").append(t),n=s.getFirstVisibleRow(),r=s.getLastVisibleRow(n),o.find("[data-source-line-display]").filter((function(e){var t;return t=$(this).attr("data-source-line")||-1,n<=t&&t<=r})).each((function(e,n){var i,r,o,a,c,u,p;if((i=$(n)).visible(!0))return u=i.attr("data-source-line"),30,o="C 15 "+(a=s.documentToScreenRowHeight(u)-C)+" 15 "+(p=i.offset().top)+" 30 "+p,c=document.createElementNS(d,"path"),(r=$(c)).attr("d","M 0 "+a+" "+o+" H "+l),t.append(r)}))},p=_.debounce(u,1e3),a=function(t){return e.html(""),p(t)},c=function(e){var t;return t=$(e.currentTarget).data("line"),l&&s.removeMarker(l),l=s.highlightLines(t,t)},i?(e.show(),t.editorView.on("changeScrollTop",a),o.addClass("preview_wrapper_line_path"),o.on("scroll",a),p(),o.on("click",".line",c),M=a,F=c):(e.hide(),M&&(t.editorView.off("changeScrollTop",M),o.off("scroll",M)),o.removeClass("preview_wrapper_line_path"),F&&o.off("click",".line",F),l&&t.editorView.removeMarker(l),M=null,F=null),$(window).trigger("linePathModeChange",i)}}(this)),$(window).on("fileListSlideToggle",function(e){return function(t){var n,i;return n=e.layout,i=e.layout.center.state.innerWidth-50,n.west.state.isClosed?(n.show("west",!1),setTimeout((function(){return n.slideOpen("west"),n.sizePane("west",i)}),100)):n.hide("west",!1)}}(this)),$(window).on("previewSlideToggle",function(e){return function(t){var n;return(n=e.previewView).isClosed()?(n.open(!1),setTimeout((function(){return n.slideOpen()}),100)):n.slideClose()}}(this)),$(window).on("unload",function(e){return function(t){var n,i,r,a,s,l,c;return window.clientWorkerManager&&(window.clientWorkerManager.stopClientWorker(),window.clientWorkerManager=null),window.pouchdbWorkerManager&&(window.pouchdbWorkerManager.stopWorker(),window.pouchdbWorkerManager=null),c=(n=$(window)).width(),l=n.height(),((a=e.previewView.model.get("freeLayoutTop"))>l||a<0)&&(a=0),((r=e.previewView.model.get("freeLayoutLeft"))>c||r<0)&&(r=0),e.previewView.model.set({freeLayoutTop:a,freeLayoutLeft:r}),e.previewView.model.save(),null!=(s=e.fileModel)&&s.save(),"function"==typeof(i=e.editorView).saveCursorPosition&&i.saveCursorPosition(),e.applicationProfileModel.get("windowMaximize")||(e.applicationProfileModel.set({windowWidth:c,windowHeight:l,windowLeft:window.screenLeft,windowTop:window.screenTop}),e.applicationProfileModel.save()),(new Image).src=o.host+"/img/avatar_d_256x256.png"}}(this)),$(window).on("editorZenModeChange",(function(e,t){var n;return n=$("body"),t?n.addClass("editor_zen_mode zen_mode"):n.removeClass("editor_zen_mode zen_mode")})),$(window).on("previewZenModeChange",(function(e,t){var n;return n=$("body"),t?n.addClass("preview_zen_mode zen_mode"):n.removeClass("preview_zen_mode zen_mode")})),$(window).on("showHistory",function(e){return function(t,n){return(n=n||e.fileModel)?new l({model:n}).show():d.showMessage("\u8bf7\u5148\u9009\u62e9\u4e00\u4e2a\u6587\u4ef6",6e3,"warning")}}(this)),$(window).on("revertFileModel",function(e){return function(t,n,i,r){return n=n||e.fileModel,e.revertFileModel(n,i,r)}}(this)),document.onpaste=function(e){return function(t){var n,i,r;if(!window.isPasteImaging)return i=t&&(t.clipboardData.items||t.clipboardData.files),e.fileModel&&e.editorView&&$.contains(e.editorView.getActiveEditorProxy().el,document.activeElement)?(n=e.editorView.getActiveEditorProxy(),r=e.editorView.getActiveEditorView().getSelectionValue(),$.map(i,(function(e,t){var o,a;if(e.type.indexOf("image")>=0&&"file"===e.kind)return o=function(t){var r;return r=i[0],2===i.length&&r&&"string"===r.kind&&"text/html"===r.type&&e.type.endsWith("png")?r.getAsString((function(e){var i,r,o,a,s;return(i=$(e)).length>=2&&"IMG"===(o=i[i.length-1]).tagName&&(a=o.src)?(r=new AbortController,s=null,window.isPasteImaging=!0,n.el.classList.add("gif_image_download_wait"),fetch(a,{signal:r.signal}).then((function(e){var t;return t=e.headers.get("Content-Type"),/gif/i.test(t)||/gif/i.test(a)?e.blob():null})).then((function(e){return n.el.classList.remove("gif_image_download_wait"),s&&(clearTimeout(s),s=null),t(e)})).catch((function(e){return n.el.classList.remove("gif_image_download_wait"),s&&(clearTimeout(s),s=null),console.error(e),t()})),void(s=setTimeout((function(){return s=null,r.abort()}),15e3))):t()})):t()},a=e.getAsFile(),o((function(e){var t;return window.isPasteImaging=!1,t="image/png",e&&(t="image/gif",a=new Blob([e],{type:t})),b.blob2DataURL(a,(function(e,n){var i;return i=b.dataURL2Blob(n),$(window).trigger("pasteBlob",[i,t,r])}))}))}))):void 0;d.showMessage("\u6b63\u5728\u7c98\u8d34\u4e00\u4e2a\u6bd4\u8f83\u5927\u7684\u56fe\u7247\u6587\u4ef6\uff0c\u8bf7\u7a0d\u5019...",3e3,"warning")}}(this),$(window).on("dragover",(function(e){return e.preventDefault()})),$(window).on("drop",(function(e){return e.preventDefault()})),b.initdragFilesSupport(this.$el,function(e){return function(t){return b.importFile(t,(function(t,n,r){var o,a;if("text"!==n)return $(window).trigger("pasteFiles",[r]);switch(i.getEditorProfileModel().get("pastePlainFileMode")||"appendAttachment"){case"appendAttachment":$(window).trigger("pasteFiles",[r]);break;case"newFile":if(o="MD",(a=t.name.lastIndexOf("."))>0&&(o=t.name.substring(a).toUpperCase(),[".MD",".MARKDOWN",".HTML"].indexOf(o)<0))return void $(window).trigger("pasteFiles",[r]);b.importTextFile(t,null,(function(e,n){return $(window).trigger("importFile",[e,n,[],{file:t},function(){return d.showMessage("\u5bfc\u5165\u6210\u529f")}])}));break;case"appendText":b.importTextFile(t,null,(function(t,n){return e.editorView.getActiveEditorView().insertValue(n)}));break;default:$(window).trigger("pasteFiles",[r])}return null}))}}(this))},S.prototype.afterRender=function(){return(n="true"===localStorage.getItem("only_preview_mode"))&&$("body").addClass("only_preview_mode"),this.$el.find(".ui-layout-center.main_center").append(this.editorView.render().$el).append(this.previewCenterView.render().$el),this.$loader=this.$el.find(".main_center_dimmer")},S}(x)}}),window.requirejs.define({"views/image_editor_component/image_editor_manager_view":function(e,t,n){var i,r,o,a,s,l,c,u,d,p,f=function(e,t){return function(){return e.apply(t,arguments)}},h={}.hasOwnProperty;l=t("../view"),s=t("../../lib/utils"),i=t("../../application"),o=t("../../lib/notifier"),t("../../constant"),a=t("../../lib/resource_core"),u=t("../../lib/preview_core"),d=t("./templates/image_editor_manager"),p=null,c=null,r=function(e){function t(){return this.closeWindow=f(this.closeWindow,this),t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)h.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.template=d,t.prototype.className="draggable_dialog_content_container image_editor_manager_container",t.prototype.fileModel=null,t.prototype.orignOpts=null,t.prototype.link=null,t.prototype.filename=null,t.prototype.realFilename=null,t.prototype.popupManager=null,t.prototype.fileType=null,t.prototype.isLoading=!1,t.prototype.isSaving=!1,t.prototype.editor=null,t.prototype.initialize=function(e){return this.fileModel=e.fileModel,this.link=e.link,this.filename=e.link.replace(/^[\.\/]*/g,""),this.fileType=e.fileType,this.popupManager=e.popupManager,this.operateType=e.operateType||"download",this.orignOpts=e,p=this},t.prototype.events={"click .ui.cancel.button":"closeWindow","click .ui.button.positive":"save"},t.prototype.closeWindow=function(){return this.popupManager.close()},t.prototype.save=function(){return p._save()},t.prototype._save=function(){var e,t,n;if(n=this.fileType,this.filename,t=this.fileModel,!p.isSaving)return p.editor?(p.isSaving=!0,(e=p.$el.find(".ui.button.positive")).addClass("loading"),function(){return new Promise((function(e){return p.editor.saveImageFn(n,1,(function(t){return e(t)}))}))}().then((function(e){return i.getUserModel().get("user"),e})).then((function(i){return watermark.destroy(),"save"===p.operateType?a.uploadResource({},t,p.realFilename,n,i,{fixRepeatFilename:!1},(function(n,i,r,a,s){var l,c,u;return t.trigger("attachmentChange",t,i,"url_image_./"+i),l=function(){return o.showMessage("\u4fdd\u5b58\u6210\u529f",6e3,"info"),p.isSaving=!1,e.removeClass("loading"),p.closeWindow()},(u=(c=p.fileModel.get("content")).replace(p.link,r))!==c?p.fileModel.save({content:u},{success:function(){return l()},error:function(t){return o.showMessage("\u4fdd\u5b58\u5931\u8d25: "+t,6e3,"error"),p.isSaving=!1,e.removeClass("loading")}}):l()})):"function"==typeof p.operateType?(p.operateType(i,p.realFilename),p.isSaving=!1,e.removeClass("loading"),p.closeWindow()):(window.saveAs(i,p.realFilename),p.isSaving=!1,e.removeClass("loading"),p.closeWindow())})).catch((function(e){return watermark.destroy(),o.showMessage(e+"",6e3,"error")}))):void 0},t.prototype.close=function(){return p&&(p.stopListening(),p.editor&&(p.editor.off("enterCrop"),p.editor.off("leaveCrop"))),p=null,null,c=null,this.remove()},t.prototype.reInit=function(e){var t,n;if(t=this.fileModel,this.orignOpts=e,this.fileType=e.fileType,e.fileModel&&this.fileModel!==e.fileModel&&(this.fileModel=e.fileModel),n=this.filename,this.fileModel,this.link=e.link,this.filename=e.link.replace(/^[\.\/]*/g,""),e.operateType&&(this.operateType=e.operateType),n!==this.filename||t.id!==this.fileModel.id)return p.isLoading=!0,p.showDimmer(),this.loadData((function(e,t){return e?(o.showMessage("\u52a0\u8f7d\u6587\u4ef6\u51fa\u9519:"+e,6e3,"error"),p.isLoading=!1,p.hideDimmer()):p.editor.loadImageFn(t,(function(){return p.isLoading=!1,p.hideDimmer()}))}))},t.prototype.show=function(e){return this.render(),this.$el.find(".return_button, .return_editor_button, .use_current_version_button, .create_new_button").hide(),e.append(this.$el),this.showContent()},t.prototype.showDimmer=function(){return p.popupManager.showDimmer()},t.prototype.hideDimmer=function(e){if(null==e&&(e=!1),e||!p.isLoading)return p.popupManager.hideDimmer()},t.prototype.showContent=function(){var e;return e=$('<iframe src="imageeditor/index.html" class="preview_iframe" frameborder="0" style="width: 100%;height:100%;"></iframe>').appendTo(this.$el.find(".image_editor_container")),p.isLoading=!0,p.showDimmer(),e.on("load",(function(){var t;return t=e[0],t.contentDocument,(c=t.contentWindow).addEventListener("click",(function(){return p.popupManager.focus()})),p.loadData((function(e,t){return e?(p.isLoading=!1,o.showMessage("\u52a0\u8f7d\u56fe\u7247\u8d44\u6e90\u5931\u8d25:"+e,6e3,"error"),p.closeWindow()):c.initImageEditor(t,(function(e,t){var n;return p.isLoading=!1,p.editor=t,n=p.$el.find(".ui.button.positive"),p.editor.on("enterCrop",(function(){return n.addClass("disabled")})),p.editor.on("leaveCrop",(function(){return n.removeClass("disabled")})),p.hideDimmer(),console.log("success....")}))}))}))},t.prototype.loadData=function(e){var t,n,i;return n=this.fileModel,i=this.filename,p.fileType||(t=s.getExt(p.link,1).toUpperCase(),p.fileType=".PNG"===t?"image/png":".WEBP"===t?"image/webp":"image/jpeg"),u.getUrlInfo(n,i,{parseClientLocalMedia:!0},(function(t,n){var r,o,a,l;return l=n.url||"",n.filename?(o=i.lastIndexOf("/"),p.realFilename=i.substring(o+1)):p.orignOpts.realFilename?p.realFilename=p.orignOpts.realFilename:(r=".jpg","image/png"===p.fileType&&(r=".png"),"image/webp"===p.fileType&&(r=".webp"),p.realFilename=Date.now()+r),p.popupManager.setTitle(p.realFilename),a=t,/^http[s]?:\/\//gi.test(l)?s.getCrossOrignDomainResource(l,(function(t,n){return e(t,n)})):e(a,l)}))},t}(l),n.exports=r}}),window.requirejs.define({"views/image_editor_component/templates/image_editor_manager":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<div class="draggable_dialog_content">\n<div class="image_editor_container iframe_wrapper" style="width:100%;height:100%;overflow:hidden;"></div>\n</div>\n<div class="draggable_dialog_footer actions">\n<div class="tips">\n</div>\n<div class="ui cancel mini button close_button">\n\u5173\u95ed\n</div>\n<div class="ui positive mini button save_button">\n<span>\u4fdd\u5b58</span>\n</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/import_file_dialog_view":function(e,t,n){var i,r,o,a,s,l,c,u,d,p,f,h={}.hasOwnProperty;c=t("./view"),l=t("../lib/utils"),a=t("../lib/notifier"),s=t("../lib/pouchdb_index_view_manager"),r=t("../models/database_auto_index_model"),i=t("../constant"),p=t("./templates/import_file_dialog"),f=null,d=function(){return fetch(i.host+"/css/random-covers.json?fver="+moment().format("YYYYMMDD")).then((function(e){return e.json()})).then((function(e){var t,n,r,o;if(0,(o=(t=Object.keys(e)).length)>0)return n=e[t[_.random(0,o-1)]],r=i.host+"/"+n.image,fetch(r).then((function(e){return e.blob()}))}))},u=function(e,t,n){return d().then((function(i){var r,o,a,s,l,c,u;return c=moment().format("YYYY-MM-DD hh:mm:ss"),a=t.title||c+" \u6536\u96c6\u7684\u6587\u7ae0",o=t.tags||[],r={title:a,category:t.category||"/\u5c0f\u4e66\u5320/\u5408\u96c6",tags:o.join(","),createDate:c,emoji:t.emoji||"\ud83c\udf1f",color:t.color||"var(--base0E)",grammar_mathjax:!1,grammar_ins:!1},l=[],i&&("images/randomCover.jpg",l.push({name:"images/randomCover.jpg",type:i.type,blob:i}),r.cover="![](./images/randomCover.jpg)"),u=$.trim(jsyaml.dump(r,{lineWidth:-1,forceQuotes:!0})),s=e.map((function(e,t){var i,r,o;return i=e.id,o="",(r=n[i])&&(o=r.statistics||""),o&&(o="<small>"+o+"</small>"),t+1+". ["+e.get("title")+"](xsjapp://doc/"+e.id+") "+o})).join("\n"),t.content&&(s=t.content),t.prefixContent&&(s=t.prefixContent+"\n\n"+s),t.suffixContent&&(s=s+"\n\n"+t.suffixContent),s="---\n"+u+"\n---\n\n"+s+"\n",new Promise((function(e,t){return $(window).trigger("importFile",[a,s,l,{},function(t){return e(t)}])}))}))},o=function(e){var t,n,o,c;function d(){return d.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)h.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(d,e),d.prototype.template=p,d.prototype.className="ui standard story_modal modal import_file_dialog",c={},t={},d.prototype.isReady=!1,d.prototype.events={"click .drop-zone":"selectFileFn","click .toggle_selected_file_btn":"toggleSelectedFileFn","click .select_file_btn":"triggerSelectFileFn","click .select_directory_btn":"triggerSelectDirectoryFn"},d.prototype.triggerSelectFileFn=function(){var e;return(e=this.$el.find("input[type=file]")).removeAttr("webkitdirectory"),e.trigger("click")},d.prototype.triggerSelectDirectoryFn=function(){var e;return(e=this.$el.find("input[type=file]")).attr("webkitdirectory",!0),e.trigger("click")},d.prototype.toggleSelectedFileFn=function(e){var t;if(!(t=$(e.currentTarget).parent().parent()).hasClass("positive"))return t.toggleClass("checked")},d.prototype.selectFileFn=function(){var e;return(e=this.$el.find("input[type=file]")).removeAttr("webkitdirectory"),e.trigger("click")},o=function(e){var n,i,r,o,a,s,l,u,d,p;for(a=[],(n=f.$el.find(".selected-file")).html("      "),c={},t={},r=u=0,d=e.length;u<d;r=++u)(s=e[r]).webkitRelativePath?t[s.webkitRelativePath]=s:s.path&&(t[s.path]=s),p=s.type.indexOf("/"),l=s.type.substr(0,p),(o=s.name.lastIndexOf("."))>0&&(i=s.name.substring(o).toUpperCase()),[".MD",".MARKDOWN",".HTML"].indexOf(i)>=0&&(l="text"),[".ZIP"].indexOf(i)>=0&&(l="zip"),"text"!==l&&"zip"!==l||(c[r]={file:s,path:s.path,webkitRelativePath:s.webkitRelativePath,type:l},a.push('<tr data-uid="'+r+'" class="checked">\n<td>'+(r+1)+'</td>\n<td class="title_cell"><div class="title">'+_.escape(s.name)+'</div></td>\n<td><i class="link icon square outline toggle_selected_file_btn"></i></td>\n</tr>'));return a.length>0&&n.html('<table class="ui table selectable">\n<thead>\n <th>#</th>\n <th>\u6587\u4ef6\u540d\u79f0</th>\n <th></th>\n</thead>\n<tbody>\n  '+a.join("")+"\n</tbody>\n</table>"),f.$el.find(".import_btn").removeClass("disabled")},d.prototype.ready=function(){return new Promise((e=this,function(t,n){return e.isReady?t():e.once("ready",t)}));var e},d.prototype.autoImportZipFile=function(e,t){return null==t&&(t={}),this.ready().then((n=this,function(){var i,r,a,s;return e instanceof Array||(e=[e]),o(e),f.$el.find(".ui.import_btn").trigger("click"),s=null,a=[],i={},r=function(e,t){return console.log("finishedOne",arguments),i[e.id]=t.selectedFile.file._meta||{},s=e,a.push(e)},n.on("finishedOne",r),n.once("finished",(function(){var e;return f.off("finishedOne",r),a.length>1?(e=function(){return $(window).trigger("createNewEditor",[a,{forceOpen:!0,callback:function(e,t){var n;if(n=t.$el.find(".popup_editor_file_tabs .file_item.droppable_file_item.active")[0])return t.focus(),appHighlightPosByEl(n)}}])},t.collectionMeta?u(a,t.collectionMeta,i).then((function(t){return $(window).trigger("changeFileModel",[t,{callback:function(){return setTimeout((function(){return e()}),600)}}])})):e()):1===a.length&&$(window).trigger("changeFileModel",[s,{callback:function(e,t,n){return setTimeout((function(){return t.focus()}),600)}}]),f.$el.find(".ui.cancel.button").trigger("click")}))}));var n},d.prototype.afterVisible=function(){return f=this,"webkitdirectory"in this.$el.find("input[type=file]")[0]&&this.$el.find(".select_file_btns").append('<button class="ui button select_directory_btn">\u9009\u62e9\u6587\u4ef6\u5939</button>'),l.initFileImportSupport(f.$el.find("input[type=file]"),o),l.initdragFilesSupport(f.$el.find(".drop-zone"),o)},d.prototype.showDimmer=function(e){if(f.dimmer.dimmer("show"),e)return this.$el.find(".dimmer>.ui.text").html(e)},d.prototype.hideDimmer=function(){return f.dimmer.dimmer("hide")},n=function(e){var t,n,o,l;return t=f.$el.find(".dimmer>.text"),o=new r,n=o.get("indexNames"),l=1,s.getBuildViewNames(i.pouchDB,(function(r,o){var c;return c=function(e,r){var c,u;return"fullsearch_index"===e?s.buildFullSearchView(i.pouchDB,"build",{processInfoFn:function(e){var i;if(e&&"showUpdateProgressInfo"===e.processType)return i=e.result,t.html("["+l+"/"+n.length+"]\u7d22\u5f15\u4e2d:"+i.viewSeq+" / "+i.dbSeq)}},(function(){return l++,r()})):(c=o.find((function(t){return t.startsWith("xsj")&&(t="xsj/"+t.split("/")[1]),e===t})))?(u={limit:0,beforeUpdateView:function(){},afterUpdateView:function(){},showUpdateProgressInfo:function(e,i,r,o){return t.html("["+l+"/"+n.length+"]\u7d22\u5f15\u4e2d:"+e+" / "+i)}},i.pouchDB.query(c,u).then((function(){return l++,r()})).catch((function(e){return l++,a.showMessage("\u7d22\u5f15\u51fa\u9519:"+e,6e3,"error"),r()}))):setTimeout((function(){return l++,r()}),1)},async.mapSeries(n,c,(function(){return e()}))}))},d.prototype.show=function(){return this.render(),this.$el.modal({closable:!1,onVisible:(e=this,function(){return e.afterVisible(),e.dimmer=e.$el.find(".story_content").dimmer({closable:!1,onHide:function(){return f.$el.find(".story_content>.dimmer").empty()},onShow:function(){return f.$el.find(".story_content>.dimmer").html('<div class="ui indeterminate text loader">\u6570\u636e\u51c6\u5907\u4e2d...</div>')},template:{dimmer:function(){return $("<div>").attr("class","ui dimmer sticky")}}}),e.trigger("ready"),e.isReady=!0}),onHidden:function(){return c={},t={},f.$el.modal("destroy"),f.remove(),f=null},onApprove:function(){var e,i,r,o,s;return!(e=f.$el.find(".import_btn")).hasClass("loading")&&((i=f.$el.find("tr.checked")).removeClass("error"),0===i.length?(a.showMessage("\u8bf7\u9009\u62e9\u4e00\u4e2a\u6587\u4ef6",3e3,"error"),!1):(f.showDimmer("\u5904\u7406\u4e2d..."),e.addClass("loading"),r=1,s=i.toArray(),o=function(e,n){var o,a,u,d,p;switch(u=s.indexOf(e),o=$(e),p=o.data("uid"),d=c[p]||{},f.showDimmer("\u5904\u7406\u4e2d"+r+++"/"+i.length),d.type){case"text":return l.importTextFile(d.file,null,(function(e,i){if(f)return l.getResourceData("defaul.md",i,(function(r,a){var s,c,h,m;return a=a.filter((function(e){return!/^http[s]?:\/\//i.test(e)})),c="","/",s=xsjPathHelper,d.webkitRelativePath?c=xsjPathHelper.dirname(d.webkitRelativePath):d.path&&"client"===STORY_PLATFORM&&(m=require("path"),s=m,m.sep,c=m.dirname(d.path)),h=[],async.mapLimit(a,20,(function(e,n){var i,r,o,a,u;return a=s.join(c,e),o=t[a],u=l.mimeLookup(e),o?h.push({name:e,type:u,blob:o}):"client"===STORY_PLATFORM&&(r=require("fs-extra")).existsSync(a)&&(i=r.readFileSync(a),h.push({name:e,type:u,blob:new Blob([i],{type:u})})),n()}),(function(){return $(window).trigger("importFile",[e,i,h,{},function(e){if(f)return f.trigger("finishedOne",e,{selectedFile:d,uid:p,index:u}),o.addClass("positive"),o.removeClass("checked"),o[0].scrollIntoViewIfNeeded?o[0].scrollIntoViewIfNeeded():o[0].scrollIntoView(),n()}])}))}))}));case"zip":return a=function(e,t){return l.importZipFile(e,null,(function(e,n,i,r,o){return f?$(window).trigger("importFile",[n,i,r,o,function(e){if(f)return f.trigger("finishedOne",e,{selectedFile:d,uid:p,index:u}),t()}]):t()}))},l.parseZipFile(d.file,null,(function(e,t){if(f)return e?(o.addClass("error"),o.removeClass("checked"),o.find(".title_cell .error_tip").remove(),o.find(".title_cell").append('<div class="error_tip">'+_.escape(e)+"</div>"),void n()):async.mapSeries(t,a,(function(){if(f)return o.addClass("positive"),o.removeClass("checked"),o[0].scrollIntoViewIfNeeded?o[0].scrollIntoViewIfNeeded():o[0].scrollIntoView(),n()}))}));default:return setTimeout((function(){if(f)return n()}),1)}},async.mapSeries(s,o,(function(){if(f)return n((function(){return f.hideDimmer(),f.trigger("finished"),e.removeClass("loading"),a.showMessage("\u64cd\u4f5c\u5b8c\u6210")}))})),!1))}}).modal("show");var e},d}(c),n.exports=o}}),window.requirejs.define({"views/insert_file_dialog_view":function(e,t,n){var i,r,o,a,s,l,c={}.hasOwnProperty;a=t("./view"),s=t("./templates/insert_file_dialog"),o=t("../lib/utils"),t("../application"),r=t("../lib/resource_core"),l=null,i=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)c.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.template=s,t.prototype.className="ui small modal",t.prototype.selectedFile=null,t.prototype.initialize=function(e){return l=this,this.fileModel=e.fileModel},t.prototype.events={"click .drop-zone":"selectFileFn","change input[name=link]":"inputChangeFn"},t.prototype.inputChangeFn=function(e){return l.selectedFile=null,l.$el.find(".drop-zone").removeClass("has-image").css("background-image",""),l.$el.find(".selected_filename").empty()},t.prototype.selectFileFn=function(){return l.$el.find("input[type=file]").trigger("click")},t.prototype.show=function(e,t){var n,i,a,s,c,u;return this.render(),this.dimmer=o.xsjDimmer(this.$el.find(".upload_container")),n=this.$el,o.initdragFilesSupport(n.find(".drop-zone"),(function(e){return o.insertImageFile(e,(function(e,t,n){var i;return i=o.dataURL2Blob(e),l.selectedFile={blobData:i,file:n,path:t},l.$el.find(".drop-zone").addClass("has-image").css("background-image","url("+e+")"),l.$el.find(".selected_filename").text(t)}))})),o.initFileImportSupport(n.find('input[type="file"]'),(function(e){return o.insertImageFile(e,(function(e,t,n){var i;return i=o.dataURL2Blob(e),l.selectedFile={blobData:i,file:n,path:t},l.$el.find(".drop-zone").addClass("has-image").css("background-image","url("+e+")"),l.$el.find(".selected_filename").text(t)}))})),(a=n.find(".ui.form")).form({fields:{link:{identifier:"link",rules:[{type:"empty",prompt:"\u56fe\u7247\u5730\u5740\u4e0d\u80fd\u4e3a\u7a7a"}]}},onSuccess:function(){var i;return"table"!==(i=n.find('select[name="fileType"]').val())&&"html"!==i||(i="image"),e(i,n.find('input[name="link"]').val(),t),n.modal("hide")}}),n.modal({dimmerSettings:{opacity:.7},onHidden:function(){return n.modal("destroy"),l.remove(),l=null},onDeny:function(){return e(null,null),!0},onApprove:function(){return l.selectedFile?(l.dimmer.dimmer("show"),r.uploadResource({},l.fileModel,l.selectedFile.path,l.selectedFile.file.type,l.selectedFile.blobData,{path:l.selectedFile.path},(function(e,t,i,r){return l.dimmer.dimmer("hide"),n.find('input[name="link"]').val(i),a.form("validate form")}))):a.form("validate form"),!1}}).modal("show"),n.find(".ui.menu .item").tab(),n.find(".file_gallery").mousewheel((function(e,t){return this.scrollLeft-=40*t,e.preventDefault()})),i=n.find(".ui.cards"),u=220*(c=this.fileModel.attachments()).length,i.css({width:u}),s=function(e,t){return l.fileModel.getAttachObjectByFilename(e,(function(r,o){var a,s,c;return l&&o&&o.objectUrl&&(s=o.objectUrl,c=e.substring(e.lastIndexOf(".")+1).toUpperCase(),a=_.contains(["JPG","JPEG","PNG","GIF","SVG"],c)?$('<div class="card">\n  <div class="center-cropped" style="background-image: url(\''+s+'\');"></div>\n  <div class="content">'+e+"</div>\n</div>"):$('<div class="card">\n  <div class="content">'+e+"</div>\n</div>"),i.append(a),a.click((function(){return n.find('input[name="link"]').val("./"+e)}))),t()}))},async.mapLimit(c,10,s,(function(){}))},t}(a),n.exports=i}}),window.requirejs.define({"views/light_editor_view":function(e,t,n){var i,r,o,a,s,l,c,u,d,p,f,h,m,v,g,w,y,b,x,k,D,C,F,M,T,S,P,j,E,I,O,V,L,A,B,N,R,H,z,q,W,U,Y={}.hasOwnProperty;f=t("./view"),g=t("./templates/light_editor_find_replace"),W=t("./templates/light_editor"),p=t("../lib/utils"),c=t("../application"),u=t("../lib/editor_tooltip"),m=null,H={bold:"ctrl+b",italic:"ctrl+i",mark:"ctrl+m",link:"ctrl+l",quote:"ctrl+q",code:"ctrl+k",image:"ctrl+g",olist:"ctrl+o",ulist:"ctrl+u",table:"ctrl+t",moment:"ctrl+.",magnet:"ctrl+shift+m",heading:"ctrl+h",rheading:"ctrl+shift+h",hr:"ctrl+r",undo:"ctrl+z",redo:"ctrl+y"},h={"vertical-rl":"left","vertical-lr":"right","horizontal-bt":"bottom","horizontal-tb":"top"},R=function(e){var t,n;if(e)return t=function(e){return".ace_editor, .codemirror_editor_wrapper .CodeMirror-line, .light_editor{font-family: "+e+"'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', 'source-code-pro', 'Courier', 'Lucida Console', monospace}"},n=p.parseCssText(t(e+", "),t("")),p.importCssString(n,"custom-editor-font-style",!0,document);$("#custom-editor-font-style").remove()},y=function(e){return h[e]||"top"},b=function(e,t,n,i){switch(i){case"top":return e.top>=0;case"bottom":return e.bottom<=n;case"left":return e.left<=t;case"right":return e.right>=0}},x=function(e,t,n,i,r){if(r)switch(i){case"top":return e.top>=n;case"bottom":return e.bottom<=0;case"left":return e.left<=0;case"right":return e.right>=t}else switch(i){case"top":return e.top<=n;case"bottom":return e.bottom>=0;case"left":return e.left>=0;case"right":return e.right<=t}},j=[],M=[],C=null,B=null,N=null,l=null,o=null,i=null,a=null,r=null,s=null,S="",T=!1,P=!1,q=!1,E="",F=function(e,t){var n,c;return l=e.find(".input_search"),c=_.debounce((function(){return D(!1)}),500),l.on("keyup keydown",(function(){return c()})),o=e.find(".found_counter"),(i=e.find(".checkbox_case_sensitive")).on("change",(function(){return D(!1)})),(a=e.find(".checkbox_regexp")).on("change",(function(){return D(!1)})),r=e.find(".replace_button"),n=e.find(".replace_all_button"),e.find(".search_button").click(v),r.click(O),n.click(V),s=e.find(".input_replace_with"),C=rangy.createCssClassApplier("find_replace_highlight",{normalize:!1}),B=rangy.createCssClassApplier("find_replace_select",{normalize:!1}),e.find(".ui.checkbox").checkbox(),$().add(l).add(s).keydown((function(e){if(13===e.which)return e.preventDefault(),v()})),e.find(">i.close").click((function(){return e.hide(),k()})),jwerty.key("ctrl+f",(function(t){return e.visible()?(e.hide("fast"),k()):(e.show("fast"),z()),t.preventDefault(),t.stopPropagation()}),t[0])},L=function(){return A(),j.forEach((function(e){var t;try{return C.undoToRange(e)}catch(e){return t=e,console.log(t)}})),j=[]},A=function(){var e;if(N){try{N&&B.undoToRange(N)}catch(t){e=t,console.log(e)}return N=void 0}},D=function(e){var t,n,r,s,c,u,d,p,f,h,v,g,_,w,y,b,x,k;if(q&&(x=l.val(),s=i.prop("checked"),k=a.prop("checked"),e||x!==S||s!==T||k!==P)){if(S=x,T=s,P=k,L(),h={},t=function(e){return e.container===h.container?{container:v.endContainer.parentElement.nextSibling,offsetInContainer:e.offsetInContainer-h.offsetInContainer,offset:e.offset}:e},M=[],d=0,x.length)try{if(u=s?"gm":"gmi",x=k?x:x.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),E=new RegExp(x,u),m.getValue().replace(E,(function(e,t){return M.push({start:t,end:t+e.length})})),d=M.length,M.length<200){for(w=[],M.forEach((function(e){return w.push(e.start),w.push(e.end)})),w=m.selectionMgr.findOffsets(w),p=f=0,b=w.length-1;f<=b;p=f+=2)_=w[p],g=w[p+1],r=t(_),n=t(g),(y=rangy.createRange()).setStart(r.container,r.offsetInContainer),y.setEnd(n.container,n.offsetInContainer),h=g,v=y,C.applyToRange(y),j[_.offset]=y;m.selectionMgr.hasFocus&&m.selectionMgr.updateSelectionRange()}}catch(e){c=e,console.log(c)}return o.html(d)}},z=function(){var e;return q=!0,(e=m.selectionMgr.getSelectedText())&&l.val(e),m.selectionMgr.adjustTop=50,m.selectionMgr.adjustBottom=220,D(!0)},k=function(){return q=!1,L(),m.selectionMgr.adjustTop=0,m.selectionMgr.adjustBottom=0,m.focus()},v=function(){var e,t,n;if(A(),t=Math.min(m.selectionMgr.selectionStart,m.selectionMgr.selectionEnd),(e=_.find(M,(function(e){return e.start>t})))||(e=_.first(M)),e)return(N=j[e.start])||(n=m.selectionMgr.createRange(e.start,e.end),(N=rangy.createRange()).setStart(n.startContainer,n.startOffset),N.setEnd(n.endContainer,n.endOffset)),B.applyToRange(N),N.start=e.start,N.end=e.end,m.selectionMgr.setSelectionStartEnd(e.start,e.end),m.selectionMgr.updateCursorCoordinates(!0)},O=function(){var e;return N?(e=s.val(),m.replace(N.start,N.end,e),setTimeout((function(){return v(),s.focus()}),1)):v()},V=function(){var e;return e=s.val(),m.replaceAll(E,e)},U=null,I="^[ \\t]*\\n\\\\?\\\\begin\\{[a-z]*\\*?\\}[\\s\\S]*?\\\\end\\{[a-z]*\\*?\\}|"+(I="^[ \\t]*\\n\\\\\\\\[[\\s\\S]*?\\\\\\\\]|"+(I="^[ \\t]*\\n\\$\\$[\\s\\S]*?\\$\\$|"+(I="^```[^`\\n]*\\n[\\s\\S]*?\\n```|"+(I="^.+[ \\t]*\\n=+[ \\t]*\\n+|^.+[ \\t]*\\n-+[ \\t]*\\n+|^\\#{1,6}[ \\t]*.+?[ \\t]*\\#*\\n+")))),I=new RegExp(I,"gm"),w=function(e){var t;switch((t=(e=$.trim(e)).indexOf("?"))>=0&&(e=e.substring(0,t)),e){case"object-c":return"objectivec";case"html":return"markup";default:return e}},d=function(e){var t,n,d;function f(){return f.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)Y.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(f,e),f.prototype.className="light_editor_wrapper main_content_wrapper",f.prototype.template=W,f.prototype.writingMode="horizontal-tb",f.prototype.editorType="",f.prototype.editorView=null,f.prototype.rootEditorProxy=null,d=null,n={},t=null,f.prototype.initialize=function(e){return U=this,this.fileModel=e.fileModel,this.editorView=e.editorView,this.rootEditorProxy=this,this.listenTo(this.model,"change",this.setEditorConfig)},f.prototype.initEditor=function(e,t,n){var i,r;return this.render(),this.$el.appendTo(e),this.$lightEditor,d=new Mousetrap(this.lightEditorEl),i=null,window.cledit?setTimeout((function(){return i()}),0):p.asyncLoadResources([{id:"prism_js",type:"script",filename:"js/cledit/prism.js"},{id:"rangy_js",type:"script",filename:"js/rangy/rangy.js"}],(function(){return rangy.init(),p.asyncLoadResources([{id:"cledit_js",type:"script",filename:"js/cledit/cledit.js"},{id:"prism_markdown_js",type:"script",filename:"js/cledit/prism-markdown.js"},{id:"prism_latex_js",type:"script",filename:"js/cledit/prism-latex.js"},{id:"prism_previewer_base_js",type:"script",filename:"js/cledit/prism-previewer-base.js"},{id:"prism_previewer_image_js",type:"script",filename:"js/cledit/prism-previewer-image.js"},{id:"prism_previewer_base_css",type:"style",filename:"js/cledit/css/prism-previewer-base.css"}],(function(){return i()}))})),r=this,i=function(){return r.editor=cledit(r.editorContentEl,r.$lightEditor[0]),m=r.editor,r.editor.init({highlighter:function(e){var t;return t=!1,e=e.replace(/^```([^`\n]*)\n([\s\S]*?)\n```/g,(function(e,n,i){var r;return t=!0,(r=w(n))&&Prism.languages[r]?"<span class='token pre gfm ace_support ace_function'><span class='token md md-pre'>```</span>"+n+"\n<span class='token lf'></span>"+Prism.highlight(i,Prism.languages[r])+"<span class='token lf'></span>\n<span class='token md md-pre'>```</span></span>":Prism.highlight(e,Prism.languages.md)})),t||(e=Prism.highlight(e,Prism.languages.md)),e},sectionParser:function(e){var t,n,i,r;return r=[],(n=/^(---[ \t]*\n)([\s\S]+?)(---[ \t]*\n)/.exec(e))&&(t=n[0],r.push(n[1]),r.push(n[2]),r.push(n[3]),e=e.substring(t.length)),i=0,(e+"\n\n").replace(I,(function(t,n){return r.push(e.substring(i,n)),i=n})),r.push(e.substring(i)),r}}),m.getValue=m.getContent,m.setValue=m.setContent,r.$findReplace=$(g()),e.append(r.$findReplace),F(r.$findReplace,r.$lightEditor),r.setEditorConfig(),r.bindEvent(),r.editor.on("focus",(function(){return U.editorView.setActiveEditorProxy(U)})),r.editor.undoMgr.on("undoStateChange",(function(){return U.editor.undoMgr.onButtonStateChange()})),r.initContextMenu(),"function"==typeof n?n():void 0}},f.prototype.afterRender=function(){var e,t;return this.$lightEditor=this.$el.find("#light_editor"),this.lightEditorEl=this.$lightEditor[0],e=this.$el.find(".editor-content"),this.editorContentEl=e[0],this.$lightEditor.on("mouseenter",".fn",(t=this,function(e){var n,i;if(n=$(e.currentTarget).find(".md-ref").html(),i=p.getReference(t.getValue(),n))return u.show(e,$("#main"),i)})),this.$lightEditor.on("mouseleave",".fn",(function(e){return u.hide(e)})),this.$el.on("mousedown",".md-checkbox",(function(e){var t;return(t=e.currentTarget).innerHTML=t.innerHTML.replace(/\[(.)\]/,(function(e,t){return"["+(" "===t?"x":" ")+"]"}))}))},f.prototype.initContextMenu=function(){var e,t;if(t="none",e=".editor-tool","client"===STORY_PLATFORM&&(t="right",e=".light_editor"),$.contextMenu({selector:e,trigger:t,build:function(e,t){var n,i,r,o,a,s,l,c;return"client"===STORY_PLATFORM&&(n=window.nw.Clipboard.get(),r=n.get("text"),i=n.get("html")),c=U.editor.selectionMgr.getSelectedText(),a={pasteAsTextToMarkdown:{name:"\u5c06\u6587\u672c\u8f6c\u6362\u6210 markdown \u8fdb\u884c\u7c98\u8d34",callback:function(){var e,t,i;return e=p.html2markdown(r),i=n.readAvailableTypes().map((function(e){return{type:e}})),t=n.get(i),n.set(e,"text"),U.$el.find(".light_editor").focus(),document.execCommand("paste"),n.set(t),!0}},pasteAsHtmlToMarkdown:{name:"\u5c06\u5bcc\u6587\u672c\u8f6c\u6362\u6210 markdown \u8fdb\u884c\u7c98\u8d34",disabled:!i,callback:function(){var e,t,r;return e=p.html2markdown(i),r=n.readAvailableTypes().map((function(e){return{type:e}})),t=n.get(r),n.set(e,"text"),U.$el.find(".light_editor").focus(),document.execCommand("paste"),n.set(t),!0}},pasteAsHtml:{name:"\u76f4\u63a5\u7c98\u8d34html\u7247\u6bb5",disabled:!i,callback:function(){var e,t,r;return e=p.tidyHtml(i),r=n.readAvailableTypes().map((function(e){return{type:e}})),t=n.get(r),n.set(e,"text"),U.$el.find(".light_editor").focus(),document.execCommand("paste"),n.set(t),!0}},subsep1:"---------",pasteAsModal:{name:"\u66f4\u591a\u7c98\u8d34 ...",callback:function(){return $("#wmd-html-button").trigger("click")}}},l="\u7c98\u8d34","client"!==STORY_PLATFORM&&(l="\u7c98\u8d34\u4e3a ..."),s={name:l,callback:function(){return U.$el.find(".light_editor").focus(),"client"===STORY_PLATFORM?document.execCommand("paste"):$("#wmd-html-button").trigger("click"),!0}},o={undo:{name:"\u64a4\u6d88",disabled:!U.editor.undoMgr.canUndo(),callback:function(){return U.editor.undoMgr.undo()}},redo:{name:"\u91cd\u505a",disabled:!U.editor.undoMgr.canRedo(),callback:function(){return U.editor.undoMgr.redo()}},sep1:"---------",cut:{name:"\u526a\u5207",disabled:!c,callback:function(){return U.$el.find(".light_editor").focus(),document.execCommand("cut"),!0}},copy:{name:"\u590d\u5236",disabled:!c,callback:function(){return U.$el.find(".light_editor").focus(),document.execCommand("copy"),!0}},paste:s},"client"===STORY_PLATFORM&&Object.assign(o,{pasteAs:{name:"\u7c98\u8d34\u4e3a ...",items:a}}),Object.assign(o,{sep2:"---------",selectAll:{name:"\u9009\u62e9\u5168\u90e8",callback:function(){return document.execCommand("selectAll"),!0}}}),{items:o}}}),"client"!==STORY_PLATFORM)return $(document).on("contextmenu",".light_editor",(function(t){if(t.ctrlKey)return t.preventDefault(),t.stopPropagation(),$(e).trigger($.Event("contextmenu",{pageX:t.pageX,pageY:t.pageY,data:t.data}))}))},f.prototype.destroyContextMenu=function(){var e;if(e=".editor-tool","client"===STORY_PLATFORM&&(e=".light_editor"),$.contextMenu("destroy",e),"client"!==STORY_PLATFORM)return $(document).off("contextmenu",".light_editor")},f.prototype.destroyEditor=function(){return this.editor.destroy(),this.editor=null,this.editorView=null,this.$el.off("mousedown"),m=null,window._rangySelection=null,this.$findReplace.remove(),this.$findReplace=null,l=null,o=null,i=null,a=null,r=null,s=null,this.remove(),this.destroyContextMenu(),U=null},f.prototype.mouseWheelEvt=function(e,t){return this.scrollLeft+=40*t},f.prototype.arrowEvt=function(e){switch(e.which){case 37:return e.which=40;case 38:return e.which=37;case 39:return e.which=38;case 40:return e.which=39}},f.prototype.changeWritingMode=function(e){var t;if(null==e&&(e="horizontal-tb"),this.writingMode=e,t=e.replace(/-/g,"_"),!this.$lightEditor.hasClass(t))return this.$lightEditor.removeClass("vertical_rl vertical_lr horizontal_tb horizontal_bt").addClass(t),this.$lightEditor.find(">.editor-content"),"vertical-lr"===e||"vertical-rl"===e?this.$lightEditor.on("mousewheel",this.mouseWheelEvt):this.$lightEditor.off("mousewheel",this.mouseWheelEvt)},f.prototype.toggleZenMode=function(e){return e?this.$el.addClass("ui segment zen_mode"):this.$el.removeClass("ui segment zen_mode")},f.prototype.resize=function(){},f.prototype.changeFileModel=function(e){return this.fileModel=e,this.setEditorContent()},f.prototype.setEditorContent=function(){var e;if(this.fileModel)return e=this.fileModel.get("content"),this.editor.setContent(e,!0),this.editor.undoMgr.init()},f.prototype.setEditorConfig=function(){var e,t;return R(this.model.get("editorFont")),e=this.model.get("fontSize")||16,(t=this.model.get("lineHeight"))||(t=1.4*e/16),U.$lightEditor.css("fontSize",e+"px"),U.$lightEditor.css("lineHeight",t)},f.prototype.getValue=function(){return this.editor.getValue()},f.prototype.getLength=function(){return this.getValue().split("\n").length},f.prototype.getScreenLength=function(){return this.getLength()},f.prototype.getRowLength=function(e){return 1},f.prototype.screenToDocumentRow=function(e){return e},f.prototype.screenToDocumentRowHeight=function(e){return this.documentToScreenRowHeight(e,0)},f.prototype.documentToScreenRow=function(e){return e},f.prototype.documentToScreenRowHeight=function(e,t){var n,i,r,o,a;for(null==t&&(t=0),e<=0&&(e=1),r=this.getValue().split("\n"),a=0,n=i=0,o=e-1;0<=o?i<=o:i>=o;n=0<=o?++i:--i)a+=r[n].length+1;return this.editor.selectionMgr.createRange(a,a+1).getBoundingClientRect().top},f.prototype.getScrollTop=function(){return this.lightEditorEl.scrollTop},f.prototype.getFirstVisibleRow=function(){var e,t,n,i,r,o,a;for(t=this.$lightEditor.height(),a=this.$lightEditor.width(),e=y(this.writingMode),this.getValue(),n=this.getValue().split("\n"),r=0,o=0;r<n.length&&!((i=this.editor.selectionMgr.createRange(o,o+1).getClientRects()).length>0&&b(i[0],a,t,e));)o+=n[r++].length+1;return r},f.prototype.getLastVisibleRow=function(e){var t,n,i,r,o,a,s,l,c,u,d;if(i=this.$lightEditor.height(),d=this.$lightEditor.width(),t=y(this.writingMode),e>=0){for(c=e,a=this.getValue().split("\n"),u=0,r=o=0,l=c;0<=l?o<=l:o>=l;r=0<=l?++o:--o)u+=a[r].length+1;for(;c<a.length&&!((s=this.editor.selectionMgr.createRange(u,u+1).getClientRects()).length>0&&x(s[0],d,i,t,!0));)u+=a[c++].length+1}else for(c=(a=this.getValue().split("\n")).length-1,n=this.getValue().length;c>=0&&!((s=this.editor.selectionMgr.createRange(n-1,n).getClientRects()).length>0&&x(s[0],d,i,t,!1));)n=n-a[c--].length-1;return c},f.prototype.getCursorPositionScreen=function(){var e,t,n;for(t=this.editor.selectionMgr.selectionStart,e=this.getValue().split("\n"),n=0;t>0&&n<e.length;)t=t-e[n++].length-1;return n-1<0?0:n-1},f.prototype.getCursorPosition=function(){return this.getCursorPositionScreen()},f.prototype.getCursorPositionXY=function(){return{row:this.getCursorPosition(),column:0}},f.prototype.highlightLines=function(e,t){},f.prototype.removeMarker=function(e){},f.prototype.execCommand=function(e,t,i){if(m=this.editor,n[e])return i&&(i.preventDefault(),i.stopPropagation()),n[e](m,i)},f.prototype.addCommands=function(e){return n={},e&&(t=_.clone(e)),e=t||{},m=this.editor,d.reset(),Object.keys(e).forEach((function(t){var i,r;if(i=e[t],n[t]=i.fn,(r=H[t.substring("xsj_".length)])&&d.bind(r,(function(e){return e.stopPropagation(),e.preventDefault(),i.fn(m,e)})),i.shortcuts&&i.shortcuts.length>0)return i.shortcuts.forEach((function(e){if(e.lightValue)return d.bind(e.lightValue,(function(e){return e.stopPropagation(),e.preventDefault(),i.fn(m,e)}))}))}))},f.prototype.bindUserKeyBoard=function(e){if(this.addCommands(),m=this.editor,e&&e.length>0)return e.forEach((function(e){var t;if(!e.range||"editor"===(t=e.range)||"all"===t)return e.shortcuts&&e.shortcuts.length>0?e.shortcuts.forEach((function(t){if(t.lightValue){if(n[e.command])return d.bind(t.lightValue,(function(t){return t.stopPropagation(),t.preventDefault(),n[e.command](m,t)}));if(c.hasCommand(e.command))return d.bind(t.lightValue,(function(t){if(c.hasCommand(e.command))return t.stopPropagation(),t.preventDefault(),c.execCommand(e.command,e,t)}))}})):void 0}))},f.prototype.bindEvent=function(){return this.editor.on("cursorCoordinatesChanged",(function(){return U.$el.parent().trigger("changeCursor")})),this.editor.on("contentChanged",(function(){return U.$el.parent().trigger("contentChange")})),this.$lightEditor.on("scroll",(function(){return U.$el.parent().trigger("editorScroll")})),this.$lightEditor.on("selectionChanged",(function(){return U.$el.parent().trigger("changeSelection")}))},f.prototype.getSelectionRange=function(){return{start:this.editor.selectionMgr.selectionStart,end:this.editor.selectionMgr.selectionEnd}},f.prototype.setSelectionRange=function(e,t){return this.editor.selectionMgr.setSelectionStartEnd(e,t)},f.prototype.gotoLine=function(e,t){var n,i;return null==e&&(e=0),null==t&&(t=0),n=this.getScrollTop(),i=this.screenToDocumentRowHeight(e)+n-this.el.getBoundingClientRect().top,this.scrollToY(i)},f.prototype.scrollToY=function(e){return this.lightEditorEl.scrollTop=e},f.prototype.moveCursorTo=function(e,t){return 0},f.prototype.focus=function(){return this.editor.focus()},f.prototype.search=function(){return 0},f.prototype.setValue=function(e){return this.editor.setContent(e)},f.prototype.insertSnippet=function(e){return this.insertValue(e)},f.prototype.insertValue=function(e){var t;return t=this.editor.selectionMgr.selectionStart,this.editor.replace(t,t,e)},f.prototype.getUndoManager=function(){return this.editor.undoMgr},f}(f),n.exports=d}}),window.requirejs.define({"views/link_map_window_view":function(e,t,n){var i,r,o,a,s,l,c,u,d=function(e,t){for(var n in t)p.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e},p={}.hasOwnProperty;l=t("../lib/notifier"),u=t("../lib/utils"),i=t("../application"),r=t("./base_window_manager_view"),o=t("../constant"),c=t("../lib/pouchdb_index_view_manager"),a=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return d(t,e),t.prototype.local_storage_name="link_map_window_manager",t}(r),s=function(e){var t,n,r,s,p,f,h,m,v,g;function w(){return w.__super__.constructor.apply(this,arguments)}return d(w,e),w.prototype.className="draggable_dialog_content_container",p=null,f=null,null,t=null,n=null,s=null,{},{},{},g=null,h=function(e,t){var n;return n=o.pouchDB,c.getReverseLinkView(n,(function(i,r){var o,a,s,l;return i?t(i):(l=r.viewName,a=[],s=[e._id],e.title&&s.push(e.title),e.slug&&s.push(e.slug),s.forEach((function(e){return e=e.replace(/^\/+|\/+$/g,""),a.push(e),a.push("/"+e),a.push(e+"/"),a.push("/"+e+"/")})),o={keys:a,reduce:!1,group:!1},n.query(l+"/by_reverse_link",o).then((function(i){var r;if(!((r=_.uniq(i.rows.map((function(e){return e.id}))).filter((function(t){return t!==e._id}))).length<=0))return n.allDocs({include_docs:!0,keys:r}).then((function(e){return t(null,e.rows.map((function(e){return e.doc})))})).catch((function(e){return t(e)}));t(null,[])})))}))},r=function(e,t){return g.onChangeFileModel(t.attributes),h((n=t).attributes,(function(e,t){return t=t||[],g.loadDocs(t,{disableAnimation:!0,depthLoad:0})}))},v=function(e,t,n,i){return f.showDimmer("\u7d22\u5f15\u4e2d:"+e+" / "+t)},w.prototype.initialize=function(e){return n=e.fileModel,t=e.editorView,s=e.initDocs,$(window).on("fileModelChanged",r)},w.prototype.show=function(){var e,t,n;if(e=!1,(t=i.getUserModel().get("user"))&&t.vip&&(e=!0),"web"===STORY_PLATFORM&&(e=!0),e)return(f=new a).show(),this.render(),f.$el.find(".draggable_dialog_content_container_wrapper").append(this.$el),f.on("beforeClose",(function(){if(g)return g.destroy(),g=null})),f.on("close",(n=this,function(){return n.trigger("close"),n.remove(),f=null}));l.showMessage("\u8be5\u529f\u80fd\u53ea\u5bf9\u4f1a\u5458\u5f00\u653e",6e3,"error")},w.prototype.render=function(){var e,r,a;return a="./visnetwork/index.html","production"!==ENV&&(a="./visnetworkdev/index.html"),e=$('<div class="draggable_dialog_content iframe_wrapper" style="overflow:hidden;"></div>'),(r=$('<iframe allowfullscreen src="'+a+'" class="preview_iframe" frameborder="0" style="width: 100%;height:100%;"></iframe>').appendTo(e)).one("load",(function(){var e;return e=r[0],e.contentDocument,(p=e.contentWindow).G6Network.app.default(p,window).initLinkMap(n.attributes,{changeFileModel:function(e,t){return i.getFileCollection().getModelById(e,(function(e,n){return e?l.showMessage("\u6253\u5f00\u6587\u4ef6\u5931\u8d25:"+e,6e3,"error"):n?t?$(window).trigger("createNewEditor",[n]):$(window).trigger("changeFileModel",[n]):l.showMessage("\u6253\u5f00\u6587\u4ef6\u5931\u8d25: \u627e\u4e0d\u5230\u8be5\u6587\u4ef6",6e3,"error")}))},showLinkMap:m,showError:function(e){return l.showMessage("\u52a0\u8f7d\u7ed3\u70b9\u4fe1\u606f\u51fa\u9519:"+e,6e3,"error")},showDimmer:function(e){return f.showDimmer(e)},hideDimmer:function(){return f.hideDimmer()},listFilesByTag:function(e){return $(window).trigger("changeFilterInfo",["tag",e])},listFilesByReverse:function(e){return $(window).trigger("changeFilterInfo",["reverse",e])},queryByIds:function(e,t){return o.pouchDB.allDocs({include_docs:!0,keys:e},(function(e,n){var i;return e?(l.showMessage("\u52a0\u8f7d\u51fa\u9519:"+e,6e3,"error"),t(null,[])):(i=[],n.rows.forEach((function(e){if(!e.error)return i.push(e.doc)})),t(null,i))}))},queryByCreateDateRange:function(e,t,n){var i;return i=o.pouchDB,c.queryByCreateDateRange(i,e,t,{include_docs:!0,showUpdateProgressInfo:v},(function(e,t){return f.hideDimmer(),n(e,t)}))},groupByMonths:function(e){var t;return t=o.pouchDB,c.getDateView(t,(function(n,i){var r;return n?l.showMessage("\u52a0\u8f7d\u7d22\u5f15\u51fa\u9519:"+n,6e3,"error"):(r=i.viewName,t.query(r+"/by_create_date",{reduce:!0,group:!0,group_level:2,showUpdateProgressInfo:v}).then((function(t){return f.hideDimmer(),e(null,t.rows)})).catch((function(t){return l.showMessage("\u52a0\u8f7d\u6570\u636e\u51fa\u9519:"+t,6e3,"error"),f.hideDimmer(),e(t)})))}))},locationInEditor:function(e){return t.search(e)}},(function(e,t){return g=t,s&&s.length>0&&g.loadDocs(s),h(n.attributes,(function(e,t){return t=t||[],g.loadDocs(t,{disableAnimation:!0,depthLoad:0})}))}))})),this.$el.html(e),f.showDimmer()},m=function(e,t,n){var i,r,a,s,l,d,p,h;return r=e.content,p=(d=u.getLinkInfo("a.md",r)).map((function(e){return e.link})),h=Array.from(new Set(p)),l=h.reduce((function(e,t){return e.push(t),e.push("/"+t),e.push("/"+t+"/"),e.push(t+"/"),e}),[]),s=function(e,t){return e.reduce((function(e,n){return(e[n[t]]=e[n[t]]||[]).push(n),e}),{})}(d,"link"),i=h.map((function(e){return e.replace(/^[\.\/]*|\/*$/g,"")})),(a=o.pouchDB).allDocs({include_docs:!0,keys:i},(function(i,r){return c.getSlugView(a,(function(i,o){var c;if(!i)return c=o.viewName,a.query(c+"/by_slug",{reduce:!1,group:!1,include_docs:!0,keys:l,showUpdateProgressInfo:v}).then((function(i){var o;return f.hideDimmer(),o=[],r.rows.forEach((function(e){if(!e.error&&e.doc)return o.push({doc:e.doc,id:e.id,key:e.key,value:{createDate:e.doc.createDate,updateDate:e.doc.updateDate}})})),i.rows.forEach((function(e){return o.push(e)})),t(e,s,o,n)})).catch((function(e){return f.hideDimmer(),n(e)}));n(i)}))}))},w.prototype.remove=function(){return p=null,f=null,null,t=null,n=null,s=null,{},{},g=null,{},$(window).off("fileModelChanged",r),w.__super__.remove.apply(this,arguments)},w.prototype.close=function(){return null!=f?f.remove():void 0},w}(Backbone.View),n.exports=s}}),window.requirejs.define({"views/link_relation_window_view":function(e,t,n){var i,r,o,a,s,l,c,u,d,p,f,h,m,v,g,w,y,b,x=function(e,t){for(var n in t)k.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e},k={}.hasOwnProperty;u=t("../lib/notifier"),t("../lib/utils"),p=t("../lib/utils_url"),i=t("../application"),r=t("./base_window_manager_view"),o=t("../constant"),d=t("../lib/pouchdb_index_view_manager"),s=t("./link_map_window_view"),a=t("../models/file_model"),g=null,f=function(e,t,n){return e.getRootNode().findFirst((function(e){return e.key===t.id})).setTitle(n+"")},b=function(e,t,n){var i,r,o;o=e.getRootNode(),(r=e.getNodeByKey(t.id))?(r.extraClasses="fancytree-current",r.renderStatus(),r.resetLazy()):(o.removeChildren(),r=o.addNode({key:t.id,title:n,extraClasses:"fancytree-current",folder:!0,lazy:!0,data:{type:"source",id:t.id,doc:t.attributes}})),r.setExpanded();try{return r.scrollIntoView()}catch(e){return i=e,console.log(i)}},m=function(e,t){return i.getFileCollection().getModelById(e,(function(e,n){return e?t("\u6253\u5f00\u6587\u4ef6\u5931\u8d25:"+e):n?t(null,n):t("\u6253\u5f00\u6587\u4ef6\u5931\u8d25: \u627e\u4e0d\u5230\u8be5\u6587\u4ef6")}))},y=function(e,t,n,i){var r,o,a,s;if(!t.processing)if(e.ctrlKey)m(n.data.tid,(function(e,t){return e?u.showMessage(e,6e3,"error"):$(window).trigger("changeFileModel",[t,{callback:function(){return i.editorProxy.editor}}])}));else{if(t.processing=!0,o=i.editorProxy.editor,(a=n.data.info).anchor,s=function(){var e;return t.processing=!1,e=i.editorProxy,o=e.editor,e.gotoLine(a.anchor.line-1),o.highlightPos(a.anchor)},r=function(e){return m(e,(function(e,n){return e?(u.showMessage("\u6253\u5f00\u6587\u4ef6\u5931\u8d25:"+e,6e3,"error"),t.processing=!1):$(window).trigger("changeFileModel",[n,{callback:function(){return s()}}])}))},!i.fileModel||n.data.sid!==i.fileModel.id)return r(n.data.sid);s()}},h=function(e,t,n,i){var r,o,a,s;if(!t.processing){if((a=n.data.info).anchor,o=n.parent,!e.ctrlKey)return t.processing=!0,r=n.span.getBoundingClientRect(),s=function(e){return $(window).trigger("createNewEditor",[e,{position:{left:r.left,top:r.bottom},forceOpen:!0,groupId:g,callback:function(e,n){var i;return t.processing=!1,g=e.id,i=n.editor,n.gotoLine(a.anchor.line,a.anchor.ch),i.highlightPos(a.anchor)}}])},function(e){return m(e,(function(e,n){return e?(u.showMessage(e,6e3,"error"),t.processing=!1):s(n)}))}(o.data.id);m(n.data.sid,(function(e,t){return e?u.showMessage(e,6e3,"error"):$(window).trigger("changeFileModel",[t,{callback:function(){var e,t;return e=(t=i.editorProxy).editor,t.gotoLine(a.anchor.line,a.anchor.ch),e.highlightPos(a.anchor)}}])}))}},v=function(e,t){var n,i,r,o;return n=function(e,t,n){var i,r,o,a,s,l,c,u;for(l=(u=CodeMirror.Doc(t)).getSearchCursor(e,{line:0,ch:0},!1),s=[];l.findNext();)r=l.from(),a=u.indexFromPos(r),o=u.getLine(r.line),(c=r.ch-10)<0&&(c=0),i="["+r.line+", "+r.ch+"]"+o.substr(c,20),s.push(n.push({anchor:r,head:l.to(),link:e,pos:a,contextText:i}));return s},i=[],o=t.data.doc,r=e.data.doc,n(o._id,r.content,i),o.title&&(n("[["+o.title,r.content,i),n("]("+o.title,r.content,i)),o.slug&&n(o.slug,r.content,i),i.sort((function(e,t){return e.pos-t.pos})),i.map((function(n){return{key:e.data.id+">"+t.data.id+">"+n.pos,title:n.contextText,folder:!1,data:{sid:e.data.id,tid:t.data.id,type:"link",info:n}}}))},w=function(e){return{menu:function(e){if({},e.isFolder()&&e.parent.isRoot())return{reload:{name:"\u5237\u65b0"},openAs:{name:"\u5728\u65b0\u7684\u6d6e\u52a8\u7f16\u8f91\u5668\u6253\u5f00"}}},actions:function(e,t,n){var i;switch(t){case"reload":return e.resetLazy(),e.setExpanded();case"openAs":return(i=e.children.reverse().filter((function(e){var t;return!!(null!=(t=e.data)?t.doc:void 0)})).map((function(e){return new a(e.data.doc)}))).length>0?$(window).trigger("createNewEditor",[i]):u.showMessage("\u6ca1\u6709\u53ef\u4ee5\u6253\u5f00\u7684\u6587\u4ef6",1e3,"warning")}}}},l=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return x(t,e),t.prototype.local_storage_name="link_relation_window_manager",t}(r),c=function(e){var n,i,r,c,m,g,k,D;function C(){return C.__super__.constructor.apply(this,arguments)}return x(C,e),C.prototype.className="draggable_dialog_content_container",null,g=null,r=null,"reverse",c=null,i=null,k=null,D=null,C.prototype.refresh=null,C.prototype.processing=!1,C.prototype.fileModelTitleChanged=function(e,t){return f(k,e,t),f(i,e,t)},m=function(e,t){if(t)return c&&c.off("change:title",D.fileModelTitleChanged),(c=t).on("change:title",D.fileModelTitleChanged),b(k,c," \u8c01\u5f15\u7528\u4e86\u6211\uff1a"+c.get("title")),b(i,c," \u6211\u5f15\u7528\u4e86\u8c01\uff1a"+c.get("title"))},C.prototype.initialize=function(e){return D=this,c=e.fileModel,r=e.editorView,c.on("change:title",D.fileModelTitleChanged),this.refresh=_.debounce(n,300),$(window).on("fileModelChanged",m),r.on("change",this.refresh)},C.prototype.show=function(e){var n,i,o,a;return a=e[0].getBoundingClientRect(),(g=new l({canMax:!1,canMin:!1,canShape:!1,position:{width:400,left:a.left-400,top:a.bottom-200}})).show(),g.showDimmer(),this.render(),g.setTitle("\u94fe\u63a5\u5f15\u7528\u5173\u7cfb\u5668"),g.$el.find(".header_logo>i").removeClass().addClass("fas fa-bezier-curve icon"),g.$el.find(".draggable_dialog_content_container_wrapper").append(this.$el),o=$('<i class="icon hubspot header_button basic" title="\u6253\u5f00\u5f15\u7528\u5173\u7cfb\u56fe" style="font-weight: bolder;font-size: 1.2em;"/>'),i=null,o.on("click",(function(){return i&&(i.close(),i=null),(i=new s({fileModel:c,editorView:r})).show()})),g.$el.find(".header_button_container").prepend(o),n=this,t("../lib/dynamic_import/import_fancytree")((function(){return n.initReverseTree(),n.initDirectTree(),g.hideDimmer(),g.on("beforeClose",(function(){return o.remove(),n.destroyTree()})),g.on("close",(function(){return n.trigger("close"),n.remove(),g=null}))}))},C.prototype.render=function(){var e;return e=$('<div class="draggable_dialog_content" style="overflow:hidden; flex-basis: 0;position:initial;">\n  <div class="task_tree_container theme_tree_container link_relation_container">\n    <div class="reverse_link_tree task_tree"></div>\n    <div class="direct_link_tree task_tree"></div>\n  </div>\n</div>'),this.$el.html(e)},C.prototype.initDirectTree=function(){var e,t,n;return t={autoCollapse:!1,clickFolderMode:2,scrollParent:this.$el.find(".direct_link_tree"),extensions:["wide","filter","glyph","contextMenu"],contextMenu:w(),createNode:function(e,t){var n;if("source"===(n=t.node).data.type)return $("span.fancytree-title",n.span).append("<div class=\"fancytree_node_icon_btns\">\n<i class='sync icon xsj_refresh_button fancytree_node_icon_btn' title='\u5237\u65b0'></i>\n<i class='window restore icon xsj_open_as_new_popup_button fancytree_node_icon_btn' title='\u5728\u65b0\u7684\u6d6e\u52a8\u7f16\u8f91\u5668\u6253\u5f00'></i>\n</div>")},filter:{mode:"hide"},wide:{levelOfs:"20px"},glyph:{map:{doc:"far fa-file",docOpen:"far fa-file",error:"fa fa-warning",expanderClosed:"fa fa-caret-right",expanderLazy:"fa fa-angle-right",expanderOpen:"fa fa-caret-down",folder:"far fa-folder",folderOpen:"far fa-folder-open",loading:"fa fa-spinner fa-pulse"}},source:[{key:c.id,title:"\u6211\u5f15\u7528\u4e86\u8c01\uff1a"+c.get("title"),extraClasses:"fancytree-current",folder:!0,lazy:!0,data:{id:c.id,doc:c.attributes,type:"source"}}],lazyLoad:function(e,t){var n,i,r;return"source"===(r=(i=t.node).data.type)?(n=$.Deferred(),p.getDirectDocs(i.data.id,null,(function(e,t){if(!e)return n.resolve(t.map((function(e){return{key:i.key+">"+e.id,title:e.doc.title,folder:!0,lazy:!0,data:{type:"target",id:e.id,doc:e.doc}}})));n.reject(e)})),t.result=n.promise()):"target"===r?(n=$.Deferred(),setTimeout((function(){return n.resolve(v(i.parent,i))}),1),t.result=n.promise()):void 0},click:function(e,t){var n,i,o;return o=t.node,(n=$(e.originalEvent.target)).hasClass("xsj_refresh_button")?(e.preventDefault(),e.stopPropagation(),o.resetLazy(),void o.setExpanded()):n.hasClass("xsj_open_as_new_popup_button")?(e.preventDefault(),e.stopPropagation(),void((i=o.children.reverse().filter((function(e){var t;return!!(null!=(t=e.data)?t.doc:void 0)})).map((function(e){return new a(e.data.doc)}))).length>0?$(window).trigger("createNewEditor",[i]):u.showMessage("\u6ca1\u6709\u53ef\u4ee5\u6253\u5f00\u7684\u6587\u4ef6",1e3,"warning"))):"link"===o.data.type?y(e,D,o,r):void 0}},(e=this.$el.find(".task_tree.direct_link_tree")).fancytree(t),e.find(">ul.fancytree-container").css("height","100%"),(n=(i=e.fancytree("getTree")).getNodeByKey(c.id)).setExpanded(!0),n.makeVisible()},C.prototype.initReverseTree=function(){var e,t,n;return t={autoCollapse:!1,clickFolderMode:2,scrollParent:this.$el.find(".reverse_link_tree"),extensions:["wide","filter","glyph","contextMenu"],contextMenu:w(),createNode:function(e,t){var n,i;if("source"===(i=t.node).data.type)return(n=$("span.fancytree-title",i.span)).append("<div class=\"fancytree_node_icon_btns\">\n  <i class='sync icon xsj_refresh_button fancytree_node_icon_btn'></i>\n  <i class='window restore icon xsj_open_as_new_popup_button fancytree_node_icon_btn' title='\u5728\u65b0\u7684\u6d6e\u52a8\u7f16\u8f91\u5668\u6253\u5f00'></i>\n</div>"),n.append("")},filter:{mode:"hide"},wide:{levelOfs:"20px"},glyph:{map:{doc:"far fa-file",docOpen:"far fa-file",error:"fa fa-warning",expanderClosed:"fa fa-caret-right",expanderLazy:"fa fa-angle-right",expanderOpen:"fa fa-caret-down",folder:"far fa-folder",folderOpen:"far fa-folder-open",loading:"fa fa-spinner fa-pulse"}},source:[{key:c.id,title:"\u8c01\u5f15\u7528\u4e86\u6211\uff1a"+c.get("title"),extraClasses:"fancytree-current",folder:!0,lazy:!0,data:{id:c.id,doc:c.attributes,type:"source"}}],lazyLoad:function(e,t){var n,i,r,a,s;return s=(r=t.node).data.type,a=r.data.doc,"source"===s?(i=$.Deferred(),n=o.pouchDB,d.getReverseLinkView(n,(function(e,t){var o,s,l,c;return e?i.reject(e):(c=t.viewName,s=[],l=[a._id],a.title&&l.push(a.title),a.slug&&l.push(a.slug),l.forEach((function(e){return e=e.replace(/^\/+|\/+$/g,""),s.push(e),s.push("/"+e),s.push(e+"/"),s.push("/"+e+"/")})),o={keys:s,reduce:!1,group:!1},n.query(c+"/by_reverse_link",o).then((function(e){var t;if(!((t=_.uniq(e.rows.map((function(e){return e.id}))).filter((function(e){return e!==r.data.id}))).length<=0))return n.allDocs({include_docs:!0,keys:t}).then((function(e){var t;return t=[],e.rows.map((function(e){var n;return n=e.doc,t.push({key:r.key+"<"+e.id,title:n.title,folder:!0,lazy:!0,data:{type:"target",id:e.id,doc:e.doc}})})),i.resolve(t)})).catch((function(e){return i.reject(e)}));i.resolve([])})))})),t.result=i.promise()):"target"===s?(i=$.Deferred(),setTimeout((function(){return i.resolve(v(r,r.parent))}),1),t.result=i.promise()):void 0},click:function(e,t){var n,i,o;return o=t.node,(n=$(e.originalEvent.target)).hasClass("xsj_refresh_button")?(e.preventDefault(),e.stopPropagation(),o.resetLazy(),void o.setExpanded()):n.hasClass("xsj_open_as_new_popup_button")?(e.preventDefault(),e.stopPropagation(),void((i=o.children.reverse().filter((function(e){var t;return!!(null!=(t=e.data)?t.doc:void 0)})).map((function(e){return new a(e.data.doc)}))).length>0?$(window).trigger("createNewEditor",[i]):u.showMessage("\u6ca1\u6709\u53ef\u4ee5\u6253\u5f00\u7684\u6587\u4ef6",1e3,"warning"))):"link"===o.data.type?h(e,D,o,r):void 0}},(e=this.$el.find(".task_tree.reverse_link_tree")).fancytree(t),e.find(">ul.fancytree-container").css("height","100%"),(n=(k=e.fancytree("getTree")).getNodeByKey(c.id)).setExpanded(!0),n.makeVisible()},n=function(e){if(e)return e.preventDefault(),e.stopPropagation()},C.prototype.destroyTree=function(){return this.$el.find(".task_tree").fancytree("destroy")},C.prototype.remove=function(){return c.off("change:title",D.fileModelTitleChanged),$(window).off("fileModelChanged",m),r.off("change",this.refresh),null,g=null,r=null,c=null,"reverse",c=null,D=null,C.__super__.remove.apply(this,arguments)},C.prototype.close=function(){return g.remove()},C}(Backbone.View),n.exports=c}}),window.requirejs.define({"views/list_tags_view":function(e,t,n){var i,r,o,a,s,l,c,u,d,p={}.hasOwnProperty;a=t("./view"),t("../constant"),r=t("../lib/notifier"),d=t("./templates/list_tags"),o=t("./store_files_list_view"),l=function(e,t,n,i){var r,o;return e.folder&&!t.folder?-1:!e.folder&&t.folder?1:(r=i(e),o=i(t),e.folder&&t.folder||!e.folder&&!t.folder?r===o?0:"asc"===n?r>o?1:-1:r>o?-1:1:void 0)},c=function(e,t){return l(e,t,"asc",(function(e){return e.title}))},u=function(e){var t,n;return n=[],t={},e.forEach((function(e){var n;return n={title:e.name,count:e.count,key:e.guid,folder:!1,obj:e},t[e.guid]=n})),e.forEach((function(e){var i,r,o;return r=t[e.guid],e.parentGuid&&(o=t[e.parentGuid])?(o.folder=!0,o.expanded=!0,(i=o.children)||(o.children=[],i=o.children),i.push(r)):n.push(r)})),n},s=function(e){return(e+"").replace(/([.?*+\^\$\[\]\\(){}|-])/g,"\\$1")},i=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)p.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.className="search_store_files_container",t.prototype.template=d,t.prototype.initialize=function(e){return this.plugin=e.plugin,this.model=e.model,this.allTags=[],this._instanstFilterTags=_.throttle((t=this,function(e){var n,i;return n=$(e.currentTarget),i=$.trim(n.val()),t.filterTags(i)}),500);var t},t.prototype.events={"click .return_home_button":"returnHome","click .search_store_button":"searchStore","click .list_tags_home .selected_tags .selected_tag .unselected_tag_button":"unSelectedTagFn","click .clear_filter_input_button":"clearFilterInputFn","click .list_tags_filter_button":"filterTagsFn","click .refresh_list_tags_button":"refreshListTagsFn","click .open_filter_input_button":"openFilterInputFn","keydown .list_tags_home .list_tags_filter_input":"instanstFilterTags","change .list_tags_home .list_tags_filter_input":"instanstFilterTags","paste .list_tags_home .list_tags_filter_input":"instanstFilterTags"},t.prototype.refreshListTagsFn=function(e){return this.refreshListTags()},t.prototype.openFilterInputFn=function(e){return this.$home.find(".list_tags_filter_container").addClass("filter_input_status")},t.prototype.updateStoreSearchButtonStatus=function(){var e;return e=this.$home.find(".search_store_button"),this.$home.find(".selected_tags>.selected_tag").length>0?e.removeClass("disabled"):e.addClass("disabled")},t.prototype.filterTagsFn=function(e){var t,n;return t=$(e.currentTarget).parent().find(".list_tags_filter_input"),n=$.trim(t.val()),this.filterTags(n)},t.prototype.clearFilterInputFn=function(e){return $(e.currentTarget).parent().find(".list_tags_filter_input").val(""),this.filterTags(""),this.$home.find(".list_tags_filter_container").removeClass("filter_input_status")},t.prototype.filterTags=function(e){var t,n;return n=this.$home.find(".list_tags_container").fancytree("getTree"),e?(e=e.replace(/[ ]+/g," "),(t=e.split(" ")).length>1?n.filterNodes((function(e){var n;return n=[],t.forEach((function(e){return e=".*"+s(e)+".*",n.push(e)})),!!new RegExp(n.join("|"),"i").exec(e.title)}),!0):n.filterNodes(t[0],!0)):n.clearFilter()},t.prototype.instanstFilterTags=function(e){return this._instanstFilterTags(e)},t.prototype.unSelectedTagFn=function(e){var t,n;return n=(t=$(e.currentTarget).parent()).data("key"),this.$home.find(".list_tags_container").fancytree("getTree").getNodeByKey(n).setSelected(!1),t.remove(),this.updateStoreSearchButtonStatus()},t.prototype.afterAttached=function(){var e,t,n,i,r;return e=this.$home.find(".list_tags_container"),t=this.$home.find(".selected_tags"),n=this,i={clickFolderMode:1,extensions:["wide","filter","glyph","xsjcounter","xsjtagbtn"],source:this.initSource(),autoCollapse:!1,checkbox:!0,filter:{mode:"hide"},click:function(e,i){var r,o,a,s,l,c,u;return l=i.node,i.tree,"-1"!==(a=l.data.obj).guid&&(o=$(i.originalEvent.target),"title"===i.targetType&&o.hasClass("xsj_tag_button")&&(u=o.data("guid"))?(c='<div class="ui mini tag label">'+_.escape(a.name)+"</div>",n.$list.find(".search_by_tags .selected_tags").html(c),n.$home.hide(),n.$list.show(),void n.storeFilesListView.search({tags:[u]},null,null,{flatTagsObj:_.indexBy(n.allTags,"guid")},(function(){}))):(s=!l.isSelected(),"checkbox"!==i.targetType&&l.setSelected(s),r=t.find(".selected_tag[data-key="+l.key+"]"),s?0===r.length&&(r=$('<div class="selected_tag" data-key="'+_.escape(l.key)+'"><i class="times circle outline icon link unselected_tag_button"></i>'+_.escape(l.title)+"</div>"),t.append(r)):r.remove(),n.updateStoreSearchButtonStatus()))},loadChildren:function(e,t,n){return t.node.sortChildren(c,!0)},loadError:function(e,t){var n;return(n=t.error).status&&n.statusText?(t.message="Ajax error: "+t.message,t.details="Ajax error: "+n.statusText+", status code = "+n.status):(t.message=JSON.stringify(n),t.details=JSON.stringify(n))},lazyLoad:(r=this,function(e,t){var n;return n=$.Deferred(),r.plugin.listTags({},{},(function(e,t){var i;return e?n.reject(e):t.length>0?(i=u(t),r.allTags=t,n.resolve(i)):n.reject("\u60a8\u8fd8\u6ca1\u6709\u521b\u5efa\u4efb\u4f55\u6807\u7b7e")})),t.result=n.promise()}),glyph:{map:{doc:"fas fa-tag",docOpen:"fas fa-tag",checkbox:"far fa-square",checkboxSelected:"far fa-check-square",checkboxUnknown:"fa fa-square",error:"fa fa-warning",expanderClosed:"fa fa-caret-right",expanderLazy:"fa fa-angle-right",expanderOpen:"fa fa-caret-down",folder:"fas fa-tags",folderOpen:"fas fa-tags",loading:"fa fa-spinner fa-pulse"}}},e.fancytree(i),this.refreshListTags()},t.prototype.afterRender=function(){return this.$home=this.$el.find(".list_tags_home"),this.storeFilesListView=new o({plugin:this.plugin,model:this.model}),this.$list=this.$el.find(".search_store_files_list"),this.$list.append(this.storeFilesListView.render().$el)},t.prototype.refreshListTags=function(){var e,t,n;return this.$home.find(".selected_tags>.selected_tag").remove(),this.updateStoreSearchButtonStatus(),(e=this.$home.find(".list_tags_container")).fancytree("option","source",this.initSource()),n=e.fancytree("getRootNode"),(t=n.getFirstChild()).load(!0).then((function(){return t.setExpanded(!0)}))},t.prototype.initSource=function(){var e;return[{title:("function"==typeof(e=this.plugin).getDisplayName?e.getDisplayName():void 0)||"\u6839\u76ee\u5f55",key:"-1",folder:!0,children:[],checkbox:!1,hideCheckbox:!0,iconclass:"fas fa-user-tag",lazy:!0,obj:{guid:"-1",parentPath:null}}]},t.prototype.searchStore=function(e){var t,n,i,o,a;return t=$(e.currentTarget),(n=this.$home.find(".list_tags_container").fancytree("getTree").getSelectedNodes()).length>0?(o=[],i=[],n.forEach((function(e){var t;return t=e.data.obj,o.push(t.guid),i.push('<div class="ui mini tag label">'+_.escape(t.name)+"</div>")})),t.addClass("loading"),this.storeFilesListView.search({tags:o},null,null,{flatTagsObj:_.indexBy(this.allTags,"guid")},(a=this,function(){return a.$list.find(".search_by_tags .selected_tags").html(i.join("")),t.removeClass("loading"),a.$home.hide(),a.$list.show()}))):r.showMessage("\u8bf7\u81f3\u5c11\u9009\u62e9\u4e00\u4e2a\u6807\u7b7e",6e3,"error")},t.prototype.returnHome=function(){return this.$home.show(),this.$list.hide()},t.prototype.destroy=function(){return this.$home.find(".list_tags_container").fancytree("destroy"),this.storeFilesListView.destroy(),this.remove()},t.prototype.show=function(){return this.$el.show()},t.prototype.hide=function(){return this.$el.hide()},t}(a),n.exports=i}}),window.requirejs.define({"views/main_button_view":function(e,t,n){var i,r,o,a=function(e,t){return function(){return e.apply(t,arguments)}},s={}.hasOwnProperty;i=t("../application"),r=t("../lib/config_sync"),o=function(e){function t(){return this.jiggleLogo=a(this.jiggleLogo,this),this.toggleSideBar=a(this.toggleSideBar,this),t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)s.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,Backbone.View),t.prototype.tagName="a",t.prototype.className="item main_button",t.prototype.mainToolbarView=null,t.prototype.events={click:"toggleSideBar",mouseenter:"jiggleLogo"},t.prototype.initialize=function(e){return this.mainToolbarView=e.mainToolbarView},t.prototype.renderAvatar=function(e){var t,n,r,o,a,s,l,c,u,d,p,f;if(n=this,this._prevObjectUrl&&(window.URL.revokeObjectURL(this._prevObjectUrl),this._prevObjectUrl=null),this.$el.removeClass("main_have_avatar_button"),this.$el.find(">style").remove(),this.$el.find(".main_avatar_button").remove(),this.$el.after(this.mainToolbarView.mainFunctionButtonsView),e)return f=e._attachments.origin,l=e._attachments.font,(u=e.font)&&l?(n.$el.addClass("main_have_avatar_button"),d=window.URL.createObjectURL(l.data),n._prevObjectUrl=d,s='@font-face {\n  font-family: "mainAvatarFontname";\n  src: url('+d+')  format("truetype");\n  font-style: normal;\n  font-weight: normal;\n}\n:root{\n  --avatarFontText: \''+_.escape(u)+"'\n}",c="",e.className&&(c=" "+e.className),this.$el.prepend("<style>"+s+"</style>"),t=$('<div class="main_avatar_button has_font'+_.escape(c)+'"><span class="main_avatar_button_font"></span></div>'),this.$el.append(t),setTimeout((function(){if(i.clientTitleBarView)return i.clientTitleBarView.$el.find(".client_main_toolbar").prepend(n.mainToolbarView.mainFunctionButtonsView.$el)}),1e3)):(r=e._attachments[100],"image/svg+xml"===f.content_type&&(r=f),o=r.data,a=window.URL.createObjectURL(o),n._prevObjectUrl=a,(p=document.createElement("img")).classList.add("main_avatar_button_image"),p.src=a,p.onload=function(){var e;if((e=document.createElement("div")).classList.add("main_avatar_button"),e.append(p),n.el.append(e),n.$el.addClass("main_have_avatar_button"),i.clientTitleBarView)return i.clientTitleBarView.$el.find(".client_main_toolbar").prepend(n.mainToolbarView.mainFunctionButtonsView.$el)})},t.prototype.initAvatar=function(){var e;return e=this,r.getAvatar({attachments:!0,binary:!0},(function(t,n){return e.renderAvatar(n)}))},t.prototype.render=function(){return this.$el.html('<span class="main_button_intro">\n  <i class="xiaoshujiang circle alternate outline icon"></i>\n  <span class="main_button_logo_title visible-md-inline-block visible-lg-inline-block"><span class="xsj_logo xsj_logo_x">\u5c0f</span><span class="xsj_logo xsj_logo_s">\u4e66</span><span class="xsj_logo xsj_logo_j">\u5320</span></span>\n</span>')},t.prototype.afterAttach=function(){var e;return e=this,this.initAvatar(),$(window).on("refreshAvatar",(function(){return e.initAvatar()}))},t.prototype.toggleSideBar=function(){return i.sidebarView.$el.sidebar("toggle")},t.prototype.jiggleLogo=function(e){var t,n;if(!this.$el.hasClass("main_have_avatar_button"))return t=this.$el.find(".xsj_logo"),window.chrome&&(n=t.transition("is animating"),$.isArray(n)||(n=[n]),!function(e){var t,n;for(t=0,n=e.length;t<n;t++)if(e[t])return!0;return!1}(n))?t.transition({animation:"jiggle",displayType:"inline-block",duration:800,interval:200}):void 0},t}(),n.exports=o}}),window.requirejs.define({"views/main_function_buttons_view":function(e,t,n){var i,r,o,a,s,l,c=function(e,t){return function(){return e.apply(t,arguments)}},u={}.hasOwnProperty;a=t("./view"),t("../application"),t("../constant"),t("../lib/utils"),i=t("../lib/config_sync"),t("./templates_select_dialog_view"),o=t("./tmpl_manager/tmpl_dropdown_view"),l=t("./templates/main_function_buttons"),s={type:"template",sort:{$lt:[]},score:{$lt:[]},updateDate:{$lt:[]}},r=function(e){var t;function n(){return this.saveFile=c(this.saveFile,this),n.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)u.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(n,e),n.prototype.template=l,n.prototype.className="fitted item base_group_container main_function_buttons",n.prototype.mainToolbarView=null,t=!1,n.prototype.initialize=function(e){return this.mainToolbarView=e.mainToolbarView},n.prototype.events={"click .new_file":"newFile","click .save_file":"saveFile","click .save_as_file":"saveAsFile","click .lock_file_horizontal_tabs_btn":"lockFileHorizontalTabsFn"},n.prototype.lockFileHorizontalTabsFn=function(e){var n,i;return i=this,n=$(e.currentTarget),(t=!t)||(this.mainToolbarView.$el.hasClass("disable_file_horizontal_transition")||this.mainToolbarView.$el.addClass("disable_file_horizontal_transition"),this.lockFileHorizontalTabsFn.timeout&&clearTimeout(this.lockFileHorizontalTabsFn.timeout),this.lockFileHorizontalTabsFn.timeout=setTimeout((function(){return clearTimeout(i.lockFileHorizontalTabsFn.timeout),i.lockFileHorizontalTabsFn.timeout=null,i.$el.removeClass("disable_file_horizontal_transition")}),2e3)),$("body").toggleClass("lock_file_horizontal_tabs",t),n.find("i.icon").toggleClass("outline",t),localStorage.setItem("lock_file_horizontal_tabs",t?"1":"0"),this.mainToolbarView.toggleLockFileHorizontalTabs(t)},n.prototype.newFile=function(){return $(window).trigger("newFileModel")},n.prototype.saveFile=function(){return $(window).trigger("saveFileModel")},n.prototype.saveAsFile=function(){return $(window).trigger("saveAsFileModel")},n.prototype.afterAttach=function(){var e;(t=null==(t=localStorage.getItem("lock_file_horizontal_tabs"))?"client"===STORY_PLATFORM:"1"===t)&&$("body").addClass("lock_file_horizontal_tabs"),this.mainToolbarView.toggleLockFileHorizontalTabs(t),e=this.$el.find(".new_file"),setTimeout((function(){return i.getTemplates(s,10,!1,(function(e,t){return t.docs}))}),1e3),new o({el:e[0]}).initTmplBtns()},n}(a),n.exports=r}}),window.requirejs.define({"views/main_toolbar_view":function(e,t,n){var i,r,o,a,s,l,c,u,d,p,f=function(e,t){return function(){return e.apply(t,arguments)}},h={}.hasOwnProperty;d=t("./view"),p=t("./templates/main_toolbar"),i=t("../application"),r=t("../constant"),u=t("../lib/utils"),a=t("./file_tabs_view"),o=t("./file_horizontal_tabs_view"),s=t("./main_button_view"),l=t("./main_function_buttons_view"),c=function(e){function t(){return this.changeFileModel=f(this.changeFileModel,this),this.permalink=f(this.permalink,this),this.titleButtonBlur=f(this.titleButtonBlur,this),this.titleButtonClick=f(this.titleButtonClick,this),this.titleButtonKeyPress=f(this.titleButtonKeyPress,this),this.fileListSlideToggleButton=f(this.fileListSlideToggleButton,this),this.previewSlideToggleButton=f(this.previewSlideToggleButton,this),t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)h.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.template=p,t.prototype.className="ui-layout-north main_toolbar_container",t.prototype.mainButtonView=null,t.prototype.mainFunctionButtonsView=null,t.prototype.events={"click .title_button":"titleButtonClick","click .file_horizontal_tabs_wrapper":"clickTitleMenuFn","keypress .title_button":"titleButtonKeyPress","blur .title_button":"titleButtonBlur","paste .title_button":"titleButtonPaste","click .preview_slide_toggle_button":"previewSlideToggleButton","click .file_list_slide_toggle_button":"fileListSlideToggleButton","click .permalink_button":"permalink"},t.prototype.clickTitleMenuFn=function(){return i.homeView.editorView.focus()},t.prototype.bindEvent=function(){var e;return e=this.$el.find(".preview_slide_toggle_button"),$(window).on("previewSlideStateChanged",(function(t,n){return n?e.addClass("active xsj_actived"):e.removeClass("active xsj_actived")}))},t.prototype.afterAttach=function(){var e;return(e=new o({})).render(),this.$el.find(".title_menu").prepend(e.$el),e.show(),this.model&&e.setActiveFileModel(this.model),this.mainButtonView.afterAttach()},t.prototype.afterRender=function(){var e,t;return this.$el.find(".layout_dropdown").dropdown({onHide:function(e){return!$(this).hasClass("xsj_actived")}}),(t=new a).render(),this.$el.append(t.$el),this.bindEvent(),this.mainButtonView=new s({mainToolbarView:this}),this.mainFunctionButtonsView=new l({mainToolbarView:this}),this.mainButtonView.render(),this.mainFunctionButtonsView.render(),i.clientTitleBarView,(e=this.$el.find(".main_toolbar")).prepend(this.mainFunctionButtonsView.$el),e.prepend(this.mainButtonView.$el),this.mainFunctionButtonsView.afterAttach()},t.prototype.toggleLockFileHorizontalTabs=function(e){},t.prototype.previewSlideToggleButton=function(){return $(window).trigger("previewSlideToggle")},t.prototype.fileListSlideToggleButton=function(){return $(window).trigger("fileListSlideToggle")},t.prototype.titleButtonKeyPress=function(e){if(13===e.keyCode)return this.titleButtonBlur()},t.prototype.titleButtonClick=function(e){var t,n,i,r,o,a,s;if(s=e.toElement||e.originalEvent.target,o=(r=this.$el.find(".title_button")).find(".title_content"),i=r.find(".tags_content"),t=r.find(".category_content"),n=r.find(".flag_content"),!(a=this.$el.find(".title_menu")).hasClass("title_menu_editable"))return a.addClass("title_menu_editable"),o.attr("contenteditable",!0),i.attr("contenteditable",!0),t.attr("contenteditable",!0),n.attr("contenteditable",!0),r.text()||"",s!==i[0]&&s!==t[0]&&s!==n[0]&&(s=o[0]),function(){var e,t,n;return e=s,t=document.createRange(),n=window.getSelection(),t.selectNode(e.childNodes[0]),n.removeAllRanges(),n.addRange(t)}()},t.prototype.titleButtonPaste=function(e){var t;if(e.originalEvent)return(e=e.originalEvent).preventDefault(),t=$.trim(e.clipboardData.getData("text/plain")).replace(/\n+/g," "),document.execCommand("insertHTML",!1,t)},t.prototype.titleButtonBlur=function(e){var t,n,r,o,a,s,l,c,d,p,f,h;if(a=(o=this.$el.find(".title_button")).find(".title_content"),r=o.find(".tags_content"),t=o.find(".category_content"),n=o.find(".flag_content"),!e||e.relatedTarget!==a[0]&&e.relatedTarget!==r[0]&&e.relatedTarget!==t[0]&&e.relatedTarget!==n[0])return this.$el.find(".title_menu").removeClass("title_menu_editable"),a.attr("contenteditable",!1),r.attr("contenteditable",!1),t.attr("contenteditable",!1),n.attr("contenteditable",!1),h=(h=a.text()||"\u672a\u547d\u540d\u6587\u4ef6").trim(),l=this.model.get("content"),this.model.set("title",h),d=u.setMetaData(l,"title",h,!0),f=(p=r.text()||"")?p.split(","):[],this.model.set("tagNames",f),d=u.setMetaData(d,"tags",p,!0),s=(s=t.text()||"").trim(),this.model.set("category",s),d=u.setMetaData(d,"category",s,!0),c=(c=n.text()||"").trim(),this.model.set("flag",c),l!==(d=u.setMetaData(d,"flag",c,!0))&&(i.homeView.editorView.setValueAndNotTriggerEvent(d),this.model.set("content",d)),this.model.save()},t.prototype.permalink=function(){var e;return e=r.host+"#md64="+window.btoa(JSON.stringify({title:unescape(encodeURIComponent(this.model.get("title"))),content:unescape(encodeURIComponent(this.model.get("content")))})),$('<div class="ui modal">\n  <i class="close icon"></i>\n  <div class="header">permalink\u8fde\u63a5</div>\n  <div class="content">\n    <div class="description">\n      <div class="ui fluid icon input">\n        <input type="text" value="'+e+'">\n        <i class="linkify icon"></i>\n      </div>\n    </div>\n  </div>\n  <div class="actions">\n    <div class="ui positive right button">\n      \u5173\u95ed\n    </div>\n  </div>\n</div>').modal("show")},t.prototype.changeFileModel=function(e){var t,n,i,r,o,a;return this.stopListening(),this.model=e,r=this.$el.find(".title_button"),o=r.find(".title_content"),i=r.find(".tags_content"),t=r.find(".category_content"),n=r.find(".flag_content"),this.model?(r.show(),o.text(this.model.get("title")||"\u672a\u547d\u540d\u6587\u4ef6"),i.text(this.model.get("tagNames")||""),t.text(this.model.get("category")||""),n.text(this.model.get("flag")||""),this.listenTo(this.model,"change:title",(a=this,function(e){return(o=r.find(".title_content")).text(a.model.get("title")||"\u672a\u547d\u540d\u6587\u4ef6")})),this.listenTo(this.model,"change:tagNames",function(e){return function(t){return(i=r.find(".tags_content")).text(e.model.get("tagNames")||"")}}(this)),this.listenTo(this.model,"change:category",function(e){return function(n){return(t=r.find(".category_content")).text(e.model.get("category")||"")}}(this)),this.listenTo(this.model,"change:flag",function(e){return function(t){return(n=r.find(".flag_content")).text(e.model.get("flag")||"")}}(this))):r.hide()},t}(d),n.exports=c}}),window.requirejs.define({"views/mark_list_window_view":function(e,t,n){var i,r,o,a,s,l,c=function(e,t){for(var n in t)u.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e},u={}.hasOwnProperty;a=t("../lib/notifier"),s=t("../lib/utils"),t("../application"),i=t("./base_window_manager_view"),t("../constant"),l=function(e,t){return e.reduce((function(e,n){return(e[n[t]]=e[n[t]]||[]).push(n),e}),{})},r=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return c(t,e),t.prototype.local_storage_name="mark_list_window_manager",t}(i),o=function(e){var n,i,o,u,d,p,f,h,m,v,g;function w(){return w.__super__.constructor.apply(this,arguments)}return c(w,e),w.prototype.className="draggable_dialog_content_container",null,h=null,i=null,p="all",o=null,d={},g={},v=[],m=null,w.prototype.refresh=null,f=function(){var e;return(e=d[o.id])&&e.marks.length>0?" ("+e.marks.length+")":""},w.prototype.fileModelTitleChanged=function(e,t){return m.$el.find(".task_tree").fancytree("getRootNode").findFirst((function(t){return t.key===e.id})).setTitle(t+f())},u=function(e,t){var n,i,r;if(t){o&&o.off("change:title",m.fileModelTitleChanged),(o=t).on("change:title",m.fileModelTitleChanged),(r=m.$el.find(".task_tree").fancytree("getRootNode")).children.forEach((function(e){return e.extraClasses="",e.renderStatus()})),(i=r.findFirst((function(e){return e.key===o.id})))?(i.extraClasses="fancytree-current",i.renderStatus()):i=r.addNode({key:o.id,title:o.get("title")+f(),extraClasses:"fancytree-current",folder:!0,expanded:!0,children:[]}),m.refresh();try{return i.scrollIntoView()}catch(e){return n=e,console.log(n)}}},w.prototype.initialize=function(e){return m=this,o=e.fileModel,i=e.editorView,o.on("change:title",m.fileModelTitleChanged),this.refresh=_.debounce(n,300),$(window).on("fileModelChanged",u),i.on("change",this.refresh)},w.prototype.events={"click .mark_filter_button":"markFilterFn"},w.prototype.markFilterFn=function(e){var t;if(!(t=$(e.currentTarget)).hasClass("active"))return t.parent().find("i").removeClass("active"),t.addClass("active"),p=t.data("type"),m._markFilterFn()},w.prototype._markFilterFn=function(){var e;return e=m.$el.find(".task_tree").fancytree("getTree"),"all"===p?e.clearFilter():e.filterNodes((function(e){return!!e.folder||e.data.color===p}))},w.prototype.highlightNodeArea=function(e){var t,n;if(n=this.$el.find(".task_tree").fancytree("getRootNode"),(t=n.findFirst((function(t){return t.key===e.id})))&&t.li)return t.scrollIntoView(),t.li.classList.add("fancytree-highlight-area"),setTimeout((function(){return t.li.classList.remove("fancytree-highlight-area")}),1e3)},w.prototype.fixPosition=function(e){return h.$el.visible(!0)?h.$el.transition("shake"):h.fixPosition(e)},w.prototype.show=function(e){var n;return(h=new r({canMax:!1,canMin:!1,canShape:!1,position:{width:400,left:e.left,top:e.top}})).$el.addClass("draggable_dialog_task"),h.show(),this.render(),h.setTitle("\u9ad8\u4eae\u6e05\u5355"),h.$el.find(".header_logo>i").removeClass().addClass("lightbulb icon"),h.$el.find(".draggable_dialog_content_container_wrapper").append(this.$el),n=this,t("../lib/dynamic_import/import_fancytree")((function(){return n.initMarkTree(),h.on("beforeClose",(function(){return n.destroyTree()})),h.on("close",(function(){return n.trigger("close"),n.remove(),h=null}))}))},w.prototype.refreshColorList=function(){var e,t,n,i,r;for(i in e=[],d)r=d[i],e=e.concat(r.marks);return n=l(e,"color"),(t=Object.keys(n).sort((function(e,t){return n[e].length-n[t].length})).map((function(e){var t,n;return n=e,"default"===e&&(n="var(--positiveColor)"),t="square","#000000"===e&&(t="lightbulb outline"),'<i class="icon mark_filter_button '+t+' link large" title="'+e+'" data-type="'+e+'" style="color: '+n+';"></i>'}))).unshift('<i class="icon mark_filter_button lightbulb link large" title="\u5168\u90e8" data-type="all"></i>'),this.$el.find(".task_tree_buttons").html(t.join(""))},w.prototype.render=function(){var e;return h.showDimmer(),e=$('<div class="draggable_dialog_content" style="overflow:hidden; flex-basis: 0;position:initial;">\n  <div class="task_tree_container theme_tree_container">\n    <div class="task_tree_container_buttons">\n      <div class="task_tree_buttons">\n      </div>\n    </div>\n    <div class="task_tree"></div>\n  </div>\n</div>'),this.$el.html(e),h.hideDimmer()},w.prototype.initMarkTree=function(){var e,t,n,r,l;return t=i.getValue(),(l=s.getMarkInfo(t)).fileModel=o,d[o.id]=l,m.refreshColorList(),e=l.marks.map((function(e,t){return{key:o.id+"_"+e.id,title:e.content,data:{id:e.id,color:e.color}}})),r=function(e,t){var n;if(n=e[t])return{line:n.line,ch:n.ch}},n={autoCollapse:!1,clickFolderMode:2,extensions:["wide","filter","glyph","contextMenu","xsjcolor"],contextMenu:{menu:function(e){var t,n,i;return n={copyAll:{name:"\u590d\u5236\u5168\u90e8"},saveAll:{name:"\u5168\u90e8\u53e6\u5b58\u4e3a"}},e.isFolder()&&(t=(l=d[e.key]).fileModel,i=_.escape(t.get("title")),n.copy={name:"\u590d\u5236("+i+")"},n.save={name:"\u4fdd\u5b58("+i+")"}),Object.keys(g).length>0&&(n.copySelected={name:"\u590d\u5236\u9009\u4e2d\u7684\u8282\u70b9"},n.saveSelected={name:"\u4fdd\u5b58\u9009\u4e2d\u7684\u8282\u70b9"}),n},actions:function(e,t,n){var i,r,s,c,u,f,h,v,_;switch(h="",s=function(e){return null==e&&(e=[]),e.filter((function(e){return"all"===p||e.color===p}))},t){case"copySelected":case"saveSelected":case"copyAll":case"saveAll":for(u in v=[],d)l=d[u],_=(o=l.fileModel).get("title"),c=s(l.marks),"copySelected"!==t&&"saveSelected"!==t||(c=c.filter((function(e){return!!g[o.id+"_"+e.id]}))),f=c.map((function(e,t){return"- "+e.content})),"copySelected"===t||"saveSelected"===t?v.push(f.join("\n")):(v.push("# "+_),v.push(""),v.push(f.join("\n")),v.push(""),v.push(""));h=v.join("\n");break;case"copy":case"save":f=s((l=d[e.key]).marks).map((function(e,t){return"- "+e.content})),h=f.join("\n")}switch(h=$.trim(h),t){case"copy":case"copyAll":case"copySelected":$(document).one("copy",(function(e){return e.preventDefault(),e.stopPropagation(),e.originalEvent.clipboardData.setData("text/plain",h),a.showMessage("\u590d\u5236\u6e05\u5355\u6210\u529f")})),document.execCommand("copy");break;case"save":case"saveAll":case"saveSelected":r=moment().format("YYYY-MM-DD")+"_\u9ad8\u4eae\u6e05\u5355.txt",i=new Blob([h],{type:"text/plain;charset=utf-8"}),saveAs(i,r)}return g={},m.$el.find(".fancytree-user-selected-node").removeClass("fancytree-user-selected-node")}},filter:{mode:"hide"},wide:{levelOfs:"2px"},glyph:{map:{error:"fa fa-warning",expanderClosed:"fa fa-caret-right",expanderLazy:"fa fa-angle-right",expanderOpen:"fa fa-caret-down",folder:"far fa-folder",folderOpen:"far fa-folder-open"}},source:[{key:o.id,title:o.get("title")+f(),extraClasses:"fancytree-current",folder:!0,expanded:!0,children:e}],click:function(e,t){var n,a,s,l,c,u,p;return l=t.node,e.ctrlKey&&!l.folder&&(a=l.key,g[a]?(delete g[a],l.span.querySelector(".fancytree-title").classList.remove("fancytree-user-selected-node")):(g[a]=!0,l.span.querySelector(".fancytree-title").classList.add("fancytree-user-selected-node"))),!e.ctrlKey&&(g={},m.$el.find(".fancytree-user-selected-node").removeClass("fancytree-user-selected-node"),u=null,p=function(){var t;if(l&&l.key&&v.indexOf(l.key)<0&&v.push(l.key),e.toElement||e.originalEvent.target,null!==u&&(i.gotoLine(u.line,u.ch),t=i.editorProxy.editor))return t.highlightPos({line:u.line,ch:u.ch})},n=function(e){return setTimeout((function(){return p()}),1)},l.folder?(a=l.key)!==o.id?(s=d[a].fileModel,$(window).trigger("changeFileModel",[s,{callback:n}])):void 0:(c=l.parent,u=r(d[c.key].idMarkMaps,l.data.id),c.key!==o.id?(s=d[c.key].fileModel,$(window).trigger("changeFileModel",[s,{callback:n,scrollTo:!1}])):p()))}},this.$el.find(".task_tree").fancytree(n),this.$el.find(".task_tree >ul.fancytree-container").css("height","100%")},n=function(e){var t,n,r,a,l,c,u,p,h;for(e&&(e.preventDefault(),e.stopPropagation()),g={},m.$el.find(".fancytree-user-selected-node").removeClass("fancytree-user-selected-node"),t=i.getValue(),(u=s.getMarkInfo(t)).fileModel=o,p=d[o.id],h=m.$el.find(".task_tree").fancytree("getRootNode"),(a=h.findFirst((function(e){return e.key===o.id})))||(a=h.addNode({key:o.id,title:o.get("title")+f(),extraClasses:"fancytree-current",folder:!0,expanded:!0,children:[]})),a.setExpanded(!0),l=0,c=null,p&&p.marks.forEach((function(e){var t,n;return t=u.marks[l],(n=a.findFirst((function(t){return t.key===o.id+"_"+e.id})))&&(t?(t.color!==e.color&&(c=n,n.data.color=t.color,n.setTitle(t.content)),t.content!==e.content&&(c=n,n.setTitle(t.content))):n.remove()),l++}));l<u.marks.length;)n=u.marks[l],c=a.addNode({key:o.id+"_"+n.id,title:n.content,data:{id:n.id,color:n.color}}),l++;if(m._markFilterFn(),c){c.setActive(!0);try{c.scrollIntoView()}catch(e){r=e,console.log(r)}}return d[o.id]=u,m.refreshColorList(),a.setTitle(o.get("title")+f())},w.prototype.destroyTree=function(){return this.$el.find(".task_tree").fancytree("destroy")},w.prototype.remove=function(){return o.off("change:title",m.fileModelTitleChanged),$(window).off("fileModelChanged",u),i.off("change",this.refresh),null,h=null,i=null,o=null,p="all",o=null,d={},m=null,w.__super__.remove.apply(this,arguments)},w.prototype.close=function(){return h.remove()},w}(Backbone.View),n.exports=o}}),window.requirejs.define({"views/miniweb/index_view":function(e,t,n){var i,r,o,a,s,l,c={}.hasOwnProperty;a=t("../view"),l=t("./templates/index"),r=t("../../lib/miniweb_server"),o=t("../../lib/notifier"),s=function(e,t){var n,i,r,o,a;return(n=(i=e.$el).find(".miniweb_server_control_btns")).empty(),r=i.find(".miniweb_server_info"),t?(o="http://localhost:"+t.web.port,n.append('<div class="ui button stop_miniweb_server_btn">\u505c\u6b62\u670d\u52a1</div>'),a="",t.password&&(a+="\u7528\u6237\u540d: "+t.username+"<br/>\u5bc6\u7801:"+t.password.replace(/./g,"*")+"<br/>"),r.html("\u5c0f\u4e66\u5320\u73b2\u73d1\u7248\u8bbf\u95ee\u5730\u5740\uff1a "+o+' <a href="'+o+'"><i class="icon chrome"></i></a> <br/>\n\u6570\u636e\u5e93\u670d\u52a1\u5730\u5740: '+o+"/data/user_"+t.user.id+" <br/>\n"+a+"\n\u6ce8: \u5982\u679c\u4e0d\u662f\u672c\u673a\u8bbf\u95ee\uff0c\u8bf7\u5c06 <strong>localhost</strong> \u6362\u6210\u771f\u5b9e\u7684\u53ef\u4ee5\u8bbf\u95ee\u7684 ip \u5730\u5740")):(r.html("\u60a8\u8fd8\u672a\u542f\u52a8\u670d\u52a1"),n.append('<div class="ui button start_miniweb_server_btn">\u542f\u52a8\u670d\u52a1</div>\n<div class="ui button destroy_miniweb_server_btn">\u91cd\u7f6e\u670d\u52a1</div>'))},i=function(e){var t;function n(){return n.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)c.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(n,e),n.prototype.template=l,t=!1,n.prototype.getRenderData=function(){return{}},n.prototype.className="ui small modal story_modal miniweb_server_manager_container",n.prototype.events={"click .start_miniweb_server_btn":"startServerFn","click .stop_miniweb_server_btn":"stopServerFn","click .destroy_miniweb_server_btn":"destroyServerFn"},n.prototype.startServerFn=function(e){var n,i,a,l,c;if(i=this,n=$(e.currentTarget),!t)return t=!0,n.addClass("loading"),c=i.$el.find("input[name=webPort]").val(),l=i.$el.find('input[name="username"]').val(),a=i.$el.find('input[name="password"]').val(),l=$.trim(l),a=$.trim(a),c=parseInt(c,10)||0,r.startServer({webPort:c,username:l,password:a},(function(e,n){var r;return r=i.$el.find(".ui.form").serializeObject(),localStorage.miniweb_server_config_data=JSON.stringify(r),e&&o.showMessage("\u542f\u52a8\u5931\u8d25: "+e,6e3,"error"),t=!1,s(i,n)}))},n.prototype.stopServerFn=function(e){var n,i;if(i=this,n=$(e.currentTarget),!t)return t=!0,n.addClass("loading"),r.stopServer((function(){return t=!1,s(i,null)}))},n.prototype.destroyServerFn=function(e){var n,i;if(i=this,n=$(e.currentTarget),!t)return t=!0,n.addClass("loading"),r.destroyServer((function(){return o.showMessage("\u91cd\u7f6e\u5b8c\u6210 ",6e3,"info"),t=!1,s(i,null)}))},n.prototype.show=function(){var e,t,n,i;return i=this,this.render(),e=this.$el.find(".ui.form"),(n=localStorage.miniweb_server_config_data)&&(t=JSON.parse(n)),t||(t={}),$.isNumeric(t.webPort)||(t.webPort=3600),(t.webPort>65500||t.webPort<0)&&(t.webPort=3600),e.deserialize(t),this.$el.modal({closable:!1,onVisible:function(){return $("body").dimmer({closable:!1,useCSS:!0}),s(i,r.getServer())},onHidden:function(){return i.$el.modal("destroy"),i.remove(),i=null}}),i.$el.modal("show")},n}(a),n.exports=i}}),window.requirejs.define({"views/miniweb/templates/index":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<i class="close icon"></i>\n<div class="header" >\n\u73cd\u73d1\u7f51\u683c\u670d\u52a1\u5668\u7ba1\u7406\u9875\u9762\n</div>\n<div class="content story_content miniweb_server_instance">\n<div class="ui buttons miniweb_server_control_btns">\n</div>\n<div class="ui divider"></div>\n<details class="miniweb_server_instance_config">\n<summary><i class="cogs icon"></i>\u914d\u7f6e</summary>\n<form class="ui form">\n<div class="field">\n<label for="webPort">\n\u7aef\u53e3\u53f7\uff08\u4e3a0\u65f6\uff0c\u7cfb\u7edf\u81ea\u52a8\u5206\u914d\uff09\n</label>\n<input type="number" min="0" max="65535" name="webPort" placeholder="\u7aef\u53e3\u53f7\uff0c\u9ed8\u8ba4\u4e3a0,\u7cfb\u7edf\u81ea\u52a8\u5206\u914d">\n</div>\n<div class="field">\n<label for="password">\u8bbf\u95ee\u5bc6\u7801</label>\n<input type="password" name="password">\n</div>\n</form>\n</details>\n<div class="ui message miniweb_server_info">\n\u60a8\u8fd8\u672a\u542f\u52a8\u670d\u52a1\n</div>\n<div class="ui message info">\n\u5c0f\u4e66\u5320\u5df2\u7ecf\u63a8\u51fa\u4e86<a href="https://hub.docker.com/r/suziwen/pegasus">\u5929\u9a6c\u7248</a>(Docker\u7248\u672c),\u60a8\u4e5f\u53ef\u4ee5\u901a\u8fc7\u670d\u52a1\u5668\u81ea\u5df1\u5b89\u88c5\u3002\n</div>\n</div>\n<div class="actions">\n<div class="ui positive right button basic" >\n\u5173\u95ed\n</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/miniweb_sync_view":function(e,t,n){var i,r,o,a,s,l,c={}.hasOwnProperty;s=t("./view"),t("../application"),t("../lib/notifier"),l=t("./templates/miniweb_sync"),r=t("../lib/miniweb_server"),i=t("../constant"),o=t("./miniweb/index_view"),a=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)c.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.template=l,t.prototype.className="ui mini button server_store_button icon basic",t.prototype.initListenerChanges=function(){return i.pouchDB},t.prototype.initialize=function(e){return this.initListenerChanges(),r.init()},t.prototype.events={click:"showMiniwebServerManagerViewFn"},t.prototype.showMiniwebServerManagerViewFn=function(e){return(new o).show()},t.prototype.afterRender=function(){var e;return e=this,this.$el.attr("title","\u73cd\u73d1\u7f51\u683c\u670d\u52a1\u7ba1\u7406"),r.on("start",(function(){return e.$el.addClass("active")})),r.on("stop",(function(){return e.$el.removeClass("active")}))},t}(s),n.exports=a}}),window.requirejs.define({"views/modify_file_attribute_dialog_view":function(e,t,n){var i,r,o,a,s,l,c,u={}.hasOwnProperty;s=t("./view"),a=t("../lib/utils"),r=t("../lib/notifier"),t("../application"),t("../constant"),o=t("../lib/pouchdb_index_view_manager"),l=t("./templates/modify_file_attribute_dialog"),c=null,i=function(e){var t,n,i,s,d,p;function f(){return f.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)u.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(f,e),f.prototype.template=l,f.prototype.className="ui standard story_modal modal",f.prototype.fileCollection=null,n=[],t=[],d="replace",p=function(e,t,n,i,r){var o,s;if("tagNames"===(o=t)&&(o="tags",i=i.join(",")),i!==n&&(e[t]=n?"tags"===o&&!n instanceof Array&&"string"==typeof n?n.split(","):n:"tags"===o?[]:""),r!==(s=a.setMetaData(r,o,n,!0)))return e.content=s},i=function(e,t,n,i){var r,o;return r=e.get("content"),o={},n.forEach((function(n){var i,a;if(a=e.get(n),i=t[n],"tagNames"===n&&"replace"!==d&&(i.split(",").forEach((function(e){return a.indexOf(e),"append"!==d?a=a.filter((function(t){return t!==e})):a.indexOf(e)<0?a.push(e):void 0})),i=a.join(",")),r=o.content||r||"",t.hasOwnProperty(n))return p(o,n,i,a,r)})),Object.keys(o).length>0?e.save(o,{force:!0,success:function(){return i(null,e)},error:function(e){return i(e)}}):i(null,e)},s=function(e,o){var a,s,l;return c.$dimmer.dimmer("show"),s=["title","tagNames","category","flag","slug"],(l=t||n.map((function(e){return e.id}))).length>1&&(s=["tagNames","category","flag"]),a=0,async.mapLimit(l,10,(function(t,n){return c.fileCollection.getModelById(t,(function(o,u){return o?(r.showMessage("\u4fdd\u5b58\u6587\u4ef6\u300a"+t+"\u300b\u5931\u8d25:"+o,6e3,"error"),n()):i(u,e,s,(function(e){return e&&r.showMessage("\u4fdd\u5b58\u6587\u4ef6\u300a"+_.escape(u.get("title"))+"\u300b\u5931\u8d25:"+e,6e3,"error"),c.$dimmer.find(".ui.text").html("\u5904\u7406\u4e2d:"+ ++a+" / "+l.length),n()}))}))}),(function(e){return o()}))},f.prototype.initialize=function(e){return this.fileCollection=e.fileCollection},f.prototype.show=function(e,i){var a,l;return n=e,t=i,c=this,this.render(),d="replace",a=this.$el,this.$dimmer=$('<div class="ui dimmer transition hidden"><div class="ui text loader">\u5904\u7406\u4e2d</div></div>'),this.$el.append(this.$dimmer),this.$dimmer.dimmer({onShow:function(){return c.$dimmer.find(".ui.text").html("\u5904\u7406\u4e2d")}}),this.$el.find(".ui.radio.checkbox").checkbox({onChange:function(e){var t;return t=$(this),d=t.val()}}),n.length>1&&this.$el.find(".tag_names_modify_type_container").css({display:"inline-flex"}),(l=this.$el.find(".ui.form")).form({fields:{name:{identifier:"title",rules:[{type:"empty",prompt:"\u6807\u9898\u4e0d\u80fd\u4e3a\u7a7a"}]}},onSuccess:function(e){var t,i,l,u;return e&&(e.preventDefault(),e.stopPropagation()),u={title:a.find("input[name=title]").val().trim(),tagNames:l=a.find("input[name=tagNames]").val().trim(),category:t=a.find("input[name=category]").val().trim(),flag:i=a.find("input[name=flag]").val().trim(),slug:a.find("input[name=slug]").val().trim()},n.length>1&&(""===l&&delete u.tagNames,""===t&&delete u.category,""===i&&delete u.flag),s(u,(function(){var e,t;return e=c.$dimmer.find(".ui.text"),t=function(t,n,i,r){return e.html("["+t+"/"+n.length+"]\u7d22\u5f15\u4e2d:"+i+" / "+r)},o.autoBuildIndexFn(t,(function(){return r.showMessage("\u4fee\u6539\u5b8c\u6210"),c.$el.modal("hide")}))}))}}),this.$el.modal({closable:!1,onShow:function(){var e,i,o,s,c,u,d,p;return c=a.find("input[name=title]"),s=a.find("input[name=tagNames]"),e=a.find("input[name=category]"),i=a.find("input[name=flag]"),o=a.find("input[name=slug]"),1===n.length?(d=n[0],c.val(d.get("title")),s.val(d.get("tagNames")),e.val(d.get("category")),i.val(d.get("flag")),o.val(d.get("slug"))):n.length>1?(p=n.map((function(e){return"<li>"+_.escape(e.get("title"))+"</li>"})),t&&p.push("<li>.......</li>"),(u=a.find(".title_field")).find(".ui.input").hide(),u.append("<ol>"+p.join("")+"</ol>"),u.find(">label").html("\u6807\u9898\uff08\u5171 "+(t?t.length:n.length)+" \u7bc7\u6587\u7ae0\uff09"),a.find(".slug_field").hide()):(r.showMessage("\u8bf7\u81f3\u5c11\u9009\u62e9\u4e00\u4e2a\u6587\u4ef6",6e3,"error"),l.hide())},onHidden:function(){return c.$el.find(".ui.radio.checkbox").checkbox("destroy"),l.form("destroy"),c.$el.modal("destroy"),c.remove(),c=null},onApprove:function(){return l.form("validate form"),!1}}).modal("show")},f}(s),n.exports=i}}),window.requirejs.define({"views/new_filename_dialog_view":function(e,t,n){var i,r,o,a,s={}.hasOwnProperty;a=t("./templates/new_filename_dialog"),o=t("./view"),r=t("../lib/notifier"),i=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)s.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.className="ui modal small",t.prototype.template=a,t.prototype.initialize=function(e){return this.head=e.head,this.initVal=$.trim(e.initVal)},t.prototype.getRenderData=function(){return{head:this.head}},t.prototype.show=function(e){var t,n,i;return this.render(),t=this.$el.find(".ui.form"),n=t.find("input[name=filename]"),this.initVal&&n.val(this.initVal),t.form({filename:{identifier:"filename",rules:[{type:"empty",prompt:"\u6587\u4ef6\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a"}]}},{onSuccess:(i=this,function(){var n;return n=$.trim(t.find("input[name=filename]").val()),e(n,(function(e,t){return e?r.showMessage(e,6e3,"error"):i.$el.modal("hide")}))})}),this.$el.modal({closable:!1,onVisible:function(){return n[0].select(),n[0].focus()},onHidden:function(e){return function(){return e.$el.remove()}}(this),onApprove:function(){return t.form("validate form"),!1}}).modal("show")},t}(o),n.exports=i}}),window.requirejs.define({"views/page_nav_view":function(e,t,n){var i,r,o,a,s,l,c={}.hasOwnProperty;a=t("./view"),i=t("../constant"),r=t("../lib/notifier"),l=t("./templates/page_nav"),s=function(e,t){var n,o;return o=function(t){return e.hideDimmer(),r.showMessage("\u52a0\u8f7d\u5217\u8868\u51fa\u9519"+t,6e3,"error")},n=i.pouchDB,e.showDimmer(),n.allDocs({include_docs:!0,keys:t}).then((function(t){var n;return e.hideDimmer(),n=t.rows.map((function(e){return e.doc})),e.changeDocs(n)})).catch(o)},o=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)c.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.className="page_nav_container ui icon buttons mini",t.prototype.template=l,t.prototype.currentPage=0,t.prototype.perpage=30,t.prototype.allFileIds=[],t.prototype.events={"click .refresh_page_button":"refreshPageFn","click .first_page_button":"firstPageFn","click .prev_page_button":"prevPageFn","click .next_page_button":"nextPageFn","click .last_page_button":"lastPageFn","click .page_info_button .menu .item":"gotoPageFn"},t.prototype.initialize=function(e){return this.inst=e.inst,this.allFileIds=e.allFileIds},t.prototype.refreshPageFn=function(){var e;return this.currentPage=0,e=this,this.inst.loadAllIds((function(t){return e.allFileIds=t,e.fetchFiles(),e.$el.find(".total_page").html(Math.ceil(e.allFileIds.length/e.perpage))}))},t.prototype.prevPageFn=function(){return this.currentPage-=1,this.currentPage<0&&(this.currentPage=0),this.fetchFiles()},t.prototype.nextPageFn=function(){var e;return this.currentPage+=1,e=Math.ceil(this.allFileIds.length/this.perpage)-1,this.currentPage>e&&(this.currentPage=e),this.fetchFiles()},t.prototype.firstPageFn=function(){return this.currentPage=0,this.fetchFiles()},t.prototype.lastPageFn=function(){return this.currentPage=Math.ceil(this.allFileIds.length/this.perpage)-1,this.fetchFiles()},t.prototype.gotoPageFn=function(e){var t,n,i;return t=$(e.currentTarget),n=Math.ceil(this.allFileIds.length/this.perpage)-1,(i=parseInt(t.data("value"))||0)<0&&(i=0),i>n&&(i=n),this.currentPage=i,this.fetchFiles()},t.prototype.afterRender=function(){var e,t;return this.$el.find(".total_page").html(Math.ceil(this.allFileIds.length/this.perpage)),t=this,(e=this.$el.find(".page_info_button")).dropdown({direction:"upward",onShow:function(){var n,i,r;return n=e.find(".menu"),!((i=Math.ceil(t.allFileIds.length/t.perpage))<=0)&&(n.empty(),function(){r=[];for(var e=0;0<=i?e<i:e>i;0<=i?e++:e--)r.push(e);return r}.apply(this).forEach((function(e){return n.append('<div class="item '+(t.currentPage===e?"active":void 0)+'" data-value="'+e+'">'+(e+1)+"</div>")})),!0)}})},t.prototype.remove=function(){return this.$el.find(".page_info_button").dropdown("destroy"),t.__super__.remove.call(this)},t.prototype.fetchFiles=function(){var e,t,n,i;if(t=(i=this.currentPage*this.perpage)+this.perpage,n=this.allFileIds.slice(i,t),s(this.inst,n),this.allFileIds.length<this.perpage?this.$el.addClass("empty_pages"):this.$el.removeClass("empty_pages"),(e=this.$el.find(".page_statics_info")).html("\u6587\u7ae0\u603b\u6570:"+this.allFileIds.length),e.attr("title","\u6587\u7ae0\u603b\u6570:"+this.allFileIds.length),this.$el.find(".page_button").removeClass("disabled"),this.$el.find(".current_page").html(this.currentPage+1),0===this.currentPage&&this.$el.find(".first_page_button, .prev_page_button").addClass("disabled"),t>=this.allFileIds.length)return this.$el.find(".last_page_button, .next_page_button").addClass("disabled")},t}(a),n.exports=o}}),window.requirejs.define({"views/pdf_component/pdf_manager_view":function(e,t,n){var i,r,o,a,s,l,c,u,d,p,f,h,m=function(e,t){return function(){return e.apply(t,arguments)}},v={}.hasOwnProperty;p=t("../view"),u=t("../../lib/utils"),c=t("../../lib/utils_url"),r=t("../../application"),l=t("../../lib/resource_core"),i=t("../../lib/app_resource_core"),t("../../models/attachment_model"),a=t("../../lib/notifier"),d=t("../../lib/utils_color"),o=t("../../constant"),s=t("./pdf_window_manager_view"),h=t("./templates/pdf_manager"),f=function(){var e,t,n,f;return f=null,e=null,t=null,n="",function(p){function g(){return this.closeWindow=m(this.closeWindow,this),g.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)v.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(g,p),g.prototype.template=h,g.prototype.className="draggable_dialog_content_container pdf_manager_container",g.prototype.isLoading=!1,g.prototype.fileId=null,g.prototype.hashTag=null,g.prototype.fileModel=null,g.prototype.openFileModelBtn=null,g.prototype.openWindowBtn=null,g.prototype.pdfInfo=null,g.prototype.initialize=function(e){return this.fileId=e.fileId,this.popupManager=e.popupManager,this.hashTag=e.hashTag,f=this},g.prototype.events={"click .ui.cancel.button":"closeWindow"},g.prototype.closeWindow=function(){return this.popupManager.close()},g.prototype.afterRender=function(){return this.popupManager.setTitle(this.filename)},g.prototype.close=function(){return f.openFileModelBtn&&f.openFileModelBtn.remove(),f.openWindowBtn&&f.openWindowBtn.remove(),f.stopListening(),f=null,t&&t.beforeClose&&t.beforeClose(),e=null,t=null,this.remove()},g.prototype.scrollToHashTag=function(e){if(t&&t.ReactHighlightApp)return t.ReactHighlightApp.scrollToHighlight(e)},g.prototype.openFileModel=function(){return $(window).trigger("createNewEditor",[f.fileModel,{forceOpen:!0,groupId:n,callback:function(e,t){var i,r;return t.gotoLine(t.getLength()-1),(i=t.$el.find(".popup_editor_file_tabs .file_item.droppable_file_item.active")[0])&&!n?appHighlightPosByEl(i):(r=t.editor).highlightPos(r.getCursor()),n=e.id}}])},g.prototype.openWindow=function(){return new(s())({fileId:this.fileId}).show()},g.prototype.show=function(e){return this.render(),e.append(this.$el),o.pouchDB.get(this.fileId,(function(e,t){return e?a.showMessage("\u52a0\u8f7d pdf \u5931\u8d25",6e3,"error"):t.docId?r.getFileCollection().getModelById(t.docId,(function(e,t){var n,i,r;return e?a.showMessage("pdf \u5bf9\u5e94\u7684\u7b14\u8bb0\u5df2\u7ecf\u4e0d\u5b58\u5728",6e3,"error"):(f.fileModel=t,n=function(){var e,t;return(e=$('<i class="icon edit outline header_open_file_button header_button basic" title="\u6253\u5f00\u7b14\u8bb0\u7f16\u8f91"/>')).on("click",(function(){return f.openFileModel()})),f.openFileModelBtn=e,f.popupManager.$el.find(".header_button_container").prepend(e),(t=$('<i class="icon window restore header_open_window_button header_button basic" title="\u5728\u65b0\u7a97\u53e3\u4e2d\u6253\u5f00"/>')).on("click",(function(){return f.openWindow()})),f.openWindowBtn=t,f.popupManager.$el.find(".header_button_container").prepend(t),f.showContent()},r=f.fileId.substring((t.id+"__").length)+"_highlights",f.fileModel.hasAttachment(r)?n():(i=new Blob([f.fileId],{type:o.fileContentType.attachment}),f.fileModel.addAttachment(i,r,i.type,{fixRepeatFilename:!1},(function(e,t,i,r){return n()}))))})):a.showMessage("pdf \u5bf9\u5e94\u7684\u7b14\u8bb0\u5df2\u7ecf\u4e0d\u5b58\u5728",6e3,"error")}))},g.prototype.showDimmer=function(){return f.popupManager.showDimmer()},g.prototype.hideDimmer=function(e){if(null==e&&(e=!1),e||!f.isLoading)return f.popupManager.hideDimmer()},g.prototype.showContent=function(){var n,s;return n=$('<iframe src="pdfpreview/index.html" class="preview_iframe" frameborder="0" style="width: 100%;height:100%;"></iframe>').appendTo(this.$el.find(".pdf_viewer_container")),f.isLoading=!0,f.showDimmer(),window,n[0].contentWindow.XSJIFRAME=!0,s=this.fileId,n.on("load",(function(){var p,h,m,v;return p=n[0],e=p.contentDocument,(t=p.contentWindow).addEventListener("click",(function(){return f.popupManager.focus()})),"function"==typeof window.clientChangeOpenTarget&&window.clientChangeOpenTarget(e),h=!1,(v=r.getUserModel().get("user"))&&v.vip&&(h=!0),"web"===STORY_PLATFORM&&(h=!0),t.ISVIP=h,t.INITCOLORS=d.getUserColors(),t.LOADATTACHMENT=function(e,t){return new Promise((function(n,r){return/^text\//i.test(t.type)?u.blob2Text(t,(function(t,o){var s,l;return t?r(t):(l=(l=o.split("\n")[0]||"").trim(),s=l,l?i.getResource(l,(function(t,o){if(!o)return a.showHandling("PDF \u6587\u4ef6\u4e0b\u8f7d\u4e2d...."),fetch(c.covertGithubUrl(s)).then((function(e){if(e.status<200||e.status>300)throw"\u4e0b\u8f7d\u51fa\u9519:"+e.status+"("+e.statusText+")";return e.blob()})).then((function(t){return i.createResource(l,e,t.type,t,(function(e,t){return a.hideHandling(),e?r(e):n(t.data)}))})).catch((function(e){return a.hideHandling(),a.showMessage("\u4e0b\u8f7d PDF \u6587\u4ef6\u51fa\u9519\uff1a"+e,6e3,"error"),r(e)}));n(o.data)})):r("error file"))})):n(t)}))},t.onCopyNoteHighlight=function(e){var t,n;return t=(t=f.pdfInfo.Title).replace(/[\[\]\(\)!=~]/g,""),n="["+t+" - P"+e.position.pageNumber+"](xsjapp://pdf/"+f.fileId+"#"+e.id+")",$(document).one("copy",(function(e){return e.preventDefault(),e.stopPropagation(),e.originalEvent.clipboardData.setData("text/plain",n),a.showMessage("\u590d\u5236\u5f15\u7528\u6210\u529f")})),document.execCommand("copy")},t.onCreateNoteHighlight=function(e,n){var i,r,o,s,c;if(f.fileModel)return i=f.fileModel,o="pdf",f.pdfInfo&&(o=(o=f.pdfInfo.Title).replace(/[\[\]\(\)!=~]/g,"")),c="["+o+" - P"+e.position.pageNumber+"](xsjapp://pdf/"+f.fileId+"#"+e.id+")",n.content.image?t.ReactHighlightApp.getObjectUrlByUrl("screenshot_"+n.id,n,(function(e){return t.fetch(e).then((function(e){return e.blob()})).then((function(e){return l.uploadResource({},i,n.id+".png",e.type,e,{fixRepeatFilename:!1},(function(e,t,n,r){var s;return e?a.showMessage("\u6dfb\u52a0\u7b14\u8bb0\u56fe\u7247\u5931\u8d25:"+e,6e3,"error"):(s=i.get("content"),s+="\n\n> \n> !["+o+"]("+n+")\n> \n> "+c+"\n> \n\n",i.save({content:s}),f.openFileModel(),a.showMessage("\u6dfb\u52a0\u5b8c\u6210"))}))}))})):(r=i.get("content"),(s=n.content.text.split("\n").filter((function(e){return!!e.trim()})).map((function(e){return"> "+e}))).push("> "),s.push("> "+c),r+="\n\n> \n"+s.join("\n")+"\n> \n\n",i.save({content:r}),f.openFileModel(),a.showMessage("\u6dfb\u52a0\u5b8c\u6210"))},t.EmojiPickerDataSource="../js/modules/emoji-picker-element/data.json",(m=t.PDFViewerApplicationOptions).set("locale","zh-CN"),m.set("annotationEditorMode",-1),m.set("workerSrc","./build/pdf.worker.js"),m.set("sandboxBundleSrc","./build/pdf.sandbox.js"),t.startPdfViewer(s,o.pouchDB,(function(e){var n,i;return null==e&&(e={}),e&&e.info&&e.info.Title&&f.popupManager.setTitle(e.info.Title),f.isLoading=!1,f.hideDimmer(),n=t.PDFViewerApplication,i=function(){return f.hashTag&&setTimeout((function(){return f.scrollToHashTag(f.hashTag)}),1e3),n.pdfDocument.getMetadata().then((function(e){if(e&&e.info&&e.info.Title)return f.pdfInfo=e.info,f.popupManager.setTitle(e.info.Title)})),n.eventBus.off("documentloaded",i)},n.eventBus.on("documentloaded",i)}))}))},g}(p)},n.exports=f}}),window.requirejs.define({"views/pdf_component/pdf_window_manager_view":function(e,t,n){var i,r,o,a,s,l,c,u,d;c=t("../../lib/utils"),l=t("../../lib/utils_url"),r=t("../../application"),s=t("../../lib/resource_core"),i=t("../../lib/app_resource_core"),t("../../models/attachment_model"),a=t("../../lib/notifier"),u=t("../../lib/utils_color"),o=t("../../constant"),d=function(){var e,n,d,p,f,h;return h=null,n=null,d=null,f=null,null,p=null,e=t("../pdf_popup_manager_view"),function(){var t,m;function v(e){this.fileId=e.fileId,this.hashTag=e.hashTag,h=this}return v.prototype.isLoading=!1,v.prototype.fileId=null,v.prototype.hashTag=null,v.prototype.fileModel=null,v.prototype.pdfInfo=null,v.prototype.scrollToHashTag=function(e){if(d&&d.ReactHighlightApp)return d.ReactHighlightApp.scrollToHighlight(e)},v.prototype.setWindowTitle=function(e){if(f)return(0,f.$)("title").text(e)},v.prototype.showLoader=function(){var e;if(f)return(e=f.$)("#loader-wrapper").show(),e(".application_dimmer").show()},v.prototype.hideLoader=function(){var e;if(f)return(e=f.$)("#loader-wrapper").hide(),e(".application_dimmer").hide()},t=function(){var e,t;if(f.document,p=f.requirejs("./lib/notifier"),t=f.$,(e=t(".top_button")).hide(),"client"===STORY_PLATFORM)return e.show(),e.on("click",(function(t){var n;return n=f.nw.Window.get(),e.hasClass("active")?(e.removeClass("active"),n.setAlwaysOnTop(!1)):(e.addClass("active"),n.setAlwaysOnTop(!0))}))},m=function(i,r){var o,a,s;return s=$(window).width()/2,o=$(window).height()/2,a=h.nextId,PopupCenter("window.html","xsj_"+a,s,o,(function(n){return(f=n).GLOBALID="xsj_"+a,e.getPdfWindows(i.fileId).push(i),t(),h.showContent()}),(function(t){var r,o;if(t.GLOBALID)return console.log("before unload external viewer"),(o=(r=e.getPdfWindows(i.fileId)).indexOf(i))>=0&&r.splice(o,1),console.log("unload external viewer"),d&&d.beforeClose&&d.beforeClose(),n=null,d=null,f=null,null,h=null}))},v.prototype.show=function(){return o.pouchDB.get(this.fileId,(function(e,t){return e?a.showMessage("\u52a0\u8f7d pdf \u5931\u8d25",6e3,"error"):t.docId?r.getFileCollection().getModelById(t.docId,(function(e,t){var n,i,r;return e?a.showMessage("pdf \u5bf9\u5e94\u7684\u7b14\u8bb0\u5df2\u7ecf\u4e0d\u5b58\u5728",6e3,"error"):(h.fileModel=t,n=function(){return m(h)},r=h.fileId.substring((t.id+"__").length)+"_highlights",h.fileModel.hasAttachment(r)?n():(i=new Blob([h.fileId],{type:o.fileContentType.attachment}),h.fileModel.addAttachment(i,r,i.type,{fixRepeatFilename:!1},(function(e,t,i,r){return n()}))))})):a.showMessage("pdf \u5bf9\u5e94\u7684\u7b14\u8bb0\u5df2\u7ecf\u4e0d\u5b58\u5728",6e3,"error")}))},v.prototype.showContent=function(){var e,t,a,m;return a=(e=f.$)(".xsj_viewer"),t=e('<iframe src="pdfpreview/index.html" class="preview_iframe" frameborder="0" style="width: 100%;height:100%;"></iframe>').appendTo(a),h.isLoading=!0,t[0].contentWindow.XSJIFRAME=!0,m=this.fileId,t.on("load",(function(){var e,a,f,v;return e=t[0],n=e.contentDocument,d=e.contentWindow,"function"==typeof window.clientChangeOpenTarget&&window.clientChangeOpenTarget(n),a=!1,(v=r.getUserModel().get("user"))&&v.vip&&(a=!0),"web"===STORY_PLATFORM&&(a=!0),d.ISVIP=a,d.INITCOLORS=u.getUserColors(),d.LOADATTACHMENT=function(e,t){return new Promise((function(n,r){return/^text\//i.test(t.type)?c.blob2Text(t,(function(t,o){var a,s;return t?r(t):(s=(s=o.split("\n")[0]||"").trim(),a=s,s?i.getResource(s,(function(t,o){if(!o)return p.showHandling("PDF \u6587\u4ef6\u4e0b\u8f7d\u4e2d...."),fetch(l.covertGithubUrl(a)).then((function(e){if(e.status<200||e.status>300)throw"\u4e0b\u8f7d\u51fa\u9519:"+e.status+"("+e.statusText+")";return e.blob()})).then((function(t){return i.createResource(s,e,t.type,t,(function(e,t){return p.hideHandling(),e?r(e):n(t.data)}))})).catch((function(e){return p.hideHandling(),p.showMessage("\u4e0b\u8f7d PDF \u6587\u4ef6\u51fa\u9519\uff1a"+e,6e3,"error"),r(e)}));n(o.data)})):r("error file"))})):n(t)}))},d.onCopyNoteHighlight=function(e){var t,n;return t=(t=h.pdfInfo.Title).replace(/[\[\]\(\)!=~]/g,""),n="["+t+" - P"+e.position.pageNumber+"](xsjapp://pdf/"+h.fileId+"#"+e.id+")",$(document).one("copy",(function(e){return e.preventDefault(),e.stopPropagation(),e.originalEvent.clipboardData.setData("text/plain",n),p.showMessage("\u590d\u5236\u5f15\u7528\u6210\u529f")})),document.execCommand("copy")},d.onCreateNoteHighlight=function(e,t){var n,i,r,o,a;if(h.fileModel)return n=h.fileModel,r="pdf",h.pdfInfo&&(r=(r=h.pdfInfo.Title).replace(/[\[\]\(\)!=~]/g,"")),a="["+r+" - P"+e.position.pageNumber+"](xsjapp://pdf/"+h.fileId+"#"+e.id+")",t.content.image?d.ReactHighlightApp.getObjectUrlByUrl("screenshot_"+t.id,t,(function(e){return d.fetch(e).then((function(e){return e.blob()})).then((function(e){return s.uploadResource({},n,t.id+".png",e.type,e,{fixRepeatFilename:!1},(function(e,t,i,o){var s;return e?p.showMessage("\u6dfb\u52a0\u7b14\u8bb0\u56fe\u7247\u5931\u8d25:"+e,6e3,"error"):(s=n.get("content"),s+="\n\n> \n> !["+r+"]("+i+")\n> \n> "+a+"\n> \n\n",n.save({content:s}),p.showMessage("\u6dfb\u52a0\u5b8c\u6210"))}))}))})):(i=n.get("content"),(o=t.content.text.split("\n").filter((function(e){return!!e.trim()})).map((function(e){return"> "+e}))).push("> "),o.push("> "+a),i+="\n\n> \n"+o.join("\n")+"\n> \n\n",n.save({content:i}),p.showMessage("\u6dfb\u52a0\u5b8c\u6210"))},d.EmojiPickerDataSource="../js/modules/emoji-picker-element/data.json",(f=d.PDFViewerApplicationOptions).set("locale","zh-CN"),f.set("annotationEditorMode",-1),f.set("workerSrc","./build/pdf.worker.js"),f.set("sandboxBundleSrc","./build/pdf.sandbox.js"),d.startPdfViewer(m,o.pouchDB,(function(e){var t,n;return null==e&&(e={}),e&&e.info&&e.info.Title&&h.setWindowTitle(e.info.Title),h.isLoading=!1,h.hideLoader(),t=d.PDFViewerApplication,n=function(){return h.hashTag&&setTimeout((function(){return h.scrollToHashTag(h.hashTag)}),1e3),t.pdfDocument.getMetadata().then((function(e){if(e&&e.info&&e.info.Title)return h.pdfInfo=e.info,h.setWindowTitle(e.info.Title)})),t.eventBus.off("documentloaded",n)},t.eventBus.on("documentloaded",n)}))}))},v}()},n.exports=d}}),window.requirejs.define({"views/pdf_component/templates/pdf_manager":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<div class="draggable_dialog_content">\n<div class="pdf_viewer_container iframe_wrapper" style="width:100%;height:100%;overflow:hidden;"></div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/pdf_popup_manager_view":function(e,t,n){var i,r,o,a,s,l,c,u,d={}.hasOwnProperty;t("../application"),i=t("./base_window_manager_view"),r=t("./pdf_component/pdf_manager_view"),s={},l={},o=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)d.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.fileId="",t.prototype.current=null,t.prototype.local_storage_name="pdf_popup_manager",t.prototype.initialize=function(e){if(t.__super__.initialize.call(this),this.fileId=e.fileId,this.fileId)return this.local_storage_name="pdf_popup_manager_"+this.fileId},t.prototype.getPdfWindows=function(){return l[this.fileId]},t.prototype.show=function(e){var n,i;return t.__super__.show.call(this),l[this.fileId]||(l[this.fileId]=[]),e=$.extend({popupManager:this,fileId:this.fileId},e),this.$el.find(".header_logo>i").removeClass().addClass("far fa-file-pdf fa-lg"),n=this.$el.find(".draggable_dialog_content_container_wrapper"),(i=new(r())(e)).show(n),this.current=i},t.prototype.close=function(){var e;return null!=(e=this.current)&&e.close(),this.current=null,delete s[this.fileId],t.__super__.close.call(this)},t}(i),c="",u=function(e,t){var n;if(e)return s[e]?((n=s[e]).focus(),t.hashTag&&n.current&&n.current.scrollToHashTag(t.hashTag),c===e+"/"+t.hashTag&&n.$el.transition("jiggle"),c=e+"/"+t.hashTag,n.$el.visible(!0)?void 0:n.fixPosition()):((n=new o({fileId:e})).show(t),s[e]=n)},a=function(e){return e||(e=Object.keys(s)),"string"==typeof e&&(e=[e]),e.map((function(e){if(s[e])return s[e].close()}))},n.exports={showPopupView:u,hidePopupView:a,getPdfWindows:function(e){return l[e]||(l[e]=[]),l[e]}}}}),window.requirejs.define({"views/preview_buttons_config_view":function(e,t,n){var i,r,o,a,s,l,c,u={}.hasOwnProperty;a=t("./view"),l=t("./templates/preview_buttons_config"),i=t("../application"),o=t("../lib/utils_size"),s=o.pageSizeMap,c=o.viewportSizeMap,r=function(e){var t,n,r,o;function a(){return a.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)u.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(a,e),a.prototype.className="icon dropdown ui icon button preview_config_button",a.prototype.template=l,n=null,a.prototype.events={"change .preview_viewport_size_select":"changeViewPortSizeSelectFn","change .preview_viewport_align_select":"changeViewPortAlignFn","keyup .preview_viewport_size_input":"changeViewPortSizeFn","change input":"inputChangeFn"},a.prototype.inputChangeFn=function(e){var n,i;return i=(n=$(e.currentTarget)).attr("name"),t(i,n.is(":checked"))},o=_.debounce((function(e){return n.save("viewportWidth",e)}),300),r=_.debounce((function(e){return n.save("viewportAlign",e)}),300),t=_.debounce((function(e,t){return n.save(e,t)}),300),a.prototype.getRenderData=function(){return{minimap:n.get("minimap")?"checked":void 0}},a.prototype.changeViewPortSizeSelectFn=function(e){var t;return t=$(e.currentTarget).val(),this.$el.find(".preview_viewport_size_input").val(t),o(t)},a.prototype.changeViewPortSizeFn=function(e){var t;if(13===e.keyCode)return t=$(e.currentTarget),o(t.val())},a.prototype.changeViewPortAlignFn=function(e){var t;return t=$(e.currentTarget),r(t.val())},a.prototype.initialize=function(e){return n=i.getPreviewProfileModel()},a.prototype.afterRender=function(){var e,t,i;for(t in e=this,c)i=c[t],e.$el.find(".preview_viewport_size_select").append('<option value="'+i[0]+'">'+t+"</option>");for(t in s)i=s[t],e.$el.find(".preview_viewport_size_select").append('<option value="'+i[0]+'cm">'+t+"</option>");return this.$el.dropdown({action:function(){},saveRemoteData:!1,forceSelection:!1,filterRemoteData:!1,className:{selected:"skip_selected"},delay:{hide:1e3},onShow:function(){var t,i,r;return r=n.get("viewportWidth"),i=n.get("viewportAlign"),t=n.get("minimap"),e.$el.find(".preview_viewport_size_input").val(r),e.$el.find(".preview_viewport_align_select").val(i),e.$el.find("input[name=minimap]").prop("checked",!!t),e.$el.find(".preview_config_container"),!0},onHide:function(){}})},a}(a),n.exports=r}}),window.requirejs.define({"views/preview_buttons_view":function(e,t,n){var i,r,o,a,s,l,c,u,d,p,f,h=function(e,t){return function(){return e.apply(t,arguments)}},m={}.hasOwnProperty;p=t("./view"),u=t("./toc_dropdown_view"),c=t("./single_popup_manager_view"),s=t("./preview_buttons_config_view"),d=t("../lib/utils"),r=t("../constant"),a=t("../lib/notifier"),i=t("../application"),o=t("./file_info_view"),f=t("./templates/preview_buttons"),t("../lib/preview_core"),l=function(e){function t(){return this.pdfRefresh=h(this.pdfRefresh,this),this.pptMultiplex=h(this.pptMultiplex,this),this.presetationToc=h(this.presetationToc,this),this.tocClick=h(this.tocClick,this),this.showLinePath=h(this.showLinePath,this),this.selectPreviewType=h(this.selectPreviewType,this),this.selectPreviewLayout=h(this.selectPreviewLayout,this),this.enterFullScreen=h(this.enterFullScreen,this),t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)m.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.template=f,t.prototype.className="preview_buttons animation_icon_tips_container",t.prototype.initialize=function(e){var t,n;return this.previewView=e.previewView,t=this,$(window).on("execCommand",(function(e,n){if("togglePreviewTocPanel"===n&&t.tocDropdownView)return t.tocDropdownView.toggle()})),$(window).on("previewLayoutPositionChanged",(n=this,function(e,t){return n.$el.find(".preview_buttons_wrapper")})),$(window).on("linePathModeChange",function(e){return function(t,n){var i,r;return e.linePath=n,r=e.$el.find(".line_button>i.icon"),i=e.$el.find(".line_button"),e.linePath?(e.previewView.$el.find(".preview_wrapper").addClass("preview_wrapper_line_path"),r.attr("title","\u9000\u51fa\u6620\u5c04\u5173\u7cfb"),i.addClass("active")):(e.previewView.$el.find(".preview_wrapper").removeClass("preview_wrapper_line_path"),r.attr("title","\u6253\u5f00\u6620\u5c04\u5173\u7cfb"),i.removeClass("active"))}}(this)).on("previewTypeChange",function(e){return function(t,n){switch(e.$el.find(".button").removeClass("hide"),"east"!==e.previewView.layoutPosition&&e.$el.find(".line_button").addClass("hide"),e.$el.find(".preview_type_button .item").removeClass("active"),n){case"presetation":return e.$el.find(".preview_type_button .item[data-value=presetation]").addClass("active"),e.$el.find(".line_button, .toc_button, .pdf_refresh_button, .file_info_button").addClass("hide");case"pdf":return e.$el.find(".preview_type_button .item[data-value=pdf]").addClass("active"),e.$el.find(".line_button, .toc_button, .presetation_toc_button, .ppt_multiplex_button, .zen_button, .html_button, .file_info_button").addClass("hide");default:return e.$el.find(".preview_type_button .item[data-value=normal]").addClass("active"),e.$el.find(".presetation_toc_button, .ppt_multiplex_button, .pdf_refresh_button").addClass("hide")}}}(this)).on("previewLayoutChange",function(e){return function(t,n){switch(e.$el.find(".preview_layout_button .item").removeClass("active"),n){case"north":return e.$el.find(".preview_layout_button .item[data-value=north]").addClass("active");case"south":return e.$el.find(".preview_layout_button .item[data-value=south]").addClass("active");case"west":return e.$el.find(".preview_layout_button .item[data-value=west]").addClass("active");case"free":return e.$el.find(".preview_layout_button .item[data-value=free]").addClass("active");default:return e.$el.find(".preview_layout_button .item[data-value=east]").addClass("active")}}}(this))},t.prototype.events={"click .zen_button":"enterFullScreen","click .html_button":"showHTML","click .wechat_button":"copyToWeChatFn","click .file_info_button":"showFileInfo","click .css_text_button":"setCssText","click .camera_button":"captureTotalHtml","click .preview_type_button .item":"selectPreviewType","click .preview_layout_button .item":"selectPreviewLayout","click .presetation_toc_button":"presetationToc","click .ppt_multiplex_button":"pptMultiplex","click .pdf_refresh_button":"pdfRefresh","click .line_button":"showLinePath","click .toc a":"tocClick","click .main_style_type":"styleFilterFn","click .code_style_type":"styleFilterFn","click .custom_style_type":"styleFilterFn","click .style_button .item":"selectTheme","click .toc_button":"tocBtnClickFn","click .only_preview_mode_button":"onlyPreviewModeFn","click .normal_mode_button":"normalModeFn"},t.prototype.normalModeFn=function(e){return $(window).trigger("toggleOnlyPreviewMode",[!1,{showPreview:!0}])},t.prototype.onlyPreviewModeFn=function(e){return $(window).trigger("toggleOnlyPreviewMode",!0)},t.prototype.tocBtnClickFn=function(e){return this.tocDropdownView.toggle()},t.prototype.selectTheme=function(e){var t,n,i,r,o;if(e.stopPropagation(),e.preventDefault(),n=this.previewView.fileModel)return r=(t=$(e.currentTarget)).data("type"),o=t.data("value"),i="previewTheme","code"===r&&(i="codeTheme"),t.hasClass("active")?(t.removeClass("active"),n.saveCssMeta(i)):(n.saveCssMeta(i,o),t.parent().find(".active").removeClass("active"),t.addClass("active"))},t.prototype.styleFilterFn=function(e){var t,n;return n=$(e.currentTarget).data("type"),t=$(".style_button"),"main"===n?t.dropdown("filter","main"):"code"===n?t.dropdown("filter","code"):"custom"===n?(t.dropdown("hide"),this.setCssText()):void 0},t.prototype.captureTotalHtml=function(){var e,t,n,i,r,o,s,l;return(o=this.previewView).showDimmer(),i=o.fileModel,s=i.get("title")||"\u672a\u547d\u540d\u6587\u4ef6",r=o._previewDocument.documentElement,(e=$(r)).addClass("xiaoshujiang_camera"),(l=e.find(".xiaoshujiang_element")).addClass("xiaoshujiang_element_hide"),t=e.find("img"),n=function(e,t){var n,i;return n=$(e),i=$.trim(n.attr("src")),/^http[s]?:\/\//gi.test(i)?d.getCrossOrignDomainResource(i,(function(e,i){return n.attr("src",i),t()})):t()},async.mapLimit(t.toArray(),20,n,(function(t){return domtoimage.toBlob(r,{height:e.find("body")[0].scrollHeight}).then((function(t){return e.removeClass("xiaoshujiang_camera"),l.removeClass("xiaoshujiang_element_hide"),d.blob2DataURL(t,(function(e,t){return o.hideDimmer(),c.showPopupView("image",{fileModel:i,link:t,operateType:"download",realFilename:s+".jpg"},{fileType:"image/jpg"})}))})).catch((function(t){return e.removeClass("xiaoshujiang_camera"),l.removeClass("xiaoshujiang_element_hide"),a.showMessage(t+"",6e3,"error"),o.hideDimmer()}))}))},t.prototype.iframecaptureTotalHtml=function(){var e,t;return e=this.previewView.fileModel,t=e.get("title")||"\u672a\u547d\u540d\u6587\u4ef6",this.previewView._previewWindow.html2img(null,(function(e,n){return e?a.showMessage(e+"",6e3,"error"):window.saveAs(n,t+".png")}))},t.prototype.setCssText=function(){var e,t,n,i;return i=this.previewView.fileModel,n=i.get("cssText")||"",e=$('<div class="ui standard story_modal modal">\n<i class="close icon"></i>\n<div class="header" >\n  \u81ea\u5b9a\u4e49css\u6837\u5f0f\n</div>\n<div class="content story_content">\n<div class="ui form">\n<div class="ui fluid field">\n<textarea id="css_text" name="css_text" rows="10" cols="30" placeholder="h1{font-size:20px;}">'+n+'</textarea>\n</div>\n</div>\n</div>\n<div class="actions">\n<div class="tips">\n<div >\u6ce8\uff1a</div>\n<div >\u8be5\u6837\u5f0f\u4ec5\u5bf9\u5f53\u524d\u6587\u4ef6\u751f\u6548\uff0c\u5168\u5c40\u9884\u89c8\u533a\u6837\u5f0f\u8bf7\u5230\uff40\u8bbe\u7f6e\uff40\u9875\u9762\u914d\u7f6e</div>\n</div>\n<div class="ui button cancel" >\n    \u5173\u95ed\n</div>\n<div class="ui button positive" >\n    \u786e\u5b9a\n</div>\n</div>\n</div>'),t=e.find("#css_text"),e.modal({closable:!1,onHidden:function(){return e.remove()},onApprove:function(){return n=t.val(),i.set("cssText",n),i.save({},{force:!0})}}).modal("show")},t.prototype.showFileInfo=function(){var e;return e=this.previewView.fileModel,new o({model:e,previewView:this.previewView}).show()},t.prototype.copyToWeChatFn=function(e){var t,n,r;if(!(t=$(e.currentTarget)).hasClass("loading"))return t.addClass("loading"),r=this.previewView.fileModel,(n={brand:"xsj_plugin_wechat",type:"dataURL",netImage:!1,changeOpenTarget:!0}).renderLinkAsFootnote=!0,$(window).trigger("convertPreviewFormatForExport",[r,n,function(e,n){return n.find(".ol_linenums .li_linenum").map((function(e,t){var n;return n=t.innerHTML,t.innerHTML="<pre>"+n+"</pre>"})),n.find(".li_linenum_before_span, .footnote-backref").remove(),n.find(".li_linenum").addClass("li_list_style"),n.find("a").map((function(e,t){var n;if(n=t.href,!/^https:\/\/mp.weixin.qq.com/i.test(n))return t.outerHTML="<span class='link_footnote'>"+t.innerHTML+"</span>"})),i.getStyleText(r,(function(e,i){return d.inlineStylesheet(n.html(),"ul, ol {\n  margin-left: 1px!important;\n}\n.ol_linenums{\n  margin-left: 1px!important;\n  margin-bottom: 1em!important;\n  border-left: 0px!important;\n}\n.link_footnote{\n  color: #1e6bb8;\n}\n.xiaoshujiang_code_title, .xiaoshujiang_code_infos {\n  font-size: .9em;\n  opacity: .5;\n}\n.math_equation_table .math_td .MathJax_SVG{\n  display: block!important;\n  width: fit-content!important;\n  margin: 0 auto!important;\n}\n.xsj_plugin_wechat .footnotes-list{\n   text-align: left;\n   margin-left: -2.2em!important;\n   list-style-position: inside;\n}\n.xsj_plugin_wechat .footnote-item{\n   text-align: left;\n}\n.xsj_plugin_wechat .footnotes-list .footnote-item>p{\n  display: inline;\n}\n"+i+"\n",(function(e,n){return n=(n+="").replace(/[\x00-\x08\x0B-\x0C\x0E-\x1F\x7F-\x9F]/g,""),$(document).one("copy",(function(e){var i;return e.preventDefault(),e.stopPropagation(),(i=e.originalEvent).clipboardData.setData("text/plain",n),i.clipboardData.setData("text/html",n),t.removeClass("loading"),a.showMessage("\u5df2\u6210\u529f\u590d\u5236\u5230\u526a\u5207\u677f,\u8bf7\u5230\u5fae\u4fe1\u516c\u4f17\u5e73\u53f0\u76f4\u63a5\u7c98\u8d34",6e3,"info")})),document.execCommand("copy")}))}))}])},t.prototype.showHTML=function(){var e,t,n;return t=$('<div class="ui standard story_modal modal">\n<i class="close icon"></i>\n<div class="header">\n  HTML\n</div>\n<div class="content story_content custom_css_preview">\n<pre class="custom_css_preview_pre">\n<code class="language-html"></code>\n</pre>\n</div>\n<div class="actions">\n<div class="ui cancel button" >\n    \u5173\u95ed\n</div>\n</div>\n</div>'),(e=this.previewView.$preview.clone()).find("#MathJax_SVG_Hidden").parent().remove(),n=e.html(),n=d.tidyHtml(n),t.find(".content>pre>code").text(n),hljs.highlightElement(t.find(".content>pre>code")[0]),t.modal({onHidden:function(){return t.remove()}}).modal("show")},t.prototype.afterRender=function(){var e,t,n,o,a,l,c,p,f;if(o=this,e=this.$el.find(".preview_config_button_placeholder"),(c=new s({})).render(),e.replaceWith(c.$el),p=null,a=function(){var e,t;return e=o.previewView.getPreviewContainer(),t=e.scrollTop(),p={},e.find("[data-source-line]").each((function(e,n){var i,r;return r=(i=$(n)).attr("data-source-line"),p[r]=Math.round(i.offset().top+t)})),p},l=function(e){var t;if(e<=0)return 1;for(t in p||(p=a()),p)if(p[t]>e)return t;return i.homeView.editorView.getLength()-1},this.tocDropdownView=new u({tocType:"preview",$container:$("#preview_toc_button_placeholder"),gotoLineFn:function(e,t){var n;return n=o.previewView.getPreviewContainer(),"top"===e?n.scrollTo(0,{duration:0,onAfter:function(){return"function"==typeof t?t():void 0}}):"bottom"===e?n.scrollTo("100%",{duration:0,onAfter:function(){return"function"==typeof t?t():void 0}}):n.scrollTo("[data-source-line='"+e+"']",{duration:0,offset:{left:0,top:-n.height()/3},onAfter:function(){return"function"==typeof t?t():void 0}})},getFirstVisibleRowFn:function(){var e;return e=o.previewView.getPreviewContainer().scrollTop(),l(e)},getContentFn:function(){return i.homeView.editorView.getValue()},listenToSyncFn:function(e){return o.previewView.getPreviewContainer().on("scroll",e)},unListenToSyncFn:function(e){return o.previewView.getPreviewContainer().off("scroll",e),p=null},onHideDropdownFn:function(e){return i.homeView.editorView.off("change",e.refresh),p=null},onShowDropdownFn:function(e){return i.homeView.editorView.on("change",e.refresh)}}),this.tocDropdownView.render(),n=this.$el.find(".preview_type_button"),MINI_WEB?(n.remove(),this.$el.find(".wechat_button").remove()):n.dropdown({}),this.$el.find(".preview_layout_button").dropdown({action:function(e,t,n){var i;if("external"!==t)return null!=(i=$(this).data("moduleDropdown"))?i.hideAndClear():void 0}}),(t=this.$el.find(".style_button")).dropdown({saveRemoteData:!1,forceSelection:!1,className:{selected:"skip_selected"},templates:{menu:function(e,n){var i,r,o,a;return i='<div class="header">\n  <div class="ui mini buttons">\n    <a class="ui '+("main"===(o=t.data("filterType")||"main")?"active":"")+' button mini main_style_type" data-type="main"><i class="file alternate outline icon"></i>\u6b63\u6587</a>\n    <a class="ui '+("code"===o?"active":"")+' button mini code_style_type" data-type="code"><i class="file alternate outline icon"></i>\u4ee3\u7801\u5757</a>\n    <a class="ui button mini custom_style_type" data-type="custom"><i class="css3 alternate icon"></i>\u81ea\u5b9a\u4e49</a>\n  </div>\n</div>',r=[],a=e[n.values]||{},$.each(a,(function(e,t){var i;return i=t.selected?"active":"",r.push('<div class="item '+i+'" data-value="'+t[n.name]+'" data-type="'+t.type+'">'+t[n.name]+"</div>")})),i+'\n<div class="scrolling menu">\n'+r.join("")+"\n</div>"}},onHide:function(e){var t;return(t=$(this)).find(".menu").empty(),t.dropdown("refreshItems")},action:function(){},apiSettings:{responseAsync:(f=this,function(e,n){var i,o,a,s,l,c;return s=f.previewView.fileModel,l="",i="",s&&(a=s.get("cssText")||"",(o=d.getCssMetaData(a))&&(i=r.codeTheme,l=o.previewTheme||"",i=o.codeTheme||"")),(c=(e.urlData||{}).query||"")?t.data("filterType",c):c=t.data("filterType"),n("code"===c?{success:!0,results:_.map(r.codeTheme,(function(e){var t;return t=!1,e.name===i&&(t=!0),{name:e.name,value:e.url,type:"code",selected:t}}))}:{success:!0,results:_.map(r.previewTheme,(function(e){var t;return t=!1,e.name===l&&(t=!0),{name:e.name,value:e.url,type:"main",selected:t}}))})})}}),"client"===STORY_PLATFORM)return this.$el.find(".preview_type_button .item[data-value=pdf]").addClass("hide")},t.prototype.enterFullScreen=function(){return d.hideAllPopup(),$(window).trigger("togglePreviewZenMode",!0)},t.prototype.selectPreviewLayout=function(e){var t,n;if(e.stopPropagation(),e.preventDefault(),"external"!==(n=(t=$(e.currentTarget)).data("value")))return t.parent().find(".item").removeClass("active"),t.addClass("active"),"east"!==n&&$(window).trigger("toggleLinePathMode",!1),this.previewView.changeLayoutPosition(n),$(window).trigger("changePreviewLayoutPosition",n);$(window).trigger("createNewExternalPreviewWindow")},t.prototype.selectPreviewType=function(e){var t,n,r,o;switch(e.stopPropagation(),e.preventDefault(),(n=$(e.currentTarget)).parent().find(".item").removeClass("active"),n.addClass("active"),r=n.data("value"),o=i.getTourModel(),t=this.$el.find(".preview_type_button"),r){case"presetation":if(this.previewView.initPresetationPreview(),this.$el.find(".line_button, .toc_button, .file_info_button").addClass("hide"),this.$el.find(".presetation_toc_button").removeClass("hide"),o.canPrompt("editor_presetation_learned"))return t.popup({on:"manual",onVisible:function(){var e;return this,this.width(300),t.data("modulePopup").setting("popup",this),e=this.find(".ok"),this.find(".create_ppt_helper").click((function(){return i.getFileCollection().createPptHelpFile(!1,(function(e,n){return $(window).trigger("changeFileModel",n),t.popup("destroy"),o.dontPrompt("editor_presetation_learned")}))})),e.click((function(){return t.popup("destroy"),o.dontPrompt("editor_presetation_learned")}))},html:'<div class="header">\u63d0\u793a</div><div class="content">\u7b2c\u4e00\u6b21\u4f7f\u7528ppt\u6f14\u793a,\u4f60\u53ef\u4ee5\u5148\u53c2\u8003<a href="javascript:void(0);" class="create_ppt_helper">ppt\u5e2e\u52a9\u624b\u518c</a><div><a href="javascript:void(0);" class="ok pull-right">\u77e5\u9053\u4e86</a></div></div>',inline:!1}),t.popup("show");break;case"pdf":return t.popup("destory"),this.previewView.initPdfPreview(),this.$el.find(".line_button, .toc_button, .presetation_toc_button, .file_info_button").addClass("hide");default:return t.popup("destory"),this.previewView.initHtmlPreview(),this.$el.find(".line_button, .toc_button, .file_info_button").removeClass("hide"),this.$el.find(".presetation_toc_button").addClass("hide")}},t.prototype.showLinePath=function(){return this.linePath=!this.linePath,$(window).trigger("toggleLinePathMode",this.linePath)},t.prototype.tocClick=function(e){var t,n;if(e.preventDefault(),e.stopPropagation(),(n=$(e.target).data("line"))>=0)return t=this.previewView._previewDocument,$(t).find("body>div").scrollTo("[data-line='"+n+"']")},t.prototype.presetationToc=function(e){var t;if("presetation"===this.previewView.previewType)return null!=(t=this.previewView._previewWindow.Reveal)?t.toggleOverview():void 0},t.prototype.pptMultiplex=function(e){return this.previewView.pptMultiplex()},t.prototype.pdfRefresh=function(e){return this.previewView._compilePdfFile()},t}(p),n.exports=l}}),window.requirejs.define({"views/preview_center_buttons_view":function(e,t,n){var i,r,o,a,s,l,c,u=function(e,t){return function(){return e.apply(t,arguments)}},d={}.hasOwnProperty;l=t("./view"),s=t("../lib/utils"),i=t("../application"),a=t("./toc_dropdown_view"),r=t("./preview_buttons_config_view"),c=t("./templates/preview_center_buttons"),o=function(e){function t(){return this.exitFullScreen=u(this.exitFullScreen,this),this.tocClick=u(this.tocClick,this),this.presetationToc=u(this.presetationToc,this),t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)d.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.template=c,t.prototype.className="preview_center_buttons animation_icon_tips_container",t.prototype.initialize=function(e){return this.previewView=e.previewView,this.previewCenterView=e.previewCenterView,$(window).on("previewZenModeChange",(t=this,function(e,n){var r,o;return r=t.$el.find(".zen_button"),o=i.getTourModel(),n?o.canPrompt("preview_zen_learned")?(r.popup({on:"manual",prefer:"opposite",position:"bottom right",onRemove:function(){return r.removeClass("active")},onVisible:function(){return r.addClass("active"),this.width(300),this.find(".ok").click((function(){return r.popup("destroy"),o.dontPrompt("preview_zen_learned")}))},html:'<div class="header">\u63d0\u793a</div><div class="content">\u70b9\u51fb\u8fd9\u91cc\u9000\u51fa\u5168\u5c4f<div><a href="javascript:void(0);" class="ok pull-right">\u77e5\u9053\u4e86</a></div></div>',inline:!0}).popup("show"),setTimeout((function(){return r.popup("reposition")}),1e3)):void 0:r.popup("destroy")}));var t},t.prototype.events={"click .toc a":"tocClick","click .presetation_toc_button":"presetationToc","click .zen_button":"exitFullScreen"},t.prototype.afterRender=function(){var e,t,n,o,s,l;return t=this,e=this.$el.find(".preview_config_button_placeholder"),(s=new r({})).render(),s.$el.addClass("right pointing"),e.replaceWith(s.$el),l=null,n=function(){var e,n;return e=t.previewCenterView.getPreviewContainer(),n=e.scrollTop(),l={},e.find("[data-source-line]").each((function(e,t){var i,r;return r=(i=$(t)).attr("data-source-line"),l[r]=Math.round(i.offset().top+n)})),l},o=function(e){var t;if(e<=0)return 1;for(t in l||(l=n()),l)if(l[t]>e)return t;return i.homeView.editorView.getLength()-1},new a({$container:this.$el.find(".toc_button_placeholder"),gotoLineFn:function(e,n){var i;return i=t.previewCenterView.getPreviewContainer(),"top"===e?i.scrollTo(0,{duration:300,onAfter:function(){return"function"==typeof n?n():void 0}}):"bottom"===e?i.scrollTo("100%",{duration:300,onAfter:function(){return"function"==typeof n?n():void 0}}):i.scrollTo("[data-source-line='"+e+"']",{duration:300,onAfter:function(){return"function"==typeof n?n():void 0}})},getFirstVisibleRowFn:function(){var e;return e=t.previewCenterView.getPreviewContainer().scrollTop(),o(e)},getContentFn:function(){return i.homeView.editorView.getValue()},listenToSyncFn:function(e){return t.previewCenterView.getPreviewContainer().on("scroll",e)},onHideDropdownFn:function(){return l=null},unListenToSyncFn:function(e){return t.previewCenterView.getPreviewContainer().off("scroll",e),l=null}}).render()},t.prototype.presetationToc=function(e){var t;return null!=(t=this.previewCenterView._previewWindow.Reveal)?t.toggleOverview():void 0},t.prototype.tocClick=function(e){var t,n;if(e.preventDefault(),e.stopPropagation(),(n=$(e.target).data("line"))>=0)return t=this.previewCenterView.$clone[0].contentWindow.document,$(t).find("body>div").scrollTo("[data-line='"+n+"']")},t.prototype.exitFullScreen=function(){return s.hideAllPopup(),$(window).trigger("togglePreviewZenMode",!1)},t}(l),n.exports=o}}),window.requirejs.define({"views/preview_center_minimap_view":function(e,t,n){var i,r,o,a,s={}.hasOwnProperty;r=t("./view"),i=t("../lib/utils"),a=t("./templates/preview_center_minimap"),o=function(){var e,t,n,o,l,c,u;return u=null,c=function(n){return u.startY=n.clientY,u.handleStartY=u.jHandle.position().top,$("html").on("mousemove",t).on("mouseup mouseleave",e)},t=function(e){var t,n,i,r;return n=e.clientY-u.startY,r=(t=u.handleStartY+n)/(u.wHeight*(1-u.ratio)),i=u.overflow*r,t=t>0?t:0,$(u.element.parent()).scrollTop((t+i)/u.ratio)},e=function(n){return $("html").off("mousemove",t).off("mouseup mouseleave",e)},l=function(e,t){var n;return n=u.overflow*e,u.jCanvas.css({"margin-top":-n}),u.jHandle.css({top:t*u.ratio-n})},o=function(e){var t,n;return t=(n=$(this).scrollTop())/(u.canvasHeight-u.wHeight),l(t,n)},n=function(e){var t,n,i;return u.wHeight=$(u.window).height(),u.canvasHeight=$(u.element).outerHeight(),u.canvasWidth=$(u.element).outerWidth(),t=(i=Math.floor(u.canvasHeight*(u.width/u.canvasWidth)))-u.wHeight,n=i/u.canvasHeight,u.scaledHeight=i,u.ratio=n,u.overflow=t>0?t:0,u.jHandle.height(u.wHeight*n)},function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)s.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.className="g-unselectable scroller preview_center_minimap",t.prototype.template=a,t.prototype.width=150,t.prototype.unselectableClass="g-unselectable",t.prototype.initialize=function(e){return u=this,this.window=e.window},t.prototype.events={"mousedown .scroller__handle":"startDrag","click .scroller__canvas":"clickScroll",wheel:"onWheelFn"},t.prototype.onWheelFn=function(e){var t;return e=e.originalEvent,t=CodeMirror.wheelEventPixels(e).y,this.scroll(t)},t.prototype.startDrag=function(e){return c(e)},t.prototype.clickScroll=function(e){var t,n,i;return i=(t=e.clientY-u.jHandle.height()/2)/(u.wHeight*(1-u.ratio)),n=u.overflow*i,t=t>0?t:0,$(u.element.parent()).scrollTop((t+n)/u.ratio)},t.prototype.scroll=function(e){var t,n;return n=(t=$(u.element.parent())).scrollTop(),t.scrollTop(n+e)},t.prototype.afterRender=function(){return this.jContainer=this.$el,this.jCanvas=this.$el.find(".scroller__canvas"),this.jHandle=this.$el.find(".scroller__handle")},t.prototype.destroyMinimap=function(){return $(u.window.document).find(".preview").parent().off("scroll",o),$(u.window).off("resize",n),u.remove(),u=null},t.prototype.refreshMinimap=function(){return u.jContainer.prepend('<i class="spinner loading icon" style="position:absolute;"></i>'),n(),i.asyncLoadResources([{id:"html2canvas_js",type:"script",filename:"js/html2canvas/html2canvas.js"}],(e=this,function(){return html2canvas(u.element[0],{simplifyText:!1,allowTaint:!0,backgroundColor:null,windowWidth:e.width/e.ratio,windowHeight:e.scaledHeight,scale:e.ratio}).then((function(e){if(u)return u.jContainer.find(".spinner.icon").remove(),$(e).css({width:u.width,height:u.scaledHeight}),u.jCanvas.html($(e))}))}));var e},t.prototype.initMinimap=function(){return u.element=$(this.window.document).find(".preview"),n(),i.asyncLoadResources([{id:"html2canvas_js",type:"script",filename:"js/html2canvas/html2canvas.js"}],(e=this,function(){return html2canvas(u.element[0],{simplifyText:!1,backgroundColor:null,allowTaint:!0,windowWidth:e.width/e.ratio,windowHeight:e.scaledHeight,scale:e.ratio}).then((function(e){if(u)return u.jContainer.find(".spinner.icon").remove(),$(e).css({width:u.width,height:u.scaledHeight}),u.jCanvas.append($(e)),$(u.window.document).find(".preview").parent().on("scroll",o),$(u.window).on("resize",n)}))}));var e},t}(r)},n.exports=o}}),window.requirejs.define({"views/preview_center_view":function(e,t,n){var i,r,o,a,s,l,c,u,d,p,f,h,m,v,g={}.hasOwnProperty;l=t("./view"),i=t("../application"),a=t("../lib/utils"),s=t("../lib/utils_size"),r=t("./preview_center_buttons_view"),u=t("./preview_center_minimap_view"),c=t("./zen_tabs_view"),f=t("../lib/preview_core"),m=t("./templates/preview_center"),v=null,p=null,d=null,h=s.setViewPortSize,o=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)g.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(n,e),n.prototype.template=m,n.prototype.className="preview_center_panel hide",n.prototype.previewView=null,n.prototype.events={wheel:"onWheelFn"},n.prototype.onWheelFn=function(e){var t,n,i;if(e.target===e.currentTarget&&(e=e.originalEvent,n=CodeMirror.wheelEventPixels(e).y,"normal"===this.previewView.previewType))return i=(t=$($(this._previewDocument).find(".preview").parent())).scrollTop(),t.scrollTop(i+n)},n.prototype.resetPreview=function(){if(this.$target)return this.$target.off("click"),this.$target.empty(),this.$target.parentsUntil("html").remove(),this.$target=null,$(this._previewDocument).off("keydown"),this._previewDocument=null,this._previewWindow=null},n.prototype.initialize=function(e){var t;return this.previewView=e.previewView,$(window).on("previewZenModeChange",(t=this,function(e,n){var i;return n?t.zenESCKey=jwerty.key("esc",(function(){var e;return $(window).trigger("togglePreviewZenMode",!1),null!=(e=t.zenESCKey)&&e.unbind(),t.zenESCKey=null})):(null!=(i=t.zenESCKey)&&i.unbind(),t.zenESCKey=null,$(t._previewDocument).unbind("keydown"),t.resetPreview())})),$(window).on("fileModelChanged",function(e){return function(t,n){var r,o,a,s;if(e.zen){if("presentation"===(s=n.getMeta().preview_previewType||"normal")&&(s="presetation"),d===s)return"presetation"===s?(i.getStyleText(n,(function(t,n){return f.setCustomCss(n,e._previewDocument)})),o=$(e._previewDocument).find(".slides"),n.get("content")||"",a={sourceMap:!0,previewType:"presetation",needRenderPreview:!0,parseClientLocalMedias:!0,livePreview:!0},f.previewTarget(n,null,e._previewWindow,o,a,(function(){return this._previewWindow.initRevealjs()}))):(i.getStyleText(n,(function(t,n){return f.setCustomCss(n,e._previewDocument)})),o=$(e._previewDocument).find(".preview"),n.get("content")||"",a={sourceMap:!0,previewType:"normal",needRenderPreview:!0,parseClientLocalMedias:!0,livePreview:!0},f.previewTarget(n,null,e._previewWindow,o,a,(function(){return null!=p?p.refreshMinimap():void 0})));switch(r=e.$el.find(".preview_center_wrapper"),s){case"presetation":return r.removeClass("ui piled segment zen_mode").addClass("presetation_zen_mode"),null!=p&&p.destroyMinimap(),p=null,e._initPPTPreview();default:return r.addClass("ui piled segment zen_mode").removeClass("presetation_zen_mode"),e._initHtmlPreview()}}}}(this))},n.prototype._initPPTPreview=function(){var e,t,n,r,o;return this.resetPreview(),d="presetation",t=this.$el.find(".preview_center_wrapper"),r=this.previewCenterButtonsView.$el.find(".toc_button"),e=this.previewCenterButtonsView.$el.find(".presetation_toc_button"),r.hide(),e.show(),t.addClass("presetation_zen_mode"),t.html(""),n=$('<iframe src="presetation.html" frameborder="0" style="width: 100%;height:100%;"></iframe>').appendTo(t),this.$clone=n,n.one("load",(o=this,function(){var e,t,r,a,s;return t=n[0],r=t.contentDocument,(s=t.contentWindow).autoLoadRemoteResource=!0,o._previewDocument=r,o._previewWindow=s,i.getStyleText(o.previewView.fileModel,(function(e,t){return f.setCustomCss(t,r)})),e=$(r).find(".slides"),o.$target=e,s.requirejs("previews/preview")(s,window),e.on("click",".story_script_resource_placeholder",(function(e){var t;return t=$(e.currentTarget),f.replaceScriptResource(t,e)})),a={sourceMap:!0,previewType:o.previewView.previewType,needRenderPreview:!0,parseClientLocalMedias:!0,livePreview:!0},f.previewTarget(o.previewView.fileModel,o.previewView.model,s,e,a,(function(){return s.initRevealjs()}))}))},n.prototype._initHtmlPreview=function(){var e,n,r,o,s;return this.resetPreview(),d="normal",n=this.$el.find(".preview_center_wrapper"),o=this.previewCenterButtonsView.$el.find(".toc_button"),e=this.previewCenterButtonsView.$el.find(".presetation_toc_button"),o.show(),e.hide(),n.addClass("ui piled segment zen_mode"),n.html(""),r=$('<iframe src="preview.html" frameborder="0" style="width: 100%;height:100%;"></iframe>').appendTo(n),this.$clone=r,a.asyncLoadResources([{id:"html2canvas_js",type:"script",filename:"js/html2canvas/html2canvas.js"}],(s=this,function(){return r.one("load",(function(){var e,n,o,l,c,d,h,m,v;if(l=r[0],d=l.contentDocument,(m=l.contentWindow).autoLoadRemoteResource=!0,s._previewDocument=d,s._previewWindow=m,i.getStyleText(s.previewView.fileModel,(function(e,t){return f.setCustomCss(t,d)})),e=$(d).find(".preview"),s.$target=e,m.requirejs("previews/preview")(m,window),o=$(window),$(d).bind("keydown",jwerty.event("esc",(function(){return o.trigger("togglePreviewZenMode",!1),o=null,$(d).unbind("keydown")}))),e.on("click",".story_script_resource_placeholder",(function(e){var t;return t=$(e.currentTarget),f.replaceScriptResource(t,e)})),e.on("click",".story_image img, .xsj_svg_viewbox, .xsj_drawio_image_html, .mermaid_svg, svg.sequence, .xsj_flow>svg, .xsj_plantuml>svg, .xsj_wavedrom>svg, .MathJax_SVG_Display>.MathJax_SVG>svg",(function(n){var i,r,o,s,l,c,u,d;if(n.originalEvent.path)for(d=n.originalEvent.path,r=l=0,c=d.length;l<c&&(u=d[r]).tagName&&!(r>30)&&n.currentTarget.ownerDocument!==u;r=++l)if("A"===u.tagName.toUpperCase())return;return i=$(n.currentTarget),o=[],s=0,e.find(".story_image img, .xsj_svg_viewbox, .xsj_drawio_image_html, .mermaid_svg, svg.sequence, .xsj_flow>svg, .xsj_plantuml>svg, .xsj_wavedrom>svg, .MathJax_SVG_Display>.MathJax_SVG>svg").map((function(e,t){var n,a,l,c,u,d,p,f,h,m,v,g,_,w,y,b,x,k;if((a=$(t)).is(i)&&(s=e),"IMG"===(b=t.tagName.toUpperCase())){if(a.attr("src"))return o.push({title:a.attr("title")||a.attr("alt")||"",href:a.attr("src"),src:a.data("src")})}else if("SVG"===b){for(g=t,k=parseInt(g.width.baseVal.value,10),d=parseInt(g.height.baseVal.value,10),(w=g.id)&&(w=' id="'+w+'" '),(_=g.className.baseVal)&&(_=' class="'+_+'" '),g.viewBox&&(k=parseInt(g.viewBox.baseVal.width,10),d=parseInt(g.viewBox.baseVal.height,10)),m=g.textContent,u="",v="",x="",g.parentElement.classList.contains("xsj_wavedrom")&&(n=$(g.ownerDocument).find(".wavedrom_svg_defs"),u=(new XMLSerializer).serializeToString(n[0]),v=wavedromStyle()),g.parentElement.classList.contains("MathJax_SVG")&&(n=$(g.ownerDocument).find("#MathJax_SVG_glyphs"),u=(new XMLSerializer).serializeToString(n[0]),x=' viewBox="'+g.getAttribute("viewBox")+'" ',k=g.getAttribute("width"),d=g.getAttribute("height")),y="",h=g.children,r=p=0,f=h.length;p<f;r=++p)l=h[r],y+=(new XMLSerializer).serializeToString(l);return c="data:image/svg+xml,"+encodeURIComponent('<?xml version="1.0" encoding="utf-8" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 20010904//EN" "http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd"><svg xmlns="http://www.w3.org/2000/svg" '+w+_+x+' width="'+k+'" height="'+d+'" xmlns:xlink="http://www.w3.org/1999/xlink"><source><![CDATA['+m+"]]></source>"+v+u+y+"</svg>"),o.push({title:"",href:c,thumbnail:c,src:c})}})),t("../lib/dynamic_import/import_blueimp_gallery")((function(){return blueimp.Gallery(o,{index:s,slideLoadingClass:"ui loader slide-loading",onslide:function(e,t){var n,i,r;return n=$(this.container[0]),(r=o[e])&&(i=r.src,a.getExt(i,1).toUpperCase()),n.find(".edit>i").hide()},onopen:function(){var e,t;return t=this,(e=$(t.container[0])).on("click",".rotate",(function(e){return e.preventDefault(),e.stopPropagation(),t.rotate(90)})),e.on("click",".download",(function(e){var n,i;return e.preventDefault(),e.stopPropagation(),i=t.getIndex(),n=o[i],a.getCrossOrignDomainResource(n.href,(function(t,i){var r,o,s;if(t)return Notifier.showMessage("\u4e0b\u8f7d\u51fa\u9519:"+t,6e3,"error");o=a.dataURL2Blob(i),r=".png";try{n.src&&(r=a.getExt(n.src)),r||(r="."+i.split(";")[0].split("/")[1].split("+")[0])}catch(t){e=t,r=".png"}return s=n.title||"\u672a\u547d\u540d\u6587\u4ef6",saveAs(o,s+r)}))}))},onclosed:function(){var e;return(e=$(this.container[0])).off("click",".edit"),e.off("click",".rotate"),e.off("click",".download")}})}))})),"function"==typeof window.changeOpenTarget&&window.changeOpenTarget(d),STORY_PLATFORM,c=d.createElement("script"),v=d.getElementsByTagName("script")[0],c.async=1,c.src="js/find-in-nw.js",v.parentNode.insertBefore(c,v),c.onload=function(){return m.findInNw.initialize()},null!=p&&p.destroyMinimap(),h={sourceMap:!0,previewType:"normal",needRenderPreview:!0,parseClientLocalMedias:!0,livePreview:!0},f.previewTarget(s.previewView.fileModel,s.previewView.model,m,e,h,(function(){return null!=p?p.initMinimap():void 0})),s.previewView.model.get("minimap"))return n=u(),p=new n({window:m}),s.$el.append(p.render().$el)}))}))},n.prototype.toggleZenMode=function(e){var t,n,i;return this.zen=e,n=this.previewView.model,e?(v=new c({el:this.el}),this.listenTo(n,"change:minimap",(i=this,function(){var e;return n.get("minimap")?p?void 0:(e=u(),p=new e({window:i._previewWindow}),i.$el.append(p.render().$el),p.initMinimap()):(null!=p&&p.destroyMinimap(),p=null)})),this.listenTo(n,"change:viewportWidth change:viewportAlign",function(e){return function(){return h(n.get("viewportWidth"),n.get("viewportAlign"),e.$el.find(".preview_center_wrapper"))}}(this)),h(n.get("viewportWidth"),n.get("viewportAlign"),this.$el.find(".preview_center_wrapper")),"normal"===this.previewView.previewType?this._initHtmlPreview():"presetation"===this.previewView.previewType?this._initPPTPreview():void 0):(this.stopListening(n),t=this.$el.find(".preview_center_wrapper"),null!=v&&v.destroy(),v=null,null!=p&&p.destroyMinimap(),p=null,this.$clone=null,this._previewWindow=null,this._previewDocument=null,t.removeClass("ui piled segment zen_mode presetation_zen_mode"),t.html(""))},n.prototype.getPreviewContainer=function(){return $(this._previewDocument).find("body>div>.preview").parent()},n.prototype.initPreiewCenterButtons=function(){return this.previewCenterButtonsView=new r({previewView:this.previewView,previewCenterView:this}),this.$el.append(this.previewCenterButtonsView.render().$el)},n}(l),n.exports=o}}),window.requirejs.define({"views/preview_control_buttons_view":function(e,t,n){var i,r,o,a,s,l,c=function(e,t){return function(){return e.apply(t,arguments)}},u={}.hasOwnProperty;s=t("./view"),o=t("../application"),l=t("./templates/preview_control_buttons"),r=null,i=null,a=function(e){function t(){return this.toggleSyncEditor=c(this.toggleSyncEditor,this),this.toggleSyncScrollPreview=c(this.toggleSyncScrollPreview,this),t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)u.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.template=l,t.prototype.className="preview_control_buttons",t.prototype.initialize=function(e){return this.previewView=e.previewView,this.applicationProfileModel=o.getApplicationProfileModel(),this.listenTo(this.applicationProfileModel,"change:syncScrollPreview change:syncScrollEditor",(t=this,function(){return t.initStatus()}));var t},t.prototype.afterRender=function(){return r=this.$el.find(".sync_scroll_preview_button"),i=this.$el.find(".sync_scroll_editor_button"),this.initStatus()},t.prototype.initStatus=function(){var e,t,n;return n=(e=this.applicationProfileModel).get("syncScrollPreview"),t=e.get("syncScrollEditor"),r.toggleClass("active",n),i.toggleClass("active",t)},t.prototype.events={"click .sync_scroll_preview_button":"toggleSyncScrollPreview","click .sync_scroll_editor_button":"toggleSyncEditor"},t.prototype.toggleSyncScrollPreview=function(){var e,t;if(t=(e=this.applicationProfileModel).get("syncScrollPreview"),e.set("syncScrollPreview",!t),e.save(),!t)return this.previewView.editorView.syncPreview()},t.prototype.toggleSyncEditor=function(){var e,t;if(t=(e=this.applicationProfileModel).get("syncScrollEditor"),e.set("syncScrollEditor",!t),e.save(),!t)return this.previewView.syncEditor()},t}(s),n.exports=a}}),window.requirejs.define({"views/preview_free_layout_dialog_view":function(e,t,n){var i,r,o,a,s=function(e,t){return function(){return e.apply(t,arguments)}},l={}.hasOwnProperty;r=t("./view"),o=t("./templates/preview_free_layout_dialog"),a=null,i=function(e){function t(){return this.triggerBackgroundDialog=s(this.triggerBackgroundDialog,this),this.toggleOpacityDialog=s(this.toggleOpacityDialog,this),this.resetRotate=s(this.resetRotate,this),t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)l.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.template=o,t.prototype.className="preview_free_layout_dialog draggable_dialog ui segment raised",t.prototype.initialize=function(e){return a=this,this.resetScrollMap=e.resetScrollMap,this.previewView=e.previewView},t.prototype.events={"click .header_state_button":"openOrCloseDialog","click .header_opacity_button":"toggleOpacityDialog","click .header_background_button":"triggerBackgroundDialog","click .reset_rotate_button":"resetRotate",mousedown:"focus"},t.prototype.focus=function(){return $(".draggable_dialog_focus").removeClass("draggable_dialog_focus"),a.$el.addClass("draggable_dialog_focus")},t.prototype.resetRotate=function(e){return a.$el.rotatable("angle",0),a.$el.find(".reset_rotate_button").hide()},t.prototype.toggleOpacityDialog=function(e){return this.$el.toggleClass("preview_free_layout_opacity_dialog")},t.prototype.triggerBackgroundDialog=function(e){var t,n;return t=this.$el,this.$el.addClass("preview_free_layout_background_dialog"),n=jwerty.key("ctrl+shift+[",(function(){return n.unbind(),n=null,t.removeClass("preview_free_layout_background_dialog preview_free_layout_opacity_dialog")}))},t.prototype.afterRender=function(){return this.$el.rotatable({wheelRotate:!1,handle:this.$el.find(".header_rotate_button"),start:function(e){return $("body").addClass("iframe_dimmer"),a.$el.find(".main_preview").dimmer("show")},stop:function(e){return a.$el.find(".reset_rotate_button").show(),a.$el.find(".main_preview").dimmer("hide"),$("body").removeClass("iframe_dimmer")}}),this.$el.resizable({containment:"#main",helper:"ui-resizable-helper",handles:"e, s, se, nw",start:function(){return $("body").addClass("iframe_dimmer"),a.$el.find(".main_preview").dimmer("show")},stop:function(){var e,t;return a.$el.find(".main_preview").dimmer("hide"),$("body").removeClass("iframe_dimmer"),a.resetScrollMap(),t=(t=a.$el.width())<300?300:t,e=(e=a.$el.height())<300?300:e,a.model.set({freeLayoutWidth:t,freeLayoutHeight:e}),a.model.save()}}),this.$el.draggable({handle:".preview_layout_header",cancel:".header_state_button",start:function(e){return a.$el.find(".main_preview").dimmer("show")},stop:function(e){var t,n,i;return a.$el.find(".main_preview").dimmer("hide"),i=(i=(n=a.$el.offset()).top)<0?0:i,t=(t=n.left)<0?0:t,a.model.set({freeLayoutTop:i,freeLayoutLeft:t}),a.model.save()}})},t.prototype.close=function(){if(this.$el.find(".header_state_button").removeClass("minus").addClass("plus"),this.$el.addClass("preview_free_layout_dialog_closed"),this.isClosed())return this.$el.find(".main_preview").hide(),this.previewView.stopSyncPreview("free")},t.prototype.isClosed=function(){return this.$el.hasClass("preview_free_layout_dialog_closed")},t.prototype.open=function(){if(this.$el.find(".header_state_button").removeClass("plus").addClass("minus"),this.$el.removeClass("preview_free_layout_dialog_closed"),!this.isClosed())return this.$el.find(".main_preview").show(),this.previewView.startSyncPreview("free")},t.prototype.show=function(){var e,t,n,i;return this.$el.show(),$(".draggable_dialog_focus").removeClass("draggable_dialog_focus"),this.$el.addClass("draggable_dialog_focus"),n=(n=this.model.get("freeLayoutTop")||100)<0?0:n,t=(t=this.model.get("freeLayoutLeft")||100)<0?0:t,i=(i=this.model.get("freeLayoutWidth")||400)<300?300:i,e=(e=this.model.get("freeLayoutHeight")||350)<300?300:e,this.$el.css({top:n,left:t,width:i,height:e}),this.previewView.startSyncPreview("free")},t.prototype.hide=function(){var e,t,n,i,r;return i=(i=(n=this.$el.offset()).top)<0?0:i,t=(t=n.left)<0?0:t,r=this.$el.width(),e=this.$el.height(),this.model.set({freeLayoutTop:i,freeLayoutLeft:t,freeLayoutWidth:r,freeLayoutHeight:e}),this.model.save(),this.$el.hide(),this.previewView.stopSyncPreview("free")},t.prototype.openOrCloseDialog=function(e){return e.preventDefault(),e.stopPropagation(),this.isClosed()?this.open():this.close()},t}(r),n.exports=i}}),window.requirejs.define({"views/preview_link_popup_view":function(e,t,n){var i,r,o,a,s,l={}.hasOwnProperty;r=t("./base_popup_view"),i=t("../application"),o=t("../lib/notifier"),s=t("../lib/utils"),a=function(e){var t,n;function r(){return r.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)l.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(r,e),r.prototype.className="preview_link ui vertical menu",n=null,null,r.prototype.initialize=function(e){return r.__super__.initialize.call(this,e),n=e.previewWindow,e.previewDocument},r.prototype.events={"click .xsj_file_item":"openXSJFileFn","click .internal_hash_tag_item":"internalHashTagClickFn"},r.prototype.internalHashTagClickFn=function(e){var t;return e.preventDefault(),e.stopPropagation(),t=$(e.currentTarget).attr("href"),n.locationByHashTag(t)},r.prototype.openXSJFileFn=function(e){var t,n,r,a,s,l,c,u;switch(u=(t=$(e.currentTarget)).data("type"),s=t.data("hash-tag")||"",u){case"internal":return l=t.data("id"),i.getFileCollection().getModelById(l,(function(e,t){return e?o.showMessage("\u6253\u5f00\u6587\u4ef6\u5931\u8d25:"+e,6e3,"error"):t?$(window).trigger("changeFileModel",[t,{hashTag:s}]):o.showMessage("\u6253\u5f00\u6587\u4ef6\u5931\u8d25: \u627e\u4e0d\u5230\u8be5\u6587\u4ef6",6e3,"error")}));case"plugin":if(a=t.data("guid")+"",c=t.data("parentPath")+"",a&&(n=i.getCurrentStorePluginModel(),i.getPlugin(n)))return $(window).trigger("importFileByPlugin",[n,a,c||"",{},function(){}]);break;case"local":if(r=t.data("path"))return $(window).trigger("importFileByPath",[r])}},r.prototype.remove=function(){return n=null,null,r.__super__.remove.call(this)},t=null,r.prototype.afterShow=function(e,n){var r,o,a,l,c;if(r=this,l=a=decodeURI(n.link),this.$el.html(""),!/(^data:)|(^blob:)|(^file:)|(^chrome-extension:)/i.test(a)&&a&&(/^http[s]?:\/\//i.test(a)&&this.$el.html('<a class="item" href="'+_.escape(a)+'" target="_blank">\n   <i class="chrome icon"></i>'+_.escape(a)+"\n</a>"),c=a.lastIndexOf("#"),o="",c>=0&&(o=a.substring(c+1),a=a.substring(0,c)),t=Date.now(),!a&&o&&this.$el.html('<a class="item internal_hash_tag_item" href="#'+_.escape(o)+'">\n   <i class="hashtag icon"></i>'+_.escape(o)+"\n</a>"),a))return s.getRelatedDocs(a,{orignLink:l,fileModel:i.homeView.fileModel,app:i,dateNow:t},(function(e,n){var i,a;if(!e&&t===n.dateNow)return a=n.rows,i=[],a.forEach((function(e){if("internal"===e.type&&i.push('<a class="item xsj_file_item" data-type="internal" data-id="'+_.escape(e.id)+'" data-hash-tag="'+_.escape(o)+'">\n<i class="file alternate outline icon"></i>'+_.escape(e.title)+"\n</a>"),"plugin"===e.type&&i.push('<a class="item xsj_file_item" data-type="plugin" data-guid="'+_.escape(e.guid)+'" data-parent-path="'+_.escape(e.parentPath)+'" data-hash-tag="'+_.escape(o)+'">\n<i class="exchange icon"></i>'+_.escape(e.title)+"\n</a>"),"local"===e.type)return i.push('<a class="item xsj_file_item" data-type="local" data-path="'+_.escape(e.fullPath)+'" data-hash-tag="'+_.escape(o)+'">\n<i class="hdd outline icon"></i>'+_.escape(e.title)+"\n</a>")})),r.$el.append(i.join(""))}))},r}(r),n.exports=a}}),window.requirejs.define({"views/preview_server_control_view":function(e,t,n){var i,r,o,a,s,l,c,u=function(e,t){return function(){return e.apply(t,arguments)}},d={}.hasOwnProperty;s=t("./view"),a=t("../lib/utils"),i=t("../application"),r=t("../lib/notifier"),l=t("./templates/preview_server_control"),c=null,o=function(e){function t(){return this.refresh=u(this.refresh,this),this.stop=u(this.stop,this),this.start=u(this.start,this),t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)d.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.template=l,t.prototype.className="preview_server_control",t.prototype.events={"click .stop_button":"stop","click .refresh_button":"refresh"},t.prototype.initialize=function(e){return c=this,this.previewView=e.previewView,this.fileModel=e.fileModel},t.prototype.start=function(e){var t,n;return this.$el.dimmer("show"),n=this.fileModel,t={type:"dataURL",netImage:!1,previewType:"presetation",needRenderPreview:!1},$(window).trigger("convertPreviewFormatForExport",[n,t,function(e,t){return i.getStyleText(n,(function(e,i){return a.pptToken(n.get("title"),t.find(">.preview").html(),i,null,null,(function(e,t,n,i){if(!e)return c.secret=t,c.socketId=n,c.url=i,"client"!==STORY_PLATFORM&&window.open(c.url+"?secret="+t,"ppt"),c.refreshTemplate()}))}))}])},t.prototype.refreshTemplate=function(){var e,t,n,i,r,o,a;return(n=this.$el).find(".server_info").show(),t=n.find("#client_url_input"),e=n.find("#client_url"),r=n.find("#master_url_input"),i=n.find("#master_url"),o=c.url,a=c.url+"?secret="+c.secret,e.attr("href",o),t.val(o),i.attr("href",a),r.val(a),c.$el.dimmer("hide")},t.prototype.stop=function(e){if(c)return a.pptStop(c.secret,c.socketId,(function(e){return c.remove(),c=null}))},t.prototype.refresh=function(e){var t,n;return c.$el.dimmer("show"),n=this.fileModel,t={type:"dataURL",netImage:!1,previewType:"presetation",needRenderPreview:!1},$(window).trigger("convertPreviewFormatForExport",[n,t,function(e,t){return i.getStyleText(n,(function(e,i){return a.pptToken(n.get("title"),t.find(">.preview").html(),i,c.secret,c.socketId,(function(e,t,n,i){if(!e)return c.secret=t,c.socketId=n,c.url=i,c.refreshTemplate(),r.showMessage("\u90e8\u7f72\u6210\u529f")}))}))}])},t}(s),n.exports=o}}),window.requirejs.define({"views/preview_view":function(e,t,n){var i,r,o,a,s,l,c,u,d,p,f,h,m,v,g,w,y,b,x,k,D,C,F,M,T={}.hasOwnProperty;v=t("./view"),r=t("../constant"),h=t("../lib/utils"),f=t("../lib/utils_system"),m=t("../lib/utils_size"),u=t("../lib/preview_utils"),i=t("../application"),o=t("../lib/notifier"),t("./file_info_view"),l=t("./preview_link_popup_view"),a=t("./preview_buttons_view"),s=t("./preview_control_buttons_view"),c=t("./preview_server_control_view"),p=t("./single_popup_manager_view"),w=t("./preview_center_minimap_view"),F=t("./templates/preview"),M=t("./templates/wavedrom_style"),x=t("../lib/preview_core"),k=null,D=null,b=null,y=!1,g=function(e,t,n){var i,r,o,a,s,l,c,u,d,p,f,h,m,v,g,_,w,y,b,x,k,D,C,F,M,T,S,P,j,E,I,O,V,L,A,B;switch(n){case"pdf":for(r=$(t._previewWindow.PDFViewerApplication.pdfViewer.container),p=function(e){var n,i,r,o;for(n=0,i=r=0,o=e;0<=o?r<=o:r>=o;i=0<=o?++r:--r)n+=t._previewWindow.PDFViewerApplication.pdfViewer._pages[i].height;return n},a=function(e,t){var n,i,r,o;for(o=[],i=0,r=e.length;i<r;i++)n=e[i],t.push(n),n.items.length>0?o.push(a(n.items,t)):o.push(void 0);return o},y=[],s=[],k=[],w=e.getLength(),T=e.getScreenLength(),A=0,_=h=0,S=w-1;0<=S?h<=S:h>=S;_=0<=S?++h:--h)y.push(A),A+=e.getRowLength(_);for(y.push(A),f=m=0,P=T-1;0<=P?m<=P:m>=P;f=0<=P?++m:--m)s.push(-1);for(k.push(0),s[0]=0,B=t.getTocHtml(),i=$(B).find("a"),o=0,F=t._previewWindow.PDFViewerApplication.pdfOutlineViewer._outline,a(F,d=[]),u=t._previewWindow.PDFViewerApplication.pdfOutlineViewer._destinations,i.length+1===d.length&&(o=1),i.each((function(e,t){var n,i,r,a,l;if(""!==(l=$(t).data("line"))&&-1!==l)return 0!==(l=y[l])&&k.push(l),i=d[e+o].dest,(n=u[i])?(a=n[0],r=n[3],s[l]=Math.round(p(a)-r)):void 0})),k.push(T),s[T]=r[0].scrollHeight,M=0,f=v=1,j=T-1;1<=j?v<=j:v>=j;f=1<=j?++v:--v)-1===s[f]?(l=k[M],c=k[M+1],s[f]=Math.round((s[c]*(f-l)+s[l]*(c-f))/(c-l))):M++;return s;case"presetation":return s=[],w=e.getLength(),L=0,r=t.getPreviewContainer(),V=r.find("section.section_content"),g=V.length,V.each((function(e,t){var n,i,r,o,a,l;for(l=(n=$(t)).data("line"),0!==L&&(L=l),r=e+1>=g?w:$(V[e+1]).data("line")-1,i=o=L,a=r;o<=a?i<=a:i>=a;o<=a?++i:--i)s.push({indexh:n.data("indexh"),indexv:n.data("indexv"),indexf:n.data("indexf")});return L=l})),s;default:for((r=t.getPreviewContainer()).height(),y=[],s=[],k=[],C=r.scrollTop(),w=e.getLength(),T=e.getScreenLength(),A=0,_=b=0,E=w-1;0<=E?b<=E:b>=E;_=0<=E?++b:--b)y.push(A),A+=e.getRowLength(_);for(y.push(A),f=x=0,I=T-1;0<=I?x<=I:x>=I;f=0<=I?++x:--x)s.push(-1);for(k.push(0),s[0]=0,r.find("[data-source-line]").each((function(e,t){var n,i;if(""!==(i=(n=$(t)).attr("data-source-line"))&&(i=y[i],!(k.indexOf(i)>=0)))return 0!==i&&k.push(i),s[i]=Math.round(n.offset().top+C)})),k.push(T),s[T]=r[0].scrollHeight,M=0,f=D=1,O=T-1;1<=O?D<=O:D>=O;f=1<=O?++D:--D)-1===s[f]?(l=k[M],c=k[M+1],s[f]=Math.round((s[c]*(f-l)+s[l]*(c-f))/(c-l))):M++;return s}},C=m.setViewPortSize,d=function(e){var n,d,m,v;function S(){return S.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)T.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(S,e),S.prototype.className="previewPanel main_preview_panel",S.prototype.template=F,n=null,d=!1,S.prototype.childContentWindow=null,1,S.prototype.fileModel=null,S.prototype.converter=null,S.prototype.$preview=null,S.prototype.isSliding=!1,S.prototype.layoutPosition="east",S.prototype.previewType="normal",v=null,m=null,S.prototype.initialize=function(e){return this.fileModel=e.fileModel,this.layoutPosition=e.layoutPosition||this.model.get("previewLayoutPosition")||"east",m=_.debounce((function(e){var t;if(!("normal"===e.previewType&&e.model.get("minimap")&&e.$el.width()>=1024&&"true"===localStorage.getItem("only_preview_mode")))return b&&(e.$el.removeClass("preview_panel_contain_minimap"),b.destroyMinimap()),b=null;b?b.refreshMinimap():(t=w(),b=new t({window:e._previewWindow}),e.$el.append(b.render().$el),e.$el.addClass("preview_panel_contain_minimap"),b.initMinimap())}),600)},S.prototype.initMinimap=function(){return m(this)},S.prototype.events={wheel:"onWheelFn"},S.prototype.onWheelFn=function(e){var t,n,i;if(e.target===e.currentTarget&&(e=e.originalEvent,n=CodeMirror.wheelEventPixels(e).y,"normal"===this.previewType))return e.ctrlKey?(e.preventDefault(),e.stopPropagation(),void this._previewWindow.scalePreview()):(i=(t=$(this.$preview.parent())).scrollTop(),t.scrollTop(i+n))},S.prototype.getRenderData=function(){return{customCssPrefix:r.customCssPrefix}},S.prototype.afterRender=function(){var e;return e=this,C(this.model.get("viewportWidth"),this.model.get("viewportAlign"),this.$el.find(".preview_wrapper")),this.initHtmlPreview(),this.$previewLine=this.$el.find(".preview_line"),this.$loader=this.$el.find(".preview_dimmer"),$(window).on("sidebarHidden",(function(){if(d)return d=!1,e._preview()}))},S.prototype.showDimmer=function(){return this.$loader.show()},S.prototype.hideDimmer=function(){return this.$loader.hide()},S.prototype._compilePdfFile=function(){var e,t,n,r,a;return n=this.fileModel,e=this.$loader,(t=this._previewWindow).PDFViewerApplication.close(),"pdf"!==this.previewType&&o.showMessage("\u5f53\u524d\u9884\u89c8\u7a97\u53e3\u4e0d\u662fpdf\u6a21\u5f0f",6e3,"error"),e.show(),a=null,r=!1,a=setTimeout((function(){return r=!0,a=null,o.showMessage("\u89e3\u6790\u8d85\u65f6\uff0c\u514d\u8d39\u7528\u6237\u65e0\u6cd5\u5904\u7406\u5185\u5bb9\u592a\u5927\u6216\u8005\u5185\u5bb9\u592a\u8fc7\u590d\u6742\u7684\u6587\u4ef6",6e3,"error"),e.hide()}),6e4),$(window).trigger("convertPreviewFormatForExport",[n,{type:"dataURL",width:"18in",netImage:!0,convertSvg:!0,sourceMap:!0,convertFontIcon:!0,brand:"xsj_export_pdf",disableLazyLoading:!0},function(s,l){if(a&&(clearTimeout(a),a=null),!r)return l.find(".blank_anchor_name").remove(),l.find("#MathJax_SVG_glyphs path").attr("stroke","none"),i.getStyleText(n,(function(i,r){return h.compilePdfFile(l,n.get("title"),r,(function(n,i){var r;return e.hide(),n||i.error?o.showMessage(n||i.error,6e3,"error"):(r=i.uuid,t.PDFViewerApplication.open("/getpdffile?uuid="+r))}))}))}])},S.prototype.resetPreview=function(){switch(null!=v&&v.remove(),v=null,this.$preview&&(this.$preview.empty(),this.$preview.parentsUntil("html").remove(),$(this._previewWindow).off()),this.previewType){case"pdf":return this._previewWindow.PDFViewerApplication.close()}},S.prototype.initPdfPreview=function(e){var t,n,r;return null!=b&&b.destroyMinimap(),b=null,$(window).trigger("beforeChangePreviewType","pdf",this.previewType),this.resetPreview(),this.previewType="pdf",n=e?e():this.$el.find(".preview_wrapper").empty(),(t=$('<iframe src="pdfpreview/web/viewer.html?file=#pagemode=none&xsjInit=true" allowfullscreen webkitallowfullscreen class="preview_iframe" frameborder="0" style="width: 100%;height:100%;"></iframe>').appendTo(n)).one("load",(r=this,function(){var e,n,o,a;return n=t[0],o=n.contentDocument,(a=n.contentWindow).PDFViewerApplicationOptions.set("locale","zh-CN"),a.PDFViewerApplicationOptions.set("annotationEditorMode",-1),"function"==typeof(e=a.PDFViewerApplication).xsjLoad&&e.xsjLoad(),a.PDFViewerApplication.initializedPromise.then((function(){var e,t,n;return r.$preview=null,r._previewDocument=o,r._previewWindow=a,window._previewWindow=a,e=$(a.PDFViewerApplication.pdfViewer.container),t=function(){var t,n;if(!0===i.getApplicationProfileModel().get("syncScrollEditor")&&!y)return e.scrollTop(),t=function(e){var t;return e<=0?1:(D&&0!==D.length||(D=g(r.editorView,r,r.previewType)),t=0,_.find(D,(function(n){return t++,n>=e})),t=(t-=3)<0?0:t)}(function(e){var t,n,i,r;for(t=0,n=i=0,r=e;0<=r?i<=r:i>=r;n=0<=r?++i:--i)t+=a.PDFViewerApplication.pdfViewer.pages[n].height;return t}((n=a.PDFViewerApplication.pdfViewer._location).pageNumber-1)-n.top),r.$el.trigger("changeScrollTop",t)},n=_.throttle(t,100),r.syncEditor=n,e.on("scroll",n),$(a).on("resize",(function(){return r.resetScrollMap()})),$(window).trigger("changePreviewType","pdf"),"function"==typeof window.changeOpenTarget&&window.changeOpenTarget(o),r._compilePdfFile()}))}))},S.prototype.initHtmlPreview=function(e){var r,a,s,c;return null!=b&&b.destroyMinimap(),b=null,null!=(s=this.$loader)&&s.hide(),$(window).trigger("beforeChangePreviewType","normal",this.previewType),this.resetPreview(),this.previewType="normal",a=e?e():this.$el.find(".preview_wrapper").empty(),(r=$('<iframe allowfullscreen src="preview.html" class="preview_iframe" frameborder="0" style="width: 100%;height:100%;"></iframe>').appendTo(a)).one("load",(c=this,function(){var e,a,s,u,d,m,w,b;return a=r[0],u=a.contentDocument,d=a.contentWindow,i.getStyleText(c.fileModel,(function(e,t){return x.setCustomCss(t,u)})),c.$preview=$(u).find(".preview"),c._previewDocument=u,d.autoLoadRemoteResource=!0,c._previewWindow=d,window._previewWindow=d,d.requirejs("previews/preview")(d,window),c.$preview.on("click",".xiaoshujiang_code_container>.xiaoshujiang_code_buttons>.xiaoshujiang_code_collapse_button",(function(e){return $(e.currentTarget).parent().parent().addClass("xiaoshujiang_code_container_collapse")})),c.$preview.on("click",".xiaoshujiang_code_container>.xiaoshujiang_code_buttons>.xiaoshujiang_code_expand_button",(function(e){return $(e.currentTarget).parent().parent().removeClass("xiaoshujiang_code_container_collapse")})),c.$preview.on("click",".xiaoshujiang_code_container>.xiaoshujiang_code_buttons>.xiaoshujiang_code_run_button",(function(e){var t;return t=$(e.currentTarget).parent().parent(),x.runCodeChunk(t[0],c.fileModel)})),c.$preview.on("click",".xiaoshujiang_code_container>.xiaoshujiang_code_buttons>.xiaoshujiang_code_raw_button",(function(e){var t,n,i,r;return t=$(e.currentTarget),i=t.parent().parent().data("orign_code"),r=t.parent().parent().width(),n=(n=t.parent().parent().height())>400?400:n,PopupCenter("./code.html","\u5c0f\u4e66\u5320",r,n,(function(e){return $(e.document.body).text(i)}))})),c.$preview.on("click",".xiaoshujiang_code_container>.xiaoshujiang_code_buttons>.xiaoshujiang_code_copy_button",(function(e){var t;return t=$(e.currentTarget).parent().parent().data("orign_code"),document.execCommand("copy"),f.copyClipboard(t,{},(function(){return o.showMessage("\u5df2\u6210\u529f\u590d\u5236\u5230\u526a\u5207\u677f")}))})),c.$preview.on("click",".xiaoshujiang_code_container>.xiaoshujiang_code_buttons>.xiaoshujiang_code_download_button",(function(e){var t,n;return n=$(e.currentTarget).parent().parent().data("orign_code"),t=new Blob([n],{type:"text/plain;charset=utf-8"}),saveAs(t,"\u4ee3\u7801\u7247\u6bb5.txt")})),c.$preview.on("mousemove",(function(e){var t,n,i,r,o,a,s;return"A"===(o=e.target).tagName&&(r=(t=$(o)).attr("href"),t.hasClass("attachment")&&(r=""),r)?(v||(v=new l({$target:c.$el,previewWindow:d,previewDocument:u})),void(v.isShow(o)||(s=t.offset(),i={left:(n=c.$el.find(".preview_wrapper")[0]).offsetLeft,top:n.offsetTop},a={rect:{left:s.left+i.left,bottom:s.top+t.height()+i.top},link:r},v.show(o,a)))):null!=v?v.hide():void 0})),c.$preview.on("click",".xiaoshujiang_code_container>.xiaoshujiang_code_buttons>.xiaoshujiang_code_image_button",(function(e){var t,n,i,r,a,s;return n=$(e.currentTarget),a=[],$(c._previewDocument).find("style").each((function(e,t){return a.push($(t).text())})),t=n.parent().parent(),r=t.data("lang")||"\u4ee3\u7801\u6bb5",s=t.width(),i=(i=t.height())>400?400:i,PopupCenter("./image.html","\u5c0f\u4e66\u5320",s,i,(function(e){return $(e.document.head).append("<style type='text/css'>"+a.join("\n")+"</style>"),$(e.document.body).append(t.outerHTML()),e.converImage(null,(function(t,n){return e.close(),t?o.showMessage(t+"",6e3,"error"):h.blob2DataURL(n,(function(e,t){return p.showPopupView("image",{fileModel:null,link:t,operateType:"download",realFilename:r+".png",fileType:"image/png"})}))}))}))})),c.$preview.on("click",".story_image img, .xsj_svg_viewbox, .xsj_drawio_image_html, .mermaid_svg, svg.sequence, .xsj_flow>svg, .xsj_plantuml>svg, .xsj_wavedrom>svg, .MathJax_SVG_Display>.MathJax_SVG>svg",(function(e){var i,r,a,s,l,u,d,f,m;if(e.originalEvent.path)for(f=e.originalEvent.path,r=l=0,u=f.length;l<u&&(d=f[r]).tagName&&!(r>30)&&e.currentTarget.ownerDocument!==d;r=++l)if("A"===d.tagName.toUpperCase())return;return i=$(e.currentTarget),a=[],s=0,m=c,c.$preview.find(".story_image img, .xsj_svg_viewbox, .xsj_drawio_image_html, .mermaid_svg, svg.sequence, .xsj_flow>svg, .xsj_plantuml>svg, .xsj_wavedrom>svg, .MathJax_SVG_Display>.MathJax_SVG>svg").map((function(e,t){var n,o,l,c,u,d,p,f,h,m,v,g,_,w,y,b,x,k;if((o=$(t)).is(i)&&(s=e),"IMG"===(b=t.tagName.toUpperCase())){if(o.attr("src"))return a.push({title:o.attr("title")||o.attr("alt")||"",href:o.attr("src"),src:o.data("src")})}else if("SVG"===b){for(g=t,k=parseInt(g.width.baseVal.value,10),d=parseInt(g.height.baseVal.value,10),(w=g.id)&&(w=' id="'+w+'" '),(_=g.className.baseVal)&&(_=' class="'+_+'" '),g.viewBox&&(k=parseInt(g.viewBox.baseVal.width,10),d=parseInt(g.viewBox.baseVal.height,10)),m=g.textContent,u="",v="",x="",g.parentElement.classList.contains("xsj_wavedrom")&&(n=$(g.ownerDocument).find(".wavedrom_svg_defs"),u=(new XMLSerializer).serializeToString(n[0]),v=M()),g.parentElement.classList.contains("MathJax_SVG")&&(n=$(g.ownerDocument).find("#MathJax_SVG_glyphs"),u=(new XMLSerializer).serializeToString(n[0]),x=' viewBox="'+g.getAttribute("viewBox")+'" ',k=g.getAttribute("width"),d=g.getAttribute("height")),y="",h=g.children,r=p=0,f=h.length;p<f;r=++p)l=h[r],y+=(new XMLSerializer).serializeToString(l);return c="data:image/svg+xml,"+encodeURIComponent('<?xml version="1.0" encoding="utf-8" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 20010904//EN" "http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd"><svg xmlns="http://www.w3.org/2000/svg" '+w+_+x+' width="'+k+'" height="'+d+'" xmlns:xlink="http://www.w3.org/1999/xlink"><source><![CDATA['+m+"]]></source>"+v+u+y+"</svg>"),a.push({title:"",href:c,thumbnail:c,src:c})}})),t("../lib/dynamic_import/import_blueimp_gallery")((function(){return n=blueimp.Gallery(a,{index:s,slideLoadingClass:"ui loader slide-loading",onslide:function(e,t){var n,i,r,o;return n=$(this.container[0]),i=null,(o=a[e])&&(r=o.src,i=h.getExt(r,1).toUpperCase()),".JPG"===i||".JPEG"===i||".PNG"===i?n.find(".edit>i").show():n.find(".edit>i").hide()},onopen:function(){var e,t;return t=this,(e=$(t.container[0])).on("click",".rotate",(function(e){return e.preventDefault(),e.stopPropagation(),t.rotate(90)})),e.on("click",".edit",(function(e){var n,i,r;return e.preventDefault(),e.stopPropagation(),r=t.getIndex(),n=null,(i=a[r])&&(n=i.src),p.showPopupView("image",{fileModel:m.fileModel,link:decodeURI(n),operateType:"save"}),t.close()})),e.on("click",".download",(function(e){var n,i;return e.preventDefault(),e.stopPropagation(),i=t.getIndex(),n=a[i],h.getCrossOrignDomainResource(n.href,(function(t,i){var r,a,s;if(t)return o.showMessage("\u4e0b\u8f7d\u51fa\u9519:"+t,6e3,"error");a=h.dataURL2Blob(i),r=".png";try{n.src&&(r=h.getExt(n.src)),r||(r="."+i.split(";")[0].split("/")[1].split("+")[0])}catch(t){e=t,r=".png"}return s=n.title||"\u672a\u547d\u540d\u6587\u4ef6",saveAs(a,s+r)}))}))},onclosed:function(){var e;return(e=$(this.container[0])).off("click",".edit"),e.off("click",".rotate"),e.off("click",".download")}})}))})),c.$preview.on("click",".story_script_resource_placeholder",(function(e){var t;return t=$(e.currentTarget),x.replaceScriptResource(t,e)})),c.$preview.on("mouseenter","td",(function(){var e;return e=parseInt($(this).index())+1,$(this).closest("table").find("td:nth-child("+e+")").addClass("highlighted")})),c.$preview.on("mouseleave","td",(function(){var e;return e=parseInt($(this).index())+1,$(this).closest("table").find("td:nth-child("+e+")").removeClass("highlighted")})),e=c.$preview.parent(),w=function(){var t,n,r;if(!0===i.getApplicationProfileModel().get("syncScrollEditor")&&!y)return n=e.scrollTop(),t=n<=0?1:(D||(D=g(c.editorView,c,c.previewType)),r=0,_.find(D,(function(e){return r++,e>=n})),r=(r-=3)<0?0:r),c.$el.trigger("changeScrollTop",t)},b=_.throttle(w,100),c.syncEditor=b,e.on("scroll",b),$(d).on("resize",(function(){return c.resetScrollMap()})),$(window).trigger("changePreviewType","normal"),"function"==typeof window.changeOpenTarget&&window.changeOpenTarget(u),"client"===STORY_PLATFORM&&(s=u.createElement("script"),m=u.getElementsByTagName("script")[0],s.async=1,s.src="js/find-in-nw.js",m.parentNode.insertBefore(s,m),s.onload=function(){return d.findInNw.initialize()}),c._preview(),c.initMinimap()}))},S.prototype.initMinimap=function(){return m(this)},S.prototype.initPresetationPreview=function(e){var t,n,r,o;return null!=b&&b.destroyMinimap(),b=null,null!=(r=this.$loader)&&r.hide(),$(window).trigger("beforeChangePreviewType","presetation",this.previewType),this.resetPreview(),this.previewType="presetation",n=e?e():this.$el.find(".preview_wrapper").empty(),(t=$('<iframe allowfullscreen src="presetation.html" class="preview_iframe" frameborder="0" style="width: 100%;height:100%;"></iframe>').appendTo(n)).one("load",(o=this,function(){var e,n,r,a,s;return e=t[0],n=e.contentDocument,r=e.contentWindow,i.getStyleText(o.fileModel,(function(e,t){return x.setCustomCss(t,n)})),o.$preview=$(n).find(".slides"),o._previewDocument=n,r.autoLoadRemoteResource=!0,o._previewWindow=r,r.requirejs("previews/preview")(r,window),o.$preview.on("click",".story_script_resource_placeholder",(function(e){var t;return t=$(e.currentTarget),x.replaceScriptResource(t,e)})),a=function(e){var t;if(!0===i.getApplicationProfileModel().get("syncScrollEditor")&&!y)return t=function(e){var t;return e.indexh<=0?1:(D||(D=g(this.editorView,this.previewView,"presetation")),t=0,_.find(D,(function(n){return t++,n.indexh===e.indexh&&n.indexv===e.indexv})),t)}({indexh:e.indexh,indexv:e.indexv}),o.$el.trigger("changeScrollTop",t)},s=_.throttle(a,100),o.syncEditor=s,r.Reveal.addEventListener("slidechanged",s),$(r).on("resize",(function(){return o.resetScrollMap()})),$(window).trigger("changePreviewType","presetation"),"function"==typeof window.changeOpenTarget&&window.changeOpenTarget(n),o._preview()}))},S.prototype.pptMultiplex=function(){var e;return e=this.$el,(k=new c({previewView:this,fileModel:this.fileModel})).render(),e.append(k.$el),k.start()},S.prototype.setCustomCss=x.setCustomCss,S.prototype.getPreviewContainer=function(){return $(this._previewDocument).find("body>div>.preview").parent()},S.prototype.resetScrollMap=function(){return D=null,this.initMinimap()},S.prototype.syncEditor=function(){},S.prototype._initScrollSync=function(){var e,t,n,r;return e=null,r=this,t=function(t,n,o){var a,s,l,c,u,d;if(s=function(e){var t;for(t=e;t;){if("previewScrollSync"===t.type&&"preview"===t.xsjId)return!0;t=t.xsjOriginalEvent}return!1},(a=r.getPreviewContainer()).stop(),!r.isClosed()&&!0===i.getApplicationProfileModel().get("syncScrollPreview")&&!("object"==typeof t&&"changeCursor"===o&&window.event&&"input"===window.event.type||s(t)))switch(e=t,D&&0!==D.length||(D=g(r.editorView,r,r.previewType)),u=D[n],d=r._previewWindow,r.previewType){case"presetation":return d.Reveal.slide(u.indexh,u.indexv,u.indexf);case"pdf":return l=function(e){var t,n,i,r;for(t=n=0,i=(r=d.PDFViewerApplication.pdfViewer._pages).length;n<i;t=++n)if((e-=r[t].height)<=0){e=-e;break}return[t,{name:"XYZ"},0,e,0]}(u),d.PDFViewerApplication.pdfViewer.scrollPageIntoView({pageNumber:l[0]+1,destArray:l});default:return"changeCursor"===o&&(c=a.height(),n=r.editorView.getCursorPositionScreen(),u=D[n]-c/4),a.scrollTop(u)}},n=_.throttle(t,100,{leading:!1}),$(window).on("editorScrollSync",n),$(window).on("beforeChangePreviewType",(function(e,t,i,r){return D=null,y=!0,$(window).off("editorScrollSync",n)})),$(window).on("changePreviewType",(function(e,t,i){return D=null,y=!1,$(window).on("editorScrollSync",n)})),this.on("changeScrollTop",(function(t,n){var i;return i=$.Event("previewScrollSync",{xsjOriginalEvent:e,xsjId:"preview"}),$(window).trigger(i,n),e=null}))},S.prototype.initPreview=function(e,t,n){var r,o,l,c;return this.editorView=e,this._initScrollSync(),l=n[o=this.layoutPosition||this.model.get("previewLayoutPosition")||"east"],"free"===o&&(r=l,l=l.$el.find(".main_preview"),r.show()),this.layoutTargets=n,this.render(),l.append(this.$el),this.layout=t,this.previewButtonsView=new a({previewView:this}),this.previewControlButtonsView=new s({previewView:this}),this.$el.append(this.previewButtonsView.render().$el),this.$el.append(this.previewControlButtonsView.render().$el),this.isClosed()||this.startSyncPreview(this.layoutPosition,!0),this.listenTo(this.model,"previewConfigChanged",(c=this,function(){var e;return x.reInitMdHtml(),null!=(e=c.$preview)&&e.empty(),c._preview()})),this.listenTo(this.model,"change:codePreviewCss change:systemPreviewCss change:useSystemPreviewCss change:userPreviewCssText",function(e){return function(){return i.getStyleText(e.fileModel,(function(t,n){if(x.setCustomCss(n,e._previewDocument),b)return b.refreshMinimap()}))}}(this)),this.listenTo(this.model,"change:viewportWidth change:viewportAlign",function(e){return function(){return C(e.model.get("viewportWidth"),e.model.get("viewportAlign"),e.$el.find(".preview_wrapper"))}}(this)),this.listenTo(this.model,"change:aliasLang",(function(){return i.resetAliasLangMap()})),$(window).on("convertPreview",(function(e,t,n,r){var o,a,s;return n=$.extend({resetMdHtml:!0,netImage:!0,convertSvg:!0,convertFontIcon:!0,sourceMap:!1,needRenderPreview:!0,width:"100%",height:"100%"},n),0===(a=$("body>.preview_export_wrapper")).length&&(a=$('<div class="preview_export_wrapper"></div>').appendTo($("body"))),a.empty(),s='<iframe src="preview.html" frameborder="0" style="width: '+n.width+";height:"+n.height+';"></iframe>',(o=$(s).appendTo(a)).one("load",(function(){var e,s,l,c;return s=o[0],l=s.contentDocument,c=s.contentWindow,i.getStyleText(t,(function(e,t){return x.setCustomCss(t,l)})),e=$(l).find(".preview"),c.requirejs("previews/preview")(c,window),a=e.parent(),n.brand&&(e.addClass(n.brand),e.parent().addClass(n.brand+"_wrapper")),x.previewTarget(t,null,c,e,n,(function(){return x.initRemoteResource(l,t,null,c,n,(function(){var t;switch(n.changeOpenTarget&&x.formatLink(e,c),n.convertMathjaxEquationSvg=n.convertSvg,n.convertMathjaxEquationSvg&&(t=function(e,t,n){return e.split(" ").map((function(e,i){return i%2==0?parseFloat(e)*t:parseFloat(e)*n})).join(" ")},e.find(".mathjax-container>div.mathjax").map((function(e,n){var i,r,o,a,s,l,c,u,d,p,f,h,m,v,g,_,w,y;if(f=/{equation}|\\label|\\tag/gim,(s=$(n)).find(">script").text().match(f)&&1===(r=s.find(".MathJax_SVG_Display>.MathJax_SVG>svg")).length&&(r.attr("width"),y=r[0].getAttribute("viewBox"),w=(h=r[0]).getClientRects()[0],2===(o=r.find(">g>g")).length&&1===h.childElementCount&&2===h.children[0].childElementCount))return(c=o[0]).classList.add("equation_group"),(m=o[1]).classList.add("math_group"),p=((d=c.getClientRects()[0]).width+3)/w.width,u=(d.height+3)/w.height,_=(g=m.getClientRects()[0]).width/w.width,v=g.height/w.height,(a=$(h.cloneNode(!0))).attr("width",g.width+"px"),a.attr("height",g.height+"px"),a[0].setAttribute("viewBox",t(y,_,v)),a.find(">g>g.math_group").attr("transform","translate(0,0)"),a.find(">g>g.equation_group").remove(),a.attr("style",""),(i=$(h.cloneNode(!0))).attr("width",d.width+"px"),i.attr("height",d.height+"px"),i[0].setAttribute("viewBox",t(y,p,u)),i.find(">g>g.math_group").remove(),i.find(">g>g.equation_group").attr("transform","translate(-50,0)"),i.find(">g>g.equation_group>g").attr("transform","translate(0,-150)"),i.attr("style",""),(l=$('<table class="math_equation_table" style="border: 0;width:100%;">\n  <tr>\n    <td class="math_td">\n      <div class="MathJax_SVG_Display">\n        <span class="MathJax_SVG" role="math" style="font-size: 100%; display: inline-block;"></span>\n      </div>\n    </td>\n    <td class="equation_td" style="width: 30px;">\n      <div class="MathJax_SVG_Display" style="max-width: 30px;overflow: visible;direction: rtl;">\n        <span class="MathJax_SVG" role="math" style="font-size: 100%; display: inline-block; width: '+(d.width+10)+'px"></span>\n      </div>\n    </td>\n    </tr>\n</table>')).find(".math_td>.MathJax_SVG_Display>.MathJax_SVG").append(a),l.find(".equation_td>.MathJax_SVG_Display>.MathJax_SVG").append(i),s.find(".MathJax_SVG_Display").replaceWith(l)}))),n.type){case"dataURL":return x.convertFileSrcToDataURL(c,e,!!n.netImage,n.convertSvg,n.convertFontIcon,n,(function(e){return r(null,a)}));case"objectURL":return x.convertFileSrcToObjectURL(c,e,!!n.netImage,n.convertSvg,n.convertFontIcon,n,(function(e){return r(null,a)}));case"cidAndDataURL":return x.convertFileSrcToCidAndDataURL(c,e,!!n.netImage,n.convertSvg,n.convertFontIcon,n,(function(e,t,n){return r(null,a,t,n)}));default:return r(null,a)}}))}))}))})),u.initContextMenu(".main_preview_panel>.preview_wrapper")},S.prototype._preview=function(){var e,t;if(!$("#main").hasClass("sidebar_opened"))return!this.isClosed()&&this.fileModel&&this.$preview?(this.$previewLine.empty(),e={sourceMap:!0,previewType:this.previewType,needRenderPreview:!0,parseClientLocalMedias:!0,livePreview:!0},this._previewTarget(this._previewWindow,this.$preview,e,(t=this,function(e){var n,i;return n=t.$el.find(".preview_errors"),e?(i=e.html,n.html(i),n.addClass("preview_errors_show")):(n.removeClass("preview_errors_show"),n.empty()),"normal"===t.previewType&&$(t._previewDocument).find(".preview .xiaoshujiang_code_container").map((function(e,t){var n,i,r,o,a,s,l,c;if(!t.__isInited)return t.__isInited=!0,s=((i=$(t)).data("orign_code")||"").split("\n").length,l=i.data("title")||"",a=i.data("lang"),r=i.data("codechunk_lang"),i.data("codechunk_hide")?void 0:(o="",r&&(o='<a class="xiaoshujiang_code_run_button hljs-keyword xsj_code_btn" title="\u8fd0\u884c\u4ee3\u7801"><i class="fa fa-play"></i></a>'),c="",l||(c="xiaoshujiang_contain_title"),n=$('<div class="xiaoshujiang_code_buttons xiaoshujiang_element '+c+'">\n  <a class="xiaoshujiang_code_collapse_button hljs-keyword xsj_code_btn" title="\u6298\u53e0\u4ee3\u7801"><i class="far fa-minus-square"></i></a>\n  <a class="xiaoshujiang_code_expand_button hljs-keyword xsj_code_btn" title="\u5c55\u5f00\u4ee3\u7801"><i class="far fa-plus-square"></i></a>\n  <a class="xiaoshujiang_code_raw_button hljs-keyword xsj_code_btn" title="\u67e5\u770b\u539f\u6587"><i class="fa fa-code"></i></a>\n  <a class="xiaoshujiang_code_copy_button hljs-keyword xsj_code_btn" title="\u590d\u5236\u4ee3\u7801"><i class="far fa-copy"></i></a>\n  <a class="xiaoshujiang_code_download_button hljs-keyword xsj_code_btn" title="\u4e0b\u8f7d\u4ee3\u7801"><i class="fa fa-download"></i></a>\n  <a class="xiaoshujiang_code_image_button hljs-keyword xsj_code_btn" title="\u62cd\u7167\u6210\u4ee3\u7801\u56fe\u7247"><i class="fa fa-camera"></i></a>\n  '+o+'\n  <span class="xiaoshujiang_code_title">'+l+'</span>\n  <span class="xiaoshujiang_code_infos">'+a+"&nbsp;&nbsp;&nbsp;&nbsp;"+s+"\u884c</span>\n</div>"),i.prepend(n))})),"presetation"===t.previewType&&t._previewWindow.initRevealjs(),$(window).trigger("previewRendered"),t.resetScrollMap()}))):void 0;d=!0},S.prototype._previewTarget=function(e,t,n,i){return x.previewTarget(this.fileModel,this.model,e,t,n,i)},S.prototype.changeFileModel=function(e){var t,r;if(null!=n&&n.resetThumbnailCaches(),n=null,D=null,k&&(k.stop(),k=null),this.stopSyncPreview(),x.cleanCache(null,this.fileModel),this.fileModel=e,e&&this._previewDocument&&i.getStyleText(e,(r=this,function(e,t){return x.setCustomCss(t,r._previewDocument)})),this.startSyncPreview(this.layoutPosition,!0),"presentation"===(t=e.getMeta().preview_previewType||"normal")&&(t="presetation"),MINI_WEB&&(t="normal"),t!==this.previewType)switch(t){case"presetation":return this.initPresetationPreview();default:return this.initHtmlPreview()}},S.prototype.getTocHtml=function(){var e,t,n;return e=this.fileModel.get("content"),t=h.getHeadingInfo(e).headings,n=0,t.map((function(e){var t,i,r;if(r=[],e.level>n)for(i=e.level-n,t=0;t<i;)t++,r.push("<ul>"),n++;else if(e.level<n)for(i=n-e.level,t=0;t<i;)t++,r.push("</ul>"),n--;return(r=r.concat(['<li><a href="javascript:void(0)" data-line="',e.line,'">',_.escape(e.content),"</a></li>"])).join("")})).join("")+new Array(n+1).join("</ul>")},S.prototype.isClosed=function(){var e,t,n;return!(!(e=this.layout)||!e.center)&&(t=e.center.children.layout1,"free"!==(n=this.layoutPosition)?t.state[n].isClosed:this.layoutTargets[n].isClosed())},S.prototype.close=function(e){var t;return null==e&&(e=!0),"free"!==this.layoutPosition?(t=this.layout.center.children.layout1,e?t.hide(this.layoutPosition):t.close(this.layoutPosition)):this.layoutTargets[this.layoutPosition].close(),this.isSliding=!1,$(window).trigger("previewSlideStateChanged",!1)},S.prototype.containerSize=function(){var e;return"free"!==this.layoutPosition?{width:(e=this.layout.center.children.layout1).state[this.layoutPosition].innerWidth,height:e.state[this.layoutPosition].innerHeight,size:e.state[this.layoutPosition].size}:{width:this.$el.width,height:this.$el.height,size:0}},S.prototype.open=function(e){var t,n;return null==e&&(e=!1),"free"===this.layoutPosition?this.layoutTargets[this.layoutPosition].open():((t=this.layout.center.children.layout1).show(this.layoutPosition,e),this.isSliding&&(t.enableResizable(this.layoutPosition),t.enableClosable(this.layoutPosition),t.slideClose(this.layoutPosition),this.isSliding=!1,$(window).trigger("previewSlideStateChanged",!1)),e?(n=this.layoutPosition,setTimeout((function(){if(t.open(n),"object"==typeof e&&e.size)return t.sizePane(n,e.size)}),100)):void 0)},S.prototype.slideOpen=function(){var e,t;if("free"!==this.layoutPosition)return t=this.layout.center.state.innerWidth-20,(e=this.layout.center.children.layout1).slideOpen(this.layoutPosition),e.disableResizable(this.layoutPosition),e.disableClosable(this.layoutPosition),e.sizePane(this.layoutPosition,t),this.isSliding=!0,$(window).trigger("previewSlideStateChanged",!0)},S.prototype.mobileSlideOpen=function(){var e,t;if("free"!==this.layoutPosition)return t=this.layout.center.state.innerWidth-10,(e=this.layout.center.children.layout1).slideOpen(this.layoutPosition),e.sizePane(this.layoutPosition,t),this.isSliding=!0,$(window).trigger("previewSlideStateChanged",!0)},S.prototype.slideClose=function(){var e,t;if("free"!==this.layoutPosition)return e=this.layout.center.children.layout1,t=this.layout.center.state.innerWidth-20,e.sizePane(this.layoutPosition,t/2),e.enableResizable(this.layoutPosition),e.enableClosable(this.layoutPosition),e.slideClose(this.layoutPosition),e.hide(this.layoutPosition),this.isSliding=!1,$(window).trigger("previewSlideStateChanged",!1)},S.prototype.changeLayoutPosition=function(e){var t,n,i,r;if(null==e&&(e="east"),e!==this.layoutPosition){var o;switch(this.model.set("previewLayoutPosition",e),this.model.save(),i=this.layout.center.children.layout1,r=this.layoutTargets[e],"free"!==this.layoutPosition?i.hide(this.layoutPosition):((r=this.layoutTargets[this.layoutPosition]).hide(),n=r,r=r.$el.find(".main_preview")),this.layoutPosition=e,r="free"===this.layoutPosition?(n=r).$el.find(".main_preview"):this.layoutTargets[e],o=this,t=function(){var e;return o.$preview=null,o._previewDocument=null,o._previewWindow=null,window._previewWindow=null,e=o.$el.find(".preview_wrapper").empty(),o.$el.appendTo(r),e},this.previewType){case"pdf":this.initPdfPreview(t);break;case"presetation":this.initPresetationPreview(t);break;default:this.initHtmlPreview(t)}return"free"!==e?(i.show(e,!0),i.open(e)):n.show(),$(window).trigger("previewLayoutPositionChanged",e)}},S.prototype.on=function(e,t){return this.$el.on(e,t)},S.prototype.off=function(e,t){return this.$el.off(e,t)},S.prototype.stopSyncPreview=function(e){var t;if(!e||e===this.layoutPosition)return null!=(t=this.$preview)&&t.empty(),this.fileModel?this.stopListening(this.fileModel):void 0},S.prototype.startSyncPreview=function(e,t){var n,r;if(null==t&&(t=!1),t||!e||e===this.layoutPosition){try{this._preview()}catch(e){r=e,console.log(r)}var o;return n=_.debounce((o=this,function(){return o._preview()}),300),this.fileModel?(this.listenTo(this.fileModel,"change:content",n),this.listenTo(this.fileModel,"yamlChanged",function(e){return function(){var t;return null!=(t=e.$preview)&&t.empty(),e._preview()}}(this)),this.listenTo(this.fileModel,"repreview",(function(e){return n()})),this.listenTo(this.fileModel,"change:cssText",function(e){return function(){return i.getStyleText(e.fileModel,(function(t,n){if(x.setCustomCss(n,e._previewDocument),b)return b.refreshMinimap()}))}}(this))):void 0}},S}(v),n.exports=d}}),window.requirejs.define({"views/preview_viewer_manager_view":function(e,t,n){var i,r,o,a,s,l,c,u=function(e,t){return function(){return e.apply(t,arguments)}},d={}.hasOwnProperty;s=t("./view"),i=t("../application"),r=t("../lib/notifier"),a=t("./preview_viewer_view"),l=t("./templates/preview_viewer_manager_view"),c=null,o=function(e){function t(){return this.createNewExternalPreviewWindow=u(this.createNewExternalPreviewWindow,this),t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)d.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.template=l,t.prototype.className="preview_viewer_manager_view",t.prototype.nextId=1,t.prototype.previewViewers={},t.prototype.initialize=function(e){return c=this,this.previewView=e.previewView,$(window).on("createNewExternalPreviewWindow",this.createNewExternalPreviewWindow)},t.prototype.createNewExternalPreviewWindow=function(){var e;if(!(Object.keys(this.previewViewers).length>5))return $(window).width()/2,$(window).height()/2,e=c.nextId,c.nextId++,new a({model:this.model,syncScrollPreview:i.getApplicationProfileModel().get("syncScrollPreview"),syncScrollEditor:i.getApplicationProfileModel().get("syncScrollEditor"),fileModel:this.previewView.fileModel,previewType:this.previewView.previewType,editorView:this.previewView.editorView,nextId:e,previewViewerManagerView:this}).initPreview();r.showMessage("\u65e0\u6cd5\u518d\u521b\u5efa\u66f4\u591a\u7684\u65b0\u9884\u89c8\u7a97\u53e3\u4e86",6e3,"error")},t}(s),n.exports=o}}),window.requirejs.define({"views/preview_viewer_view":function(e,t,n){var i,r,o,a,s,l,c=function(e,t){return function(){return e.apply(t,arguments)}},u={}.hasOwnProperty;o=t("./view"),i=t("../application"),t("../lib/notifier"),l=t("./templates/preview_viewer_view"),s=t("../lib/preview_core"),a=function(e,t,n){var i,r,o,a,s,l,c,u,d,p,f,h,m,v,g,_,w,y,b,x,k,D;switch(n){case"presetation":return r=[],f=e.getLength(),k=0,i=t.getPreviewContainer(),x=i.find("section.section_content"),d=x.length,x.each((function(e,t){var n,i,o,a,s,l;for(l=(n=$(t)).data("line"),0!==k&&(k=l),o=e+1>=d?f:$(x[e+1]).data("line")-1,i=a=k,s=o;a<=s?i<=s:i>=s;a<=s?++i:--i)r.push({indexh:n.data("indexh"),indexv:n.data("indexv"),indexf:n.data("indexf")});return k=l})),r;default:for((i=t.getPreviewContainer()).height(),h=[],r=[],m=[],v=i.scrollTop(),f=e.getLength(),_=e.getScreenLength(),D=0,p=l=0,w=f-1;0<=w?l<=w:l>=w;p=0<=w?++l:--l)h.push(D),D+=e.getRowLength(p);for(h.push(D),s=c=0,y=_-1;0<=y?c<=y:c>=y;s=0<=y?++c:--c)r.push(-1);for(m.push(0),r[0]=0,i.find("[data-source-line]").each((function(e,t){var n,i;if(""!==(i=(n=$(t)).attr("data-source-line"))&&(i=h[i],!(m.indexOf(i)>=0)))return 0!==i&&m.push(i),r[i]=Math.round(n.offset().top+v)})),m.push(_),r[_]=i[0].scrollHeight,g=0,s=u=1,b=_-1;1<=b?u<=b:u>=b;s=1<=b?++u:--u)-1===r[s]?(o=m[g],a=m[g+1],r[s]=Math.round((r[a]*(s-o)+r[o]*(a-s))/(a-o))):g++;return r}},r=function(e){function t(){return this._changeFileModel=c(this._changeFileModel,this),this.resetScrollMap=c(this.resetScrollMap,this),t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)u.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.template=l,t.prototype.className="preview_viewer_view",t.prototype.scrollMap=null,t.prototype.isChangingPreviewType=!1,t.prototype.initialize=function(e){var t;return this,this.syncScrollEditor=e.syncScrollEditor,this.syncScrollPreview=e.syncScrollPreview,this.editorView=e.editorView,this.previewType=e.previewType,this.nextId=e.nextId,this.fileModel=e.fileModel,this.previewViewerManagerView=e.previewViewerManagerView,this.listenTo(this.model,"change:codePreviewCss change:systemPreviewCss change:useSystemPreviewCss change:userPreviewCssText",(t=this,function(){if(t.previewDocument)return i.getStyleText(t.fileModel,(function(e,n){return s.setCustomCss(n,t.previewDocument)}))})),$(window).on("fileModelChanged",this._changeFileModel),this.startSyncPreview()},t.prototype.getPreviewContainer=function(){return this,$(this.previewDocument).find("body>div>.preview").parent()},t.prototype.resetScrollMap=function(){return this,this.scrollMap=null},t.prototype.syncEditor=function(){},t.prototype._initScrollSync=function(){var e,t,n,i,r;return n=this,e=null,r=this,t=function(t,i,o){var s,l,c,u,d,p;if(r.previewWindow&&(l=function(e){var t;for(t=e;t;){if("previewScrollSync"===t.type&&t.xsjId==="previewViewer_"+n.nextId)return!0;t=t.xsjOriginalEvent}return!1},(s=r.getPreviewContainer()).stop(),!0===n.syncScrollPreview&&!("object"==typeof t&&"changeCursor"===o&&window.event&&"input"===window.event.type||l(t))))switch(e=t,n.scrollMap||(n.scrollMap=a(r.editorView,r,r.previewType)),d=n.scrollMap[i],p=r.previewWindow,r.previewType){case"presetation":return p.Reveal.slide(d.indexh,d.indexv,d.indexf);case"pdf":return c=function(e){var t,n,i,r;for(t=n=0,i=(r=p.PDFViewerApplication.pdfViewer.pages).length;n<i;t=++n)if((e-=r[t].height)<=0){e=-e;break}return[t,{name:"XYZ"},0,e,0]}(d),p.PDFViewerApplication.pdfViewer.scrollPageIntoView(c[0]+1,c);default:return"changeCursor"===o&&(u=s.height(),i=r.editorView.getCursorPositionScreen(),d=n.scrollMap[i]-u/4),s.scrollTop(d)}},i=_.throttle(t,100,{leading:!1}),this.syncPreview=i,this.beforeChangePreviewTypeFn=function(e,t,i,r){return n.scrollMap=null,n.isChangingPreviewType=!0,$(window).off("editorScrollSync",n.syncPreview)},this.changePreviewTypeFn=function(e,t,i){return n.scrollMap=null,n.isChangingPreviewType=!1,$(window).on("editorScrollSync",n.syncPreview)},$(window).on("editorScrollSync",this.syncPreview),$(window).on("beforeChangePreviewType",this.beforeChangePreviewTypeFn),$(window).on("changePreviewType",this.changePreviewTypeFn),this.on("changeScrollTop",(function(t,i){var r;return r=$.Event("previewScrollSync",{xsjOriginalEvent:e,xsjId:"previewViewer_"+n.nextId}),$(window).trigger(r,i),e=null}))},t.prototype.initOpenerWindow=function(e){var t,n,i;if(i=this,e.document,(n=e.$)(".sync_scroll_preview_button").on("click",(function(e){var t;return t=n(e.currentTarget),i.syncScrollPreview=!i.syncScrollPreview,i.syncScrollPreview?(i.syncPreview(),t.addClass("active")):t.removeClass("active")})),n(".sync_scroll_editor_button").on("click",(function(e){var t;return t=n(e.currentTarget),i.syncScrollEditor=!i.syncScrollEditor,i.syncScrollEditor?(i.syncEditor(),t.addClass("active")):t.removeClass("active")})),i.syncScrollPreview&&n(".sync_scroll_preview_button").addClass("active"),i.syncScrollEditor&&n(".sync_scroll_editor_button").addClass("active"),(t=n(".top_button")).hide(),"client"===STORY_PLATFORM)return t.show(),t.on("click",(function(n){var i;return i=e.nw.Window.get(),t.hasClass("active")?(t.removeClass("active"),i.setAlwaysOnTop(!1)):(t.addClass("active"),i.setAlwaysOnTop(!0))}))},t.prototype.showLoader=function(){var e;return this,(e=this.openerWindow.$)("#loader-wrapper").show(),e(".application_dimmer").show()},t.prototype.hideLoader=function(){var e;return this,(e=this.openerWindow.$)("#loader-wrapper").hide(),e(".application_dimmer").hide()},t.prototype.initPreview=function(){var e,t,n,i,r;return i=this,this._initScrollSync(),r=$(window).width()/2,e=$(window).height()/2,n=i.previewType,t=i.nextId,PopupCenter("viewer.html","xsj_"+t,r,e,(function(e){var r,o,a;return e.GLOBALID="xsj_"+t,i.openerWindow=e,i.render(),i.previewViewerManagerView.$el.append(i.$el),i.previewViewerManagerView.previewViewers[t]=i,r=e.$,i.initOpenerWindow(e),"presetation"===n?(a=r(".xsj_viewer"),(o=r('<iframe allowfullscreen src="presetation.html" class="preview_iframe" frameborder="0" style="width: 100%;height:100%;"></iframe>').appendTo(a)).one("load",(function(){var n;return n=o[0].contentWindow,i._initPresetationPreviewOnload(e,n,t),i.hideLoader()}))):(a=r(".xsj_viewer"),(o=r('<iframe allowfullscreen src="preview.html" class="preview_iframe" frameborder="0" style="width: 100%;height:100%;"></iframe>').appendTo(a)).one("load",(function(){var n;return n=o[0].contentWindow,i.previewWindow=n,i.previewDocument=n.document,n.autoLoadRemoteResource=!0,i._initHtmlPreviewOnload(e,n,t),i.hideLoader()})))}),(function(e){var n;if(e.GLOBALID)return console.log("before unload external viewer"),delete i.previewViewerManagerView.previewViewers[t],console.log("unload external viewer"),$(window).off("fileModelChanged",i._changeFileModel),i.syncPreview&&($(window).off("editorScrollSync",i.syncPreview),i.syncPreview=null),i.beforeChangePreviewTypeFn&&($(window).off("beforeChangePreviewType",i.beforeChangePreviewTypeFn),i.beforeChangePreviewTypeFn=null),i.changePreviewTypeFn&&($(window).off("changePreviewType",i.changePreviewTypeFn),i.changePreviewTypeFn=null),i.off("changeScrollTop"),i.stopSyncPreview(),(n=i.$target).empty(),n.parentsUntil("html").remove(),i.remove(),i=null,null}))},t.prototype.stopSyncPreview=function(){if(this,this.$target.empty(),this.fileModel)return this.stopListening(this.fileModel)},t.prototype._preview=function(){var e,t,n,i,r;if(i=(r=this).previewWindow,t=r.previewDocument,i&&r.fileModel)return e=r.$target,n={sourceMap:!0,previewType:r.previewType,needRenderPreview:!0,parseClientLocalMedias:!0,livePreview:!0},s.previewTarget(r.fileModel,null,i,e,n,(function(e){return"normal"===r.previewType&&$(t).find(".preview .xiaoshujiang_code_container").map((function(e,t){var n,i,r,o,a,s,l,c;if(!t.__isInited)return t.__isInited=!0,s=((i=$(t)).data("orign_code")||"").split("\n").length,l=i.data("title")||"",a=i.data("lang"),r=i.data("codechunk_lang"),i.data("codechunk_hide")?void 0:(o="",r&&(o='<a class="xiaoshujiang_code_run_button hljs-keyword" title="\u8fd0\u884c\u4ee3\u7801"><i class="fa fa-play"></i></a>'),c="",l||(c="xiaoshujiang_contain_title"),n=$('<div class="xiaoshujiang_code_buttons xiaoshujiang_element '+c+'">\n  <a class="xiaoshujiang_code_collapse_button hljs-keyword" title="\u6298\u53e0\u4ee3\u7801"><i class="fa fa-minus-square-o"></i></a>\n  <a class="xiaoshujiang_code_expand_button hljs-keyword" title="\u5c55\u5f00\u4ee3\u7801"><i class="fa fa-plus-square-o"></i></a>\n  <a class="xiaoshujiang_code_raw_button hljs-keyword" title="\u67e5\u770b\u539f\u6587"><i class="fa fa-code"></i></a>\n  <a class="xiaoshujiang_code_download_button hljs-keyword" title="\u4e0b\u8f7d\u4ee3\u7801"><i class="fa fa-download"></i></a>\n  <a class="xiaoshujiang_code_image_button hljs-keyword" title="\u62cd\u7167\u6210\u4ee3\u7801\u56fe\u7247"><i class="fa fa-camera"></i></a>\n  '+o+'\n  <span class="xiaoshujiang_code_title">'+l+'</span>\n  <span class="xiaoshujiang_code_infos">'+a+"&nbsp;&nbsp;&nbsp;&nbsp;"+s+"\u884c</span>\n</div>"),i.prepend(n))})),"presetation"===r.previewType&&i.initRevealjs(),r.resetScrollMap()}))},t.prototype.startSyncPreview=function(){var e,t,n,r;n=this;try{n._preview()}catch(e){t=e,console.log(t)}if(e=_.debounce((function(){return n._preview()}),n.model.get("delay")),this.fileModel)return this.listenTo(this.fileModel,"change:content",e),this.listenTo(this.fileModel,"repreview",(function(t){return e()})),this.listenTo(this.fileModel,"change:cssText",(r=this,function(){return i.getStyleText(r.fileModel,(function(e,t){return s.setCustomCss(t,n.previewDocument)}))}))},t.prototype._initPresetationPreviewOnload=function(e,t,n){var r,o,l,c,u,d;return(u=this).previewWindow=t,u.previewDocument=t.document,t.autoLoadRemoteResource=!0,u.previewType="presetation",t.requirejs("previews/preview")(t),o=u.fileModel,l=t.document,i.getStyleText(o,(function(e,t){return s.setCustomCss(t,l)})),r=$(l).find(".slides"),u.$target=r,r.on("click",".story_script_resource_placeholder",(function(e){var t;return t=$(e.currentTarget),s.replaceScriptResource(t,e)})),u.scrollMap=null,c=function(e){var t;if(!0===u.syncScrollEditor&&!u.isChangingPreviewType)return n={indexh:e.indexh,indexv:e.indexv},t=n.indexh<=0?1:(u.scrollMap||(u.scrollMap=a(u.editorView,u,u.previewType)),i=0,_.find(u.scrollMap,(function(e){return i++,e.indexh===n.indexh&&e.indexv===n.indexv})),i),u.$el.trigger("changeScrollTop",t);var n,i},d=_.throttle(c,100),u.syncEditor=d,t.Reveal.addEventListener("slidechanged",d),u._preview()},t.prototype._initHtmlPreviewOnload=function(e,t,n){var r,o,l,c,u,d,p;return(d=this).previewWindow=t,d.previewDocument=t.document,t.autoLoadRemoteResource=!0,d.previewType="normal",t.requirejs("previews/preview")(t),l=d.fileModel,c=t.document,o=$(c).find(".preview"),d.$target=o,o.on("click",".xiaoshujiang_code_container>.xiaoshujiang_code_buttons>.xiaoshujiang_code_collapse_button",(function(e){return(o=$(e.currentTarget)).parent().parent().addClass("xiaoshujiang_code_container_collapse")})),o.on("click",".xiaoshujiang_code_container>.xiaoshujiang_code_buttons>.xiaoshujiang_code_expand_button",(function(e){return(o=$(e.currentTarget)).parent().parent().removeClass("xiaoshujiang_code_container_collapse")})),o.on("click",".xiaoshujiang_code_container>.xiaoshujiang_code_buttons>.xiaoshujiang_code_run_button",(function(e){var t;return t=(o=$(e.currentTarget)).parent().parent(),s.runCodeChunk(t[0],l)})),o.on("click",".xiaoshujiang_code_container>.xiaoshujiang_code_buttons>.xiaoshujiang_code_raw_button",(function(e){var t,n,i;return o=$(e.currentTarget),n=o.parent().parent().data("orign_code"),i=o.parent().parent().width(),t=(t=o.parent().parent().height())>400?400:t,PopupCenter("./code.html","\u5c0f\u4e66\u5320",i,t,(function(e){return $(e.document.body).text(n)}))})),o.on("click",".xiaoshujiang_code_container>.xiaoshujiang_code_buttons>.xiaoshujiang_code_download_button",(function(t){var n,i;return i=(o=$(t.currentTarget)).parent().parent().data("orign_code"),"\u4ee3\u7801\u7247\u6bb5.txt",n=new Blob([i],{type:"text/plain;charset=utf-8"}),e.saveAs(n,"\u4ee3\u7801\u7247\u6bb5.txt")})),o.on("click",".xiaoshujiang_code_container>.xiaoshujiang_code_buttons>.xiaoshujiang_code_image_button",(function(t){var n,i,r,a,s;return o=$(t.currentTarget),a=[],$(c).find("style").each((function(e,t){return a.push($(t).text())})),n=o.parent().parent(),r=n.data("lang")||"\u4ee3\u7801\u6bb5",s=n.width(),i=(i=n.height())>400?400:i,PopupCenter("./image.html","\u5c0f\u4e66\u5320",s,i,(function(t){return $(t.document.head).append("<style type='text/css'>"+a.join("\n")+"</style>"),$(t.document.body).append(n.outerHTML()),t.converImage(null,(function(n,i){return t.close(),n?alert(n):e.saveAs(i,r+".png")}))}))})),o.on("click",".story_image img",(function(t){var n,i,r;return n=$(t.currentTarget),i=[],r=0,o.find(".story_image img").map((function(e,t){var o;if((o=$(t)).is(n)&&(r=e),o.attr("src"))return i.push({title:o.attr("title")||o.attr("alt")||"",href:o.attr("src")})})),e._blueimp=e.blueimp.Gallery(i,{index:r,slideLoadingClass:"ui loader slide-loading"})})),o.on("click",".story_script_resource_placeholder",(function(e){var t;return t=$(e.currentTarget),s.replaceScriptResource(t,e)})),i.getStyleText(l,(function(e,t){return s.setCustomCss(t,c)})),r=o.parent(),u=function(){var e;if(!0===d.syncScrollEditor&&!d.isChangingPreviewType)return t=r.scrollTop(),e=t<=0?1:(d.scrollMap||(d.scrollMap=a(d.editorView,d,d.previewType)),n=0,_.find(d.scrollMap,(function(e){return n++,e>=t})),n=(n-=3)<0?0:n),d.$el.trigger("changeScrollTop",e);var t,n},p=_.throttle(u,100),this.syncEditor=p,r.on("scroll",p),$(t).on("resize",(function(){return d.scrollMap=null})),d._preview()},t.prototype._changeFileModel=function(e,t){var n,r,o,a,l,c,u,d,p,f,h;if((l=(f=this).openerWindow._blueimp)&&(l.close(),l.resetThumbnailCaches(),f.openerWindow._blueimp=null),f.scrollMap=null,this.stopSyncPreview(),this.fileModel=t,i.getStyleText(t,(h=this,function(e,t){return s.setCustomCss(t,h.previewDocument)})),this.startSyncPreview(),"presentation"===(d=t.getMeta().preview_previewType||"normal")&&(d="presetation"),r=(u=f.openerWindow).$,p=f.previewWindow,f.previewDocument,n=f.$target,c=f.nextId,d!==this.previewType)switch(n.empty(),n.parentsUntil("html").remove(),(a=r(".xsj_viewer")).empty(),f.showLoader(),d){case"presetation":return(o=r('<iframe allowfullscreen src="presetation.html" class="preview_iframe" frameborder="0" style="width: 100%;height:100%;"></iframe>').appendTo(a)).one("load",(function(){var e;return e=o[0],p=e.contentWindow,f._initPresetationPreviewOnload(u,p,c),f.hideLoader()}));default:return(o=r('<iframe allowfullscreen src="preview.html" class="preview_iframe" frameborder="0" style="width: 100%;height:100%;"></iframe>').appendTo(a)).one("load",(function(){var e;return e=o[0],p=e.contentWindow,f._initHtmlPreviewOnload(u,p,c),f.hideLoader()}))}},t.prototype.on=function(e,t){return this,this.$el.on(e,t)},t.prototype.off=function(e,t){return this,this.$el.off(e,t)},t}(o),n.exports=r}}),window.requirejs.define({"views/public_email_dialog_view":function(e,t,n){var i,r,o,a,s,l,c,u={}.hasOwnProperty;s=t("./view"),a=t("../lib/utils"),r=t("../lib/notifier"),i=t("../application"),l=t("./templates/public_email_dialog"),c=null,o=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)u.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.template=l,t.prototype.className="ui standard story_modal modal",t.prototype.moreAttachments=[],t.prototype.events={"click .drop-zone":"selectFileFn","click .delete_attachment":"deleteAttachmentFn","change input[name=mainBody]":"changeMainBodyFn","click input[name=separateTo]":"toggleSeparateToFn"},t.prototype.toggleSeparateToFn=function(e){return $(e.currentTarget).is(":checked")?c.$el.find(".cc_email_container, .bcc_email_container").addClass("disabled"):c.$el.find(".cc_email_container, .bcc_email_container").removeClass("disabled")},t.prototype.changeMainBodyFn=function(e){var t,n;return n=$(e.currentTarget).val(),t=c.$el.find(".user_main_body_container"),"user"===n?t.removeClass("hide"):t.addClass("hide")},t.prototype.deleteAttachmentFn=function(e){var t,n;return n=(t=$(e.currentTarget).parent()).data("pos"),t.remove(),c.moreAttachments[n]=null},t.prototype.selectFileFn=function(){return c.$el.find("input[name=fileData]").trigger("click")},t.prototype.publicEmailFile=function(e,t){var n,o,s,l;return this.dimmer.dimmer("show"),n=function(n,i){var o,s,l,u,d,p,f,h,m,v,g,w,y;if(p=i[0],h=i[1],w=i[2],s=p.attachmentMap||{},!n){switch(l=[],d={to:e.email,cc:e.ccEmail,bcc:e.bccEmail,filename:e.subject||c.model.get("title"),attachmentMap:s},e.mainBody){case"user":g=e.userMainBody;break;case"markdown":g=c.model.get("content")||"",g=(g=_.escape(g)).split("\n").join("<br>");break;case"png":s[u="xsj_png"]={cid:u,filename:"xsj_png.png",path:"data:image/png;base64,"+w.base64},g="<p><img src='cid:"+u+"'/></p>";break;default:g=p.content}if(e.attachmentMarkdown&&l.push({filename:c.model.get("title")+".md",content:c.model.get("content")}),e.attachmentPreview&&l.push({filename:c.model.get("title")+".html",encoding:"base64",content:h.base64}),e.attachmentPng&&l.push({filename:c.model.get("title")+".png",encoding:"base64",content:w.base64}),c.moreAttachments&&c.moreAttachments.length>0)for(m=0,v=(y=c.moreAttachments).length;m<v;m++)(o=y[m])&&l.push({filename:o.filename,encoding:"base64",content:o.datauri.split(",")[1]});return d.attachments=l,e.separateTo?(f=e.email.split(","),async.mapLimit(f,10,(function(e,t){var n;return n={},_.extend(n,d,{to:e,cc:"",bcc:""}),a.publicEmailFile(g,n,(function(n){return n?r.showMessage("\u53d1\u9001\u7ed9'"+_.escape(e)+"'\u5931\u8d25\uff1a"+n,6e3,"error"):r.showMessage("\u53d1\u9001\u7ed9'"+_.escape(e)+"'\u6210\u529f\uff1a"),t()}))}),(function(e,n){return c.dimmer.dimmer("hide"),t(e)}))):a.publicEmailFile(g,d,(function(e){return c.dimmer.dimmer("hide"),t(e)}))}t(n)},o=function(t){var n,r;return"preview"!==e.mainBody?t(null,{attachmentMap:{}}):(r=c.model,n={type:"cidAndDataURL",netImage:!0,changeOpenTarget:!0,parseClientLocalMedias:!0,brand:"xsj_email_content"},e.numberedHeading&&(n.renderNumberedHeading=!0),$(window).trigger("convertPreviewFormatForExport",[r,n,function(e,n,o,s){return n.find(".li_linenum").addClass("li_list_style"),n.find(".li_linenum_before_span_hide").remove(),i.getStyleText(r,(function(e,i){return a.inlineStylesheet(n.html(),i,(function(e,n){return t(e,{content:n,type:"text",attachmentMap:o})}))}))}]))},s=function(t){var n,r;return e.attachmentPreview?(r=c.model,n={type:"dataURL",netImage:!0,changeOpenTarget:!0,parseClientLocalMedias:!0,brand:"xsj_email_html"},$(window).trigger("convertPreviewFormatForExport",[r,n,function(e,o){return i.getStyleText(r,(function(e,i){return a.exportHtmlFile(o,r.get("title"),i,n,(function(e,n,i){return a.blob2Base64(n,(function(e,n){return t(e,{base64:n,type:"base64"})}))}))}))}])):t(null,null)},l=function(t){var n,i;return"png"===e.mainBody||e.attachmentPng?(i=c.model,n={type:"dataURL",netImage:!0,changeOpenTarget:!1,parseClientLocalMedias:!0,convertSvg:!1,brand:"xsj_email_picture"},$(window).trigger("convertPreviewFormatForExport",[i,n,function(e,n){var i,r,o;return r=n[0].ownerDocument.documentElement,(i=$(r)).addClass("xiaoshujiang_camera"),(o=i.find(".xiaoshujiang_element")).addClass("xiaoshujiang_element_hide"),domtoimage.toBlob(r).then((function(e){return i.removeClass("xiaoshujiang_camera"),o.removeClass("xiaoshujiang_element_hide"),watermark([e]).blob(watermark.text.lowerRight("\u4e66","bold 48px webfontxiaoshujiang","#2f2f2f",.5))})).then((function(e){return a.blob2Base64(e,(function(e,n){return watermark.destroy(),t(e,{base64:n,type:"base64"})}))})).catch((function(e){return i.removeClass("xiaoshujiang_camera"),o.removeClass("xiaoshujiang_element_hide"),t(e)}))}])):t(null,null)},async.series([o,s,l],n)},t.prototype.show=function(){var e,t,n,i,o,s,l;return c=this,this.render(),(l=localStorage.public_email_data)&&(s=JSON.parse(l)),this.dimmer=a.xsjDimmer(this.$el),e=this.$el,n=c.$el.find(".more_attachments"),i=function(e,t){var i,r;return i=t.name,r=c.moreAttachments.push({filename:i,datauri:e}),n.append('<div class="ui label" data-pos="'+(r-1)+'">'+i+'<i class="close icon delete_attachment link"></i></div>')},o=function(e){return async.eachSeries(e,(function(e,t){return a.insertImageFile([e],(function(e,n,r){return i(e,r),t()}))}),(function(e){if(e)return console.log(e),r.showMessage(""+e,6e3,"error")}))},a.initdragFilesSupport(e.find(".drop-zone"),o),a.initFileImportSupport(e.find('input[type="file"]'),o),t=e.find(".ui.form"),s||(s={}),s.mainBody="preview",s.separateTo="",t.deserialize(s),t.find("input[name=subject]").val(c.model.get("title")),t.form({fields:{email:{identifier:"email",rules:[{type:"empty",prompt:"\u90ae\u4ef6\u5730\u5740\u4e0d\u80fd\u4e3a\u7a7a"},{type:"xsjEmail",prompt:'\u8bf7\u8f93\u5165\u5408\u6cd5\u7684\u90ae\u4ef6\u5730\u5740 xxx@xxx.xx \u6216\u8005 "xxx" &lt;xxx@xxx.com&gt;'}]},ccEmail:{identifier:"ccEmail",optional:!0,rules:[{type:"xsjEmail",prompt:'\u8bf7\u8f93\u5165\u5408\u6cd5\u7684\u90ae\u4ef6\u5730\u5740 xxx@xxx.xx \u6216\u8005 "xxx" &lt;xxx@xxx.com&gt;'}]},bccEmail:{identifier:"bccEmail",optional:!0,rules:[{type:"xsjEmail",prompt:'\u8bf7\u8f93\u5165\u5408\u6cd5\u7684\u90ae\u4ef6\u5730\u5740 xxx@xxx.xx \u6216\u8005 "xxx" &lt;xxx@xxx.com&gt;'}]}},onSuccess:function(){var n,i;return i=t.serializeObject(),localStorage.public_email_data=JSON.stringify(i),n={subject:e.find("input[name=subject]").val().trim(),email:e.find("input[name=email]").val().trim(),ccEmail:e.find("input[name=ccEmail]").val().trim(),bccEmail:e.find("input[name=bccEmail]").val().trim(),mainBody:e.find("input[name=mainBody]:checked").val(),userMainBody:e.find("textarea[name=userMainBody]").val().trim(),attachmentMarkdown:e.find("input[name=attachmentMarkdown]").is(":checked"),numberedHeading:e.find("input[name=numberedHeading]").is(":checked"),attachmentPreview:e.find("input[name=attachmentPreview]").is(":checked"),attachmentPng:e.find("input[name=attachmentPng]").is(":checked"),separateTo:e.find("input[name=separateTo]").is(":checked")},c.publicEmailFile(n,(function(e){return e?(r.showMessage("\u53d1\u9001\u5931\u8d25\uff1a"+e,6e3,"error"),c.dimmer.dimmer("hide")):(r.showMessage("\u53d1\u9001\u5b8c\u6210"),c.dimmer.dimmer("hide"))}))}}),this.$el.modal({closable:!1,onHidden:function(){var e,n,i;return(e=$("body>.preview_export_wrapper>iframe")).length>0&&(n=e[0].contentDocument,i=e[0].contentWindow,$(n.body).remove(),$(n).off(),$(i).off()),$("body>.preview_export_wrapper").remove(),t.form("destroy"),c.$el.modal("destroy"),c.moreAttachments.length=0,c.remove(),c=null},onApprove:function(){return t.form("validate form"),!1}}).modal("show")},t}(s),n.exports=o}}),window.requirejs.define({"views/public_file_dialog_view":function(e,t,n){var i,r,o,a,s=function(e,t){return function(){return e.apply(t,arguments)}},l={}.hasOwnProperty;o=t("./view"),t("../lib/notifier"),t("../lib/utils"),i=t("../application"),a=t("./templates/public_file_dialog"),r=function(e){function t(){return this.publicFile=s(this.publicFile,this),t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)l.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.template=a,t.prototype.className="ui modal standard",t.prototype.initialize=function(){return this.publicPlugins=i.publicPlugins},t.prototype.events={"click .public_button":"publicFile"},t.prototype.afterRender=function(){var e,t,n,i,r;for(t in e=this.$el.find(".cards"),r=[],i=this.publicPlugins)n=i[t],r.push(e.append('<div class="card ui">\n    <div class="content" data-value="'+n.name+'">\n      <div class="header">'+n.displayName+'</div>\n      <div class="description">\n      '+n.description+'\n      </div>\n    </div>\n    <div class="ui bottom attached button public_button" data-value="'+n.name+'">\n      <i class="add icon"></i>\n      \u53d1\u5e03\n    </div>\n  </div>'));return r},t.prototype.publicFile=function(e){var t,n;if(n=$(e.currentTarget).data("value"),t=i.getPlugin(n,"public"))return t.publicFile(i.homeView.fileModel)},t.prototype.show=function(){return this.render(),this.$el.modal({closable:!1,allowMultiple:!0,onHidden:(e=this,function(){return e.remove()})}).modal("show");var e},t}(o),n.exports=r}}),window.requirejs.define({"views/pwa_install_dialog_view":function(e,t,n){var i,r,o,a,s={}.hasOwnProperty;r=t("./view"),o=t("./templates/pwa_install_dialog"),a=null,i=function(e){var t,n,i,r;function l(){return l.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)s.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(l,e),l.prototype.template=o,l.prototype.isDone=!1,i="\u5b89\u88c5",r=!1,n=!1,t=!1,l.prototype.initialize=function(e){if(r=!!e.isInstall,!e.isInstall)return i="\u5347\u7ea7"},l.prototype.events={"click .background_run_button":"backgroundRunFn"},l.prototype.backgroundRunFn=function(e){return t=!0,this.$el.modal("hide")},l.prototype.getRenderData=function(){return{appVersion:APP_VERSION,installLabel:i}},l.prototype.className="ui small modal",l.prototype.updateProgress=function(e){var t,r,o;if(!this.isDone)return r=e.downloadedFiles/e.totalFiles,r*=100,this.$el.find(".progress").progress({percent:r}),t=this.$el.find(".install_info_label"),o=e.url.substring(document.location.href.length),n=!0,t.html("<strong>"+i+"\u4e2d:</strong> "+_.escape(o))},l.prototype.doneProgress=function(e){var t;return this.isDone=!0,this.$el.find(".progress").progress({percent:100}),this.$el.find(".install_info_label").html(i+"\u5b8c\u6210"),this.$el.find(".background_run_button").remove(),(t=this.$el.find(".ui.positive.button")).removeClass("disabled loading"),n?t.html("\u91cd\u542f"):t.html("\u5b8c\u6210")},l.prototype.show=function(e){var i;return a=this,this.render(),r&&this.$el.find(".ui.positive.button").before('<div class="ui right button background_run_button" >\n  \u540e\u53f0\u8fd0\u884c\n</div>'),(i=this.$el.find(".progress")).progress({percent:0}),this.$el.find(".description"),this.$el.modal({closable:!1,onVisible:function(){return $("body").dimmer({closable:!1,useCSS:!0})},onHidden:function(){if(i.progress("destroy"),a.$el.modal("destroy"),a.remove(),a=null,e(),n&&!t)return document.location.reload()}}).modal("show")},l}(r),n.exports=i}}),window.requirejs.define({"views/save_all_unsync_dialog_view":function(e,t,n){var i,r,o,a,s,l,c,u={}.hasOwnProperty;o=t("./view"),t("../application"),i=t("../lib/notifier"),l=t("./templates/save_all_unsync_dialog"),c=null,s=!1,a=!1,r=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)u.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.template=l,t.prototype.className="ui standard story_modal modal",t.prototype.initialize=function(e){return this.models=e.models,this.plugin=e.plugin,c=this,s=!1},t.prototype.afterRender=function(){var e;return e=this.$el.find("tbody"),this.models.forEach((function(t,n){return e.append('<tr id="'+t.id+'">\n  <td>'+t.get("title")+'</td>\n  <td id="'+t.id+'_status"></td>\n</tr>')}))},t.prototype.show=function(e){return this.render(),a=!1,this.$el.modal({onHidden:function(){return c.remove(),s=!0,c=null,a=!1},onApprove:function(){var t;return t=!1,a||(c.$el.find(".positive").addClass("loading"),a=!0,async.eachSeries(c.models,(function(n,r){return s?(r(!0),!1):e(!1,n,c.plugin,(function(e,o){var a;return s?(r(!0),!1):(a=n.get("title"),e?(i.showMessage("\u4fdd\u5b58\u51fa\u9519:"+e,6e3,"error"),t=!0):(i.showMessage(a+"\u4fdd\u5b58\u6587\u4ef6\u6210\u529f"),c.$el.find("#"+n.id).addClass("success"),c.$el.find("#"+n.id+"_status").append('<i class="large green check icon"></i>')),r())}))}),(function(e){return c.$el.find(".positive").removeClass("loading"),t?(c.$el.find("tr.success").remove(),c.$el.find(".positive").hide()):c.$el.modal("hide")}))),!1}}).modal("show")},t}(o),n.exports=r}}),window.requirejs.define({"views/save_as_dialog_view":function(e,t,n){var i,r,o,a,s,l,c,u,d={}.hasOwnProperty;l=t("./view"),i=t("../application"),o=t("../lib/notifier"),r=t("./change_store_plugin_dialog_view"),t("../lib/utils"),s=t("../lib/tmpl_manager"),c=t("./templates/save_as_dialog"),u=null,a=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)d.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.template=c,t.prototype.className="ui standard story_modal modal save_as_dialog_model",t.prototype.events={"click .card.link":"checkStorePlugin","click .save_as_template_button":"saveAsTemplateFn"},t.prototype.saveAsTemplateFn=function(){var e,t,n;return n=this.model,e={},(t=Object.assign({},n.attributes))._attachments=e,n.getAllAttachObjects((function(n,i){return null==i&&(i=[]),i.forEach((function(t){return e[t.key]={data:t.data,content_type:t.type||"application/octet-stream"}})),s.createTmplByDoc(t,{},(function(e,t){return e?o.showMessage("\u521b\u5efa\u6a21\u677f\u5931\u8d25:"+e,6e3,"error"):(o.showMessage("\u4fdd\u5b58\u6a21\u677f\u6210\u529f"),u.hide())}))}))},t.prototype.initialize=function(){return u=this,this.storePluginCollection=i.getStorePluginCollection()},t.prototype.afterRender=function(){var e,t,n,a,s,l,c,d,p,f,h,m,v,g,_;if(f=this.model,d=i.getFileLocalCollection(),p=d.getFileLocalModelByFileId(f.id),_=this.storePluginCollection.filter((function(e){return"store"===(e.get("kind")||"store")})),t=this.$el.find(".cards").html(""),0===_.length)t.html('\u60a8\u8fd8\u6ca1\u6709\u7ed1\u5b9a\u4efb\u4f55\u7b2c\u4e09\u65b9\u5b58\u50a8, \u8bf7\u5148<a href="javascript:void(0);">\u7ed1\u5b9a</a>'),t.find("a").click((function(){return u.hide(),(new r).show()})),"client"===STORY_PLATFORM&&(n=$('<input type="file" nwsaveas="filename.md" style="display:none"/>'),a=$('<a href="javascript:void(0);">\u4fdd\u5b58\u672c\u5730</a>'),t.append(n).append("\u6216\u8005").append(a),n.change((function(){var e,t,i,r;i=require("fs"),r=n.val(),t=p.get("content")||f.get("content")||"";try{i.writeFileSync(r,(" "+t).substring(1))}catch(t){e=t,o.showMessage("\u4fdd\u5b58\u5931\u8d25\uff1a"+e,6e3,"error")}return p.save({content:t,diskContent:t,fullPath:r}),$(window).trigger("saveFileModel"),u.hide()})),a.click((function(){return n.trigger("click")})));else for(h=0,m=_.length;h<m;h++)g=(v=_[h]).get("name"),c=v.get("displayName"),l=v.get("description")||"",e=$('<div class="card ui link" data-value="'+g+'">\n    <div class="content">\n      <div class="header">'+c+'</div>\n      <div class="description">\n      '+l+"\n      </div>\n    </div>\n  </div>"),t.prepend(e),e.data("model",v);if("client"===STORY_PLATFORM)return s=this.$el.find(".actions>.tips"),n=$('<input type="file" nwsaveas="filename.md" style="display:none"/>'),a=$('<a href="javascript:void(0);">\u4fdd\u5b58\u672c\u5730</a>'),s.append(n).append("\u6216\u8005").append(a),n.change((function(){var e,t,i,r;i=require("fs"),r=n.val(),t=p.get("content")||f.get("content")||"";try{i.writeFileSync(r,(" "+t).substring(1))}catch(t){e=t,o.showMessage("\u4fdd\u5b58\u5931\u8d25\uff1a"+e,6e3,"error")}return p.save({content:t,diskContent:t,fullPath:r}),$(window).trigger("saveFileModel"),u.hide()})),a.click((function(){return n.trigger("click")}))},t.prototype.checkStorePlugin=function(e){var t,n;return t=$(e.currentTarget),u.pluginModel=t.data("model"),n=i.getPlugin(u.pluginModel),u.callback(n)},t.prototype.hide=function(){return this.$el.modal("hide")},t.prototype.show=function(e){return this.callback=e,this.render(),this.$el.modal({closable:!1,onVisible:function(){return $("body").dimmer({closable:!1,useCSS:!0})},onHidden:function(){return u.$el.modal("destroy"),u.remove(),u=null}}).modal("show")},t}(l),n.exports=a}}),window.requirejs.define({"views/save_as_store_tree_view":function(e,t,n){var i,r,o,a,s={}.hasOwnProperty;i=t("../application"),t("../constant"),t("../lib/utils"),r=t("../lib/notifier"),a=null,o=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)s.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,Backbone.View),t.prototype.className="tree_content ui segment save_as_tree_content",t.prototype.fileModel=null,t.prototype.initSource=function(){var e;return[{title:("function"==typeof(e=this.plugin).getDisplayName?e.getDisplayName():void 0)||"\u6839\u76ee\u5f55",key:"-1",folder:!0,lazy:!0,obj:{guid:"-1",parentPath:null}}]},t.prototype.currentObj=null,t.prototype.remove=function(){return a.$el.fancytree("destroy"),a=null,t.__super__.remove.call(this)},t.prototype.initialize=function(e){return a=this,this.fileModel=e.fileModel,this.saveAsDialogView=e.saveAsDialogView,this.plugin=i.getPlugin(this.model)},t.prototype.initTree=function(e){var t,n;return e.fancytree({extensions:["wide","filter","glyph"],click:function(e,t){var n,i;return n=(i=t.node).data.obj,a.saveAsDialogView.setSelectObj(n,i)},source:this.initSource(),loadError:function(e,t){var n;return(n=t.error).status&&n.statusText?(t.message="Ajax error: "+t.message,t.details="Ajax error: "+n.statusText+", status code = "+n.status):(t.message=JSON.stringify(n),t.details=JSON.stringify(n))},glyph:{map:{doc:"far fa-file",docOpen:"far fa-file",checkbox:"far fa-square",checkboxSelected:"far fa-check-square",checkboxUnknown:"fa fa-square",error:"fa fa-warning",expanderClosed:"fa fa-caret-right",expanderLazy:"fa fa-angle-right",expanderOpen:"fa fa-caret-down",folder:"far fa-folder",folderOpen:"far fa-folder-open",loading:"fa fa-spinner fa-pulse"}},lazyLoad:function(e,t){var n,i,o,s;if(o="-1"!==(n=(s=t.node).data.obj).guid?n.guid:null,n.parentPath&&(o=n.parentPath+"/"+n.guid),s.isFolder())return i=$.Deferred(),a.plugin.listFiles({},{parentPath:o,pageSize:n.childCount},(function(e,t){var n;if(e){n=e;try{n=JSON.stringify(e)}catch(t){t,n=e}return r.showMessage("\u52a0\u8f7d\u51fa\u73b0\u9519\u8bef"+n,6e3,"error"),i.reject(e)}return i.resolve(t)})),t.result=i.promise()}}),(t=e.fancytree("getTree")).getRootNode().getFirstChild().setExpanded(!0).done((n=this,function(){return n.expandKeyPath(e,t)})),this},t.prototype.expandKeyPath=function(e,t){var n,i,r,o,s,l,c,u,d;c=function(e,t){var n,i;return i=e.lastIndexOf("/"),t.push(e.replace(/\//g,"_")),i>=0?(n=e.substring(0,i),c(n,t)):t},i=this.fileModel,o="/-1/1",r=i.get("guid"),i.get("pluginName")===this.model.get("name")&&(l=i.get("parentPath")||"",0===(o=r?l+"/"+i.get("guid"):l).indexOf("/")&&(o=o.substring(1)),u=c(o,[]),s=[],this.plugin.getVirtualPath?u.forEach((d=this,function(e){return s.push(d.plugin.getVirtualPath(e))})):s=u,o="/-1/"+s.reverse().join("/"));try{return t.loadKeyPath(o,(function(e,t){var n;if(e&&"object"==typeof e&&(e.setActive(),"/-1/1"!==o))return n=e.data.obj,a.saveAsDialogView.setSelectObj(n,e)}))}catch(e){return n=e,console.error(n)}},t}(),n.exports=o}}),window.requirejs.define({"views/save_new_dialog_view":function(e,t,n){var i,r,o,a,s,l,c,u,d,p={}.hasOwnProperty;c=t("./view"),i=t("../application"),r=t("../lib/notifier"),a=t("./save_as_store_tree_view"),o=t("./save_as_dialog_view"),l=t("../lib/utils"),u=t("./templates/save_new_dialog"),d=null,s=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)p.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(n,e),n.prototype.fileModel=null,n.prototype.template=u,n.prototype.className="ui standard story_modal modal save_new_story_modal",n.prototype.initialize=function(e){return this.plugin=e.plugin,this.saveAs=e.saveAs||!1,this.saveAsCallback=e.saveAsCallback,this.fileModel=e.fileModel,this.storePluginCollection=i.getStorePluginCollection(),this.pluginModel=this.plugin.storePluginModel},n.prototype.events={"click .change_store_button":"changeStorePlugin","click .filter_button":"filterShowFn","click .close_search_input_wrapper":"filterHideFn","click .search_file":"filterFileFn","keydown .search_input":"enterKeyFilterFile","click input[name=hideMode]":"toggleHideModeFn"},n.prototype.toggleHideModeFn=function(e){var t;if(t=d.$el.find(".search_input"),$.trim(t.val()))return d.filterFileFn()},n.prototype.filterHideFn=function(e){return d.storeTreeView&&d.storeTreeView.$el.fancytree("getTree").clearFilter(),d.$el.find(".filter_button").show(),d.$el.find(".search_input_wrapper, .filter_checkbox_wrapper").hide(),d.$el.find(".search_input_wrapper").val("")},n.prototype.filterShowFn=function(e){return d.$el.find(".filter_button").hide(),d.$el.find(".search_input_wrapper, .filter_checkbox_wrapper").css("display","inline-block")},n.prototype.enterKeyFilterFile=function(e){if(13===e.keyCode)return d.filterFileFn(e)},n.prototype.filterFileFn=function(e){var t,n,i,o,a;if(d.storeTreeView)if(t=d.$el.find(".search_input"),o=$.trim(t.val())){if(n=o.indexOf("/")>=0,o=(o=(o=o.replace(/\s*/g,"")).replace(/^\/*|\/*$/g,"")).replace(/\/{2,}/g,""))return a=o.split("/"),(i=d.storeTreeView.$el.fancytree("getTree")).$div.removeClass("fancytree-ext-filter-hide fancytree-ext-filter-dimm"),i.options.filter.mode="dimm",d.$el.find("input[name=hideMode]").is(":checked")&&(i.options.filter.mode="hide"),n?i.filterNodes((function(e){var t,n,i;return 1===(n=e.getParentList(!1,!0)).length&&((t=n[0]).isLoaded()||t.setExpanded()),n.length<=1||(n.shift(),!(n.length>a.length)&&(i=!0,a.forEach((function(e,t){var r,o;if(!(n.length<t+1))return r=n[t],o=new RegExp(".*"+e+".*","i").exec(r.title),r.isFolder()||t+1!==a.length&&(i=!1),o&&r.isLazy()&&r.setExpanded(),o?void 0:i=!1})),i))})):i.filterNodes(o,!0)}else r.showMessage("\u8fc7\u6ee4\u5185\u5bb9\u4e0d\u80fd\u4e3a\u7a7a",6e3,"error")},n.prototype.afterRender=function(){var e,t,n,o,a,s;if(d=this,s=this.fileModel,o=i.getFileLocalCollection(),a=o.getFileLocalModelByFileId(s.id),"client"===STORY_PLATFORM)return n=this.$el.find(".actions>.tips"),e=$('<input type="file" nwsaveas="filename.md" style="display:none"/>'),t=$('<a href="javascript:void(0);">\u4fdd\u5b58\u672c\u5730</a>'),n.append(e).append("\u6216\u8005").append(t),e.change((function(){var t,n,i,o;i=require("fs"),o=e.val(),n=a.get("content")||s.get("content")||"";try{i.writeFileSync(o,(" "+n).substring(1))}catch(e){t=e,r.showMessage("\u4fdd\u5b58\u5931\u8d25\uff1a"+t,6e3,"error")}return a.save({content:n,diskContent:n,fullPath:o}),$(window).trigger("saveFileModel",[!0]),d.hide()})),t.click((function(){return e.trigger("click")}))},n.prototype.initTree=function(){var e;return this.storeTreeView=new a({fileModel:this.fileModel,saveAsDialogView:this,model:this.pluginModel}),(e=this.$el.find(">.content")).append(this.storeTreeView.render().$el),this.storeTreeView.initTree(e.find(".tree_content")),d.$el.find(".ui.sticky").sticky({scrollContext:".save_new_story_modal .story_content",context:$(".save_new_story_modal .tree_content")[0]})},n.prototype.setSelectObj=function(e,t){var n,i,r;return this.currentObj=e,i=(i=e.parentPath||"")?"/"+i+"/":"/",e.isChild?(this.$el.find(".parent_path").text(i),this.$el.find("input[name=filename]").val(e.name)):("-1"!==e.guid&&(i=i+e.guid+"/"),this.$el.find(".parent_path").text(i),r=this.fileModel.get("title"),n=l.generateMarkdownFilename(r),this.$el.find("input[name=filename]").val(n||r||"\u672a\u547d\u540d\u7684\u6587\u4ef6.md"))},n.prototype.onSelectObj=function(e,t){var n,i,r;return r=(i=this.currentObj).parentPath||"",i.isChild||("-1"===(n=i.guid)&&(n=""),0===(r=r+"/"+n).indexOf("/")&&(r=r.substring(1))),t(r,n=e)},n.prototype.changeStorePlugin=function(e){var t,n;return e.stopPropagation(),e.preventDefault(),n=new o({model:d.fileModel}),t=d,n.show((function(e){return e.saveFile({},t.fileModel,{saveAs:!0},t.saveAsCallback),t=null}))},n.prototype.validateFilename=function(e){return/^[^\/:*?"<>|\r\n]*$/g.test(e)},n.prototype.hide=function(){return this.$el.modal("hide")},n.prototype.show=function(e){var n,i,o;return this.render(),n=this.$el.find(".change_store_button"),this.saveAs?n.show():n.hide(),this.$el.modal({closable:!1,onVisible:function(){return d.$el.find(".ui.sticky").sticky("refresh"),$("body").dimmer({closable:!1,useCSS:!0})},onHidden:function(){var e;return null!=(e=d.storeTreeView)&&e.remove(),d.$el.find(".ui.sticky").sticky("destroy"),d.$el.modal("destroy"),d.remove(),d=null},onApprove:function(){var t,n,i;return i=d.fileModel.get("title"),t=l.generateMarkdownFilename(i),n=$.trim(d.$el.find("input[name=filename]").val())||t||i||"\u672a\u547d\u540d\u7684\u6587\u4ef6.md",d.validateFilename(n)?d.storeTreeView||d.storeTreeView.getCurrentNodeObj()?(d.currentObj||(d.currentObj={guid:"-1",parentPath:""}),d.onSelectObj(n,e),!0):(r.showMessage("\u8bf7\u9009\u62e9\u4e00\u4e2a\u6587\u4ef6\u5939\u6216\u8005\u6587\u4ef6",1e4,"error"),!1):(r.showMessage("\u8bf7\u8f93\u5165\u4e00\u4e2a\u5408\u6cd5\u7684\u6587\u4ef6\u540d",1e4,"error"),!1)}}).modal("show"),o=this.fileModel.get("title"),i=l.generateMarkdownFilename(o),this.$el.find("input[name=filename]").val(i||o),this.filterHideFn(),t("../lib/dynamic_import/import_fancytree")((function(){return d.initTree()}))},n}(c),n.exports=s}}),window.requirejs.define({"views/search_result_outline_view":function(e,t,n){var i,r,o={}.hasOwnProperty;r=function(e,t,n,i){var r,o;return e-=n,(r=i-(t+=n))<0&&(t=i,e+=r),o=e-0,e<0&&(e=0),o<0&&(t-=o),t>i&&(t=i),[e,t]},i=function(e){var t,n;function i(){return i.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)o.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(i,Backbone.View),i.prototype.className="search_result_container",t=null,null,n={},null,i.prototype.fileModel=null,i.prototype.events={"click .search_result_outline_container .match_item":"gotoPosFn"},i.prototype.gotoPosFn=function(e){var i,r,o;if(r=$(e.currentTarget).data("id"),(o=n[r])&&this.fileModel)return i=function(){var e;if(t.gotoLine(o.from.line,o.from.ch),t.setSelectionRange(o.startPos,o.endPos),t.editorProxy.editor.setActiveLine)return(e=t.editorProxy.editor).setActiveLine(o.from.line),e.highlightPos(o.from)},t.fileModel!==this.fileModel?$(window).trigger("changeFileModel",[this.fileModel,{openInActiveIf:!1,scrollTo:!1,callback:i}]):i()},i.prototype.initialize=function(e){return this,t=e.editorView},i.prototype.show=function(e){return this.render(),e.append(this.$el),t.editorProxy.editor.setActiveLine&&t.editorProxy.editor.getWrapperElement().classList.add("CodeMirror-full-Searching"),this},i.prototype.render=function(){var e;return e=$('<div class="search_result_content">\n  <div class="search_result_outline_container">\n  </div>\n  <div class="search_result_outline_temp_container" style="display:none;">\n  </div>\n</div>'),this.$el.html(e)},i.prototype.changeFileModel=function(e){return this.fileModel=e},i.prototype._setQueryTerms=function(e,t,n,i){var o,a,s;return null==i&&(i={}),e instanceof Array||(e=[e]),o=CodeMirror.Doc(n.toLowerCase()),s=[],e.forEach((function(e){var t,i,a,l,c,u;for(c=o.getSearchCursor(e.toLowerCase()),l=[];c.findNext();)a={startPos:u=o.indexFromPos(c.from()),endPos:i=o.indexFromPos(c.to()),matchStr:n.substring(u,i),from:c.from(),to:c.to()},t=r(u,i,20,n.length),a.contextContent=n.substring(t[0],t[1]),a.contextStartPos=u-t[0],a.contextEndPos=i-t[0],l.push(s.push(a));return l})),s.sort((function(e,t){return e.startPos-t.startPos})),a=s.map((function(e,t){var n,r,o;return e.id=t,i[t]=e,o=(o=(o=e.contextContent).replace("\ufffc"," ")).substring(0,e.contextStartPos)+"\ufffc####"+o.substring(e.contextEndPos),n=$("<div></div>").text(o).html(),r=$("<div></div>").text(e.matchStr).html(),n=(n=(n=(n=n.split(r).join("<mark>"+r+"</mark>")).replace("\ufffc####","<mark class='current_mark'>"+r+"</mark>")).trim()).replace(/\n+|(<br>)+/gi,"<br/>"),'<tr class="match_item" data-id="'+e.id+'">\n<td>'+(t+1)+"</td>\n<td>"+n+"</td>\n</tr>"})),'<table class="ui selectable basic table">\n  <thead>\n    <tr>\n      <th class="one wide">#</th>\n      <th class="ten wide">('+s.length+")"+_.escape(t)+"</th>\n    </tr>\n  </thead>\n  <tbody>\n    "+a.join("")+"\n  </tbody>\n</table>"},i.prototype.setQueryTerms=function(e,t,i){var r,o,a;return e,r=this.$el.find(".search_result_outline_container"),o=this.$el.find(".search_result_outline_temp_container"),n={},a=this._setQueryTerms(e,t,i,n),r.html(a),o.hide(),r.show()},i.prototype.setTempQueryTerms=function(e,t,n){var i,r;return this.$el.find(".search_result_outline_container").hide(),i=this.$el.find(".search_result_outline_temp_container"),r=this._setQueryTerms(e,t,n),i.html(r),i.show()},i.prototype.hideTempQueryTerms=function(){var e,t;return e=this.$el.find(".search_result_outline_container"),t=this.$el.find(".search_result_outline_temp_container"),e.show(),t.hide()},i.prototype.remove=function(){return t.editorProxy.editor.setActiveLine&&t.editorProxy.editor.getWrapperElement().classList.remove("CodeMirror-full-Searching"),t=null,null,i.__super__.remove.apply(this,arguments)},i}(),n.exports=i}}),window.requirejs.define({"views/search_store_files_view":function(e,t,n){var i,r,o,a,s,l={}.hasOwnProperty;a=t("./view"),t("../constant"),i=t("../lib/notifier"),s=t("./templates/search_store_files_view"),o=t("./store_files_list_view"),r=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)l.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.className="search_store_files_container",t.prototype.template=s,t.prototype.initialize=function(e){return this.plugin=e.plugin,this.model=e.model},t.prototype.events={"click .create_search_button":"createSearch","click .return_home_button":"returnHome","click .search_store_button":"searchStore","click .saved_search_button":"savedSearchStore","keypress .search_store_input":"enterKeySearchStore"},t.prototype.savedSearchStore=function(e){var t;return t=$(e.currentTarget).data("query"),this.$el.find(".search_store_input").val(t),this.$home.hide(),this.$list.show(),this.storeFilesListView.search({query:t},null,null,{},(function(){}))},t.prototype.createSearch=function(e){var t,n,r,o,a;return r=this,n=$(e.currentTarget),o=$.trim(this.$el.find(".search_store_files_list .search_store_input").val()),t=$('<div class="ui  longer mini modal">\n  <i class="close icon"></i>\n  <div class="header">\n    \u6dfb\u52a0\u5feb\u901f\u67e5\u8be2\n  </div>\n  <div class="content">\n<form class="ui form">\n  <div class="field">\n    <label>\u522b\u540d</label>\n    <input type="text" name="name">\n  </div>\n  <div class="field">\n    <label>\u67e5\u8be2\u8bcd</label>\n    <input type="text" name="query" value="'+_.escape(o)+'">\n  </div>\n</form>\n  </div>\n<div class="actions">\n      <div class="ui negative button">\n        \u53d6\u6d88\n      </div>\n      <div class="ui positive button">\n        \u786e\u8ba4\n      </div>\n    </div>\n</div>'),a=!1,t.modal({onApprove:function(){var e,n;return n=$.trim(t.find("input[name=name]").val()),o=$.trim(t.find("input[name=query]").val()),n?o?((e=t.find(".ui.positive.button")).addClass("loading"),r.plugin.createSearch({},{name:n,query:o},(function(n,r){return e.removeClass("loading"),n?i.showMessage("\u521b\u5efa\u5feb\u901f\u67e5\u8be2\u5931\u8d25:"+n,6e3,"error"):(t.modal("hide"),a=!0)})),!1):(i.showMessage("\u67e5\u8be2\u8bcd\u4e0d\u80fd\u4e3a\u7a7a",6e3,"error"),!1):(i.showMessage("\u522b\u540d\u4e0d\u80fd\u4e3a\u7a7a",6e3,"error"),!1)},onHidden:function(){var e,i,r,o;if(t.modal("destroy"),t.remove(),a)return o=n.offset(),r=(i=$(".return_home_button")).offset(),(e=$("<i class='xsj_flyer icon plus'></i>")).fly({start:{left:o.left,top:o.top},end:{left:r.left,top:r.top},onEnd:function(){return i.transition("clear queue").transition("pulse"),e.remove(),e=null,i=null}})}}).modal("show"),console.log(e)},t.prototype.afterRender=function(){if(this.$home=this.$el.find(".search_store_files_home"),this.storeFilesListView=new o({plugin:this.plugin,model:this.model}),this.$list=this.$el.find(".search_store_files_list"),this.$list.append(this.storeFilesListView.render().$el),this.refreshListSearchs(),!this.plugin.createSearch)return this.$el.find(".create_search_button").hide()},t.prototype.refreshListSearchs=function(){if(this.plugin.listSearchs)return this.plugin.listSearchs({},{},(e=this,function(t,n){var i,r;if(!t)return n.length>0?((r=e.$home.find(".list_searchs")).empty(),i=$('<div class="ui middle aligned selection list ordered"></div>'),n.forEach((function(e){return i.append('<a class="item saved_search_button" data-query="'+_.escape(e.query)+'">'+_.escape(e.name)+"</a>")})),r.append(i)):void 0}));var e},t.prototype.enterKeySearchStore=function(e){var t,n,i,r;if(13===(e.which||e.keyCode))return n=$(e.currentTarget),(t=n.parent().parent()).addClass("loading"),i=$.trim(n.val()),this.$el.find(".search_store_input").val(i),this.storeFilesListView.search({query:i},null,null,{},(r=this,function(){return t.removeClass("loading"),r.$home.hide(),r.$list.show()}))},t.prototype.searchStore=function(e){var t,n,i,r;return n=$(e.currentTarget),(t=n.parent().parent()).addClass("loading"),i=$.trim(n.parent().find(">input").val()),this.$el.find(".search_store_input").val(i),this.storeFilesListView.search({query:i},null,null,{},(r=this,function(){return t.removeClass("loading"),r.$home.hide(),r.$list.show()}))},t.prototype.returnHome=function(){return this.$home.show(),this.$list.hide(),this.refreshListSearchs()},t.prototype.destroy=function(){return this.storeFilesListView.destroy(),this.remove()},t.prototype.show=function(){return this.$el.show()},t.prototype.hide=function(){return this.$el.hide()},t}(a),n.exports=r}}),window.requirejs.define({"views/select_files_document_manager_dialog_view":function(e,t,n){var i,r,o,a,s,l,c,u,d,p={}.hasOwnProperty,f=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};l=t("./view"),t("../lib/utils"),r=t("../lib/notifier"),a=t("../lib/pouchdb_index_view_manager"),i=t("../constant"),t("../models/file_model"),t("../application"),o=t("./page_nav_view"),u=t("./templates/select_files_document_manager_dialog"),d=null,c=null,s=function(e){var t,n,s,l;function h(){return h.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)p.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(h,e),h.prototype.template=u,h.prototype.className="select_files_items_container",n="",s=[],t=!1,h.prototype.pageNavView=null,l=function(e,t,n,i){return d.selectFilesManagerDialogView.showDimmer("\u7d22\u5f15\u4e2d:"+e+" / "+t)},h.prototype.initialize=function(e){return this.selectFilesManagerDialogView=e.selectFilesManagerDialogView,this.showDimmer=this.selectFilesManagerDialogView.showDimmer.bind(this.selectFilesManagerDialogView),this.hideDimmer=this.selectFilesManagerDialogView.hideDimmer.bind(this.selectFilesManagerDialogView)},h.prototype.events={"change .all_checkbox_input":"allCheckboxInputChanged","change .checkbox_input":"checkboxInputChanged","click .header_title":"titleClick"},h.prototype.allCheckboxInputChanged=function(e){var t,n;return n=$(e.currentTarget),t=this.$el.find(".checkbox_input"),n.is(":checked")?t.prop("checked",!0).change():t.prop("checked",!1).change()},h.prototype.checkboxInputChanged=function(e){var t,n,i,r,o;return i=(n=(t=$(e.currentTarget)).parent().parent().parent().parent()).data("id"),r=n.data("rev"),o=n.find(".header_title").html(),t.is(":checked")?d.addFile({id:i,rev:r,title:o}):d.removeFile({id:i,rev:r,title:o})},h.prototype.addFile=function(e){return d.selectFilesManagerDialogView.addFile(e)},h.prototype.fileAdded=function(e){return 1},h.prototype.removeFile=function(e){return d.selectFilesManagerDialogView.removeFile(e)},h.prototype.fileRemoved=function(e){var t;if((t=d.$el.find(".item[data-id="+e.id+"]").find(".checkbox_input")).is(":checked"))return t.trigger("click")},h.prototype.titleClick=function(e){return $(e.currentTarget).parent().parent().find(".checkbox_input").trigger("click")},h.prototype.search=function(e,i){if(null==e&&(e=""),!t)return n=e,s=i,d.pageNavView.refreshPageFn()},h.prototype._fullSearch=function(e){var t;return c=i.pouchDB,t={processInfoFn:function(e){var t;if(e&&"showUpdateProgressInfo"===e.processType)return t=e.result,d.selectFilesManagerDialogView.showDimmer("\u7d22\u5f15\u4e2d:"+t.viewSeq+" / "+t.dbSeq)}},a.fullSearch(c,n,t,(function(t,n){return t?(r.showMessage("\u52a0\u8f7d\u6587\u4ef6\u51fa\u9519"+t,6e3,"error"),void e()):e(n.rows.map((function(e){return e.id})))}))},h.prototype._getFilesItemsHtml=function(){var e;return(e=d.$el.find(".select_files_items")).hasClass("hide")&&e.removeClass("hide"),e},h.prototype._setBlankHtml=function(){return this.hideDimmer(),d.$el.addClass("blank_filtered_files")},h.prototype.refresh=function(){return d.loadAllIds((function(e){var t;if(d)return(t=new o({allFileIds:e,inst:d})).render(),d.selectFilesManagerDialogView.$el.find(".dropdown_tag_name_container").after(t.$el),t.fetchFiles(),d.pageNavView=t}))},h.prototype._refresh=function(e){var t,n,o,a,u;return c=i.pouchDB,n="query_index/by_updatedate",s&&s.length>0?(n="query_index/by_tagNames",u=_.uniq(_.compact(s)).sort(),t=null,o=function(e,i){return c.query(n,{key:e,reduce:!1,group:!1,showUpdateProgressInfo:l}).then((function(e){var n,r;return r=e.rows,t?(n=r.map((function(e){return e.id})),t=t.filter((function(e){return n.indexOf(e.id)>-1}))):t=r,i()})).catch((function(e){return r.showMessage("\u52a0\u8f7d\u6587\u4ef6\u51fa\u9519"+e,6e3,"error"),i()}))},void async.map(u,o,(function(){var n;return t?(n=_.sortBy(t,(function(e){return e.value.updateDate})),e(n.map((function(e){return e.id})))):e(null)}))):(a={descending:!0,showUpdateProgressInfo:l},c.query(n,a).then((function(t){return e(t.rows.map((function(e){return e.id})))})).catch((function(t){return e(null),r.showMessage("\u52a0\u8f7d\u6587\u4ef6\u51fa\u9519"+t,6e3,"error")})))},h.prototype.renderDoc=function(e,t,n,i,r){var o,a,s;return null==i&&(i=!1),null==r&&(r=[]),a=$("<div></div>").text(t.title).html(),s=i?'checked="checked"':"",o=$('<div class="item" data-id="'+t._id+'" data-rev="'+t._rev+'">\n  <div class="content">\n    <span>'+(n+this.pageNavView.currentPage*this.pageNavView.perpage)+'. &nbsp;</span>\n    <div class="header">\n      <div class="ui checkbox">\n        <input type="checkbox" class="checkbox_input" '+s+'>\n        <label>\n          <a class="header_title" href="javascript:void(0);">'+a+'</a>\n        </label>\n      </div>\n      <span class="header_datetime">\n        <i class="wait icon"></i>\n        <span class="timeago">'+t.updateDate+"</span>\n      </span>\n    </div>\n  </div>\n</div>"),e.append(o),o.find(".timeago").timeago("update",new Date(t.updateDate))},h.prototype.changeDocs=function(e){var t,n,i;if("",i=(d=this).selectFilesManagerDialogView.getSelectedFiles(),(t=d._getFilesItemsHtml()).empty(),e.length>0)return n=$('<div class="all_item_header item" data-operator="toogleAll">\n  <div class="content">\n    <span>#. &nbsp;</span>\n    <div class="header">\n      <div class="ui checkbox">\n        <input type="checkbox" class="all_checkbox_input">\n        <label>\n        </label>\n      </div>\n    </div>\n  </div>\n</div>'),t.append(n),e.forEach((function(e,n){var r;return d.renderDoc(t,e,n+1,(r=e._id,f.call(i,r)>=0),"")}))},h.prototype.loadAllIds=function(e){var i;return t=!0,this.showDimmer(),i=function(n){return t=!1,n?(e(n),n.length>0?d.$el.removeClass("blank_filtered_files"):d._setBlankHtml()):d.hideDimmer()},n?d._fullSearch(i):d._refresh(i)},h.prototype.remove=function(){return this.pageNavView&&d.pageNavView.remove(),h.__super__.remove.call(this),d=null},h.prototype.afterRender=function(){return d=this},h}(l),n.exports=s}}),window.requirejs.define({"views/select_files_manager_for_batch_dialog_view":function(e,t,n){var i,r,o,a,s,l,c,u,d,p,f,h,m,v,g=function(e,t){return function(){return e.apply(t,arguments)}},w={}.hasOwnProperty;l=t("./view"),t("../lib/utils"),t("../application"),t("../lib/notifier"),t("../lib/zip"),i=t("../constant"),h=t("./templates/select_files_manager_for_batch_dialog"),t("../models/file_model"),o=t("./select_files_document_manager_dialog_view"),s=t("./selected_files_dialog_view"),r=t("./dropdown_tag_name_view"),m=null,u=null,p=null,f=null,d=null,c=function(){var e;return m?(e=m.$el.find(".clean_search_input_wrapper"),m.$el.find(".search_input").val()?e.removeClass("blank"):e.addClass("blank")):null},v=_.throttle(c,1e3),a=function(e){function t(){return this.searchDocumentEnter=g(this.searchDocumentEnter,this),this.searchDocument=g(this.searchDocument,this),this.cleanSearchInput=g(this.cleanSearchInput,this),t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)w.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.template=h,t.prototype.className="ui fullscreen story_modal modal story_modal_scroll files_manager_dialog_view",t.prototype.initDocs=[],t.prototype.inSearchMode=!1,t.prototype.events={"click .search_button":"searchDocument","keydown .search_input":"searchDocumentEnter","click .clean_search_input_wrapper":"cleanSearchInput","click .search_type_check":"toggleFullSearch","click .return_button":"returnExportDialogView","click .selected_button":"selectedFiles"},t.prototype.selectedFiles=function(e){return m.$el.modal("setting","transition","horizontal flip"),m.operatorFileDialogView.setSelectedDocs(f.docs),m.operatorFileDialogView.show(),m.operatorFileDialogView=null},t.prototype.returnExportDialogView=function(e){return m.$el.modal("setting","transition","horizontal flip"),m.operatorFileDialogView.show(),m.operatorFileDialogView=null},t.prototype.toggleFullSearch=function(e){var t,n;return n=$(e.currentTarget),this.inSearchMode=!this.inSearchMode,t=this.$el.find(".search_container"),this.inSearchMode?(null!=d&&d.hide(),t.show(),n.addClass("active")):(null!=d&&d.show(),t.hide(),n.removeClass("active"))},t.prototype.cleanSearchInput=function(){return this.$el.find(".search_input").val(""),this.$el.find(".clean_search_input_wrapper").addClass("blank")},t.prototype.searchDocument=function(){var e,t,n;if(p)return t=this.$el.find(".search_input").val(),e=!1,1===this.$el.find(".use_fullsearch").length&&this.$el.find(".use_fullsearch").checkbox("is checked")&&(e=!0),n=d.getQueryTags(),this.inSearchMode||(t=""),p.search(t,n,e)},t.prototype.searchDocumentEnter=function(e){var t,n,i;return 13!==e.which&&13!==e.keyCode||p&&(n=this.$el.find(".search_input").val(),t=!1,1===this.$el.find(".use_fullsearch").length&&this.$el.find(".use_fullsearch").checkbox("is checked")&&(t=!0),i=d.getQueryTags(),this.inSearchMode||(n=""),p.search(n,i,t)),v()},t.prototype.initialize=function(e){return(m=this).operatorFileDialogView=e.operatorFileDialogView,m.initDocs=e.initDocs},t.prototype.afterRender=function(){return this.$el.find(".cancel_batch_export_button").hide()},t.prototype.addFile=function(e){return f.addFile(e)},t.prototype.removeFile=function(e){return f.removeFile(e)},t.prototype.fileRemoved=function(e){return p.fileRemoved(e)},t.prototype.getSelectedFiles=function(){return f.getSelectedFiles()},t.prototype.showDimmer=function(e){if(this.$dimmer.dimmer("show"),e)return this.$el.find(".dimmer>.ui.text").html(e)},t.prototype.hideDimmer=function(){return this.$dimmer.dimmer("hide"),this.$el.find(".dimmer>.ui.text").html("\u6570\u636e\u51c6\u5907\u4e2d...")},t.prototype.show=function(){return this.render(),this.$dimmer=this.$el.find(".story_content").dimmer({closable:!1}),this.$el.find(".dimmer").html('<div class="ui indeterminate text loader">\u6570\u636e\u51c6\u5907\u4e2d...</div>'),this.$el.modal({closable:!1,transition:"horizontal flip",onVisible:function(){return null!=u&&"function"==typeof u.refresh&&u.refresh(),m.$el.modal("setting","transition","scale")},onHidden:function(){return null!=p&&p.remove(),p=null,null!=f&&f.remove(),f=null,null!=d&&d.remove(),d=null,u=null,m.$el.modal("destroy"),m.remove(),$("body").dimmer({closable:!1,useCSS:!0}),m.operatorFileDialogView&&m.operatorFileDialogView.destroy(),m=null}}).modal("show"),(f=new s({selectFilesManagerDialogView:this,initDocs:this.initDocs})).render(),this.$el.find(".ui.menu .item").tab({onFirstLoad:function(e){var t;if(null!=u&&"function"==typeof u.unactive&&u.unactive(),"document"===e)return t=m.$el.find(".document_tab"),p=new o({selectFilesManagerDialogView:m}),t.html("").append(p.render().$el),u=p,m.$el.find(".search_type_check").show(),(d=new r({getDB:function(){return i.pouchDB},searchTrigger:function(){return m.searchDocument()}})).render(),m.$el.find(".dropdown_tag_name_placeholder").replaceWith(d.$el),d.init()},onLoad:function(e){if(null!=u&&"function"==typeof u.unactive&&u.unactive(),"document"===e)return u=p,m.$el.find(".search_type_check").show(),null!=d?d.show():void 0}}),this.$el.find(".ui.menu .item[data-tab=document]").tab("change tab","document")},t}(l),n.exports=a}}),window.requirejs.define({"views/selected_files_dialog_view":function(e,t,n){var i,r,o,a,s,l,c={}.hasOwnProperty;a=t("./view"),o=t("../lib/utils_url"),i=t("../lib/notifier"),s=t("./templates/selected_files_dialog"),l=null,r=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)c.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.template=s,t.prototype.className="selected_files_dialog ui segment raised blank_selected_files",t.prototype.docs=[],t.prototype.initialize=function(e){return(l=this).selectFilesManagerDialogView=e.selectFilesManagerDialogView,l.docs=[],l.initDocs=e.initDocs||[]},t.prototype.events={"click .delete_button":"_removeFileByEvent","click .select_direct_files_btn":"selectDirectFilesFn"},t.prototype.selectDirectFilesFn=function(e){var t,n,r;if(!(t=$(e.currentTarget)).hasClass("loading")&&(n=this.model.id))return t.addClass("loading"),this.selectFilesManagerDialogView.showDimmer(),o.getDirectDocs(n,null,(r=this,function(e,n){var o,a,s,l,c;if(t.removeClass("loading"),r.selectFilesManagerDialogView.hideDimmer(),e)i.showMessage("\u52a0\u8f7d\u51fa\u9519\uff1a"+e,6e3,"error");else{if(0!==n.length){for(r.initDocs=n.map((function(e){return{id:e.doc._id,rev:e.doc._rev,title:e.doc.title}})),c=[],a=0,s=(l=r.initDocs).length;a<s;a++)o=l[a],c.push(r.addFile(o));return c}i.showMessage("\u5f53\u524d\u6587\u7ae0\u6ca1\u6709\u5f15\u7528\u7684\u6587\u7ae0\u53ef\u4ee5\u9009\u62e9",6e3)}}))},t.prototype._removeFile=function(e){var t;if(t=e.data("id"))return l.removeFile({id:t}),l.selectFilesManagerDialogView.fileRemoved({id:t})},t.prototype._removeFileByEvent=function(e){var t;return(t=$(e.currentTarget).parent().parent()).data("id")?l._removeFile(t):t.parent().parent().find("tbody>tr").each((function(e,t){return l._removeFile($(t))}))},t.prototype.removeFile=function(e){var t,n,i;if((n=_.find(l.docs,(function(t){return t.id===e.id})))&&l.docs.splice(_.indexOf(l.docs,n),1),i=e.id,l.$el.find(".selected_file_"+i).remove(),t=l.$el.find(".selected_file_item"),l.$el.find(".total_selected_files_count").html(l.docs.length),0===t.length)return l.$el.addClass("blank_selected_files")},t.prototype.processStatus=function(e,t){var n;switch(e){case"start":return l.$el.addClass("processing_export"),NProgress.configure({parent:".selected_files_dialog"}),NProgress.set(0);case"start_file":return l.$el.find("thead .header_title").html(t.finished+"/"+t.total),NProgress.set(t.percent);case"fail_file":if((n=l.$el.find(".selected_file_"+t.id)).addClass("error"),n[0])return n[0].scrollIntoViewIfNeeded();break;case"success_file":if((n=l.$el.find(".selected_file_"+t.id)).addClass("positive"),n[0]&&n[0].scrollIntoViewIfNeeded(),t.info)return n.find(".file_size").text(" ("+filesize(t.info.blob.size)+")");break;case"end":return l.$el.removeClass("processing_export"),l.$el.find(".selected_file_item").removeClass("positive error"),l.$el.find("thead .header_title").html("\u6587\u4ef6\u540d\u79f0"),NProgress.set(1),NProgress.done(),NProgress.remove(),NProgress.configure({parent:"body"})}},t.prototype.addFile=function(e){var t;if(!l.docs.find((function(t){return t.id===e.id})))return t=l.$el.find("tbody"),l.$el.removeClass("blank_selected_files"),t.append("<tr data-id='"+e.id+"' data-rev='"+e.rev+"' class='selected_file_"+e.id+' selected_file_item\'>\n  <td class="seq right aligned"></td>\n  <td class="title">'+e.title+'<span class="file_size"></span></td>\n  <td class="right aligned">\n    <i class="large remove icon delete_button link" title="\u5220\u9664"></i>\n  </td>\n</tr>'),l.docs.push(e),l.$el.find(".total_selected_files_count").html(l.docs.length)},t.prototype.getSelectedFiles=function(){var e;return e=[],l.$el.find(".selected_file_item").each((function(t,n){return e.push($(n).data("id"))})),e},t.prototype.afterRender=function(){var e,t,n,i,r;for(this.model||this.$el.find(".select_direct_files_btn").remove(),this.$el.appendTo(this.selectFilesManagerDialogView.$el.find(".story_content")),this.$el.draggable({handle:".selected_files_header",containment:"parent"}),r=[],t=0,n=(i=this.initDocs).length;t<n;t++)e=i[t],r.push(this.addFile(e));return r},t.prototype.remove=function(){return l=null,t.__super__.remove.call(this)},t}(a),n.exports=r}}),window.requirejs.define({"views/set_persist_group_dialog_view":function(e,t,n){var i,r,o,a,s,l,c,u,d,p={}.hasOwnProperty;l=t("./view"),t("../lib/utils"),o=t("../lib/utils_font"),a=t("../lib/notifier"),i=t("../application"),r=t("../constant"),u=t("./templates/set_persist_group_dialog"),c="http://localhost:3005","production"===ENV&&(c=r.host+"/xsjcors/http://fonts.xiaoshujiang.com"),d=null,s=function(e){var t,n,s,l;function f(){return f.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)p.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(f,e),f.prototype.template=u,f.prototype.className="ui standard story_modal modal set_persist_group_dialog",n="",t=null,f.prototype.events={"click .select_color_btn":"showColorPickerFn","change input[type=radio][name=baseColorType]":"baseColorTypeChangedFn","click .game_badge_btn":"gameBadgeFn","click .close_font_icon_select_btn":"closeBadgeFn"},l=function(e){return d.$el.find(".color_select_result").css("background",e),d.$el.find("input[name=groupColorValue]").val(e)},f.prototype.closeBadgeFn=function(e){return this.$el.find(".font_icon_select_container").remove()},f.prototype.gameBadgeFn=function(e){var i,a,s;return e.preventDefault(),e.stopPropagation(),s=r.host+"/web_statics/gameicons/index.html",a=$('<div class="font_icon_select_container">\n <div class="font_icon_select_btns">\n  <div class="close_font_icon_select_btn"><i class="link icon close circle"></i></div>\n </div>\n</div>'),i=$('<iframe src="'+s+'" class="preview_iframe" frameborder="0" style="width: 100%;height:100%;"></iframe>').appendTo(a),this.$el.append(a),i[0].contentWindow.setAvatarFn=function(e,i){var r,s;return e&&e.svg&&(r=(r=e.className||"").replace(/\s*/gi,"").toLowerCase(),t={font:e.font,text:e.text,key:r},(s=o.registerFontIconStyle(t))&&(n="fas fa-star xsj_custom_icon xsj_custom_icon_"+s,d.$el.find(".icon_result")[0].className="icon_result fa-fw "+n)),a.remove()},i.one("load",(function(){return i[0].contentWindow.fetchFontInfoUrl=c}))},f.prototype.baseColorTypeChangedFn=function(e){var t;return(t=$(e.currentTarget).val())&&(t="var(--"+t+")"),l(t)},f.prototype.showColorPickerFn=function(e){var t,n,r,o;return t=i.getApplicationProfileModel(),r=$.trim(t.get("cmColorpickerColorSets"))||"",o=[],r&&(o=r.split("|")),(n=new CodeMirrorColorPicker.ColorPicker({type:"sketch",mode:"edit",colorSets:function(){return r=$.trim(t.get("cmColorpickerColorSets"))||"",o=[],r&&(o=r.split("|")),[{colors:o,name:"Input Colors",edit:!0}]},color:"black"})).$root.addClass("xsj_only_palette"),n.show({left:e.clientX,top:e.clientY,hideDelay:2e3},"black",(function(e){return n.hide(),n.destroy(),l(e)}))},s=function(e){var i,o;return i=e.find(".persist_group_icon_dropdown"),o=_.debounce((function(e){var t;return t=$(e.currentTarget).val(),i.dropdown("search",t)}),1e3),i.on("keyup","input[name=search]",o),i.dropdown({saveRemoteData:!1,forceSelection:!1,filterRemoteData:!1,showOnFocus:!1,className:{selected:"skip_selected"},delay:{hide:1e3},onShow:function(){return i.find("input[name=search]")[0].select(),!0},templates:{menu:function(e,t){var n,i;return i=e[t.values]||{},"            ",n=[],$.each(i,(function(e,i){var r;return r=i.selected?"active":"",n.push('<div class="item '+r+'" data-value="'+i[t.value]+'" data-name="'+_.escape(i[t.name])+'"><i class="'+i[t.value]+' fa-fw"></i>'+_.escape(i[t.name])+"</div>")})),"            \n"+n.join("")}},onChange:function(e,i,r){return d.$el.find(".icon_result")[0].className="icon_result fa-fw "+e,n=e,t=null},onHide:function(t){return(e=$(this)).find(".menu>.menu").empty(),e.dropdown("refreshItems")},apiSettings:{responseAsync:function(e,t){var n,i;return n=function(e){var t;t=localStorage.recent_icons;try{t=JSON.parse(t)}catch(e){t=[]}return t=t.concat(r.fontIcons),e({success:!0,results:t=(t=_.uniq(t,"value")).slice(0,40)})},(i=e.urlData.query)?function(e,t){return function(e){return $.get("fonts/icons.yml").then((function(t,n){var i;return i=jsyaml.load(t),e(null,i)})).fail((function(e){return a.showMessage("\u52a0\u8f7d\u8d44\u6e90\u51fa\u9519",6e3,"error")}))}((function(n,i){var r,o,a,s,l,c,u,d,p;if(c=!1,d=[],e)try{c=new RegExp("(^|\\W)"+e,"gi")}catch(e){c=!1}for(a in i)if(p=a,(o=i[a]).key=a,o.search&&o.search.terms&&o.search.terms.length>0&&(p+=o.search.terms.join(" ")),!c||p.match(c))for(r=0,s=(l=o.styles).length;r<s;r++)switch(l[r]){case"solid":u={name:o.label,value:"fas fa-"+a},d.push(u);break;case"regular":u={name:o.label,value:"far fa-"+a},d.push(u);break;case"brands":u={name:o.label,value:"fab fa-"+a},d.push(u)}return t({success:!0,results:d})}))}(i,t):n(t)}}})},f.prototype.show=function(e){var r,o,a,c,u,p,f;return d=this,p=null,this.render(),c=i.getFileGroupTabCollection(),(u=c.get(e))&&(p={id:u.id,name:u.get("name"),color:u.get("groupColor"),icon:u.get("groupIcon")}),r=this.$el,o=this.$el.find(".ui.form"),p&&(f={name:p.name,groupColorValue:p.color},o.deserialize(f)),MINI_WEB||this.$el.find(".icon_result").after('<div class="ui button icon game_badge_btn" title="\u6e38\u620f\u56fe\u6807"><i class="icon fas fa-trophy link"></i></div>'),s(this.$el),p&&(p.icon&&((a=d.$el.find(".persist_group_icon_dropdown")).dropdown("set value",p.icon),a.dropdown("set text",'<i class="fa-fw '+p.icon+'"></i>')),p.color&&l(p.color)),o.form({fields:{name:{identifier:"name",rules:[{type:"empty",prompt:"\u663e\u793a\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a"}]}},onSuccess:function(i){var o;return i&&(i.preventDefault(),i.stopPropagation()),a=d.$el.find(".persist_group_icon_dropdown"),n=n||"fas fa-star",o={name:r.find("input[name=name]").val().trim(),groupColorValue:r.find("input[name=groupColorValue]").val().trim()||"var(--base09)",iconValue:n},(u=c.get(e)).save({name:o.name,groupType:"persist",groupIcon:o.iconValue,groupColor:o.groupColorValue,groupFontIcon:t}),d.$el.modal("hide")}}),this.$el.modal({closable:!1,onHidden:function(){return o.form("destroy"),(a=d.$el.find(".persist_group_icon_dropdown")).dropdown("destroy"),d.$el.modal("destroy"),d.remove(),d=null,t=null,n=""},onApprove:function(){return o.form("validate form"),!1}}).modal("show")},f}(l),n.exports=s}}),window.requirejs.define({"views/settings_basic_view":function(e,t,n){var i,r,o,a,s,l,c,u,d={}.hasOwnProperty;c=t("./view"),s=t("../lib/notifier"),a=t("../application"),o=t("./about_view"),t("../constant"),u=t("./templates/settings_basic"),r=null,i=null,l=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)d.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.template=u,t.prototype.className="ui form",t.prototype.events={"click .check_new_version_button":"checkNewVersion","click .protocol_registry_button":"registryXSJAPPProtocolFn","click .client_resource_root_dir_button":"selectClientResourceRootDir","change .client_resource_root_file_input":"changeClientResourceRootDir"},t.prototype.changeClientResourceRootDir=function(){return i.val(r.val())},t.prototype.selectClientResourceRootDir=function(){return r.trigger("click")},t.prototype.registryXSJAPPProtocolFn=function(){return process.execPath,$.getJSON("/apply_protocol_registry",{},(function(e){var t;if(e.success)return s.showMessage("\u8bbe\u7f6e\u534f\u8bae\u5524\u9192\u6210\u529f");try{t=JSON.stringify(e)}catch(e){}return s.showMessage("\u8bbe\u7f6e\u534f\u8bae\u5524\u9192\u5931\u8d25\uff1a"+t,6e3,"error")}))},t.prototype.checkNewVersion=function(){return(new o).show()},t.prototype.initialize=function(e){return this.settingsView=e.settingsView,this.applicationProfileModel=a.getApplicationProfileModel(),this.editorProfileModel=a.getEditorProfileModel(),this.previewProfileModel=a.getPreviewProfileModel(),this},t.prototype.getRenderData=function(){var e,t,n,i;switch(t="",n="",i="",this.applicationProfileModel.get("closeBehavior")){case"exit":n=" checked ";break;case"tray":i=" checked ";break;default:t=" checked "}return e="",this.applicationProfileModel.get("autoLock")&&(e="checked"),{bodyFonts:this.applicationProfileModel.get("font"),clientResourceRootDir:this.applicationProfileModel.get("clientResourceRootDir"),autoCheckNewVersion:this.applicationProfileModel.get("autoCheckNewVersion")?"checked":void 0,syncScrollPreview:this.applicationProfileModel.get("syncScrollPreview")?"checked":void 0,syncScrollEditor:this.applicationProfileModel.get("syncScrollEditor")?"checked":void 0,showRandomIdiom:this.applicationProfileModel.get("showRandomIdiom")?"checked":void 0,lockPassword:this.applicationProfileModel.get("lockPassword"),lockTimeout:this.applicationProfileModel.get("lockTimeout")||6,lockWithStartChecked:this.applicationProfileModel.get("lockWithStart")?"checked":"",autoLockChecked:e,closeBehaviorDefaultChecked:t,closeBehaviorExitChecked:n,closeBehaviorTrayChecked:i}},t.prototype.afterRender=function(){var e,t;if(r=this.$el.find(".client_resource_root_file_input"),i=this.$el.find('input[name="clientResourceRootDir"]'),this.$el.find(".ui.checkbox.close_behavior_checkbox").checkbox(),e=this.applicationProfileModel.get("assetPath"),t=this.applicationProfileModel.get("css"),this.$el.find("input[name=assetPath]").val(e),this.$el.find("textarea[name=bodyCss]").val(t),"client"===STORY_PLATFORM&&"darwin"===process.platform)return this.$el.find(".protocol_registry_container").remove()},t.prototype.remove=function(){return t.__super__.remove.apply(this,arguments),r=null,i=null,null},t.prototype.save=function(){var e,t,n,i,r,o,a,s,l,c,u,d,p,f;return o=this.$el.find("input[name=bodyFonts]").val(),r=this.$el.find("textarea[name=bodyCss]").val(),a=this.$el.find("input[name=clientResourceRootDir]").val(),l=this.$el.find("input[name=lockPassword]").val(),c=this.$el.find("input[name=lockTimeout]").val(),c=Math.min(Math.max(parseInt(c)||6,6),1440),i=this.$el.find("input[name=autoLock]").is(":checked"),u=this.$el.find("input[name=lockWithStart]").is(":checked"),n=this.$el.find("input[name=autoCheckNewVersion]").is(":checked"),f=this.$el.find("input[name=syncScrollPreview]").is(":checked"),p=this.$el.find("input[name=syncScrollEditor]").is(":checked"),d=this.$el.find("input[name=showRandomIdiom]").is(":checked"),s=this.$el.find(".close_behavior_checkbox input:checked").val(),t=$.trim(this.$el.find("input[name=assetPath]").val()),(e=this.applicationProfileModel).set({font:o,css:r,clientResourceRootDir:a,lockPassword:l,lockTimeout:c,autoLock:i,lockWithStart:u,autoCheckNewVersion:n,syncScrollPreview:f,syncScrollEditor:p,showRandomIdiom:d,closeBehavior:s,assetPath:t}),e.save()},t}(c),n.exports=l}}),window.requirejs.define({"views/settings_editor_view":function(e,t,n){var i,r,o,a,s,l,c,u={}.hasOwnProperty;o=t("./view"),t("../lib/notifier"),i=t("../application"),c=t("./templates/settings_editor"),l=4,s=4,a=4,r=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)u.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.template=c,t.prototype.className="ui form",t.prototype.initialize=function(){return this.applicationProfileModel=i.getApplicationProfileModel(),this.editorProfileModel=i.getEditorProfileModel(),this.previewProfileModel=i.getPreviewProfileModel(),l=parseInt(this.editorProfileModel.get("tabSize"))||4,s=parseInt(this.editorProfileModel.get("cm_tabSize"))||4,a=parseInt(this.editorProfileModel.get("cm_indentUnit"))||4},t.prototype.getRenderData=function(){var e;return e=parseInt(this.editorProfileModel.get("cm_inputOffsetTop"))||0,{editorFonts:this.editorProfileModel.get("editorFont"),editorFontSize:this.editorProfileModel.get("fontSize"),lineHeight:this.editorProfileModel.get("lineHeight"),cm_typewriterScrolling:this.editorProfileModel.get("cm_typewriterScrolling")?"checked":void 0,cm_highlightActive:this.editorProfileModel.get("cm_highlightActive")?"checked":void 0,cm_styleStackFocusLine:this.editorProfileModel.get("cm_styleStackFocusLine")?"checked":void 0,cm_minimap:this.editorProfileModel.get("cm_minimap")?"checked":void 0,cm_smartIndent:this.editorProfileModel.get("cm_smartIndent")?"checked":void 0,cm_indentWithTabs:this.editorProfileModel.get("cm_indentWithTabs")?"checked":void 0,cm_showInvisibles:this.editorProfileModel.get("cm_showInvisibles")?"checked":void 0,cm_autoCovertHtmlToMarkdown:this.editorProfileModel.get("cm_autoCovertHtmlToMarkdown")?"checked":void 0,cm_inputOffsetTop:e,cm_tabSize:s,cm_indentUnit:a,cm_previewPDF:this.editorProfileModel.get("cm_previewPDF")?"checked":void 0,cm_lineNumbers:this.editorProfileModel.get("cm_lineNumbers")?"checked":void 0,cm_autoCloseBrackets:this.editorProfileModel.get("cm_autoCloseBrackets")?"checked":void 0,cm_lineWrapping:this.editorProfileModel.get("cm_lineWrapping")?"checked":void 0,cm_scrollPastEnd:this.editorProfileModel.get("cm_scrollPastEnd")?"checked":void 0,cm_autopreviewHoveredImage:this.editorProfileModel.get("cm_autopreviewHoveredImage")?"checked":void 0,cm_activeCursorMathjax:this.editorProfileModel.get("cm_activeCursorMathjax")?"checked":void 0,cm_spellChecker:this.editorProfileModel.get("cm_spellChecker")?"checked":void 0,cm_markerColorpicker:this.editorProfileModel.get("cm_markerColorpicker")?"checked":void 0}},t.prototype.afterRender=function(){var e,t,n,i,r;return this,n=this.editorProfileModel.get("keyBinding"),this.$el.find("input[name=keyBindings][value="+n+"]").prop("checked",!0),i=this.editorProfileModel.get("pastePlainFileMode"),this.$el.find("input[name=pastePlainFileMode][value="+i+"]").prop("checked",!0),e=this.editorProfileModel.get("cm_keyBinding"),this.$el.find("input[name=cm_keyBindings][value="+e+"]").prop("checked",!0),t=this.editorProfileModel.get("codeFolding"),this.$el.find("input[name=codeFolding][value="+t+"]").prop("checked",!0),r=this.editorProfileModel.get("softWrap"),this.$el.find("input[name=softWrap][value="+r+"]").prop("checked",!0),this.$el.find(".ui.checkbox").checkbox()},t.prototype.afterAppendInit=function(){var e,t,n;return n=this.$el.find(".tab_size_label"),this.$el.find(".tab_size").range({min:0,max:10,start:l,onChange:function(e){return l=e,n.html(e)}}),t=this.$el.find(".cm_tab_size_label"),this.$el.find(".cm_tab_size").range({min:0,max:10,start:s,onChange:function(e){return s=e,t.html(e)}}),e=this.$el.find(".cm_indent_unit_label"),this.$el.find(".cm_indent_unit").range({min:0,max:10,start:a,onChange:function(t){return a=t,e.html(t)}})},t.prototype.save=function(){var e,t,n,i,r,o,c,u,d,p,f,h,m,v,g,_,w,y,b,x,k,D,C,F,M,T,S,P,j,E,I,O,V,L,A,B,N,R,H;return P=this.$el.find("input[name=keyBindings]:checked").val(),I=this.$el.find("input[name=pastePlainFileMode]:checked").val(),d=this.$el.find("input[name=cm_keyBindings]:checked").val(),k=this.$el.find("input[name=codeFolding]:checked").val(),R=this.$el.find("input[name=softWrap]:checked").val(),F=this.$el.find("input[name=editorFonts]").val(),j=this.$el.find("input[name=lineHeight]").val(),C=this.$el.find("input[name=editorFontSize]").val(),C=$.isNumeric(C)?parseInt(C):16,u=this.$el.find("input[name=cm_inputOffsetTop]").val(),u=$.isNumeric(u)?Math.abs(parseInt(u)||0):0,V=this.$el.find("input[name=selectStyle]").is(":checked"),H=this.$el.find("input[name=typewriterScrolling]").is(":checked"),x=this.$el.find("input[name=cm_typewriterScrolling]").is(":checked"),T=this.$el.find("input[name=highlightActive]").is(":checked"),o=this.$el.find("input[name=cm_highlightActive]").is(":checked"),b=this.$el.find("input[name=cm_styleStackFocusLine]").is(":checked"),E=this.$el.find("input[name=minimap]").is(":checked"),m=this.$el.find("input[name=cm_minimap]").is(":checked"),D=this.$el.find("input[name=displayIndentGuides]").is(":checked"),B=this.$el.find("input[name=showPrintMargin]").is(":checked"),e=this.$el.find("input[name=animateScroll]").is(":checked"),N=this.$el.find("input[name=softTab]").is(":checked"),S=this.$el.find("input[name=highlightSelectedWord]").is(":checked"),L=this.$el.find("input[name=showGutter]").is(":checked"),A=this.$el.find("input[name=showInvisibles]").is(":checked"),O=this.$el.find("input[name=scrollPastEnd]").is(":checked"),w=this.$el.find("input[name=cm_smartIndent]").is(":checked"),c=this.$el.find("input[name=cm_indentWithTabs]").is(":checked"),_=this.$el.find("input[name=cm_showInvisibles]").is(":checked"),i=this.$el.find("input[name=cm_autoCovertHtmlToMarkdown]").is(":checked"),v=this.$el.find("input[name=cm_previewPDF]").is(":checked"),p=this.$el.find("input[name=cm_lineNumbers]").is(":checked"),n=this.$el.find("input[name=cm_autoCloseBrackets]").is(":checked"),f=this.$el.find("input[name=cm_lineWrapping]").is(":checked"),g=this.$el.find("input[name=cm_scrollPastEnd]").is(":checked"),r=this.$el.find("input[name=cm_autopreviewHoveredImage]").is(":checked"),t=this.$el.find("input[name=cm_activeCursorMathjax]").is(":checked"),y=this.$el.find("input[name=cm_spellChecker]").is(":checked"),h=this.$el.find("input[name=cm_markerColorpicker]").is(":checked"),(M=this.editorProfileModel).set({keyBinding:P,pastePlainFileMode:I,cm_keyBinding:d,codeFolding:k,softWrap:R,editorFont:F,lineHeight:j,fontSize:null!=C?C:14,selectStyle:V,typewriterScrolling:H,cm_typewriterScrolling:x,highlightActive:T,cm_highlightActive:o,cm_styleStackFocusLine:b,minimap:E,cm_minimap:m,displayIndentGuides:D,showPrintMargin:B,animateScroll:e,softTab:N,tabSize:l,highlightSelectedWord:S,showGutter:L,showInvisibles:A,scrollPastEnd:O,cm_smartIndent:w,cm_indentWithTabs:c,cm_tabSize:s,cm_inputOffsetTop:u,cm_indentUnit:a,cm_showInvisibles:_,cm_autoCovertHtmlToMarkdown:i,cm_previewPDF:v,cm_lineNumbers:p,cm_autoCloseBrackets:n,cm_lineWrapping:f,cm_scrollPastEnd:g,cm_autopreviewHoveredImage:r,cm_activeCursorMathjax:t,cm_spellChecker:y,cm_markerColorpicker:h}),M.save()},t}(o),n.exports=r}}),window.requirejs.define({"views/settings_grammar_view":function(e,t,n){var i,r,o,a,s,l,c={}.hasOwnProperty;a=t("./view"),i=t("../application"),r=t("../constant"),l=t("./templates/settings_grammar"),s=r.grammar,o=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)c.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.template=l,t.prototype.className="ui styled fluid accordion settings_grammar",t.prototype.events={"click .title_checkbox>.input_checkbox":"inputcheck"},t.prototype.inputcheck=function(e){return e.stopPropagation()},t.prototype.initialize=function(e){return this.previewProfileModel=i.getPreviewProfileModel()},t.prototype.afterRender=function(){var e,t,n,i,r,o,a,l,c,u,d,p,f,h,m,v;for(a in(e=this.$el.find("form")).html(""),d=this.previewProfileModel,s){if(v=s[a],void 0===(p=d.get("grammar_"+v.meta))&&(p=v.default),n=p?"checked":"",c="",v.options){for(l in m=v.options){switch(u=m[l],h=void 0!==(f=d.get("grammar_"+v.meta+"_options_"+l))?f:u.value,r="",u.type||"string"){case"boolean":o="",h&&(o=" checked"),r='<div><input type="checkbox" '+o+' name="grammar_'+v.meta+"_options_"+l+'"></div>';break;default:r='<div><input type="text" value="'+h+'" name="grammar_'+v.meta+"_options_"+l+'" style="width: 100%;"></div>'}c=c+"<br/><div>"+u.title+": </div>\n"+r+"\n<div>"+u.description+"</div>"}c&&(c="<div>\u914d\u7f6e\u53c2\u6570\uff1a</div>"+c)}i='<div class="title">\n  <i class="dropdown icon"></i>\n  <span class="title_info">'+v.title+'</span>\n  <span class="title_checkbox"><input class="input_checkbox" type="checkbox" name="grammar_'+v.meta+'" '+n+'/></span>\n</div>\n<div class="content">\n  <p>\u5143\u6570\u636e\u6807\u8bc6: grammar_'+v.meta+"</p>\n  <div>"+c+"</div>\n  <p>"+v.description+"</p>\n</div>",t=$(i),e.append(t)}return this.$el.accordion({})},t.prototype.save=function(){var e,t,n,i,r,o,a;for(t in e=this.$el.find("form").serializeObject(),o={},s)if("on"===e["grammar_"+(a=s[t]).meta]?o["grammar_"+a.meta]=!0:o["grammar_"+a.meta]=!1,a.options)for(n in r=a.options){switch(r[n].type){case"boolean":"on"===e["grammar_"+a.meta+"_options_"+n]?e["grammar_"+a.meta+"_options_"+n]=!0:e["grammar_"+a.meta+"_options_"+n]=!1}o["grammar_"+a.meta+"_options_"+n]=e["grammar_"+a.meta+"_options_"+n]}return(i=this.previewProfileModel).set(o),i.save()},t}(a),n.exports=o}}),window.requirejs.define({"views/settings_network_view":function(e,t,n){var i,r,o,a,s,l,c={}.hasOwnProperty;a=t("./view"),r=t("../lib/notifier"),i=t("../application"),l=t("./templates/settings_network"),s=null,o=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)c.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.template=l,t.prototype.className="ui form",t.prototype.initialize=function(){return this.applicationProfileModel=i.getApplicationProfileModel()},t.prototype.events={"click .diagnose_url_button":"testProxyFn"},t.prototype.testProxyFn=function(e){var t,n,i,o,a,l;if(e.preventDefault(),e.stopPropagation(),!(n=$(e.currentTarget)).hasClass("loading"))return o=$.trim(this.$el.find("input[name=host]").val()),l={useProxy:!!(a=$.trim(this.$el.find("input[name=port]").val())),host:o,port:a,username:$.trim(this.$el.find("input[name=username]").val()),password:$.trim(this.$el.find("input[name=password]").val()),protocol:this.$el.find("select[name=protocol]").val(),url:$.trim(this.$el.find("input[name=diagnose_url]").val())||"https://www.google.com"},n.addClass("loading"),i=20,t=$('<div class="ui label massive circular" style="">'+i+"</div>"),n.after(t),s=setInterval((function(){return t.html(i--)}),1e3),$.get("/diagnose_proxy",l,(function(e){var i;if(clearInterval(s),s=null,t.remove(),n.removeClass("loading"),e.success)return r.showMessage("\u6d4b\u8bd5\u8fde\u63a5\u6210\u529f");try{i=JSON.stringify(e)}catch(e){}return r.showMessage("\u6d4b\u8bd5\u4ee3\u7406\u8fde\u63a5\u5931\u8d25:"+i,6e3,"error")}),"json")},t.prototype.getRenderData=function(){return{host:this.applicationProfileModel.get("proxyHost")||"",port:this.applicationProfileModel.get("proxyPort")||"",username:this.applicationProfileModel.get("proxyUsername")||"",password:this.applicationProfileModel.get("proxyPassword")||""}},t.prototype.afterRender=function(){var e,t;return e=this.applicationProfileModel.get("proxyProtocol")||"http:",t=this.applicationProfileModel.get("proxyOn")||!1,this.$el.find("select[name=protocol]").val(e),this.$el.find("input[name=useProxy]").prop("checked",!!t)},t.prototype.save=function(){var e,t,n,i,r,o,a;return o=this.$el.find("input[name=useProxy]").is(":checked"),t=$.trim(this.$el.find("input[name=host]").val()),i=$.trim(this.$el.find("input[name=port]").val()),a=$.trim(this.$el.find("input[name=username]").val()),n=$.trim(this.$el.find("input[name=password]").val()),r=this.$el.find("select[name=protocol]").val(),(e=this.applicationProfileModel).set({proxyOn:o,proxyProtocol:r,proxyHost:t,proxyPort:i,proxyUsername:a,proxyPassword:n}),e.save()},t}(a),n.exports=o}}),window.requirejs.define({"views/settings_preview_view":function(e,t,n){var i,r,o,a,s,l,c,u,d,p={}.hasOwnProperty;l=t("./view"),t("../lib/notifier"),o=t("../application"),a=t("../constant"),d=t("./templates/settings_preview"),(c=_.map(a.codeTheme)).unshift({name:"\u7981\u7528\u4ee3\u7801css",url:"blank"}),c.unshift({name:"\u81ea\u52a8",url:"auto"}),(u=_.map(a.previewTheme)).unshift({name:"\u7981\u7528\u7cfb\u7edfcss",url:"blank"}),r=null,i=null,s=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)p.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.template=d,t.prototype.className="ui form",t.prototype.initialize=function(){return this.previewProfileModel=o.getPreviewProfileModel()},t.prototype.getRenderData=function(){return{minimap:this.previewProfileModel.get("minimap")?"checked":void 0,disableVdomPreview:this.previewProfileModel.get("disableVdomPreview")?"checked":void 0,renderMetaTitle:this.previewProfileModel.get("renderMetaTitle")?"checked":void 0,renderMetaTag:this.previewProfileModel.get("renderMetaTag")?"checked":void 0,renderWrapImgTitle:this.previewProfileModel.get("renderWrapImgTitle")?"checked":void 0,renderWrapTableTitle:this.previewProfileModel.get("renderWrapTableTitle")?"checked":void 0,renderWrapDrawIOTitle:this.previewProfileModel.get("renderWrapDrawIOTitle")?"checked":void 0,renderImgBlock:this.previewProfileModel.get("renderImgBlock")?"checked":void 0,renderNestImgBlock:this.previewProfileModel.get("renderNestImgBlock")?"checked":void 0,renderAutoDetectAttachment:this.previewProfileModel.get("renderAutoDetectAttachment")?"checked":void 0,renderTitleLinkAsFootnote:this.previewProfileModel.get("renderTitleLinkAsFootnote")?"checked":void 0,renderLinkAsFootnote:this.previewProfileModel.get("renderLinkAsFootnote")?"checked":void 0,renderNumberedHeading:this.previewProfileModel.get("renderNumberedHeading")?"checked":void 0,useSystemPreviewCss:!1!==this.previewProfileModel.get("useSystemPreviewCss")?"checked":void 0}},t.prototype.afterRender=function(){var e,t,n,o,a,s,l,d,p,f,h,m,v,g,_,w,y,b,x,k,D,C,F,M,T,S;return T=this.previewProfileModel.get("systemPreviewCss"),w=this.previewProfileModel.get("codePreviewCss")||"auto",S=this.previewProfileModel.get("userPreviewCssText"),_=this.previewProfileModel.get("aliasLang"),M=this.previewProfileModel.get("renderNumberedHeadingOffset"),y=this.previewProfileModel.get("renderNumberedHeadingH1"),b=this.previewProfileModel.get("renderNumberedHeadingH2"),x=this.previewProfileModel.get("renderNumberedHeadingH3"),k=this.previewProfileModel.get("renderNumberedHeadingH4"),D=this.previewProfileModel.get("renderNumberedHeadingH5"),C=this.previewProfileModel.get("renderNumberedHeadingH6"),F=this.previewProfileModel.get("renderNumberedHeadingH7"),g=this.$el.find(".system_preview_select_css_container"),a=$("<select class='ui dropdown' name='systemPreviewCss'></select>"),$.each(u,(function(e,t){return a.append("<option value='"+t.url+"'>"+t.name+"</option>")})),g.append(a),a.val(T),a.dropdown(),r=a.parent(),n=this.$el.find(".code_preview_select_css_container"),t=$("<select class='ui dropdown' name='codePreviewCss'></select>"),$.each(c,(function(e,n){return t.append("<option value='"+n.url+"'>"+n.name+"</option>")})),n.append(t),t.val(w),t.dropdown(),i=t.parent(),o=this.$el.find("textarea[name=userPreviewCssText]"),e=this.$el.find("textarea[name=aliasLang]"),o.val(S),e.val(_),v=this.$el.find("input[name=renderNumberedHeadingOffset]"),s=this.$el.find("input[name=renderNumberedHeadingH1]"),l=this.$el.find("input[name=renderNumberedHeadingH2]"),d=this.$el.find("input[name=renderNumberedHeadingH3]"),p=this.$el.find("input[name=renderNumberedHeadingH4]"),f=this.$el.find("input[name=renderNumberedHeadingH5]"),h=this.$el.find("input[name=renderNumberedHeadingH6]"),m=this.$el.find("input[name=renderNumberedHeadingH7]"),v.val(M),s.val(y),l.val(b),d.val(x),p.val(k),f.val(D),h.val(C),m.val(F)},t.prototype.remove=function(){return t.__super__.remove.apply(this,arguments),i.dropdown("destroy"),i.remove(),i=null,r.dropdown("destroy"),r.remove(),r=null},t.prototype.save=function(){var e,t,n,o,a,s,l,c,u,d,p,f,h,m,v,g,_,w,y,b,x,k,D,C,$,F,M;return o=this.$el.find("input[name=minimap]").is(":checked"),n=this.$el.find("input[name=disableVdomPreview]").is(":checked"),d=this.$el.find("input[name=renderMetaTitle]").is(":checked"),u=this.$el.find("input[name=renderMetaTag]").is(":checked"),D=this.$el.find("input[name=renderWrapImgTitle]").is(":checked"),C=this.$el.find("input[name=renderWrapTableTitle]").is(":checked"),k=this.$el.find("input[name=renderWrapDrawIOTitle]").is(":checked"),l=this.$el.find("input[name=renderImgBlock]").is(":checked"),p=this.$el.find("input[name=renderNestImgBlock]").is(":checked"),s=this.$el.find("input[name=renderAutoDetectAttachment]").is(":checked"),x=this.$el.find("input[name=renderTitleLinkAsFootnote]").is(":checked"),c=this.$el.find("input[name=renderLinkAsFootnote]").is(":checked"),f=this.$el.find("input[name=renderNumberedHeading]").is(":checked"),$=r.dropdown("get value"),F=this.$el.find("input[name=useSystemPreviewCss]").is(":checked"),t=i.dropdown("get value"),M=this.$el.find("textarea[name=userPreviewCssText]").val(),e=this.$el.find("textarea[name=aliasLang]").val(),b=this.$el.find("input[name=renderNumberedHeadingOffset]").val(),h=this.$el.find("input[name=renderNumberedHeadingH1]").val(),m=this.$el.find("input[name=renderNumberedHeadingH2]").val(),v=this.$el.find("input[name=renderNumberedHeadingH3]").val(),g=this.$el.find("input[name=renderNumberedHeadingH4]").val(),_=this.$el.find("input[name=renderNumberedHeadingH5]").val(),w=this.$el.find("input[name=renderNumberedHeadingH6]").val(),y=this.$el.find("input[name=renderNumberedHeadingH7]").val(),(a=this.previewProfileModel).set({minimap:o,disableVdomPreview:n,renderMetaTitle:d,renderMetaTag:u,renderWrapImgTitle:D,renderWrapTableTitle:C,renderWrapDrawIOTitle:k,renderImgBlock:l,renderNestImgBlock:p,renderAutoDetectAttachment:s,renderTitleLinkAsFootnote:x,renderLinkAsFootnote:c,renderNumberedHeading:f,systemPreviewCss:$,useSystemPreviewCss:F,codePreviewCss:t,userPreviewCssText:M,aliasLang:e,renderNumberedHeadingOffset:b,renderNumberedHeadingH1:h,renderNumberedHeadingH2:m,renderNumberedHeadingH3:v,renderNumberedHeadingH4:g,renderNumberedHeadingH5:_,renderNumberedHeadingH6:w,renderNumberedHeadingH7:y}),a.save()},t}(l),n.exports=s}}),window.requirejs.define({"views/settings_tag_view":function(e,t,n){var i,r,o,a,s,l,c={}.hasOwnProperty;a=t("./view"),t("../lib/notifier"),i=t("../application"),o=t("../lib/user_dict_manager"),s=t("./templates/settings_tag"),l=null,r=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)c.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.template=s,t.prototype.className="ui form",t.prototype.initialize=function(){return this.applicationProfileModel=i.getApplicationProfileModel()},t.prototype.events={"click .tags_container .delete":"deleteTag","click .add_tag_button":"addTag","keydown .add_tag_input":"submitAddTag","click .words_container .delete":"deleteWord","click .add_word_button":"addWord","keydown .add_word_input":"submitAddWord"},t.prototype.submitAddWord=function(e){if(13===e.keyCode)return l.addWord(e)},t.prototype.addWord=function(e){var t,n,i,r,a;return t=l.$el.find(".add_word_container"),n=l.$el.find(".add_word_input"),r=$.trim(n.val()),$.trim(r)?(t.removeClass("error"),a=function(){var e,t,n,o;for(o=[],e=0,t=(n=r.split(",")).length;e<t;e++)i=n[e],$.trim(i)&&o.push($.trim(i));return o}(),o.addWords(a),a.forEach((function(e){return l._addWords(e)})),n.val("")):t.addClass("error")},t.prototype._addWords=function(e){var t;if(e)return 0===(t=l.$el.find(".user_words_container .ui.label[data-value='"+e+"']")).length&&(l.$el.find(".user_words_container").append('<div class="ui label" data-value="'+e+'">\n  '+e+'\n  <i class="delete icon"></i>\n</div>'),t=l.$el.find(".user_words_container .ui.label[data-value='"+e+"']")),t.transition("jiggle")},t.prototype.deleteWord=function(e){var t,n;if(!(t=$(e.currentTarget)).parent().hasClass("animating"))return n=t.parent().data("value"),t.parent().remove(),o.deleteWords(n)},t.prototype.submitAddTag=function(e){if(13===e.keyCode)return l.addTag(e)},t.prototype.addTag=function(e){var t,n,i,r,o;return t=l.$el.find(".add_tag_container"),n=l.$el.find(".add_tag_input"),o=$.trim(n.val()),$.trim(o)?(t.removeClass("error"),r=function(){var e,t,n,r;for(r=[],e=0,t=(n=o.split(",")).length;e<t;e++)i=n[e],$.trim(i)&&r.push($.trim(i));return r}(),$.each(r,(function(e,t){return l._addTag(t)})),n.val("")):t.addClass("error")},t.prototype._addTag=function(e){var t,n;if(e)return i.getTagModel().addTag(e,{type:"user"}),(n=l.$el.find(".auto_tags_container .ui.label[data-value='"+e+"']")).transition({animation:"scale",onComplete:function(){return n.remove()}}),0===(t=l.$el.find(".user_tags_container .ui.label[data-value='"+e+"']")).length&&(l.$el.find(".user_tags_container").append('<div class="ui label" data-value="'+e+'">\n  '+e+'\n  <i class="delete icon"></i>\n</div>'),t=l.$el.find(".user_tags_container .ui.label[data-value='"+e+"']")),t.transition("jiggle")},t.prototype.deleteTag=function(e){var t,n;if(!(t=$(e.currentTarget)).parent().hasClass("animating"))return n=t.parent().data("value"),i.getTagModel().deleteTag(n),t.parent().remove()},t.prototype.remove=function(){return t.__super__.remove.apply(this,arguments),l=null},t.prototype.afterRender=function(){var e,t,n,r,a,s,c,u,d,p,f,h,m,v,g,_,w;for(l=this,m=i.getTagModel(),n=this.$el.find(".user_words_container"),t=this.$el.find(".user_tags_container"),e=this.$el.find(".auto_tags_container"),s=0,d=(w=o.getWords()).length;s<d;s++)_=w[s],n.append('<div class="ui label" data-value="'+_+'">\n  '+_+'\n  <i class="delete icon"></i>\n</div>');for(m.getTags("auto"),c=0,p=(g=m.getTags("user")).length;c<p;c++)v=g[c],t.append('<div class="ui label" data-value="'+v+'">\n  '+v+'\n  <i class="delete icon"></i>\n</div>');for(h=[],u=0,f=(a=m.getTags("auto")).length;u<f;u++)r=a[u],h.push(e.append('<div class="ui label" data-value="'+r+'">\n  '+r+'\n  <i class="delete icon"></i>\n</div>'));return h},t.prototype.getRenderData=function(){return{autoAddTag:this.applicationProfileModel.get("autoAddTag")?"checked":void 0}},t.prototype.save=function(){var e,t;return t=this.$el.find("input[name=autoAddTag]").is(":checked"),(e=this.applicationProfileModel).set({autoAddTag:t}),e.save()},t}(a),n.exports=r}}),window.requirejs.define({"views/settings_view":function(e,t,n){var i,r,o,a,s,l,c,u,d,p,f,h,m,v,g,_,w,y,b,x={}.hasOwnProperty;p=t("./view"),s=t("./settings_grammar_view"),o=t("./settings_basic_view"),u=t("./settings_tag_view"),l=t("./settings_network_view"),a=t("./settings_editor_view"),c=t("./settings_preview_view"),r=t("../lib/notifier"),i=t("../application"),y=t("./templates/settings"),f=null,h=null,w=null,g=null,m=null,_=null,v=null,b=null,d=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)x.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.template=y,t.prototype.className="ui fullscreen story_modal modal",t.prototype.initialize=function(){return b=this,this.applicationProfileModel=i.getApplicationProfileModel(),this.editorProfileModel=i.getEditorProfileModel(),this.previewProfileModel=i.getPreviewProfileModel()},t.prototype.afterRender=function(){if("client"===STORY_PLATFORM)return this.$el.find(".item.network").css("display","")},t.prototype.show=function(){return this.render(),this.dimmer=this.$el.find(".story_content").dimmer({closable:!1,variation:"inverted",opacity:.4}),this.$el.find(".dimmer").html('<div class="ui indeterminate text loader">\u5904\u7406\u4e2d...</div>'),this.$el.modal({allowMultiple:!0,closable:!1,onHidden:function(){return null!=h&&h.remove(),h=null,null!=w&&w.remove(),w=null,null!=g&&g.remove(),g=null,null!=m&&m.remove(),m=null,null!=_&&_.remove(),_=null,null!=v&&v.remove(),v=null,f=null,b.$el.find(".ui.menu .item").tab("destroy"),b.$el.modal("destroy"),b.remove(),b=null},onApprove:function(e){return null!=h&&h.save(),null!=w&&w.save(),null!=g&&g.save(),null!=m&&m.save(),null!=_&&_.save(),null!=v&&v.save(),$(window).trigger("changeSettings"),!e.hasClass("ok")||(r.showMessage("\u66f4\u65b0\u914d\u7f6e\u6210\u529f"),!1)}}),this.$el.find(".ui.menu .item").tab({onFirstLoad:function(e){var t,n,i,r,d;return"grammar"===e?(i=b.$el.find(".settings_grammar_tab"),v=new s({settingsView:b}),i.html("").append(v.render().$el),f=v):"basic"===e?(t=b.$el.find(".settings_basic_tab"),h=new o({settingsView:b}),t.html("").append(h.render().$el),f=h):"tag"===e?(d=b.$el.find(".settings_tag_tab"),w=new u({settingsView:b}),d.html("").append(w.render().$el),f=w):"network"===e?(r=b.$el.find(".settings_network_tab"),g=new l({settingsView:b}),r.html("").append(g.render().$el),f=g):"editor"===e?(n=b.$el.find(".settings_editor_tab"),m=new a({settingsView:b}),n.html("").append(m.render().$el),"function"==typeof(f=m).afterAppendInit?f.afterAppendInit():void 0):"preview"===e?(n=b.$el.find(".settings_preview_tab"),_=new c({settingsView:b}),n.html("").append(_.render().$el),f=_):void 0},onLoad:function(e){return"grammar"===e?f=v:"basic"===e?f=h:"tag"===e?f=w:"network"===e?f=g:"editor"===e?f=m:"preview"===e?f=_:void 0}}),this.$el.find(".ui.menu .item[data-tab=basic]").tab("change tab","basic"),this.$el.modal("show")},t}(p),n.exports=d}}),window.requirejs.define({"views/sidebar_view":function(e,t,n){var i,r,o,a,s,l,c,u,d,p,f,h,m,v,g,w,y,b,x,k,D=function(e,t){return function(){return e.apply(t,arguments)}},C={}.hasOwnProperty;w=t("./view"),k=t("./templates/sidebar"),r=t("../application"),g=t("../lib/utils"),p=t("./settings_view"),d=t("./client_public_file_dialog_view"),c=t("./import_file_dialog_view"),a=t("./change_store_plugin_dialog_view"),u=t("./public_email_dialog_view"),s=t("./client_public_email_dialog_view"),m=t("./templates_manager_view"),h=t("./snippets_manager_view"),o=t("./bind_keyboards_manager_view"),i=t("./about_view"),v=t("./user_manager_view"),l=t("./database_view"),b=null,y=null,x=function(e){if(b&&0===$("body>.ui.dimmer.modals.visible").length)return b.light.position.x=e.clientX,b.light.position.y=e.clientY,b.draw()},f=function(e){var t;function n(){return this.publicEmail=D(this.publicEmail,this),this.changeStorePlugin=D(this.changeStorePlugin,this),this.export=D(this.export,this),this.import=D(this.import,this),this.publicFile=D(this.publicFile,this),this.database=D(this.database,this),this.settings=D(this.settings,this),this.about=D(this.about,this),this.user=D(this.user,this),n.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)C.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(n,e),n.prototype.template=k,n.prototype.className="ui left vertical inverted labeled icon sidebar menu",t=!1,n.prototype.events={"click .user_button":"user","click .templates_manager_button":"templates","click .snippets_manager_button":"snippets","click .about_button":"about","click .settings_button":"settings","click .database_button":"database","click .import_button":"import","click .export_button":"export","click .keyboard_button":"keyboard","click .change_store_plugin_button":"changeStorePlugin","click .public_email_file_button":"publicEmail","click .public_button":"publicFile"},n.prototype.keyboard=function(){return(new o).show()},n.prototype.templates=function(){return(new m).show()},n.prototype.snippets=function(){return(new h).show()},n.prototype.user=function(){return(new v).show()},n.prototype.about=function(){return(new i).show()},n.prototype.isOpen=function(){return t},n.prototype.settings=function(){return(new p).show()},n.prototype.database=function(){return(new l).show()},n.prototype.publicFile=function(){var e;return e=r.homeView.fileModel,new d({model:e}).show()},n.prototype.import=function(){return(new c).show()},n.prototype.export=function(){return $(window).trigger("exportFileModel")},n.prototype.changeStorePlugin=function(){return(new a).show()},n.prototype.publicEmail=function(){var e;return e=r.homeView.fileModel,"web"===STORY_PLATFORM?new u({model:e}).show():new s({model:e}).show()},n.prototype.toggleShow=function(){return this.$el.sidebar("toggle")},n.prototype.afterRender=function(){var e,n,i,r,o;return e=this.$el.find(".public_button"),$("body").prepend(this.$el),"client"===STORY_PLATFORM?e.show():e.hide(),MINI_WEB&&(this.$el.find(".user_button,.public_email_file_button").remove(),DOCKER_VERSION||GITHUB_PAGE_WEB||this.$el.find(".change_store_plugin_button").remove()),o=this,i=function(){return o.$el.sidebar("hide")},r=null,n=this.$el,this.$el.sidebar({onShow:function(){var e,o,a,s;return b&&(b.destroy(),b=null),y&&(y.transition("stop all"),null!=y&&y.remove(),y=null),e="",o="",(s=$(".main_avatar_button_font")[0])&&(o='<span class="shine_xsj_logo_avatar">'+_.escape(s.textContent)+"</span>"),window.IDIOM&&(e="xsj_logo_idiom"),a="\u5c0f\u4e66\u5320",MINI_WEB&&(a="\u5c0f\u4e66\u5320\u73b2\u73d1\u7248"),DOCKER_VERSION&&(a="\u5c0f\u4e66\u5320\u5929\u9a6c\u7248"),y=$('<div class="xsj_logo_container transition hidden '+e+'">'+o+'<span class="shine_xsj_logo">'+a+"</span></div>"),MAC_STORE_WEB&&(a="\u5c0f\u4e66\u5320\u94f6\u674f\u7248",y=$('<div class="xsj_logo_container transition hidden '+e+'">'+o+'<span class="shine_xsj_logo"  style="font-family: \'Libian SC\', sans-serif;">'+a+"</span></div>")),GITHUB_PAGE_WEB&&(a="\u5c0f\u4e66\u5320\u62db\u8d22\u732b\u7248",y=$('<div class="xsj_logo_container transition hidden '+e+'">'+o+'<span class="shine_xsj_logo"  style="font-family: \'Libian SC\', sans-serif;">'+a+"</span></div>")),$("body").append(y),g.asyncLoadResources([{id:"shine_js",type:"script",filename:"js/shine/shine.js"}],(function(){return setTimeout((function(){var e;if(t)return e=new shinejs.Config({numSteps:14,opacity:.4,opacityPow:4.1,offset:.22,offsetPow:1.3,blur:40,blurPow:1}),null!=y?y.transition({animation:"browse",onComplete:function(){var n,i;if(t)return b=new shinejs.Shine(y.find(".shine_xsj_logo")[0],e),window.IDIOM&&(i=$("#idiomFontCss").length>0,n=$('<div class="idiom_content">'+window.IDIOM+"</div>"),i?n.css({fontFamily:"myfont",fontSize:"25px"}):window.fetch("http://fonts.xiaoshujiang.com/font?text="+encodeURIComponent(window.IDIOM)).then((function(e){return e.json()})).then((function(e){if(e&&e.cssStr)return g.importCssString(e.cssStr,"idiomFontCss",!0),$(".idiom_content").css({fontFamily:"myfont",fontSize:"25px"})})),y.append(n)),$("body").on("mousemove",x)}}):void 0}),100)})),$(".pusher").on("click",i),r=jwerty.key("esc",(function(){if(!($(".ui.modal").length>0))return n.sidebar("hide")}))},onHide:function(){if(y.transition("stop all"),null!=b&&b.destroy(),b=null,y.transition({animation:"browse",onComplete:function(){return null!=y&&y.remove(),y=null}}),$("body").off("mousemove",x),$(".pusher").off("click",i),r)return r.unbind(),r=null},onVisible:function(){return $("#main").addClass("sidebar_opened"),$(".pusher").show(),t=!0},onHidden:function(){return $("#main").removeClass("sidebar_opened"),$(".pusher").hide(),t=!1,$(window).trigger("sidebarHidden")}}).sidebar("setting",{transition:"scale down",closable:!1}),this},n}(w),n.exports=f}}),window.requirejs.define({"views/single_popup_manager_view":function(e,t,n){var i,r,o,a,s,l,c,u,d={}.hasOwnProperty;t("../application"),i=t("./base_window_manager_view"),s=t("./table_component/table_manager_view"),r=t("./drawio_component/drawio_manager_view"),o=t("./image_editor_component/image_editor_manager_view"),u=null,a=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)d.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.type="table",t.prototype.current=null,t.prototype.local_storage_name="single_popup_manager",t.prototype.show=function(e,n){var i,a;switch(t.__super__.show.call(this),this.type=e,n=$.extend({popupManager:this},n),i=this.$el.find(".draggable_dialog_content_container_wrapper"),e){case"table":return(a=new s(n)).show(i),this.current=a;case"drawio":return(a=new r(n)).show(i),this.current=a;case"image":return(a=new o(n)).show(i),this.current=a}},t.prototype.reInit=function(e){var t;return null!=(t=this.current)?t.reInit(e):void 0},t.prototype.close=function(){var e;return null!=(e=this.current)&&e.close(),this.current=null,u=null,t.__super__.close.call(this)},t.prototype.reInit=function(e){var t;return null!=(t=this.current)?t.reInit(e):void 0},t}(i),c=function(e,t){return u?u.type!==e?(u.close(),(u=new a).show(e,t)):(u.focus(),u.$el.transition("jiggle"),u.$el.visible()||u.fixPosition(),u.reInit(t)):(u=new a).show(e,t)},l=function(){return null!=u?u.close():void 0},n.exports={showPopupView:c,hidePopupView:l}}}),window.requirejs.define({"views/snippets_manager_view":function(e,t,n){var i,r,o,a,s,l,c,u,d,p,f,h={}.hasOwnProperty;l=t("./view"),o=t("../lib/notifier"),i=t("../application"),r=t("../lib/config_sync"),s=t("../lib/utils"),p=t("./templates/snippets_manager"),f=null,u=null,d=0,c=null,a=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)h.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(n,e),n.prototype.template=p,n.prototype.className="ui fullscreen story_modal modal snippets_manager_modal",n.prototype.defaultSnippetId=null,n.prototype.attachments={},n.prototype.initialize=function(){return this.applicationProfileModel=i.getApplicationProfileModel(),this.defaultSnippetId=this.applicationProfileModel.get("defaultSnippetId")},n.prototype.events={"click .save_button":"createOrUpdateSnippetFn","click .new_button":"createNewSnippetFn","click .default_button":"setDefaultSnippetFn","click .remove_button":"removeSnippetFn","click .modify_button":"modifySnippetFn","click .cancel_button":"cancelModifySnippetFn","click .previous_button":"previousPageFn","click .next_button":"nextPageFn","click .attachment_item":"downloadAttachmentFn","click .delete_attachment":"deleteAttachmentFn","click .drop-zone":"selectFileFn","click .save_basic_button":"saveBasicSnippetFn","click .modify_basic_button":"modifyBasicSnippetFn","click .cancel_basic_button":"cancelBasicSnippetFn","click .export_snippets_button":"exportSnippetsFn","click .import_snippets_button":"importSnippetsFn","click .help_button":"helpFn"},n.prototype.helpFn=function(){return window.openTarget("http://soft.xiaoshujiang.com/docs/tutorial/snippet/")},n.prototype.exportSnippetsFn=function(){return f.dumpPouchDB()},n.prototype.importSnippetsFn=function(){return f.$el.find("input[name=importSnippets]").trigger("click")},n.prototype.dumpPouchDBByBlob=function(){var e,t,n;return"snippets.dump",e=new xsjStream.BlobStream(null,{readable:!1}),t=null,e.on("finish",(function(){return t=this.toBlob(),console.log("finished ...")})),n=r.getCurrentConfigDB(),f.dimmer.dimmer("show"),n.dump(e,{batch_size:1,filter:function(e){return!(!e.type||"snippet"!==e.type)}}).then((function(){return null!=f&&f.dimmer.dimmer("hide"),o.showMessage("\u5bfc\u51fa\u6210\u529f",3e3,"info"),saveAs(t,moment().format("YYYY-MM-DD")+"_snippets.xsj")})).catch((function(e){return null!=f&&f.dimmer.dimmer("hide"),o.showMessage("\u5bfc\u51fa\u5931\u8d25: "+e,6e3,"error")}))},n.prototype.dumpPouchDB=function(){if(confirm("\u786e\u8ba4\u662f\u5426\u5bfc\u51fa\u6240\u6709\u7247\u6bb5\u6570\u636e"))return window.requestFileSystem?(f.dumpPouchDBByFileSystem((function(){return f.dumpPouchDBByBlob()})),console.log("use filesystem dump")):(f.dumpPouchDBByBlob(),console.log("use blob dump"))},n.prototype.dumpPouchDBByFileSystem=function(e){var t,n,i;return"snippets.dump",n=function(t){return e?e():o.showMessage("\u5bfc\u51fa\u5931\u8d25: "+t,6e3,"error")},i=function(e){var n;return n=function(){return e.root.getFile("snippets.dump",{create:!0},(function(e){return t(e)}))},e.root.getFile("snippets.dump",null,(function(e){return e.remove(n,n)}),n)},t=function(e){var t,n;return t=new xsjStream.FileSystemStream(e),n=r.getCurrentConfigDB(),f.dimmer.dimmer("show"),n.dump(t,{batch_size:1,filter:function(e){return!(!e.type||"snippet"!==e.type)}}).then((function(){var t;return null!=f&&f.dimmer.dimmer("hide"),o.showMessage("\u5bfc\u51fa\u6210\u529f",3e3,"info"),(t=document.createElement("a")).href=e.toURL(),t.download=moment().format("YYYY-MM-DD")+"_snippets.xsj",t.click()})).catch((function(e){return null!=f&&f.dimmer.dimmer("hide"),o.showMessage("\u5bfc\u51fa\u5931\u8d25: "+e,6e3,"error")}))},requestFileSystem(window.TEMPORARY,5368709120,i,n)},n.prototype.saveBasicSnippetFn=function(){var e;if(f.save(),o.showMessage("\u4fdd\u5b58\u57fa\u7840\u7247\u6bb5\u6210\u529f"),e=f.$el.find(".snippets_container tbody tr"),f.$el.find(".new_button").show(),0!==e.length)return f.showSnippetsContainer()},n.prototype.modifyBasicSnippetFn=function(){return f.showDefaultSnippetContainer()},n.prototype.cancelBasicSnippetFn=function(){return f.showSnippetsContainer()},n.prototype.selectFileFn=function(){return f.$el.find("input[name=attachments]").trigger("click")},n.prototype.deleteAttachmentFn=function(e){var t,n;return e.preventDefault(),e.stopPropagation(),n=(t=$(e.currentTarget).parent()).data("id"),delete f.attachments[n],t.remove()},n.prototype.downloadAttachmentFn=function(e){var t,n,i,r,o;return r=$(e.currentTarget).data("id"),t=f.attachments[r],n=s.base642Blob(t.data,t.content_type),(o=(i=r).lastIndexOf("/"))>0&&(i=i.substring(o+1)),saveAs(n,i)},n.prototype.previousPageFn=function(e){if(!$(e.currentTarget).hasClass("disabled"))return u?f._renderSnippets(u):o.showMessage("\u5df2\u7ecf\u662f\u7b2c\u4e00\u9875",1e3,"warning")},n.prototype.nextPageFn=function(e){if(!$(e.currentTarget).hasClass("disabled"))return c?f._renderSnippets(null,c):o.showMessage("\u5df2\u7ecf\u662f\u6700\u540e\u4e00\u9875",1e3,"warning")},n.prototype.cancelModifySnippetFn=function(){return 0===f.$el.find(".snippets_container tbody tr").length?f.showDefaultSnippetContainer(!0):f.showSnippetsContainer()},n.prototype.modifySnippetFn=function(e){var t;return t=$(e.currentTarget).parent().parent().parent().data("id"),r.getSnippet(t,{attachments:!0,binary:!1},(function(e,t){var n,i;return e?o.showMessage("\u8bfb\u53d6\u7247\u6bb5\u5931\u8d25:"+e,6e3,"error"):(f.$el.find("input[name=snippetName]").val(t.snippetName),f.$el.find("input[name=canScript]").prop("checked",!!t.canScript),f.$el.find("input[name=id]").val(t._id),f.$el.find("textarea[name=content]").val(t.content),i=t.mode||"normal",["normal","ace","codemirror"].indexOf(i)<0&&(i="normal"),f.$el.find("input[name=snippetMode][value="+i+"]").prop("checked",!0),n=f.$el.find(".attachments_container"),f.attachments={},n.empty(),$.each(t._attachments||{},(function(e,t){var i;return i=$("<div></div>").text(e).html(),n.append('<a class="item attachment_item" data-id="'+i+'">'+i+' &nbsp;&nbsp;<i class="remove red icon delete_attachment"></i></a>'),f.attachments[e]={data:t.data,content_type:"application/octet-stream"}})),f.showSnippetContainer())}))},n.prototype.removeSnippetFn=function(e){var t,n,i;return t=$(e.currentTarget),i=(n=t.parent().parent().parent()).data("id"),r.deleteSnippet(i,(function(e){var t;return e?o.showMessage("\u5220\u9664\u5931\u8d25:"+e,6e3,"error"):(t=n.parent(),n.remove(),0!==t.find("tr").length||u||c?void 0:f.showDefaultSnippetContainer(!0))}))},n.prototype.showSnippetsContainer=function(){return f.$el.find(".snippets_container").show(),f.$el.find(".pagination_button").show(),f.$el.find(".snippet_container").hide(),f.$el.find(".snippet_default").hide(),f.$el.find(".need_disabled").addClass("disabled"),f.$el.find(".attachments_container").empty(),f.attachments={},f.$el.find(".save_button").hide(),f.$el.find(".cancel_button").hide(),f.$el.find(".new_button").show(),f.$el.find(".save_basic_button").hide(),f.$el.find(".cancel_basic_button").hide(),f.$el.find(".modify_basic_button").show(),f.$el.find(".export_snippets_button").show(),f.$el.find(".import_snippets_button").show()},n.prototype.showDefaultSnippetContainer=function(e){return null==e&&(e=!1),f.$el.find(".snippets_container").hide(),f.$el.find(".pagination_button").hide(),f.$el.find(".snippet_container").hide(),f.$el.find(".snippet_default").show(),f.$el.find(".attachments_container").empty(),f.attachments={},f.$el.find(".save_button").hide(),f.$el.find(".cancel_button").hide(),f.$el.find(".export_snippets_button").hide(),e?(f.$el.find(".new_button").show(),f.$el.find(".import_snippets_button").show(),f.$el.find(".cancel_basic_button").hide()):(f.$el.find(".new_button").hide(),f.$el.find(".import_snippets_button").hide(),f.$el.find(".cancel_basic_button").show()),f.$el.find(".modify_basic_button").hide(),f.$el.find(".save_basic_button").show()},n.prototype.showSnippetContainer=function(){return f.$el.find(".snippets_container").hide(),f.$el.find(".pagination_button").hide(),f.$el.find(".snippet_container").show(),f.$el.find(".snippet_default").hide(),f.$el.find(".save_button").show(),f.$el.find(".cancel_button").show(),f.$el.find(".new_button").hide(),f.$el.find(".modify_basic_button").hide(),f.$el.find(".save_basic_button").hide(),f.$el.find(".cancel_basic_button").hide(),f.$el.find(".export_snippets_button").hide(),f.$el.find(".import_snippets_button").hide()},n.prototype.setDefaultSnippetFn=function(e){var t,n,i;return i=(t=$(e.currentTarget).parent().parent().parent()).data("id"),f.$el.find(".default_snippet").removeClass("default_snippet positive"),t.addClass("default_snippet positive"),f.defaultSnippetId=i,(n=f.applicationProfileModel).set({defaultSnippetId:i}),n.save()},n.prototype.createOrUpdateSnippetFn=function(){var e,t,n,i,a,s;return console.log("create or update"),i=f.$el.find("input[name=id]").val(),s=$.trim(f.$el.find("input[name=snippetName]").val()),e=f.$el.find("input[name=canScript]").is(":checked"),t=f.$el.find("textarea[name=content]").val(),a=this.$el.find("input[name=snippetMode]:checked").val(),n={_id:i,snippetName:s,canScript:e,content:t,mode:a,_attachments:f.attachments},r.createOrUpdateSnippet(n,(function(e,t){return e?o.showMessage("\u4fdd\u5b58\u51fa\u9519:"+e,6e3,"error"):(n._id=t.id,n._rev=t.rev,f.$el.find("."+n._id).remove(),f.showSnippetsContainer(),o.showMessage("\u4fdd\u5b58\u6210\u529f"),f._renderSnippets())}))},n.prototype._renderSnippet=function(e,t){var n,i,r,o;return o=0,void 0!==t&&(o=d+t+1),n=f.$el.find(".snippets_container_body"),r="",e._id===f.defaultSnippetId&&(r="positive default_snippet"),i=$("<div></div>").text(e.snippetName).html()||"\u672a\u547d\u540d\u7247\u6bb5\u6587\u4ef6",n.append('<tr class="'+e._id+" "+r+'" data-id="'+e._id+'">\n  <td>'+o+"</td>\n  <td>"+i+"("+e._id+')</td>\n  <td>\n    <div">\n      <div class="ui basic mini button default_button">\u9ed8\u8ba4</div>\n      <div class="ui basic mini button modify_button">\u4fee\u6539</div>\n      <div class="ui basic mini button remove_button">\u5220\u9664</div>\n    </div>\n  </td>\n</tr>')},n.prototype._renderSnippets=function(e,t){var n;return e||t||(d=0),n={type:"snippet",sort:{$lt:[]},updateDate:{$lt:[]}},e&&((d-=20)<0?(d=0,e=null,t=null):n={type:"snippet",sort:{$gt:e.sort||null},updateDate:{$gt:e.updateDate||null}}),t&&(n={type:"snippet",sort:{$lt:t.sort||[]},updateDate:{$lt:t.updateDate||[]}},d+=20),this.dimmer.dimmer("show"),r.getSnippets(n,21,!!e,(function(n,i){return f.dimmer.dimmer("hide"),n?o.showMessage("\u52a0\u8f7d\u7247\u6bb5\u51fa\u9519\uff1a"+n,6e3,"error"):(f.$el.find(".snippets_container_body").empty(),c=null,u=null,e&&(c=i.docs[i.docs.length-1],u=null),t&&(c=null,u=i.docs[0]),21===i.docs.length&&(e?(i.docs.shift(),u=i.docs[0]):(i.docs.pop(),c=i.docs[i.docs.length-1])),u?f.$el.find(".previous_button").removeClass("disabled"):f.$el.find(".previous_button").addClass("disabled"),c?f.$el.find(".next_button").removeClass("disabled"):f.$el.find(".next_button").addClass("disabled"),i.docs.length+d>0&&f.showSnippetsContainer(),i.docs.forEach(f._renderSnippet))}))},n.prototype.createNewSnippetFn=function(){return f.showSnippetContainer(),f.$el.find("input[type!=radio]").val(""),f.$el.find("textarea[name=content]").val(f.$el.find("textarea[name=defaultSnippet]").val()),f.$el.find("input[name=snippetMode][value=normal]").prop("checked",!0),f.$el.find(".attachments_container").empty(),f.attachments={}},n.prototype.remove=function(){return n.__super__.remove.apply(this,arguments),c=null,u=null,f=null},n.prototype.afterRender=function(){var e,t,n,a;return t=this.applicationProfileModel.get("defaultSnippet")||"",(f=this).$el.find(".pagination_button, .init_hide_button").hide(),this.$el.find("textarea[name=defaultSnippet]").val(t),e=f.$el.find(".attachments_container"),n=function(t){return s.insertImageFiles(t,(function(t,n){var r,a,l,c,u,d,p;if(!t){for(f.$el.find("input[name=attachments]").val(""),p=[],c=0,u=n.length;c<u;c++)d=n[c],a=d.content,d.path,l=d.file,r=s.dataURL2Blob(a),p.push(s.blobToMd5(r,(function(t,n){var o,s,c,u,d;return d=i.getUploadFilePath(l.type,null,l.name,n,r),s=$("<div></div>").text(d).html(),c=a.split(",")[1],f.attachments[d]||e.append('<a class="item attachment_item" data-id="'+s+'">'+s+' &nbsp;&nbsp;<i class="remove red icon delete_attachment"></i></a>'),u=(o=f.$el.find("textarea[name=content]")).val(),u+="\n![](./"+d+")",o.val(u),f.attachments[d]={data:c,content_type:l.type}})));return p}o.showMessage("error: +"+t,6e3,"error")}))},s.initFileImportSupport(f.$el.find("input[name=attachments]"),n),s.initdragFilesSupport(f.$el.find(".drop-zone"),n),a=function(e){var t,n,i;if(e.length>0)return n=e[0],i=fileReaderStream(n,{chunkSize:20971520}),t=r.getCurrentConfigDB(),f.dimmer.dimmer("show"),t.load(i).then((function(){return null!=f&&f.dimmer.dimmer("hide"),o.showMessage("\u5bfc\u5165\u6210\u529f",3e3,"info"),f._renderSnippets()})).catch((function(e){return null!=f&&f.dimmer.dimmer("hide"),o.showMessage("\u5bfc\u5165\u5931\u8d25: "+e,6e3,"error")}))},s.initFileImportSupport(f.$el.find("input[name=importSnippets]"),a)},n.prototype.getRenderData=function(){return{}},n.prototype.save=function(){var e,t;return t=this.$el.find("textarea[name=defaultSnippet]").val(),(e=this.applicationProfileModel).set({defaultSnippet:t}),e.save()},n.prototype.show=function(){return f=this,this.render(),this.dimmer=s.xsjDimmer(this.$el),this.dimmer.dimmer("show"),t("../lib/dynamic_import/import_pouchdb_replication_stream")((function(){return f.$el.modal({closable:!1,onVisible:function(){return f.showDefaultSnippetContainer(!0),c=null,u=null,f._renderSnippets()},onHidden:function(){return f.$el.modal("destroy"),f.remove()}}).modal("show")}))},n}(l),n.exports=a}}),window.requirejs.define({"views/start_fail_view":function(e,t,n){var i,r,o,a,s={}.hasOwnProperty;r=t("./view"),a=t("./templates/start_fail"),o=!1,i=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)s.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.template=a,t.prototype.fileCollection=null,t.prototype.className="load_fail_message sub header",t.prototype.initialize=function(e){return this.fileCollection=e.fileCollection},t.prototype.events={"click .reload_btn":"reloadFn","click .reset_btn":"resetFn"},t.prototype.reloadFn=function(e){var t,n,i,r;if(!o){for(o=!0,t=0,r=(i=Object.keys(localStorage)).length;t<r;t++)"fileTabs"!==(n=i[t])&&"layoutResizeState"!==n&&"tagNames"!==n&&"startStatus"!==n||localStorage.removeItem(n),n.startsWith("xiaoshujiang_file")&&localStorage.removeItem(n),n.startsWith("xiaoshujiang_group_tab")&&localStorage.removeItem(n);return setTimeout((function(){return document.location.reload()}),600)}},t.prototype.resetFn=function(e){if(!o)return o=!0,localStorage.clear(),setTimeout((function(){return document.location.reload()}),600)},t}(r),n.exports=i}}),window.requirejs.define({"views/statics_count_view":function(e,t,n){var i,r={}.hasOwnProperty;i=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)r.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,Backbone.View),t.prototype.className="statics_count",t.prototype.editorView=null,t.prototype.throttleStaticsCount=null,t.prototype.initialize=function(e){return this.editorView=e.editorView},t.prototype.initStatics=function(){var e;return this.render(),this.editorView.$el.append(this.$el),this.throttleStaticsCount=_.throttle((e=this,function(){var t,n,i,r,o,a,s,l,c,u,d,p;return t=e.$el,i=e.editorView.getValue(),p=e.editorView.getCursorPositionXY(),c=e.editorView.getSelectionRange(),u=e.editorView.getLength(),s=Math.abs(c.end-c.start),r=i.length,s>0?(l=(a=i.substring(c.start,c.end)).split("\n").length,d=(a.match(new RegExp("\\S+","g"))||[]).length,n=(a.match(new RegExp("\\S","g"))||[]).length,o=(a.match(new RegExp("\\S.*","g"))||[]).length,t.attr("title","\u5b57\u7b26\u6570\uff1a"+n+" \u5b57\u6570\uff1a"+d+"\u6bb5\u843d\u6570\uff1a"+o),t.html("\u9009\u62e9\u884c\u6570\uff1a"+l+" \u9009\u62e9\u957f\u5ea6\uff1a"+s)):(d=(i.match(new RegExp("\\S+","g"))||[]).length,n=(i.match(new RegExp("\\S","g"))||[]).length,o=(i.match(new RegExp("\\S.*","g"))||[]).length,t.html("["+(p.row+1)+":"+p.column+"]\u884c\u6570\uff1a"+u+" \u957f\u5ea6\uff1a"+r),t.attr("title","\u5b57\u7b26\u6570\uff1a"+n+" \u5b57\u6570\uff1a"+d+"\u6bb5\u843d\u6570\uff1a"+o))}),100),this.editorView.on("changeCursor",this.throttleStaticsCount),this.editorView.on("changeSelection",this.throttleStaticsCount)},t.prototype.remove=function(){return this.throttleStaticsCount.cancel(),this.editorView.off("changeCursor",this.throttleStaticsCount),this.editorView.off("changeSelection",this.throttleStaticsCount),t.__super__.remove.apply(this,arguments)},t}(),n.exports=i}}),window.requirejs.define({"views/store_files_list_view":function(e,t,n){var i,r,o,a,s,l={}.hasOwnProperty;a=t("./view"),i=t("../application"),t("../constant"),r=t("../lib/notifier"),s=t("./templates/store_files_list"),o=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)l.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.className="store_files_list_container blurring",t.prototype.template=s,t.prototype.events={"click .list_pagination>.item":"pageNavigationFn","click .file_item":"getFileFn","click .file_item .forceUpdate_button":"getFileForceUpdateFn","mousewheel .list_pagination":"horizontallyScrollFn"},t.prototype.horizontallyScrollFn=function(e,t){return $(e.currentTarget)[0].scrollLeft-=30*t,e.preventDefault()},t.prototype.getFileForceUpdateFn=function(e){return e.preventDefault(),e.stopPropagation(),$(e.currentTarget)},t.prototype.getFileFn=function(e){var t,n,i;return e.preventDefault(),e.stopPropagation(),n=(t=$(e.currentTarget)).data("guid"),i=t.data("parent-path"),$(window).trigger("importFileByPlugin",[this.model,n,i||"",{forceUpdate:!1},function(){}])},t.prototype.afterRender=function(){var e;return e=this.model,$.contextMenu({selector:".store_files_list_container",trigger:"right",events:{hide:function(e){return e.$trigger.find(".file_item.active").removeClass("active")}},build:function(t,n){var i,r,o;return 1===(i=t.find(".file_item:hover")).length&&(i.addClass("active"),r=i.data("guid"),o=i.data("parent-path"),{items:{forceUpdate:{icon:"fas fa-download",name:"\u5f3a\u5236\u66f4\u65b0\u672c\u5730\u5bf9\u5e94\u7f13\u5b58\u6587\u7ae0",callback:function(){return $(window).trigger("importFileByPlugin",[e,r,o||"",{forceUpdate:!0},function(){}])}}}})}})},t.prototype.pageNavigationFn=function(e){var t;return t=$(e.currentTarget).data("page"),this.search(this.queryOpt,t)},t.prototype.initialize=function(e){return this.plugin=e.plugin,this.model=e.model},t.prototype.search=function(e,t,n,o,a){var s,l,c;return null==t&&(t=1),null==n&&(n=10),null==o&&(o={}),!(null!=(l=i.getUserModel().get("user"))?l.vip:void 0)&&(n=5,t>1)?(r.showMessage("\u52a0\u8f7d\u51fa\u9519: \u975e\u4f1a\u5458\u53ea\u80fd\u52a0\u8f7d\u7b2c\u4e00\u9875\u67e5\u8be2\u7ed3\u679c",6e3,"error"),void("function"==typeof a&&a())):(this.$el.dimmer("show"),this.page=t,this.pageSize=n,this.queryOpt=e,s=$.extend({},{pageSize:this.pageSize,offset:this.pageSize*(this.page-1)},e),this.plugin.searchFiles({},s,(c=this,function(e,t){var n,i,s,l,u;if(c.$el.dimmer("hide"),e)r.showMessage("\u52a0\u8f7d\u51fa\u9519: "+e,6e3,"error");else if(c.$el.find(".list_results,.list_pagination,.list_blank").remove(),t.total>0){if(i=$("<div class='list_results ui ordered list selection' style='counter-reset: ordered "+t.offset+"'></div>"),t.files.forEach((function(e){var t;return t=[],o.flatTagsObj&&(e.orign.tagGuids||[]).forEach((function(e){var n;if(n=o.flatTagsObj[e])return t.push(n.name)})),i.append('<div class="item file_item" data-guid="'+_.escape(e.guid)+'" data-parent-path="'+_.escape(e.parentPath)+'">\n  <div class="content">\n    <div class="header">\n    '+_.escape(e.title)+'\n    </div>\n    <div class="description">\n    '+_.escape(t.join(","))+"\n    </div>\n  </div>\n</div>")})),c.$el.append(i),(u=Math.ceil(t.total/t.pageSize))>1){for(n=$('<div class="list_pagination ui pagination mini menu borderless">\n</div>'),l=1;l<=u;)s=t.offset===(l-1)*t.pageSize?"active":"",n.append('<a class="'+s+' item" data-page="'+l+'">\n  '+l+"\n</a>"),l++;c.$el.append(n)}}else c.$el.append('<div class="list_blank">\u6ca1\u6709\u627e\u5230\u76f8\u5173\u6587\u7ae0</div>');return"function"==typeof a?a():void 0})))},t.prototype.destroy=function(){return $.contextMenu("destroy",".store_files_list_container"),this.$el.dimmer("destroy"),this.remove()},t}(a),n.exports=o}}),window.requirejs.define({"views/store_footer_analysis_dropdown_view":function(e,t,n){var i,r,o,a,s,l,c,u={}.hasOwnProperty;l=t("./view"),i=t("../application"),c=t("./templates/store_footer_analysis_dropdown"),s=t("./tags_map_window_view"),o=t("./link_map_window_view"),r=t("./decision_map_window_view"),a=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)u.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.template=c,t.prototype.className="ui icon button bottom right pointing analysis_buttons dropdown",t.prototype.events={"click .tags_map_window_button":"showTagsMapWindowFn","click .link_map_window_button":"showLinkMapWindowFn","click .decision_map_window_button":"showDecisionMapWindowFn"},t.prototype.showTagsMapWindowFn=function(e){var t;return e.preventDefault(),e.stopPropagation(),t=i.getFileCollection().models.map((function(e){return e.attributes._id})),new s({usedDocIds:t}).show()},t.prototype.showLinkMapWindowFn=function(e){var t,n,r;return e.preventDefault(),e.stopPropagation(),t=i.homeView.editorView,n=i.homeView.editorView.getActiveEditorProxy().fileModel,(r=i.getFileCollection().models.map((function(e){return e.attributes}))).sort((function(e,t){return e.createDate-t.createDate})),new o({fileModel:n,editorView:t,initDocs:r}).show()},t.prototype.showDecisionMapWindowFn=function(e){return e.preventDefault(),e.stopPropagation(),new r({initDocs:i.getFileCollection().models.map((function(e){return e.attributes}))}).show()},t.prototype.initAnalysisDropdownBtns=function(e){return this.render(),e.replaceWith(this.$el),this.$el.dropdown({action:"nothing"})},t}(l),n.exports=a}}),window.requirejs.define({"views/store_footer_theme_dropdown_view":function(e,t,n){var i,r,o,a,s,l,c,u,d=function(e,t){return function(){return e.apply(t,arguments)}},p={}.hasOwnProperty;l=t("./view"),i=t("../application"),c=t("./templates/store_footer_theme_dropdown"),o=t("../lib/notifier"),r=t("../lib/config_sync"),s=t("./themes_manager_view"),u={},a=function(e){function t(){return this.selectTheme=d(this.selectTheme,this),t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)p.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.template=c,t.prototype.className="ui icon button bottom left pointing theme_buttons dropdown",t.prototype.events={"click .item":"selectTheme","click .system_themes_button":"themesFilterFn","click .user_themes_button":"themesFilterFn","click .create_user_theme_button":"themesFilterFn"},t.prototype.themesFilterFn=function(e){var t,n,i;if("create_user_theme"!==(i=(t=$(e.currentTarget)).data("type")))return(n=this.$el).find(".themes_filter_buttons>.ui.button").removeClass("active"),"system"===i?(t.addClass("active"),n.find(".menu>.menu").empty(),n.dropdown("refreshItems"),n.data("filterType","system"),n.dropdown("filter","")):"user"===i?(t.addClass("active"),n.data("filterType","user"),n.find(".menu>.menu").empty(),n.dropdown("refreshItems"),n.dropdown("filter","")):(t.addClass("active"),n.data("filterType","system"),n.dropdown("filter",""));(new s).show(!1)},t.prototype.selectTheme=function(e){var t,n,r,a;if(e.stopPropagation(),e.preventDefault(),t=$(e.target),this.$el.find(".item.active").removeClass("active selected"),t.addClass("active selected"),r=t.data("value"),n=i.getApplicationProfileModel(),"explore"!==r)return(a=u[r]||"")&&(a.key=r,a=JSON.stringify(a)),r?n.save({themeInfo:a}):void 0;navigator.onLine?n.trigger("exploreTheme",{setDefault:!0}):o.showMessage("\u8be5\u529f\u80fd\u9700\u8981\u8054\u7f51\u72b6\u6001\u4e0b\u624d\u80fd\u4f7f\u7528",6e3,"error")},t.prototype.initThemeDropdown=function(e){var t;return this.render(),e.replaceWith(this.$el),t=this,this.$el.dropdown({action:function(){},saveRemoteData:!1,forceSelection:!1,filterRemoteData:!1,message:{noResults:"\u60a8\u8fd8\u6ca1\u6709\u521b\u5efa\u4efb\u4f55\u81ea\u5b9a\u4e49\u4e3b\u9898"},className:{selected:"skip_selected"},delay:{hide:1e3},onShow:function(){return!0},templates:{menu:function(e,t){var n,r,o,a,s;s=e[t.values]||{},a=i.getApplicationProfileModel().get("themeInfo"),r="",o=null;try{o=JSON.parse(a),r=o.key}catch(e){e,o=null}return"            ",n=['<div class="item" data-value="explore" data-name="\u53d1\u73b0">\n  <span style="display:inline-block;width:1em;margin-right:1em;">&nbsp;</span><i class="images outline icon"></i>\u968f\u673a\u53d1\u73b0\n</div>'],MINI_WEB&&(n=[]),$.each(s,(function(e,i){var o,a,s,l,c,u;if("query"!==i.type)return u=i[t.value],c=i[t.name],s=i.dark||!1,i.author,a=s?"moon":"sun","xsj"===i.author&&(a="images"),i.good&&(a="thumbs up"),o=r===u?"active selected":"",l="",i.colors&&(l="background: conic-gradient("+Object.values(i.colors).join(",")+");"),n.push('<div class="item '+o+'" data-value="'+u+'" data-name="'+_.escape(c)+'"><span style="'+l+';display:inline-block;width:1em;margin-right:1em;">&nbsp;</span><i class="'+a+' icon"></i>'+_.escape(i[t.name])+"</div>")})),"            \n"+n.join("")}},onHide:function(e){var t;return(t=$(this)).find(".menu>.menu").empty(),t.dropdown("refreshItems")},apiSettings:{responseAsync:function(e,n){return function(e,n){return function(e){var n;return"user"===(t.$el.data("filterType")||"system")?(n={type:"theme",sort:{$lt:[]},updateDate:{$lt:[]}},r.getThemes(n,50,!1,(function(t,n){var i;return t?o.showMessage("\u52a0\u8f7d\u4e3b\u9898\u51fa\u9519\uff1a"+t,6e3,"error"):(i={},n.docs.forEach((function(e){var t;return t=e.baseTheme&&e.baseTheme.dark,i[e._id]={name:e.themeName,author:"user",themeId:e._id,dark:!!t}})),u=i,e(null,i))}))):$.getJSON("css/themes.json").then((function(t,n){var i;return u=i=t,e(null,i)})).fail((function(e){return o.showMessage("\u52a0\u8f7d\u8d44\u6e90\u51fa\u9519",6e3,"error")}))}((function(t,i){var r,o,a,s,l;if(o=!1,a=[],e)try{o=new RegExp("(^|\\W)"+e,"gi"),Object.keys(i).length>0&&a.push({key:"_query",name:"_query",value:e,type:"query"})}catch(e){o=!1}for(r in i)s=(l=i[r]).name,l.value=r,l.key=r,r!==l.name&&(s+=" "+r),l.search&&l.search.terms&&l.search.terms.length>0&&(s+=l.search.terms.join(" ")),(!o||s.match(o))&&a.push(l);return a.sort((function(e,t){var n;return n=e.order||0,(t.order||0)-n})),n({success:!0,results:a})}))}(e.urlData.query,n)}}})},t}(l),n.exports=a}}),window.requirejs.define({"views/store_plugin_info_dialog_view":function(e,t,n){var i,r,o,a,s,l={}.hasOwnProperty;s=t("./templates/store_plugin_info_dialog"),a=t("./view"),r=t("../constant"),i=t("../application"),o=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)l.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.template=s,t.prototype.className="ui small modal",t.prototype.initialize=function(){return this.plugins=i.plugins},t.prototype.getRenderData=function(){return{},this.model?{pic:this.plugins[this.model.get("name")].logo,name:this.model.get("name"),displayName:this.model.get("displayName"),username:this.model.get("username"),userDisplayName:this.model.get("userDisplayName")}:{pic:r.defaultSystemStorePic,name:r.defaultSystemStoreName,displayName:r.defaultSystemStoreDisplayName,username:r.defaultSystemStoreUsername,userDisplayName:r.defaultSystemStoreUserDisplayName}},t.prototype.show=function(){return this.render(),this.$el.modal({onHidden:(e=this,function(){return e.remove()})}).modal("show");var e},t}(a),n.exports=o}}),window.requirejs.define({"views/store_plugin_view":function(e,t,n){var i,r,o,a,s,l,c={}.hasOwnProperty;i=t("../application"),t("../constant"),t("../lib/utils"),t("../lib/notifier"),o=t("./search_store_files_view"),r=t("./list_tags_view"),s=t("./store_tree_view"),l=t("./view"),a=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)c.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.className="store_plugin_container",t.prototype.events={"click .close_plugin":"closePlugin","click .mode_tab":"toggleMode"},t.prototype.toggleMode=function(e){var t,n;return t=(n=$(e.currentTarget).data("mode"))===this.mode,this.setMode(t?"storeTree":n)},t.prototype.initialize=function(e){return this,this.storeView=e.storeView,this.fileCollection=e.fileCollection,this.plugin=i.getPlugin(this.model),this.postBaseData={pluginName:this.model.get("name"),entryToken:this.model.get("entryToken"),entryTokenSecret:this.model.get("entryTokenSecret"),extraInfo:this.model.get("extraInfo")}},t.prototype.destroy=function(){var e,t,n;return null!=(e=this.searchStoreFilesView)&&e.destroy(),this.searchStoreFilesView=null,null!=(t=this.listTagsView)&&t.destroy(),this.listTagsView=null,null!=(n=this.storeTreeView)&&n.destroy(),this.storeTreeView=null,null,this.remove()},t.prototype.closePlugin=function(){return"storeTree"===this.mode?i.getApplicationProfileModel().save({plugin:""}):this.setMode("storeTree")},t.prototype.refreshFile=function(){return this.storeTreeView.refreshFile()},t.prototype.searchFile=function(e){return this.storeTreeView.searchFile()},t.prototype.initPlugin=function(){return this.storeTreeView.initTree()},t.prototype.setMode=function(e){var t,n,i,r,o,a;switch(this.mode=e,this.$el.find(".mode_tab").removeClass("circular"),e){case"listTags":return this.$el.find(".mode_tab[data-mode=listTags]").addClass("circular"),this.storeTreeView.$el.hide(),null!=(t=this.searchStoreFilesView)&&t.$el.hide(),this.listTagsView||this.initTagsView(),null!=(n=this.listTagsView)?n.$el.css({display:"flex"}):void 0;case"searchStore":return this.$el.find(".mode_tab[data-mode=searchStore]").addClass("circular"),this.storeTreeView.$el.hide(),null!=(i=this.listTagsView)&&i.$el.hide(),this.searchStoreFilesView||this.initSearchView(),null!=(r=this.searchStoreFilesView)?r.$el.css({display:"flex"}):void 0;default:return this.storeTreeView.$el.css({display:"flex"}),null!=(o=this.searchStoreFilesView)&&o.$el.hide(),null!=(a=this.listTagsView)?a.$el.hide():void 0}},t.prototype.afterRender=function(){return this.initButtonsView(),this.initStoreTreeView(),this.setMode("storeTree")},t.prototype.initStoreTreeView=function(){var e;return e=new s({fileCollection:this.fileCollection,model:this.model}),this.storeTreeView=e,this.$el.append(e.render().$el)},t.prototype.initButtonsView=function(){var e;return e=$("<div class='plugin_buttons'></div>"),this.plugin.searchFiles&&e.append('<i class="search icon search_store_files mode_tab link" data-mode="searchStore"></i>'),this.plugin.listTags&&e.append('<i class="tags icon list_tags mode_tab link" data-mode="listTags"></i>'),e.append('<i class="icon close close_plugin link"></i>'),this.$el.append(e)},t.prototype.initSearchView=function(){var e;if(this.plugin.searchFiles)return e=new o({plugin:this.plugin,model:this.model}),this.$el.append(e.render().$el),this.searchStoreFilesView=e},t.prototype.initTagsView=function(){var e;if(this.plugin.listTags)return e=new r({plugin:this.plugin,model:this.model}),this.$el.append(e.render().$el),e.afterAttached(),this.listTagsView=e},t.prototype.refreshFolder=function(e,t,n){return this.storeTreeView.refreshFolder(e,t,n)},t.prototype.getActiveNode=function(){return this.storeTreeView.getActiveNode()},t.prototype.expandKeyPath=function(e,t){if(null==t&&(t=!0),"storeTree"===this.mode)return this.storeTreeView.expandKeyPath(e,t)},t}(l),n.exports=a}}),window.requirejs.define({"views/store_tree_view":function(e,t,n){var i,r,o,a,s,l,c,u,d,p,f,h,m,v,g,w,y=function(e,t){return function(){return e.apply(t,arguments)}},b={}.hasOwnProperty;i=t("../application"),t("../constant"),t("../lib/utils"),o=t("../lib/notifier"),r=t("./new_filename_dialog_view"),w=null,g=function(e,t){var n,i;return i=e.lastIndexOf("/"),t.push(e.replace(/\//g,"_")),i>=0?(n=e.substring(0,i),g(n,t)):t},v=function(e,t){return e>t},u=function(e,t,n,i,r){var o,a;return r=r||v,e.folder&&!t.folder?-1:!e.folder&&t.folder?1:(o=i(e),a=i(t),e.folder&&t.folder||!e.folder&&!t.folder?o===a?0:"asc"===n?r(o,a)?1:-1:r(o,a)?-1:1:void 0)},c=function(e,t){return u(e,t,"asc",(function(e){return e.data.order}))},p=function(e,t){return u(e,t,"asc",(function(e){return e.title}),(function(e,t){return e.localeCompare(t,"en-u-kn-true")>0}))},d=function(e,t){return u(e,t,"desc",(function(e){return e.title}),(function(e,t){return e.localeCompare(t,"en-u-kn-true")>0}))},h=function(e,t){return u(e,t,"asc",(function(e){return e.folder?e.title:e.data.obj.updateDate}))},f=function(e,t){return u(e,t,"desc",(function(e){return e.folder?e.title:e.data.obj.updateDate}))},l=function(e,t){return u(e,t,"asc",(function(e){return e.folder?e.title:e.data.obj.createDate}))},s=function(e,t){return u(e,t,"desc",(function(e){return e.folder?e.title:e.data.obj.createDate}))},m=_.debounce((function(e,t){var n,i,r;return r=(i=$.ui.fancytree.getNode(e)).getParentList(),n=[],r&&r.forEach((function(e){if("-1"!==e.key)return n.push(e.title)})),"-1"!==i.key&&n.push(i.title),n.length>0?t.$el.find(".store_tree_tooltip_bar_content").text(n.join(" / ")):t.$el.find(".store_tree_tooltip_bar_content").text("")}),100),a=function(e){function t(){return this.enterKeyFooterSearchFile=y(this.enterKeyFooterSearchFile,this),this.searchFooterFile=y(this.searchFooterFile,this),this.closeFooterSearchPanel=y(this.closeFooterSearchPanel,this),this.openFooterSearchPanel=y(this.openFooterSearchPanel,this),this.sortFileSelected=y(this.sortFileSelected,this),t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)b.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,Backbone.View),t.prototype.className="store_tree_container tree_content",t.prototype.initSource=function(){var e;return[{title:("function"==typeof(e=this.plugin).getDisplayName?e.getDisplayName():void 0)||"\u6839\u76ee\u5f55",key:"-1",folder:!0,lazy:!0,obj:{guid:"-1",parentPath:null}}]},t.prototype.events={"click .save_all_file":"saveAllFile","click .refresh_file":"refreshFile","click .sort_button":"sortFileSelected","click .search_file":"searchFooterFile","click .filter_file":"openFooterSearchPanel","click .close_search_input_wrapper":"closeFooterSearchPanel","keydown .search_input":"enterKeyFooterSearchFile","mouseenter span.fancytree-title":"mouseenterTreeNodeFn"},t.prototype.mouseenterTreeNodeFn=function(e){return m(e,this)},t.prototype.saveAllFile=function(){return $(window).trigger("saveAllUnsync")},t.prototype.sortFileSelected=function(e){var t,n,r,o,a,s;return this,o=(r=i.getApplicationProfileModel()).get("storeTreeSort")||{},o=Object.assign({},o),s=(n=$(e.currentTarget)).data("sort_type"),a=n.data("sort_by"),(t=this.$el.find(".sort_buttons")).find(".active>i").remove(),t.find(".active").data("sort_by","").removeClass("active"),n.addClass("active"),"by_default"===s?(n.data("sort_by",""),n.append('<i class="circle icon"></i>'),o.sortType="by_default",o.sortBy=""):(o.sortType=s,a&&"asc"!==a?(o.sortBy="asc",n.data("sort_by","asc"),n.append('<i class="long arrow up icon"></i>')):(o.sortBy="desc",n.data("sort_by","desc"),n.append('<i class="long arrow down icon"></i>'))),r.set({storeTreeSort:o}),r.save()},t.prototype.openFooterSearchPanel=function(){return this.$el.find(".sort_buttons,.filter_file,.refresh_file,.save_all_file").hide(),this.$el.find(".search_input_wrapper").show(),this.$el.find(".search_input_wrapper .search_input").focus()},t.prototype.closeFooterSearchPanel=function(){return this.$el.find(".sort_buttons,.filter_file,.refresh_file,.save_all_file").show(),this.$el.find(".search_input_wrapper").hide(),this.$el.find(".search_input_wrapper .search_input").val(""),this.searchFile("")},t.prototype.searchFooterFile=function(e){var t;return(t=$.trim(this.$el.find(".search_input").val()))?this.searchFile(t):this.$el.find(".search_input_wrapper").addClass("error")},t.prototype.enterKeyFooterSearchFile=function(e){if(this.$el.find(".search_input_wrapper").removeClass("error"),13===e.keyCode)return this.searchFooterFile(e)},t.prototype.refreshRootTitle=function(){var e,t;if(t=(t=this.$el.fancytree("getRootNode")).getFirstChild(),this.plugin.getDisplayName)return e=this.plugin.getDisplayName(),t.setTitle(e)},t.prototype.initialize=function(e){return w=this,this.fileCollection=e.fileCollection,this.plugin=i.getPlugin(this.model),this.postBaseData={pluginName:this.model.get("name"),entryToken:this.model.get("entryToken"),entryTokenSecret:this.model.get("entryTokenSecret"),extraInfo:this.model.get("extraInfo")},i.getApplicationProfileModel().on("change:storeTreeSort",this.sortFile,this),this.model.on("change:displayName",this.refreshRootTitle,this)},t.prototype.destroy=function(){var e;return null!=(e=this.searchStoreFilesView)&&e.destroy(),w=null,this.model.off("change:displayName",this.refreshRootTitle,this),i.getApplicationProfileModel().off("change:storeTreeSort",this.sortFile,this),this.$el.fancytree("destroy"),this.remove()},t.prototype.closeTree=function(){return i.getApplicationProfileModel().save({plugin:""})},t.prototype.refreshFile=function(){var e,t,n;if((n=this.$el.fancytree("getTree")).clearFilter(),(t=n.getFocusNode())||(t=n.getRootNode()),t&&(e=t.getKeyPath()),this.$el.fancytree("option","source",this.initSource()),e)return n.loadKeyPath(e,(function(e,t){if("loaded"===t&&e&&e.setActive(),"ok"===t&&e&&(e.setActive(),e.folder))return e.setExpanded()}))},t.prototype.sortFile=function(){var e,t;if(e=this.$el.fancytree("getRootNode"),t=i.getApplicationProfileModel().get("storeTreeSort"))switch(t.sortType){case"by_title":return"asc"===t.sortBy?e.sortChildren(p,!0):e.sortChildren(d,!0);case"by_create_date":return"asc"===t.sortBy?e.sortChildren(l,!0):e.sortChildren(s,!0);case"by_update_date":return"asc"===t.sortBy?e.sortChildren(h,!0):e.sortChildren(f,!0);default:return e.sortChildren(c,!0)}},t.prototype.searchFile=function(e){var t,n,i,r;return e?(t=(i=(i=(i=(i=e).replace(/\s*/g,"")).replace(/^\/*|\/*$/g,"")).replace(/\/{2,}/g,"")).indexOf("/")>=0,r=i.split("/"),n=this.$el.fancytree("getTree"),t?n.filterNodes((function(e){var t,n,i;return 1===(n=e.getParentList(!1,!0)).length&&((t=n[0]).isLoaded()||t.setExpanded()),n.length<=1||(n.shift(),!(n.length>r.length)&&(i=!0,r.forEach((function(e,t){var o,a;if(!(n.length<t+1))return o=n[t],a=new RegExp(".*"+e+".*","i").exec(o.title),o.isFolder()||t+1!==r.length&&(i=!1),a&&o.isLazy()&&o.setExpanded(),a?void 0:i=!1})),i))})):n.filterNodes(e,!0)):this.$el.fancytree("getTree").clearFilter()},t.prototype.initTree=function(){var e,t,n,a,c;return e=this.$el,n={clickFolderMode:3,extensions:["wide","filter","glyph"],filter:{mode:"hide"},loadError:function(e,t){var n;return(n=t.error).status&&n.statusText?(t.message="Ajax error: "+t.message,t.details="Ajax error: "+n.statusText+", status code = "+n.status):(t.message=JSON.stringify(n),t.details=JSON.stringify(n))},loadChildren:function(e,t,n){var r,o;if(r=t.node,o=i.getApplicationProfileModel().get("storeTreeSort"))switch(o.sortType){case"by_title":return"asc"===o.sortBy?r.sortChildren(p,!0):r.sortChildren(d,!0);case"by_create_date":return"asc"===o.sortBy?r.sortChildren(l,!0):r.sortChildren(s,!0);case"by_update_date":return"asc"===o.sortBy?r.sortChildren(h,!0):r.sortChildren(f,!0)}},click:function(e,t){var n,i;if(!e.shiftKey)return n=(i=t.node).data.obj,i.isFolder()?void 0:n.fileType&&"text"!==n.fileType?void o.showMessage("\u7cfb\u7edf\u65e0\u6cd5\u76f4\u63a5\u6253\u5f00\u975ehtml,txt, markdown\u683c\u5f0f\u7684\u6587\u4ef6\u5185\u5bb9",6e3,"error"):$(window).trigger("importFileByPlugin",[w.model,n.guid,n.parentPath||"",{},function(){}])},source:this.initSource(),glyph:{map:{doc:"far fa-file",docOpen:"far fa-file",checkbox:"far fa-square",checkboxSelected:"far fa-check-square",checkboxUnknown:"fa fa-square",error:"fa fa-warning",expanderClosed:"fa fa-caret-right",expanderLazy:"fa fa-angle-right",expanderOpen:"fa fa-caret-down",folder:"far fa-folder",folderOpen:"far fa-folder-open",loading:"fa fa-spinner fa-pulse"}},lazyLoad:function(e,t){var n,i,r,o;if(r="-1"!==(n=(o=t.node).data.obj).guid?n.guid:null,n.parentPath&&(r=n.parentPath+"/"+n.guid),o.isFolder())return i=$.Deferred(),w.plugin.listFiles({},{parentPath:r,pageSize:n.childCount},(function(e,t){return e?i.reject(e):(t.forEach((function(e,t){return e.tooltip=e.title,e.order=t})),i.resolve(t))})),t.result=i.promise()}},t=null,"local"===w.plugin.name&&(n.extensions.push("edit"),n.edit={beforeEdit:function(e,t){return"-1"!==t.node.key&&console.log(arguments)},edit:function(){return console.log(arguments)},save:function(e,n){var i,r,a,s,l,c;if(a=n.node,s=n.orgTitle,(r=$.trim(n.input.val()))&&r!==s)if(i=r,a.folder){if(c=t.actions.renameFolder)return c(a.data.obj,i,(function(e,t){return e?o.showMessage("\u51fa\u9519:"+e,6e3,"error"):(a.setTitle(i),a.key=t.key,a.data.obj=t.obj)}))}else if(l=t.actions.renameFile)return l(a.data.obj,i,(function(e,t){return e?o.showMessage("\u51fa\u9519:"+e,6e3,"error"):(a.setTitle(i),a.key=t.key,a.data.obj=t.obj)}))}}),w.plugin.getContextMenu&&(t=w.plugin.getContextMenu(),c={menu:function(e){return"-1"===e.key?t.menu(e.data.obj,{createFile:{name:"\u65b0\u5efa\u6587\u4ef6"},createFolder:{name:"\u521b\u5efa\u6587\u4ef6\u5939"}}):e.isFolder()?t.menu(e.data.obj,{createFile:{name:"\u65b0\u5efa\u6587\u4ef6"},createFolder:{name:"\u65b0\u5efa\u6587\u4ef6\u5939"},deleteFolder:{name:"\u5220\u9664\u6587\u4ef6\u5939"},renameFolder:{name:"\u91cd\u547d\u540d"}}):t.menu(e.data.obj,{createFile:{name:"\u65b0\u5efa\u6587\u4ef6"},deleteFile:{name:"\u5220\u9664\u6587\u4ef6"},refreshFile:{name:"\u66f4\u65b0\u672c\u5730\u7f13\u5b58\u6587\u4ef6",icon:"fas fa-download"},createFolder:{name:"\u65b0\u5efa\u6587\u4ef6\u5939"},renameFile:{name:"\u91cd\u547d\u540d"}})},actions:function(e,n,i){var a,s,l;switch(n){case"createFile":return new r({head:"\u521b\u5efa\u6587\u4ef6"}).show((function(n,i){var r;if(r=t.actions.createFile)return r(e.data.obj,n,(function(t,n){return t?i(t):(e.isFolder()?e.isLoaded()?e.countChildren(!1)>0?e.addChildren(n,0):e.addChildren(n):e.toggleExpanded():e.appendSibling(n),i())}))}));case"createFolder":return new r({head:"\u521b\u5efa\u6587\u4ef6\u5939"}).show((function(n,i){var r;if(r=t.actions.createFolder)return r(e.data.obj,n,(function(t,n){return t?i(t):(e.isFolder()?e.isLoaded()?e.countChildren(!1)>0?e.addChildren(n,0):e.addChildren(n):e.toggleExpanded():e.appendSibling(n),i())}))}));case"refreshFile":return a=e.data.obj,$(window).trigger("importFileByPlugin",[w.model,a.guid,a.parentPath||"",{forceUpdate:!0},function(){}]);case"deleteFile":if(s=t.actions.deleteFile)return s(e.data.obj,(function(t){var n;if(t){if("object"==typeof t)try{t=JSON.stringify(t)}catch(e){}return o.showMessage("\u5220\u9664\u5931\u8d25"+t,6e3,"error")}return e.remove(),(n=w.fileCollection.where({pluginName:w.postBaseData.pluginName,guid:e.data.obj.guid,parentPath:e.data.obj.parentPath})).length>0?n[0].save({pluginName:"",guid:"",parentPath:""},{success:function(){return o.showMessage("\u5220\u9664\u6587\u4ef6\u6210\u529f: "+e.data.obj.name)},error:function(t){return o.showMessage("\u5220\u9664\u6587\u4ef6\u6210\u529f: "+e.data.obj.name)}}):w.fileCollection.fetch({fetch:"query",update:!0,remove:!1,options:{query:{fun:"query_index/by_plugin",include_docs:!0,limit:1,key:[w.postBaseData.pluginName,e.data.obj.guid,e.data.obj.parentPath||""]}},success:function(t,n,i){if(1===n.rows.length)return t.get(n.rows[0].id).save({pluginName:"",guid:"",parentPath:""},{success:function(){return o.showMessage("\u5220\u9664\u6587\u4ef6\u6210\u529f: "+e.data.obj.name)},error:function(t){return o.showMessage("\u5220\u9664\u6587\u4ef6\u6210\u529f: "+e.data.obj.name)}})},error:function(t){return o.showMessage("\u5220\u9664\u6587\u4ef6\u6210\u529f: "+e.data.obj.name)}})}));break;case"deleteFolder":if(l=t.actions.deleteFolder)return l(e.data.obj,(function(t){if(t){if("object"==typeof t)try{t=JSON.stringify(t)}catch(e){}return o.showMessage("\u5220\u9664\u5931\u8d25"+t,6e3,"error")}return e.remove()}));break;case"renameFile":return new r({head:"\u91cd\u547d\u540d\u6587\u4ef6",initVal:e.title}).show((function(n,i){var r;if(r=t.actions.renameFile)return r(e.data.obj,n,(function(t,r){return t?i(t):(e.setTitle(n),e.key=r.key,e.data.obj=r.obj,i(),$(e.span).trigger("click"))}))}));case"renameFolder":return new r({head:"\u91cd\u547d\u540d\u6587\u4ef6\u5939",initVal:e.title}).show((function(n,i){var r;if(r=t.actions.renameFolder)return r(e.data.obj,n,(function(t,r){return t?i(t):(e.setTitle(n),e.key=r.key,e.data.obj=r.obj,i())}))}));default:return t.actions[n](e.data.obj,i)}}},n.extensions.push("contextMenu"),n.contextMenu=c),e.fancytree(n),this.initButtonsView(),this.closeFooterSearchPanel(),a=i.homeView.fileModel,this.expandKeyPath(a),this},t.prototype.initButtonsView=function(){var e,t;return'<div class="ui icon input search_input_wrapper mini" style="width: 100%;">\n  <i class="circle remove icon link close_search_input_wrapper" title="\u5173\u95ed\u5feb\u901f\u67e5\u8be2"></i>\n    <input type="text" placeholder="\u8fc7\u6ee4\u5185\u5bb9,\u652f\u6301 `/` \u76ee\u5f55\u5206\u7ea7..." class="search_input"/>\n    <i class="circular search link icon search_file"></i>\n</div>','<div class="ui mini button icon save_all_file"><i class="archive icon" title="\u4fdd\u5b58\u6240\u6709\u672a\u540c\u6b65\u7684\u6587\u4ef6"></i></div>','<div class="ui mini button icon refresh_file"><i class="refresh icon" title="\u5237\u65b0\u76ee\u5f55"></i></div>','<div class="ui mini button icon filter_file"><i class="filter icon" title="\u8fc7\u6ee4\u67e5\u627e"></i></div>','<div class="ui mini icon bottom right pointing dropdown button sort_buttons">\n    <i class="sort icon" title="\u6392\u5e8f\u65b9\u5f0f"></i>\n    <div class="menu">\n        <div class="item by_default_button sort_button" data-sort_type="by_default">\u7cfb\u7edf\u9ed8\u8ba4</div>\n        <div class="item by_create_date_button sort_button" data-sort_type="by_create_date">\u521b\u5efa\u65f6\u95f4</div>\n        <div class="item by_update_date_button sort_button" data-sort_type="by_update_date">\u66f4\u65b0\u65f6\u95f4</div>\n        <div class="item by_title_button sort_button" data-sort_type="by_title">\u6587\u7ae0\u6807\u9898</div>\n    </div>\n</div>','<div class="store_tree_tooltip_bar">\n  <div class="store_tree_tooltip_bar_content">\n  </div>\n</div>',(e=$("<div class='store_tree_buttons'></div>")).append('<div class="ui icon input search_input_wrapper mini" style="width: 100%;">\n  <i class="circle remove icon link close_search_input_wrapper" title="\u5173\u95ed\u5feb\u901f\u67e5\u8be2"></i>\n    <input type="text" placeholder="\u8fc7\u6ee4\u5185\u5bb9,\u652f\u6301 `/` \u76ee\u5f55\u5206\u7ea7..." class="search_input"/>\n    <i class="circular search link icon search_file"></i>\n</div>'),e.append('<div class="ui mini icon bottom right pointing dropdown button sort_buttons">\n    <i class="sort icon" title="\u6392\u5e8f\u65b9\u5f0f"></i>\n    <div class="menu">\n        <div class="item by_default_button sort_button" data-sort_type="by_default">\u7cfb\u7edf\u9ed8\u8ba4</div>\n        <div class="item by_create_date_button sort_button" data-sort_type="by_create_date">\u521b\u5efa\u65f6\u95f4</div>\n        <div class="item by_update_date_button sort_button" data-sort_type="by_update_date">\u66f4\u65b0\u65f6\u95f4</div>\n        <div class="item by_title_button sort_button" data-sort_type="by_title">\u6587\u7ae0\u6807\u9898</div>\n    </div>\n</div>'),e.append('<div class="ui mini button icon filter_file"><i class="filter icon" title="\u8fc7\u6ee4\u67e5\u627e"></i></div>'),e.append('<div class="ui mini button icon refresh_file"><i class="refresh icon" title="\u5237\u65b0\u76ee\u5f55"></i></div>'),e.append('<div class="ui mini button icon save_all_file"><i class="archive icon" title="\u4fdd\u5b58\u6240\u6709\u672a\u540c\u6b65\u7684\u6587\u4ef6"></i></div>'),e.append('<div class="store_tree_tooltip_bar">\n  <div class="store_tree_tooltip_bar_content">\n  </div>\n</div>'),this.$el.append(e),(t=this.$el.find(".sort_buttons")).dropdown({action:"nothing",onShow:function(){var e,n,r,o;return t.find(".active>i").remove(),t.find(".active").removeClass("active"),(n=i.getApplicationProfileModel().get("storeTreeSort"))?(o=n.sortType||"by_default",r=n.sortBy||"desc"):(o="by_default",r="desc"),(e=t.find("."+o+"_button")).addClass("active"),"by_default"===o?e.append('<i class="circle icon"></i>'):"asc"===r?e.append('<i class="long arrow up icon"></i>'):e.append('<i class="long arrow down icon"></i>')}})},t.prototype.expandKeyPath=function(e,t){var n,i,r,o,a,s,l,c,u;if((null==t&&(t=!0),e)&&(i=e.get("guid"),e.get("pluginName")===this.model.get("name"))){a=e.get("parentPath")||"",c=this.$el.fancytree("getTree"),0===(r=i?a+"/"+e.get("guid"):a).indexOf("/")&&(r=r.substring(1)),l=g(r,[]),o=[],this.plugin.getVirtualPath?l.forEach((u=this,function(e){return o.push(u.plugin.getVirtualPath(e))})):o=l,r="/-1/"+o.reverse().join("/"),s=null;try{return c.loadKeyPath(r,(function(n,i){if(n&&"object"==typeof n&&(n.setActive(),s=n),"ok"===i&&n.makeVisible(),t&&n&&"string"==typeof n&&"error"===i&&s&&"object"==typeof s)return s.resetLazy(),w.expandKeyPath(e,!1)}))}catch(e){return n=e,console.error(n)}}},t.prototype.getActiveNode=function(){return this.$el.fancytree("getActiveNode")},t.prototype.refreshFolder=function(e,t,n){var i,r,o,a,s;return s=this.$el.fancytree("getTree"),o=(t.parentPath||"").replace(/\//g,"_")||"-1",a=s.getNodeByKey(o),i=t.guid||"",o&&"-1"!==o&&(i=o+"_"+i),r=s.getNodeByKey(i),a&&a.isLoaded()&&(r&&a.removeChild(r),a.addNode({key:i,folder:!1,title:t.name,obj:t},"firstChild"),a.sortChildren()),s.getActiveNode(),this.expandKeyPath(e)},t}(),n.exports=a}}),window.requirejs.define({"views/store_view":function(e,t,n){var i,r,o,a,s,l,c,u,d,p,f,h,m,v,g,w,y,b,x,k,D,C,F,M,T=function(e,t){return function(){return e.apply(t,arguments)}},S={}.hasOwnProperty;x=t("./view"),i=t("../application"),a=t("../constant"),h=t("../lib/pouchdb_index_view_manager"),l=t("./file_browser/file_browser_view"),y=t("./store_plugin_view"),o=t("./cloud_sync_view"),p=t("./miniweb_sync_view"),s=t("../models/database_auto_index_model"),d=t("./filter_dropdown_view"),u=t("./filter_buttons_view"),c=t("./file_timeline_view"),w=t("./store_plugin_info_dialog_view"),r=t("./change_store_plugin_dialog_view"),v=t("./store_footer_analysis_dropdown_view"),g=t("./store_footer_theme_dropdown_view"),m=t("./search_result_outline_view"),f=t("../lib/notifier"),M=t("./templates/store"),k=!1,D=null,C=function(){var e;e=[];try{JSON.parse(localStorage.getItem("search_history_key")).forEach((function(t){return e.push(t)}))}catch(e){e,console.log("no history")}return e},F=function(e){var t;return(t=(t=C()).filter((function(t){return t!==e}))).unshift(e),t.splice(200),localStorage.setItem("search_history_key",JSON.stringify(t))},b=function(e){var t,n,b,x,P,j,E,I,O,V,L,A;function B(){return this.getPptFile=T(this.getPptFile,this),this.getUpdateFile=T(this.getUpdateFile,this),this.getUseFile=T(this.getUseFile,this),this.showTour=T(this.showTour,this),this.getGrammarFile=T(this.getGrammarFile,this),this.enterKeySearchFile=T(this.enterKeySearchFile,this),this.closeSearchPanel=T(this.closeSearchPanel,this),this.openSearchPanel=T(this.openSearchPanel,this),this.searchFile=T(this.searchFile,this),this.refreshFile=T(this.refreshFile,this),this.newFile=T(this.newFile,this),this.showStorePluginInfo=T(this.showStorePluginInfo,this),this.bindStore=T(this.bindStore,this),B.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)S.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(B,e),B.prototype.template=M,B.prototype.className="ui-layout-west main_west_wrapper",n=null,x=null,O=null,I=null,L=null,A=uniqueNumber(),"",B.prototype.events={"click .footer .open_external_btn":"openExternalFn","click .footer .bind_store":"bindStore","click .header .search_file":"searchFile","click .header .store_buttons .search_button":"openSearchPanel","click .header .close_search_input_wrapper":"closeSearchPanel","keydown .header .search_input":"enterKeySearchFile","click .footer .get_update_file_button":"getUpdateFile","click .footer .get_ppt_file_button":"getPptFile","click .footer .get_use_file_button":"getUseFile","click .footer .get_grammar_file_button":"getGrammarFile","click .footer .show_tour_button":"showTour","click .footer .close_store_button":"closeStoreFn",mouseenter:"enterStoreFn",mouseleave:"leaveStoreFn",page:"pageNavChangeFn",pageFetched:"pageFetchedFn",enterFile:"enterFileFn",leaveFile:"leaveFileFn",clickFile:"clickFileFn"},B.prototype.closeStoreFn=function(e){return i.execCommand("toggleFileListPanel"),setTimeout((function(){var e,t,n,r,o,a;if((a=i.getTourModel()).canPrompt("open_store_learned")){if(!(t=$("#main>.ui-layout-resizer-west-closed>.ui-layout-toggler-west-closed")).length)return;return n=(r=t[0].getBoundingClientRect()).x+r.width/2,o=r.y+r.height/2,e=$('<div class="spotlight_container" style="\nbackground: radial-gradient(circle at '+n+"px "+o+'px, transparent 100px, rgba(0, 0, 0, 0.4) 100px, rgba(0, 0, 0, 0.9) 900px);\n"></div>'),t.popup({on:"manual",closable:!1,position:"bottom left",onVisible:function(){var n;return $("body").append(e),(n=this).width(300),n.find(".ok").click((function(){return e.remove(),t.popup("destroy"),a.dontPrompt("open_store_learned"),n.remove()}))},html:'<div class="header">\u63d0\u793a</div><div class="content">\u70b9\u51fb\u8fd9\u91cc\u91cd\u65b0\u6253\u5f00\u6587\u4ef6\u5217\u8868<div><a href="javascript:void(0);" class="ok pull-right">\u77e5\u9053\u4e86</a></div></div>'}).popup("show")}}),600)},b=function(e,t){var n,i;if(n=t.model,i=t.type,x)return"click"===i?x.shineDocs([n.attributes],{scrollTo:!0,focus:!0}):"enter"===i?x.shineDocs([n.attributes]):x.shineDocs([])},t=_.debounce(b,500),B.prototype.clickFileFn=b,B.prototype.leaveFileFn=t,B.prototype.enterFileFn=t,V=function(e){var t;if(x)return O&&cancelAnimationFrame(O),e.sort((function(e,t){return e.updateDate-t.updateDate})),t=function(){var n,i;return O=null,e.length>0?(i=e.length>3?3:e.length,n=e.splice(0,_.random(1,i)),x.shineDocs(n),O=requestAnimationFrame(t)):x.shineDocs([])},O=requestAnimationFrame(t)},B.prototype.pageNavChangeFn=function(e,t){if(x)return x.changePageInfo(t)},B.prototype.pageFetchedFn=function(e){var t;return t=this.fileCollection.models.map((function(e){return e.attributes})),V(t)},B.prototype.enterStoreFn=function(e){var t;if(n&&(clearTimeout(n),n=null),this.$el.addClass("main_store_hover"),t=this,x)return x.show({initCallback:function(){var e;return e=t.fileCollection.models.map((function(e){return e.attributes})),V(e)}})},B.prototype.leaveStoreFn=function(e){var t;if(x)return t=this,n&&clearTimeout(n),n=setTimeout((function(){return t.$el.removeClass("main_store_hover"),x.hide(),n=null}),300)},B.prototype.openExternalFn=function(){return $(window).trigger("createNewEditor",[this.fileCollection.models.slice(),{}])},B.prototype.bindStore=function(){return this.storePluginModel?new w({model:this.storePluginModel}).show():(new r).show()},B.prototype.showStorePluginInfo=function(){},B.prototype.newFile=function(){return $(window).trigger("newFileModel")},B.prototype.refreshFile=function(){var e,t;return null!=(e=this.fileBrowserView)&&e.refreshFile(),null!=(t=this.storePluginView)?t.refreshFile():void 0},B.prototype.searchFile=function(e){var t,n,i;return(t=this.$el.find(".ui.search.search_container")).search("cancel query"),t.search("hide results"),n=this.$el.find(".header .search_input").val(),$.trim(n)?(k=!0,F(n),null!=(i=this.fileBrowserView)?i.searchFile(n):void 0):this.$el.find(".header .search_input_wrapper").addClass("error")},B.prototype.openSearchPanel=function(){return this.$el.find(".header.store").addClass("searching_store"),this.$el.find(".header .search_input").val(""),this.$el.find(".header .search_input_wrapper .search_input").focus(),L={allFileIds:this.fileBrowserView.pageNavView.allFileIds,filterInfo:this.fileBrowserView.getCurrentFilterInfo()},this.showSearchHistoryValues()},B.prototype.showSearchHistoryValues=function(){var e,t,n;if(e=this.$el.find(".ui.search.search_container"),0!==(n=C()).length)return t=n.map((function(e){return'<a class="result" data-result="system:history"><div class="content"><div class="title">'+_.escape(e)+"</div></div></a>"})),e.search("add results",t.join(""))},B.prototype.closeSearchPanel=function(){var e;if(this.$el.find(".header.store").removeClass("searching_store"),this.$el.find(".header .search_input_wrapper").removeClass("error"),L=null,"",k)return k=!1,this.fileBrowserView&&(this.fileBrowserView.searchFile(""),this.fileBrowserView.hideSearchResultOutlineWindow(),this.hideSearchResultOutlineContainer()),null!=(e=this.storePluginView)?e.searchFile(""):void 0},B.prototype.showQuickSearchResult=function(){var e,t;if(t=this.$el.find(".header .search_input").val(),$.trim(t))return(e=this.$el.find(".ui.search.search_container")).search("is empty")||e.search("is visible")?void 0:(e.find(".search_input").blur(),e.find(".search_input").focus(),setTimeout((function(){return e.search("show results")}),100))},B.prototype.enterKeySearchFile=function(e){var t,n;switch(n=this,this.$el.find(".header .search_input_wrapper").removeClass("error"),e.keyCode){case 8:case 46:return setTimeout((function(){if(!n.$el.find(".header .search_input").val())return n.showSearchHistoryValues()}),500);case 40:if(!(t=this.$el.find(".ui.search.search_container")).search("is visible"))return t.search("show results");break;case 18:return this.showQuickSearchResult();case 13:return this.searchFile(e);case 27:return this.$el.find(".header .search_input").val()?(t=this.$el.find(".ui.search.search_container")).search("is visible")?t.search("hide results"):this.closeSearchPanel():void this.closeSearchPanel()}},E=function(e,t){var n;if(t)return n=e[0].getBoundingClientRect(),$(window).trigger("createNewEditor",[t,{position:{left:n.right+200,top:n.top+100},forceOpen:!0,groupId:E.groupEditorId,callback:function(e,t){var n;if(E.groupEditorId=e.id,n=t.$el.find(".popup_editor_file_tabs .file_item.droppable_file_item.active")[0])return appHighlightPosByEl(n)}}])},B.prototype.getGrammarFile=function(e){var t;return t=this,this.fileCollection.createGrammarHelpFile(!1,(function(e,n){return E(t.$el,n)}))},B.prototype.showTour=function(e){return i.showTour()},B.prototype.getUseFile=function(e){var t;return t=this,this.fileCollection.createUseHelpFile(!1,(function(e,n){return E(t.$el,n)}))},B.prototype.getUpdateFile=function(e){var t;return t=this,this.fileCollection.createUpdateHelpFile(!1,(function(e,n){return E(t.$el,n)}))},B.prototype.getPptFile=function(e){return this,this.fileCollection.createPptHelpFile(!1,(function(e,t){return $(window).trigger("changeFileModel",t)}))},B.prototype.initialize=function(e){var t,n,r,o;if(this.fileModel=null,this.fileCollection=e.fileCollection,o=i.getStorePluginCollection(),n=i.getApplicationProfileModel(),t=this,n.on("change:plugin",(function(e,n){return e=o.get(n),t.changeStorePluginModel(e,!0)})),r=n.get("plugin"))return this.storePluginModel=o.get(r)},B.prototype.afterRender=function(){var e,t;if(MINI_WEB&&this.$el.find(".bind_store, .get_ppt_file_button").remove(),e=this,this.$el.find(">.content"),this.$el.find(".footer .help_button").dropdown(),DOCKER_VERSION||GITHUB_PAGE_WEB||(new v).initAnalysisDropdownBtns(this.$el.find(".footer .analysis_button_placeholder")),(new g).initThemeDropdown(this.$el.find(".footer .theme_button_placeholder")),t=function(){var t,n;if(D)return clearTimeout(D),D=null,(t=new o).render(),e.$el.find(".header.store").prepend(t.$el),n=new s,i.isFirstUse()&&n.resetDefault(),h.autoBuildIndexFn(null,(function(){var t;return console.log("autobuild index success"),"client"===STORY_PLATFORM?((t=new p).render(),e.$el.find(".miniweb_server_button").replaceWith(t.$el)):e.$el.find(".miniweb_server_button").remove()}))},D=setTimeout((function(){return t()}),6e4),this.$el.one("pageFetched",(function(){return t()})),this.fileBrowserView=new l({fileCollection:this.fileCollection,fileModel:this.fileModel,storeView:this}),this.fileBrowserView.render(),!DOCKER_VERSION&&!GITHUB_PAGE_WEB)return(x=new c({fileBrowserView:this.fileBrowserView})).render(),this.$el.prepend(x.$el)},B.prototype.afterAttach=function(){var e;return this.fileBrowserView.afterAttach(),this.fileBrowserView.$dimmer.dimmer("show"),i.state.dbInited?(P(this.$el,this.fileBrowserView),j(this,this.$el.find(".ui.search.search_container"))):$(window).one("xsj.dbInited",(e=this,function(){return P(e.$el,e.fileBrowserView),j(e,e.$el.find(".ui.search.search_container"))})),i.state.pluginInited?this.changeStorePluginModel(this.storePluginModel,!0):$(window).one("xsj.pluginInited",function(e){return function(){var t,n;return n=i.getStorePluginCollection(),(t=i.getApplicationProfileModel().get("plugin"))&&(e.storePluginModel=n.get(t)),e.changeStorePluginModel(e.storePluginModel,!0)}}(this))},P=function(e,t){var n;return n=new u({fileBrowserView:t}),e.find(".header .store_buttons").before(n.render().$el),n.triggerCurrentFilter(!0,!1),new d({fileBrowserView:t}).initFilterBtns(e.find(".header .store_buttons .filter_dropdown_button"))},j=function(e,t){return t.search({minCharacters:2,maxResults:20,searchOnFocus:!0,showNoResults:!1,searchDelay:600,cache:!1,onSelect:function(n,r,o){var a,s,l,c,u,d,p;return"system:history"===n?(t.find(".search_input").blur(),p=o.find(".title").html(),p,null!=(l=e.fileBrowserView)&&l.searchFile(p),void(k=!0)):(t.search("hide results"),d={},-2===(a=n.docId)?(s=n.query,k=!0,F(s),d.ids=L.allFileIds,null!=(c=e.fileBrowserView)&&c.searchFile(s,!0,d),void t.find(".search_input").blur()):(-3===a&&(a=-1,d.ids=L.allFileIds),-1===a?(s=n.query,k=!0,F(s),s=s.replace(/^['"]*|['"]*$/g,""),null!=(u=e.fileBrowserView)&&u.searchFile('"'+s+'"',!0,d),void t.find(".search_input").blur()):(i.getFileCollection().getModelById(a,(function(e,t){var n,i;return e?f.showMessage("\u6253\u5f00\u6587\u4ef6\u5931\u8d25:"+e,6e3,"error"):t?(n=null!=(i=window.event)?i.ctrlKey:void 0,setTimeout((function(){if(!n)return $(window).trigger("createNewEditor",[t,{groupId:A}]);$(window).trigger("changeFileModel",t)}),300)):f.showMessage("\u6253\u5f00\u6587\u4ef6\u5931\u8d25: \u627e\u4e0d\u5230\u8be5\u6587\u4ef6",6e3,"error")})),!1)))},apiSettings:{responseAsync:function(e,t){var n,i;return i=e.urlData.query,n=a.pouchDB,h.getTitleView(n,(function(e,r){var o,a;if(r)return a=r.viewName,o={reduce:!1,group:!1,stale:"update_after"},n.query(a+"/by_title",o).then((function(e){var n,r,o;return r=e.rows.map((function(e){return{docId:e.id,snippet:e.id,createDate:e.value.createDate,value:e.key}})),(n=new FilteredList(r)).setFilter(i),o=[{docId:-1,query:i,description:"\u4e0d\u5206\u8bcd\u67e5\u8be2\uff1a"+i},{docId:-2,query:i,description:"\u5f53\u524d\u8fc7\u6ee4\u5668 `"+L.filterInfo.name+"` \u7ed3\u679c\u96c6("+L.allFileIds.length+")\u4e0b\u67e5\u8be2: "+i},{docId:-3,query:i,description:"\u5f53\u524d\u8fc7\u6ee4\u5668 `"+L.filterInfo.name+"` \u7ed3\u679c\u96c6("+L.allFileIds.length+")\u4e0b\u4e0d\u5206\u8bcd\u67e5\u8be2: "+i}],n.filtered.slice(0,200).forEach((function(e,t){return o.push({docId:e.docId,description:moment(e.createDate).format("YYYY-MM-DD hh:mm:ss"),title:e.value})})),t({success:!0,results:o})}))}))}}})},B.prototype.refreshFolder=function(e,t){if(this.fileModel&&this.storePluginView)return this.storePluginView.refreshFolder(this.fileModel,e,t)},B.prototype.changeFileModel=function(e,t){var n,r;if(this.stopListening(),this.fileModel,this.fileModel=e,this.fileBrowserView&&e&&this.fileBrowserView.changeFileModel(e,t),x&&e&&x.shineDocs([e.attributes],{focus:!0}),n=this.fileModel.get("pluginName"),this.listenTo(this.fileModel,"xsj_filemodel_add_attachment_event",(r=this,function(e,t,o,a){var s;if(i.getApplicationProfileModel(),n=r.fileModel.get("pluginName"),r.storePluginView&&r.storePluginModel&&r.storePluginModel.get("name")===n)return"function"==typeof(s=i.getPlugin(r.storePluginModel)).saveAttach?s.saveAttach({},e,t,o,a,{},(function(e){})):void 0})),this.storePluginView&&this.storePluginModel&&this.storePluginModel.get("name")===n)return this.storePluginView.expandKeyPath(this.fileModel)},B.prototype.renderFileBrowserHeader=function(){return this.$el.find(".main_avatar").attr("src","img/avatar_d_white_bg_128x128.png"),this.$el.find(".sendary_avatar").attr("src","img/default.jpg")},B.prototype.renderStoreTreeHeader=function(){var e,t,n,r,o;return n=i.plugins,t=this.storePluginModel.get("name"),e=i.getPlugin(this.storePluginModel),o=this,r=function(e){var i,r,a,s;return a=e.email,i=e.avatar,r=o.$el.find(".main_avatar")[0],s=o.$el.find(".sendary_avatar")[0],r.src=i||(a?"http://www.gravatar.com/avatar/"+CryptoJS.MD5(a).toString():"img/default.jpg"),r.onerror=function(){return r.src="img/default.jpg"},s.src=n[t].icon},e.getAccountInfo((function(e,t){return e?f.showMessage("\u52a0\u8f7d\u7528\u6237\u4fe1\u606f\u51fa\u73b0\u9519\u8bef"+e,6e3,"error"):r(t)}))},B.prototype.hideSearchResultOutlineContainer=function(){return this.$el.find(">.content").removeClass("file_browser_and_search_result"),I&&I.remove(),I=null},B.prototype.showSearchResultOutlineContainer=function(e,t,n,r){var o;return(o=this.$el.find(">.content")).addClass("file_browser_and_search_result"),I||(I=new m({editorView:i.homeView.editorView})).show(o),I.changeFileModel(r||this.fileModel),I.setQueryTerms(e,t,n)},B.prototype.showTempSearchResultOutlineContainer=function(e,t,n){if(I)return I._tempQueryTermsTimeout&&clearTimeout(I._tempQueryTermsTimeout),I._tempQueryTermsTimeout=setTimeout((function(){return I._tempQueryTermsTimeout=null,I.setTempQueryTerms(e,t,n)}),100)},B.prototype.hideTempSearchResultOutlineContainer=function(){if(I)return I._tempQueryTermsTimeout&&(clearTimeout(I._tempQueryTermsTimeout),I._tempQueryTermsTimeout=null),I._tempQueryTermsTimeout=setTimeout((function(){return I.hideTempQueryTerms()}),100)},B.prototype.changeStorePluginModel=function(e,t){var n,r,o,a,s;if((!MINI_WEB||DOCKER_VERSION)&&(e&&(o=e.get("name"),i.getPlugin(e)||(e=null,f.showMessage('\u7b2c\u4e09\u65b9\u7ed1\u5b9a"'+o+'"\u5728\u8be5\u5e73\u53f0\u4e0d\u88ab\u652f\u6301',6e3,"warning"))),(this.storePluginModel||t)&&(this.storePluginModel!==e||t)))return this.storePluginModel=e,r=this.$el.find(">.content"),null!=(a=this.storePluginView)&&a.destroy(),this.storePluginView=null,n=this.$el.find(".bind_store"),this.$el.find(".footer .close_store_button, .footer .store_buttons").show(),e?(o=e.get("name"),n.attr("title","\u5f53\u524d\u7ed1\u5b9a:"+o),r.addClass("file_browser_and_tree"),this.storePluginView=new y({fileCollection:this.fileCollection,model:e,storeView:this}),r.append(this.storePluginView.render().$el),this.storePluginView.initPlugin()):(n.attr("title","\u7ed1\u5b9a\u7b2c\u4e09\u65b9\u5b58\u50a8"),r.removeClass("file_browser_and_tree")),null!=(s=this.fileBrowserView)?s.refreshFile():void 0},B}(x),n.exports=b}}),window.requirejs.define({"views/table_component/new_table_view":function(e,t,n){var i,r,o,a,s,l,c=function(e,t){return function(){return e.apply(t,arguments)}},u={}.hasOwnProperty;a=t("../view"),o=t("../../lib/utils"),t("../../lib/utils_table"),t("../../application"),r=t("../../lib/notifier"),t("../../constant"),s=t("./templates/new_table"),l=null,i=function(e){function t(){return this.selectGridRang=c(this.selectGridRang,this),this.cleanGridInfo=c(this.cleanGridInfo,this),this.showGridInfo=c(this.showGridInfo,this),this.cancelSelectedFile=c(this.cancelSelectedFile,this),t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)u.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.template=s,t.prototype.className="new_table",t.prototype.selectGridInfo=null,t.prototype.tableTemplateId=null,t.prototype.selectFile=null,t.prototype.selectFileContent=null,t.prototype.currentTab="grid",t.prototype.initialize=function(e){return this.tableManager=e.tableManager,l=this},t.prototype.events={"click .drop-zone":"selectFileFn","click .grid_cell":"selectGridRang","paste .html_textarea":"pasteHtmlFn","mouseout .grid_cell":"cleanGridInfo","mouseover .grid_cell":"showGridInfo","click .cancel_selected_file":"cancelSelectedFile"},t.prototype.pasteHtmlFn=function(e){var t,n,i;if(n=(i=e.originalEvent).clipboardData.getData("text/html"),i.clipboardData.getData("text/plain"),(t=$("<div>"+n+"</div>").find("table")).length>0)return e.currentTarget.value=t[0].outerHTML,e.preventDefault(),e.stopPropagation()},t.prototype.cancelSelectedFile=function(e){return this.$el.find(".selected_file").html(""),this.selectFile=null,this.selectFileContent=null,l.$el.find("input[type=file]").val("")},t.prototype.showGridInfo=function(e){var t,n,i;return t=$(e.currentTarget),i=t.data("row"),n=t.data("column"),l.$el.find(".grid_info").html(i+" x "+n),l.$el.find(".grid_cell").removeClass("filled"),l.$el.find(".grid_cell").each((function(e,t){var r,o,a;if(a=(r=$(t)).data("row"),o=r.data("column"),a<=i&&o<=n)return r.addClass("filled")}))},t.prototype.cleanGridInfo=function(e){var t,n,i;return t=l.$el.find(".grid_info"),l.selectGridInfo?(i=l.selectGridInfo.row,n=l.selectGridInfo.column,t.html(i+"x"+n)):t.html(""),l.$el.find(".grid_cell").removeClass("filled")},t.prototype.selectGridRang=function(e){var t,n,i,r;return t=$(e.currentTarget),i=t.data("row"),n=t.data("column"),r=l.selectGridInfo,l.$el.find(".selected").removeClass("selected"),r&&r.row===i&&r.column===n?l.selectGridInfo=null:(l.selectGridInfo={row:i,column:n},l.$el.find(".grid_cell").each((function(e,t){var r,o,a;if(a=(r=$(t)).data("row"),o=r.data("column"),a<=i&&o<=n)return r.addClass("selected")})))},t.prototype.selectFileFn=function(){return l.$el.find("input[type=file]").trigger("click")},t.prototype.afterRender=function(){var e,t,n;return 10,10,t=["<div class='grid_info'></div><table class='select_grid'>"],function(){e=[];for(var t=0;t<=10;t++)e.push(t);return e}.apply(this).forEach((function(e,n){var i,r;return i=[],function(){r=[];for(var e=0;e<=10;e++)r.push(e);return r}.apply(this).forEach((function(e,t){return i.push("<td class='grid_cell' data-row='"+(n+1)+"' data-column='"+(t+1)+"'></td>")})),t.push("<tr class='grid_row'>"+i.join("")+"</tr>"),i=[]})),t.push("</table>"),n=t.join(""),this.$el.find(".new_table_grid_container").html(n)},t.prototype.show=function(){var e,t;return this.render(),this.tableManager.$el.find(".new_table_container").append(this.$el),this.$el.find(".menu .item").tab({onVisible:function(e){return l.currentTab=e}}),t=this,e=function(e){var n;if(!(e.length<=0))return n=e[0],t.tableManager.showDimmer(),t.tableManager.convertFileDataToTableStr(n,(function(e,t){return l.tableManager.hideDimmer(),e?r.showMassage("\u51fa\u9519:"+e,6e3,"error"):(l.selectFileContent=l.tableManager.filterContent(t),l.selectFile=n,l.$el.find(".selected_file").html("\u9009\u62e9\u7684\u6587\u4ef6\uff1a "+n.name+" <i class='link icon close cancel_selected_file'></i>"))}))},o.initFileImportSupport(l.$el.find("input[type=file]"),e),o.initdragFilesSupport(this.$el,e)},t.prototype.hide=function(){return this.$el.find(".menu .item").tab("destroy"),l=null,this.remove()},t.prototype.getResult=function(e){var t,n,i;switch(i="",this.currentTab||"grid"){case"grid":l.selectGridInfo&&(n=l.selectGridInfo.row,t=l.selectGridInfo.column,i=o.generateTableHtml(n,t));break;case"upload":l.selectFile&&l.selectFileContent&&(i=l.selectFileContent);break;case"html":i=l.$el.find(".html_textarea").val(),i=l.tableManager.filterContent(i);break;case"template":i=""}return i?e(null,i):e("\u60a8\u8fd8\u6ca1\u6709\u9009\u62e9\u8981\u521b\u5efa\u7684\u8868\u683c")},t}(a),n.exports=i}}),window.requirejs.define({"views/table_component/table_manager_view":function(e,t,n){var i,r,o,a,s,l,c,u,d,p,f,h,m,v,g,w=function(e,t){return function(){return e.apply(t,arguments)}},y={}.hasOwnProperty;d=t("../view"),u=t("../../lib/utils"),i=t("../../application"),l=t("../../lib/resource_core"),r=t("../../models/attachment_model"),s=t("../../lib/notifier"),o=t("../../constant"),v=t("./templates/table_manager"),a=t("./new_table_view"),m=t("../../lib/preview_core"),g=null,p=null,f=null,h='<table id="tinymcetable" class="table table-celled table-component" style="border-collapse: collapse; width: 100%;" border=1>\n<thead>\n  <tr>\n    <th>header1</th>\n    <th>header2</th>\n  </tr>\n</thead>\n<tbody>\n  <tr>\n    <td></td>\n    <td></td>\n  </tr>\n  <tr>\n    <td></td>\n    <td></td>\n  </tr>\n</tbody>\n</table>',c=function(e){function t(){return this.createNewTable=w(this.createNewTable,this),this.showNew=w(this.showNew,this),this.showHistory=w(this.showHistory,this),this.showRevDetail=w(this.showRevDetail,this),this.returnMain=w(this.returnMain,this),this.returnEditor=w(this.returnEditor,this),this.closeWindow=w(this.closeWindow,this),t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)y.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.template=v,t.prototype.className="draggable_dialog_content_container table_manager_container",t.prototype.isLoading=!1,t.prototype.isSaving=!1,t.prototype.preContent="",t.prototype.hasAutoSave=!1,t.prototype.mode="edit",t.prototype.currentRev=null,t.prototype._debounceAutoSave=null,t.prototype.newTableView=null,t.prototype.editor=null,t.prototype.initTargetWindowStyleFn=null,t.prototype.initialize=function(e){var t;return this.fileModel=e.fileModel,this.link=e.link,this.filename=e.link.replace(/^[\.\/]*/g,""),this.popupManager=e.popupManager,g=this,t=i.getPreviewProfileModel(),g.initTargetWindowStyleFn=function(){if(g&&p)return i.getStyleText(g.fileModel,(function(e,t){return m.setCustomCss(t,p)}))},this.listenTo(this.fileModel,"change:cssText",g.initTargetWindowStyleFn),this.listenTo(t,"change:codePreviewCss change:systemPreviewCss change:useSystemPreviewCss change:userPreviewCssText",g.initTargetWindowStyleFn)},t.prototype.events={"click .ui.cancel.button":"closeWindow","click .return_editor_button":"returnEditor","click .ui.button.positive":"save","click .return_button":"returnMain","click .use_current_version_button":"useCurrentVersion","click .history_button":"showHistory","click .new_button":"showNew","click .create_new_button":"createNewTable","click .rev_info":"showRevDetail"},t.prototype.closeWindow=function(){return this.popupManager.close()},t.prototype.returnEditor=function(){return this.setMode("edit")},t.prototype.returnMain=function(){return this.setMode("revList")},t.prototype.useCurrentVersion=function(){if(this.revContent)return this.setContent(this.revContent,(function(){return this.setMode("edit")}))},t.prototype._showRevDetail=function(e,t){var n,i;return this.currentRev=t,n=o.pouchDB,this.showDimmer(),i=this.fileModel.id+"__"+this.filename,n.getAttachment(i,"attachment",{rev:t},(function(n,i){return n?(s.showMessage("\u52a0\u8f7d\u5386\u53f2\u7248\u672c\u51fa\u9519:"+n,6e3,"error"),g.hideDimmer()):u.blobToString(i,(function(n,i){return n?(g.hideDimmer(),s.showMessage("\u52a0\u8f7d\u5386\u53f2\u7248\u672c\u51fa\u9519:"+n,6e3,"error")):(g.hideDimmer(),g.revContent=i,g.rev=t,e.innerHTML=i)}))}))},t.prototype.showRevDetail=function(e){var t,n,i,r,o,a;return i=$(e.currentTarget),o=i.data("value"),this.setMode("revDetail"),a=null,t=this.$el.find(".table_history_detail_container"),(n=t.find(">iframe")).length<=0?(n=$('<iframe src="tinymce/tinymce_table_preview.html" class="preview_iframe" frameborder="0" style="width: 100%;height:100%;"></iframe>').appendTo(t)).on("load",(function(){var e;return e=n[0],a=e.contentDocument.body,g._showRevDetail(a,o)})):(r=n[0],a=r.contentDocument.body,this._showRevDetail(a,o))},t.prototype._showHistory=function(){var e,t,n;return t=o.pouchDB,n=this.fileModel.id+"__"+this.filename,(e=this.$el.find(".table_history_container tbody")).empty(),this.showDimmer(),t.get(n,{conflicts:!1,revs_info:!0},(function(t,n){var i,r;return t?s.showMessage("\u52a0\u8f7d\u6587\u4ef6\u5386\u53f2\u8bb0\u5f55\u51fa\u9519\uff1a"+t,6e3,"error"):(r=n._revs_info,i=r.length,r.forEach((function(t,n){var r;return r="","missing"===t.status&&(r="error"),e.append("<tr data-value='"+t.rev+"' class='rev_info "+r+"'><td class='rev_index center aligned' data-index='"+(i-n)+"'>"+(i-n)+"</td><td class='rev_detail' colspan='2'>"+t.rev+"</td></tr>")}))),g.hideDimmer()}))},t.prototype.showHistory=function(e){var t;return $(e.currentTarget),"revList"===(t=g.mode)||"revDetail"===t?this.setMode("edit"):(this.setMode("revList"),this._showHistory())},t.prototype.showNew=function(e){var t;return $(e.currentTarget),"new"===g.mode?((t=g.newTableView)&&(t.hide(),g.newTableView=null),g.setMode("edit")):((t=new a({tableManager:this})).show(),g.newTableView=t,g.setMode("new"))},t.prototype.createNewTable=function(e){var t;return $(e.currentTarget),(t=g.newTableView).getResult((function(e,n){return e?s.showMessage("\u9519\u8bef:"+e,6e3,"error"):(t.hide(),g.newTableView=null,g.setContent(n,(function(){return g.setMode("edit")})))}))},t.prototype.setMode=function(e){var t,n;switch(g.mode=e,n=this.$el.find(".new_button"),t=this.$el.find(".history_button"),g.revContent=null,g.rev=null,e){case"new":return this.$el.find(".return_button, .use_current_version_button").hide(),this.$el.find(".close_button, .save_button").hide(),this.$el.find(".return_editor_button").show(),n.addClass("blue").removeClass("basic").show(),this.$el.find(".create_new_button").show(),t.hide(),this.$el.find(".table_history_detail_container").hide(),this.$el.find(".table_history_container").hide(),this.$el.find(".table_editor_container").hide(),this.$el.find(".new_table_container").show();case"revList":return this.$el.find(".close_button, .save_button").hide(),this.$el.find(".return_button, .use_current_version_button").hide(),this.$el.find(".return_editor_button").show(),t.addClass("blue").removeClass("basic").show(),n.hide(),this.$el.find(".create_new_button").hide(),this.$el.find(".table_history_detail_container").hide(),this.$el.find(".new_table_container").hide(),this.$el.find(".table_editor_container").hide(),this.$el.find(".table_history_container").show();case"revDetail":return this.$el.find(".return_button, .use_current_version_button").show(),this.$el.find(".return_editor_button").hide(),t.addClass("blue").removeClass("basic").show(),n.hide(),this.$el.find(".create_new_button").hide(),this.$el.find(".table_history_detail_container").show(),this.$el.find(".table_history_container").hide(),this.$el.find(".new_table_container").hide(),this.$el.find(".table_editor_container").hide();default:return this.$el.find(".return_button, .use_current_version_button").hide(),this.$el.find(".return_editor_button").hide(),t.removeClass("blue").addClass("basic").show(),n.removeClass("blue").addClass("basic").show(),this.$el.find(".close_button, .save_button").show(),this.$el.find(".create_new_button").hide(),this.$el.find(".table_history_detail_container").hide(),this.$el.find(".table_history_container").hide(),this.$el.find(".new_table_container").hide(),this.$el.find(".table_editor_container").show()}},t.prototype.save=function(){return g._save()},t.prototype._autoSave=function(){var e;if(!g.isSaving)return f&&f.TableEditor?(e=f.getContent(),g._filterContent(e,(function(e,t){var n,i,o,a;if(g.preContent!==t)return a=g.filename,o=g.fileModel.id,"text/html",i=new Blob([t],{type:"text/html"}),(n=g.$el.find(".ui.button.positive")).addClass("loading"),r.createAttachment(o,a,"text/html",i,(function(e,i){return g.preContent=t,g.isSaving=!1,g.hasAutoSave=!0,g.preContent=t,n.removeClass("loading")}))}))):void 0},t.prototype._filterContent=function(e,t){var n,i,r;return r=this.filename,i=path.dirname(r),n={},g.fileModel.getAllAttachObjects((function(r,o){return null==o&&(o=[]),o.forEach((function(e){return n[e.objectUrl]="./"+e.key})),e=e.replace(/src="(blob:[^"]+)"/g,(function(e,t){var r;return(r=n[t])?0!==(r=path.relative(i,r)).indexOf(".")&&(r=0===r.indexOf("/")?"."+r:"./"+r):r=t,'src="'+r+'" '})),t(null,e)}))},t.prototype._save=function(){var e,t,n;if("text/html",n=this.filename,t=this.fileModel,!g.isSaving)return f&&f.TableEditor?(e=f.getContent(),g._filterContent(e,(function(e,i){var r,o;return g.preContent!==i||g.hasAutoSave?(n||(n=Date.now()+".table.html"),o=new Blob([i],{type:"text/html"}),g.isSaving=!0,(r=g.$el.find(".ui.button.positive")).addClass("loading"),t.addAttachment(o,n,"text/html",{fixRepeatFilename:!1},(function(e,n,o,a){return t.trigger("attachmentChange",t,n,"url_xsj_remote_html_./"+n),s.showMessage("\u4fdd\u5b58\u6210\u529f",6e3,"info"),g.preContent=i,g.hasAutoSave=!1,g.isSaving=!1,r.removeClass("loading"),g.closeWindow()}))):(s.showMessage("\u4fdd\u5b58\u6210\u529f",6e3,"info"),g.closeWindow())}))):void 0},t.prototype.afterRender=function(){return this.popupManager.setTitle(this.filename)},t.prototype.close=function(){var e,t;return null!=(e=g.editor)&&e.off("change"),g.stopListening(),g.initTargetWindowStyleFn=null,g.editor=null,null!=(t=g.newTableView)&&t.hide(),g.newTableView=null,g=null,p=null,f=null,this.remove()},t.prototype.reInit=function(e){var t;if(e.fileModel&&e.fileModel!==this.fileModel&&(this.stopListening(this.fileModel),this.fileModel=e.fileModel,this.listenTo(this.fileModel,this.initTargetWindowStyleFn)),t=this.filename,this.fileModel,this.link=e.link,this.filename=e.link.replace(/^[\.\/]*/g,""),this.popupManager.setTitle(this.filename),t!==this.filename)return g.editor.off("change",g._debounceAutoSave),g.isLoading=!0,g.showDimmer(),this.loadData((function(e,t){return g.isLoading=!1,e?(s.showMessage("\u52a0\u8f7d\u6587\u4ef6\u51fa\u9519:"+e,6e3,"error"),g.editor.on("change",g._debounceAutoSave),g.hideDimmer()):g.setContent(t,(function(){return g.editor.on("change",g._debounceAutoSave),g.hideDimmer()}))}))},t.prototype.show=function(e){return this.render(),this.$el.find(".return_button, .return_editor_button, .use_current_version_button, .create_new_button").hide(),e.append(this.$el),this.showContent()},t.prototype.showDimmer=function(){return g.popupManager.showDimmer()},t.prototype.hideDimmer=function(e){if(null==e&&(e=!1),e||!g.isLoading)return g.popupManager.hideDimmer()},t.prototype.showContent=function(){var e;return e=$('<iframe src="tinymce/tinymce_table.html" class="preview_iframe" frameborder="0" style="width: 100%;height:100%;"></iframe>').appendTo(this.$el.find(".table_editor_container")),g.isLoading=!0,g.showDimmer(),window,e.on("load",(function(){var t,n,r,o;return r=e[0],p=r.contentDocument,(f=r.contentWindow).addEventListener("click",(function(){return g.popupManager.focus()})),g._debounceAutoSave=_.debounce((function(){return null!=g?g._autoSave(!0):void 0}),1e4),n=function(e){var t,n;return t=g.fileModel,n=[],t.getAllAttachObjects((function(t,i){var r;return null==i&&(i=[]),r=function(e,t){var i,r,o;return r=e.key,o=e.objectUrl,".JPG"===(i=u.getExt(r,1).toUpperCase())||".JPEG"===i||".PNG"===i||".GIF"===i?u.blob2Base64(e.data,(function(i,a){var s;return a&&(s=g.editor.editorUpload.blobCache.create({id:r,blob:e.data,base64:a,name:r,blobUri:o}),g.editor.editorUpload.blobCache.add(s),n.push({title:r,value:o})),t()})):t()},async.mapLimit(i,20,r,(function(){return e(n)}))}))},o=function(e,t,n){var i,r,o,a;return r=g.fileModel,o=(i=e.blob()).type,a=e.id(),r.hasAttachment(a)?t(e.blobUri()):l.uploadResource({},r,e.filename(),o,i,{},(function(n,r,o,a,s){var l,c;return l=e.base64(),c=g.editor.editorUpload.blobCache.create({id:r,blob:i,base64:l,name:r,blobUri:s}),g.editor.editorUpload.blobCache.add(c),t(s)}))},t=function(e,t,n){return e?(s.showMessage("\u51fa\u9519:"+e,6e3,"error"),n()):g.setContent(t,(function(){return n()}))},i.getStyleText(g.fileModel,(function(e,t){return m.setCustomCss(t,p)})),f.createTableEditor("","",n,o,t,g,(function(e,t){return e?s.showMessage("\u521b\u5efa\u8868\u683c\u5931\u8d25:"+e,6e3,"error"):g.loadData((function(e,n){return g.isLoading=!1,g.editor=t,g.editor.on("change",g._debounceAutoSave),e?(s.showMessage("\u52a0\u8f7d\u6587\u4ef6\u51fa\u9519:"+e,6e3,"error"),g.hideDimmer()):g.setContent(n,(function(){return g.hideDimmer()}))}))}))}))},t.prototype.loadData=function(e){var t,n,i,o,a;return o=this.fileModel,a=this.filename,(i=new r({_id:o.id+"__"+a})).fetch({options:{get:{attachments:!0}}}).then((function(e){return n(i,t)})).catch((function(e){return n(i,t)})),n=function(e,t){var n,i,r,o,a;return(i=e.get("_attachments"))&&i.attachment?(r=(n=i.attachment).data,a=n.content_type,o=u.base642Blob(r,a),u.blobToString(o,(function(e,n){return t(e,n)}))):t(null,null)},t=function(t,n){return o.getAttachObjectByFilename(a,(function(t,i){var r;return"",i&&i.objectUrl?(r=i.objectUrl,u.objectURLToString(r,(function(t,i){return n&&i!==n&&(i=n,s.showMessage("\u60a8\u4e0a\u6b21\u7f16\u8f91\u7684\u8868\u683c\u672a\u53ca\u65f6\u4fdd\u5b58\uff0c\u7cfb\u7edf\u81ea\u52a8\u4f7f\u7528\u6700\u65b0\u4e00\u4e2a\u7248\u672c\u7684\u8868\u683c\u5185\u5bb9\uff0c\u60a8\u53ef\u4ee5\u901a\u8fc7\u5386\u53f2\u8bb0\u5f55\u5207\u6362\u5230\u60f3\u8981\u7684\u7248\u672c\u3002",6e3,"warning")),e(t,i)}))):e(null,"")}))}},t.prototype.convertFileDataToTableStr=function(e,t){if(this.editor)return this.editor.convertFileDataToTableStr(e,t)},t.prototype.filterContent=function(e){return u.filterTableContent(e)},t.prototype.setContent=function(e,t){var n,i,r,o,a;if(e||(e=h),!g.isLoading&&f)return(e=g.filterContent(e))||(e=h),g.preContent=e,n=$(e),r=this.filename,i=path.dirname(r),o=[],n.find("img").map((function(e,t){var n,r;if(0===(r=(n=$(t)).attr("src")||"").indexOf(".")&&(r=path.resolve("/",i,r)),r=r.replace(/^[\.\/]*/g,""))return o.push({el:n,src:r})})),a=function(e,t){var n,i;return i=e.src,n=e.el,g.fileModel.getAttachObjectByFilename(i,(function(e,i){var r;return i&&(r=i.objectUrl,n.attr("src",r)),t()}))},async.mapLimit(o,20,a,(function(){var e,i,r,o,a,s;if(o={},a="",s=n[0]){for(r=(i=s.attributes).length;r>0;)o[(e=i[--r]).name]=e.value;a=s.innerHTML}return f.setContent(a,o),"function"==typeof t?t():void 0}))},t}(d),n.exports=c}}),window.requirejs.define({"views/table_component/templates/new_table":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<div class="ui pointing secondary menu">\n<a class="item active " data-tab="grid">\u65b0\u5efa</a>\n<a class="item" data-tab="upload">\u4e0a\u4f20</a>\n<a class="item" data-tab="html">HTML</a>\n</div>\n<div class="ui tab new_table_grid_container active" data-tab="grid">\u65b0\u5efa</div>\n<div class="ui tab new_table_upload_container" data-tab="upload">\n<input type="file" name="fileData" class="form-control" style="display:none;">\n<p class="drop-zone">\u9009\u62e9\u4e00\u4e2a\u8868\u683c\u6587\u4ef6(.xls,.xlsx,.csv,.html\u7b49),\u6216\u8005\u5c06\u6587\u4ef6\u62d6\u62fd\u5230\u8fd9\u91cc</p>\n<p class="selected_file" style="margin: 20px;"></p>\n</div>\n<div class="ui tab new_table_html_container" data-tab="html">\n<textarea class="html_textarea" name="htmlTextArea"\nplaceholder="\u8bf7\u8f93\u5165html\u5185\u5bb9,\u526a\u5207\u677f\u5185\u5982\u679c\u6709\u5bcc\u6587\u672c\u7684\u8868\u683c\uff0c\u53ef\u4ee5\u76f4\u63a5ctrl+v\u7c98\u8d34\u5230\u8fd9\u91cc" style="width: 100%; height: 100%;"></textarea>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/table_component/templates/table_manager":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<div class="draggable_dialog_content">\n<div class="table_editor_container iframe_wrapper" style="width:100%;height:100%;overflow:hidden;"></div>\n<div class="new_table_container" style="width:100%;height:100%;overflow:hidden;display:none;"></div>\n<div class="table_history_container history_container" style="width: 100%; display:none;">\n<table class="ui celled structured table revs_info selectable">\n<thead>\n<tr>\n<th class="one wide"></th>\n<th class="ten wide" colspan="2">\u7248\u672c\u53f7</th>\n</tr>\n</thead>\n<tbody></tbody>\n</table>\n</div>\n<div class="table_history_detail_container history_detail_container iframe_wrapper" style="width: 100%;display:none;overflow:hidden;"></div>\n</div>\n<div class="draggable_dialog_footer actions">\n<div class="tips">\n<div class="ui mini basic button history_button icon"><i class="icon history" title="\u5386\u53f2\u8bb0\u5f55"></i></div>\n<div class="ui mini basic button new_button icon"><i class="icon table" title="\u521d\u59cb\u5316"></i></div>\n</div>\n<div class="ui mini basic button return_button">\u8fd4\u56de</div>\n<div class="ui mini basic button return_editor_button">\u53d6\u6d88</div>\n<div class="ui mini basic button create_new_button">\u786e\u5b9a</div>\n<div class="ui mini basic button use_current_version_button">\u4f7f\u7528\u8be5\u7248\u672c</div>\n<div class="ui cancel mini button close_button">\n\u5173\u95ed\n</div>\n<div class="ui positive mini button save_button">\n<span>\u4fdd\u5b58</span>\n</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/table_of_content_view":function(e,t,n){var i,r,o,a,s,l,c,u,d,p,f,h,m,v,g,w,y,b=function(e,t){return function(){return e.apply(t,arguments)}},x={}.hasOwnProperty;o=t("./view"),t("../application"),y=t("./templates/table_of_content"),r=t("../lib/utils"),a=null,w=function(e){return e.replace(/(<([^>]+)>)/gi,"")},l=function(e,t){var n,i,r,o;if(e===t)return!0;if(o=[],e.length!==t.length)return!1;for(n=0;n<e.length;){if(r=e[n],i=t[n],r.level!==i.level)return!1;r.content!==i.content&&(o[n]={id:n+1,title:i.content}),n++}return o},p=function(e){var t,n;return t=0,n={},_.reduce(e.split("\n"),(function(e,i){return n[t]=e,t++,e+i.length+1}),0),n},h=function(e){var t,n;return n=e.tree.rootNode,t=0,n.visit((function(n){return t++,n!==e})),t},d=function(e,t){return e[t].line},u=function(e,t){return e[t].level},f=function(e,t){var n,i,r,o;for(null,n=null,r=0,o=e.length;r<o;r++)if(i=e[r],n){if(i.level<=n)return i.line}else if(i.line>=t){i,n=i.level;continue}return-1},g=/^([#]+)\s+/,v=/^[-]{3,}$/,m=/^[=]{3,}$/,s=function(e,t){var n,i,r,o,a,s,l,c,u;for(n=e.split("\n"),u=[],i=0,c=-1,s=-1,l=-1,r=-1;i<n.length;)o=n[i],i<n.length-1&&((a=n[i+1]).match(m)&&(o="# "+o,i++),a.match(v)&&(o="## "+o,i++)),o=o.replace(g,(function(e,n){if((s=n.length)>0)return-1===c&&(c=s),-1===l&&(l=s,r=t),l<s?r+=1:l>s&&(r-=1),r<=0&&(r=t),l=s,"#".repeat(r)+" "})),i++,u.push(o);return u.join("\n")},c=_.debounce((function(e,t){var n,i,r;return r=(i=$.ui.fancytree.getNode(e)).getParentList(),n=[],r&&r.forEach((function(e){return n.push(e.title)})),n.push(i.title),n.length>0?t.$el.find(".toc_tooltip_bar_content").text(n.join(" / ")):t.$el.find(".toc_tooltip_bar_content").text("")}),100),i=function(e){function t(){return this.tocClick=b(this.tocClick,this),this._refresh=b(this._refresh,this),this.tocGoToBottomFn=b(this.tocGoToBottomFn,this),this.tocBackToTopFn=b(this.tocBackToTopFn,this),this.tocCollapseAllFn=b(this.tocCollapseAllFn,this),this.tocExpandAllFn=b(this.tocExpandAllFn,this),this.closeFn=b(this.closeFn,this),t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)x.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.template=y,t.prototype.className="toc_list",t.prototype._throttleSyncToc=null,t.prototype._ISTOCEXPANDALLED=!1,t.prototype._isListeningSyncScroll=!1,t.prototype._isDragAndDroping=!1,t.prototype.initDragAndDrop=!1,t.prototype.linePosMap={},t.prototype.headings=[],t.prototype.idHeadingMaps={},t.prototype.isDnDContentChange=!1,t.prototype.initWide=!0,t.prototype.refresh=null,t.prototype.initialize=function(e){var t;return this._$container=e.$container,this.gotoLineFn=e.gotoLineFn,this.getFirstVisibleRowFn=e.getFirstVisibleRowFn,this.getContentFn=e.getContentFn,t=this,this.listenToSyncFn=function(n){return t._isListeningSyncScroll=!0,e.listenToSyncFn(n)},this.unListenToSyncFn=function(n){return t._isListeningSyncScroll=!1,e.unListenToSyncFn(n)},this.initDragAndDrop=e.initDragAndDrop,"boolean"==typeof e.initWide&&(this.initWide=e.initWide),this.setContentFn=e.setContentFn||$.noop,this.parent=e.parent,this.refresh=_.debounce(this._refresh,300)},t.prototype.events={"click .toc a":"tocClick","click .expand_all_button":"tocExpandAllFn","click .close_button":"closeFn","click .collapse_all_button":"tocCollapseAllFn","click .back_to_top_button":"tocBackToTopFn","click .go_to_bottom_button":"tocGoToBottomFn","mouseenter span.fancytree-title":"mouseenterTreeNodeFn"},t.prototype.mouseenterTreeNodeFn=function(e){return c(e,this)},t.prototype.closeFn=function(){var e;return null!=(e=this.parent)?e.hide():void 0},t.prototype.tocExpandAllFn=function(e){return this._tocExpandAllFn()},t.prototype._tocExpandAllFn=function(e){var t,n;return t=this,this.$el.find(".collapse_all_button").show(),this.$el.find(".expand_all_button").hide(),n=[],t.$el.find(".toc").fancytree("option","autoCollapse",!1),this.$el.find(".toc").addClass("toc_expand_all"),this.$el.find(".toc").fancytree("getRootNode").visit((function(e){var t;return t=e.setExpanded(!0),n.push(t)})),$.when.apply(null,n).done((function(){return t.$el.find(".toc").fancytree("option","autoCollapse",!1),t._ISTOCEXPANDALLED=!0,"function"==typeof e?e():void 0}))},t.prototype.tocCollapseAllFn=function(){return this._tocCollapseAllFn()},t.prototype._tocCollapseAllFn=function(e){var t,n;return t=this,this.$el.find(".collapse_all_button").hide(),this.$el.find(".expand_all_button").show(),n=[],this._ISTOCEXPANDALLED=!1,this.$el.find(".toc").fancytree("option","autoCollapse",!0),this.$el.find(".toc").removeClass("toc_expand_all"),this.$el.find(".toc").fancytree("getRootNode").visit((function(e){var t;return t=e.setExpanded(!1),n.push(t)})),$.when.apply(null,n).done((function(){return t._ISTOCEXPANDALLED=!1,"function"==typeof e?e():void 0}))},t.prototype.tocBackToTopFn=function(){return this.gotoLineFn("top")},t.prototype.tocGoToBottomFn=function(){return this.gotoLineFn("bottom")},t.prototype._refresh=function(e){var t,n,i,r,o,a,s,c,u;if(e&&e.preventDefault&&(e.preventDefault(),e.stopPropagation()),this.linePosMap=this.getLinePosMap(),i=this.getHeadingInfo(),c=this.headings,this.headings=i.headings,this.idHeadingMaps=i.idHeadingMaps,!this.isDnDContentChange)return!(t=this.$el.find(".toc")).hasClass("blank_toc")&&(a=l(c,this.headings))?0===a.length?void 0:(u=t.fancytree("getRootNode"),s=0,r=null,u.visit((function(e){var t;return(t=a[s])&&t.title&&(r=e,e.setTitle(w(t.title))),s++})),void(r&&(r.setActive(!0),r.scrollIntoView()))):(this._isRefreshing=!0,this._destroyTree(),n=this._ISTOCEXPANDALLED,o=this.getFirstVisibleRowFn(),this._initTree(n,o));this.isDnDContentChange=!1},t.prototype.destroyToc=function(){return this._destroyTree(),this.headings=null,this.idHeadingMaps={},this._ISTOCEXPANDALLED=!1,this.$el.find(".toc").removeClass("toc_expand_all")},t.prototype.destroy=function(){return this.destroyToc(),this.remove()},t.prototype._destroyTree=function(){var e,t;return(t=(e=this.$el).find(".toc")).hasClass("blank_toc")?(e.removeClass("blank_toc_list"),t.removeClass("blank_toc")):(t.fancytree("destroy"),$("#fancytree-drop-marker, .fancytree-drag-helper").remove(),this.unListenToSyncFn(this._throttleSyncToc),this._throttleSyncToc=null)},t.prototype.getLinePosMap=function(){var e;return e=this.getContentFn(),p(e)},t.prototype.getHeadingInfo=function(){var e;return e=this.getContentFn(),r.getHeadingInfo(e)},t.prototype.canHide=function(){return!this._isDragAndDroping||(this._isDragAndDroping=!1,!1)},t.prototype.initToc=function(){var e;return e=this.getFirstVisibleRowFn(!0),this._initTree(!1,e)},t.prototype.showDimmer=function(){return this.$el.dimmer("show")},t.prototype.hideDimmer=function(){return this.$el.dimmer("hide")},t.prototype._initTree=function(e,t){var n,i,r,o,l,c,p,m,v,g;return null==e&&(e=!1),null==t&&(t=0),n=this.$el,this.$el.find(".collapse_all_button").hide(),this.$el.find(".expand_all_button").show(),this.linePosMap=this.getLinePosMap(),l=this.getHeadingInfo(),this.headings=l.headings,this.idHeadingMaps=l.idHeadingMaps,c=0,(g=this.headings.map((function(e){var t,n,i;if(i=[],e.level>c)for(n=e.level-c,t=0;t<n;)t++,i.push("<ul>"),c++;else if(e.level<c)for(n=c-e.level,t=0;t<n;)t++,i.push("</ul>"),c--;return(i=i.concat(['<li class="folder"><a href="javascript:void(0)">',_.escape(w(e.content)),"</a>"])).join("")})).join("")+new Array(c+1).join("</ul>"))?(n.removeClass("blank_toc_list"),r=function(e){var t,n,i;for(t=$("<div></div>").html(e),n=!0,i=0;n;)n=t.find("ul>ul>li:first-child").map((function(e,t){return $(t).unwrap()})).length>0,++i>10&&(n=!1);return t.html()},n.find(".toc").html(r(g)),i=this,o={icons:!1,beforeExpand:function(e,t){var n,r;return r=e.toElement||(null!=(n=e.originalEvent)?n.target:void 0),!(t.node.expanded&&r&&r.className.indexOf("fancytree-title")>=0)&&!i._ISTOCEXPANDALLED},click:function(e,n){var r,o;return!e.ctrlKey&&(o=e.toElement||(null!=(r=e.originalEvent)?r.target:void 0),!$(o).is("li, ul")&&(!!o.classList.contains("fancytree-expander")||(i._isDragAndDroping?(i._isDragAndDroping=!1,!1):!!i._isListeningSyncScroll&&(a&&(clearTimeout(a),a=null),t=d(i.idHeadingMaps,h(n.node)),i.unListenToSyncFn(i._throttleSyncToc),n.node.setActive(!0,{noEvents:!0}),i.gotoLineFn(t,(function(){return a=setTimeout((function(){return i._isListeningSyncScroll||i.listenToSyncFn(i._throttleSyncToc),a=null}),600)}))))))},autoCollapse:!0,clickFolderMode:2,extensions:["glyph"],glyph:{map:{checkbox:"fa fa-square-o",checkboxSelected:"fa fa-check-square-o",checkboxUnknown:"fa fa-square",error:"fa fa-warning",expanderClosed:"fa fa-caret-right",expanderLazy:"fa fa-angle-right",expanderOpen:"fa fa-caret-down",loading:"fa fa-spinner fa-pulse"}}},this.initWide&&(o.extensions.push("wide"),o.wide={iconWidth:"5px",levelOfs:"20px"}),this.initDragAndDrop&&(o.extensions.push("dnd"),o.dnd={autoExpandMS:400,focusOnClick:!0,preventVoidMoves:!0,preventRecursiveMoves:!0,dragStart:function(e,t){return i._isDragAndDroping=!0,!0},dragEnter:function(e,t){return!0},dragDrop:function(e,n){var r,o,a,l,c,p,m,v,g,_,w,y,b;switch(i._isDragAndDroping=!1,m=n.otherNode,t=d(i.idHeadingMaps,h(m)),p=f(i.headings,t),_=i.linePosMap[t],o=i.getContentFn(),a=-1===p?o.length:i.linePosMap[p],c=o.substring(_,a),-1===p&&(c+="\n",_-=1),l=o.substring(0,_),g=o.substring(a),y=d(i.idHeadingMaps,h(e)),w=u(i.idHeadingMaps,h(e)),n.hitMode){case"over":y=f(i.headings,y),c=s(c,w+1);break;case"before":c=s(c,w);break;case"after":y=f(i.headings,y),c=s(c,w)}if(-1===y&&(y=o.split("\n").length-1,(c="\n"+c).endsWith("\n")&&(c=c.substring(0,c.length-1))),v=o,(b=i.linePosMap[y])<_+2?v=l.substring(0,b)+c+l.substring(b)+g:b>a-2&&(r=b-a,v=l+g.substring(0,r)+c+g.substring(r)),o!==v)return i.isDnDContentChange=!0,i.setContentFn(v),m.moveTo(e,n.hitMode),m.setActive(!0),$(m.span).trigger("click")}}),n.find(".toc").fancytree(o),n.find(".toc .ui-helper-hidden").css("display","none"),p=n.find(".toc").fancytree("getRootNode"),m=function(){var e,n;if(n=null,e=p.findFirst((function(e){return!(d(i.idHeadingMaps,h(e))<t)||(n=e,!1)})),n&&(e=n),e)return e.setActive(!0),e.setExpanded(!0)},e?this._tocCollapseAllFn((function(){return i._tocExpandAllFn((function(){return m()}))})):m(),v=function(){return i.syncToc()},this._throttleSyncToc=_.throttle(v,300,{leading:!0}),this.listenToSyncFn(this._throttleSyncToc)):(n.find(".toc").html('<i class="frown icon"></i>\u60a8\u7684\u6587\u6863\u597d\u50cf\u6709\u4e9b\u4e0d\u5408\u7406\uff0c\u65e0\u6cd5\u751f\u6210\u6587\u6863\u5927\u7eb2\u56fe\u54e6'),n.find(".toc").addClass("blank_toc"),void n.addClass("blank_toc_list"))},t.prototype.syncToc=function(e){var t,n,i,r,o,a;if((n=this)._isListeningSyncScroll&&(a=this.$el.find(".toc").fancytree("getRootNode"),e||(e=n.getFirstVisibleRowFn()),r=null,i=a.findFirst((function(t){return!(d(n.idHeadingMaps,h(t))<e)||(r=t,!1)})),r&&(i=r),i))return t=function(){if($(i.li),n._throttleSyncToc)return i.scrollIntoView()},(o=i.setActive(!0))?o.then((function(){return(o=i.setExpanded(!0))?o.then((function(){return t()})):t()})):t()},t.prototype.tocClick=function(e){var t;if(e.preventDefault(),e.stopPropagation(),!e.ctrlKey)return(t=$(e.target).data("line"))?this.gotoLineFn(t):void 0},t}(o),n.exports=i}}),window.requirejs.define({"views/tags_map_window_view":function(e,t,n){var i,r,o,a,s,l,c,u=function(e,t){for(var n in t)d.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e},d={}.hasOwnProperty;a=t("../lib/notifier"),t("../lib/utils"),i=t("../application"),r=t("./base_window_manager_view"),o=t("../constant"),s=t("../lib/pouchdb_index_view_manager"),l=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return u(t,e),t.prototype.local_storage_name="tags_map_window_manager",t}(r),c=function(e){var t,n,r,c,d,p,f,h,m,v;function g(){return g.__super__.constructor.apply(this,arguments)}return u(g,e),g.prototype.className="draggable_dialog_content_container",g.prototype.id=null,g.prototype.usedTags=null,g.prototype.tagMapTitle="",h=null,n=null,m=null,null,t=null,p=null,f=null,null,r=null,v=null,d=function(e,t,n,i){return f.showDimmer("\u7d22\u5f15\u4e2d:"+e+" / "+t)},g.prototype.initialize=function(e){if(this.id=uniqueNumber(),h=null,n={},null,t=null,r=e.fileModel,this.usedTags=e.usedTags,m=e.usedDocIds,this.tagMapTitle="\u6807\u7b7e\u5206\u6790",!e.usedTags&&r&&r.attributes&&r.attributes.tagNames)return this.usedTags=r.attributes.tagNames,this.tagMapTitle+=":"+r.get("title")},g.prototype.events={"click .load_github_demo_btn":"loadGithubDemoFn"},g.prototype.loadGithubDemoFn=function(){if(v)return v.loadGithubDemo()},g.prototype.show=function(){var e,t,n;if(e=!1,(t=i.getUserModel().get("user"))&&t.vip&&(e=!0),"web"===STORY_PLATFORM&&(e=!0),e)return(f=new l).show(),this.render(),f.$el.find(".draggable_dialog_content_container_wrapper").append(this.$el),f.on("resize",(function(){if(v)return v.resize()})),f.on("beforeClose",(n=this,function(){if(n.destroyContextMenu(),v)return v.destroy(),v=null})),f.on("close",function(e){return function(){return e.trigger("close"),e.remove(),f=null}}(this)),this.$el.addClass("xsj-tags-map-window-"+this.id),this.initContextMenu();a.showMessage("\u8be5\u529f\u80fd\u53ea\u5bf9\u4f1a\u5458\u5f00\u653e",6e3,"error")},g.prototype.initContextMenu=function(){var e;return"none",e=".xsj-tags-map-window-"+this.id,$.contextMenu({selector:e,trigger:"none",build:function(e,t){var r,o,s,l;return o=t.originalData,s=o.docId,l={},n[s]&&(r=i.getFileCollection(),l.open={name:"\u5728\u7f16\u8f91\u5668\u4e2d\u6253\u5f00",callback:function(){return r.getModelById(s,(function(e,t){return e?a.showMessage("\u6253\u5f00\u6587\u4ef6\u5931\u8d25:"+e,6e3,"error"):t?$(window).trigger("changeFileModel",[t,{scrollTo:!1}]):a.showMessage("\u6253\u5f00\u6587\u4ef6\u5931\u8d25: \u627e\u4e0d\u5230\u8be5\u6587\u4ef6",6e3,"error")}))}},l.openAsNewPopup={name:"\u5728\u65b0\u6d6e\u52a8\u7f16\u8f91\u5668\u4e2d\u6253\u5f00",callback:function(){return r.getModelById(s,(function(e,t){return e?a.showMessage("\u6253\u5f00\u6587\u4ef6\u5931\u8d25:"+e,6e3,"error"):t?$(window).trigger("createNewEditor",[t]):a.showMessage("\u6253\u5f00\u6587\u4ef6\u5931\u8d25: \u627e\u4e0d\u5230\u8be5\u6587\u4ef6",6e3,"error")}))}}),{items:l}}})},g.prototype.showContextMenu=function(e){var t,n;return n=".xsj-tags-map-window-"+this.id,t=$(n).offset(),$(n).trigger($.Event("contextmenu",{pageX:e.clientX+t.left,pageY:e.clientY+t.top,originalData:e.data}))},g.prototype.destroyContextMenu=function(){var e;return e=".xsj-tags-map-window-"+this.id,$.contextMenu("destroy",e)},g.prototype.clickElement=function(e,r){return!t&&h&&"xsj"===h.type?n[e]?i.getFileCollection().getModelById(e,(function(e,t){return e?a.showMessage("\u6253\u5f00\u6587\u4ef6\u5931\u8d25:"+e,6e3,"error"):t?$(window).trigger("changeFileModel",[t,{openInActiveIf:!0}]):a.showMessage("\u6253\u5f00\u6587\u4ef6\u5931\u8d25: \u627e\u4e0d\u5230\u8be5\u6587\u4ef6",6e3,"error")})):a.showMessage("\u6253\u5f00\u6587\u4ef6\u5931\u8d25: \u627e\u4e0d\u5230\u8be5\u6587\u4ef6",6e3,"error"):(t&&openTarget(e),console.log("click docId",e))},g.prototype.render=function(){var e,n,i,r,l;return r=this,i="","web"===STORY_PLATFORM&&(i='<div class="load_github_demo_data_container transition hidden" style="position: absolute;bottom: 0;left: 0;margin: 2em;">\n  <button class="circular ui icon button massive positive load_github_demo_btn" title="\u52a0\u8f7d Github \u6f14\u793a\u6570\u636e">\n    <i class="icon centercode"></i>\n  </button>\n</div>'),e=$('<div class="draggable_dialog_content iframe_wrapper" style="overflow:hidden;">\n'+i+"\n</div>"),(n=$('<iframe allowfullscreen src="./tagsnetwork/index.html" class="preview_iframe" frameborder="0" style="width: 100%;height:100%;"></iframe>').appendTo(e)).one("load",(l=this,function(){var e;return e=n[0],e.contentDocument,(p=e.contentWindow).requirejs("tags_networks/tags_network")(p,window).initTagsMap(l.tagMapTitle,l.usedTags,{showTagsMap:c,showError:function(e){return a.showMessage("\u52a0\u8f7d\u4fe1\u606f\u51fa\u9519:"+e,6e3,"error")},showDimmer:function(e){return f.showDimmer(e)},hideDimmer:function(){return f.hideDimmer()},showContextMenu:function(e){return r.showContextMenu(e)},clickElement:function(e,t){return r.clickElement(e,t)},afterLoadDemo:function(e,n){return t=e,n},listFilesByTag:function(e){return $(window).trigger("changeFilterInfo",["tag",e])},listFilesByReverse:function(e){return $(window).trigger("changeFilterInfo",["reverse",e])},queryByIds:function(e,t){return o.pouchDB.allDocs({include_docs:!0,keys:e},(function(e,n){var i;return e?(a.showMessage("\u52a0\u8f7d\u51fa\u9519:"+e,6e3,"error"),t(null,[])):(i=[],n.rows.forEach((function(e){if(!e.error)return i.push(e.doc)})),t(null,i))}))},queryByCreateDateRange:function(e,t,n){var i;return i=o.pouchDB,s.queryByCreateDateRange(i,e,t,{include_docs:!0,showUpdateProgressInfo:d},(function(e,t){return f.hideDimmer(),n(e,t)}))},groupByMonths:function(e){var t;return t=o.pouchDB,s.getDateView(t,(function(n,i){var r;return n?a.showMessage("\u52a0\u8f7d\u7d22\u5f15\u51fa\u9519:"+n,6e3,"error"):(r=i.viewName,t.query(r+"/by_create_date",{reduce:!0,group:!0,group_level:2,showUpdateProgressInfo:d}).then((function(t){return f.hideDimmer(),e(null,t.rows)})).catch((function(t){return a.showMessage("\u52a0\u8f7d\u6570\u636e\u51fa\u9519:"+t,6e3,"error"),f.hideDimmer(),e(t)})))}))}},(function(e,t){if(v=t,"web"===STORY_PLATFORM)return setTimeout((function(){return r.$el.find(".load_github_demo_data_container").transition("horizontal flip")}),3e3)}))})),this.$el.html(e),f.showDimmer()},c=function(e,t,i,r){var s;return t=Array.from(new Set(t)),(s=o.pouchDB).query("query_index/by_tagNames",{reduce:!0,group:!0,showUpdateProgressInfo:d}).then((function(o){var l,c,u;return f.hideDimmer(),u=o.rows,(u=_.sortBy(u,"value")).reverse(),l=[],0===t.length&&(t=u.filter((function(e){return!(m&&m.length>0)||!!m.find((function(t){return e.ids.indexOf(t)>=0}))})).map((function(e,t){return e.key}))),u.filter((function(e,n){return t.indexOf(e.key)>=0})).forEach((function(e,t){return l=l.concat(e.ids)})),(c=t.length)>6&&(c=6),l=Array.from(new Set(l)),s.allDocs({include_docs:!0,keys:l}).then((function(o){var a,s;return a={},o.rows.forEach((function(e){var n;if(n=e.doc.tagNames)return n.forEach((function(e){if(t.indexOf(e)<0)return a[e]=1}))})),t=t.concat(Object.keys(a)),s=[["id","name","createDate"].concat(t)],o.rows.forEach((function(e){var i;if(i=e.doc,!(m&&m.length>0&&m.indexOf(i._id)<=0))return n[i._id]={title:i.title,tagNames:i.tagNames},s.push([i._id,i.title,moment(i.createDate).format("YYYYMMDD")].concat(t.map((function(e,t){return i.tagNames&&i.tagNames.length>0&&i.tagNames.indexOf(e)>=0?"1":"0"}))))})),h={name:e,type:"xsj",author:"\u5c0f\u4e66\u5320",description:"",source:"",header:0,nrDefaultSets:c,elementViewers:[{type:"histogram",attribute:{variable:2},parameter:{isFrequency:!0}}],meta:[{type:"id",index:0,hidden:!0,name:"name"},{type:"string",index:1,name:"\u6807\u9898"},{type:"integer",format:"date:%Y%m%d",index:2,name:"\u521b\u5efa\u65f6\u95f4"}],sets:[{format:"binary",start:3,end:3+t.length-1}],data:s},i(h,r)})).catch((function(e){return f.hideDimmer(),a.showMessage("\u52a0\u8f7d\u5217\u8868\u51fa\u9519:"+e,6e3,"error"),r(e)}))})).catch((function(e){return f.hideDimmer(),a.showMessage("\u52a0\u8f7d\u5217\u8868\u51fa\u9519:"+e,6e3,"error"),r(e)}))},g.prototype.remove=function(){return p=null,f=null,null,r=null,v=null,n=null,h=null,t=null,null,g.__super__.remove.apply(this,arguments)},g.prototype.close=function(){return f.remove()},g}(Backbone.View),n.exports=c}}),window.requirejs.define({"views/task_list_window_view":function(e,t,n){var i,r,o,a,s,l=function(e,t){for(var n in t)c.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e},c={}.hasOwnProperty;r=t("../lib/notifier"),s=t("../lib/utils"),t("../application"),i=t("./base_window_manager_view"),t("../constant"),o=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return l(t,e),t.prototype.local_storage_name="task_list_window_manager",t}(i),a=function(e){var n,i,a,c,u,d,p,f,h,m,v;function g(){return g.__super__.constructor.apply(this,arguments)}return l(g,e),g.prototype.className="draggable_dialog_content_container",null,h=null,i=null,d="all",a=null,u={},v={},m=[],f=null,g.prototype.refresh=null,p=function(){var e;return(e=u[a.id])&&e.tasks.length>0?" ("+e.doneCount+"/"+e.tasks.length+")":""},g.prototype.fileModelTitleChanged=function(e,t){return f.$el.find(".task_tree").fancytree("getRootNode").findFirst((function(t){return t.key===e.id})).setTitle(t+p())},c=function(e,t){var n,i,r;if(t){a&&a.off("change:title",f.fileModelTitleChanged),(a=t).on("change:title",f.fileModelTitleChanged),(r=f.$el.find(".task_tree").fancytree("getRootNode")).children.forEach((function(e){return e.extraClasses="",e.renderStatus()})),(i=r.findFirst((function(e){return e.key===a.id})))?(i.extraClasses="fancytree-current",i.renderStatus()):i=r.addNode({key:a.id,title:a.get("title")+p(),extraClasses:"fancytree-current",hideCheckbox:!0,folder:!0,expanded:!0,children:[]}),f.refresh();try{return i.scrollIntoView()}catch(e){return n=e,console.log(n)}}},g.prototype.initialize=function(e){return f=this,a=e.fileModel,i=e.editorView,a.on("change:title",f.fileModelTitleChanged),this.refresh=_.debounce(n,300),$(window).on("fileModelChanged",c),i.on("change",this.refresh)},g.prototype.events={"click .all_button":"allFilterFn","click .only_normal_button":"onlyNormalFilterFn","click .all_task_button":"allTaskFilterFn","click .done_task_button":"doneTaskFilterFn","click .undone_task_button":"undoneTaskFilterFn","click .help_button":"helpFn"},g.prototype.helpFn=function(){return window.openTarget("http://soft.xiaoshujiang.com/docs/tutorial/task_list_window/")},g.prototype.allFilterFn=function(e){var t;if(e){if((t=$(e.currentTarget)).hasClass("active")&&0===m.length)return;m.length=0,t.parent().find("i").removeClass("active"),t.addClass("active")}return d="all",f.$el.find(".task_tree").fancytree("getTree").clearFilter()},g.prototype.allTaskFilterFn=function(e){var t;if(e){if((t=$(e.currentTarget)).hasClass("active")&&0===m.length)return;m.length=0,t.parent().find("i").removeClass("active"),t.addClass("active")}return d="tasks",f.$el.find(".task_tree").fancytree("getTree").filterNodes((function(e){return!!e.folder||(m.indexOf(e.key)>=0||!e.hideCheckbox)}))},g.prototype.doneTaskFilterFn=function(e){var t;if(e){if((t=$(e.currentTarget)).hasClass("active")&&0===m.length)return;m.length=0,t.parent().find("i").removeClass("active"),t.addClass("active")}return d="done",f.$el.find(".task_tree").fancytree("getTree").filterNodes((function(e){return!!e.folder||(m.indexOf(e.key)>=0||!e.hideCheckbox&&e.isSelected())}))},g.prototype.undoneTaskFilterFn=function(e){var t;if(e){if((t=$(e.currentTarget)).hasClass("active")&&0===m.length)return;m.length=0,t.parent().find("i").removeClass("active"),t.addClass("active")}return d="undone",f.$el.find(".task_tree").fancytree("getTree").filterNodes((function(e){return!!e.folder||(m.indexOf(e.key)>=0||!e.hideCheckbox&&!e.isSelected())}))},g.prototype.onlyNormalFilterFn=function(e){var t;if(e){if((t=$(e.currentTarget)).hasClass("active")&&0===m.length)return;m.length=0,t.parent().find("i").removeClass("active"),t.addClass("active")}return d="normal",f.$el.find(".task_tree").fancytree("getTree").filterNodes((function(e){return!!e.folder||(m.indexOf(e.key)>=0||e.hideCheckbox)}))},g.prototype.highlightNodeArea=function(e){var t,n;if(n=this.$el.find(".task_tree").fancytree("getRootNode"),(t=n.findFirst((function(t){return t.key===e.id})))&&t.li)return t.scrollIntoView(),t.li.classList.add("fancytree-highlight-area"),setTimeout((function(){return t.li.classList.remove("fancytree-highlight-area")}),1e3)},g.prototype.fixPosition=function(e){return h.$el.visible(!0)?h.$el.transition("shake"):h.fixPosition(e)},g.prototype.show=function(e){var n;return(h=new o({canMax:!1,canMin:!1,canShape:!1,position:{width:400,left:e.left,top:e.top}})).$el.addClass("draggable_dialog_task"),h.show(),this.render(),h.setTitle("\u5f85\u529e\u6e05\u5355\u7ba1\u7406\u5668"),h.$el.find(".header_logo>i").removeClass().addClass("calendar check outline icon"),h.$el.find(".draggable_dialog_content_container_wrapper").append(this.$el),n=this,t("../lib/dynamic_import/import_fancytree")((function(){return n.initTaskTree(),h.on("beforeClose",(function(){return n.destroyTree()})),h.on("close",(function(){return n.trigger("close"),n.remove(),h=null}))}))},g.prototype.render=function(){var e;return h.showDimmer(),e=$('<div class="draggable_dialog_content" style="overflow:hidden; flex-basis: 0;position:initial;">\n  <div class="task_tree_container theme_tree_container">\n    <div class="task_tree_container_buttons">\n      <div class="task_tree_buttons">\n        <i class="list ul icon only_normal_button link large" title="\u666e\u901a\u5217\u8868\u9879"></i>\n        <i class="list alternate icon all_button link large" title="\u5168\u90e8"></i>\n        <i class="tasks icon all_task_button link active large" title="\u5168\u90e8\u5f85\u529e"></i>\n        <i class="check circle outline icon done_task_button link large" title="\u5df2\u5b8c\u6210\u5f85\u529e"></i>\n        <i class="circle outline icon undone_task_button link large" title="\u672a\u5b8c\u6210\u5f85\u529e"></i>\n        &nbsp;\n        &nbsp;\n        &nbsp;\n        &nbsp;\n        <i class="question circle outline icon help_button link large" title="\u5e2e\u52a9\u6587\u6863"></i>\n      </div>\n    </div>\n    <div class="task_tree"></div>\n  </div>\n</div>'),this.$el.html(e),h.hideDimmer()},g.prototype.initTaskTree=function(){var e,t,n,o,l;return t=i.getValue(),(l=s.getTaskInfo(t)).fileModel=a,u[a.id]=l,e=l.tasks.map((function(e,t){return{key:a.id+"_"+e.id,title:e.content,selected:e.checked,hideCheckbox:e.isNormal,data:{id:e.id}}})),o=function(e,t){var n;if(n=e[t])return n.line},n={autoCollapse:!1,clickFolderMode:2,checkbox:!0,extensions:["wide","filter","glyph","contextMenu"],contextMenu:{menu:function(e){var t,n,i;return n={copyAll:{name:"\u590d\u5236\u5168\u90e8"},saveAll:{name:"\u5168\u90e8\u53e6\u5b58\u4e3a"}},e.isFolder()&&(t=(l=u[e.key]).fileModel,i=_.escape(t.get("title")),n.copy={name:"\u590d\u5236("+i+")"},n.save={name:"\u4fdd\u5b58("+i+")"}),Object.keys(v).length>0&&(n.copySelected={name:"\u590d\u5236\u9009\u4e2d\u7684\u8282\u70b9"},n.saveSelected={name:"\u4fdd\u5b58\u9009\u4e2d\u7684\u8282\u70b9"}),e.isFolder()||(e.hideCheckbox?n.transformToTask={name:"\u8f6c\u4e3a\u5f85\u529e"}:n.transformToNormal={name:"\u8f6c\u4e3a\u666e\u901a\u9879"}),n},actions:function(e,n,s){var c,p,h,g,_,w,y,b,x,k,D,C,F,M,T,S,P;switch(D="",_=function(e){return null==e&&(e=[]),e.filter((function(e){switch(d){case"done":return!e.isNormal&&e.checked;case"undone":return!e.isNormal&&!e.checked;case"tasks":return!e.isNormal;case"normal":return e.isNormal;default:return!0}}))},n){case"transformToNormal":case"transformToTask":h=[],k=e.parent,b=o(u[k.key].idTaskMaps,e.data.id),S=function(t){var n;return e&&e.key&&m.indexOf(e.key)<0&&m.push(e.key),n=(n=h[t]).replace(/^([>\s]*(?:[\-\+\*]|\d+\.))(\s\[[xX\s]\])(\s.*)/,(function(e,t,n,i){return""+t+i})),h[t]=n},P=function(t){var n;return e&&e.key&&m.indexOf(e.key)<0&&m.push(e.key),n=(n=h[t]).replace(/^([>\s]*(?:[\-\+\*]|\d+\.))(\s.*)/,(function(e,t,n){return t+" [ ]"+n})),h[t]=n},T=function(){var e;switch(t=i.getValue(),h=t.split("\n"),n){case"transformToNormal":S(b);break;case"transformToTask":P(b)}if(i.setValue(h.join("\n")),null!==b&&(i.gotoLine(b,4),e=i.editorProxy.editor))return e.highlightPos({line:b,ch:4})},p=function(e){return setTimeout((function(){return T()}),1)},k.key!==a.id?(x=u[k.key].fileModel,$(window).trigger("changeFileModel",[x,{callback:p,scrollTo:!1}])):T()}switch(n){case"copySelected":case"saveSelected":case"copyAll":case"saveAll":for(y in C=[],u)l=u[y],M=(a=l.fileModel).get("title"),w=_(l.tasks),"copySelected"!==n&&"saveSelected"!==n||(w=w.filter((function(e){return!!v[a.id+"_"+e.id]}))),F=w.map((function(e,t){return e.isNormal?"- "+e.content:"- "+(e.checked?"[x]":"[ ]")+" "+e.content})),"copySelected"===n||"saveSelected"===n?C.push(F.join("\n")):(C.push("# "+M),C.push(""),C.push(F.join("\n")),C.push(""),C.push(""));D=C.join("\n");break;case"copy":case"save":F=_((l=u[e.key]).tasks).map((function(e,t){return e.isNormal?"- "+e.content:"- "+(e.checked?"[x]":"[ ]")+" "+e.content})),D=F.join("\n")}switch(D=$.trim(D),n){case"copy":case"copyAll":case"copySelected":$(document).one("copy",(function(e){return e.preventDefault(),e.stopPropagation(),e.originalEvent.clipboardData.setData("text/plain",D),r.showMessage("\u590d\u5236\u5f85\u529e\u6e05\u5355\u6210\u529f")})),document.execCommand("copy");break;case"save":case"saveAll":case"saveSelected":g=moment().format("YYYY-MM-DD")+"_\u5f85\u529e\u6e05\u5355.txt",c=new Blob([D],{type:"text/plain;charset=utf-8"}),saveAs(c,g)}return v={},f.$el.find(".fancytree-user-selected-node").removeClass("fancytree-user-selected-node")}},filter:{mode:"hide"},wide:{iconWidth:"5px",levelOfs:"20px"},glyph:{map:{checkbox:"far fa-square",checkboxSelected:"far fa-check-square",checkboxUnknown:"fa fa-square",error:"fa fa-warning",expanderClosed:"fa fa-caret-right",expanderLazy:"fa fa-angle-right",expanderOpen:"fa fa-caret-down",folder:"far fa-folder",folderOpen:"far fa-folder-open"}},source:[{key:a.id,title:a.get("title")+p(),extraClasses:"fancytree-current",hideCheckbox:!0,folder:!0,expanded:!0,children:e}],click:function(e,n){var r,s,l,c,d,p,h;return d=n.node,e.ctrlKey&&!d.folder&&(s=d.key,v[s]?(delete v[s],d.span.querySelector(".fancytree-title").classList.remove("fancytree-user-selected-node")):(v[s]=!0,d.span.querySelector(".fancytree-title").classList.add("fancytree-user-selected-node"))),!e.ctrlKey&&(v={},f.$el.find(".fancytree-user-selected-node").removeClass("fancytree-user-selected-node"),l=null,h=function(){var n,r,o,a;if(d&&d.key&&m.indexOf(d.key)<0&&m.push(d.key),(a=e.toElement||e.originalEvent.target)&&a.classList.contains("fancytree-checkbox")&&(o=(o=(r=(t=i.getValue()).split("\n"))[l]).replace(/^([>\s]*(?:[\-\+\*]|\d+\.)\s\[)([xX\s])(\]\s.*)/,(function(e,t,n,i){return t+(/x/i.test(n)?" ":"x")+i})),r[l]=o,i.setValue(r.join("\n"))),null!==l&&(i.gotoLine(l,4),n=i.editorProxy.editor))return n.highlightPos({line:l,ch:4})},r=function(e){return setTimeout((function(){return h()}),1)},d.folder?(s=d.key)!==a.id?(c=u[s].fileModel,$(window).trigger("changeFileModel",[c,{callback:r}])):void 0:(p=d.parent,l=o(u[p.key].idTaskMaps,d.data.id),p.key!==a.id?(c=u[p.key].fileModel,$(window).trigger("changeFileModel",[c,{callback:r,scrollTo:!1}])):h()))}},this.$el.find(".task_tree").fancytree(n),this.$el.find(".task_tree >ul.fancytree-container").css("height","100%"),this.allTaskFilterFn()},n=function(e){var t,n,r,o,l,c,h,m,g;for(e&&(e.preventDefault(),e.stopPropagation()),v={},f.$el.find(".fancytree-user-selected-node").removeClass("fancytree-user-selected-node"),t=i.getValue(),(g=s.getTaskInfo(t)).fileModel=a,h=u[a.id],m=f.$el.find(".task_tree").fancytree("getRootNode"),(o=m.findFirst((function(e){return e.key===a.id})))||(o=m.addNode({key:a.id,title:a.get("title")+p(),extraClasses:"fancytree-current",hideCheckbox:!0,folder:!0,expanded:!0,children:[]})),o.setExpanded(!0),l=0,c=null,h&&h.tasks.forEach((function(e){var t,n;return t=g.tasks[l],(n=o.findFirst((function(t){return t.key===a.id+"_"+e.id})))&&(t?(t.isNormal!==e.isNormal&&(c=n,n.hideCheckbox=t.isNormal,n.setTitle(t.content)),t.content!==e.content&&(c=n,n.setTitle(t.content)),t.checked!==e.checked&&(c=n,n.setSelected(t.checked))):n.remove()),l++}));l<g.tasks.length;)n=g.tasks[l],c=o.addNode({key:a.id+"_"+n.id,title:n.content,hideCheckbox:n.isNormal,selected:n.checked,data:{id:n.id}}),l++;switch(d){case"done":f.doneTaskFilterFn();break;case"undone":f.undoneTaskFilterFn();break;case"normal":f.onlyNormalFilterFn();break;case"tasks":f.allTaskFilterFn()}if(c){c.setActive(!0);try{c.scrollIntoView()}catch(e){r=e,console.log(r)}}return u[a.id]=g,o.setTitle(a.get("title")+p())},g.prototype.destroyTree=function(){return this.$el.find(".task_tree").fancytree("destroy")},g.prototype.remove=function(){return a.off("change:title",f.fileModelTitleChanged),$(window).off("fileModelChanged",c),i.off("change",this.refresh),null,h=null,i=null,a=null,d="all",a=null,u={},f=null,g.__super__.remove.apply(this,arguments)},g.prototype.close=function(){return h.remove()},g}(Backbone.View),n.exports=a}}),window.requirejs.define({"views/templates/about":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){var o,a=null!=t?t:e.nullContext||{},s=n.helperMissing,l="function",c=e.escapeExpression;return'<i class="close icon"></i>\n<div class="header" >\n'+c(typeof(o=null!=(o=n.headerStr||(null!=t?t.headerStr:t))?o:s)===l?o.call(a,{name:"headerStr",hash:{},data:r}):o)+'\n</div>\n<div class="content image">\n<div class="ui small image">\n<img src="img/avatar_d_256x256.png">\n</div>\n<div class="description">\n<div class="ui header" >\u611f\u8c22\u60a8\u4f7f\u7528\u5c0f\u4e66\u5320\u4e2a\u4eba\u77e5\u8bc6\u7ba1\u7406\u7cfb\u7edf</div>\n<p><span >\u5f53\u524d\u7248\u672c:</span> '+c(typeof(o=null!=(o=n.appVersion||(null!=t?t.appVersion:t))?o:s)===l?o.call(a,{name:"appVersion",hash:{},data:r}):o)+'\n<a href="javascript:void(0);" class="pwa_upgrade_button ui basic button positive mini" style="display:none">\u66f4\u65b0</a>\n</p>\n<p class="display_client display_client_block">\n<span >\u670d\u52a1\u5668\u6700\u65b0\u7248\u672c:</span>\n<span class="new_version"><i class="icon loading spinner"></i></span>\n<span>\n<a href="javascript:void(0);" class="client_upgrade_new_version_button ui basic button positive mini" style="display:none">\u5347\u7ea7</a>\n<a href="javascript:void(0);" class="cache_upgrade_new_version_button ui basic button positive mini" style="display:none" >\u5347\u7ea7</a>\n<a href="http://soft.xiaoshujiang.com" class="manual_upgrade_new_version_button ui basic button positive mini" target="_blank" style="display:none">\u524d\u5f80\u5c0f\u4e66\u5320\u4e3b\u9875\u4e0b\u8f7d\u5ba2\u6237\u7aef:<span class="client_version"></span></a>\n</span>\n</p>\n<p >\n\u5c0f\u4e66\u5320\u662f\u4e00\u6b3e\u672c\u5730\u4f18\u5148\uff0c\u53bb\u4e2d\u5fc3\u5316\uff0c\u5206\u5e03\u5f0f\uff0c\u652f\u6301\u9009\u62e9\u6027\u540c\u6b65\u7684\u5168\u5e73\u53f0\u8986\u76d6\u7b14\u8bb0\u77e5\u8bc6\u7ba1\u7406\u8f6f\u4ef6\u3002\n</p>\n<p><a href="https://github.com/suziwen/markdownxiaoshujiang/issues" target="_blank"\n>bug,\u5efa\u8bae</a></p>\n</div>\n</div>\n<div class="content about_tab_content">\n<div class="ui top attached tabular menu">\n<a class="item active" data-tab="client">\u5ba2\u6237\u7aef</a>\n<a class="item" data-tab="info">\u4fe1\u606f</a>\n<a class="item" data-tab="debug">\u8c03\u8bd5</a>\n<a class="item" data-tab="license">license</a>\n</div>\n<div class="ui bottom attached tab segment active" data-tab="client">\n<div>\n<p class="display_client_block">\n\u6570\u636e\u6587\u4ef6\u8def\u5f84: '+c(typeof(o=null!=(o=n.dataPath||(null!=t?t.dataPath:t))?o:s)===l?o.call(a,{name:"dataPath",hash:{},data:r}):o)+" <button class=\"ui icon button mini open_folder_btn\"><i class='folder open outline icon'></i></button><br>\n\u9519\u8bef\u65e5\u5fd7\u6587\u4ef6: "+c(typeof(o=null!=(o=n.execptionFilePath||(null!=t?t.execptionFilePath:t))?o:s)===l?o.call(a,{name:"execptionFilePath",hash:{},data:r}):o)+" <br>\n\u542f\u52a8\u6267\u884c\u8def\u5f84: "+c(typeof(o=null!=(o=n.execPath||(null!=t?t.execPath:t))?o:s)===l?o.call(a,{name:"execPath",hash:{},data:r}):o)+'\n</p>\n</div>\n<div class="display_client_block">\n<div class="ui floated left compact segment">\n<div class="ui fitted toggle checkbox xsj_non_security_checkbox">\n<input type="checkbox" class="xsj_non_security_checkbox_input" '+c(typeof(o=null!=(o=n.nonSecurity||(null!=t?t.nonSecurity:t))?o:s)===l?o.call(a,{name:"nonSecurity",hash:{},data:r}):o)+'>\n<label></label>\n</div>\n</div>\n\u6253\u5f00\u975e\u5b89\u5168\u6a21\u5f0f\uff08\u6bcf\u6b21\u91cd\u542f\u540e\uff0c\u5c06\u81ea\u52a8\u5173\u95ed\u8be5\u9009\u9879\u3002\u975e\u5b89\u5168\u6a21\u5f0f\u5c06\u81ea\u52a8\u6267\u884c\u6587\u7ae0\u5185\u7684 codechunk\n\u4ee3\u7801\u6bb5\uff0c\u5b58\u5728\u6076\u610f\u4ee3\u7801\u88ab\u6267\u884c\u7684\u98ce\u9669\uff0c\u8bf7\u5728\u660e\u786e\u6587\u7ae0\u5185\u5bb9\u5b89\u5168\u540e\u518d\u6253\u5f00\u8be5\u6a21\u5f0f\uff09\n</div>\n</div>\n<div class="ui bottom attached tab segment" data-tab="info">\n<pre><code></code></pre>\n</div>\n<div class="ui bottom attached tab segment" data-tab="debug">\n<div>\n<div class="ui buttons">\n<div class="ui button reset_panel_btn">\u91cd\u7f6e\u7a97\u53e3</div>\n</div>\n</div>\n</div>\n<div class="ui bottom attached tab segment" data-tab="license">\n\n</div>\n</div>\n<div class="actions">\n<div class="ui positive right button basic" >\n\u5173\u95ed\n</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/ace_editor":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<div id="id_content_editor" class="ace_editor" >\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/ace_editor_minimap":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<div class="background"></div>\n<pre>\n<code class="code"></code>\n</pre>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/add_filter_dialog":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<i class="close icon"></i>\n<div class="header">\u6dfb\u52a0\u8fc7\u6ee4\u5668</div>\n<div class="content story_content">\n<form class="ui form">\n<div class="inline field">\n<label for="icon">\u56fe\u6807</label>\n<div class="ui dropdown inline filter_icon_dropdown">\n<i class="icon dropdown"></i>\n<span class="text">\n<i class="fas fa-star fa-fw fa-2x"></i>\n</span>\n<div class="menu">\n<div class="ui search icon input">\n<i class="search icon"></i>\n<input type="text" name="search" placeholder="\u67e5\u627e\u56fe\u6807...">\n</div>\n<div class="scrolling menu xsj_patch_menu">\n</div>\n</div>\n</div>\n</div>\n<div class="field">\n<label for="name">\u663e\u793a\u540d\u79f0</label>\n<div class="ui fluid input">\n<input type="text" name="name" placeholder="">\n<input type="hidden" name="id">\n</div>\n</div>\n<div class="inline field">\n<label for="showInHeader">\u662f\u5426\u7f6e\u9876</label>\n<input type="checkbox" name="showInHeader">\n</div>\n<div class="inline fields">\n<label for="filterType">\u8fc7\u6ee4\u7c7b\u578b</label>\n<div class="field">\n<div class="ui radio">\n<input type="radio" name="filterType" value="tag" checked>\n<label>\u6807\u7b7e</label>\n</div>\n</div>\n<div class="field">\n<div class="ui radio">\n<input type="radio" name="filterType" value="category">\n<label>\u5206\u7c7b</label>\n</div>\n</div>\n<div class="field">\n<div class="ui radio">\n<input type="radio" name="filterType" value="flag">\n<label>\u6807\u8bc6</label>\n</div>\n</div>\n<div class="field">\n<div class="ui radio">\n<input type="radio" name="filterType" value="system">\n<label>\u7cfb\u7edf</label>\n</div>\n</div>\n<div class="field">\n<div class="ui radio">\n<input type="radio" name="filterType" value="search">\n<label>\u641c\u7d22</label>\n</div>\n</div>\n</div>\n<div class="field">\n<label for="filterValue">\u8fc7\u6ee4\u503c</label>\n<div class="ui fluid input">\n<input type="text" name="filterValue" placeholder="">\n</div>\n</div>\n<div class="ui message search_message_tip" style="display:none;">\n\u8be6\u7ec6\u7684\u641c\u7d22\u8bed\u6cd5\u53ef\u4ee5\u67e5\u770b<a href="http://soft.xiaoshujiang.com/docs/tutorial/search_grammar" target="_blank"> <i class="question circle icon"></i> \u8fd9\u91cc</a>\n</div>\n<div class="ui error message"></div>\n</form>\n</div>\n<div class="actions">\n<div class="tips">\n<div class="ui basic mini button help_button">\u5e2e\u52a9</div>\n</div>\n<div class="ui cancel button" >\n\u53d6\u6d88\n</div>\n<div class="ui positive button">\n<span>\u4fdd\u5b58</span>\n</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/auth_dialog":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<div class="ui stardand modal">\n<i class="close icon"></i>\n<div class="header">\n\u7ed1\u5b9a\u8ba4\u8bc1\u8fc7\u7a0b\uff0c\u8bf7\u4e0d\u8981\u5173\u95ed\u8be5\u7a97\u53e3\n</div>\n<div class="content" style="min-width: 400px;min-height:400px">\n</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/base_window_manager":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<div class="ui top attached label draggable_dialog_header">\n<span class="header_logo"><i></i></span>\n<span class="header_title"></span>\n<span class="header_button_container">\n<i class="icon header_close_button header_button close" title="\u5173\u95ed"></i>\n<i class="icon max_or_normal_button header_button header_window_button window maximize outline" title="\u6700\u5927\u5316"></i>\n<i class="icon min_or_normal_button header_button header_window_button window minimize" title="\u6700\u5c0f\u5316"></i>\n<i class="icon shade_or_normal_button header_button header_window_button angle double up" title="\u6536\u8d77"></i>\n<i class="icon pinned_button header_button header_window_button thumbtack counterclockwise rotated"\ntitle="\u4fdd\u6301\u5728\u6700\u524d\u7aef"></i>\n</span>\n</div>\n<div class="draggable_dialog_content_container_wrapper">\n<div class="ui dimmer"></div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/bind_keyboards_manager":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<i class="close icon"></i>\n<div class="header">\n\u5feb\u6377\u952e\u7ba1\u7406\n</div>\n<div class="content story_content">\n<div class="ui form">\n<div class="bind_keyboard_container" style="display:none">\n<div class="inline field  ">\n<label for="displayName">\u663e\u793a\u540d\u79f0(\u4ec5\u7528\u4e8e\u533a\u5206\u4e0d\u540c\u7684\u6309\u952e\u4fe1\u606f,\u65b9\u4fbf\u7528\u6237\u8bc6\u522b)</label>\n<div class="ui fluid input">\n<input type="text" name="displayName" placeholder="\u663e\u793a\u540d\u79f0"/>\n<input type="hidden" name="id"/>\n</div>\n</div>\n<div class="inline field  ">\n<label for="command">\u547d\u4ee4</label>\n<div class="ui dropdown command_dropdown">\n<div class="text">\u9009\u62e9\u4e00\u4e2a\u547d\u4ee4</div>\n<i class="dropdown icon"></i>\n<div class="menu">\n<div class="ui icon search input">\n<i class="search icon"></i>\n<input type="text" placeholder="\u67e5\u627e\u547d\u4ee4...">\n</div>\n<div class="divider"></div>\n<div class="scrolling menu command_menus_container">\n</div>\n</div>\n</div>\n<div class="ui fluid input">\n<input type="text" name="command" placeholder="\u547d\u4ee4"/>\n</div>\n</div>\n<div class="inline field  ">\n<label for="commandArgs">\u547d\u4ee4\u53c2\u6570(\u5982\u679c\u4f7f\u7528\u7684\u547d\u4ee4\u9700\u8981\u989d\u5916\u8bbe\u7f6e\u53c2\u6570\uff0c\u9700\u8981\u5728\u8fd9\u91cc\u914d\u7f6e)</label>\n<div class="ui fluid input">\n<input type="text" name="commandArgs" placeholder="\u591a\u4e2a\u53c2\u6570\u7528\u7a7a\u683c\u5206\u5f00"/>\n</div>\n</div>\n<div class="inline fields">\n<label for="range" >\u6309\u952e\u76d1\u542c\u8303\u56f4</label>\n<div class="field">\n<div class="ui radio checkbox">\n<input type="radio" name="range" value="all">\n<label >\u5168\u90e8</label>\n</div>\n</div>\n<div class="field">\n<div class="ui radio checkbox">\n<input type="radio" name="range" value="editor">\n<label >\u4ec5\u7f16\u8f91\u533a</label>\n</div>\n</div>\n<div class="field">\n<div class="ui radio checkbox">\n<input type="radio" name="range" value="app">\n<label >\u4ec5\u64cd\u4f5c\u533a</label>\n</div>\n</div>\n</div>\n<div class="ui segment">\n<div class="ui blue right ribbon label">\u6309\u952e\u5b9a\u4e49</div>\n<div class="ui message info shortcuts_container_wrapper" style="display: none;">\n<ol class="ui relaxed list shortcuts_container"></ol>\n</div>\n<div class="inline field  ">\n<div class="ui input shortcut_input_container fluid">\n<input class="mousetrap shortcut_input" type="text" name="shortcut" placeholder="\u70b9\u51fb\u8fd9\u91cc\u5f00\u59cb\u5b9a\u4e49\u6309\u952e"/>\n</div>\n</div>\n<div class="ui button mini basic add_shortcut_button">\u6dfb\u52a0</div>\n</div>\n</div>\n<div class="bind_keyboards_container" style="display:none;margin-top: 1rem;">\n<table class="ui table">\n<thead>\n<tr>\n<th class="one wide">#</th>\n<th>\u6807\u9898</th>\n<th class="five wide center aligned">\u64cd\u4f5c</th>\n</tr>\n</thead>\n<tbody class="bind_keyboards_container_body"></tbody>\n</table>\n</div>\n<div class="blank_container" style="display:none;margin-top: 1rem;">\n\u60a8\u8fd8\u6ca1\u6709\u521b\u5efa\u4efb\u4f55\u6309\u952e\n</div>\n</div>\n</div>\n\n<div class="actions">\n<div class="tips">\n<div class="ui basic mini button help_button">\u5e2e\u52a9</div>\n</div>\n<div class="ui mini blue button save_button init_hide_button"><i class="save icon"></i>\u4fdd\u5b58</div>\n<div class="ui mini blue button new_button init_hide_button"><i class="plus icon"></i>\u65b0\u5efa</div>\n<div class="ui mini blue button cancel_button init_hide_button"><i class="minus icon"></i>\u53d6\u6d88</div>\n<div class="ui basic mini cancel button" >\n\u5173\u95ed\n</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/bind_system_keyboards_manager":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<i class="close icon"></i>\n<div class="header">\n\u64cd\u4f5c\u7cfb\u7edf\u5feb\u6377\u952e\u7ba1\u7406\n</div>\n<div class="content story_content">\n<div class="ui form">\n<div class="bind_system_keyboard_container" style="margin-top: 1rem;">\n<div class="field  ">\n<label for="bindInfo">\u5b9a\u4e49\u6309\u952e</label>\n<textarea name="bindInfo"></textarea>\n</div>\n</div>\n</div>\n</div>\n\n<div class="actions">\n<div class="tips">\n</div>\n<div class="ui mini blue button save_button"><i class="save icon"></i>\u4fdd\u5b58</div>\n<div class="ui basic mini cancel button" >\n\u5173\u95ed\n</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/cache_upgrade_dialog":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){var o;return'<div class="header" >\n\u5347\u7ea7\u5c0f\u4e66\u5320\n</div>\n<div class="content image">\n<div class="ui small image">\n<img src="https://markdown.xiaoshujiang.com/img/avatar_d_256x256.png">\n</div>\n<div class="description">\n<div class="ui header" >\u611f\u8c22\u4f7f\u7528\u5c0f\u4e66\u5320</div>\n<p><span >\u5f53\u524d\u7248\u672c:</span> '+e.escapeExpression("function"==typeof(o=null!=(o=n.appVersion||(null!=t?t.appVersion:t))?o:n.helperMissing)?o.call(null!=t?t:e.nullContext||{},{name:"appVersion",hash:{},data:r}):o)+'</p>\n<p><span >\u6700\u65b0\u7248\u672c:</span> <span class="new_version"><i class="icon loading spinner"></i></span></p>\n<p class="description_detail"><i class="icon loading spinner"></i>\u6b63\u5728\u52aa\u529b\u8ba1\u7b97\u9700\u8981\u66f4\u65b0\u7684\u6587\u4ef6...</p>\n<div class="ui progress" style="display:none;">\n<div class="bar">\n<div class="progress"></div>\n</div>\n<div class="label">\u66f4\u65b0\u4e2d...</div>\n</div>\n</div>\n</div>\n<div class="actions">\n<div class="ui cancel right button" >\n\u5173\u95ed\n</div>\n<div class="ui positive right button install_new_version_button disabled">\n\u5f00\u59cb\u66f4\u65b0\n</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/change_store_plugin_dialog":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<i class="close icon"></i>\n<div class="header" >\n\u7ed1\u5b9a\u7b2c\u4e09\u65b9\u6570\u636e\u64cd\u4f5c\u754c\u9762\n</div>\n<div class="content story_content">\n<div class="ui raised segment">\n<div class="ui blue ribbon label">\u6570\u636e\u5b58\u50a8</div>\n<div class="store_container">\n</div>\n<table class="ui celled selectable table store_table order_list_table">\n<thead>\n<tr>\n<th>\u540d\u79f0</th>\n<th class="three wide center aligned">\u64cd\u4f5c</th>\n</tr>\n</thead>\n<tbody class="store_table_tbody">\n</tbody>\n</table>\n</div>\n<div class="ui raised segment">\n<div class="ui blue ribbon label">\u56fe\u5e8a\u670d\u52a1</div>\n<div class="resource_container">\n</div>\n<table class="ui celled selectable table resource_table order_list_table">\n<tbody class="resource_table_tbody">\n<tr class="system_resource resource_item positive default_resource"><td><i class="large icon xiaoshujiang"></i>\u5c0f\u4e66\u5320\u7f16\u8f91\u5668\u5b58\u50a8</td><td class="three wide center aligned"><i class="large check icon resource_check_button outline"></i></td></tr>\n</tbody>\n</table>\n</div>\n</div>\n<div class="actions">\n<div class="tips">\n<div >\u6ce8\uff1a</div>\n<div >1.\u53ea\u6709\u5148\u7ed1\u5b9a\u5bf9\u5e94\u7684\u7b2c\u4e09\u65b9\u5e94\u7528\u540e\uff0c\u624d\u80fd\u5207\u6362\u9009\u62e9\u3002<br> 2.\u5207\u6362\u540e\uff0c\u8bf7\u70b9\u51fb\u786e\u5b9a</div>\n<div class="ui basic mini button help_button">\u5e2e\u52a9</div>\n</div>\n<div class="ui basic cancel button" >\n\u53d6\u6d88\n</div>\n<div class="ui basic positive button disabled" >\n\u786e\u5b9a\n</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/client_public_email_dialog":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<i class="close icon"></i>\n<div class="header" >\u53d1\u9001\u90ae\u4ef6</div>\n<div class="content story_content">\n<form class="ui form">\n<div class="inline field">\n<label for="useMailServerConfig" >\u81ea\u5b9a\u4e49\u90ae\u4ef6\u670d\u52a1\u5668</label>\n<input type="checkbox" name="useMailServerConfig">\n</div>\n<div class="fields mail_server_config">\n<div class="ten wide field">\n<label for="host" >\u670d\u52a1\u5668</label>\n<input name="host" type="text" placeholder="\u670d\u52a1\u5668smtp.xxx.com" />\n</div>\n<div class="three wide field">\n<label for="port" >\u7aef\u53e3</label>\n<input name="port" type="text" placeholder="\u7aef\u53e3" value="25"  />\n</div>\n<div class="three wide field">\n<label for="tls">&nbsp;</label>\n<div class="ui checkbox">\n<input type="checkbox" name="tls" />\n<label for="tls" >\n\u662f\u5426tls\n</label>\n</div>\n</div>\n</div>\n<div class="fields mail_server_config">\n<div class="eight wide field">\n<label for="user" >\u7528\u6237\u540d</label>\n<input type="text" name="user"  />\n</div>\n<div class="eight wide field">\n<label for="password" >\u5bc6\u7801</label>\n<input type="password" name="password"/>\n</div>\n</div>\n<div class="field mail_server_config">\n<label for="from" >\u53d1\u4ef6\u4eba\u5730\u5740</label>\n<div class="ui fluid icon input">\n<input type="text" name="from" placeholder="\u53d1\u4ef6\u4eba\u90ae\u4ef6\u5730\u5740" >\n<i class="mail outline icon"></i>\n</div>\n</div>\n<div class="field">\n<div style="float:right">\n<input type="checkbox" name="separateTo"/> \u5206\u5f00\u53d1\u9001\n</div>\n<label for="to" >\u6536\u4ef6\u4eba\u5730\u5740</label>\n<div class="ui fluid icon input">\n<input type="text" name="to" placeholder="\u63a5\u6536\u4eba\u90ae\u4ef6\u5730\u5740, \u591a\u4e2a\u90ae\u4ef6\u7528\u9017\u53f7\u5206\u5f00" >\n<i class="mail outline icon"></i>\n</div>\n</div>\n<div class="field cc_mail_container">\n<label for="cc" >\u6284\u9001</label>\n<div class="ui fluid icon input">\n<input type="text" name="cc" placeholder="\u6284\u9001\u4eba\u90ae\u4ef6\u5730\u5740,\u591a\u4e2a\u90ae\u4ef6\u5730\u5740\u7528\u9017\u53f7\u5206\u5f00" >\n<i class="mail outline icon"></i>\n</div>\n</div>\n<div class="field bcc_mail_container">\n<label for="bcc" >\u79d8\u5bc6\u6284\u9001</label>\n<div class="ui fluid icon input">\n<input type="text" name="bcc" placeholder="\u79d8\u5bc6\u6284\u9001\u4eba\u90ae\u4ef6\u5730\u5740, \u591a\u4e2a\u90ae\u4ef6\u7528\u9017\u53f7\u5206\u5f00" >\n<i class="mail outline icon"></i>\n</div>\n</div>\n<div class="inline field">\n<label for="subject" >\u90ae\u4ef6\u6807\u9898</label>\n<input type="text" name="subject">\n</div>\n<div class="inline fields">\n<label for="mainBody" >\u6b63\u6587\u5185\u5bb9</label>\n<div class="field">\n<div class="ui radio">\n<input type="radio" name="mainBody" value="user">\n<label >\u7528\u6237\u81ea\u5b9a\u4e49</label>\n</div>\n</div>\n<div class="field">\n<div class="ui radio">\n<input type="radio" name="mainBody" value="preview" checked>\n<label >\u6e32\u67d3\u540e\u7684\u6587\u7ae0</label>\n</div>\n</div>\n<div class="field">\n<div class="ui radio">\n<input type="radio" name="mainBody" value="markdown">\n<label >markdown\u6587\u7ae0</label>\n</div>\n</div>\n<div class="field">\n<div class="ui radio">\n<input type="radio" name="mainBody" value="png">\n<label >\u6e32\u67d3\u540e\u7684\u56fe\u7247</label>\n</div>\n</div>\n</div>\n<div class="ui fluid field user_main_body_container hide">\n<label for="userMainBody" >\u6b63\u6587\u5185\u5bb9</label>\n<textarea name="userMainBody"></textarea>\n</div>\n<div class="inline field">\n<label for="numberedHeading" >\u662f\u5426\u5f3a\u5236\u5185\u5bb9\u6807\u9898\u81ea\u52a8\u7f16\u53f7(\u4ec5\u5728\u90ae\u4ef6\u6b63\u6587\u9009\u62e9`\u6e32\u67d3\u540e\u7684\u6587\u7ae0`\u6709\u6548)</label>\n<input type="checkbox" name="numberedHeading">\n</div>\n<div class="inline field">\n<label for="attachmentMarkdown" >\u6dfb\u52a0markdown\u6587\u7ae0\u4f5c\u4e3a\u9644\u4ef6</label>\n<input type="checkbox" name="attachmentMarkdown">\n</div>\n<div class="inline field">\n<label for="attachmentPreview" >\u6dfb\u52a0\u6e32\u67d3\u540e\u7684\u6587\u7ae0\u4f5c\u4e3a\u9644\u4ef6</label>\n<input type="checkbox" name="attachmentPreview">\n</div>\n<div class="inline field">\n<label for="attachmentPng" >\u6dfb\u52a0\u6e32\u67d3\u540e\u7684\u56fe\u7247\u4f5c\u4e3a\u9644\u4ef6</label>\n<input type="checkbox" name="attachmentPng">\n</div>\n<div class="ui error message"></div>\n</form>\n<div class="ui  segment">\n<div class="more_attachments"></div>\n<div style="display: none;"><input type="file" multiple="" name="fileData" class="form-control"></div>\n<p class="drop-zone" >\u8ffd\u52a0\u66f4\u591a\u9644\u4ef6</p>\n</div>\n</div>\n<div class="actions">\n<div class="ui cancel button" >\n\u53d6\u6d88\n</div>\n<div class="ui positive button">\n<span >\u53d1\u9001</span>\n</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/client_public_file_dialog":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<i class="close icon"></i>\n<div class="header">\u53d1\u5e03\u6587\u4ef6</div>\n<div class="content story_content">\n<form class="ui form">\n<div class="fields">\n<div class="ten wide field">\n<label for="host">\u535a\u5ba2\u5730\u5740</label>\n<input name="host" type="text" placeholder="\u535a\u5ba2\u4e3b\u9875\u5730\u5740\u6216\u8005xmlrpc\u5730\u5740"/>\n</div>\n</div>\n<div class="fields">\n<div class="eight wide field">\n<label for="user">\u7528\u6237\u540d</label>\n<input type="text" name="user"  />\n</div>\n<div class="eight wide field">\n<label for="password">\u5bc6\u7801</label>\n<input type="password" name="password"/>\n</div>\n</div>\n<div class="inline field">\n<label for="markdown">markdown \u539f\u6587</label>\n<input type="checkbox" name="markdown"/>\n</div>\n<div class="inline field">\n<label for="publish">\u662f\u5426\u53d1\u5e03</label>\n<input type="checkbox" name="publish" checked />\n</div>\n<div class="inline field">\n<label for="inlineStylesheet">\u5185\u8054\u6837\u5f0f\u5230 html \u7247\u6bb5</label>\n<input type="checkbox" name="inlineStylesheet" checked />\n</div>\n<div class="inline field">\n<label for="convertSvg">\u5c06 svg \u8f6c\u6362\u6210\u56fe\u7247</label>\n<input type="checkbox" name="convertSvg" checked />\n</div>\n<div class="ui fluid field">\n<label for="userMeta">\u81ea\u5b9a\u4e49 yaml \u6570\u636e(\u5982\u679c\u8be5 yaml \u5b9a\u4e49\u7684\u5143\u6570\u636e\u4e0e\u6587\u7ae0\u7684\u5143\u6570\u636e\u76f8\u540c\uff0c\u6587\u7ae0\u7684\u5143\u6570\u636e\u5c06\u4f1a\u88ab\u8986\u76d6)</label>\n<textarea name="userMeta"></textarea>\n</div>\n<div class="selected_files_container">\n<div class="ui button select_files_button">\u9009\u62e9\u6587\u4ef6</div>\n<div class="ui middle aligned divided ordered list selected_files_list">\n</div>\n</div>\n<div class="ui error message"></div>\n</form>\n</div>\n<div class="actions">\n<div class="ui cancel button">\n\u5173\u95ed\n</div>\n<div class="ui positive button">\n\u53d1\u9001\n</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/client_title_control_buttons":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<div class="client_main_toolbar ui menu"></div>\n<span class="client_title_info hidden-xs">\u5c0f\u4e66\u5320</span>\n<div class="client_title_control_buttons ui icon buttons mini">\n<div class="ui icon button client_title_main_button client_title_button basic" title="\u5c0f\u4e66\u5320">\n<i class="xiaoshujiang icon"></i>\n</div>\n\n<div class="dropdown ui icon button client_title_more_button client_title_button basic">\n<i class="ellipsis horizontal icon" title="\u66f4\u591a...">\n</i>\n<div class="menu">\n<div class="item client_title_lock_button">\n<i class="lock icon"></i>\n\u9501\u5c4f\n</div>\n<div class="item client_title_enter_fullscreen_button client_title_button">\n<i class="icon expand"></i>\n\u8fdb\u5165\u5168\u5c4f\n</div>\n<div class="item client_title_leave_fullscreen_button client_title_button">\n<i class="icon compress"></i>\n\u9000\u51fa\u5168\u5c4f\n</div>\n<div class="item">\n\u7f29\u653e:\n<div class="ui icon buttons mini client_title_zoom_buttons">\n<div class="ui button mini icon client_zoom_btn" data-type="minus" title="\u7f29\u5c0f"><i class="minus icon"></i></div>\n<div class="ui button mini icon client_zoom_btn" data-type="reset" title="\u91cd\u7f6e"><i class="dot circle outline icon"></i></div>\n<div class="ui button mini icon client_zoom_btn" data-type="plus" title="\u653e\u5927"><i class="plus icon"></i></div>\n</div>\n<span class="client_title_zoom_level">0</span>\n</div>\n</div>\n</div>\n\n<div class="ui icon button client_title_min_button client_title_button basic">\n<i class="icon minus"></i>\n</div>\n<div class="ui icon button client_title_max_button client_title_button basic" title="\u6700\u5927\u5316">\n<i class="icon plus"></i>\n</div>\n<div class="ui icon button client_title_leave_fullscreen_button client_title_button basic" title="\u9000\u51fa\u5168\u5c4f">\n<i class="icon compress"></i>\n</div>\n<div class="ui icon button client_title_close_button client_title_button basic">\n<i class="icon remove"></i>\n</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/client_upgrade_dialog":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){var o,a=null!=t?t:e.nullContext||{},s=n.helperMissing,l=e.escapeExpression;return'<i class="close icon"></i>\n<div class="header" >\n\u5347\u7ea7\u5c0f\u4e66\u5320\n</div>\n<div class="content image">\n<div class="ui small image">\n<img src="http://markdown.xiaoshujiang.com/img/avatar_d_256x256.png">\n</div>\n<div class="description">\n<div class="ui header" >\u611f\u8c22\u60a8\u4f7f\u7528\u5c0f\u4e66\u5320</div>\n<p><span >\u5f53\u524d\u7248\u672c:</span> '+l("function"==typeof(o=null!=(o=n.appVersion||(null!=t?t.appVersion:t))?o:s)?o.call(a,{name:"appVersion",hash:{},data:r}):o)+"</p>\n<p><span >\u6700\u65b0\u7248\u672c:</span> "+l("function"==typeof(o=null!=(o=n.appVersion||(null!=t?t.appVersion:t))?o:s)?o.call(a,{name:"appVersion",hash:{},data:r}):o)+'</p>\n<p class="description"></p>\n<div class="ui progress">\n<div class="bar">\n<div class="progress"></div>\n</div>\n<div class="label">\u66f4\u65b0\u4e2d...</div>\n</div>\n</div>\n</div>\n<div class="actions">\n<div class="ui positive right button" >\n\u5173\u95ed\n</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/close_confirm":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<i class="close icon"></i>\n<div class="header">\n\u9000\u51fa\n</div>\n<div class="content">\n\u76f4\u63a5\u9000\u51fa\uff0c\u8fd8\u662f\u6700\u5c0f\u5316\u5230\u7cfb\u7edf\u6258\u76d8?\n</div>\n<div class="actions">\n<div class="ui checkbox save_close_behavior">\n<input type="checkbox" name="saveCloseBehavior">\n<label>\u603b\u662f\u9009\u62e9\u8be5\u64cd\u4f5c</label>\n</div>\n<div class="ui basic button exit_button">\n\u5173\u95ed\n</div>\n<div class="ui basic button tray_button">\n\u6700\u5c0f\u5316\u5230\u7cfb\u7edf\u6258\u76d8\n</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/cloud_sync":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<div class="ui icon button xsj_sync_button">\n<i class="icons cloud_icons xsj_cloud_icons">\n<i class="cloud icon"></i>\n<i class="bottom right corner xiaoshujiang icon"></i>\n</i>\n</div>\n<div class="ui icon top left dropdown button custom_sync_button">\n<i class="icons cloud_icons custom_cloud_icons">\n<i class="cloud icon"></i>\n<i class="bottom right corner user icon"></i>\n</i>\n<div class="menu">\n<div class="item tabs_sync_button">\n<i class="icons" style="margin-right: .78571429rem;">\n<i class="newspaper icon"></i>\n<i class="bottom right corner refresh icon"></i>\n</i>\u6253\u5f00\u7684\u6240\u6709\u6587\u7ae0\u53cc\u5411\u540c\u6b65\n</div>\n<div class="item full_sync_button">\n<i class="icons" style="margin-right: .78571429rem;">\n<i class="database icon"></i>\n<i class="bottom right corner refresh icon"></i>\n</i>\u5168\u5e93\u53cc\u5411\u540c\u6b65\n</div>\n<div class="item cloud_search_button">\n<i class="icons" style="margin-right: .78571429rem;">\n<i class="database icon"></i>\n<i class="bottom right corner search icon"></i>\n</i>\u670d\u52a1\u5668\u6570\u636e\u5e93\u641c\u7d22\n</div>\n<div class="divider"></div>\n<div class="item">\n<i class="dropdown icon"></i>\n\u63a8\u9001\n<div class="menu">\n<div class="item full_push_button">\n<i class="cloud upload icon"></i>\u5168\u90e8\u63a8\u9001\n</div>\n<div class="item ten_push_button">\n<i class="cloud upload icon"></i>\u63a8\u9001\u6700\u8fd1\u4fee\u6539\u768410\u7bc7\u6587\u7ae0\n</div>\n<div class="item fifty_push_button">\n<i class="cloud upload icon"></i>\u63a8\u9001\u6700\u8fd1\u4fee\u6539\u768450\u7bc7\u6587\u7ae0\n</div>\n</div>\n</div>\n<div class="item">\n<i class="dropdown icon"></i>\n\u62c9\u53d6\n<div class="menu">\n<div class="item full_pull_button">\n<i class="cloud download icon"></i>\u5168\u90e8\u62c9\u53d6\n</div>\n<div class="item ten_pull_button">\n<i class="cloud download icon"></i>\u62c9\u53d6\u6700\u8fd1\u4fee\u6539\u768410\u7bc7\u6587\u7ae0\n</div>\n<div class="item fifty_pull_button">\n<i class="cloud download icon"></i>\u62c9\u53d6\u6700\u8fd1\u4fee\u6539\u768450\u7bc7\u6587\u7ae0\n</div>\n</div>\n</div>\n</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/codemirror_editor":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<textarea id="codemirror_editor" name="codemirror_editor" rows="10" cols="30" style="width:100%;height:100%;"></textarea>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/database":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<i class="close icon"></i>\n<div class="seven item tabular ui menu attached story_header">\n<a class="active item" data-tab="local" >\n\u57fa\u672c\n</a>\n<a class="item" data-tab="index" >\n\u7d22\u5f15\n</a>\n<a class="item sync_item" data-tab="sync" >\n\u540c\u6b65\n</a>\n<a class="item service_item" data-tab="service" style="display:none;">\n\u670d\u52a1\n</a>\n</div>\n<div class="content story_content">\n<div class="ui active tab database_local_tab" data-tab="local">\n</div>\n<div class="ui tab database_index_tab" data-tab="index">\n</div>\n<div class="ui tab segment database_sync_tab" data-tab="sync">\n</div>\n<div class="ui tab segment database_service_tab" data-tab="service" style="height:100%;">\n</div>\n</div>\n<div class="actions">\n<div class="tips">\n<div class="ui basic mini button help_button">\u5e2e\u52a9</div>\n</div>\n<div class="ui cancel button basic">\n\u5173\u95ed\n</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/database_index":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){var o;return'<div class="ui transition hidden dimmer">\n<div class="ui text loader">\u52a0\u8f7d\u4e2d</div>\n</div>\n<table class="ui table">\n<thead>\n<tr>\n<th>#</th>\n<th>\u540d\u79f0</th>\n<th>\u8fdb\u5ea6</th>\n<th>\u64cd\u4f5c</th>\n<th><div class="ui icon button mini basic reset_auto_index" title="\u6062\u590d\u5230\u7cfb\u7edf\u9ed8\u8ba4\u9009\u62e9"><i class="icon globe"></i></div>\u81ea\u52a8\u7d22\u5f15</th>\n</tr>\n</thead>\n<tbody class="database_index_tbody_container">\n<tr data-id="fullsearch_index" class="fullsearch_index_container">\n<td></td>\n<td>\u5168\u6587\u641c\u7d22\u7d22\u5f15</td>\n<td class="seq_info">0 / 0 </td>\n<td class="operater_buttons">\n<div class="ui basic mini button fullsearch_build_button" data-type="build">\u7d22\u5f15</div>\n<div class="ui basic mini button fullsearch_build_button" data-type="rebuild">\u91cd\u65b0\u7d22\u5f15</div>\n<div class="ui basic mini button fullsearch_build_button" data-type="destroy_rebuild">\u5220\u9664\u540e\u91cd\u65b0\u7d22\u5f15</div>\n</td>\n<td>\n<input type="checkbox" class="auto_index" '+e.escapeExpression("function"==typeof(o=null!=(o=n.autoFullSearchIndex||(null!=t?t.autoFullSearchIndex:t))?o:n.helperMissing)?o.call(null!=t?t:e.nullContext||{},{name:"autoFullSearchIndex",hash:{},data:r}):o)+"/>\n</td>\n</tr>\n\n</tbody>\n</table>\n"},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/database_local":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){var o;return'<div class="ui raised segment info_database">\n<a href="javascript:void(0);" class="ui ribbon label" >\u4fe1\u606f</a>\n<div style="margin-top:1rem;">\n\u5360\u7528\u7a7a\u95f4: <span class="database_size_container"></span>\n</div>\n<div class="display_client_block">\n\u6570\u636e\u6587\u4ef6\u8def\u5f84: '+e.escapeExpression("function"==typeof(o=null!=(o=n.dataPath||(null!=t?t.dataPath:t))?o:n.helperMissing)?o.call(null!=t?t:e.nullContext||{},{name:"dataPath",hash:{},data:r}):o)+' <button class="ui icon button mini open_folder_btn"><i class=\'folder open outline icon\'></i></button><br>\n</div>\n<div class="display_client_block">\n<a href="https://soft.xiaoshujiang.com/blog/story-writer/how-change-database-location" target="_blank">\u5982\u4f55\u4fee\u6539\u5c0f\u4e66\u5320\u5ba2\u6237\u7aef\u6570\u636e\u5e93\u5b58\u50a8\u4f4d\u7f6e</a>\n</div>\n</div>\n\n<div class="ui raised segment articles_database">\n<a href="javascript:void(0);" class="ui ribbon label" >\u6587\u7ae0\u6570\u636e\u5e93</a>\n<div class="ui buttons large" style="margin:0 0 1rem;">\n<input type="file" id="load_file" style="display:none"/>\n<div class="ui button compact_button" data-value="database">\n\u538b\u7f29\u6570\u636e\u5e93\n</div>\n<div class="ui button load_button">\n\u5bfc\u5165\u6570\u636e\u5e93\n</div>\n<div class="ui button dump_button">\n\u5bfc\u51fa\u6570\u636e\u5e93\n</div>\n</div>\n\n<div class="ui large button">\n\u67e5\u770b\u6570\u636e\u5e93\u6587\u4ef6\n</div>\n\n<div class="ui buttons large">\n<div class="ui button destroy_button negative">\n\u91cd\u7f6e\u6570\u636e\u5e93\n</div>\n</div>\n<div class="ui segment">\n<div class="ui top right attached label">\u5bfc\u51fa\u6587\u7ae0\u8303\u56f4</div>\n\n<div class="ui form">\n<div class="inline fields">\n<label style="line-height:3;">\u9009\u62e9\u65b9\u5f0f</label>\n<div class="field">\n<div class="ui radio checkbox">\n<input type="radio" name="rangeType" value="all">\n<label>\u5168\u90e8</label>\n</div>\n</div>\n<div class="field">\n<div class="ui radio checkbox">\n<input type="radio" name="rangeType" value="calendar" checked>\n<label>\u521b\u5efa\u65f6\u95f4</label>\n</div>\n</div>\n<div class="field custom_select_container" style="display: none;">\n<div class="ui radio checkbox">\n<input type="radio" name="rangeType" value="picker">\n<label>\u81ea\u5b9a\u4e49\u9009\u62e9</label>\n</div>\n</div>\n<div class="ui left pointing label select_result_container hidden">\n</div>\n</div>\n</div>\n\n\n<div class="calendar_select_container">\n</div>\n<div class="picker_select_container" style="display: none;">\n<div class="ui positive button picker_select_button">\n\u9009\u62e9\u6587\u4ef6\n</div>\n</div>\n</div>\n\n<p>\u6587\u7ae0\u6570\u636e\u5e93\u4e3b\u8981\u5b58\u653e\u7528\u6237\u7684\u6587\u7ae0\u6570\u636e\uff0c\u5305\u62ec\u7528\u6237\u7684\u9644\u4ef6\u56fe\u7247\u8d44\u6e90\u3002</p>\n<p>\u6587\u7ae0\u6570\u636e\u5e93\u63d0\u4f9b\u4e86\u5386\u53f2\u7248\u672c\u529f\u80fd\uff0c\u901a\u8fc7<strong>\u538b\u7f29\u6570\u636e\u5e93</strong>\u6309\u94ae\uff0c\u53ef\u4ee5\u5c06\u6240\u6709\u6587\u7ae0\u7684\u5386\u53f2\u8bb0\u5f55\u6e05\u7a7a\u3002</p>\n\n</div>\n</div>\n<div class="ui raised segment config_database">\n<a href="javascript:void(0);" class="ui ribbon label" >\u914d\u7f6e\u6587\u4ef6\u6570\u636e\u5e93</a>\n<div class="ui buttons large" style="margin: 0 0 1rem;">\n<div class="ui button load_button" data-value="config">\n\u5bfc\u5165\u6570\u636e\u5e93\n</div>\n<div class="ui button dump_button" data-value="config">\n\u5bfc\u51fa\u6570\u636e\u5e93\n</div>\n</div>\n\n<div class="ui buttons large">\n<div class="ui button destroy_config_button negative">\n\u91cd\u7f6e\u6570\u636e\u5e93\n</div>\n</div>\n<p>\u914d\u7f6e\u6587\u4ef6\u6570\u636e\u5e93\u4e3b\u8981\u5b58\u653e\u7528\u6237\u7684\u914d\u7f6e\u4fe1\u606f\uff0c\u6bd4\u5982\u4e3b\u9898\uff0c\u7f16\u8f91\u5668\u8bbe\u7f6e\uff0c\u6a21\u677f\uff0c\u7247\u6bb5,\u7b2c\u4e09\u65b9\u5b58\u50a8\u7ed1\u5b9a\u4fe1\u606f\u7b49</p>\n</div>\n<div class="ui raised segment resource_database">\n<a href="javascript:void(0);" class="ui ribbon label" >\u8d44\u6e90\u4e2d\u5fc3\u6570\u636e\u5e93</a>\n<div style="margin: 1rem 0;" class="ui negative button large destroy_app_button">\n</i>\u91cd\u7f6e\u6570\u636e\u5e93\n</div>\n<p>\u8d44\u6e90\u4e2d\u5fc3\u6570\u636e\u5e93\u4e3b\u8981\u5b58\u653e\u4e00\u4e9b\u4e0a\u4f20\u7684\u8d44\u6e90\u6587\u4ef6\uff0c\u6bd4\u5982\u9644\u4ef6\uff0c\u56fe\u7247\u7684\uff0c\u8fd9\u4e9b\u56fe\u7247\u5e76\u4e0d\u662f\u6587\u7ae0\u91cc\u7684\u56fe\u7247\uff0c\u4e00\u822c\u53ea\u505a\u4e3a\u4e0d\u540c\u6587\u7ae0\u4e4b\u95f4\u7684\u62f7\u8d1d\u663e\u793a\u4f7f\u7528\uff0c\u5982\u679c\u6570\u636e\u7a7a\u95f4\u5360\u7528\u592a\u591a\uff0c\u968f\u65f6\u90fd\u53ef\u4ee5\u91cd\u7f6e\u5220\u9664\u6389\u8be5\u6570\u636e\u5e93</p>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/database_service":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<div class="ui header">\u5c0f\u4e66\u5320\u73cd\u73d1\u7f51\u683c\u670d\u52a1\u5668</div>\n<div class="content story_content miniweb_server_instance">\n<div class="ui buttons miniweb_server_control_btns">\n</div>\n<div class="ui divider"></div>\n<details class="miniweb_server_instance_config">\n<summary><i class="cogs icon"></i>\u914d\u7f6e</summary>\n<form class="ui form">\n<div class="field">\n<label for="webPort">\n\u7aef\u53e3\u53f7\uff08\u4e3a0\u65f6\uff0c\u7cfb\u7edf\u81ea\u52a8\u5206\u914d\uff09\n</label>\n<input type="number" min="0" max="65535" name="webPort" placeholder="\u7aef\u53e3\u53f7\uff0c\u9ed8\u8ba4\u4e3a0,\u7cfb\u7edf\u81ea\u52a8\u5206\u914d">\n</div>\n<div class="field">\n<label for="password">\u8bbf\u95ee\u5bc6\u7801</label>\n<input type="password" name="password">\n</div>\n</form>\n</details>\n<div class="ui message miniweb_server_info">\n\u60a8\u8fd8\u672a\u542f\u52a8\u670d\u52a1\n</div>\n<div class="ui message info">\n\u5c0f\u4e66\u5320\u5df2\u7ecf\u63a8\u51fa\u4e86<a href="https://hub.docker.com/r/suziwen/pegasus">\u5929\u9a6c\u7248</a>(Docker\u7248\u672c),\u60a8\u4e5f\u53ef\u4ee5\u901a\u8fc7\u670d\u52a1\u5668\u81ea\u5df1\u5b89\u88c5\u3002\n</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/database_sync":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){var o,a=null!=t?t:e.nullContext||{},s=n.helperMissing,l="function",c=e.escapeExpression;return'<div class="ui right ribbon label">\u540c\u6b65\u914d\u7f6e</div>\n<div class="ui form">\n<div class="inline fields">\n<label >\u670d\u52a1\u5668</label>\n<div class="field">\n<div class="ui radio checkbox">\n<input type="radio" name="syncType" value="local">\n<label  >\u4ec5\u672c\u5730\u6570\u636e\u5e93</label>\n</div>\n</div>\n<div class="field">\n<div class="ui radio checkbox">\n<input type="radio" name="syncType" value="xsj">\n<label >\u5c0f\u4e66\u5320</label>\n</div>\n</div>\n<div class="field">\n<div class="ui radio checkbox">\n<input type="radio" name="syncType" value="custom">\n<label >\u81ea\u5b9a\u4e49</label>\n</div>\n</div>\n</div>\n<div class="ui primary button apply_sync_button">\u5e94\u7528</div>\n</div>\n<div class="ui segment custom_segment">\n<div class="ui right ribbon label">\u81ea\u5b9a\u4e49\u540c\u6b65\u914d\u7f6e\u53c2\u6570</div>\n<form class="ui form custom_form">\n<div class="fields">\n<div class="sixteen wide field">\n<label for="customUrl" >\u6570\u636e\u5e93\u5730\u5740</label>\n<input type="text" name="customUrl" value="'+c(typeof(o=null!=(o=n.customUrl||(null!=t?t.customUrl:t))?o:s)===l?o.call(a,{name:"customUrl",hash:{},data:r}):o)+'">\n</div>\n</div>\n<div class="ui segment">\n<div class="ui right corner label"><i class="user icon"></i></div>\n<div class="fields">\n<div class="eight wide field">\n<label for="customUsername" >\u5e10\u53f7</label>\n<input type="text" name="customUsername" value="'+c(typeof(o=null!=(o=n.customUsername||(null!=t?t.customUsername:t))?o:s)===l?o.call(a,{name:"customUsername",hash:{},data:r}):o)+'">\n</div>\n<div class="eight wide field">\n<label for="customPassword" >\u5bc6\u7801</label>\n<input type="password" name="customPassword" value="'+c(typeof(o=null!=(o=n.customPassword||(null!=t?t.customPassword:t))?o:s)===l?o.call(a,{name:"customPassword",hash:{},data:r}):o)+'">\n</div>\n</div>\n<div class="inline fields" style="margin-bottom: 0">\n<div class="field">\n<div class="ui checkbox">\n<input type="checkbox" name="customWithCredentials" '+c(typeof(o=null!=(o=n.customWithCredentials||(null!=t?t.customWithCredentials:t))?o:s)===l?o.call(a,{name:"customWithCredentials",hash:{},data:r}):o)+'>\n<label for="customWithCredentials" >withCredentials</label>\n</div>\n</div>\n</div>\n</div>\n\n<details>\n<summary>\u66f4\u591a</summary>\n\n<div class="ui info icon message">\n<i class="icon info circle"></i>\n<div class="content">\n<div class="header">\u4f7f\u7528\u7684\u6570\u636e\u5e93\u5fc5\u987b\u652f\u6301 Couch Replication Protocol \u534f\u8bae,\u6253\u5f00\u8de8\u57df\u8bbf\u95ee\u7684\u652f\u6301,\u540c\u65f6\u521d\u59cb\u5316\u76f8\u5173\u7684\u89c6\u56fe</div>\n</div>\n</div>\n<div class="inline fields">\n<div class="field">\n<label for="customLiveMax" >\u6bcf\u6b21\u542f\u52a8\u540c\u6b65\u6700\u5927\u6587\u7ae0\u6570</label>\n<input type="text" name="customLiveMax" value="'+c(typeof(o=null!=(o=n.customLiveMax||(null!=t?t.customLiveMax:t))?o:s)===l?o.call(a,{name:"customLiveMax",hash:{},data:r}):o)+'">\n<div class="ui left pointing basic label">\u6bcf\u6b21\u542f\u52a8\u6216\u8005\u70b9\u51fb\u540c\u6b65\u6309\u94ae\u65f6\uff0c\u53cc\u5411\u540c\u6b65\u6700\u5927\u6587\u7ae0\u6570\uff0c\u6570\u503c\u53ea\u80fd\u5728 10\uff5e50 \u4e4b\u95f4</div>\n</div>\n</div>\n<div class="ui segment">\n<div class="ui right corner label"><i class="refresh icon"></i></div>\n<div class="inline fields" style="margin-bottom: 0">\n<div class="field">\n<div class="ui checkbox">\n<input type="checkbox" name="customLive" '+c(typeof(o=null!=(o=n.customLive||(null!=t?t.customLive:t))?o:s)===l?o.call(a,{name:"customLive",hash:{},data:r}):o)+'>\n<label for="customLive" >\u662f\u5426\u5b9e\u65f6\u540c\u6b65</label>\n</div>\n</div>\n<div class="field client_only">\n<div class="ui checkbox">\n<input type="checkbox" name="customLiveFull" '+c(typeof(o=null!=(o=n.customLiveFull||(null!=t?t.customLiveFull:t))?o:s)===l?o.call(a,{name:"customLiveFull",hash:{},data:r}):o)+'>\n<label for="customLiveFull" >\u662f\u5426\u5168\u5e93\u540c\u6b65</label>\n</div>\n</div>\n</div>\n</div>\n<div class="ui segment">\n<div class="ui right corner label"><i class="plug icon"></i></div>\n<div class="field">\n<label >\u521d\u59cb\u5316\u89c6\u56fe</label>\n<textarea readonly style="box-sizing: border-box;">'+c(typeof(o=null!=(o=n.initDDoc||(null!=t?t.initDDoc:t))?o:s)===l?o.call(a,{name:"initDDoc",hash:{},data:r}):o)+'</textarea>\n</div>\n<div class="ui button test_custom_button" style="float:right">\u6d4b\u8bd5</div>\n<div class="ui pointing basic label" style="line-height: 1.5;">\n\u4f7f\u7528\u81ea\u5b9a\u4e49\u6570\u636e\u4e2d\u5fc3\u65f6\uff0c\u5fc5\u987b\u4fdd\u8bc1\u63d0\u4f9b\u76f8\u5e94\u7684\u521d\u59cb\u5316\u89c6\u56fe\uff0c<br/>\n\u60a8\u53ef\u4ee5\u70b9\u51fb"\u6d4b\u8bd5" \u6309\u94ae\uff0c\u68c0\u6d4b\u670d\u52a1\u5668\u521b\u5efa\u7684\u89c6\u56fe\u662f\u5426\u7b26\u5408\u5c0f\u4e66\u5320\u9700\u8981\u7684\u89c6\u56fe\u3002<br/>\n\u5982\u679c\u4e0d\u7b26\u5408\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e0a\u9762\u7684\u6587\u672c\u8986\u76d6\u670d\u52a1\u5668\u4e0a\u5bf9\u5e94\u7684\u89c6\u56fe\u3002<br/>\n\u5982\u679c\u4f60\u4f7f\u7528\u7684\u5e10\u53f7\u5177\u6709\u4fee\u6539\u89c6\u56fe\u7684\u6743\u9650\uff0c\u5c0f\u4e66\u5320\u7cfb\u7edf\u4f1a\u5c1d\u8bd5\u521b\u5efa\u76f8\u5173\u7684\u89c6\u56fe\u3002\n</div>\n</div>\n<div class="ui button apply_full_sync_button client_only">\u5168\u5e93\u540c\u6b65</div>\n</details>\n<div class="ui error message"></div>\n</form>\n</div>\n<div class="ui segment xsj_segment">\n<div class="ui info icon message">\n<i class="icon info circle"></i>\n<div class="content">\n<ul class="list">\n<li>\u5c0f\u4e66\u5320\u6570\u636e\u4e2d\u5fc3\u4ec5\u505a\u4e3a\u4e34\u65f6\u4e2d\u8f6c\u7ad9\uff0c\u65b9\u4fbf\u7528\u6237\u5728\u4e0d\u540c\u5e73\u53f0,\u4e0d\u540c\u529e\u516c\u5730\u4e4b\u95f4\u5feb\u901f\u7f16\u8f91\u6700\u8fd1\u51e0\u7bc7\u6587\u7ae0\u3002</li>\n<li class="unlimited_life_mode_trigger_container">\u5c0f\u4e66\u5320\u4f1a\u4e0d\u5b9a\u65f6\u6e05\u7a7a\u670d\u52a1\u5668\u6570\u636e\uff0c\u8bf7\u4e0d\u8981\u628a\u5c0f\u4e66\u5320\u6570\u636e\u670d\u52a1\u5668\u505a\u4e3a\u81ea\u5df1\u7684\u5b58\u50a8\u65b9\u6848,\u5efa\u8bae\u628a\u5b8c\u7a3f\u7684\u6587\u7ae0\u4fdd\u5b58\u5230\u7b2c\u4e09\u65b9\u5b58\u50a8\u5e73\u53f0\u4e0a</li>\n<li>\u5c0f\u4e66\u5320\u6570\u636e\u670d\u52a1\u5668\u5b9a\u65f6\u6e05\u7a7a\u6570\u636e\u4e0d\u4f1a\u64cd\u4f5c\u7528\u6237\u672c\u5730\u5ba2\u6237\u7aef(\u6216\u6d4f\u89c8\u5668)\u7684\u6570\u636e</li>\n<li>\u5c0f\u4e66\u5320\u53ea\u4f1a\u5728\u542f\u52a8\u65f6\u53cc\u5411\u540c\u6b65\u6700\u8fd1\u4fee\u6539\u768410\u7bc7\u6587\u7ae0(\u5305\u62ec\u5f52\u6863\uff0c\u7528\u6237\u81ea\u5df1\u7684\u5220\u9664\u64cd\u4f5c)\uff0c\u5e76\u5b9e\u65f6\u540c\u6b65\u542f\u52a8\u540e\u7528\u6237\u4fee\u6539\u7684\u6587\u7ae0</li>\n<li>\u5c0f\u4e66\u5320\u4e0d\u4f1a\u540c\u6b65\u7cfb\u7edf\u521b\u5efa\u7684\u624b\u518c\u6587\u7ae0\uff0c\u8bf7\u4e0d\u8981\u5728\u8fd9\u4e9b\u6587\u7ae0\u57fa\u7840\u4e0a\u8fdb\u884c\u4fee\u6539</li>\n</ul>\n</div>\n</div>\n</div>\n<div class="ui massive message negative not_vip_message_tip">\n\u8be5\u529f\u80fd\u4ec5\u9650\u4ed8\u8d39\u7528\u6237\u4f7f\u7528\n<br/>\n\u60a8\u53ef\u4ee5\u81ea\u5df1\u642d\u5efa<a href="https://hub.docker.com/repository/docker/suziwen/pegasus" target="_blank">\u5c0f\u4e66\u5320\u5929\u9a6c\u7248(suziwen/pegasus)</a>\uff0c\u514d\u8d39\u4f7f\u7528\u6570\u636e\u540c\u6b65\u529f\u80fd\u3002\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/dropdown_tag_name":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<input type="hidden" name="filters" class="tag_name_value">\n<i class="filter icon" style="vertical-align: -webkit-baseline-middle;"></i>\n<span class="text"></span>\n<span class="tag_recommends"></span>\n<div class="menu">\n<div class="ui icon search input">\n<i class="search icon"></i>\n<input type="text" placeholder="Search tags...">\n</div>\n<div class="divider"></div>\n<div class="header">\n<i class="tags icon"></i>\nTag Label\n</div>\n<div class="scrolling menu menu_items">\n</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/editor":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return"\n"},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/editor_buttons":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<div class="ui icon reverse gooey_effect buttons editor_buttons_wrapper animation_icon_tips mini">\n<div class="ui icon button zen_button">\n<span class="icon_tip">\u5f00\u542f\u5199\u4f5c\u6a21\u5f0f</span>\n<i class="icon expand" title="\u5f00\u542f\u5199\u4f5c\u6a21\u5f0f" >\n</i>\n</div>\n<div class="ui icon button history_button">\n<span class="icon_tip">\u5386\u53f2\u8bb0\u5f55</span>\n<i class="icon history history_button_icons" title="\u5386\u53f2\u8bb0\u5f55" >\n</i>\n</div>\n<div class="editor_config_button_placeholder">\n</div>\n<div class="icon dropdown ui icon button editor_type_button">\n<span class="icon_tip">\u5207\u6362\u7f16\u8f91\u5668</span>\n<i class="icon cube" title="\u7f16\u8f91\u5668" >\n</i>\n<div class="menu">\n</div>\n</div>\n<div class="toc_button_placeholder"></div>\n<div class="ui icon button task_list_button">\n<span class="icon_tip">\u5f85\u529e\u6e05\u5355</span>\n<i class="calendar check outline icon task_list_button_icons" title="\u5f85\u529e\u6e05\u5355">\n</i>\n</div>\n<div class="ui icon button mark_list_button">\n<span class="icon_tip">\u9ad8\u4eae\u6e05\u5355</span>\n<i class="lightbulb icon mark_list_button_icons" title="\u9ad8\u4eae\u6e05\u5355">\n</i>\n</div>\n<div class="ui icon button link_relation_button">\n<span class="icon_tip">\u5f15\u7528\u5173\u7cfb\u5217\u8868</span>\n<i class="fas fa-bezier-curve icon link_relation_button_icons" title="\u5f15\u7528\u5173\u7cfb\u5217\u8868">\n</i>\n</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/editor_buttons_codemirror":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){var o,a=null!=t?t:e.nullContext||{},s=n.helperMissing,l="function",c=e.escapeExpression;return'<div class="inline field">\n<details style="background: var(--lighterBackground); padding: 1em 1em 0;">\n<summary style="margin: 0 0 1em;">\n\u7acb\u65f6\u9884\u89c8\n<div class="ui checkbox" style="margin-left: 1em;">\n<input type="checkbox" name="cm_autopreview" '+c(typeof(o=null!=(o=n.cm_autopreview||(null!=t?t.cm_autopreview:t))?o:s)===l?o.call(a,{name:"cm_autopreview",hash:{},data:r}):o)+'>\n<label for="cm_autopreview" >(\u6240\u89c1\u5373\u6240\u5f97)</label>\n</div>\n</summary>\n<div class="inline field">\n<div class="ui checkbox">\n<input type="checkbox" name="cm_autopreview_inline" '+c(typeof(o=null!=(o=n.cm_autopreview_inline||(null!=t?t.cm_autopreview_inline:t))?o:s)===l?o.call(a,{name:"cm_autopreview_inline",hash:{},data:r}):o)+'>\n<label for="cm_autopreview_inline" >\u884c\u5185\u6837\u5f0f(\u7c97\u4f53,\u659c\u4f53,\u9ad8\u4eae\u7b49)</label>\n</div>\n</div>\n<div class="inline field">\n<div class="ui checkbox">\n<input type="checkbox" name="cm_autopreview_link" '+c(typeof(o=null!=(o=n.cm_autopreview_link||(null!=t?t.cm_autopreview_link:t))?o:s)===l?o.call(a,{name:"cm_autopreview_link",hash:{},data:r}):o)+'>\n<label for="cm_autopreview_link" >\u8d85\u94fe\u63a5</label>\n</div>\n</div>\n<div class="inline field">\n<div class="ui checkbox">\n<input type="checkbox" name="cm_autopreview_image" '+c(typeof(o=null!=(o=n.cm_autopreview_image||(null!=t?t.cm_autopreview_image:t))?o:s)===l?o.call(a,{name:"cm_autopreview_image",hash:{},data:r}):o)+'>\n<label for="cm_autopreview_image" >\u56fe\u7247</label>\n</div>\n</div>\n<div class="inline field">\n<div class="ui checkbox">\n<input type="checkbox" name="cm_autopreview_header" '+c(typeof(o=null!=(o=n.cm_autopreview_header||(null!=t?t.cm_autopreview_header:t))?o:s)===l?o.call(a,{name:"cm_autopreview_header",hash:{},data:r}):o)+'>\n<label for="cm_autopreview_header" >\u6807\u9898</label>\n</div>\n</div>\n<div class="inline field">\n<div class="ui checkbox">\n<input type="checkbox" name="cm_autopreview_toc" '+c(typeof(o=null!=(o=n.cm_autopreview_toc||(null!=t?t.cm_autopreview_toc:t))?o:s)===l?o.call(a,{name:"cm_autopreview_toc",hash:{},data:r}):o)+'>\n<label for="cm_autopreview_toc" >TOC(\u76ee\u5f55)</label>\n</div>\n</div>\n<div class="inline field">\n<div class="ui checkbox">\n<input type="checkbox" name="cm_autopreview_footnote" '+c(typeof(o=null!=(o=n.cm_autopreview_footnote||(null!=t?t.cm_autopreview_footnote:t))?o:s)===l?o.call(a,{name:"cm_autopreview_footnote",hash:{},data:r}):o)+'>\n<label for="cm_autopreview_footnote" >\u811a\u6ce8</label>\n</div>\n</div>\n<div class="inline field">\n<div class="ui checkbox">\n<input type="checkbox" name="cm_autopreview_hr" '+c(typeof(o=null!=(o=n.cm_autopreview_hr||(null!=t?t.cm_autopreview_hr:t))?o:s)===l?o.call(a,{name:"cm_autopreview_hr",hash:{},data:r}):o)+'>\n<label for="cm_autopreview_hr" >\u6c34\u5e73\u7ebf</label>\n</div>\n</div>\n<div class="inline field">\n<div class="ui checkbox">\n<input type="checkbox" name="cm_autopreview_table" '+c(typeof(o=null!=(o=n.cm_autopreview_table||(null!=t?t.cm_autopreview_table:t))?o:s)===l?o.call(a,{name:"cm_autopreview_table",hash:{},data:r}):o)+'>\n<label for="cm_autopreview_table" >\u8868\u683c</label>\n</div>\n</div>\n<div class="inline field">\n<div class="ui checkbox">\n<input type="checkbox" name="cm_autopreview_yaml" '+c(typeof(o=null!=(o=n.cm_autopreview_yaml||(null!=t?t.cm_autopreview_yaml:t))?o:s)===l?o.call(a,{name:"cm_autopreview_yaml",hash:{},data:r}):o)+'>\n<label for="cm_autopreview_yaml" >\u5143\u6570\u636e</label>\n</div>\n</div>\n<div class="inline field">\n<div class="ui checkbox">\n<input type="checkbox" name="cm_autopreview_mathjax" '+c(typeof(o=null!=(o=n.cm_autopreview_mathjax||(null!=t?t.cm_autopreview_mathjax:t))?o:s)===l?o.call(a,{name:"cm_autopreview_mathjax",hash:{},data:r}):o)+'>\n<label for="cm_autopreview_mathjax" >\u516c\u5f0f</label>\n</div>\n</div>\n<div class="inline field">\n<div class="ui checkbox">\n<input type="checkbox" name="cm_autopreview_todo" '+c(typeof(o=null!=(o=n.cm_autopreview_todo||(null!=t?t.cm_autopreview_todo:t))?o:s)===l?o.call(a,{name:"cm_autopreview_todo",hash:{},data:r}):o)+'>\n<label for="cm_autopreview_todo" >\u5f85\u529e</label>\n</div>\n</div>\n<div class="inline field">\n<div class="ui checkbox">\n<input type="checkbox" name="cm_autopreview_ruby" '+c(typeof(o=null!=(o=n.cm_autopreview_ruby||(null!=t?t.cm_autopreview_ruby:t))?o:s)===l?o.call(a,{name:"cm_autopreview_ruby",hash:{},data:r}):o)+'>\n<label for="cm_autopreview_ruby" >\u62fc\u97f3\u6ce8\u91ca</label>\n</div>\n</div>\n<div class="inline field">\n<div class="ui checkbox">\n<input type="checkbox" name="cm_autopreview_fenced_code" '+c(typeof(o=null!=(o=n.cm_autopreview_fenced_code||(null!=t?t.cm_autopreview_fenced_code:t))?o:s)===l?o.call(a,{name:"cm_autopreview_fenced_code",hash:{},data:r}):o)+'>\n<label for="cm_autopreview_fenced_code" >\u4ee3\u7801\u5757</label>\n</div>\n</div>\n<div class="inline field">\n<div class="ui checkbox">\n<input type="checkbox" name="cm_autopreview_emoji" '+c(typeof(o=null!=(o=n.cm_autopreview_emoji||(null!=t?t.cm_autopreview_emoji:t))?o:s)===l?o.call(a,{name:"cm_autopreview_emoji",hash:{},data:r}):o)+'>\n<label for="cm_autopreview_emoji" >emoji</label>\n</div>\n</div>\n<div class="inline field">\n<div class="ui checkbox">\n<input type="checkbox" name="cm_autopreview_html" '+c(typeof(o=null!=(o=n.cm_autopreview_html||(null!=t?t.cm_autopreview_html:t))?o:s)===l?o.call(a,{name:"cm_autopreview_html",hash:{},data:r}):o)+'>\n<label for="cm_autopreview_html" >HTML</label>\n</div>\n</div>\n<div class="inline field">\n<div class="ui checkbox">\n<input type="checkbox" name="cm_autopreview_mermaid" '+c(typeof(o=null!=(o=n.cm_autopreview_mermaid||(null!=t?t.cm_autopreview_mermaid:t))?o:s)===l?o.call(a,{name:"cm_autopreview_mermaid",hash:{},data:r}):o)+'>\n<label for="cm_autopreview_mermaid" >Mermaid</label>\n</div>\n</div>\n<div class="inline field">\n<div class="ui checkbox">\n<input type="checkbox" name="cm_autopreview_flow" '+c(typeof(o=null!=(o=n.cm_autopreview_flow||(null!=t?t.cm_autopreview_flow:t))?o:s)===l?o.call(a,{name:"cm_autopreview_flow",hash:{},data:r}):o)+'>\n<label for="cm_autopreview_flow" >Flow</label>\n</div>\n</div>\n<div class="inline field">\n<div class="ui checkbox">\n<input type="checkbox" name="cm_autopreview_sequence" '+c(typeof(o=null!=(o=n.cm_autopreview_sequence||(null!=t?t.cm_autopreview_sequence:t))?o:s)===l?o.call(a,{name:"cm_autopreview_sequence",hash:{},data:r}):o)+'>\n<label for="cm_autopreview_sequence" >Sequence</label>\n</div>\n</div>\n<div class="inline field">\n<div class="ui checkbox">\n<input type="checkbox" name="cm_autopreview_plantUML" '+c(typeof(o=null!=(o=n.cm_autopreview_plantUML||(null!=t?t.cm_autopreview_plantUML:t))?o:s)===l?o.call(a,{name:"cm_autopreview_plantUML",hash:{},data:r}):o)+'>\n<label for="cm_autopreview_plantUML" >plantUML</label>\n</div>\n</div>\n</details>\n</div>\n\n\n<div class="inline fields">\n<label for="cm_keyBindings" >\u952e\u76d8\u6a21\u5f0f</label>\n<div class="field">\n<div class="ui radio checkbox">\n<input type="radio" name="cm_keyBindings" value="default">\n<label >default</label>\n</div>\n</div>\n<div class="field">\n<div class="ui radio checkbox">\n<input type="radio" name="cm_keyBindings" value="vim">\n<label >vim</label>\n</div>\n</div>\n<div class="field">\n<div class="ui radio checkbox">\n<input type="radio" name="cm_keyBindings" value="emacs">\n<label >emacs</label>\n</div>\n</div>\n<div class="field">\n<div class="ui radio checkbox">\n<input type="radio" name="cm_keyBindings" value="sublime">\n<label >sublime</label>\n</div>\n</div>\n</div>\n<div class="inline field">\n<div class="ui checkbox">\n<input type="checkbox" name="cm_smartIndent" '+c(typeof(o=null!=(o=n.cm_smartIndent||(null!=t?t.cm_smartIndent:t))?o:s)===l?o.call(a,{name:"cm_smartIndent",hash:{},data:r}):o)+'>\n<label for="cm_smartIndent" >smartIndent</label>\n</div>\n</div>\n<div class="inline field">\n<div class="ui checkbox">\n<input type="checkbox" name="cm_indentWithTabs" '+c(typeof(o=null!=(o=n.cm_indentWithTabs||(null!=t?t.cm_indentWithTabs:t))?o:s)===l?o.call(a,{name:"cm_indentWithTabs",hash:{},data:r}):o)+'>\n<label for="cm_indentWithTabs" >indentWithTabs</label>\n</div>\n</div>\n<div class="inline field">\n<div class="ui checkbox">\n<input type="checkbox" name="cm_lineNumbers" '+c(typeof(o=null!=(o=n.cm_lineNumbers||(null!=t?t.cm_lineNumbers:t))?o:s)===l?o.call(a,{name:"cm_lineNumbers",hash:{},data:r}):o)+'>\n<label for="cm_lineNumbers" >\u663e\u793a\u884c\u53f7</label>\n</div>\n</div>\n<div class="inline field">\n<div class="ui checkbox">\n<input type="checkbox" name="cm_autoCloseBrackets" '+c(typeof(o=null!=(o=n.cm_autoCloseBrackets||(null!=t?t.cm_autoCloseBrackets:t))?o:s)===l?o.call(a,{name:"cm_autoCloseBrackets",hash:{},data:r}):o)+'>\n<label for="cm_autoCloseBrackets" >\u81ea\u52a8\u5173\u95ed\u62ec\u53f7</label>\n</div>\n</div>\n<div class="inline field">\n<div class="ui checkbox">\n<input type="checkbox" name="cm_lineWrapping" '+c(typeof(o=null!=(o=n.cm_lineWrapping||(null!=t?t.cm_lineWrapping:t))?o:s)===l?o.call(a,{name:"cm_lineWrapping",hash:{},data:r}):o)+'>\n<label for="cm_lineWrapping" >\u81ea\u52a8\u6298\u884c</label>\n</div>\n</div>\n<div class="inline field">\n<div class="ui checkbox">\n<input type="checkbox" name="cm_highlightActive" '+c(typeof(o=null!=(o=n.cm_highlightActive||(null!=t?t.cm_highlightActive:t))?o:s)===l?o.call(a,{name:"cm_highlightActive",hash:{},data:r}):o)+'>\n<label for="cm_highlightActive" >\u9ad8\u4eae\u5f53\u524d\u884c</label>\n</div>\n</div>\n<div class="inline field">\n<div class="ui checkbox">\n<input type="checkbox" name="cm_styleStackFocusLine" '+c(typeof(o=null!=(o=n.cm_styleStackFocusLine||(null!=t?t.cm_styleStackFocusLine:t))?o:s)===l?o.call(a,{name:"cm_styleStackFocusLine",hash:{},data:r}):o)+'>\n<label for="cm_styleStackFocusLine" >\u884c\u4e13\u6ce8</label>\n</div>\n</div>\n<div class="inline field">\n<div class="ui checkbox">\n<input type="checkbox" name="cm_showInvisibles" '+c(typeof(o=null!=(o=n.cm_showInvisibles||(null!=t?t.cm_showInvisibles:t))?o:s)===l?o.call(a,{name:"cm_showInvisibles",hash:{},data:r}):o)+'>\n<label for="cm_showInvisibles" >\u663e\u793a\u4e0d\u53ef\u89c1\u5143\u7d20</label>\n</div>\n</div>\n<div class="inline field">\n<div class="ui checkbox">\n<input type="checkbox" name="cm_typewriterScrolling" '+c(typeof(o=null!=(o=n.cm_typewriterScrolling||(null!=t?t.cm_typewriterScrolling:t))?o:s)===l?o.call(a,{name:"cm_typewriterScrolling",hash:{},data:r}):o)+'>\n<label for="cm_typewriterScrolling" >\u6253\u5b57\u673a\u6eda\u52a8\u6548\u679c</label>\n</div>\n</div>\n<div class="inline field">\n<div class="ui checkbox">\n<input type="checkbox" name="cm_minimap" '+c(typeof(o=null!=(o=n.cm_minimap||(null!=t?t.cm_minimap:t))?o:s)===l?o.call(a,{name:"cm_minimap",hash:{},data:r}):o)+'>\n<label for="cm_minimap" >\u5c0f\u5730\u56feminimap\u6eda\u52a8\u6761</label>\n</div>\n</div>\n<div class="inline field">\n<div class="ui checkbox">\n<input type="checkbox" name="cm_scrollPastEnd" '+c(typeof(o=null!=(o=n.cm_scrollPastEnd||(null!=t?t.cm_scrollPastEnd:t))?o:s)===l?o.call(a,{name:"cm_scrollPastEnd",hash:{},data:r}):o)+'>\n<label for="cm_scrollPastEnd" >scrollPastEnd</label>\n</div>\n</div>\n<div class="inline field">\n<div class="ui checkbox">\n<input type="checkbox" name="cm_autopreviewHoveredImage" '+c(typeof(o=null!=(o=n.cm_autopreviewHoveredImage||(null!=t?t.cm_autopreviewHoveredImage:t))?o:s)===l?o.call(a,{name:"cm_autopreviewHoveredImage",hash:{},data:r}):o)+'>\n<label for="cm_autopreviewHoveredImage" >\u5f53\u9f20\u6807\u7ecf\u8fc7\u56fe\u7247\u94fe\u63a5\u65f6,\u81ea\u52a8\u9884\u89c8\u56fe\u7247</label>\n</div>\n</div>\n<div class="inline field">\n<div class="ui checkbox">\n<input type="checkbox" name="cm_activeCursorMathjax" '+c(typeof(o=null!=(o=n.cm_activeCursorMathjax||(null!=t?t.cm_activeCursorMathjax:t))?o:s)===l?o.call(a,{name:"cm_activeCursorMathjax",hash:{},data:r}):o)+'>\n<label for="cm_activeCursorMathjax" >\u5f53\u5149\u6807\u5904\u5728\u516c\u5f0f\u5185\u65f6,\u81ea\u52a8\u9884\u89c8\u516c\u5f0f\u6548\u679c</label>\n</div>\n</div>\n<div class="inline field">\n<div class="ui checkbox">\n<input type="checkbox" name="cm_spellChecker" '+c(typeof(o=null!=(o=n.cm_spellChecker||(null!=t?t.cm_spellChecker:t))?o:s)===l?o.call(a,{name:"cm_spellChecker",hash:{},data:r}):o)+'>\n<label for="cm_spellChecker" >\u5f00\u542f\u82f1\u6587\u8bed\u6cd5\u68c0\u67e5</label>\n</div>\n</div>\n<div class="inline field">\n<div class="ui checkbox">\n<input type="checkbox" name="cm_markerColorpicker" '+c(typeof(o=null!=(o=n.cm_markerColorpicker||(null!=t?t.cm_markerColorpicker:t))?o:s)===l?o.call(a,{name:"cm_markerColorpicker",hash:{},data:r}):o)+'>\n<label for="cm_markerColorpicker" >\u5f00\u542f\u9ad8\u4eae\u8bed\u6cd5\u989c\u8272\u9009\u62e9\u5668</label>\n</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/editor_buttons_config":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<span class="icon_tip">\u4fee\u6539\u7f16\u8f91\u5668\u914d\u7f6e</span>\n<i class="icon cog" title="\u4fee\u6539\u7f16\u8f91\u5668\u914d\u7f6e" >\n</i>\n<div class="menu">\n<div class="item editor_viewport_size_item">\u754c\u9762\u5927\u5c0f:\n<select class="editor_viewport_size_select">\n<option value=""></option>\n</select>\n<div class="ui input transparent" style="border-bottom: 1px dotted">\n<input type="text" class="editor_viewport_size_input" placeholder="">\n</div>\n</div>\n<div class="item editor_viewport_align_item">\u754c\u9762\u5bf9\u9f50:\n<select class="editor_viewport_align_select">\n<option value=""></option>\n<option value="center">\u5c45\u4e2d</option>\n<option value="left">\u9760\u5de6</option>\n<option value="right">\u9760\u53f3</option>\n</select>\n</div>\n<div class="item editor_font_size_item">\u5b57\u4f53\u5927\u5c0f:\n<div class="ui button mini change_font_size_btn" data-type="minus"><i class="minus icon"></i></div>\n<div class="ui button mini icon change_font_size_btn" data-type="plus"><i class="plus icon"></i></div>\n<span class="editor_font_size">16</span>\n</div>\n<div class="item editor_line_height_item">\u884c\u9ad8:\n<div class="ui button mini change_line_height_btn" data-type="minus"><i class="minus icon"></i></div>\n<div class="ui button mini icon change_line_height_btn" data-type="plus"><i class="plus icon"></i></div>\n<span class="editor_line_height">1.2</span>\n</div>\n<div class="menu scrolling">\n<div class="editor_config_container">\n</div>\n</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/editor_tool":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<div id="wmd-button-bar" class="hide">\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/editor_tool_insert_html_dialog":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<i class="close icon"></i>\n<div class="header">\nHTML to Markdown\n</div>\n<div class="content story_content">\n<div class="ui form">\n<div class="inline fields">\n<label for="pasteDateType">\u526a\u5207\u677f\u6570\u636e\u683c\u5f0f</label>\n<div class="field">\n<div class="ui radio checkbox ">\n<input type="radio" name="pasteDateType" value="text" checked>\n<label>\u7eaf\u6587\u672c</label>\n</div>\n</div>\n<div class="field">\n<div class="ui radio checkbox ">\n<input type="radio" name="pasteDateType" value="html">\n<label>html \u7247\u6bb5</label>\n</div>\n</div>\n</div>\n<div class="ui info message">\n\u9700\u8981\u7528\u6237\u81ea\u5df1\u901a\u8fc7 <kbd><kbd>ctrl</kbd> + <kbd>v</kbd></kbd> \u5728 html \u8f93\u5165\u6846\u91cc\u7c98\u8d34\u624d\u80fd\u4f7f\u7528\u526a\u5207\u7248\u91cc\u7684 html \u683c\u5f0f\n</div>\n<div class="field">\n<label for="html">HTML</label>\n<textarea name="html" placeholder="\u8bf7\u8f93\u5165html\u5185\u5bb9"></textarea>\n</div>\n<h4 class="ui horizontal divider header">\n<i class="arrow down icon"></i>\n</h4>\n<div class="field">\n<label for="markdown">Markdown</label>\n<textarea name="markdown"></textarea>\n</div>\n</div>\n</div>\n<div class="actions">\n<div class="ui cancel button">\n\u53d6\u6d88\n</div>\n<div class="ui positive button">\n\u786e\u5b9a\n</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/editor_tool_insert_link_dialog":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<div class="ui small modal">\n<i class="close icon"></i>\n<div class="header">\n\u63d2\u5165\u94fe\u63a5\n</div>\n<div class="content">\n<div class="ui form">\n<div class="field">\n<div class="ui search">\n<div class="ui fluid icon input">\n<input type="text" name="link" placeholder="\u8bf7\u5728\u8fd9\u91cc\u8f93\u5165\u4e00\u4e2a\u94fe\u63a5\u5730\u5740" class="prompt">\n<i class="linkify icon"></i>\n</div>\n<div class="results"></div>\n</div>\n</div>\n</div>\n</div>\n<div class="actions">\n<div class="ui cancel button">\n\u53d6\u6d88\n</div>\n<div class="ui positive button">\n\u786e\u5b9a\n</div>\n</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/editor_tool_insert_magnet_dialog":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<i class="close icon"></i>\n<div class="header">\n\u7f51\u7edc\u56fe\u7247\u5730\u5740\u8f6c\u6362\n</div>\n<div class="content story_content">\n<table class="ui fixed table">\n<thead>\n<tr>\n<th class="four wide">\u56fe\u7247</th>\n<th >\u539f\u5730\u5740/\u8f6c\u6362\u540e\u7684\u5730\u5740 <div class="ui mini basic button clean_all_new_src_button" title="\u6e05\u7a7a\u6240\u6709\u8f6c\u6362\u540e\u7684\u5730\u5740,\u91cd\u65b0\u8f6c\u6362">\u6e05\u7a7a</div></th>\n<th class="two wide"><i class=\'large icon toggle_checkbox_all square outline\' style=\'cursor:pointer\'></i></th>\n</tr>\n</thead>\n<tbody></tbody>\n</table>\n</div>\n<div class="actions">\n<div class="tips">\n<div class="ui basic mini button help_button">\u5e2e\u52a9</div>\n</div>\n<div class="ui inline bottom right pointing dropdown resource_dropdown">\n<input type="hidden" value="system" />\n<i class="dropdown icon"></i>\n<span>\u9009\u62e9\u76ee\u6807\u56fe\u5e8a:</span>\n<span class="text">\u5c0f\u4e66\u5320</span>\n<div class="menu resource_menu">\n<div class="item setting_item" data-value=\'setting\' data-text="\u7ba1\u7406"><i class="exchange icon"></i>\u6dfb\u52a0\u66f4\u591a\u56fe\u5e8a</div>\n<div class="item system_item" data-value=\'system\' data-text="\u5c0f\u4e66\u5320">\u5c0f\u4e66\u5320\u6570\u636e\u5e93</div>\n</div>\n</div>\n<div class="ui cancel basic button">\n\u5173\u95ed\n</div>\n<div class="ui button primary convert_button disabled">\n<sup>\u2460</sup>\u8f6c\u6362\n</div>\n<div class="ui positive button basic disabled">\n<sup>\u2461</sup>\u786e\u5b9a\n</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/editor_tool_insert_moment_dialog":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<i class="close icon"></i>\n<div class="header">\n\u8f93\u5165\u5f53\u524d\u65f6\u95f4\n</div>\n<div class="content story_content">\n<select name="formate" class="ui fluid search dropdown">\n<option value="YYYY\u5e74MM\u6708DD\u65e5 HH\u65f6mm\u5206ss\u79d2">YYYY\u5e74MM\u6708DD\u65e5 HH\u65f6mm\u5206ss\u79d2</option>\n<option value="YYYY\u5e74MM\u6708DD\u65e5">YYYY\u5e74MM\u6708DD\u65e5</option>\n<option value="YYYY\u5e74MM\u6708DD\u65e5 HH:mm:ss">YYYY\u5e74MM\u6708DD\u65e5 HH:mm:ss</option>\n<option value="HH\u65f6mm\u5206ss\u79d2">HH\u65f6mm\u5206ss\u79d2</option>\n<option value="HH:mm:ss">HH:mm:ss</option>\n<option value="YYYY/MM/DD">YYYY/MM/DD</option>\n<option value="YY/MM/DD">YYYY/MM/DD</option>\n<option value="YY-MM-DD">YY-MM-DD</option>\n<option value="YY.MM.DD">YY.MM.DD</option>\n<option value="HH/mm/ss">HH/mm/ss</option>\n</select>\n<div class="ui icon message">\n<i class="wait icon"></i>\n<div class="content">\n<div class="header">\n\u8f93\u51fa\u6548\u679c\n</div>\n<p class="moment_format_result"></p>\n</div>\n</div>\n</div>\n<div class="actions">\n<div class="tips">\u8bbe\u7f6e\u4e3a\u9ed8\u8ba4\u683c\u5f0f\u540e\uff0c\u53ef\u4ee5\u6309\u5feb\u6377\u952e `ctrl + .` \u76f4\u63a5\u8f93\u5165\u5f53\u524d\u65f6\u95f4</div>\n\u8bbe\u7f6e\u4e3a\u9ed8\u8ba4\u683c\u5f0f<input type="checkbox" name="setDefault"></input>\n<div class="ui cancel button basic">\n\u53d6\u6d88\n</div>\n<div class="ui positive button basic">\n\u786e\u5b9a\n</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/editor_tool_insert_table_dialog":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<div class="ui standard story_modal modal">\n<i class="close icon"></i>\n<div class="seven item ui pointing secondary menu">\n<a class="item active" data-tab="first">\u8868\u683c</a>\n<a class="item" data-tab="second">markdown</a>\n</div>\n<div class="content story_content story_handsontable_content" style="padding: 0px!important">\n<div class="handsontable ui bottom attached tab segment active" data-tab="first"></div>\n<div class="markdown ui bottom attached tab segment" data-tab="second">\n<pre></pre>\n</div>\n</div>\n<div class="actions">\n<div class="tips">\n<div>\u63d0\u793a:</div>\n<div>\n1. \u4f60\u53ef\u4ee5\u9009\u4e2d\u7f16\u8f91\u5668\u91cc\u7684\u8868\u683cmarkdown\u5b57\u7b26,\u518d\u70b9\u51fb\u8868\u683c\u7f16\u8f91\u6309\u94ae,\u8868\u683c\u5185\u5bb9\u5c06\u4f1a\u88ab\u56de\u586b<br/>\n2. \u56de\u586b\u529f\u80fd\u4ec5\u9488\u5bf9\u666e\u901a\u8868\u683c\u7684markdown\u8bed\u6cd5,\u589e\u5f3a\u578b\u8868\u683c\u8bed\u6cd5\u6682\u4e0d\u652f\u6301\n</div>\n</div>\n<div class="ui cancel button">\n\u53d6\u6d88\n</div>\n<div class="ui positive button">\n\u786e\u5b9a\n</div>\n</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/editor_tool_insert_toc_dialog":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<i class="close icon"></i>\n<div class="header">\n\u751f\u6210\u9759\u6001\u76ee\u5f55\n</div>\n<div class="content story_content toc_content_container">\n</div>\n<div class="actions">\n<div class="tips"><div class="slider-range" style="width: 300px"></div></div>\n\u751f\u6210\u5e8f\u53f7<input type="checkbox" name="orderedList" class="toc_ordered_list"></input>\n\u8bbe\u7f6e\u4e3a\u9ed8\u8ba4\u683c\u5f0f<input type="checkbox" name="setDefault"></input>\n<div class="ui cancel button basic">\n\u53d6\u6d88\n</div>\n<div class="ui positive button basic">\n\u786e\u5b9a\n</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/export_file_dialog":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){var o;return'<i class="close icon"></i>\n<div class="header">\n'+e.escapeExpression("function"==typeof(o=null!=(o=n.title||(null!=t?t.title:t))?o:n.helperMissing)?o.call(null!=t?t:e.nullContext||{},{name:"title",hash:{},data:r}):o)+'\n</div>\n<div class="content story_content export_container">\n<div class="ui styled fluid accordion export_function_list_container">\n<form action="" class="ui form function_form"></form>\n</div>\n<div class="export_function_global_settings_container" style="display:none;">\n\u5168\u5c40\u5bfc\u51fa\u8bbe\u7f6e(\u8be5\u8bbe\u7f6e\u4ec5\u5f71\u54cd\u5f53\u524d\u5bfc\u51fa\u7684\u6587\u6863)\n<form action="" class="ui form settings_form">\n<div class="inline field">\n<label for="systemPreviewCss">\u9884\u89c8\u533a\u7cfb\u7edf\u6837\u5f0f</label>\n<span class="system_preview_select_css_container"></span>\n</div>\n<div class="inline field">\n<label for="codePreviewCss">\u9884\u89c8\u533a\u4ee3\u7801\u9ad8\u4eae\u6837\u5f0f</label>\n<span class="code_preview_select_css_container"></span>\n</div>\n<div class="ui fluid field">\n<label for="userPreviewCssText">\u9884\u89c8\u533a\u81ea\u5b9a\u4e49\u6837\u5f0f</label>\n<textarea name="userPreviewCssText"></textarea>\n</div>\n</form>\n</div>\n</div>\n<div class="actions">\n<div class="tips">\n<div class="ui basic button settings_button icon">\n<i class="cogs icon"></i>\n\u5168\u5c40\u8bbe\u7f6e\n</div>\n</div>\n<div class="ui positive button basic_close_button" >\n\u5173\u95ed\n</div>\n<div class="ui button global_settings_cancel_button">\n\u53d6\u6d88\n</div>\n<div class="ui blue button global_settings_ok_button">\n\u786e\u5b9a\n</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/external_editor":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<i class="close icon"></i>\n<div class="header">\u5916\u90e8\u7f16\u8f91\u5668\u7ba1\u7406\u754c\u9762</div>\n<div class="content story_content">\n<table class="ui definition table external_editor_list_container">\n<thead>\n<tr><th class="one wide"></th>\n<th class="six wide">\u540d\u79f0</th>\n<th class="nine wide"><div class="ui button add_button">\u6dfb\u52a0</div></th>\n</tr></thead>\n<tbody>\n</tbody>\n</table>\n<div class="ui segment external_editor_detail_container">\n</div>\n<div class="ui form external_editor_modify_container">\n<div class="field">\n<label>\u540d\u79f0</label>\n<input type="hidden" name="id">\n<input type="text" name="editorName" placeholder="\u8f93\u5165\u4e00\u4e2a\u7528\u4e8e\u6807\u8bc6\u7684\u7f16\u8f91\u5668\u540d\u79f0">\n</div>\n<div class="field">\n<label>\u547d\u4ee4</label>\n<textarea name="executeStr" rows="2" placeholder="gvim &#123;&#123;file&#125;&#125;"></textarea>\n</div>\n<div class="ui message">\n<ul class="list">\n<li>\u547d\u4ee4\u91cc\u9700\u8981\u63d0\u4f9b\u4e00\u4e2a file \u53d8\u91cf</li>\n<li>\u6bd4\u5982\u4f7f\u7528 gvim \u6253\u5f00\uff0c `gvim &#123;&#123;file&#125;&#125;`</li>\n<li>\u751f\u6210\u7684\u4e34\u65f6\u6587\u4ef6\u4f1a\u5728\u9000\u51fa\u5c0f\u4e66\u5320\u540e\uff0c\u81ea\u52a8\u6e05\u7a7a </li>\n</ul>\n</div>\n<div class="ui button save_modify_button">\u4fdd\u5b58</div>\n<div class="ui button cancel_modify_button">\u53d6\u6d88</div>\n</div>\n</div>\n<div class="actions">\n<div class="ui basic cancel button close_button">\n\u5173\u95ed\n</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/external_preview_view":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<div class="ui icon buttons">\n<i class="icon header_opacity_button wizard" title="\u6253\u5f00\u900f\u660e\u6548\u679c"></i>\n<i class="icon header_background_button film" title="\u9884\u89c8\u5c42\u6c34\u5370\u6548\u679c"></i>\n<i class="icon header_rotate_button repeat" title="\u65cb\u8f6c"></i>\n<i class="icon reset_rotate_button remove" title="\u91cd\u7f6e" style="display:none;"></i>\n<i class="icon minus header_state_button" title="\u6700\u5c0f\u5316"></i>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/file_attachments_manager":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){var o;return'<i class="close icon"></i>\n<div class="header">\n'+e.escapeExpression("function"==typeof(o=null!=(o=n.title||(null!=t?t.title:t))?o:n.helperMissing)?o.call(null!=t?t:e.nullContext||{},{name:"title",hash:{},data:r}):o)+'\n</div>\n<div class="content story_content">\n<input type="file" style="display: none" multiple="multiple"/>\n<div class="ui basic button add_attachments_button">\u6dfb\u52a0\u65b0\u7684\u9644\u4ef6</div>\n<div class="file_gallery">\n<div class="ui cards"></div>\n</div>\n<div class="ui segment blank_html">\n<h2 class="ui header aligned center icon green">\n<i class="smile icon"></i>\n<div class="sub header">\u9644\u4ef6\u7a7a\u7a7a\u7684</div>\n</h2>\n</div>\n</div>\n<div class="actions">\n<div class="ui basic buttons manage_buttons hide_manage_buttons">\n<div class="ui button detail_button">\u67e5\u770b\u6587\u4ef6\u5185\u5bb9</div>\n<div class="ui button info_button">\u4fee\u6539\u57fa\u672c\u4fe1\u606f</div>\n<div class="ui button attach_button disabled">\u7ba1\u7406\u9644\u4ef6</div>\n</div>\n<div class="ui basic buttons manage_buttons hide_manage_buttons">\n<div class="ui button draft_button">\u91cd\u65b0\u8349\u7a3f</div>\n<div class="ui button archive_button">\u5f52\u6863</div>\n</div>\n<div class="ui basic cancel button">\n\u5173\u95ed\n</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/file_detail":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){var o,a,s=null!=t?t:e.nullContext||{},l=n.helperMissing;return'<i class="close icon"></i>\n<div class="header"><div class="ui basic button preview_button icon circular" title="\u6d4f\u89c8\u5207\u6362"><i class="icon unhide"></i></div>'+(null!=(o="function"==typeof(a=null!=(a=n.title||(null!=t?t.title:t))?a:l)?a.call(s,{name:"title",hash:{},data:r}):a)?o:"")+'</div>\n<div class="content story_content">\n<div class="file_detail_content" style="display:none">'+(null!=(o="function"==typeof(a=null!=(a=n.content||(null!=t?t.content:t))?a:l)?a.call(s,{name:"content",hash:{},data:r}):a)?o:"")+'</div>\n<div class="file_detail_preview" style="display:none"></div>\n</div>\n<div class="actions">\n<div class="ui basic buttons manage_buttons hide_manage_buttons">\n<div class="ui button detail_button disabled">\u67e5\u770b\u6587\u4ef6\u5185\u5bb9</div>\n<div class="ui button info_button">\u4fee\u6539\u57fa\u672c\u4fe1\u606f</div>\n<div class="ui button attach_button">\u7ba1\u7406\u9644\u4ef6</div>\n</div>\n<div class="ui basic buttons manage_buttons hide_manage_buttons">\n<div class="ui button draft_button">\u91cd\u65b0\u8349\u7a3f</div>\n<div class="ui button archive_button">\u5f52\u6863</div>\n</div>\n<div class="ui basic cancel button">\n\u5173\u95ed\n</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/file_history_dialog":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){var o;return'<i class="close icon"></i>\n<div class="header">\n'+e.escapeExpression("function"==typeof(o=null!=(o=n.title||(null!=t?t.title:t))?o:n.helperMissing)?o.call(null!=t?t:e.nullContext||{},{name:"title",hash:{},data:r}):o)+'<span >\u7684\u5386\u53f2\u8bb0\u5f55</span>\n</div>\n<div class="content story_content">\n<div class="file_history_content_container">\n<div class="file_history_list">\n<table class="ui celled structured table basic selectable">\n<thead>\n<tr>\n<th class="one wide"></th>\n<th class="seven wide">\u65f6\u95f4</th>\n</tr>\n</thead>\n<tbody></tbody>\n</table>\n</div>\n<div class="file_info file_history_info" style="display:none">\n<pre class="file_content"></pre>\n</div>\n</div>\n</div>\n<div class="actions">\n<div class="ui toggle checkbox show_diff_checkbox hidden">\n<input type="checkbox" name="show_diff" checked="checked">\n<label>\u663e\u793a\u5dee\u5f02</label>\n</div>\n<div class="ui toggle checkbox show_compact_checkbox">\n<input type="checkbox" name="show_compact">\n<label>\u663e\u793a\u4e0d\u5b58\u5728\u7684\u7248\u672c</label>\n</div>\n<div class="ui cancel button" >\n\u5173\u95ed\n</div>\n<div class="ui close_conflicts_button button" >\n\u5173\u95ed\u6240\u6709\u51b2\u7a81\u5206\u652f\n</div>\n<div class="ui detail_close_conflict_button button" >\n\u5173\u95ed\u8be5\u51b2\u7a81\u5206\u652f\n</div>\n<div class="ui positive button select_button" style="display:none" >\n\u4f7f\u7528\u8be5\u7248\u672c\n</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/file_horizontal_tabs":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<div class="file_horizontal_tabs">\n<div class="chrome-tabs-shell">\n<div class="chrome-tabs sortable_file_tabs_area">\n<div class="chrome-tab chrome-tab-blank"></div>\n</div>\n</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/file_info":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<i class="close icon"></i>\n<div class="header">\u6587\u4ef6\u4fe1\u606f</div>\n<div class="content story_content">\n<table class="ui definition table">\n<thead>\n<tr><th class="six wide"></th>\n<th class="ten wide">\u5b57\u6570</th>\n</tr></thead>\n<tbody class="file_statistics_container">\n</tbody></table>\n</div>\n<div class="actions">\n<div class="ui basic cancel button">\n\u5173\u95ed\n</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/file_info_manager":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<i class="close icon"></i>\n<div class="header">\u4fee\u6539\u6587\u4ef6\u4fe1\u606f</div>\n<div class="content story_content">\n<form class="ui form">\n<div class="field">\n<label for="title">\u6807\u9898</label>\n<div class="ui fluid input">\n<input type="text" name="title" placeholder="">\n</div>\n</div>\n<div class="field">\n<label for="tagNames">tags</label>\n<div class="ui fluid input">\n<input type="text" name="tagNames" placeholder="\u5173\u952e\u5b57">\n</div>\n</div>\n<div class="field plugin_info_container">\n<label for="tagNames">\u7ed1\u5b9a\u4fe1\u606f</label>\n<div class="ui message">\n<div class="plugin_info_description">\n</div>\n</div>\n</div>\n<div class="field other_info_container">\n<label for="tagNames">\u5176\u4ed6\u4fe1\u606f</label>\n<div class="ui message">\n<div class="other_info_description">\n</div>\n</div>\n</div>\n<div class="ui error message"></div>\n</form>\n</div>\n<div class="actions">\n<div class="ui basic buttons manage_buttons hide_manage_buttons">\n<div class="ui button detail_button">\u67e5\u770b\u6587\u4ef6\u5185\u5bb9</div>\n<div class="ui button info_button disabled">\u4fee\u6539\u57fa\u672c\u4fe1\u606f</div>\n<div class="ui button attach_button">\u7ba1\u7406\u9644\u4ef6</div>\n</div>\n<div class="ui basic buttons manage_buttons hide_manage_buttons">\n<div class="ui button draft_button">\u91cd\u65b0\u8349\u7a3f</div>\n<div class="ui button archive_button">\u5f52\u6863</div>\n</div>\n<div class="ui basic cancel button">\n\u5173\u95ed\n</div>\n<div class="ui basic positive button">\n\u4fdd\u5b58\n</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/file_tabs":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<i class="remove_other_tab circle times outline large icon" title="\u5173\u95ed\u5176\u4ed6"></i>\n<div class="file_tabs_wrapper"></div>\n<div class="menu"></div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/file_timeline":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<div class="vis-timeline-container">\n<div class="vis-timeline-controller-container">\n</div>\n</div>\n<div class="d3-brush-container">\n<svg class="d3-brush-svg" style="overflow: visible;"></svg>\n<div class="d3-brush-controller-container ui buttons mini icon">\n<div class="ui button icon mini hide-filtered-file-btn" title="\u663e\u793a\u6216\u8005\u9690\u85cf\u8fc7\u6ee4\u6389\u7684\u6587\u7ae0"><i class="icon lightbulb"></i></div>\n<div class="ui button icon mini refresh-btn" title="\u5237\u65b0"><i class="icon sync alternate"></i></div>\n<div class="ui button icon mini prev-btn" title="\u4e0a\u4e00\u65f6\u95f4\u6bb5"><i class="angle double left icon"></i></div>\n<div class="ui button icon mini next-btn" title="\u4e0b\u4e00\u65f6\u95f4\u6bb5"><i class="angle double right icon"></i></div>\n<div class="ui button icon mini config-btn" title="\u914d\u7f6e"><i class="cog icon"></i></div>\n<div class="ui button icon mini helper-btn" title="\u5e2e\u52a9"><i class="question circle icon"></i></div>\n</div>\n\n</div>\n<div class="d3-flashing-stars">\n</div>\n\n<div class="d3-range-info">\n<div class="d3-range-count">\n</div>\n<div class="d3-range-dates">\n</div>\n</div>\n<div class="file-timeline-helper-container">\n<div class="file-timeline-demo-container">\n<i class="icon close close-demo-helper-btn link"></i>\n<div class="ui button primary load-github-demo-btn">\u52a0\u8f7d\u6f14\u793a\u6570\u636e</div>\n<div class="ui button primary view-video-btn">\u67e5\u770b\u4f7f\u7528\u6559\u7a0b</div>\n</div>\n</div>\n<div class="file-timeline-controller-container">\n<div class="ui button icon mini toggle-file-timeline-btn" title="\u6253\u5f00\u6216\u8005\u5173\u95ed\u8424\u706b\u866b\u6a21\u5f0f"><i class="paper plane icon"></i></div>\n</div>\n<i class="icon close close-file-timeline-btn link" title="\u5173\u95ed\u8424\u706b\u866b\u6a21\u5f0f"></i>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/files_trash_manager_dialog":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<i class="close icon"></i>\n<div class="header" >\n\u56de\u6536\u7ad9\n</div>\n<div class="content story_content">\n<table class="ui table files_table">\n<thead>\n<tr>\n<th class="collapsing"></th>\n<th>\u6587\u4ef6\u540d\u79f0</th>\n<th class="center aligned">\u64cd\u4f5c</th>\n</tr>\n</thead>\n<tbody class="files_table_tbody">\n</tbody>\n</table>\n<div class="ui segment blank_html">\n<h2 class="ui header aligned center icon">\n<i class="smile icon"></i>\n<div class="sub header">\u56de\u6536\u7ad9\u7a7a\u7a7a\u7684</div>\n</h2>\n</div>\n</div>\n<div class="actions">\n<div class="ui buttons basic trash_buttons">\n<div class="ui basic button all_undo_delete_button">\u5168\u90e8\u53d6\u6d88\u5220\u9664</div>\n<div class="ui basic  button all_delete_button">\u5168\u90e8\u5f7b\u5e95\u5220\u9664</div>\n</div>\n<div class="ui basic cancel button" >\n\u5173\u95ed\n</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/filter_dropdown":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<i class="suitcase icon"></i>\n<div class="menu" tabindex="-1">\n<div class="header tab_header">\n<div class="ui compact button list_filter_button" data-type="recently">\u6700\u8fd1</div>\n<div class="ui compact button list_filter_button active" data-type="system">\u7cfb\u7edf</div>\n<div class="ui compact button list_filter_button" data-type="custom">\u81ea\u5b9a\u4e49</div>\n<div class="ui compact button list_filter_button" data-type="category">\u5206\u7c7b\u6811</div>\n<div class="ui compact button list_filter_button" data-type="tag">\u6807\u7b7e</div>\n<div class="ui compact button list_filter_button" data-type="date">\u65e5\u5386</div>\n</div>\n<div class="recently_filter_container" style="display:none">\n<div class="ui transition hidden dimmer">\n<div class="ui text loader">\u52a0\u8f7d\u4e2d</div>\n</div>\n</div>\n<div class="scrolling menu xsj_patch_menu customs_filter_container">\n</div>\n<div class="categorys_filter_container" style="display:none">\n<div class="ui transition hidden dimmer">\n<div class="ui text loader">\u52a0\u8f7d\u4e2d</div>\n</div>\n</div>\n<div class="tags_filter_container" style="display:none">\n<div class="ui transition hidden dimmer">\n<div class="ui text loader">\u52a0\u8f7d\u4e2d</div>\n</div>\n</div>\n<div class="date_filter_container" style="display:none">\n<div class="ui transition hidden dimmer">\n<div class="ui text loader">\u52a0\u8f7d\u4e2d</div>\n</div>\n</div>\n<div class="divider"></div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/home":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<div class="ui-layout-center main_center_wrapper">\n<div class="ui active dimmer main_center_dimmer" style="display:none">\n<div class="ui large text loader">\u5904\u7406\u4e2d...</div>\n</div>\n<div class="ui-layout-center main_center">\n</div>\n<div class="ui-layout-east main_preview main_preview_east"></div>\n<div class="ui-layout-north main_preview main_preview_north"></div>\n<div class="ui-layout-south main_preview main_preview_south"></div>\n<div class="ui-layout-west main_preview main_preview_west"></div>\n<div style="visibility:hidden;position: absolute;bottom:0;right:0;pointer-events:none;opacity: 0">\n<div id="preview_toc_button_placeholder"></div>\n</div>\n</div>\n<div class="ui-layout-west main_west_wrapper">\n</div>\n<div id="blueimp-gallery" class="blueimp-gallery blueimp-gallery-controls" style="display:none;">\n<div class="slides"></div>\n<h3 class="title"></h3>\n<a class="prev fa fa-chevron-left"></a>\n<a class="next fa fa-chevron-right"></a>\n<a class="one-to-one"><i class="icon crosshairs"></i></a>\n<a class="rotate"><i class="american sign language interpreting icon"></i></a>\n<a class="edit"><i class="icon edit outline"></i></a>\n<a class="download"><i class="icon download"></i></a>\n<a class="close"><i class="icon close"></i></a>\n<a class="play-pause fa fa-play"></a>\n<ol class="indicator"></ol>\n</div>\n\n<div style="visibility: hidden; overflow: hidden; position: absolute; top: 0px; height: 1px; width: auto; padding: 0px; border: 0px; margin: 0px; text-align: left; text-indent: 0px; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal;">\n\x3c!-- filters --\x3e\n<svg xmlns="http://www.w3.org/2000/svg" version="1.1">\n<defs>\n<filter id="xsj-shadowed-goo">\n<feGaussianBlur in="SourceGraphic" result="blur" stdDeviation="10" />\n<feColorMatrix in="blur" mode="matrix" values="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 18 -7" result="goo" />\n<feGaussianBlur in="goo" stdDeviation="3" result="shadow" />\n<feColorMatrix in="shadow" mode="matrix" values="0 0 0 0 0  0 0 0 0 0  0 0 0 0 0  0 0 0 1 -0.2" result="shadow" />\n<feOffset in="shadow" dx="1" dy="1" result="shadow" />\n<feBlend in2="shadow" in="goo" result="goo" />\n<feBlend in2="goo" in="SourceGraphic" result="mix" />\n</filter>\n<filter id="goo">\n<feGaussianBlur in="SourceGraphic" result="blur" stdDeviation="10" />\n<feColorMatrix in="blur" mode="matrix" values="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 18 -7" result="goo" />\n<feBlend in2="goo" in="SourceGraphic" result="mix" />\n</filter>\n</defs>\n</svg>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/import_file_dialog":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<i class="close icon"></i>\n<div class="header" >\u5bfc\u5165\u6587\u4ef6</div>\n<div class="content story_content">\n<p >\u8bf7\u9009\u62e9\u8981\u5bfc\u5165\u7684\u6587\u4ef6\u6216\u8005\u6587\u4ef6\u5939\uff08.md,.markdown,.html, .zip \u6587\u4ef6, zip \u6587\u4ef6\u9700\u8981\u662f\u7531\u5c0f\u4e66\u5320\u7cfb\u7edf\u5bfc\u51fa\u7684 zip \u538b\u7f29\u683c\u5f0f\uff09:</p>\n<p>\n<div class="select_file_btns">\n<button class="ui button select_file_btn">\u9009\u62e9\u6587\u4ef6</button>\n</div>\n<input type="file" name="fileData" class="form_control_file_input" multiple>\n</p>\n<p >\u6216\u8005\u5c06\u6587\u4ef6\u62d6\u62fd\u5230\u4e0b\u9762\u7684\u865a\u7ebf\u533a\u5185:</p>\n<p class="drop-zone" >\u5c06\u6587\u4ef6\u62d6\u62fd\u5230\u8fd9\u91cc</p>\n<div class="selected-file"></div>\n</div>\n<div class="actions">\n<div class="ui cancel button" >\n\u5173\u95ed\n</div>\n<div class="ui positive button import_btn disabled">\n<span >\u5bfc\u5165</span>\n</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/insert_file_dialog":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<i class="close icon"></i>\n<div class="content upload_container">\n<div class="four item tabular ui menu attached">\n<a class="active item" data-tab="import" >\n\u5916\u90e8\u6587\u4ef6\n</a>\n<a class="item" data-tab="local" >\n\u7f13\u5b58\u6587\u4ef6\n</a>\n</div>\n<div class="ui attached active tab segment" data-tab="import">\n<div style="display:none;"><input type="file" multiple="" name="fileData" class="form-control"></div>\n<p class="drop-zone" >\u5c06\u6587\u4ef6\u62d6\u62fd\u5230\u8fd9\u91cc</p>\n<div class="selected_filename"></div>\n</div>\n<div class="ui attached tab segment" data-tab="local">\n<p >\u9009\u62e9\u4e00\u4e2a\u5df2\u7ecf\u6dfb\u52a0\u7684\u6587\u4ef6</p>\n<div class="file_gallery">\n<div class="ui cards"></div>\n</div>\n</div>\n<div class="ui bottom attached segment">\n<p >\u6216\u8005\u76f4\u63a5\u8f93\u5165\u6587\u4ef6\u7684url\u5730\u5740:</p>\n<div class="ui form">\n<div class="field">\n<div class="ui fluid icon input">\n<input type="text" name="link" placeholder="\u8bf7\u5728\u8fd9\u91cc\u8f93\u5165\u4e00\u4e2a\u94fe\u63a5\u5730\u5740"\n>\n<i class="linkify icon"></i>\n</div>\n</div>\n</div>\n</div>\n</div>\n<div class="actions">\n<div class="tips">\n<label for="fileType">\u8bed\u6cd5\u683c\u5f0f:\n<select name="fileType" style="height: 20px;">\n<option value="image" selected>\u56fe\u7247</option>\n<option value="video">\u89c6\u9891</option>\n<option value="audio">\u97f3\u9891</option>\n<option value="attachment">\u9644\u4ef6</option>\n<option value="table">\u8868\u683c</option>\n<option value="html">html\u7247\u6bb5</option>\n</select>\n</label>\n</div>\n<div class="ui cancel button" >\n\u53d6\u6d88\n</div>\n<div class="ui positive button">\n<span >\u786e\u5b9a</span>\n</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/light_editor":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<pre id="light_editor" class="light_editor">\n<div class="editor-content"></div>\n</pre>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/light_editor_find_replace":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<div class="ui form segment find_replace">\n<i class="close icon"></i>\n<div class="two fields">\n<div class="field">\n<label>\u67e5\u627e</label>\n<input class="input_search" type="text">\n</div>\n<div class="field">\n<label>\u66ff\u6362\u4e3a</label>\n<input class="input_replace_with" type="text">\n</div>\n</div>\n<div class="inline field">\n<div class="ui checkbox">\n<input type="checkbox" class="checkbox_case_sensitive">\n<label>\u5ffd\u7565\u5927\u5c0f\u5199</label>\n</div>\n<div class="ui checkbox">\n<input type="checkbox" class="checkbox_regexp">\n<label>\u4f7f\u7528\u6b63\u5219\u8868\u8fbe\u793a\u5339\u914d</label>\n</div>\n</div>\n<div class="inline field">\n<span class="found_counter">0</span> \u5339\u914d\n<div class="ui primary button right floated search_button">\u67e5\u627e</div>\n<div class="ui button right floated replace_button">\u66ff\u6362</div>\n<div class="ui button right floated replace_all_button">\u66ff\u6362\u5168\u90e8</div>\n</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/list_tags":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<div class="list_tags_home">\n<div class="selected_tags"></div>\n<div class="list_tags_container tree_content"></div>\n<div class="ui search mini list_tags_filter_container filter_input_status">\n<div class="ui icon input tiny list_tags_filter_input_container search_input_wrapper">\n<i class="circle remove icon link close_search_input_wrapper clear_filter_input_button" title="\u6e05\u7a7a\u8fc7\u6ee4\u5185\u5bb9"></i>\n<input class="prompt list_tags_filter_input" type="text" placeholder="\u8981\u8fc7\u6ee4\u663e\u793a\u7684\u5185\u5bb9" name="list_tags_filter">\n<i class="filter icon list_tags_filter_button circular link"></i>\n</div>\n<a class="refresh_list_tags_button ui icon button mini compact  circular">\n<i class="icon refresh"></i>\n</a>\n<a class="open_filter_input_button ui icon button mini compact circular">\n<i class="icon filter"></i>\n</a>\n<a class="search_store_button ui icon button mini compact circular disabled">\n<i class="icon search"></i>\n</a>\n</div>\n</div>\n<div class="search_store_files_list" style="display:none">\n<div class="search_by_tags" style="display: flex; margin: .3em;">\n<span class="selected_tags"></span>\n<i class="reply all icon return_home_button link circular_icon"></i>\n</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/main_function_buttons":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<div class="tiny icon ui basic buttons base_group">\n<div class="ui icon button new_file basic" title="\u65b0\u5efa">\n<i class="edit icon"></i> <span class="button_text visible-md-inline-block visible-lg-inline-block" >\u65b0\u5efa</span>\n</div>\n<div class="ui icon button save_file basic" title="\u4fdd\u5b58">\n<i class="save icon"></i> <span class="button_text visible-md-inline-block visible-lg-inline-block" >\u4fdd\u5b58</span>\n</div>\n<div class="ui icon button save_as_file basic" title="\u53e6\u5b58\u4e3a">\n<i class="hdd outline icon"></i> <span class="button_text visible-md-inline-block visible-lg-inline-block" >\u53e6\u5b58\u4e3a</span>\n</div>\n</div>\n<div class="ui icon buttons tiny lock_file_horizontal_tabs_btn" title="\u5207\u6362\u9875\u7b7e\u6a21\u5f0f" style="margin-left:5px;"><div class="ui button"><i class="newspaper icon"></i></div></div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/main_toolbar":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<div class="main_toolbar ui menu">\n<div class="main_tabs_toolbar">\n<div class="right menu title_menu">\n<div class="item title_item">\n<div class="ui icon button title_button hidden-xs hidden-sm">\n<div class="title_content">\n\u672a\u547d\u540d\u6587\u4ef6\n</div>\n<div class="tags_content">\n</div>\n<div class="category_content">\n</div>\n<div class="flag_content">\n</div>\n</div>\n</div>\n</div>\n<div class="main_edit_toolbar">\n<div class="fitted item visible-xs-flex visible-sm-flex visible-md-flex normal_mode_group_container">\n<div class="tiny icon ui buttons">\n<div class="ui icon button top left pointing dropdown layout_dropdown">\n<i class="block layout icon"></i>\n<div class="menu">\n<div class="item" style="display:none">\n<span>&nbsp;</span>\n</div>\n<div class="layout_main_toolbar">\n<div class="base_group_layout_container layout_container"></div>\n<div class="wmd_button_group1_layout_container layout_container"></div>\n<div class="wmd_button_group2_layout_container layout_container"></div>\n<div class="wmd_button_group3_layout_container layout_container"></div>\n<div class="wmd_button_group4_layout_container layout_container"></div>\n</div>\n</div>\n</div>\n</div>\n</div>\n<div class="fitted item visible-xs-flex visible-sm-flex normal_mode_group_container">\n<div class="tiny icon ui buttons">\n<div class="ui icon button file_list_slide_toggle_button"><i class="icon server"></i></div>\n<div class="ui icon button preview_slide_toggle_button"><i class="icon unhide"></i></div>\n</div>\n</div>\n<div class="fitted item visible-lg-flex normal_mode_group_container">\n<div class="tiny icon ui buttons">\n<div class="ui icon button permalink_button" title="\u5206\u4eab"><i class="icon share large"></i></div>\n</div>\n</div>\n<div class="fitted item hidden-xs wmd_button_group1_container animation_icon_tips_container normal_mode_group_container">\n<div class="tiny icon ui buttons wmd_button_group1 animation_icon_tips"></div>\n</div>\n<div class="fitted item visible-md-flex visible-lg-flex wmd_button_group2_container animation_icon_tips_container normal_mode_group_container">\n<div class="tiny icon ui buttons wmd_button_group2 animation_icon_tips"></div>\n</div>\n<div class="fitted item visible-lg-flex wmd_button_group3_container animation_icon_tips_container normal_mode_group_container">\n<div class="tiny icon ui buttons wmd_button_group3 animation_icon_tips"></div>\n</div>\n<div class="fitted item hidden-xs wmd_button_group4_container animation_icon_tips_container normal_mode_group_container">\n<div class="tiny icon ui buttons wmd_button_group4 animation_icon_tips"></div>\n</div>\n</div>\n</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/miniweb_sync":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<i class="icons">\n<i class="server icon"></i>\n<i class="top right corner play icon"></i>\n</i>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/modify_file_attribute_dialog":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<i class="close icon"></i>\n<div class="header">\u4fee\u6539\u6587\u4ef6\u5c5e\u6027</div>\n<div class="content story_content">\n<form class="ui form">\n<div class="field title_field">\n<label for="title">\u6807\u9898</label>\n<div class="ui fluid input">\n<input type="text" name="title" placeholder="" value="\u672a\u547d\u4ee4\u6587\u4ef6">\n</div>\n</div>\n<div class="field">\n<label for="tagNames">\u6807\u7b7e\n<div class="inline fields tag_names_modify_type_container" style="display:\nnone;font-size:90%;font-weight:normal;">\n<label for="modifyType">\u4fee\u6539\u65b9\u5f0f</label>\n<div class="field">\n<div class="ui radio checkbox">\n<input type="radio" name="modifyType" checked="" tabindex="0" class="hidden" value="replace">\n<label>\u66ff\u6362</label>\n</div>\n</div>\n<div class="field">\n<div class="ui radio checkbox">\n<input type="radio" name="modifyType" tabindex="0" class="hidden" value="append">\n<label>\u8ffd\u52a0</label>\n</div>\n</div>\n<div class="field">\n<div class="ui radio checkbox">\n<input type="radio" name="modifyType" tabindex="0" class="hidden" value="strip">\n<label>\u5265\u79bb</label>\n</div>\n</div>\n</div>\n</label>\n<div class="ui fluid input">\n<input type="text" name="tagNames" placeholder="">\n</div>\n</div>\n<div class="field">\n<label for="category">\u5206\u7c7b</label>\n<div class="ui fluid input">\n<input type="text" name="category" placeholder="">\n</div>\n</div>\n<div class="field">\n<label for="flag">\u6807\u8bc6</label>\n<div class="ui fluid input">\n<input type="text" name="flag" placeholder="">\n</div>\n</div>\n<div class="field slug_field">\n<label for="slug">slug</label>\n<div class="ui fluid input">\n<input type="text" name="slug" placeholder="">\n</div>\n</div>\n<div class="ui error message"></div>\n</form>\n</div>\n<div class="actions">\n<div class="ui cancel button" >\n\u53d6\u6d88\n</div>\n<div class="ui positive button">\n<span>\u4fdd\u5b58</span>\n</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/new_filename_dialog":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){var o;return'<i class="close icon"></i>\n<div class="header">'+e.escapeExpression("function"==typeof(o=null!=(o=n.head||(null!=t?t.head:t))?o:n.helperMissing)?o.call(null!=t?t:e.nullContext||{},{name:"head",hash:{},data:r}):o)+'</div>\n<div class="content">\n<div class="ui form">\n<div class="field">\n<div class="ui fluid icon input">\n<input type="text" name="filename" placeholder="\u540d\u79f0">\n<i class="file outline icon"></i>\n</div>\n</div>\n<div class="ui error message"></div>\n</div>\n</div>\n<div class="actions">\n<div class="ui negative button">\n\u53d6\u6d88\n</div>\n<div class="ui positive right labeled icon button">\n\u786e\u5b9a\n<i class="check icon"></i>\n</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/page_nav":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<div class="ui icon button page_info_button dropdown scrolling">\n<span class="icon_tip page_statics_info"></span>\n<i class="icon angle double up" title="\u9009\u62e9">\n</i>\n<span class="page_info_container">\n<span class="current_page"></span>/<span class="total_page"></span>\n</span>\n<div class="menu">\n<div class="item">0</div>\n</div>\n</div>\n<div class="ui icon button page_button refresh_page_button">\n<span class="icon_tip">\u5237\u65b0</span>\n<i class="icon redo" title="\u5237\u65b0">\n</i>\n</div>\n<div class="ui icon button page_button first_page_button disabled">\n<span class="icon_tip">\u9996\u9875</span>\n<i class="icon angle double left" title="\u9996\u9875">\n</i>\n</div>\n<div class="ui icon button page_button prev_page_button disabled">\n<span class="icon_tip">\u4e0a\u4e00\u9875</span>\n<i class="icon angle left" title="\u4e0a\u4e00\u9875">\n</i>\n</div>\n<div class="ui icon button page_button next_page_button">\n<span class="icon_tip">\u4e0b\u4e00\u9875</span>\n<i class="icon angle right " title="\u4e0b\u4e00\u9875">\n</i>\n</div>\n<div class="ui icon button page_button last_page_button">\n<span class="icon_tip">\u5c3e\u9875</span>\n<i class="icon angle double right " title="\u5c3e\u9875">\n</i>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/preview":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){var o;return'<div class="ui active dimmer preview_dimmer" style="display:none">\n<div class="ui large text loader">\u5904\u7406\u4e2d...</div>\n</div>\n<div class="preview_server_control" style="display:none">\n<div class="preview_server_control_buttons">\u670d\u52a1\u5668\u63a7\u5236\u64cd\u4f5c\u754c\u9762</div>\n</div>\n<div class="preview_wrapper iframe_wrapper">\n<div class="preview '+e.escapeExpression("function"==typeof(o=null!=(o=n.customCssPrefix||(null!=t?t.customCssPrefix:t))?o:n.helperMissing)?o.call(null!=t?t:e.nullContext||{},{name:"customCssPrefix",hash:{},data:r}):o)+'"></div>\n</div>\n<div class="preview_line"></div>\n<div class="preview_errors" ></div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/preview_buttons":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<div class="ui icon buttons reverse gooey_effect preview_buttons_wrapper animation_icon_tips mini">\n<div class="ui icon button zen_button">\n<span class="icon_tip">\u5168\u5c4f\u9605\u8bfb\u6a21\u5f0f</span>\n<i class="icon expand" title="\u8fdb\u5165\u5168\u5c4f\u9605\u8bfb\u6a21\u5f0f" >\n</i>\n</div>\n\n<div class="ui icon button only_preview_mode_button">\n<span class="icon_tip">\u7eaf\u9605\u8bfb\u6a21\u5f0f</span>\n<i class="icon eye" title="\u8fdb\u5165\u7eaf\u9605\u8bfb\u6a21\u5f0f" >\n</i>\n</div>\n<div class="ui icon button normal_mode_button">\n<span class="icon_tip">\u9000\u51fa\u7eaf\u9605\u8bfb\u6a21\u5f0f</span>\n<i class="pen square icon" title="\u9000\u51fa\u7eaf\u9605\u8bfb\u6a21\u5f0f" >\n</i>\n</div>\n<div class="ui icon button file_info_button">\n<span class="icon_tip">\u67e5\u770b\u6587\u4ef6\u5b57\u6570\u7edf\u8ba1\u4fe1\u606f</span>\n<i class="icon circle info" title="\u67e5\u770b\u6587\u4ef6\u5b57\u6570\u7edf\u8ba1\u4fe1\u606f" >\n</i>\n</div>\n<div class="preview_config_button_placeholder">\n</div>\n<div class="ui icon button html_button">\n<span class="icon_tip">\u67e5\u770b\u6e90\u6587\u4ef6</span>\n<i class="icon code" title="\u67e5\u770bhtml" >\n</i>\n</div>\n<div class="ui icon button wechat_button">\n<span class="icon_tip">\u590d\u5236\u5230\u5fae\u4fe1\u516c\u4f17\u53f7</span>\n<i class="icon wechat" title="\u590d\u5236\u5230\u5fae\u4fe1\u516c\u4f17\u53f7" >\n</i>\n</div>\n<div class="ui icon dropdown button style_button">\n<span class="icon_tip">\u9884\u89c8\u4e3b\u9898\u6837\u5f0f</span>\n<i class="icon theme" title="\u9884\u89c8\u4e3b\u9898\u6837\u5f0f" >\n</i>\n<div class="menu">\n</div>\n</div>\n<div class="ui icon button camera_button">\n<span class="icon_tip">\u62cd\u7167\u622a\u56fe</span>\n<i class="camera retro icon" title="\u62cd\u7167" >\n</i>\n</div>\n<div class="icon dropdown ui icon button preview_type_button">\n<span class="icon_tip">\u5207\u6362\u9884\u89c8\u6a21\u5f0f</span>\n<i class="icon desktop icon" title="\u9884\u89c8\u6a21\u5f0f" >\n</i>\n<div class="menu">\n<div class="item" data-value="normal">\n<i class="file text outline icon"></i><span >\u666e\u901a\u9884\u89c8</span></div>\n<div class="item" data-value="presetation">\n<i class="file powerpoint outline icon"></i><span >ppt\u9884\u89c8</span></div>\n<div class="item" data-value="pdf">\n<i class="file pdf outline icon"></i><span >pdf\u9884\u89c8</span></div>\n</div>\n</div>\n<div class="icon dropdown ui icon button preview_layout_button">\n<span class="icon_tip">\u5207\u6362\u9884\u89c8\u5e03\u5c40</span>\n<i class="block layout icon" title="\u9884\u89c8\u5e03\u5c40" >\n</i>\n<div class="menu">\n<div class="item" data-value="north">\n<i class="arrow circle alternate outline up icon"></i><span >\u4e0a</span></div>\n<div class="item" data-value="east">\n<i class="arrow circle alternate outline right icon"></i><span >\u53f3</span></div>\n<div class="item" data-value="south">\n<i class="arrow circle alternate outline down icon"></i><span >\u4e0b</span></div>\n<div class="item" data-value="west">\n<i class="arrow circle alternate outline left icon"></i><span >\u5de6</span></div>\n<div class="item" data-value="free">\n<i class="map  icon"></i><span >\u6d6e\u52a8</span></div>\n<div class="item" data-value="external">\n<i class="clone icon"></i><span >\u7a97\u53e3</span></div>\n</div>\n</div>\n<div class="ui icon button pdf_refresh_button hide">\n<span class="icon_tip">\u91cd\u65b0\u751f\u6210\uff30\uff24\uff26</span>\n<i class="icon refresh" title="\u91cd\u65b0\u751f\u6210pdf" >\n</i>\n</div>\n<div class="ui icon button presetation_toc_button hide">\n<span class="icon_tip">\uff30\uff30\uff34\u5927\u7eb2</span>\n<i class="icon content" title="ppt\u5927\u7eb2" >\n</i>\n</div>\n<div class="ui icon button ppt_multiplex_button hide">\n<span class="icon_tip">\uff30\uff30\uff34\u591a\u5c4f\u6f14\u793a</span>\n<i class="icon play" title="multiplex">\n</i>\n</div>\n<div class="ui icon button line_button">\n<span class="icon_tip">\u5f00\u542f\u5bf9\u7167\u6a21\u5f0f</span>\n<i class="icon random" title="\u5f00\u542fsourceMap" >\n</i>\n</div>\n<div class="toc_button_placeholder ui icon button toc_button">\n<span class="icon_tip">\u6587\u6863\u5927\u7eb2</span>\n<i class="icon content" title="\u6587\u6863\u5927\u7eb2"></i>\n</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/preview_buttons_config":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){var o;return'<span class="icon_tip">\u4fee\u6539\u9884\u89c8\u914d\u7f6e</span>\n<i class="icon cog" title="\u4fee\u6539\u9884\u89c8\u914d\u7f6e" >\n</i>\n<div class="menu">\n<div class="item preview_viewport_size_item">\u754c\u9762\u5927\u5c0f:\n<select class="preview_viewport_size_select">\n<option value=""></option>\n</select>\n<div class="ui input transparent" style="border-bottom: 1px dotted">\n<input type="text" class="preview_viewport_size_input" placeholder="">\n</div>\n</div>\n<div class="item preview_viewport_align_item">\u754c\u9762\u5bf9\u9f50:\n<select class="preview_viewport_align_select">\n<option value=""></option>\n<option value="center">\u5c45\u4e2d</option>\n<option value="left">\u9760\u5de6</option>\n<option value="right">\u9760\u53f3</option>\n</select>\n</div>\n\n<div class="item">\n<div class="ui form">\n<div class="inline field">\n<div class="ui checkbox">\n<input type="checkbox" name="minimap" '+e.escapeExpression("function"==typeof(o=null!=(o=n.minimap||(null!=t?t.minimap:t))?o:n.helperMissing)?o.call(null!=t?t:e.nullContext||{},{name:"minimap",hash:{},data:r}):o)+'>\n<label for="minimap" >\u5c0f\u5730\u56feminimap\u6eda\u52a8\u6761</label>\n</div>\n</div>\n</div>\n</div>\n\n\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/preview_center":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<div class="preview_center_wrapper main_content_wrapper">\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/preview_center_buttons":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<div class="ui icon vertical buttons preview_center_buttons_wrapper animation_icon_tips mini">\n<div class="ui icon button zen_button">\n<span class="icon_tip">\u9000\u51fa\u5168\u5c4f\u9605\u8bfb\u6a21\u5f0f</span>\n<i class="icon compress" title="\u9000\u51fa\u9605\u8bfb\u6a21\u5f0f">\n</i>\n</div>\n<div class="preview_config_button_placeholder">\n</div>\n<div class="ui icon button presetation_toc_button">\n<span class="icon_tip">\u5927\u7eb2</span>\n<i class="icon content" title="ppt\u5927\u7eb2" ></i>\n</div>\n<div class="toc_button_placeholder"></div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/preview_center_minimap":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<div class="scroller__canvas">\n</div>\n<div class="g-unselectable scroller__handle"></div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/preview_control_buttons":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<div class="ui icon buttons vertical">\n<div class="ui circular_button sync_scroll_preview_button"><i class="arrow alternate circle outline right icon" title="\u540c\u6b65\u6eda\u52a8\u9884\u89c8\u533a"></i></div>\n<div class="ui circular_button sync_scroll_editor_button"><i class="arrow alternate circle outline left icon" title="\u540c\u6b65\u6eda\u52a8\u7f16\u8f91\u533a"></i></div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/preview_free_layout_dialog":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<div class="ui top attached label preview_layout_header draggable_dialog_header">\n<i class="icon header_opacity_button header_button wizard" title="\u6253\u5f00\u900f\u660e\u6548\u679c"></i>\n<i class="icon header_background_button header_button film" title="\u9884\u89c8\u5c42\u6c34\u5370\u6548\u679c"></i>\n<i class="icon header_rotate_button header_button repeat" title="\u65cb\u8f6c"></i>\n<i class="icon reset_rotate_button header_button remove" title="\u91cd\u7f6e" style="display:none;"></i>\n<i class="icon minus header_button header_state_button" title="\u6700\u5c0f\u5316"></i>\n<label class="background_dialog_tip"> \u5728\u975e\u7f16\u8f91\u533a\u6309 ctrl+shift+[ \u9000\u51fa\u6c34\u5370\u6548\u679c </label>\n</div>\n<div class="draggable_dialog_content preview_layout_content main_preview">\n<div class="ui dimmer inverted"></div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/preview_server_control":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<div class="ui segment" style="height: 100%;">\n<div style="text-align:center;">\n<div class="ui buttons">\n<div class="ui button stop_button" >\u505c\u6b62</div>\n<div class="ui button refresh_button" >\u91cd\u65b0\u90e8\u7f72</div>\n</div>\n</div>\n<div class="server_info" style="display:none;">\n<div class="ui simple divider"></div>\n<div class="ui pointing below label">\n<a id="master_url" href="" target="_blank" >\u6f14\u8bb2\u8005\u5730\u5740</a>\n</div>\n<div class="ui fluid icon input">\n<input type="text" name="master" id="master_url_input" value=""/>\n<i class="icon linkify"></i>\n</div>\n<div class="ui simple divider"></div>\n<div class="ui pointing below label">\n<a href="" id="client_url" target="_blank" >\u89c2\u770b\u8005\u5730\u5740</a>\n</div>\n<div class="ui fluid icon input">\n<input type="text" name="client" id="client_url_input" value=""/>\n<i class="icon linkify"></i>\n</div>\n</div>\n</div>\n<div class="ui dimmer" style="display:none;">\n<div class="ui large text loader" >\u5904\u7406\u4e2d...</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/preview_viewer_manager_view":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return"\n"},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/preview_viewer_view":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return"\n"},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/public_email_dialog":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<i class="close icon"></i>\n<div class="header" >\u53d1\u9001\u90ae\u4ef6</div>\n<div class="content story_content">\n<form class="ui form">\n<div class="field">\n<div style="float:right">\n<input type="checkbox" name="separateTo"/> \u5206\u5f00\u53d1\u9001\n</div>\n<label for="email">\u6536\u4ef6\u4eba</label>\n<div class="ui fluid icon input">\n<input type="text" name="email" placeholder="\u8bf7\u5728\u8fd9\u91cc\u8f93\u5165\u90ae\u4ef6\u5730\u5740, \u591a\u4e2a\u90ae\u4ef6\u5730\u5740\u7528\u9017\u53f7\u5206\u5f00"\n>\n<i class="mail outline icon"></i>\n</div>\n</div>\n<div class="field cc_email_container">\n<label for="ccEmail">\u6284\u9001</label>\n<div class="ui fluid icon input">\n<input type="text" name="ccEmail" placeholder="\u8bf7\u5728\u8fd9\u91cc\u8f93\u5165\u90ae\u4ef6\u5730\u5740, \u591a\u4e2a\u90ae\u4ef6\u5730\u5740\u7528\u9017\u53f7\u5206\u5f00"\n>\n<i class="mail outline icon"></i>\n</div>\n</div>\n<div class="field bcc_email_container">\n<label for="bccEmail">\u5bc6\u7801\u6284\u9001</label>\n<div class="ui fluid icon input">\n<input type="text" name="bccEmail" placeholder="\u8bf7\u5728\u8fd9\u91cc\u8f93\u5165\u90ae\u4ef6\u5730\u5740, \u591a\u4e2a\u90ae\u4ef6\u5730\u5740\u7528\u9017\u53f7\u5206\u5f00"\n>\n<i class="mail outline icon"></i>\n</div>\n</div>\n<div class="inline field">\n<label for="subject" >\u90ae\u4ef6\u6807\u9898</label>\n<input type="text" name="subject">\n</div>\n<div class="inline fields">\n<label for="mainBody" >\u6b63\u6587\u5185\u5bb9</label>\n<div class="field">\n<div class="ui radio">\n<input type="radio" name="mainBody" value="user">\n<label >\u7528\u6237\u81ea\u5b9a\u4e49</label>\n</div>\n</div>\n<div class="field">\n<div class="ui radio">\n<input type="radio" name="mainBody" value="preview" checked>\n<label >\u6e32\u67d3\u540e\u7684\u6587\u7ae0</label>\n</div>\n</div>\n<div class="field">\n<div class="ui radio">\n<input type="radio" name="mainBody" value="markdown">\n<label >markdown\u6587\u7ae0</label>\n</div>\n</div>\n<div class="field">\n<div class="ui radio">\n<input type="radio" name="mainBody" value="png">\n<label >\u6e32\u67d3\u540e\u7684\u56fe\u7247</label>\n</div>\n</div>\n</div>\n<div class="ui fluid field user_main_body_container hide">\n<label for="userMainBody" >\u6b63\u6587\u5185\u5bb9</label>\n<textarea name="userMainBody"></textarea>\n</div>\n<div class="inline field">\n<label for="numberedHeading" >\u662f\u5426\u5f3a\u5236\u5185\u5bb9\u6807\u9898\u81ea\u52a8\u7f16\u53f7(\u4ec5\u5728\u90ae\u4ef6\u6b63\u6587\u9009\u62e9`\u6e32\u67d3\u540e\u7684\u6587\u7ae0`\u6709\u6548)</label>\n<input type="checkbox" name="numberedHeading">\n</div>\n<div class="inline field">\n<label for="attachmentMarkdown" >\u6dfb\u52a0markdown\u6587\u7ae0\u4f5c\u4e3a\u9644\u4ef6</label>\n<input type="checkbox" name="attachmentMarkdown">\n</div>\n<div class="inline field">\n<label for="attachmentPreview" >\u6dfb\u52a0\u6e32\u67d3\u540e\u7684\u6587\u7ae0\u4f5c\u4e3a\u9644\u4ef6</label>\n<input type="checkbox" name="attachmentPreview">\n</div>\n<div class="inline field">\n<label for="attachmentPng" >\u6dfb\u52a0\u6e32\u67d3\u540e\u7684\u56fe\u7247\u4f5c\u4e3a\u9644\u4ef6</label>\n<input type="checkbox" name="attachmentPng">\n</div>\n<div class="ui error message"></div>\n</form>\n<div class="ui  segment">\n<div class="more_attachments"></div>\n<div style="display: none;"><input type="file" multiple="" name="fileData" class="form-control"></div>\n<p class="drop-zone" >\u8ffd\u52a0\u66f4\u591a\u9644\u4ef6</p>\n</div>\n</div>\n<div class="actions">\n<div class="ui cancel button" >\n\u53d6\u6d88\n</div>\n<div class="ui positive button">\n<span >\u53d1\u9001</span>\n</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/public_file_dialog":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<i class="close icon"></i>\n<div class="header">\n\u9009\u62e9\u8981\u53d1\u5e03\u5230\u7684\u7b2c\u4e09\u65b9\u535a\u5ba2\u7cfb\u7edf\n</div>\n<div class="content">\n<div class="ui cards">\n</div>\n</div>\n<div class="actions">\n<div class="ui cancel button">\n\u5173\u95ed\n</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/pwa_install_dialog":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){var o,a=null!=t?t:e.nullContext||{},s=n.helperMissing,l=e.escapeExpression;return'<div class="header" >\n'+l("function"==typeof(o=null!=(o=n.installLabel||(null!=t?t.installLabel:t))?o:s)?o.call(a,{name:"installLabel",hash:{},data:r}):o)+'\u5c0f\u4e66\u5320\n</div>\n<div class="content image">\n<div class="ui small image">\n<img src="./img/avatar_d_256x256.png">\n</div>\n<div class="description">\n<div class="ui header" >\u611f\u8c22\u4f7f\u7528\u5c0f\u4e66\u5320</div>\n<p><span >\u7248\u672c:</span> '+l("function"==typeof(o=null!=(o=n.appVersion||(null!=t?t.appVersion:t))?o:s)?o.call(a,{name:"appVersion",hash:{},data:r}):o)+'</p>\n<p class="description"></p>\n<div class="ui progress">\n<div class="bar">\n<div class="progress"></div>\n</div>\n<div class="label install_info_label" style="overflow: hidden;white-space: nowrap;text-overflow: ellipsis;">'+l("function"==typeof(o=null!=(o=n.installLabel||(null!=t?t.installLabel:t))?o:s)?o.call(a,{name:"installLabel",hash:{},data:r}):o)+'\u4e2d...</div>\n</div>\n</div>\n</div>\n<div class="actions">\n<div class="ui positive right button loading disabled" >\n\u5173\u95ed\n</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/save_all_unsync_dialog":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<i class="close icon"></i>\n<div class="header">\u8fd8\u672a\u540c\u6b65\u4fdd\u5b58\u5230\u7b2c\u4e09\u5b58\u50a8\u7684\u6587\u7ae0</div>\n<div class="content story_content">\n<table class="ui table">\n<tbody>\n</tbody>\n</table>\n</div>\n<div class="actions">\n<div class="ui cancel button">\u53d6\u6d88</div>\n<div class="ui positive button">\u5f00\u59cb\u540c\u6b65</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/save_as_dialog":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<i class="close icon"></i>\n<div class="header" >\n\u9009\u62e9\u8981\u4fdd\u5b58\u7684\u4f4d\u7f6e\n</div>\n<div class="content story_content">\n<div class="ui cards">\n</div>\n</div>\n<div class="actions">\n<div class="tips">\n<a href="javascript:void(0);" class="save_as_template_button">\u4fdd\u5b58\u4e3a\u6a21\u677f</a>\n</div>\n<div class="ui positive button" >\n\u5173\u95ed\n</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/save_new_dialog":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<i class="close icon"></i>\n<div class="header" >\n\u9009\u62e9\u8981\u4fdd\u5b58\u7684\u4f4d\u7f6e\n</div>\n<div class="content story_content">\n<div class="ui form sticky">\n<div class="field">\n<div class="ui fluid labeled icon input">\n<div class="ui label parent_path">/</div>\n<input type="text" name="filename" placeholder="\u6587\u4ef6\u540d\u79f0">\n<i class="file outline icon"></i>\n</div>\n</div>\n<div class="ui error message"></div>\n</div>\n</div>\n<div class="actions">\n<div class="tips">\n<a href="javascript:void(0);" class="change_store_button" >\u9009\u62e9\u5176\u4ed6\u7ed1\u5b9a</a>\n</div>\n<i class="icon filter filter_button link"></i>\n\n<div class="ui checkbox filter_checkbox_wrapper" style="display:none">\n<input type="checkbox" name="hideMode" checked>\n<label>\u9690\u85cf\u4e0d\u5339\u914d\u6587\u7ae0</label>\n</div>\n<div class="ui input search_input_wrapper icon">\n<i class="circle remove icon link close_search_input_wrapper" title="\u5173\u95ed\u5feb\u901f\u67e5\u8be2"></i>\n<input type="text" placeholder="\u8fc7\u6ee4\u5185\u5bb9,\u652f\u6301 `/` \u76ee\u5f55\u5206\u7ea7..." class="search_input"/>\n<i class="circular search link icon search_file"></i>\n</div>\n<div class="ui cancel button" >\n\u53d6\u6d88\n</div>\n<div class="ui positive button" >\n\u786e\u5b9a\n</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/search_store_files_view":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<div class="search_store_files_home">\n<div class="list_searchs"></div>\n<div class="ui search">\n<div class="ui icon input">\n<input class="prompt search_store_input" type="text" placeholder="\u8f93\u5165\u8981\u67e5\u627e\u7684\u5185\u5bb9" name="home_query_word">\n<i class="search icon search_store_button circular link"></i>\n</div>\n</div>\n</div>\n<div class="search_store_files_list" style="display:none">\n<div class="ui search mini" style="display: flex;margin: .3em;">\n<div class="ui icon input mini" style="flex:1;">\n<input class="search_store_input" type="text" placeholder="\u8f93\u5165\u8981\u67e5\u627e\u7684\u5185\u5bb9" name="list_query_word">\n<i class="search icon search_store_button circular link"></i>\n</div>\n<i class="plus icon create_search_button link circular_icon"></i>\n<i class="reply all icon return_home_button link circular_icon"></i>\n</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/select_files_document_manager_dialog":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<div class="ui items select_files_items"></div>\n<div class="ui segment blank_html">\n<h2 class="ui header aligned center icon green">\n<i class="smile icon"></i>\n<div class="sub header">\u6ca1\u6709\u627e\u5230\u4f60\u60f3\u8981\u7684\u6587\u4ef6</div>\n</h2>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/select_files_manager_dialog":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<i class="close icon"></i>\n<div class="seven item tabular ui menu attached story_header">\n<a class="active item" data-tab="document" >\n\u9009\u62e9\u8981\u5bfc\u51fa\u7684\u6587\u4ef6\n</a>\n<a class="item" data-tab="setting" >\n\u8bbe\u7f6e\n</a>\n</div>\n<div class="content story_content">\n<div class="ui active tab document_tab" data-tab="document">\n</div>\n<div class="ui tab setting_tab" data-tab="setting">\n<div class="ui segment basic">\n<div class="ui form">\n<div class="field inline">\n<label>\u6587\u4ef6\u540d\u79f0\u89c4\u5219:</label>\n<select class="ui dropdown filename-pattern-selector">\n<option value="default">#{title}</option>\n<option value="timestamp">#{timestamp}-#{title}</option>\n<option value="id">#{title}-#{id}-#{timestamp}</option>\n</select>\n</div>\n</div>\n</div>\n</div>\n<div class="selected_files_placeholder">\n</div>\n</div>\n<div class="actions">\n<div class="search_type_check ui button icon mini">\n<i class="icon search"></i>\n</div>\n<div class="ui mini icon input search_container" style="display:none;">\n<i class="circle remove icon link clean_search_input_wrapper blank" title="\u6e05\u7a7a\u67e5\u8be2"></i>\n<input type="text" placeholder="\u641c\u7d22..." class="search_input">\n<i class="circular search link icon search_button"></i>\n</div>\n<div class=\'dropdown_tag_name_placeholder\'>\n</div>\n<div class="ui basic return button return_export_button" >\n\u8fd4\u56de\n</div>\n<div class="ui basic button batch_export_button" >\n\u5bfc\u51fa\n</div>\n<div class="ui basic button cancel_batch_export_button" >\n\u53d6\u6d88\u5bfc\u51fa\n</div>\n<div class="ui basic cancel button" >\n\u5173\u95ed\n</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/select_files_manager_for_batch_dialog":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<i class="close icon"></i>\n<div class="seven item tabular ui menu attached story_header">\n<a class="active item" data-tab="document" >\n\u9009\u62e9\u6587\u4ef6\n</a>\n</div>\n<div class="content story_content">\n<div class="ui active tab document_tab" data-tab="document">\n</div>\n<div class="selected_files_placeholder">\n</div>\n</div>\n<div class="actions">\n<div class="search_type_check ui button icon mini">\n<i class="icon search"></i>\n</div>\n<div class="ui mini icon input search_container" style="display: none;">\n<i class="circle remove icon link clean_search_input_wrapper blank" title="\u6e05\u7a7a\u67e5\u8be2"></i>\n<input type="text" placeholder="\u641c\u7d22..." class="search_input">\n<i class="circular search link icon search_button"></i>\n</div>\n<div class=\'dropdown_tag_name_placeholder\'>\n</div>\n<div class="ui basic return button return_button" >\n\u8fd4\u56de\n</div>\n<div class="ui basic button selected_button" >\n\u786e\u5b9a\n</div>\n<div class="ui basic cancel button" >\n\u5173\u95ed\n</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/selected_files_dialog":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<div class="ui top attached label selected_files_header">\n\u5df2\u7ecf\u9009\u62e9\u7684\u6587\u4ef6\n</div>\n<div class="selected_files_content">\n<table class="ui table selected_files_table">\n<thead>\n<tr>\n<th class="right aligned total_selected_files_count"></th>\n<th class="header_title">\u6587\u4ef6\u540d\u79f0</th>\n<th class="right aligned">\n<i class="large times circle icon delete_button link" title="\u5220\u9664"></i>\n</th>\n</tr>\n</thead>\n<tbody>\n</tbody>\n</table>\n<div class="ui segment blank_html">\n<h2 class="ui header aligned center icon">\n<i class="smile icon"></i>\n<div class="sub header">\u60a8\u8fd8\u6ca1\u6709\u9009\u62e9\u8981\u64cd\u4f5c\u7684\u6587\u4ef6</div>\n</h2>\n<div class="ui primary button icon fluid select_direct_files_btn">\n<i class="fas fa-bezier-curve icon">\n</i>\n\u9009\u62e9\u5f53\u524d\u6587\u7ae0\u5f15\u7528\u7684\u6240\u6709\u6587\u7ae0</div>\n</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/set_persist_group_dialog":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<i class="close icon"></i>\n<div class="header">\u56fa\u5b9a\u7ec4\u8bbe\u7f6e</div>\n<div class="content story_content">\n<form class="ui form">\n<div class="inline field">\n<label for="icon">\u56fe\u6807</label>\n<i class="fas fa-star fa-fw icon_result" style="font-size:3em;vertical-align: bottom;"></i>\n<div class="ui dropdown icon pointing button persist_group_icon_dropdown">\n<i class="icon dropdown"></i>\n<span class="text">\n<i class="fas fa-star fa-fw"></i>\n</span>\n<div class="menu">\n<div class="ui search icon input">\n<i class="search icon"></i>\n<input type="text" name="search" placeholder="\u67e5\u627e\u56fe\u6807...">\n</div>\n<div class="scrolling menu xsj_patch_menu">\n</div>\n</div>\n</div>\n</div>\n<div class="field">\n<label for="name">\u663e\u793a\u540d\u79f0</label>\n<div class="ui fluid input">\n<input type="text" name="name" placeholder="">\n</div>\n</div>\n<div class="inline fields">\n<label for="baseColorType">\u9009\u62e9\u989c\u8272</label>\n<div class="field" style="margin: 0 0.5em;padding: 0.2em 0.2em; background: var(--base08)">\n<div class="ui radio">\n<input type="radio" name="baseColorType" value="base08">\n<label></label>\n</div>\n</div>\n<div class="field" style="margin: 0 0.5em;padding: 0.2em 0.2em; background: var(--base09)">\n<div class="ui radio">\n<input type="radio" name="baseColorType" value="base09">\n<label></label>\n</div>\n</div>\n<div class="field" style="margin: 0 0.5em;padding: 0.2em 0.2em; background: var(--base0A)">\n<div class="ui radio">\n<input type="radio" name="baseColorType" value="base0A">\n<label></label>\n</div>\n</div>\n<div class="field" style="margin: 0 0.5em;padding: 0.2em 0.2em; background: var(--base0B)">\n<div class="ui radio">\n<input type="radio" name="baseColorType" value="base0B">\n<label></label>\n</div>\n</div>\n<div class="field" style="margin: 0 0.5em;padding: 0.2em 0.2em; background: var(--base0C)">\n<div class="ui radio">\n<input type="radio" name="baseColorType" value="base0C">\n<label></label>\n</div>\n</div>\n<div class="field" style="margin: 0 0.5em;padding: 0.2em 0.2em; background: var(--base0D)">\n<div class="ui radio">\n<input type="radio" name="baseColorType" value="base0D">\n<label></label>\n</div>\n</div>\n<div class="field" style="margin: 0 0.5em;padding: 0.2em 0.2em; background: var(--base0F)">\n<div class="ui radio">\n<input type="radio" name="baseColorType" value="base0F">\n<label></label>\n</div>\n</div>\n<div class="field" style="margin: 0 0.5em;padding: 0.2em 0.2em; background: var(--base0E)">\n<div class="ui radio">\n<input type="radio" name="baseColorType" value="base0E">\n<label></label>\n</div>\n</div>\n<div class="field">\n<div class="ui button select_color_btn">\u5176\u4ed6\u989c\u8272</div>\n</div>\n</div>\n\n<div class="field">\n<label for="groupColorValue">\u989c\u8272</label>\n<div class="ui fluid input">\n<div class="ui tag label color_select_result" style="color: white; background: var(--base0A);">\u663e\u793a\u6548\u679c</div>\n<input type="hidden" name="groupColorValue" placeholder="">\n</div>\n</div>\n<div class="ui error message"></div>\n</form>\n</div>\n<div class="actions">\n<div class="tips">\n</div>\n<div class="ui cancel button" >\n\u53d6\u6d88\n</div>\n<div class="ui positive button">\n<span>\u4fdd\u5b58</span>\n</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/settings":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<i class="close icon"></i>\n<div class="nine item tabular ui menu attached story_header">\n<a class="active item" data-tab="basic" >\n\u57fa\u672c\n</a>\n<a class="item" data-tab="tag" >\n\u6807\u7b7e\n</a>\n<a class="item network" data-tab="network" style="display:none;">\n\u7f51\u7edc\n</a>\n<a class="item" data-tab="editor" >\n\u7f16\u8f91\u5668\n</a>\n<a class="item" data-tab="preview" >\n\u9884\u89c8\n</a>\n<a class="item" data-tab="grammar" >\n\u8bed\u6cd5\u6269\u5c55\n</a>\n</div>\n<div class="content story_content">\n<div class="ui active tab segment settings_basic_tab" data-tab="basic">\n</div>\n<div class="ui tab segment settings_tag_tab" data-tab="tag">\n</div>\n<div class="ui tab segment settings_network_tab" data-tab="network">\n</div>\n<div class="ui tab segment settings_fullscreen_tab" data-tab="fullscreen">\n</div>\n<div class="ui tab segment settings_editor_tab" data-tab="editor">\n</div>\n<div class="ui tab segment settings_preview_tab" data-tab="preview">\n</div>\n<div class="ui tab segment settings_grammar_tab" data-tab="grammar">\n</div>\n<div class="ui tab segment" data-tab="advanced">\n<div class="ui form">\n<div class="inline field">\n<label></label>\n</div>\n</div>\n</div>\n<div class="ui bottom attached tab segment" data-tab="previewx">\n<p>\u9009\u62e9\u4e00\u4e2a\u5df2\u7ecf\u6dfb\u52a0\u7684\u56fe\u7247</p>\n<div class="image_gallery">\n<div class="ui cards"></div>\n</div>\n</div>\n<div class="ui bottom attached tab segment" data-tab="other">\n<p>\u9009\u62e9\u4e00\u4e2a\u5df2\u7ecf\u6dfb\u52a0\u7684\u56fe\u7247</p>\n<div class="image_gallery">\n<div class="ui cards"></div>\n</div>\n</div>\n</div>\n<div class="actions">\n<div class="ui cancel button" >\n\u53d6\u6d88\n</div>\n<div class="ui ok button">\n<span >\u5e94\u7528</span>\n</div>\n<div class="ui positive button">\n<span >\u786e\u5b9a</span>\n</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/settings_basic":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){var o,a=null!=t?t:e.nullContext||{},s=n.helperMissing,l="function",c=e.escapeExpression;return'<div class="ui raised segment normal_basic_setting">\n<a href="javascript:void(0);" class="ui ribbon label" >\u5e38\u89c4</a>\n<div class="inline field">\n<label for="bodyFonts" >\u5b57\u4f53(\u5bfc\u822a\u680f\uff0c\u5f39\u7a97\u7b49)</label>\n<div class="ui fluid input">\n<input type="text" placeholder="\'Helvetica Neue\', Helvetica, Arial, sans-serif" name="bodyFonts"\nvalue="'+c(typeof(o=null!=(o=n.bodyFonts||(null!=t?t.bodyFonts:t))?o:s)===l?o.call(a,{name:"bodyFonts",hash:{},data:r}):o)+'">\n</div>\n</div>\n<div class="ui fluid field">\n<label for="bodyCss" >\u5168\u5c40\u81ea\u5b9a\u4e49\u6837\u5f0f(\u5efa\u8bae\u719f\u6089 css \u6837\u5f0f\u7684\u7528\u6237\u4f7f\u7528)</label>\n<textarea name="bodyCss"></textarea>\n</div>\n<div class="inline fields display_client_block">\n<label for="clientTitleBarCloseBehavior"\n>\u70b9\u51fb\u5173\u95ed\u6309\u94ae\u540e</label>\n<div class="field">\n<div class="ui radio checkbox close_behavior_checkbox">\n<input type="radio" name="close_behavior" value="default" '+c(typeof(o=null!=(o=n.closeBehaviorDefaultChecked||(null!=t?t.closeBehaviorDefaultChecked:t))?o:s)===l?o.call(a,{name:"closeBehaviorDefaultChecked",hash:{},data:r}):o)+'>\n<label>\u5f39\u51fa\u63d0\u793a</label>\n</div>\n</div>\n<div class="field">\n<div class="ui radio checkbox close_behavior_checkbox">\n<input type="radio" name="close_behavior" value="exit" '+c(typeof(o=null!=(o=n.closeBehaviorExitChecked||(null!=t?t.closeBehaviorExitChecked:t))?o:s)===l?o.call(a,{name:"closeBehaviorExitChecked",hash:{},data:r}):o)+'>\n<label>\u76f4\u63a5\u9000\u51fa</label>\n</div>\n</div>\n<div class="field">\n<div class="ui radio checkbox close_behavior_checkbox">\n<input type="radio" name="close_behavior" value="tray" '+c(typeof(o=null!=(o=n.closeBehaviorTrayChecked||(null!=t?t.closeBehaviorTrayChecked:t))?o:s)===l?o.call(a,{name:"closeBehaviorTrayChecked",hash:{},data:r}):o)+'>\n<label>\u6700\u5c0f\u5316\u5230\u7cfb\u7edf\u6258\u76d8</label>\n</div>\n</div>\n</div>\n<div class="inline field protocol_registry_container">\n<label class="display_client" for="protocol-registry" >\u534f\u8bae\u5524\u9192</label>\n<div class="display_client">\n<a class="ui button protocol_registry_button">\n<i class="xiaoshujiang circle alternate outline icon"></i>\n\u5f00\u542f\u534f\u8bae\u5524\u9192\n</a>\n<div class="ui message">\n\u5f00\u542f\u8be5\u529f\u80fd\u540e\uff0c\u53ef\u4ee5\u901a\u8fc7\u534f\u8bae xsjapp:// \u6253\u5f00\u5c0f\u4e66\u5320\u7cfb\u7edf\u5185\u7684\u6587\u7ae0\n</div>\n</div>\n</div>\n<div class="inline field display_client_block">\n<label for="clientResourceRootDir" >\u8d44\u6e90\u7edd\u5bf9\u8def\u5f84\u8d77\u59cb\u5730\u5740</label>\n<div class="ui fluid input">\n<input type="file" nwdirectory class="client_resource_root_file_input"\nvalue="'+c(typeof(o=null!=(o=n.clientResourceRootDir||(null!=t?t.clientResourceRootDir:t))?o:s)===l?o.call(a,{name:"clientResourceRootDir",hash:{},data:r}):o)+'/" style="display:none;">\n<div class="ui action fluid input" style="width: 100%;">\n<input type="text" name="clientResourceRootDir"\nvalue="'+c(typeof(o=null!=(o=n.clientResourceRootDir||(null!=t?t.clientResourceRootDir:t))?o:s)===l?o.call(a,{name:"clientResourceRootDir",hash:{},data:r}):o)+'" style="pointer-events: none;">\n<div class="ui basic button client_resource_root_dir_button">\u9009\u62e9\u76ee\u5f55</div>\n</div>\n</div>\n</div>\n<div class="ui message display_client_block">\n<ul>\n<li>\u672c\u5730\u5ba2\u6237\u7aef\u7684\u8d44\u6e90\uff08\u6bd4\u5982\u56fe\u7247\uff09\uff0c\u5982\u679c\u5730\u5740\u662f\u7edd\u5bf9\u5730\u5740\uff08\u4ee5`/`\u5f00\u5934\u7684\u5730\u5740\uff09\uff0c\u5728\u9884\u89c8\u663e\u793a\u65f6\u5c31\u4ece\u8be5\u5730\u5740\u7b97\u8d77\uff0c\u67e5\u627e\u6307\u5b9a\u7684\u8d44\u6e90</li>\n<li>\u6bd4\u5982\u8be5\u503c\u4e3a`/home/xiaoshujiang/`,\u5728\u6587\u7ae0\u91cc\u6709\u4e00\u4e2a\u56fe\u7247\uff0c\u5730\u5740\u662f`/resource/img/logo.jpg`,\u5219\u5728\u9884\u89c8\u663e\u793a\u65f6\u7cfb\u7edf\u5c31\u4f1a\u81ea\u52a8\u8f6c\u6362\u6210`/home/xiaoshujiang/resource/img/logo.jpg`\u3002</li>\n<li>\u4f46\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u8fd9\u91cc\u4ec5\u4ec5\u662f\u8ba9\u7cfb\u7edf\u627e\u5230\u5bf9\u5e94\u7684\u672c\u5730\u8d44\u6e90\uff0c\u7cfb\u7edf\u5e76\u4e0d\u5b9e\u9645\u628a\u56fe\u7247\u7684\u771f\u5b9e\u5730\u5740\u66ff\u6362\u5230html\u91cc\u3002</li>\n<li>\u9009\u62e9\u4e86\u672c\u5730\u7ed1\u5b9a\u529f\u80fd\uff0c\u5219\u8be5\u8bbe\u7f6e\u5c06\u5931\u6548\uff0c\u6587\u7ae0\u91cc\u7684\u7edd\u5bf9\u5730\u5740\u8d44\u6e90\u5c06\u4ece\u7ed1\u5b9a\u7684\u6839\u76ee\u5f55\u7b97\u8d77\u3002</li>\n<li>\u4e3a\u7a7a\u65f6\uff0c\u7cfb\u7edf\u5c06\u4ece\u5b89\u88c5\u76ee\u5f55\u67e5\u627e\u7b97\u8d77\uff0c\u4f46\u5982\u679c\u6587\u4ef6\u662f\u4ece\u672c\u5730\u5173\u8054\u6253\u5f00\u7684\uff0c\u5219\u4ece\u7cfb\u7edf\u7684\u6839\u76ee\u5f55\u7b97\u8d77\u3002</li>\n</ul>\n</div>\n<div class="inline field">\n<label class="display_client" for="autoCheckNewVersion" >\u81ea\u52a8\u68c0\u6d4b\u65b0\u7248\u672c</label>\n<input class="display_client" type="checkbox" name="autoCheckNewVersion" '+c(typeof(o=null!=(o=n.autoCheckNewVersion||(null!=t?t.autoCheckNewVersion:t))?o:s)===l?o.call(a,{name:"autoCheckNewVersion",hash:{},data:r}):o)+'>\n<div class="display_client">\n<a class="ui label check_new_version_button">\n<i class="xiaoshujiang circle alternate outline icon"></i>\n\u68c0\u6d4b\u5347\u7ea7\n</a>\n</div>\n</div>\n<div class="inline field">\n<label for="syncScrollPreview" >\u540c\u6b65\u6eda\u52a8\u9884\u89c8\u533a</label>\n<input type="checkbox" name="syncScrollPreview" '+c(typeof(o=null!=(o=n.syncScrollPreview||(null!=t?t.syncScrollPreview:t))?o:s)===l?o.call(a,{name:"syncScrollPreview",hash:{},data:r}):o)+'>\n</div>\n<div class="inline field">\n<label for="syncScrollEditor" >\u540c\u6b65\u6eda\u52a8\u7f16\u8f91\u533a</label>\n<input type="checkbox" name="syncScrollEditor" '+c(typeof(o=null!=(o=n.syncScrollEditor||(null!=t?t.syncScrollEditor:t))?o:s)===l?o.call(a,{name:"syncScrollEditor",hash:{},data:r}):o)+'>\n</div>\n<div class="inline field display_client_block">\n<label for="showRandomIdiom" >\u663e\u793a\u968f\u673a\u8c1a\u8bed</label>\n<input type="checkbox" name="showRandomIdiom" '+c(typeof(o=null!=(o=n.showRandomIdiom||(null!=t?t.showRandomIdiom:t))?o:s)===l?o.call(a,{name:"showRandomIdiom",hash:{},data:r}):o)+'>\n</div>\n</div>\n<div class="ui raised segment normal_basic_setting">\n<a href="javascript:void(0);" class="ui ribbon label" >\u9501\u5c4f</a>\n<div class="inline field">\n<label for="lockPassword">\u9501\u5c4f\u5bc6\u7801</label>\n<input type="text" placeholder="" name="lockPassword" value="'+c(typeof(o=null!=(o=n.lockPassword||(null!=t?t.lockPassword:t))?o:s)===l?o.call(a,{name:"lockPassword",hash:{},data:r}):o)+'">\n</div>\n<div class="inline fields">\n<div class="inline field">\n<span >\u81ea\u52a8\u9501\u5c4f</span>\n<input type="checkbox" name="autoLock" '+c(typeof(o=null!=(o=n.autoLockChecked||(null!=t?t.autoLockChecked:t))?o:s)===l?o.call(a,{name:"autoLockChecked",hash:{},data:r}):o)+'>\n</div>\n<div class="inline field">\n<span >\u8d85\u65f6\u65f6\u95f4(\u5355\u4f4d\u5206\u949f, \u8303\u56f4\u5728 5 \u5206\u949f\u5230 24 * 60 \u5206\u949f\u5185 )\uff1a</span>\n<input type="text" placeholder="" name="lockTimeout" value="'+c(typeof(o=null!=(o=n.lockTimeout||(null!=t?t.lockTimeout:t))?o:s)===l?o.call(a,{name:"lockTimeout",hash:{},data:r}):o)+'">\n</div>\n</div>\n<div class="inline field">\n<span >\u542f\u52a8\u5e94\u7528\u65f6\u5c31\u8fdb\u5165\u9501\u5c4f\u72b6\u6001</span>\n<input type="checkbox" name="lockWithStart" '+c(typeof(o=null!=(o=n.lockWithStartChecked||(null!=t?t.lockWithStartChecked:t))?o:s)===l?o.call(a,{name:"lockWithStartChecked",hash:{},data:r}):o)+'>\n</div>\n</div>\n\n<div class="ui raised segment resource_basic_setting">\n<a href="javascript:void(0);" class="ui ribbon label"\n>\u8d44\u6e90\u8def\u5f84</a>\n<div class="inline field">\n<label for="assetPath" ><span >\u8d44\u6e90\u540d\u79f0</span>\n<i class="lightbulb outline icon" title="\u5143\u6570\u636e\u6807\u8bc6: assetPath"></i>\n</label>\n<div class="ui fluid input">\n<input type="text" placeholder="images/{{filename}}" name="assetPath" value="">\n</div>\n</div>\n<div class="ui message">\n<ul>\n<li>/folder/{{year}}/{{month}}/{{date}}/{{filename}}</li>\n<li>\u652f\u6301\u53d8\u91cf year, month, date, title, filename, basename, extname, md5</li>\n<li>\u751f\u6210\u7684\u6587\u4ef6\u8def\u5f84\u7ed3\u5c3e\u6ca1\u6709\u6269\u5c55\u540d,\u7cfb\u7edf\u5c06\u81ea\u52a8\u6dfb\u52a0\u76f8\u5e94\u7684\u6269\u5c55\u540d</li>\n</ul>\n</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/settings_editor":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){var o,a=null!=t?t:e.nullContext||{},s=n.helperMissing,l="function",c=e.escapeExpression;return'<div class="ui raised segment normal_editor_setting">\n<a href="javascript:void(0);" class="ui ribbon label" >\u901a\u7528\u8bbe\u7f6e</a>\n<div class="inline field">\n<label for="editorFonts" >\u7f16\u8f91\u5668\u5b57\u4f53</label>\n<div class="ui fluid input">\n<input type="text" placeholder="\'Monaco\', \'Menlo\', \'Ubuntu Mono\', \'Consolas\', \'source-code -pro\', \'Courier\',\n\'Lucida Console\', monospace" name="editorFonts" value="'+c(typeof(o=null!=(o=n.editorFonts||(null!=t?t.editorFonts:t))?o:s)===l?o.call(a,{name:"editorFonts",hash:{},data:r}):o)+'">\n</div>\n</div>\n<div class="inline field">\n<label for="editorFontSize" >\u7f16\u8f91\u5668\u5b57\u4f53\u5927\u5c0f</label>\n<div class="ui fluid input">\n<input type="text" placeholder="12" name="editorFontSize" value="'+c(typeof(o=null!=(o=n.editorFontSize||(null!=t?t.editorFontSize:t))?o:s)===l?o.call(a,{name:"editorFontSize",hash:{},data:r}):o)+'">\n</div>\n</div>\n<div class="inline field">\n<label for="lineHeight" >\u884c\u9ad8</label>\n<div class="ui fluid input">\n<input type="text" placeholder="1" name="lineHeight" value="'+c(typeof(o=null!=(o=n.lineHeight||(null!=t?t.lineHeight:t))?o:s)===l?o.call(a,{name:"lineHeight",hash:{},data:r}):o)+'">\n</div>\n</div>\n<div class="inline fields">\n<label for="pastePlainFileMode" >\u62d6\u62fd\u7eaf\u6587\u672c\u6587\u4ef6\u5230\u7f16\u8f91\u5668\u884c\u4e3a</label>\n<div class="field">\n<div class="ui radio checkbox">\n<input type="radio" name="pastePlainFileMode" value="appendAttachment">\n<label >\u8ffd\u52a0\u4e3a\u9644\u4ef6</label>\n</div>\n</div>\n<div class="field">\n<div class="ui radio checkbox">\n<input type="radio" name="pastePlainFileMode" value="newFile">\n<label >\u521b\u5efa\u65b0\u7684 markdown \u6587\u4ef6</label>\n</div>\n</div>\n<div class="field">\n<div class="ui radio checkbox">\n<input type="radio" name="pastePlainFileMode" value="appendText">\n<label >\u5c06\u6587\u672c\u8ffd\u52a0\u5230\u5f53\u524d\u5149\u6807\u5904</label>\n</div>\n</div>\n</div>\n</div>\n<div class="ui raised segment codemirror_editor_setting">\n<a href="javascript:void(0);" class="ui ribbon label"\n>codemirror</a>\n<div class="inline fields">\n<label for="cm_keyBindings" >\u952e\u76d8\u6a21\u5f0f</label>\n<div class="field">\n<div class="ui radio checkbox">\n<input type="radio" name="cm_keyBindings" value="default">\n<label >default</label>\n</div>\n</div>\n<div class="field">\n<div class="ui radio checkbox">\n<input type="radio" name="cm_keyBindings" value="vim">\n<label >vim</label>\n</div>\n</div>\n<div class="field">\n<div class="ui radio checkbox">\n<input type="radio" name="cm_keyBindings" value="emacs">\n<label >emacs</label>\n</div>\n</div>\n<div class="field">\n<div class="ui radio checkbox">\n<input type="radio" name="cm_keyBindings" value="sublime">\n<label >sublime</label>\n</div>\n</div>\n</div>\n<div class="inline field">\n<label for="cm_inputOffsetTop" >\u8f93\u5165\u6cd5\u5f39\u51fa\u6846\u8ddd\u79bb\u5149\u6807\u4f4d\u7f6e(\u9ed8\u8ba4\u4e3a0,\u53ea\u80fd\u4e3a\u6b63\u6574\u6570)</label>\n<div class="ui fluid input">\n<input type="text" placeholder="0" name="cm_inputOffsetTop" value="'+c(typeof(o=null!=(o=n.cm_inputOffsetTop||(null!=t?t.cm_inputOffsetTop:t))?o:s)===l?o.call(a,{name:"cm_inputOffsetTop",hash:{},data:r}):o)+'">\n</div>\n</div>\n<div class="inline field">\n<label for="cm_smartIndent" >smartIndent</label>\n<input type="checkbox" name="cm_smartIndent" '+c(typeof(o=null!=(o=n.cm_smartIndent||(null!=t?t.cm_smartIndent:t))?o:s)===l?o.call(a,{name:"cm_smartIndent",hash:{},data:r}):o)+'>\n</div>\n<div class="inline field">\n<label for="cm_indentWithTabs" >indentWithTabs</label>\n<input type="checkbox" name="cm_indentWithTabs" '+c(typeof(o=null!=(o=n.cm_indentWithTabs||(null!=t?t.cm_indentWithTabs:t))?o:s)===l?o.call(a,{name:"cm_indentWithTabs",hash:{},data:r}):o)+'>\n</div>\n<div class="inline field">\n<label for="cm_tabSize" >tabSize  </label>\n<span class="cm_tab_size_label">'+c(typeof(o=null!=(o=n.cm_tabSize||(null!=t?t.cm_tabSize:t))?o:s)===l?o.call(a,{name:"cm_tabSize",hash:{},data:r}):o)+'</span>\n<div class="ui range cm_tab_size"></div>\n</div>\n<div class="inline field">\n<label for="cm_indentUnit" >indentUnit  </label>\n<span class="cm_indent_unit_label">'+c(typeof(o=null!=(o=n.cm_indentUnit||(null!=t?t.cm_indentUnit:t))?o:s)===l?o.call(a,{name:"cm_indentUnit",hash:{},data:r}):o)+'</span>\n<div class="ui range cm_indent_unit"></div>\n</div>\n<div class="inline field">\n<label for="cm_previewPDF" >\u9884\u89c8PDF(\u9700\u8981\u5728\u7acb\u65f6\u9884\u89c8\u72b6\u6001\u4e0b\uff0c\u5e76\u4e14\u6253\u5f00\u4e86\u56fe\u7247\u9884\u89c8\uff0c\u540c\u65f6 PDF \u6587\u4ef6\u5c0f\u4e8e 10M)</label>\n<input type="checkbox" name="cm_previewPDF" '+c(typeof(o=null!=(o=n.cm_previewPDF||(null!=t?t.cm_previewPDF:t))?o:s)===l?o.call(a,{name:"cm_previewPDF",hash:{},data:r}):o)+'>\n</div>\n<div class="inline field">\n<label for="cm_lineNumbers" >\u663e\u793a\u884c\u53f7</label>\n<input type="checkbox" name="cm_lineNumbers" '+c(typeof(o=null!=(o=n.cm_lineNumbers||(null!=t?t.cm_lineNumbers:t))?o:s)===l?o.call(a,{name:"cm_lineNumbers",hash:{},data:r}):o)+'>\n</div>\n<div class="inline field">\n<label for="cm_autoCloseBrackets" >\u81ea\u52a8\u5173\u95ed\u62ec\u53f7</label>\n<input type="checkbox" name="cm_autoCloseBrackets" '+c(typeof(o=null!=(o=n.cm_autoCloseBrackets||(null!=t?t.cm_autoCloseBrackets:t))?o:s)===l?o.call(a,{name:"cm_autoCloseBrackets",hash:{},data:r}):o)+'>\n</div>\n<div class="inline field">\n<label for="cm_lineWrapping" >\u81ea\u52a8\u6298\u884c</label>\n<input type="checkbox" name="cm_lineWrapping" '+c(typeof(o=null!=(o=n.cm_lineWrapping||(null!=t?t.cm_lineWrapping:t))?o:s)===l?o.call(a,{name:"cm_lineWrapping",hash:{},data:r}):o)+'>\n</div>\n<div class="inline field">\n<label for="cm_highlightActive" >\u9ad8\u4eae\u5f53\u524d\u884c</label>\n<input type="checkbox" name="cm_highlightActive" '+c(typeof(o=null!=(o=n.cm_highlightActive||(null!=t?t.cm_highlightActive:t))?o:s)===l?o.call(a,{name:"cm_highlightActive",hash:{},data:r}):o)+'>\n</div>\n<div class="inline field">\n<label for="cm_styleStackFocusLine" >\u884c\u4e13\u6ce8</label>\n<input type="checkbox" name="cm_styleStackFocusLine" '+c(typeof(o=null!=(o=n.cm_styleStackFocusLine||(null!=t?t.cm_styleStackFocusLine:t))?o:s)===l?o.call(a,{name:"cm_styleStackFocusLine",hash:{},data:r}):o)+'>\n</div>\n<div class="ui message">\n<ul>\n<li>\u5feb\u6377\u952e[ctrl+alt+f/cmd+alt+f]</li>\n<li>\u8be5\u5feb\u6377\u952e\u53ea\u662f\u4e34\u65f6\u6539\u53d8\u884c\u4e13\u6ce8\u6a21\u5f0f\uff0c\u60f3\u8981\u4e0b\u6b21\u542f\u52a8\u751f\u6548\uff0c\u9700\u8981\u5728\u5f53\u524d\u9875\u9762\u4e0b\u8bbe\u7f6e\u624d\u80fd\u751f\u6548</li>\n</ul>\n</div>\n<div class="inline field">\n<label for="cm_autoCovertHtmlToMarkdown" >\u7c98\u8d34\u65f6\uff0c\u81ea\u52a8\u8f6c\u6362\u5bcc\u6587\u672c\u4e3a markdown \u683c\u5f0f</label>\n<input type="checkbox" name="cm_autoCovertHtmlToMarkdown" '+c(typeof(o=null!=(o=n.cm_autoCovertHtmlToMarkdown||(null!=t?t.cm_autoCovertHtmlToMarkdown:t))?o:s)===l?o.call(a,{name:"cm_autoCovertHtmlToMarkdown",hash:{},data:r}):o)+'>\n</div>\n<div class="ui message">\n<ul>\n<li>\u5feb\u6377\u952e[Ctrl+Shift+v] \u53ef\u4ee5\u5f3a\u5236\u7c98\u8d34\u4e3a\u7eaf\u6587\u672c</li>\n</ul>\n</div>\n<div class="inline field">\n<label for="cm_showInvisibles" >\u663e\u793a\u4e0d\u53ef\u89c1\u5143\u7d20</label>\n<input type="checkbox" name="cm_showInvisibles" '+c(typeof(o=null!=(o=n.cm_showInvisibles||(null!=t?t.cm_showInvisibles:t))?o:s)===l?o.call(a,{name:"cm_showInvisibles",hash:{},data:r}):o)+'>\n</div>\n<div class="inline field">\n<label for="cm_minimap" >\u663e\u793a\u5c0f\u5730\u56feminimap(\u5f53\u7f16\u8f91\u533a\u5bbd\u5ea6\u5c0f\u4e8e1024px\u65f6,\u81ea\u52a8\u9690\u85cf)</label>\n<input type="checkbox" name="cm_minimap" '+c(typeof(o=null!=(o=n.cm_minimap||(null!=t?t.cm_minimap:t))?o:s)===l?o.call(a,{name:"cm_minimap",hash:{},data:r}):o)+'>\n</div>\n<div class="inline field">\n<label for="cm_typewriterScrolling" >\u6253\u5b57\u673a\u6eda\u52a8\u6548\u679c</label>\n<input type="checkbox" name="cm_typewriterScrolling" '+c(typeof(o=null!=(o=n.cm_typewriterScrolling||(null!=t?t.cm_typewriterScrolling:t))?o:s)===l?o.call(a,{name:"cm_typewriterScrolling",hash:{},data:r}):o)+'>\n</div>\n<div class="inline field">\n<label for="cm_scrollPastEnd" >scrollPastEnd</label>\n<input type="checkbox" name="cm_scrollPastEnd" '+c(typeof(o=null!=(o=n.cm_scrollPastEnd||(null!=t?t.cm_scrollPastEnd:t))?o:s)===l?o.call(a,{name:"cm_scrollPastEnd",hash:{},data:r}):o)+'>\n</div>\n<div class="inline field">\n<label for="cm_autopreviewHoveredImage" >\u5f53\u9f20\u6807\u7ecf\u8fc7\u56fe\u7247\u94fe\u63a5\u65f6,\u81ea\u52a8\u9884\u89c8\u56fe\u7247</label>\n<input type="checkbox" name="cm_autopreviewHoveredImage" '+c(typeof(o=null!=(o=n.cm_autopreviewHoveredImage||(null!=t?t.cm_autopreviewHoveredImage:t))?o:s)===l?o.call(a,{name:"cm_autopreviewHoveredImage",hash:{},data:r}):o)+'>\n</div>\n<div class="inline field">\n<label for="cm_activeCursorMathjax" >\u5f53\u5149\u6807\u5904\u5728\u516c\u5f0f\u5185\u65f6,\u81ea\u52a8\u9884\u89c8\u516c\u5f0f\u6548\u679c</label>\n<input type="checkbox" name="cm_activeCursorMathjax" '+c(typeof(o=null!=(o=n.cm_activeCursorMathjax||(null!=t?t.cm_activeCursorMathjax:t))?o:s)===l?o.call(a,{name:"cm_activeCursorMathjax",hash:{},data:r}):o)+'>\n</div>\n<div class="ui message">\n<ul>\n<li>\u5feb\u6377\u952e[ctrl+alt+p/cmd+alt+p]</li>\n<li>\u8be5\u5feb\u6377\u952e\u53ef\u4ee5\u4e34\u65f6\u53d6\u6d88\u6216\u8005\u542f\u52a8\u81ea\u52a8\u9884\u89c8\u529f\u80fd</li>\n</ul>\n</div>\n<div class="inline field">\n<label for="cm_spellChecker" >\u5f00\u542f\u82f1\u6587\u8bed\u6cd5\u68c0\u67e5</label>\n<input type="checkbox" name="cm_spellChecker" '+c(typeof(o=null!=(o=n.cm_spellChecker||(null!=t?t.cm_spellChecker:t))?o:s)===l?o.call(a,{name:"cm_spellChecker",hash:{},data:r}):o)+'>\n</div>\n<div class="inline field">\n<label for="cm_markerColorpicker" >\u5f00\u542f\u9ad8\u4eae\u8bed\u6cd5\u989c\u8272\u9009\u62e9\u5668</label>\n<input type="checkbox" name="cm_markerColorpicker" '+c(typeof(o=null!=(o=n.cm_markerColorpicker||(null!=t?t.cm_markerColorpicker:t))?o:s)===l?o.call(a,{name:"cm_markerColorpicker",hash:{},data:r}):o)+">\n</div>\n</div>\n"},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/settings_grammar":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<form action=""></form>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/settings_network":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){var o,a=null!=t?t:e.nullContext||{},s=n.helperMissing,l=e.escapeExpression;return'<div class="inline field">\n<label for="useProxy">\u662f\u5426\u6253\u5f00\u4ee3\u7406:</label>\n<input type="checkbox" name="useProxy">\n</div>\n<div class="inline fields">\n<div class="inline field">\n<label for="protocol">\u534f\u8bae:</label>\n<select name="protocol">\n<option value="http:">http</option>\n<option value="https:">https</option>\n<option value="socks5:">socks5</option>\n</select>\n</div>\n<div class="inline field">\n<label for="host">\u670d\u52a1\u5668\u5730\u5740:</label>\n<input type="text" name="host" placeholder="xxx.xxx.xxx.xxx" value="'+l("function"==typeof(o=null!=(o=n.host||(null!=t?t.host:t))?o:s)?o.call(a,{name:"host",hash:{},data:r}):o)+'">\n</div>\n<div class="inline field">\n<label for="port">\u7aef\u53e3:</label>\n<input type="text" name="port" placeholder="80" value="'+l("function"==typeof(o=null!=(o=n.port||(null!=t?t.port:t))?o:s)?o.call(a,{name:"port",hash:{},data:r}):o)+'">\n</div>\n</div>\n<div class="inline fields">\n<div class="inline field">\n<label for="username">\u7528\u6237\u540d:</label>\n<input type="text" name="username" value="'+l("function"==typeof(o=null!=(o=n.username||(null!=t?t.username:t))?o:s)?o.call(a,{name:"username",hash:{},data:r}):o)+'">\n</div>\n<div class="inline field">\n<label for="password">\u5bc6\u7801:</label>\n<input type="text" name="password" value="'+l("function"==typeof(o=null!=(o=n.password||(null!=t?t.password:t))?o:s)?o.call(a,{name:"password",hash:{},data:r}):o)+'">\n</div>\n</div>\n<div class="field">\n<label for="diagnose_url">\u6d4b\u8bd5\u4ee3\u7406\u662f\u5426\u6b63\u5e38</label>\n<input type="text" name="diagnose_url" placeholder="https://www.google.com">\n</div>\n<div class="ui button diagnose_url_button">\u6d4b\u8bd5</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/settings_preview":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){var o,a=null!=t?t:e.nullContext||{},s=n.helperMissing,l="function",c=e.escapeExpression;return'<div class="inline field">\n<label for="minimap" ><span >minimap\u5c0f\u5730\u56fe\u6eda\u52a8\u6761</span>\n</label>\n<input type="checkbox" name="minimap" '+c(typeof(o=null!=(o=n.minimap||(null!=t?t.minimap:t))?o:s)===l?o.call(a,{name:"minimap",hash:{},data:r}):o)+'>\n</div>\n<div class="inline field">\n<label for="disableVdomPreview" ><span >\u9884\u89c8\u65f6, \u662f\u5426\u7981\u7528\u5c40\u90e8\u66f4\u65b0</span>\n</label>\n<input type="checkbox" name="disableVdomPreview" '+c(typeof(o=null!=(o=n.disableVdomPreview||(null!=t?t.disableVdomPreview:t))?o:s)===l?o.call(a,{name:"disableVdomPreview",hash:{},data:r}):o)+'>\n</div>\n<div class="inline field">\n<label for="renderMetaTitle" ><span >\u662f\u5426\u81ea\u52a8\u6e32\u67d3\u5143\u6570\u636e\u91cc\u7684\u6807\u9898(title)</span>\n<i class="lightbulb outline icon" title="\u5143\u6570\u636e\u6807\u8bc6: renderMetaTitle"></i>\n</label>\n<input type="checkbox" name="renderMetaTitle" '+c(typeof(o=null!=(o=n.renderMetaTitle||(null!=t?t.renderMetaTitle:t))?o:s)===l?o.call(a,{name:"renderMetaTitle",hash:{},data:r}):o)+'>\n</div>\n<div class="inline field">\n<label for="renderMetaTag"><span >\u662f\u5426\u81ea\u52a8\u6e32\u67d3\u5143\u6570\u636e\u91cc\u7684\u6807\u7b7e(tags)</span>\n<i class="lightbulb outline icon" title="\u5143\u6570\u636e\u6807\u8bc6: renderMetaTag"></i>\n</label>\n<input type="checkbox" name="renderMetaTag" '+c(typeof(o=null!=(o=n.renderMetaTag||(null!=t?t.renderMetaTag:t))?o:s)===l?o.call(a,{name:"renderMetaTag",hash:{},data:r}):o)+'>\n</div>\n<div class="inline field">\n<label for="renderImgBlock"><span >\u662f\u5426\u81ea\u52a8\u5757\u7ea7\u56fe\u7247</span>\n<i class="lightbulb outline icon" title="\u5143\u6570\u636e\u6807\u8bc6: renderImgBlock"></i>\n</label>\n<input type="checkbox" name="renderImgBlock" '+c(typeof(o=null!=(o=n.renderImgBlock||(null!=t?t.renderImgBlock:t))?o:s)===l?o.call(a,{name:"renderImgBlock",hash:{},data:r}):o)+'>\n</div>\n<div class="inline field">\n<label for="renderNestImgBlock"><span >\u8bc6\u522b\u5d4c\u5957\u5757\u7ea7\u56fe\u7247</span>\n<i class="lightbulb outline icon" title="\u5143\u6570\u636e\u6807\u8bc6: renderNestImgBlock"></i>\n</label>\n<input type="checkbox" name="renderNestImgBlock" '+c(typeof(o=null!=(o=n.renderNestImgBlock||(null!=t?t.renderNestImgBlock:t))?o:s)===l?o.call(a,{name:"renderNestImgBlock",hash:{},data:r}):o)+'>\n</div>\n<div class="inline field">\n<label for="renderWrapImgTitle"><span >\u662f\u5426\u81ea\u52a8\u586b\u5145\u5757\u7ea7\u56fe\u7247\u6807\u9898</span>\n<i class="lightbulb outline icon" title="\u5143\u6570\u636e\u6807\u8bc6: renderWrapImgTitle"></i>\n</label>\n<input type="checkbox" name="renderWrapImgTitle" '+c(typeof(o=null!=(o=n.renderWrapImgTitle||(null!=t?t.renderWrapImgTitle:t))?o:s)===l?o.call(a,{name:"renderWrapImgTitle",hash:{},data:r}):o)+'>\n</div>\n<div class="inline field">\n<label for="renderWrapTableTitle"><span\n>\u662f\u5426\u81ea\u52a8\u586b\u5145\u8868\u683c\u7ec4\u4ef6\u6807\u9898</span>\n<i class="lightbulb outline icon" title="\u5143\u6570\u636e\u6807\u8bc6: renderWrapTableTitle"></i>\n</label>\n<input type="checkbox" name="renderWrapTableTitle" '+c(typeof(o=null!=(o=n.renderWrapTableTitle||(null!=t?t.renderWrapTableTitle:t))?o:s)===l?o.call(a,{name:"renderWrapTableTitle",hash:{},data:r}):o)+'>\n</div>\n<div class="inline field">\n<label for="renderWrapDrawIOTitle"><span\n>\u662f\u5426\u81ea\u52a8\u586b\u5145\u7ed8\u56fe\u7ec4\u4ef6\u6807\u9898</span>\n<i class="lightbulb outline icon" title="\u5143\u6570\u636e\u6807\u8bc6: renderWrapDrawIOTitle"></i>\n</label>\n<input type="checkbox" name="renderWrapDrawIOTitle" '+c(typeof(o=null!=(o=n.renderWrapDrawIOTitle||(null!=t?t.renderWrapDrawIOTitle:t))?o:s)===l?o.call(a,{name:"renderWrapDrawIOTitle",hash:{},data:r}):o)+'>\n</div>\n<div class="inline field">\n<label for="renderAutoDetectAttachment"><span >\u662f\u5426\u81ea\u52a8\u8f6c\u6362\u975e\u56fe\u7247\u6269\u5c55\u540d\u4e3a\u9644\u4ef6\uff08\u81ea\u52a8\u8bc6\u522bjpg,jpeg,png,gif\u53ca\u65e0\u6269\u5c55\u540d\u7684\u6587\u4ef6\u4e3a\u56fe\u7247\u6587\u4ef6\uff0c\u5176\u4ed6\u7684\u6269\u5c55\u540d\u6587\u4ef6\u4e3a\u9644\u4ef6\uff09</span>\n<i class="lightbulb outline icon" title="\u5143\u6570\u636e\u6807\u8bc6: renderAutoDetectAttachment"></i>\n</label>\n<input type="checkbox" name="renderAutoDetectAttachment" '+c(typeof(o=null!=(o=n.renderAutoDetectAttachment||(null!=t?t.renderAutoDetectAttachment:t))?o:s)===l?o.call(a,{name:"renderAutoDetectAttachment",hash:{},data:r}):o)+'>\n</div>\n<div class="inline field">\n<label for="renderTitleLinkAsFootnote"><span >\u662f\u5426\u5c06\u5e26\u6709 title \u7684\u8d85\u94fe\u63a5\u8f6c\u5316\u6210\u811a\u6ce8\u663e\u793a\u6548\u679c</span>\n<i class="lightbulb outline icon" title="\u5143\u6570\u636e\u6807\u8bc6: renderTitleLinkAsFootnote"></i>\n</label>\n<input type="checkbox" name="renderTitleLinkAsFootnote" '+c(typeof(o=null!=(o=n.renderTitleLinkAsFootnote||(null!=t?t.renderTitleLinkAsFootnote:t))?o:s)===l?o.call(a,{name:"renderTitleLinkAsFootnote",hash:{},data:r}):o)+'>\n</div>\n<div class="inline field">\n<label for="renderLinkAsFootnote"><span >\u662f\u5426\u5c06\u94fe\u63a5\u8bed\u6cd5\u8f6c\u5316\u6210\u811a\u6ce8\u7684\u663e\u793a\u6548\u679c</span>\n<i class="lightbulb outline icon" title="\u5143\u6570\u636e\u6807\u8bc6: renderLinkAsFootnote"></i>\n</label>\n<input type="checkbox" name="renderLinkAsFootnote" '+c(typeof(o=null!=(o=n.renderLinkAsFootnote||(null!=t?t.renderLinkAsFootnote:t))?o:s)===l?o.call(a,{name:"renderLinkAsFootnote",hash:{},data:r}):o)+'>\n</div>\n<div class="inline field">\n<label for="renderNumberedHeading"><span >\u662f\u5426\u81ea\u52a8\u5bf9\u6587\u7ae0\u6807\u9898\u7f16\u53f7</span>\n<i class="lightbulb outline icon" title="\u5143\u6570\u636e\u6807\u8bc6: renderNumberedHeading"></i>\n</label>\n<input type="checkbox" name="renderNumberedHeading" '+c(typeof(o=null!=(o=n.renderNumberedHeading||(null!=t?t.renderNumberedHeading:t))?o:s)===l?o.call(a,{name:"renderNumberedHeading",hash:{},data:r}):o)+'>\n</div>\n<div class="inline field">\n<label for="renderNumberedHeadingOffset" ><span\n>\u6807\u9898\u7f16\u53f7\u8d77\u59cb\u503c</span>\n<i class="lightbulb outline icon" title="\u5143\u6570\u636e\u6807\u8bc6: renderNumberedHeadingOffset"></i>\n</label>\n<div class="ui fluid input">\n<input type="text" placeholder="0,0,0,0,0,0,0" name="renderNumberedHeadingOffset" value="">\n</div>\n</div>\n<div class="inline field">\n<label for="renderNumberedHeadingH1" ><span >\u4e00\u53f7\u6807\u9898\u7f16\u53f7\u89c4\u5219</span>\n<i class="lightbulb outline icon" title="\u5143\u6570\u636e\u6807\u8bc6: renderNumberedHeadingH1"></i>\n</label>\n<div class="ui fluid input">\n<input type="text" placeholder="" name="renderNumberedHeadingH1" value="">\n</div>\n</div>\n<div class="inline field">\n<label for="renderNumberedHeadingH2" ><span >\u4e8c\u53f7\u6807\u9898\u7f16\u53f7\u89c4\u5219</span>\n<i class="lightbulb outline icon" title="\u5143\u6570\u636e\u6807\u8bc6: renderNumberedHeadingH2"></i>\n</label>\n<div class="ui fluid input">\n<input type="text" placeholder="" name="renderNumberedHeadingH2" value="">\n</div>\n</div>\n<div class="inline field">\n<label for="renderNumberedHeadingH3" ><span >\u4e09\u53f7\u6807\u9898\u7f16\u53f7\u89c4\u5219</span>\n<i class="lightbulb outline icon" title="\u5143\u6570\u636e\u6807\u8bc6: renderNumberedHeadingH3"></i>\n</label>\n<div class="ui fluid input">\n<input type="text" placeholder="" name="renderNumberedHeadingH3" value="">\n</div>\n</div>\n<div class="inline field">\n<label for="renderNumberedHeadingH4" ><span >\u56db\u53f7\u6807\u9898\u7f16\u53f7\u89c4\u5219</span>\n<i class="lightbulb outline icon" title="\u5143\u6570\u636e\u6807\u8bc6: renderNumberedHeadingH4"></i>\n</label>\n<div class="ui fluid input">\n<input type="text" placeholder="" name="renderNumberedHeadingH4" value="">\n</div>\n</div>\n<div class="inline field">\n<label for="renderNumberedHeadingH5" ><span >\u4e94\u53f7\u6807\u9898\u7f16\u53f7\u89c4\u5219</span>\n<i class="lightbulb outline icon" title="\u5143\u6570\u636e\u6807\u8bc6: renderNumberedHeadingH5"></i>\n</label>\n<div class="ui fluid input">\n<input type="text" placeholder="" name="renderNumberedHeadingH5" value="">\n</div>\n</div>\n<div class="inline field">\n<label for="renderNumberedHeadingH6" ><span >\u516d\u53f7\u6807\u9898\u7f16\u53f7\u89c4\u5219</span>\n<i class="lightbulb outline icon" title="\u5143\u6570\u636e\u6807\u8bc6: renderNumberedHeadingH6"></i>\n</label>\n<div class="ui fluid input">\n<input type="text" placeholder="" name="renderNumberedHeadingH6" value="">\n</div>\n</div>\n<div class="inline field">\n<label for="renderNumberedHeadingH7" ><span >\u4e03\u53f7\u6807\u9898\u7f16\u53f7\u89c4\u5219</span>\n<i class="lightbulb outline icon" title="\u5143\u6570\u636e\u6807\u8bc6: renderNumberedHeadingH7"></i>\n</label>\n<div class="ui fluid input">\n<input type="text" placeholder="" name="renderNumberedHeadingH7" value="">\n</div>\n</div>\n\n\n<div class="inline field">\n<label for="systemPreviewCss" >\u9884\u89c8\u533a\u7cfb\u7edf\u6837\u5f0f</label>\n<span class="system_preview_select_css_container"></span>\n</div>\n<div class="inline field" style="display:none">\n<label for="useSystemPreviewCss" >\u662f\u5426\u4f7f\u7528\u9884\u89c8\u533a\u7cfb\u7edf\u5185\u7f6e\u6837\u5f0f</label>\n<input type="checkbox" name="useSystemPreviewCss" '+c(typeof(o=null!=(o=n.useSystemPreviewCss||(null!=t?t.useSystemPreviewCss:t))?o:s)===l?o.call(a,{name:"useSystemPreviewCss",hash:{},data:r}):o)+'>\n</div>\n<div class="inline field">\n<label for="codePreviewCss" >\u9884\u89c8\u533a\u4ee3\u7801\u9ad8\u4eae\u6837\u5f0f</label>\n<span class="code_preview_select_css_container"></span>\n</div>\n<div class="ui fluid field">\n<label for="userPreviewCssText" >\u9884\u89c8\u533a\u81ea\u5b9a\u4e49\u6837\u5f0f</label>\n<textarea name="userPreviewCssText" placeholder="h1{font-size:20px;}"></textarea>\n</div>\n<div class="ui fluid field">\n<label for="aliasLang" >\u4ee3\u7801\u5757\u8bed\u8a00\u522b\u540d</label>\n<textarea name="aliasLang" placeholder="\u683c\u5f0f\uff1a\n\u539f\u59cb\u540d\u79f0:\u65b0\u7684\u522b\u540d1,\u65b0\u7684\u522b\u540d2;\n\u539f\u59cb\u540d\u79f02:\u65b0\u7684\u522b\u540da,\u65b0\u7684\u522b\u540db;\n\u6bd4\u5982:\nmathjax!:mathjax,math;\nmermaid!:mermaid;"></textarea>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/settings_tag":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){var o;return'<div class="ui raised segment user_en_words">\n<a href="javascript:void(0);" class="ui ribbon label" >\u81ea\u5b9a\u4e49\u7684\u82f1\u6587\u8bcd\u5178</a>\n<div class="ui right labeled left icon input add_word_container" style="padding: 10px;">\n<i class="tags icon"></i>\n<input type="text" placeholder="\u8f93\u5165\u5355\u8bcd\u5185\u5bb9" class="add_word_input"\n>\n<div class="ui tag label button add_word_button" >\n\u6dfb\u52a0\u65b0\u7684\u5355\u8bcd\n</div>\n</div>\n<div class="user_words_container words_container" style="padding: 10px;"></div>\n</div>\n<div class="ui raised segment user_tags">\n<a href="javascript:void(0);" class="ui ribbon label" >\u81ea\u5b9a\u4e49\u7684\u6807\u7b7e</a>\n<div class="ui right labeled left icon input add_tag_container" style="padding: 10px;">\n<i class="tags icon"></i>\n<input type="text" placeholder="\u8f93\u5165\u6807\u7b7e\u5185\u5bb9" class="add_tag_input"\n>\n<div class="ui tag label button add_tag_button" >\n\u6dfb\u52a0\u65b0\u7684\u6807\u7b7e\n</div>\n</div>\n<div class="user_tags_container tags_container" style="padding: 10px;"></div>\n</div>\n<div class="ui raised segment auto_tags">\n<a href="javascript:void(0);" class="ui ribbon label" >\u81ea\u52a8\u6dfb\u52a0\u7684\u6807\u7b7e</a>\n<div class="inline field" style="padding: 10px;">\n<label for="autoAddTag" >\u81ea\u52a8\u6dfb\u52a0\u6587\u7ae0\u65b0\u89e3\u6790\u5230\u7684\u6807\u7b7e</label>\n<input type="checkbox" name="autoAddTag" '+e.escapeExpression("function"==typeof(o=null!=(o=n.autoAddTag||(null!=t?t.autoAddTag:t))?o:n.helperMissing)?o.call(null!=t?t:e.nullContext||{},{name:"autoAddTag",hash:{},data:r}):o)+'>\n</div>\n<div class="auto_tags_container tags_container" style="padding: 10px;"></div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/sidebar":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<a class="item user_button">\n<i class="xiaoshujiang icon"></i>\n<span >\u7528\u6237</span>\n</a>\n<a class="item templates_manager_button">\n<i class="copy icon"></i>\n<span>\u6a21\u677f</span>\n</a>\n<a class="item snippets_manager_button">\n<i class="paste icon"></i>\n<span>\u7247\u6bb5</span>\n</a>\n<a class="item public_email_file_button">\n<i class="mail icon"></i>\n<span >\u90ae\u4ef6</span>\n</a>\n<a class="item change_store_plugin_button">\n<i class="exchange icon"></i>\n<span >\u7ed1\u5b9a</span>\n</a>\n<a class="item public_button">\n<i class="send outline icon"></i>\n<span >\u53d1\u5e03</span>\n</a>\n<a class="item keyboard_button">\n<i class="keyboard outline icon"></i>\n<span >\u6309\u952e</span>\n</a>\n<a class="item export_button">\n<i class="sign out icon"></i>\n<span >\u5bfc\u51fa</span>\n</a>\n<a class="item import_button">\n<i class="sign in icon"></i>\n<span >\u5bfc\u5165</span>\n</a>\n<a class="item settings_button">\n<i class="settings icon"></i>\n<span >\u8bbe\u7f6e</span>\n</a>\n<a class="item database_button">\n<i class="database icon"></i>\n<span >\u6570\u636e</span>\n</a>\n<a class="item about_button">\n<i class="idea icon"></i>\n<span >\u5173\u4e8e</span>\n</a>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/snippets_manager":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<i class="close icon"></i>\n<div class="header">\n\u7247\u6bb5\u7ba1\u7406\n</div>\n<div class="content story_content">\n<div class="ui form">\n<div class="snippet_default" style="margin-bottom: 1rem;">\n<div class="ui fluid field">\n<label for="defaultSnippet">\u57fa\u7840\u7247\u6bb5</label>\n<textarea name="defaultSnippet"></textarea>\n</div>\n<div class="ui icon info message">\n<i class="icon info circle"></i>\n<div class="content">\n<ol>\n<li>\n\u6ca1\u6709\u521b\u5efa\u4efb\u4f55\u7247\u6bb5\u65f6\uff0c\u7cfb\u7edf\u81ea\u52a8\u4f7f\u7528\u57fa\u7840\u7247\u6bb5\u3002\n</li>\n<li>\n\u7247\u6bb5\u5217\u8868\u91cc\u5982\u679c\u6ca1\u6709\u8bbe\u7f6e\u9ed8\u8ba4\u7247\u6bb5\uff0c\u7cfb\u7edf\u4e5f\u5c06\u81ea\u52a8\u4f7f\u7528\u57fa\u7840\u7247\u6bb5\u3002\n</li>\n<li>\n\u60a8\u53ef\u4ee5\u70b9\u51fb\u53f3\u4e0b\u65b9\u7684\u65b0\u5efa\u6309\u94ae\uff0c\u521b\u5efa\u65b0\u7684\u7247\u6bb5\u3002\n</li>\n<li>\n\u57fa\u7840\u7247\u6bb5\u4e0d\u53d7\u5bfc\u5165\uff0c\u5bfc\u51fa\u7247\u6bb5\u63a7\u5236\u3002\n</li>\n<li>\n\u57fa\u7840\u7247\u6bb5\u53ea\u63d0\u4f9b\u6b63\u6587\u5185\u5bb9\u3002\n</li>\n</ol>\n</div>\n</div>\n</div>\n<div class="snippet_container" style="display:none">\n<div class="inline field  ">\n<label for="snippetName">\u7247\u6bb5\u540d\u79f0(\u4ec5\u7528\u4e8e\u533a\u5206\u4e0d\u540c\u7684\u7247\u6bb5,\u65b9\u4fbf\u7528\u6237\u9009\u62e9)</label>\n<div class="ui fluid input">\n<input type="text" name="snippetName" placeholder="\u672a\u547d\u540d\u7247\u6bb5\u540d\u79f0"/>\n<input type="hidden" name="id" />\n</div>\n</div>\n<div class="inline field  ">\n<div class="ui checkbox">\n<input type="checkbox" name="canScript" checked/>\n<label for="canScript">\u662f\u5426\u652f\u6301\u811a\u672c</label>\n</div>\n</div>\n<div class="inline fields  ">\n<label for="snippetMode">\u7247\u6bb5\u7c7b\u578b</label>\n<div class="field">\n<div class="ui radio checkbox">\n<input type="radio" name="snippetMode" value="normal">\n<label >\u666e\u901a</label>\n</div>\n</div>\n<div class="field">\n<div class="ui radio checkbox">\n<input type="radio" name="snippetMode" value="codemirror">\n<label >CodeMirror \u7f16\u8f91\u5668</label>\n</div>\n</div>\n</div>\n<div class="ui segment">\n<div class="ui blue ribbon label">\u7247\u6bb5\u5185\u5bb9</div>\n<div class="ui fluid field">\n<label for="content" >\u6b63\u6587</label>\n<textarea name="content"></textarea>\n</div>\n<div class="ui fluid field" style="display:none;">\n<label for="">\u9644\u4ef6\u8d44\u6e90</label>\n<input type="file" style="display: none" multiple="multiple" name="attachments"/>\n<p class="drop-zone">\u5c06\u6587\u4ef6\u62d6\u62fd\u5230\u8fd9\u91cc</p>\n<div class="ui ordered list attachments_container"></div>\n</div>\n</div>\n</div>\n<div class="snippets_container" style="display:none;margin-top: 1rem;">\n<table class="ui table">\n<thead>\n<tr>\n<th class="one wide">#</th>\n<th>\u6807\u9898</th>\n<th class="four wide">\u64cd\u4f5c</th>\n</tr>\n</thead>\n<tbody class="snippets_container_body"></tbody>\n</table>\n</div>\n</div>\n</div>\n\n<div class="actions">\n<div class="tips">\n<div class="ui basic mini button export_snippets_button">\u5bfc\u51fa</div>\n<input type="file" name="importSnippets" style="display:none"/>\n<div class="ui basic mini button import_snippets_button">\u5bfc\u5165</div>\n<div class="ui basic mini button help_button">\u5e2e\u52a9</div>\n</div>\n<a class="icon ui button mini previous_button pagination_button">\n<i class="left chevron icon"></i>\n</a>\n<a class="icon ui button mini next_button pagination_button">\n<i class="right chevron icon"></i>\n</a>\n<div class="ui mini blue button save_basic_button init_hide_button"><i class="save icon"></i>\u4fdd\u5b58\u57fa\u7840\u7247\u6bb5</div>\n<div class="ui mini blue button modify_basic_button init_hide_button"><i class="edit icon"></i>\u4fee\u6539\u57fa\u7840\u7247\u6bb5</div>\n<div class="ui mini blue button cancel_basic_button init_hide_button"><i class="edit icon"></i>\u53d6\u6d88</div>\n<div class="ui mini blue button save_button init_hide_button"><i class="save icon"></i>\u4fdd\u5b58</div>\n<div class="ui mini blue button new_button init_hide_button"><i class="plus icon"></i>\u65b0\u5efa</div>\n<div class="ui mini blue button cancel_button init_hide_button"><i class="minus icon"></i>\u53d6\u6d88</div>\n<div class="ui basic mini cancel button" >\n\u5173\u95ed\n</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/start_fail":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'\u7531\u4e8e\u4e0a\u6b21\u542f\u52a8\u5931\u8d25\uff0c\u4f60\u53ef\u4ee5\u5c1d\u8bd5\u4e0b\u9762\u64cd\u4f5c\uff1a\u3000\n<div class="ui mini button primary reload_btn">\u518d\u6b21\u91cd\u542f</div>\n<div class="ui mini button primary reset_btn">\u91cd\u7f6e\u914d\u7f6e\u6587\u4ef6\u540e\u91cd\u542f</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/store":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<div class="header store">\n<div class="ui tiny buttons store_buttons">\n<div class="ui button icon search_button"><i class="icon search" title="\u5168\u6587\u641c\u7d22"></i></div>\n<div class="filter_dropdown_button"></div>\n<div></div>\n</div>\n<div class="ui search search_container fluid">\n<div class="ui icon input search_input_wrapper mini fluid">\n<i class="circle remove icon link close_search_input_wrapper" title="\u5173\u95ed\u5feb\u901f\u67e5\u8be2"></i>\n<input type="text" placeholder="\u641c\u7d22\u5185\u5bb9 tag:\u5c0f\u4e66\u5320 date:-1mon" class="search_input prompt"/>\n<i class="circular search link icon search_file"></i>\n</div>\n<div class="results"></div>\n</div>\n</div>\n<div class="content ui-layout-content store_content_container">\n</div>\n<div class="footer footer_intro store_footer">\n<div class="ui mini icon button close_store_button">\n<i class="angle double left icon"></i>\n</div>\n<div class="ui mini icon button miniweb_server_button" title="\u52a0\u8f7d\u4e2d\uff0c\u8bf7\u7a0d\u5019">\n<i class="server icon"></i>\n</div>\n\n<div class="ui tiny buttons right store_buttons" style="float: right;">\n\n<div class="ui button icon open_external_btn" title="\u5c06\u5f53\u524d\u5217\u8868\u6240\u6709\u6587\u7ae0\u5728\u6d6e\u52a8\u7f16\u8f91\u5668\u5185\u6253\u5f00"><i class="external alternate icon"></i></div>\n<div class="ui button icon bind_store" title="\u7b2c\u4e09\u65b9\u7ed1\u5b9a"><i class="exchange icon"></i></div>\n\n<div class="analysis_button_placeholder">\n</div>\n<div class="theme_button_placeholder">\n</div>\n\n<div class="ui icon bottom right pointing dropdown button help_button">\n<i class="help icon"></i>\n<div class="menu">\n<div class="item get_update_file_button">\u66f4\u65b0\u624b\u518c</div>\n<div class="item get_use_file_button">\u4f7f\u7528\u624b\u518c</div>\n<div class="item get_grammar_file_button">\u8bed\u6cd5\u624b\u518c</div>\n<div class="item get_ppt_file_button">ppt\u8bed\u6cd5\u624b\u518c</div>\n<div class="item show_tour_button">\u529f\u80fd\u5e03\u5c40</div>\n</div>\n</div>\n</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/store_files_list":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<div class="list_results">\u8be6\u7ec6\u7ed3\u679c</div>\n<div class="list_blank">\u627e\u4e0d\u5230\u641c\u7d22\u7ed3\u679c</div>\n<div class="list_pagination">\u5206\u9875\u4fe1\u606f</div>\n<div class="ui active inverted dimmer">\n<div class="ui text loader">\u52a0\u8f7d\u4e2d....</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/store_footer_analysis_dropdown":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<i class="chart bar outline icon" title="\u7edf\u8ba1\u5206\u6790"></i>\n<div class="menu">\n<div class="item tags_map_window_button analysis_button">\n<i class="blackberry icon"></i>\n\u6807\u7b7e\u7ec4\u5408\u5173\u7cfb\u56fe</div>\n<div class="item decision_map_window_button analysis_button">\n<i class="keycdn icon"></i>\n\u6807\u7b7e\u51b3\u7b56\u56fe</div>\n<div class="item link_map_window_button analysis_button">\n<i class="hubspot icon"></i>\n\u94fe\u63a5\u5173\u7cfb\u56fe</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/store_footer_theme_dropdown":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<i class="icon theme" title="\u4fee\u6539\u5e94\u7528\u4e3b\u9898" >\n</i>\n<div class="menu">\n<div class="ui search icon input">\n<i class="search icon"></i>\n<input type="text" name="search" placeholder="\u67e5\u627e\u4e3b\u9898...">\n</div>\n<div class="divider"></div>\n<div class="header">\n<div class="ui mini buttons fluid themes_filter_buttons">\n<a class="ui active button mini system_themes_button" data-type="system">\n<i class="file alternate outline icon"></i>\u5185\u7f6e\u4e3b\u9898\n</a>\n<a class="ui  button mini user_themes_button" data-type="user">\n<i class="file alternate outline icon"></i>\u7528\u6237\u4e3b\u9898\n</a>\n<a class="ui  button mini create_user_theme_button" data-type="create_user_theme">\n<i class="file alternate outline icon"></i>\u4e3b\u9898\u7ba1\u7406\n</a>\n</div>\n</div>\n<div class="scrolling menu xsj_patch_menu">\n</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/store_plugin_info_dialog":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){var o,a=null!=t?t:e.nullContext||{},s=n.helperMissing,l="function",c=e.escapeExpression;return'<i class="close icon"></i>\n<div class="header">\n\u5f53\u524d\u7ed1\u5b9a\u4fe1\u606f\n</div>\n<div class="content image">\n<div class="ui tiny image">\n<img class="ui tiny image" src="'+c(typeof(o=null!=(o=n.pic||(null!=t?t.pic:t))?o:s)===l?o.call(a,{name:"pic",hash:{},data:r}):o)+'">\n</div>\n<div class="description">\n<div class="ui header">\u7b2c\u4e09\u65b9\u670d\u52a1: '+c(typeof(o=null!=(o=n.displayName||(null!=t?t.displayName:t))?o:s)===l?o.call(a,{name:"displayName",hash:{},data:r}):o)+"("+c(typeof(o=null!=(o=n.name||(null!=t?t.name:t))?o:s)===l?o.call(a,{name:"name",hash:{},data:r}):o)+")</div>\n<p>"+c(typeof(o=null!=(o=n.pluginDescription||(null!=t?t.pluginDescription:t))?o:s)===l?o.call(a,{name:"pluginDescription",hash:{},data:r}):o)+'</p>\n<div class="ui header">\u4f7f\u7528\u7684\u7528\u6237: '+c(typeof(o=null!=(o=n.userDisplayName||(null!=t?t.userDisplayName:t))?o:s)===l?o.call(a,{name:"userDisplayName",hash:{},data:r}):o)+"("+c(typeof(o=null!=(o=n.username||(null!=t?t.username:t))?o:s)===l?o.call(a,{name:"username",hash:{},data:r}):o)+')</div>\n</div>\n</div>\n<div class="actions">\n<div class="ui cancel button">\n\u5173\u95ed\n</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/table_of_content":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<div class="ui dimmer inverted"></div>\n<div class="item toc_header" style="cursor: move;">\n<h3 >\u5927\u7eb2</h3>\n</div>\n<div class="split">\n<div class="toc_buttons">\n<span><i class="icon add circle link expand_all_button" title="\u5168\u90e8\u5c55\u5f00"></i></span>\n<span><i class="icon minus circle link collapse_all_button" title="\u5168\u90e8\u6298\u53e0"></i></span>\n<span><i class="icon arrow up circle link back_to_top_button" title="\u8df3\u5230\u6587\u7ae0\u5f00\u5934"></i></span>\n<span><i class="icon arrow down circle link go_to_bottom_button" title="\u8df3\u5230\u6587\u7ae0\u7ed3\u5c3e"></i></span>\n<span><i class="icon close link close_button" title="\u5173\u95ed"></i></span>\n</div>\n<hr />\n</div>\n<div class="toc"></div>\n<div class="toc_tooltip_bar">\n<div class="toc_tooltip_bar_content">\n</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/templates_manager":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<i class="close icon"></i>\n<div class="header">\n\u6a21\u677f\u7ba1\u7406\n</div>\n<div class="content story_content">\n<div class="ui form">\n<div class="template_default" style="margin-bottom: 1rem;">\n<div class="ui fluid field">\n<label for="newFileTemplate">\u57fa\u7840\u6a21\u677f</label>\n<textarea name="newFileTemplate"></textarea>\n</div>\n<div class="ui icon info message">\n<i class="icon info circle"></i>\n<div class="content">\n<ol>\n<li>\n\u6ca1\u6709\u521b\u5efa\u4efb\u4f55\u6a21\u677f\u65f6\uff0c\u7cfb\u7edf\u81ea\u52a8\u4f7f\u7528\u57fa\u7840\u6a21\u677f\u3002\n</li>\n<li>\n\u6a21\u677f\u5217\u8868\u91cc\u5982\u679c\u6ca1\u6709\u8bbe\u7f6e\u9ed8\u8ba4\u6a21\u677f\uff0c\u521b\u5efa\u65b0\u6587\u7ae0\u65f6\uff0c\u7cfb\u7edf\u4e5f\u5c06\u81ea\u52a8\u4f7f\u7528\u57fa\u7840\u6a21\u677f\u3002\n</li>\n<li>\n\u60a8\u53ef\u4ee5\u70b9\u51fb\u53f3\u4e0b\u65b9\u7684\u65b0\u5efa\u6309\u94ae\uff0c\u521b\u5efa\u65b0\u7684\u6a21\u677f\u3002\n</li>\n<li>\n\u57fa\u7840\u6a21\u677f\u4e0d\u53d7\u5bfc\u5165\uff0c\u5bfc\u51fa\u6a21\u677f\u63a7\u5236\u3002\n</li>\n<li>\n\u57fa\u7840\u6a21\u677f\u53ea\u63d0\u4f9b\u6b63\u6587\u5185\u5bb9\u3002\n</li>\n</ol>\n</div>\n</div>\n</div>\n<div class="template_container" style="display:none">\n<div class="inline field  ">\n<label for="templateName">\u6a21\u677f\u540d\u79f0(\u4ec5\u7528\u4e8e\u533a\u5206\u4e0d\u540c\u7684\u6a21\u677f,\u65b9\u4fbf\u7528\u6237\u9009\u62e9)</label>\n<div class="ui fluid input">\n<input type="text" name="templateName" placeholder="\u672a\u547d\u540d\u6a21\u677f\u540d\u79f0"/>\n<input type="hidden" name="id" />\n</div>\n</div>\n<div class="inline field  ">\n<div class="ui checkbox">\n<input type="checkbox" name="canScript" checked/>\n<label for="canScript">\u662f\u5426\u652f\u6301\u811a\u672c</label>\n</div>\n</div>\n<div class="ui segment">\n<div class="ui blue ribbon label">\u6a21\u677f\u5185\u5bb9</div>\n<div class="inline field  ">\n<label for="title">\u6807\u9898</label>\n<div class="ui fluid input">\n<input type="text" name="title" placeholder="\u672a\u547d\u540d\u6587\u4ef6"/>\n</div>\n</div>\n<div class="inline field  ">\n<label for="tagNames">\u6807\u7b7e</label>\n<div class="ui fluid input"><input type="text" name="tagNames" placeholder="\u591a\u4e2a\u6807\u7b7e\u540d\u79f0\u7528\u9017\u53f7\u5206\u5f00"/></div>\n</div>\n<div class="inline field  ">\n<label for="category">\u5206\u7c7b</label>\n<div class="ui fluid input"><input type="text" name="category" placeholder="\u4e0d\u540c\u5c42\u7ea7\u901a\u8fc7 / \u5206\u5f00"/></div>\n</div>\n\n<div class="ui fluid field">\n<label for="content" >\u6b63\u6587</label>\n<textarea name="content"></textarea>\n</div>\n<div class="ui fluid field">\n<label for="cssText">\u81ea\u5b9a\u4e49\u6837\u5f0f</label>\n<textarea name="cssText"></textarea>\n</div>\n<div class="ui fluid field">\n<label for="">\u9644\u4ef6\u8d44\u6e90</label>\n<input type="file" style="display: none" multiple="multiple" name="attachments"/>\n<p class="drop-zone">\u5c06\u6587\u4ef6\u62d6\u62fd\u5230\u8fd9\u91cc</p>\n<div class="ui ordered list attachments_container"></div>\n</div>\n</div>\n</div>\n<div class="templates_container" style="display:none;margin-top: 1rem;">\n<table class="ui table">\n<thead>\n<tr>\n<th class="one wide">#</th>\n<th>\u6807\u9898</th>\n<th class="four wide">\u64cd\u4f5c</th>\n</tr>\n</thead>\n<tbody class="templates_container_body"></tbody>\n</table>\n</div>\n</div>\n</div>\n\n<div class="actions">\n<div class="tips">\n<div class="ui basic mini button export_templates_button">\u5bfc\u51fa</div>\n<input type="file" name="importTemplates" style="display:none"/>\n<div class="ui basic mini button import_templates_button">\u5bfc\u5165</div>\n<div class="ui basic mini button help_button">\u5e2e\u52a9</div>\n</div>\n<a class="icon ui button mini previous_button pagination_button">\n<i class="left chevron icon"></i>\n</a>\n<a class="icon ui button mini next_button pagination_button">\n<i class="right chevron icon"></i>\n</a>\n<div class="ui mini blue button save_basic_button init_hide_button"><i class="save icon"></i>\u4fdd\u5b58\u57fa\u7840\u6a21\u677f</div>\n<div class="ui mini blue button modify_basic_button init_hide_button"><i class="edit icon"></i>\u4fee\u6539\u57fa\u7840\u6a21\u677f</div>\n<div class="ui mini blue button cancel_basic_button init_hide_button"><i class="edit icon"></i>\u53d6\u6d88</div>\n<div class="ui mini blue button save_button init_hide_button"><i class="save icon"></i>\u4fdd\u5b58</div>\n<div class="ui mini blue button new_button init_hide_button"><i class="plus icon"></i>\u65b0\u5efa</div>\n<div class="ui mini blue button cancel_button init_hide_button"><i class="minus icon"></i>\u53d6\u6d88</div>\n<div class="ui basic mini cancel button" >\n\u5173\u95ed\n</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/templates_select_dialog":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<i class="close icon"></i>\n<div class="header">\n\u9009\u62e9\u6a21\u677f\n</div>\n<div class="content story_content">\n<div class="ui middle aligned selection list items files_items"></div>\n</div>\n<div class="actions">\n<div class="ui small icon input search_container">\n<i class="circle remove icon link clean_search_input_wrapper blank" title="\u6e05\u7a7a\u67e5\u8be2"></i>\n<input type="text" placeholder="\u641c\u7d22..." class="search_input">\n<i class="circular search link icon search_button"></i>\n</div>\n<div class=\'dropdown_tag_name_placeholder\'>\n</div>\n<div class="ui basic cancel button" >\n\u5173\u95ed\n</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/themes_manager":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<i class="close icon"></i>\n<div class="header">\n\u4e3b\u9898\u7ba1\u7406\n</div>\n<div class="content story_content">\n<div class="ui form">\n<div class="theme_default" style="margin-bottom: 1rem;">\n<div class="ui icon info message">\n<i class="icon info circle"></i>\n<div class="content">\n<p>\u60a8\u8fd8\u6ca1\u6709\u521b\u5efa\u65b0\u7684\u4e3b\u9898</p>\n</div>\n</div>\n</div>\n<div class="theme_container" style="display:none">\n<div class="inline field  ">\n<label for="themeName">\u4e3b\u9898\u540d\u79f0(\u4ec5\u7528\u4e8e\u533a\u5206\u4e0d\u540c\u7684\u4e3b\u9898,\u65b9\u4fbf\u7528\u6237\u9009\u62e9)</label>\n<div class="ui fluid input">\n<input type="text" name="themeName" placeholder="\u672a\u547d\u540d\u4e3b\u9898\u540d\u79f0"/>\n<input type="hidden" name="id" />\n</div>\n</div>\n<div class="inline field  ">\n<label for="tagNames">\u6807\u7b7e</label>\n<div class="ui fluid input"><input type="text" name="tagNames" placeholder="\u591a\u4e2a\u6807\u7b7e\u540d\u79f0\u7528\u9017\u53f7\u5206\u5f00"/></div>\n</div>\n<div class="inline field  ">\n<label for="baseTheme">\u7ee7\u627f\u4e8e</label>\n<div class="ui dropdown base_theme_dropdown">\n<div class="text">\u9009\u62e9\u4e00\u4e2a\u914d\u8272\u65b9\u6848</div>\n<i class="dropdown icon"></i>\n<div class="menu">\n<div class="ui icon search input">\n<i class="search icon"></i>\n<input type="text" placeholder="\u67e5\u627e\u547d\u4ee4...">\n</div>\n<div class="divider"></div>\n<div class="scrolling menu base_theme_menus_container xsj_patch_menu">\n</div>\n</div>\n</div>\n</div>\n<div class="ui fluid field">\n<label for="extraCssText">\u8ffd\u52a0 CSS \u6837\u5f0f</label>\n<textarea name="extraCssText"></textarea>\n</div>\n<div class="ui fluid field">\n<label for="">\u80cc\u666f\u56fe\u7247</label>\n<input type="file" style="display: none" multiple="multiple" name="attachments"/>\n<p class="drop-zone">\u5c06\u56fe\u7247\u6587\u4ef6\u62d6\u62fd\u5230\u8fd9\u91cc</p>\n<div class="ui ordered list attachments_container"></div>\n</div>\n</div>\n<div class="themes_container" style="display:none;margin-top: 1rem;">\n<table class="ui table selectable">\n<thead>\n<tr>\n<th class="one wide">#</th>\n<th class="two wide">ID</th>\n<th>\u6807\u9898</th>\n<th class="four wide">\u64cd\u4f5c</th>\n</tr>\n</thead>\n<tbody class="themes_container_body"></tbody>\n</table>\n</div>\n</div>\n</div>\n\n<div class="actions">\n<div class="tips">\n<div class="ui basic mini button export_themes_button">\u5bfc\u51fa</div>\n<input type="file" name="importThemes" style="display:none"/>\n<div class="ui basic mini button import_themes_button">\u5bfc\u5165</div>\n</div>\n<a class="icon ui button mini previous_button pagination_button">\n<i class="left chevron icon"></i>\n</a>\n<a class="icon ui button mini next_button pagination_button">\n<i class="right chevron icon"></i>\n</a>\n<div class="ui mini button save_button init_hide_button"><i class="save icon"></i>\u4fdd\u5b58</div>\n<div class="ui mini button new_button init_hide_button"><i class="plus icon"></i>\u65b0\u5efa</div>\n<div class="ui mini button cancel_button init_hide_button"><i class="minus icon"></i>\u53d6\u6d88</div>\n<div class="ui basic mini cancel button" >\n\u5173\u95ed\n</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/toc_dropdown":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<span class="icon_tip">\u6587\u6863\u5927\u7eb2</span>\n<i class="icon content" title="\u6587\u6863\u5927\u7eb2" >\n</i>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/user_info":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<div class="ui pointing secondary menu">\n<a class="item active user_info_basic_tab" data-tab="basic">\u7528\u6237\u4fe1\u606f</a>\n<a class="item user_info_avatar_tab" data-tab="avatar">\u5934\u50cf</a>\n<a class="item user_info_setting_tab" data-tab="setting" >\u7528\u6237\u914d\u7f6e</a>\n<a class="item user_info_invination_tab" data-tab="invitation">\u9080\u8bf7</a>\n</div>\n<div class="ui tab user_info_invitation_tab_container" data-tab="invitation">\n</div>\n<div class="ui tab user_info_setting_tab_container" data-tab="setting">\n</div>\n<div class="ui tab user_info_avatar_tab_container" data-tab="avatar">\n</div>\n<div class="ui tab user_info_basic_tab_container" data-tab="basic">\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/user_info_avatar":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<div class="ui segment">\n<div class="ui center aligned container">\n<div class="ui buttons">\n<div class="ui button delete_avatar_btn">\u5220\u9664</div>\n<div class="ui button modify_avatar_btn">\u7f16\u8f91</div>\n</div>\n</div>\n<div style="display:none;"><input type="file" multiple="" name="fileData" class="form-control"></div>\n<div class="drop-zone" style="width: 300px;height:300px;margin: 10px auto;">\u5c06\u56fe\u7247\u62d6\u62fd\u5230\u8fd9\u91cc</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/user_info_basic":function(e,t,n){var i=Handlebars.template({1:function(e,t,n,i,r){return'<i class="large icons">\n<i class="mail outline icon"></i>\n<i class="check icon corner" title="\u5df2\u7ecf\u8fdb\u884c\u90ae\u7bb1\u9a8c\u8bc1"></i>\n</i>\n'},3:function(e,t,n,i,r){return'<i class="large icons">\n<i class="mail outline icon"></i>\n<i class="warning sign icon corner" title="\u60a8\u8fd8\u6ca1\u6709\u8fdb\u884c\u90ae\u7bb1\u9a8c\u8bc1"></i>\n</i>\n<div class="error ui message">\u60a8\u8fd8\u6ca1\u6709\u8fdb\u884c\u90ae\u7bb1\u9a8c\u8bc1\uff0c\u70b9\u51fb <a class="ui mini button verify_button primary">\u90ae\u7bb1\u9a8c\u8bc1</a> \u6309\u94ae\uff0c\u5b8c\u6210\u90ae\u7bb1\u9a8c\u8bc1</div>\n'},5:function(e,t,n,i,r){var o,a,s=null!=t?t:e.nullContext||{};return"<tr "+(null!=(o=n.if.call(s,null!=t?t.isExpired:t,{name:"if",hash:{},fn:e.program(6,r,0),inverse:e.noop,data:r}))?o:"")+">\n<td>\u5230\u671f\u65f6\u95f4</td>\n<td>\n<p>"+e.escapeExpression("function"==typeof(a=null!=(a=n.expireDate||(null!=t?t.expireDate:t))?a:n.helperMissing)?a.call(s,{name:"expireDate",hash:{},data:r}):a)+" "+(null!=(o=n.if.call(s,null!=t?t.isExpired:t,{name:"if",hash:{},fn:e.program(8,r,0),inverse:e.noop,data:r}))?o:"")+"</p>\n</td>\n</tr>\n"},6:function(e,t,n,i,r){return'class="error"'},8:function(e,t,n,i,r){return"<strong> \u5df2\u7ecf\u8fc7\u671f\uff0c\u8bf7\u53ca\u65f6\u7eed\u8d39</strong>"},10:function(e,t,n,i,r){return'<tr class="positive">\n<td colspan=2 class="center aligned">\n<strong>\u7cfb\u7edf\u5df2\u81ea\u52a8\u4e3a\u60a8\u6253\u5f00\u4e34\u65f6\u4f1a\u5458</strong>\n</td>\n</tr>\n'},12:function(e,t,n,i,r){var o;return"<tr>\n<td colspan=2>\n"+(null!=(o=n.if.call(null!=t?t:e.nullContext||{},null!=t?t.applyingVip:t,{name:"if",hash:{},fn:e.program(13,r,0),inverse:e.program(17,r,0),data:r}))?o:"")+"</td>\n</tr>\n"},13:function(e,t,n,i,r){var o;return"<p>\u60a8\u7684\u4ed8\u8d39\u7533\u8bf7\u6b63\u5728\u5ba1\u6838\u4e2d\uff0c\u8bf7\u8010\u5fc3\u7b49\u5f85....</p>\n"+(null!=(o=n.unless.call(null!=t?t:e.nullContext||{},null!=t?t.isTempVip:t,{name:"unless",hash:{},fn:e.program(14,r,0),inverse:e.noop,data:r}))?o:"")+'<div class="ui form">\n<div class="field">\n<textarea rows="2" style="margin-top: 0px; margin-bottom: 0px; height: 59px;" name="notice_admin_content"></textarea>\n</div>\n<div class="ui mini  button notice_admin_button basic right floated ">\u63d0\u9192\u7ba1\u7406\u5458\u4ed8\u8d39\u6210\u529f</div>\n</div>\n'},14:function(e,t,n,i,r){var o;return null!=(o=n.unless.call(null!=t?t:e.nullContext||{},null!=t?t.emailVerified:t,{name:"unless",hash:{},fn:e.program(15,r,0),inverse:e.noop,data:r}))?o:""},15:function(e,t,n,i,r){return'<div class="info ui message">\u60a8\u8fd8\u6ca1\u6709\u8fdb\u884c\u90ae\u7bb1\u9a8c\u8bc1, \u9a8c\u8bc1\u901a\u8fc7\u540e\uff0c\u5c06\u62e5\u6709\u4e34\u65f6\u4f1a\u5458\u529f\u80fd\uff0c\u70b9\u51fb <a class="ui\nmini button verify_button primary">\u90ae\u7bb1\u9a8c\u8bc1</a> \u6309\u94ae\uff0c\u5b8c\u6210\u90ae\u7bb1\u9a8c\u8bc1</div>\n'},17:function(e,t,n,i,r){var o,a=null!=t?t:e.nullContext||{};return(null!=(o=n.if.call(a,null!=t?t.isExpired:t,{name:"if",hash:{},fn:e.program(18,r,0),inverse:e.noop,data:r}))?o:"")+(null!=(o=n.if.call(a,null!=t?t.willExpired:t,{name:"if",hash:{},fn:e.program(20,r,0),inverse:e.noop,data:r}))?o:"")+(null!=(o=n.unless.call(a,null!=t?t.expireDate:t,{name:"unless",hash:{},fn:e.program(22,r,0),inverse:e.noop,data:r}))?o:"")},18:function(e,t,n,i,r){return'<p>\u60a8\u7684\u5e10\u6237\u5df2\u7ecf\u8fc7\u671f\uff0c\u8bf7\u7eed\u8d39, \u67e5\u770b <a href="http://soft.xiaoshujiang.com/priceflow.html" target="_blank">\u7eed\u8d39\u6d41\u7a0b</a></p>\n<div class="ui small  button apply_vip_button basic right floated ">\u6211\u5df2\u7eed\u8d39,\u63d0\u9192\u7ba1\u7406\u5458</div>\n'},20:function(e,t,n,i,r){return'<p>\u60a8\u7684\u5e10\u6237\u5c06\u8981\u8fc7\u671f\uff0c\u8bf7\u53ca\u65f6\u7eed\u8d39, \u67e5\u770b <a href="http://soft.xiaoshujiang.com/priceflow.html" target="_blank">\u7eed\u8d39\u6d41\u7a0b</a></p>\n<div class="ui small  button apply_vip_button basic right floated ">\u6211\u5df2\u7eed\u8d39,\u63d0\u9192\u7ba1\u7406\u5458</div>\n'},22:function(e,t,n,i,r){return'<p>\u60a8\u8fd8\u4e0d\u662f\u4f1a\u5458\u7528\u6237\uff0c\u8bf7\u5148\u5347\u7ea7, \u67e5\u770b <a href="http://soft.xiaoshujiang.com/priceflow.html" target="_blank">\u4ed8\u6b3e\u5347\u7ea7\u6d41\u7a0b</a></p>\n<div class="ui small  button apply_vip_button basic right floated ">\u6211\u5df2\u4ed8\u8d39\uff0c\u63d0\u9192\u7ba1\u7406\u5458</div>\n'},24:function(e,t,n,i,r){var o;return(null!=(o=n.if.call(null!=t?t:e.nullContext||{},null!=t?t.applyingVip:t,{name:"if",hash:{},fn:e.program(25,r,0),inverse:e.noop,data:r}))?o:"")+'<div class="ui error message">\u4ed8\u6b3e\u65f6\uff0c\u8bf7\u4e00\u5b9a\u8981\u5728\u5907\u6ce8\u91cc\u6ce8\u660e\u8981\u5347\u7ea7\u7684\u7528\u6237\u540d\u6216\u8005\u7528\u6237\u552f\u4e00\u7f16\u53f7</div>\n<div class="charge_channels_container ui tall stacked segment">\n</div>\n'},25:function(e,t,n,i,r){return'<div class="massive ui error message">\u5982\u679c\u60a8\u4ed8\u6b3e\u65f6\u5fd8\u8bb0\u5199\u7528\u6237\u540d\uff0c\u6216\u8005\u552f\u4e00\u7f16\u53f7\uff0c\u8bf7\u7528\u540c\u4e00\u5e10\u53f7\u518d\u4ed8\u6b3e 0.01 \u5143\uff0c\u5e76\u4e00\u5b9a\u8981\u5728\u5907\u6ce8\u4e0a\u5199\u4e0a\u7528\u6237\u540d\u6216\u8005\u552f\u4e00\u7f16\u53f7</div>\n'},27:function(e,t,n,i,r){return'<div class="ui icon info message">\n<i class="icon info circle"></i>\n<div class="content">\n<ul class="list">\n<li>\n\u914d\u7f6e\u53c2\u6570\u540c\u6b65\u529f\u80fd\u9ed8\u8ba4\u4e3a\u5173\u95ed\u72b6\u6001\uff0c\u60a8\u53ef\u4ee5\u5728<strong>\u7528\u6237\u914d\u7f6e</strong>\u9875\u7b7e\u91cc\uff0c\u6253\u5f00\u8be5\u529f\u80fd\u3002\n</li>\n<li>\n\u6587\u7ae0\u540c\u6b65\u529f\u80fd\u9ed8\u8ba4\u4e3a\u5173\u95ed\u72b6\u6001\uff0c\u60a8\u53ef\u4ee5\u5728<strong>\u5c0f\u4e66\u5320\u4e3b\u6309\u94ae/\u6570\u636e/\u540c\u6b65</strong>\u9875\u9762\u91cc\uff0c\u6253\u5f00\u8be5\u529f\u80fd\u3002\n</li>\n</ul>\n</div>\n</div>\n'},compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){var o,a,s=null!=t?t:e.nullContext||{},l=n.helperMissing,c=e.escapeExpression;return'<table class="ui celled table">\n<tbody>\n<tr>\n<td>\u7528\u6237\u552f\u4e00\u7f16\u53f7</td>\n<td>@'+c("function"==typeof(a=null!=(a=n.id||(null!=t?t.id:t))?a:l)?a.call(s,{name:"id",hash:{},data:r}):a)+"</td>\n</tr>\n<tr>\n<td>\u7528\u6237\u540d</td>\n<td>"+c("function"==typeof(a=null!=(a=n.email||(null!=t?t.email:t))?a:l)?a.call(s,{name:"email",hash:{},data:r}):a)+"\n"+(null!=(o=n.if.call(s,null!=t?t.emailVerified:t,{name:"if",hash:{},fn:e.program(1,r,0),inverse:e.program(3,r,0),data:r}))?o:"")+"</td>\n</tr>\n"+(null!=(o=n.if.call(s,null!=t?t.expireDate:t,{name:"if",hash:{},fn:e.program(5,r,0),inverse:e.noop,data:r}))?o:"")+(null!=(o=n.if.call(s,null!=t?t.isTempVip:t,{name:"if",hash:{},fn:e.program(10,r,0),inverse:e.noop,data:r}))?o:"")+(null!=(o=n.if.call(s,null!=t?t.canApplying:t,{name:"if",hash:{},fn:e.program(12,r,0),inverse:e.noop,data:r}))?o:"")+'</tbody>\n<tfoot class="full-width">\n<tr>\n<th colspan=2 style="text-align: right;">\n<div>\u9000\u51fa\u65f6\u6e05\u7a7a\u672c\u5730\u914d\u7f6e\u4fe1\u606f <input type="checkbox" name="logoutClearConfig"> </div>\n<div class="ui small  button logout_button basic right floated primary">\u9000\u51fa</div>\n</th>\n</tr>\n</tfoot>\n</table>\n'+(null!=(o=n.if.call(s,null!=t?t.canApplying:t,{name:"if",hash:{},fn:e.program(24,r,0),inverse:e.program(27,r,0),data:r}))?o:"")},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/user_info_invitation":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<div class="xsj_segment">\n<div class="ui placeholder segment blank_invitation">\n<div class="ui icon header">\n<i class="handshake outline icon"></i>\n\u60a8\u8fd8\u6ca1\u6709\u521b\u5efa\u9080\u8bf7\u7801\n</div>\n<div class="ui primary button create_invitation_button">\u521b\u5efa\u9080\u8bf7\u7801</div>\n</div>\n<div class="ui basic segment invitation_info_container" style="display: none;">\n<div class="ui segment invitation_info">\u6211\u7684\u9080\u8bf7\u7801: <span class="ui tag label invitation_code teal massive"></span>\n<h4 class="ui horizontal divider header">\n<i class="users icon"></i>\n<span class="invitation_statistics"></span>\n</h4>\n</div>\n<div class="ui segment invitation_result">\n</div>\n</div>\n</div>\n<div class="ui massive message negative not_vip_message_tip">\n\u8be5\u529f\u80fd\u4ec5\u9650\u4ed8\u8d39\u7528\u6237\u4f7f\u7528\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/user_info_setting":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){var o,a=null!=t?t:e.nullContext||{},s=n.helperMissing,l="function",c=e.escapeExpression;return'<div class="ui form">\n<div class="inline fields">\n<div class="ui checkbox"> <input type="checkbox" name="configSyncLive"  '+c(typeof(o=null!=(o=n.configSyncLive||(null!=t?t.configSyncLive:t))?o:s)===l?o.call(a,{name:"configSyncLive",hash:{},data:r}):o)+'><label>\u662f\u5426\u5b9e\u65f6\u540c\u6b65\u5ba2\u6237\u7aef\u914d\u7f6e</label>\n</div>\n</div>\n<div class="ui positive button apply_config_sync_button" style="float:right">\u5e94\u7528</div>\n<div class="grouped fields">\n<label>\u540c\u6b65\u8303\u56f4</label>\n<div class="field">\n<div class="ui checkbox">\n<input type="checkbox" name="configSyncRangeApplication"  '+c(typeof(o=null!=(o=n.configSyncRangeApplication||(null!=t?t.configSyncRangeApplication:t))?o:s)===l?o.call(a,{name:"configSyncRangeApplication",hash:{},data:r}):o)+'/>\n<label for="configSyncRangeApplication">\u57fa\u672c</label>\n</div>\n<i class="icon history link small circular config_history_button" title="\u5386\u53f2\u8bb0\u5f55" data-value="application"></i>\n</div>\n<div class="field">\n<div class="ui checkbox">\n<input type="checkbox" name="configSyncRangeEditor" '+c(typeof(o=null!=(o=n.configSyncRangeEditor||(null!=t?t.configSyncRangeEditor:t))?o:s)===l?o.call(a,{name:"configSyncRangeEditor",hash:{},data:r}):o)+'/>\n<label for="configSyncRangeEditor">\u7f16\u8f91\u5668</label>\n</div>\n<i class="icon history link small circular config_history_button" title="\u5386\u53f2\u8bb0\u5f55" data-value="editor"></i>\n</div>\n<div class="field">\n<div class="ui checkbox">\n<input type="checkbox" name="configSyncRangePreview" '+c(typeof(o=null!=(o=n.configSyncRangePreview||(null!=t?t.configSyncRangePreview:t))?o:s)===l?o.call(a,{name:"configSyncRangePreview",hash:{},data:r}):o)+'/>\n<label for="configSyncRangePreview">\u9884\u89c8</label>\n</div>\n<i class="icon history link small circular config_history_button" title="\u5386\u53f2\u8bb0\u5f55" data-value="preview"></i>\n</div>\n<div class="field">\n<div class="ui checkbox">\n<input type="checkbox" name="configSyncRangeStores" '+c(typeof(o=null!=(o=n.configSyncRangeStores||(null!=t?t.configSyncRangeStores:t))?o:s)===l?o.call(a,{name:"configSyncRangeStores",hash:{},data:r}):o)+'/>\n<label for="configSyncRangeStores">\u7ed1\u5b9a</label>\n</div>\n<i class="icon history link small circular config_history_button" title="\u5386\u53f2\u8bb0\u5f55" data-value="stores"></i>\n</div>\n</div>\n<div class="three ui buttons">\n<button class="ui button export_button">\n<i class="sign out icon"></i>\n\u5bfc\u51fa\u914d\u7f6e\u6587\u4ef6</button>\n<button class="ui button import_button">\n<i class="sign in icon"></i>\n\u5bfc\u5165\u914d\u7f6e\u6587\u4ef6</button>\n<button class="ui button reset_button">\n<i class="trash outline icon"></i>\n\u91cd\u7f6e\u914d\u7f6e\u6587\u4ef6</button>\n<input type="file" style="display:none"/>\n</div>\n<div class="ui icon info message">\n<i class="icon info circle"></i>\n<div class="content">\n<ul class="list">\n<li>\n\u4e0d\u540c\u6b65\u53d1\u5e03\u535a\u5ba2\uff0c\u53d1\u9001\u90ae\u4ef6\u586b\u5199\u7684\u6570\u636e\n</li>\n<li>\n\u4e0d\u540c\u6b65\u7528\u6237\u6807\u7b7e\n</li>\n<li>\u4e0d\u540c\u6b65\u7f16\u8f91\u533a\u9884\u89c8\u533a\u540c\u6b65\u6eda\u52a8\u7684\u5f00\u5173</li>\n</ul>\n</div>\n</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/user_login":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){var o;return'<span class="ui teal ribbon label">\u7528\u6237\u767b\u5f55</span>\n<div class="ui pointing secondary menu">\n<a class="item active">\u7528\u6237\u767b\u5f55</a>\n<a class="item register_button">\u7528\u6237\u6ce8\u518c</a>\n<a class="item reset_password_button">\u627e\u56de\u5bc6\u7801</a>\n</div>\n<form class="ui form">\n<div class="field">\n<label for="email">\u7528\u6237\u90ae\u7bb1</label>\n<div class="ui fluid icon input">\n<input type="text" name="email" placeholder="\u8bf7\u8f93\u5165\u4e00\u4e2a\u5408\u6cd5\u7684\u90ae\u7bb1\u5730\u5740" value="'+e.escapeExpression("function"==typeof(o=null!=(o=n.email||(null!=t?t.email:t))?o:n.helperMissing)?o.call(null!=t?t:e.nullContext||{},{name:"email",hash:{},data:r}):o)+'">\n<i class="mail outline icon"></i>\n</div>\n</div>\n<div class="field">\n<label for="password">\u5bc6\u7801</label>\n<div class="ui fluid input">\n<input type="password" name="password">\n</div>\n</div>\n<div class="ui error message"></div>\n<div class="field ui container right aligned">\n<button class="ui basic primary button login_button">\u767b\u5f55</button>\n</div>\n</form>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/user_manager":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<i class="close icon"></i>\n<div class="header">\u7528\u6237\u7ba1\u7406</div>\n\n</div>\n<div class="content story_content"></div>\n<div class="actions">\n<div class="ui cancel basic button" >\n\u5173\u95ed\n</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/user_register":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){var o;return'<span class="ui teal ribbon label">\u7528\u6237\u6ce8\u518c</span>\n<div class="ui pointing secondary menu">\n<a class="item login_button">\u7528\u6237\u767b\u5f55</a>\n<a class="item active">\u7528\u6237\u6ce8\u518c</a>\n<a class="item reset_password_button">\u627e\u56de\u5bc6\u7801</a>\n</div>\n<form class="ui form">\n<div class="field">\n<label for="email">\u7528\u6237\u90ae\u7bb1</label>\n<div class="ui fluid icon input">\n<input type="text" name="email" placeholder="\u8bf7\u8f93\u5165\u4e00\u4e2a\u5408\u6cd5\u7684\u90ae\u7bb1\u5730\u5740" value="'+e.escapeExpression("function"==typeof(o=null!=(o=n.email||(null!=t?t.email:t))?o:n.helperMissing)?o.call(null!=t?t:e.nullContext||{},{name:"email",hash:{},data:r}):o)+'">\n<i class="mail outline icon"></i>\n</div>\n</div>\n<div class="field">\n<label for="password">\u5bc6\u7801</label>\n<div class="ui fluid input">\n<input type="password" name="password">\n</div>\n</div>\n<div class="field">\n<label for="invitationCode">\u9080\u8bf7\u7801</label>\n<div class="ui fluid input">\n<input type="text" name="invitationCode">\n</div>\n</div>\n<div class="ui message">\n<div class="header">\u9080\u8bf7\u7801</div>\n<ul class="list">\n<li>\u5982\u679c\u6ca1\u6709\u9080\u8bf7\u7801\uff0c\u8bf7\u7559\u7a7a</li>\n<li>\u9080\u8bf7\u6d3b\u52a8\u89c4\u5219\u53ef\u4ee5\u5728<a href="http://soft.xiaoshujiang.com/blog/user/invitation" target="_blank">\u8fd9\u91cc</a>\u67e5\u770b</li>\n</ul>\n</div>\n<div class="field ui container right aligned">\n<button class="ui basic primary button register_button">\u6ce8\u518c</button>\n</div>\n</form>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/user_reset_password":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){var o;return'<span class="ui teal ribbon label">\u627e\u56de\u5bc6\u7801</span>\n<div class="ui pointing secondary menu">\n<a class="item login_button">\u7528\u6237\u767b\u5f55</a>\n<a class="item register_button">\u7528\u6237\u6ce8\u518c</a>\n<a class="item active">\u627e\u56de\u5bc6\u7801</a>\n</div>\n<form class="ui form">\n<div class="field">\n<label for="email">\u7528\u6237\u90ae\u7bb1</label>\n<div class="ui fluid icon input">\n<input type="text" name="email" placeholder="\u8bf7\u8f93\u5165\u4e00\u4e2a\u5408\u6cd5\u7684\u90ae\u7bb1\u5730\u5740" value="'+e.escapeExpression("function"==typeof(o=null!=(o=n.email||(null!=t?t.email:t))?o:n.helperMissing)?o.call(null!=t?t:e.nullContext||{},{name:"email",hash:{},data:r}):o)+'">\n<i class="mail outline icon"></i>\n</div>\n</div>\n<div class="ui error message"></div>\n<div class="field ui container right aligned">\n<button class="ui basic primary button reset_password_button">\u786e\u8ba4</button>\n</div>\n</form>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates/wavedrom_style":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return"<style>\n.wavedrom_svg text, .wavedrom_svg_defs text {\nfont-size:11pt;\nfont-style:normal;\nfont-variant:normal;\nfont-weight:normal;\nfont-stretch:normal;\ntext-align:center;\nfill-opacity:1;\nfont-family:Helvetica\n}\n.wavedrom_svg .muted, .wavedrom_svg_defs .muted {\nfill:#aaa\n}\n.wavedrom_svg .warning, .wavedrom_svg_defs .warning {\nfill:#f6b900\n}\n.wavedrom_svg .error, .wavedrom_svg_defs .error {\nfill:#f60000\n}\n.wavedrom_svg .info, .wavedrom_svg_defs .info {\nfill:#0041c4\n}\n.wavedrom_svg .success, .wavedrom_svg_defs .success {\nfill:#00ab00\n}\n.wavedrom_svg .h1, .wavedrom_svg_defs .h1 {\nfont-size:33pt;\nfont-weight:bold\n}\n.wavedrom_svg .h2, .wavedrom_svg_defs .h2 {\nfont-size:27pt;\nfont-weight:bold\n}\n.wavedrom_svg .h3, .wavedrom_svg_defs .h3 {\nfont-size:20pt;\nfont-weight:bold\n}\n.wavedrom_svg .h4, .wavedrom_svg_defs .h4 {\nfont-size:14pt;\nfont-weight:bold\n}\n.wavedrom_svg .h5, .wavedrom_svg_defs .h5 {\nfont-size:11pt;\nfont-weight:bold\n}\n.wavedrom_svg .h6, .wavedrom_svg_defs .h6 {\nfont-size:8pt;\nfont-weight:bold\n}\n.wavedrom_svg_defs .s1 {\nfill:none;\nstroke:#000;\nstroke-width:1;\nstroke-linecap:round;\nstroke-linejoin:miter;\nstroke-miterlimit:4;\nstroke-opacity:1;\nstroke-dasharray:none\n}\n.wavedrom_svg_defs .s2 {\nfill:none;\nstroke:#000;\nstroke-width:0.5;\nstroke-linecap:round;\nstroke-linejoin:miter;\nstroke-miterlimit:4;\nstroke-opacity:1;\nstroke-dasharray:none\n}\n.wavedrom_svg_defs .s3 {\ncolor:#000;\nfill:none;\nstroke:#000;\nstroke-width:1;\nstroke-linecap:round;\nstroke-linejoin:miter;\nstroke-miterlimit:4;\nstroke-opacity:1;\nstroke-dasharray:1,3;\nstroke-dashoffset:0;\nmarker:none;\nvisibility:visible;\ndisplay:inline;\noverflow:visible;\nenable-background:accumulate\n}\n.wavedrom_svg_defs .s4 {\ncolor:#000;\nfill:none;\nstroke:#000;\nstroke-width:1;\nstroke-linecap:round;\nstroke-linejoin:miter;\nstroke-miterlimit:4;\nstroke-opacity:1;\nstroke-dasharray:none;\nstroke-dashoffset:0;\nmarker:none;\nvisibility:visible;\ndisplay:inline;\noverflow:visible\n}\n.wavedrom_svg_defs .s5 {\nfill:#fff;\nstroke:none\n}\n.wavedrom_svg_defs .s6 {\ncolor:#000;\nfill:#ffffb4;\nfill-opacity:1;\nfill-rule:nonzero;\nstroke:none;\nstroke-width:1px;\nmarker:none;\nvisibility:visible;\ndisplay:inline;\noverflow:visible;\nenable-background:accumulate\n}\n.wavedrom_svg_defs .s7 {\ncolor:#000;\nfill:#ffe0b9;\nfill-opacity:1;\nfill-rule:nonzero;\nstroke:none;\nstroke-width:1px;\nmarker:none;\nvisibility:visible;\ndisplay:inline;\noverflow:visible;\nenable-background:accumulate\n}\n.wavedrom_svg_defs .s8 {\ncolor:#000;\nfill:#b9e0ff;\nfill-opacity:1;\nfill-rule:nonzero;\nstroke:none;\nstroke-width:1px;\nmarker:none;\nvisibility:visible;\ndisplay:inline;\noverflow:visible;\nenable-background:accumulate\n}\n.wavedrom_svg_defs .s9 {\nfill:#000;\nfill-opacity:1;\nstroke:none\n}\n.wavedrom_svg_defs .s10 {\ncolor:#000;\nfill:#fff;\nfill-opacity:1;\nfill-rule:nonzero;\nstroke:none;\nstroke-width:1px;\nmarker:none;\nvisibility:visible;\ndisplay:inline;\noverflow:visible;\nenable-background:accumulate\n}\n.wavedrom_svg_defs .s11 {\nfill:#0041c4;\nfill-opacity:1;\nstroke:none\n}\n.wavedrom_svg_defs .s12 {\nfill:none;\nstroke:#0041c4;\nstroke-width:1;\nstroke-linecap:round;\nstroke-linejoin:miter;\nstroke-miterlimit:4;\nstroke-opacity:1;\nstroke-dasharray:none\n}\n</style>\n"},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/templates_manager_view":function(e,t,n){var i,r,o,a,s,l,c,u,d,p,f,h={}.hasOwnProperty;l=t("./view"),o=t("../lib/notifier"),i=t("../application"),r=t("../lib/config_sync"),s=t("../lib/utils"),p=t("./templates/templates_manager"),f=null,u=null,d=0,c=null,a=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)h.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(n,e),n.prototype.template=p,n.prototype.className="ui fullscreen story_modal modal templates_manager_modal",n.prototype.defaultTemplateId=null,n.prototype.attachments={},n.prototype.initialize=function(){return this.applicationProfileModel=i.getApplicationProfileModel(),this.defaultTemplateId=this.applicationProfileModel.get("newFileTemplateId")},n.prototype.events={"click .save_button":"createOrUpdateTemplateFn","click .new_button":"createNewTemplateFn","click .default_button":"setDefaultTemplateFn","click .remove_button":"removeTemplateFn","click .modify_button":"modifyTemplateFn","click .cancel_button":"cancelModifyTemplateFn","click .previous_button":"previousPageFn","click .next_button":"nextPageFn","click .attachment_item":"downloadAttachmentFn","click .delete_attachment":"deleteAttachmentFn","click .drop-zone":"selectFileFn","click .save_basic_button":"saveBasicTemplateFn","click .modify_basic_button":"modifyBasicTemplateFn","click .cancel_basic_button":"cancelBasicTemplateFn","click .export_templates_button":"exportTemplatesFn","click .import_templates_button":"importTemplatesFn","click .help_button":"helpFn"},n.prototype.helpFn=function(){return window.openTarget("http://soft.xiaoshujiang.com/blog/file_template_manager")},n.prototype.exportTemplatesFn=function(){return f.dumpPouchDB()},n.prototype.importTemplatesFn=function(){return f.$el.find("input[name=importTemplates]").trigger("click")},n.prototype.dumpPouchDBByBlob=function(){var e,t,n;return"templates.dump",e=new xsjStream.BlobStream(null,{readable:!1}),t=null,e.on("finish",(function(){return t=this.toBlob(),console.log("finished ...")})),n=r.getCurrentConfigDB(),f.dimmer.dimmer("show"),n.dump(e,{batch_size:1,filter:function(e){return!(!e.type||"template"!==e.type)}}).then((function(){return null!=f&&f.dimmer.dimmer("hide"),o.showMessage("\u5bfc\u51fa\u6210\u529f",3e3,"info"),saveAs(t,moment().format("YYYY-MM-DD")+"_templates.xsj")})).catch((function(e){return null!=f&&f.dimmer.dimmer("hide"),o.showMessage("\u5bfc\u51fa\u5931\u8d25: "+e,6e3,"error")}))},n.prototype.dumpPouchDB=function(){if(confirm("\u786e\u8ba4\u662f\u5426\u5bfc\u51fa\u6240\u6709\u6a21\u677f\u6570\u636e"))return window.requestFileSystem?(f.dumpPouchDBByFileSystem((function(){return f.dumpPouchDBByBlob()})),console.log("use filesystem dump")):(f.dumpPouchDBByBlob(),console.log("use blob dump"))},n.prototype.dumpPouchDBByFileSystem=function(e){var t,n,i;return"templates.dump",n=function(t){return e?e():o.showMessage("\u5bfc\u51fa\u5931\u8d25: "+t,6e3,"error")},i=function(e){var n;return n=function(){return e.root.getFile("templates.dump",{create:!0},(function(e){return t(e)}))},e.root.getFile("templates.dump",null,(function(e){return e.remove(n,n)}),n)},t=function(e){var t,n;return t=new xsjStream.FileSystemStream(e),n=r.getCurrentConfigDB(),f.dimmer.dimmer("show"),n.dump(t,{batch_size:1,filter:function(e){return!(!e.type||"template"!==e.type)}}).then((function(){var t;return null!=f&&f.dimmer.dimmer("hide"),o.showMessage("\u5bfc\u51fa\u6210\u529f",3e3,"info"),(t=document.createElement("a")).href=e.toURL(),t.download=moment().format("YYYY-MM-DD")+"_templates.xsj",t.click()})).catch((function(e){return null!=f&&f.dimmer.dimmer("hide"),o.showMessage("\u5bfc\u51fa\u5931\u8d25: "+e,6e3,"error")}))},requestFileSystem(window.TEMPORARY,5368709120,i,n)},n.prototype.saveBasicTemplateFn=function(){var e;if(f.save(),o.showMessage("\u4fdd\u5b58\u57fa\u7840\u6a21\u677f\u6210\u529f"),e=f.$el.find(".templates_container tbody tr"),f.$el.find(".new_button").show(),0!==e.length)return f.showTemplatesContainer()},n.prototype.modifyBasicTemplateFn=function(){return f.showDefaultTemplateContainer()},n.prototype.cancelBasicTemplateFn=function(){return f.showTemplatesContainer()},n.prototype.selectFileFn=function(){return f.$el.find("input[name=attachments]").trigger("click")},n.prototype.deleteAttachmentFn=function(e){var t,n;return e.preventDefault(),e.stopPropagation(),n=(t=$(e.currentTarget).parent()).data("id"),delete f.attachments[n],t.remove()},n.prototype.downloadAttachmentFn=function(e){var t,n,i,r,o;return r=$(e.currentTarget).data("id"),t=f.attachments[r],n=s.base642Blob(t.data,t.content_type),(o=(i=r).lastIndexOf("/"))>0&&(i=i.substring(o+1)),saveAs(n,i)},n.prototype.previousPageFn=function(e){if(!$(e.currentTarget).hasClass("disabled"))return u?f._renderTemplates(u):o.showMessage("\u5df2\u7ecf\u662f\u7b2c\u4e00\u9875",1e3,"warning")},n.prototype.nextPageFn=function(e){if(!$(e.currentTarget).hasClass("disabled"))return c?f._renderTemplates(null,c):o.showMessage("\u5df2\u7ecf\u662f\u6700\u540e\u4e00\u9875",1e3,"warning")},n.prototype.cancelModifyTemplateFn=function(){return 0===f.$el.find(".templates_container tbody tr").length?f.showDefaultTemplateContainer(!0):f.showTemplatesContainer()},n.prototype.modifyTemplateFn=function(e){var t;return t=$(e.currentTarget).parent().parent().parent().data("id"),r.getTemplate(t,{attachments:!0,binary:!1},(function(e,t){var n,i;return e?o.showMessage("\u8bfb\u53d6\u6a21\u677f\u5931\u8d25:"+e,6e3,"error"):(i=(i=t.tagNames)&&i.length>0?i.join(","):"",f.$el.find("input[name=templateName]").val(t.templateName),f.$el.find("input[name=canScript]").prop("checked",!!t.canScript),f.$el.find("input[name=title]").val(t.title),f.$el.find("input[name=id]").val(t._id),f.$el.find("textarea[name=content]").val(t.content),f.$el.find("textarea[name=cssText]").val(t.cssText),f.$el.find("input[name=category]").val(t.category),f.$el.find("input[name=tagNames]").val(i),n=f.$el.find(".attachments_container"),f.attachments={},n.empty(),$.each(t._attachments||{},(function(e,t){var i;return i=$("<div></div>").text(e).html(),n.append('<a class="item attachment_item" data-id="'+i+'">'+i+' &nbsp;&nbsp;<i class="remove red icon delete_attachment"></i></a>'),f.attachments[e]={data:t.data,content_type:"application/octet-stream"}})),f.showTemplateContainer())}))},n.prototype.removeTemplateFn=function(e){var t,n,i;return t=$(e.currentTarget),i=(n=t.parent().parent().parent()).data("id"),r.deleteTemplate(i,(function(e){var t;return e?o.showMessage("\u5220\u9664\u5931\u8d25:"+e,6e3,"error"):(t=n.parent(),n.remove(),0!==t.find("tr").length||u||c?void 0:f.showDefaultTemplateContainer(!0))}))},n.prototype.showTemplatesContainer=function(){return f.$el.find(".templates_container").show(),f.$el.find(".pagination_button").show(),f.$el.find(".template_container").hide(),f.$el.find(".template_default").hide(),f.$el.find(".need_disabled").addClass("disabled"),f.$el.find(".attachments_container").empty(),f.attachments={},f.$el.find(".save_button").hide(),f.$el.find(".cancel_button").hide(),f.$el.find(".new_button").show(),f.$el.find(".save_basic_button").hide(),f.$el.find(".cancel_basic_button").hide(),f.$el.find(".modify_basic_button").show(),f.$el.find(".export_templates_button").show(),f.$el.find(".import_templates_button").show()},n.prototype.showDefaultTemplateContainer=function(e){return null==e&&(e=!1),f.$el.find(".templates_container").hide(),f.$el.find(".pagination_button").hide(),f.$el.find(".template_container").hide(),f.$el.find(".template_default").show(),f.$el.find(".attachments_container").empty(),f.attachments={},f.$el.find(".save_button").hide(),f.$el.find(".cancel_button").hide(),f.$el.find(".export_templates_button").hide(),e?(f.$el.find(".new_button").show(),f.$el.find(".import_templates_button").show(),f.$el.find(".cancel_basic_button").hide()):(f.$el.find(".new_button").hide(),f.$el.find(".import_templates_button").hide(),f.$el.find(".cancel_basic_button").show()),f.$el.find(".modify_basic_button").hide(),f.$el.find(".save_basic_button").show()},n.prototype.showTemplateContainer=function(){return f.$el.find(".templates_container").hide(),f.$el.find(".pagination_button").hide(),f.$el.find(".template_container").show(),f.$el.find(".template_default").hide(),f.$el.find(".save_button").show(),f.$el.find(".cancel_button").show(),f.$el.find(".new_button").hide(),f.$el.find(".modify_basic_button").hide(),f.$el.find(".save_basic_button").hide(),f.$el.find(".cancel_basic_button").hide(),f.$el.find(".export_templates_button").hide(),f.$el.find(".import_templates_button").hide()},n.prototype.setDefaultTemplateFn=function(e){var t,n,i;return i=(t=$(e.currentTarget).parent().parent().parent()).data("id"),f.$el.find(".default_template").removeClass("default_template positive"),t.addClass("default_template positive"),f.defaultTemplateId=i,(n=f.applicationProfileModel).set({newFileTemplateId:i}),n.save()},n.prototype.createOrUpdateTemplateFn=function(){var e,t,n,i,a,s,l,c,u;return console.log("create or update"),s=f.$el.find("input[name=id]").val(),c=$.trim(f.$el.find("input[name=templateName]").val()),e=f.$el.find("input[name=canScript]").is(":checked"),u=$.trim(f.$el.find("input[name=title]").val()),n=f.$el.find("textarea[name=content]").val(),i=f.$el.find("textarea[name=cssText]").val(),t=f.$el.find("input[name=category]").val(),l=(l=$.trim(f.$el.find("input[name=tagNames]").val()))?l.split(","):[],a={_id:s,templateName:c,canScript:e,title:u,content:n,cssText:i,category:t,tagNames:l,_attachments:f.attachments},r.createOrUpdateTemplate(a,(function(e,t){return e?o.showMessage("\u4fdd\u5b58\u51fa\u9519:"+e,6e3,"error"):(a._id=t.id,a._rev=t.rev,f.$el.find("."+a._id).remove(),f.showTemplatesContainer(),o.showMessage("\u4fdd\u5b58\u6210\u529f"),f._renderTemplates())}))},n.prototype._renderTemplate=function(e,t){var n,i,r,o;return o=0,void 0!==t&&(o=d+t+1),n=f.$el.find(".templates_container_body"),r="",e._id===f.defaultTemplateId&&(r="positive default_template"),i=$("<div></div>").text(e.templateName).html()||"\u672a\u547d\u540d\u6a21\u677f\u6587\u4ef6",n.append('<tr class="'+e._id+" "+r+'" data-id="'+e._id+'">\n  <td>'+o+"</td>\n  <td>"+i+'</td>\n  <td>\n    <div">\n      <div class="ui basic mini button default_button">\u9ed8\u8ba4</div>\n      <div class="ui basic mini button modify_button">\u4fee\u6539</div>\n      <div class="ui basic mini button remove_button">\u5220\u9664</div>\n    </div>\n  </td>\n</tr>')},n.prototype._renderTemplates=function(e,t){var n;return e||t||(d=0),n={type:"template",sort:{$lt:[]},updateDate:{$lt:[]}},e&&((d-=20)<0?(d=0,e=null,t=null):n={type:"template",sort:{$gt:e.sort||null},updateDate:{$gt:e.updateDate||null}}),t&&(n={type:"template",sort:{$lt:t.sort||[]},updateDate:{$lt:t.updateDate||[]}},d+=20),this.dimmer.dimmer("show"),r.getTemplates(n,21,!!e,(function(n,i){return f.dimmer.dimmer("hide"),n?o.showMessage("\u52a0\u8f7d\u6a21\u677f\u51fa\u9519\uff1a"+n,6e3,"error"):(f.$el.find(".templates_container_body").empty(),c=null,u=null,e&&(c=i.docs[i.docs.length-1],u=null),t&&(c=null,u=i.docs[0]),21===i.docs.length&&(e?(i.docs.shift(),u=i.docs[0]):(i.docs.pop(),c=i.docs[i.docs.length-1])),u?f.$el.find(".previous_button").removeClass("disabled"):f.$el.find(".previous_button").addClass("disabled"),c?f.$el.find(".next_button").removeClass("disabled"):f.$el.find(".next_button").addClass("disabled"),i.docs.length+d>0&&f.showTemplatesContainer(),i.docs.forEach(f._renderTemplate))}))},n.prototype.createNewTemplateFn=function(){return f.showTemplateContainer(),f.$el.find("input").val(""),f.$el.find("textarea[name=content]").val(f.$el.find("textarea[name=newFileTemplate]").val()),f.$el.find("textarea[name=cssText]").val(""),f.$el.find("input[name=category]").val(""),f.$el.find(".attachments_container").empty(),f.attachments={}},n.prototype.remove=function(){return n.__super__.remove.apply(this,arguments),c=null,u=null,f=null},n.prototype.afterRender=function(){var e,t,n,a;return a=this.applicationProfileModel.get("newFileTemplate")||"",(f=this).$el.find(".pagination_button, .init_hide_button").hide(),this.$el.find("textarea[name=newFileTemplate]").val(a),e=f.$el.find(".attachments_container"),t=function(t){return s.insertImageFiles(t,(function(t,n){var r,a,l,c,u,d,p;if(!t){for(f.$el.find("input[name=attachments]").val(""),p=[],c=0,u=n.length;c<u;c++)d=n[c],a=d.content,d.path,l=d.file,r=s.dataURL2Blob(a),p.push(s.blobToMd5(r,(function(t,n){var o,s,c,u,d;return d=i.getUploadFilePath(l.type,null,l.name,n,r),s=$("<div></div>").text(d).html(),c=a.split(",")[1],f.attachments[d]||e.append('<a class="item attachment_item" data-id="'+s+'">'+s+' &nbsp;&nbsp;<i class="remove red icon delete_attachment"></i></a>'),u=(o=f.$el.find("textarea[name=content]")).val(),u+="\n![](./"+d+")",o.val(u),f.attachments[d]={data:c,content_type:l.type}})));return p}o.showMessage("error: +"+t,6e3,"error")}))},s.initFileImportSupport(f.$el.find("input[name=attachments]"),t),s.initdragFilesSupport(f.$el.find(".drop-zone"),t),n=function(e){var t,n,i;if(e.length>0)return n=e[0],i=fileReaderStream(n,{chunkSize:20971520}),t=r.getCurrentConfigDB(),f.dimmer.dimmer("show"),t.load(i).then((function(){return null!=f&&f.dimmer.dimmer("hide"),o.showMessage("\u5bfc\u5165\u6210\u529f",3e3,"info"),f._renderTemplates()})).catch((function(e){return null!=f&&f.dimmer.dimmer("hide"),o.showMessage("\u5bfc\u5165\u5931\u8d25: "+e,6e3,"error")}))},s.initFileImportSupport(f.$el.find("input[name=importTemplates]"),n)},n.prototype.getRenderData=function(){return{}},n.prototype.save=function(){var e,t;return t=this.$el.find("textarea[name=newFileTemplate]").val(),(e=this.applicationProfileModel).set({newFileTemplate:t}),e.save()},n.prototype.show=function(){return f=this,this.render(),this.dimmer=s.xsjDimmer(this.$el),this.dimmer.dimmer("show"),t("../lib/dynamic_import/import_pouchdb_replication_stream")((function(){return f.$el.modal({closable:!1,onVisible:function(){return console.log("visible...."),f.showDefaultTemplateContainer(!0),c=null,u=null,f._renderTemplates()},onHidden:function(){return f.$el.modal("destroy"),f.remove()}}).modal("show")}))},n}(l),n.exports=a}}),window.requirejs.define({"views/templates_select_dialog_view":function(e,t,n){var i,r,o,a,s,l,c,u,d,p,f,h,m,v,g=function(e,t){return function(){return e.apply(t,arguments)}},w={}.hasOwnProperty;l=t("./view"),t("../lib/utils"),a=t("../lib/notifier"),t("../constant"),r=t("../lib/config_sync"),o=t("./dropdown_tag_name_view"),i=t("../application"),h=t("./templates/templates_select_dialog"),m=null,d=null,p=!1,f=!1,u=null,c=function(){var e;return m?(e=m.$el.find(".clean_search_input_wrapper"),m.$el.find(".search_input").val()?e.removeClass("blank"):e.addClass("blank")):null},v=_.throttle(c,1e3),s=function(e){function t(){return this.searchDocumentEnter=g(this.searchDocumentEnter,this),this.searchDocument=g(this.searchDocument,this),this.cleanSearchInput=g(this.cleanSearchInput,this),t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)w.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.template=h,t.prototype.className="ui standard story_modal modal files_manager_dialog_view templates_select_dialog_view",t.prototype.events={"click .search_button":"searchDocument","keydown .search_input":"searchDocumentEnter","click .clean_search_input_wrapper":"cleanSearchInput","click .files_items>.item":"selectTemplateFn"},t.prototype.selectTemplateFn=function(e){var t;return t=$(e.currentTarget).data("id"),$(window).trigger("newFileModel",t),m.$el.modal("hide")},t.prototype.cleanSearchInput=function(){var e;return this.$el.find(".search_input").val(""),this.$el.find(".clean_search_input_wrapper").addClass("blank"),e=u.getQueryTags(),m.search("",e,!1)},t.prototype.searchDocument=function(){var e,t;return e=this.$el.find(".search_input").val(),t=u.getQueryTags(),m.search(e,t)},t.prototype.searchDocumentEnter=function(e){var t,n;return 13!==e.which&&13!==e.keyCode||(t=this.$el.find(".search_input").val(),n=u.getQueryTags(),m.search(t,n)),v()},t.prototype.initialize=function(e){return r.getCurrentConfigDB()},t.prototype.search=function(e,t){var n;if(null==e&&(e=""),null==t&&(t=[]),p=!1,!f){if(null!=(n=m.waypoint)&&n.destroy(),m.waypoint=null,m._getFilesItemsHtml().empty(),e||0!==t.length)return m._refresh(e,t);m.refresh()}},t.prototype._getFilesItemsHtml=function(){var e;return(e=m.$el.find(".files_items")).hasClass("hide")&&e.removeClass("hide"),e},t.prototype._setBlankHtml=function(){var e;return null!=(e=m.waypoint)&&e.destroy(),m.waypoint=null,p||m.$el.find(".files_items").html('<div class="ui segment">\n  <h2 class="ui header aligned center icon green">\n    <i class="smile icon"></i>\n    <div class="sub header">\u6ca1\u6709\u627e\u5230\u4f60\u60f3\u8981\u7684\u6587\u4ef6</div>\n  </h2>\n</div>'),p=!1},t.prototype.refresh=function(){return m._getFilesItemsHtml().html(""),m._refresh()},t.prototype._refresh=function(e,t,n,i){var o,s,l,c;return null==e&&(e=""),null==t&&(t=[]),null==n&&(n=null),null==i&&(i=0),f=!0,s=e,l=t,o=m._getFilesItemsHtml(),m.dimmer.dimmer("show"),null!=(c=m.waypoint)&&c.disable(),n||(n={type:"template",sort:{$lte:[]},updateDate:{$lte:[]}}),e&&(n.templateName={$regex:".*?"+e+".*?"}),l&&l.length>0&&(n.tagNames={$in:l}),r.getTemplates(n,21,!1,(function(e,t){var i,r;if(d=null,m.dimmer.dimmer("hide"),f=!1,!e)return t.docs.length>0?(p=!1,21===(r=t.docs).length&&(d=r.pop()),m.renderDocs(o,r,[s]),m.waypoint?m.waypoint.enable():(i=o.waypoint({offset:"bottom-in-view",context:o.parent()[0],handler:function(e){if("down"===e)return d&&!f?(p=!0,Object.assign(n,{type:"template",sort:{$lte:d.sort||[]},updateDate:{$lte:d.updateDate||[]}}),m._refresh(s,l,n)):void 0}}),m.waypoint=i[0])):m._setBlankHtml();a.showMessage("\u52a0\u8f7d\u51fa\u9519\uff1a"+e,6e3,"error")}))},t.prototype.renderDoc=function(e,t){var n;return n=$("<div></div>").text(t.templateName).html(),e.replaceWith('<div class="item" data-id="'+t._id+'">\n  <div class="content">\n    <div class="header">\n      '+n+"\n    </div>\n  </div>\n</div>")},t.prototype.renderDocs=function(e,t){return m=this,i.getCurrentFileMode(),t.forEach((function(t,n){var i;return i=$("<div></div>"),e.append(i),m.renderDoc(i,t)}))},t.prototype.remove=function(){var e;return null!=(e=m.waypoint)&&e.destroy(),t.__super__.remove.call(this),m=null},t.prototype.afterRender=function(){return(m=this)._getFilesItemsHtml().html("")},t.prototype.show=function(){return this.render(),this.dimmer=this.$el.find(".story_content").dimmer({closable:!1,variation:"inverted",opacity:.4}),this.$el.find(".dimmer").html('<div class="ui indeterminate text loader">\u6570\u636e\u51c6\u5907\u4e2d...</div>'),this.$el.modal({onShow:function(){return m._refresh(),(u=new o({getDB:r.getCurrentConfigDB,searchTrigger:function(){return m.searchDocument()}})).render(),m.$el.find(".dropdown_tag_name_placeholder").replaceWith(u.$el),u.init()},onHidden:function(){var e;return null!=u&&u.remove(),u=null,m.$el.modal("destroy"),m.$el.parent().dimmer("destroy"),m.$el.parent().transition("destroy"),e=m.$el.parent(),m.remove(),e.remove(),null}}).modal("show")},t}(l),n.exports=s}}),window.requirejs.define({"views/themes_manager_view":function(e,t,n){var i,r,o,a,s,l,c,u,d,p,f,h,m,v={}.hasOwnProperty;c=t("./view"),a=t("../lib/notifier"),i=t("../application"),r=t("../lib/config_sync"),l=t("../lib/utils"),o=t("../lib/utils_image"),f=t("./templates/themes_manager"),h=null,m={},d=null,p=0,u=null,s=function(e){var n,s;function c(){return c.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)v.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(c,e),c.prototype.template=f,c.prototype.className="ui fullscreen story_modal modal themes_manager_modal",c.prototype.attachments={},c.prototype.selectedBaseTheme=null,c.prototype.initialize=function(){return this.applicationProfileModel=i.getApplicationProfileModel()},c.prototype.events={"click .base_theme_dropdown .item":"selectBaseThemeFn","click .save_button":"createOrUpdateThemeFn","click .new_button":"createNewThemeFn","click .remove_button":"removeThemeFn","click .modify_button":"modifyThemeFn","click .cancel_button":"cancelModifyThemeFn","click .previous_button":"previousPageFn","click .next_button":"nextPageFn","click .attachment_item":"downloadAttachmentFn","click .delete_attachment":"deleteAttachmentFn","click .drop-zone":"selectFileFn","click .export_themes_button":"exportThemesFn","click .import_themes_button":"importThemesFn","click .help_button":"helpFn"},c.prototype.selectBaseThemeFn=function(){var e,t,n,i;return event.stopPropagation(),event.preventDefault(),t=$(event.target),e=h.$el.find(".base_theme_dropdown"),n=t.data("value"),e.dropdown("set selected",[n]),e.dropdown("hide"),i=m[n],h.selectedBaseTheme=i?{id:n,name:i.name,dark:i.dark,colors:i.colors}:null},c.prototype.helpFn=function(){return window.openTarget("http://soft.xiaoshujiang.com/blog/file_theme_manager")},c.prototype.exportThemesFn=function(){return h.dumpPouchDB()},c.prototype.importThemesFn=function(){return h.$el.find("input[name=importThemes]").trigger("click")},c.prototype.dumpPouchDBByBlob=function(){var e,t,n;return"themes.dump",e=new xsjStream.BlobStream(null,{readable:!1}),t=null,e.on("finish",(function(){return t=this.toBlob(),console.log("finished ...")})),n=r.getCurrentConfigDB(),h.dimmer.dimmer("show"),n.dump(e,{batch_size:1,filter:function(e){return!(!e.type||"theme"!==e.type)}}).then((function(){return null!=h&&h.dimmer.dimmer("hide"),a.showMessage("\u5bfc\u51fa\u6210\u529f",3e3,"info"),saveAs(t,moment().format("YYYY-MM-DD")+"_themes.xsj")})).catch((function(e){return null!=h&&h.dimmer.dimmer("hide"),a.showMessage("\u5bfc\u51fa\u5931\u8d25: "+e,6e3,"error")}))},c.prototype.dumpPouchDB=function(){if(confirm("\u786e\u8ba4\u662f\u5426\u5bfc\u51fa\u6240\u6709\u4e3b\u9898\u6570\u636e"))return window.requestFileSystem?(h.dumpPouchDBByFileSystem((function(){return h.dumpPouchDBByBlob()})),console.log("use filesystem dump")):(h.dumpPouchDBByBlob(),console.log("use blob dump"))},c.prototype.dumpPouchDBByFileSystem=function(e){var t,n,i;return"themes.dump",n=function(t){return e?e():a.showMessage("\u5bfc\u51fa\u5931\u8d25: "+t,6e3,"error")},i=function(e){var n;return n=function(){return e.root.getFile("themes.dump",{create:!0},(function(e){return t(e)}))},e.root.getFile("themes.dump",null,(function(e){return e.remove(n,n)}),n)},t=function(e){var t,n;return t=new xsjStream.FileSystemStream(e),n=r.getCurrentConfigDB(),h.dimmer.dimmer("show"),n.dump(t,{batch_size:1,filter:function(e){return!(!e.type||"theme"!==e.type)}}).then((function(){var t;return null!=h&&h.dimmer.dimmer("hide"),a.showMessage("\u5bfc\u51fa\u6210\u529f",3e3,"info"),(t=document.createElement("a")).href=e.toURL(),t.download=moment().format("YYYY-MM-DD")+"_themes.xsj",t.click()})).catch((function(e){return null!=h&&h.dimmer.dimmer("hide"),a.showMessage("\u5bfc\u51fa\u5931\u8d25: "+e,6e3,"error")}))},requestFileSystem(window.TEMPORARY,5368709120,i,n)},c.prototype.selectFileFn=function(){return h.$el.find("input[name=attachments]").trigger("click")},c.prototype.deleteAttachmentFn=function(e){var t,n;return e.preventDefault(),e.stopPropagation(),n=(t=$(e.currentTarget).parent()).data("id"),delete h.attachments[n],"backgroundImage"===n&&(h.$el.find(".drop-zone").css("background-image",""),delete h.attachments.thumbnail),t.remove()},c.prototype.downloadAttachmentFn=function(e){var t,n,i,r,o;return r=$(e.currentTarget).data("id"),t=h.attachments[r],n=l.base642Blob(t.data,t.content_type),(o=(i=r).lastIndexOf("/"))>0&&(i=i.substring(o+1)),saveAs(n,i)},c.prototype.previousPageFn=function(e){if(!$(e.currentTarget).hasClass("disabled"))return d?h._renderThemes(d):a.showMessage("\u5df2\u7ecf\u662f\u7b2c\u4e00\u9875",1e3,"warning")},c.prototype.nextPageFn=function(e){if(!$(e.currentTarget).hasClass("disabled"))return u?h._renderThemes(null,u):a.showMessage("\u5df2\u7ecf\u662f\u6700\u540e\u4e00\u9875",1e3,"warning")},c.prototype.cancelModifyThemeFn=function(){return 0===h.$el.find(".themes_container tbody tr").length?h.showDefaultThemeContainer(!0):h.showThemesContainer()},c.prototype.modifyThemeFn=function(e){var t;return t=$(e.currentTarget).parent().parent().parent().data("id"),r.getTheme(t,{attachments:!0,binary:!1},(function(e,t){var n,i,r,o,s;return e?a.showMessage("\u8bfb\u53d6\u4e3b\u9898\u5931\u8d25:"+e,6e3,"error"):(o=(o=t.tagNames)&&o.length>0?o.join(","):"",h.$el.find("input[name=themeName]").val(t.themeName),h.$el.find("input[name=id]").val(t._id),h.$el.find("textarea[name=extraCssText]").val(t.extraCssText),h.$el.find("input[name=tagNames]").val(o),n=h.$el.find(".attachments_container"),h.attachments={},h.selectedBaseTheme=null,n.empty(),$.each(t._attachments||{},(function(e,t){var i;return i=$("<div></div>").text(e).html(),n.append('<a class="item attachment_item" data-id="'+i+'">'+i+' &nbsp;&nbsp;<i class="remove red icon delete_attachment"></i></a>'),h.attachments[e]={data:t.data,content_type:t.content_type||"application/octet-stream"}})),(r=h.attachments.backgroundImage)?(s="data:"+r.content_type+";base64,"+r.data,h.$el.find(".drop-zone").css("background-image","url('"+s+"')")):h.$el.find(".drop-zone").css("background-image",""),h.selectedBaseTheme=t.baseTheme,h.selectedBaseTheme&&h.selectedBaseTheme.id&&((i=h.$el.find(".base_theme_dropdown")).dropdown("set selected",[h.selectedBaseTheme.id]),h.selectedBaseTheme.name&&i.dropdown("set text",h.selectedBaseTheme.name)),h.showThemeContainer())}))},c.prototype.removeThemeFn=function(e){var t,n,i;return t=$(e.currentTarget),i=(n=t.parent().parent().parent()).data("id"),r.deleteTheme(i,(function(e){var t;return e?a.showMessage("\u5220\u9664\u5931\u8d25:"+e,6e3,"error"):(t=n.parent(),n.remove(),0!==t.find("tr").length||d||u?void 0:h.showDefaultThemeContainer(!0))}))},c.prototype.showThemesContainer=function(){return h.$el.find(".themes_container").show(),h.$el.find(".pagination_button").show(),h.$el.find(".theme_container").hide(),h.$el.find(".theme_default").hide(),h.$el.find(".need_disabled").addClass("disabled"),h.$el.find(".attachments_container").empty(),h.$el.find(".drop-zone").css("background-image",""),h.attachments={},h.selectedBaseTheme=null,h.$el.find(".save_button").hide(),h.$el.find(".cancel_button").hide(),h.$el.find(".new_button").show(),h.$el.find(".export_themes_button").show(),h.$el.find(".import_themes_button").show()},c.prototype.showDefaultThemeContainer=function(e){return null==e&&(e=!1),h.$el.find(".themes_container").hide(),h.$el.find(".pagination_button").hide(),h.$el.find(".theme_container").hide(),h.$el.find(".theme_default").show(),h.$el.find(".attachments_container").empty(),h.$el.find(".drop-zone").css("background-image",""),h.attachments={},h.selectedBaseTheme=null,h.$el.find(".save_button").hide(),h.$el.find(".cancel_button").hide(),h.$el.find(".export_themes_button").hide(),e?(h.$el.find(".new_button").show(),h.$el.find(".import_themes_button").show()):(h.$el.find(".new_button").hide(),h.$el.find(".import_themes_button").hide())},c.prototype.showThemeContainer=function(){return h.$el.find(".themes_container").hide(),h.$el.find(".pagination_button").hide(),h.$el.find(".theme_container").show(),h.$el.find(".theme_default").hide(),h.$el.find(".save_button").show(),h.$el.find(".cancel_button").show(),h.$el.find(".new_button").hide(),h.$el.find(".export_themes_button").hide(),h.$el.find(".import_themes_button").hide()},n=function(e){var t,n;return h.attachments.backgroundImage&&h.attachments.backgroundImage.data&&!h.attachments.thumbnail?(n="data:"+(t=h.attachments.backgroundImage).content_type+";base64,"+t.data,o.resizeImage(n,200,(function(n,i){var r;return i&&(r=i.split(",")[1],h.attachments.thumbnail={data:r,content_type:t.content_type}),e()}))):e()},c.prototype.createOrUpdateThemeFn=function(){var e,t,i,o,s;return i=h.$el.find("input[name=id]").val(),s=$.trim(h.$el.find("input[name=themeName]").val()),t=h.$el.find("textarea[name=extraCssText]").val(),o=(o=$.trim(h.$el.find("input[name=tagNames]").val()))?o.split(","):[],e={_id:i,themeName:s,extraCssText:t,tagNames:o,baseTheme:h.selectedBaseTheme,_attachments:h.attachments},"theme_random"===i&&delete e._id,n((function(){return r.createOrUpdateTheme(e,(function(t,n){return t?a.showMessage("\u4fdd\u5b58\u51fa\u9519:"+t,6e3,"error"):(e._id=n.id,e._rev=n.rev,h.$el.find("."+e._id).remove(),h.showThemesContainer(),(h.applicationProfileModel.get("themeInfo")||"").indexOf(e._id)>0&&$(window).trigger("refreshTheme"),a.showMessage("\u4fdd\u5b58\u6210\u529f"),h._renderThemes())}))}))},c.prototype._renderTheme=function(e,t){var n,i,r;return r=0,void 0!==t&&(r=p+t+1),n=h.$el.find(".themes_container_body"),"",i=$("<div></div>").text(e.themeName).html()||"\u672a\u547d\u540d\u4e3b\u9898\u6587\u4ef6",n.append('<tr class="'+e._id+' " data-id="'+e._id+'">\n  <td>'+r+"</td>\n  <td>"+e._id+"</td>\n  <td>"+_.escape(i)+'</td>\n  <td>\n    <div">\n      <div class="ui basic mini button modify_button">\u4fee\u6539</div>\n      <div class="ui basic mini button remove_button">\u5220\u9664</div>\n    </div>\n  </td>\n</tr>')},c.prototype._renderThemes=function(e,t,n){var i;return null==n&&(n=!0),e||t||(p=0),i={type:"theme",sort:{$lt:[]},updateDate:{$lt:[]}},e&&((p-=20)<0?(p=0,e=null,t=null):i={type:"theme",sort:{$gt:e.sort||null},updateDate:{$gt:e.updateDate||null}}),t&&(i={type:"theme",sort:{$lt:t.sort||[]},updateDate:{$lt:t.updateDate||[]}},p+=20),h.dimmer.dimmer("show"),r.getThemes(i,21,!!e,(function(i,r){return h.dimmer.dimmer("hide"),i?a.showMessage("\u52a0\u8f7d\u4e3b\u9898\u51fa\u9519\uff1a"+i,6e3,"error"):(h.$el.find(".themes_container_body").empty(),u=null,d=null,e&&(u=r.docs[r.docs.length-1],d=null),t&&(u=null,d=r.docs[0]),21===r.docs.length&&(e?(r.docs.shift(),d=r.docs[0]):(r.docs.pop(),u=r.docs[r.docs.length-1])),d?h.$el.find(".previous_button").removeClass("disabled"):h.$el.find(".previous_button").addClass("disabled"),u?h.$el.find(".next_button").removeClass("disabled"):h.$el.find(".next_button").addClass("disabled"),r.docs.length+p>0&&n&&h.showThemesContainer(),r.docs.forEach(h._renderTheme))}))},c.prototype.createNewThemeFn=function(){return h.showThemeContainer(),h.$el.find("input").val(""),h.$el.find("textarea[name=extraCssText]").val(""),h.$el.find(".attachments_container").empty(),h.$el.find(".drop-zone").css("background-image",""),h.attachments={},h.selectedBaseTheme=null},c.prototype.remove=function(){return h.$el.find(".base_theme_dropdown").dropdown("destroy"),c.__super__.remove.apply(this,arguments),u=null,d=null,h=null},c.prototype.afterRender=function(){var e,t,n;return(h=this).$el.find(".pagination_button, .init_hide_button").hide(),e=h.$el.find(".attachments_container"),t=function(t){return l.insertImageFiles(t,(function(t,n){var i,r,o,s,l,c;if(!t)return h.$el.find("input[name=attachments]").val(""),n&&n.length>0?(o=(c=n[0]).content,c.path,s=c.file,/jp[e]?g|svg/i.test(s.type)?s.size>10485760?void a.showMessage("\u6dfb\u52a0\u7684\u80cc\u666f\u56fe\u7247\u592a\u5927,\u4e0d\u80fd\u8d85\u8fc7 10M",6e3,"error"):(l="backgroundImage",i=$("<div></div>").text(l).html(),r=o.split(",")[1],h.attachments[l]||e.append('<a class="item attachment_item" data-id="'+i+'">'+i+' &nbsp;&nbsp;<i class="remove red icon delete_attachment"></i></a>'),h.$el.find(".drop-zone").css("background-image","url('"+o+"')"),h.attachments[l]={data:r,content_type:s.type},delete h.attachments.thumbnail):void a.showMessage("\u6dfb\u52a0\u80cc\u666f\u56fe\u7247\u5931\u8d25, \u4ec5\u652f\u6301 jpg \u683c\u5f0f\u7684\u56fe\u7247\u6587\u4ef6",6e3,"error")):void 0;a.showMessage("error: +"+t,6e3,"error")}))},l.initFileImportSupport(h.$el.find("input[name=attachments]"),t),l.initdragFilesSupport(h.$el.find(".drop-zone"),t),n=function(e){var t,n,i;if(e.length>0)return n=e[0],i=fileReaderStream(n,{chunkSize:20971520}),t=r.getCurrentConfigDB(),h.dimmer.dimmer("show"),t.load(i).then((function(){return null!=h&&h.dimmer.dimmer("hide"),a.showMessage("\u5bfc\u5165\u6210\u529f",3e3,"info"),h._renderThemes()})).catch((function(e){return null!=h&&h.dimmer.dimmer("hide"),a.showMessage("\u5bfc\u5165\u5931\u8d25: "+e,6e3,"error")}))},l.initFileImportSupport(h.$el.find("input[name=importThemes]"),n)},c.prototype.getRenderData=function(){return{}},s=function(){return h.$el.find(".base_theme_dropdown").dropdown({action:function(){},saveRemoteData:!0,forceSelection:!1,filterRemoteData:!1,className:{selected:"skip_selected"},delay:{hide:1e3},onShow:function(){return!0},templates:{menu:function(e,t){var n,i,r;return r=e[t.values]||{},i="",h.selectedBaseTheme&&(i=h.selectedBaseTheme.id),"            ",n=[],$.each(r,(function(e,r){var o,a,s,l,c;if(c=r[t.value],l=r[t.name],a=r.dark||!1?"moon":"sun",o=i===c?"active":"",s="",r.colors)return s="background: conic-gradient("+Object.values(r.colors).join(",")+");",n.push('<div class="item '+o+'" data-value="'+c+'" data-name="'+_.escape(l)+'"><span style="'+s+';display:inline-block;width:1em;margin-right:1em;">&nbsp;</span><i class="'+a+' icon"></i>'+_.escape(r[t.name])+"</div>")})),"            \n"+n.join("")}},onHide:function(e){return $(this)},apiSettings:{responseAsync:function(e,t){return function(e,t){return function(e){return $.getJSON("css/themes.json").then((function(t,n){var i;return m=i=t,e(null,i)})).fail((function(e){return a.showMessage("\u52a0\u8f7d\u8d44\u6e90\u51fa\u9519",6e3,"error")}))}((function(n,i){var r,o,a,s,l;if(o=!1,a=[],e)try{o=new RegExp("(^|\\W)"+e,"gi")}catch(e){o=!1}for(r in i)s=r,(l=i[r]).value=r,l.key=r,l.search&&l.search.terms&&l.search.terms.length>0&&(s+=l.search.terms.join(" ")),(!o||s.match(o))&&a.push(l);return t({success:!0,results:a})}))}(e.urlData.query,t)}}})},c.prototype.show=function(e){var n,r;if(null==e&&(e=!0),n=!1,(r=i.getUserModel().get("user"))&&r.vip&&(n=!0),"web"===STORY_PLATFORM&&(n=!0),n)return h=this,this.render(),this.dimmer=l.xsjDimmer(this.$el),h.dimmer.dimmer("show"),t("../lib/dynamic_import/import_pouchdb_replication_stream")((function(){return h.$el.modal({closable:!1,onVisible:function(){return u=null,d=null,e?(h._renderThemes(null,null,!1),h.createNewThemeFn()):(h.showDefaultThemeContainer(!0),h._renderThemes(null,null)),s()},onHidden:function(){return h.$el.modal("destroy"),h.dimmer.dimmer("destroy"),h.remove()}}).modal("show")}));a.showMessage("\u81ea\u5b9a\u4e49\u4e3b\u9898\u53ea\u5bf9\u4f1a\u5458\u5f00\u653e",6e3,"error")},c}(c),n.exports=s}}),window.requirejs.define({"views/tmpl_manager/templates/tmpl_discovery_dialog":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<div class="content story_content">\n<div class="tmpl_discovery_container">\n<div class="tmpl_discovery_left">\n<div class="ui vertical fluid tabular menu tmpl_discovery_menu">\n</div>\n</div>\n<div class="tmpl_discovery_right">\n<div class="tmpl_discovery_list_container ui items divided link">\n</div>\n<div class="tmpl_discovery_detail_container">\n<div class="tmpl_discovery_detail_content"></div>\n<div class="tmpl_discovery_detail_action">\n<div class="ui buttons massive positive" style="outline: 2px solid var(--positiveColor);outline-offset: 3px;">\n<div class="ui button save_tmpl_btn">\u4fdd\u5b58</div>\n<div class="ui button use_tmpl_btn">\u4f7f\u7528</div>\n</div>\n</div>\n<div class="ui dimmer transition visible active">\n<div class="ui loader"></div>\n</div>\n</div>\n</div>\n</div>\n</div>\n<div class="actions">\n<div class="ui basic cancel button" >\n\u5173\u95ed\n</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}}),window.requirejs.define({"views/tmpl_manager/tmpl_all_tab_view":function(e,t,n){var i,r=function(e,t){for(var n in t)o.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e},o={}.hasOwnProperty;t("../view"),t("../../application"),t("../../constant"),t("../../lib/notifier"),function(e){function t(){return t.__super__.constructor.apply(this,arguments)}r(t,e),t.prototype.className="header",t.prototype.parentView=null,t.prototype.initialize=function(e){return this.parentView=e.parentView},t.prototype.show=function(){return this.$el.show()},t.prototype.hide=function(){return this.$el.hide()}}(Backbone.View),i=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return r(t,e),t.prototype.className="all_tmpl_container",t.prototype.type="all",t.prototype.initialize=function(e){return this.tmplDropdownView=e.tmplDropdownView,this.$target=e.$target,this.render()},t.prototype.destroy=function(){return this.remove()},t.prototype.show=function(){return this.$target.show(),this.tmplDropdownView.$el.find(".tmpl_search_container").show()},t.prototype.hide=function(){return this.$target.hide(),this.tmplDropdownView.$el.find(".tmpl_search_container").hide()},t}(Backbone.View),n.exports=i}}),window.requirejs.define({"views/tmpl_manager/tmpl_category_tab_view":function(e,t,n){var i,r,o,a,s=function(e,t){for(var n in t)l.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e},l={}.hasOwnProperty;t("../view"),t("../../application"),t("../../constant"),r=t("../../lib/notifier"),i=t("../../lib/config_sync"),a=function(e){var t;function n(){return n.__super__.constructor.apply(this,arguments)}return s(n,e),n.prototype.parentView=null,t=!1,n.prototype.events={"click .toggle_expand_button":"toggleExpandFn"},n.prototype.initialize=function(e){return this.parentView=e.parentView,this},n.prototype.toggleExpandFn=function(e){var n,i;return n=$(e.currentTarget),t=!t,i=n.find(".icon"),t?(i.removeClass("add"),i.addClass("minus"),n.attr("title","\u5168\u90e8\u6298\u53e0"),this.parentView.$el.fancytree("getRootNode").visit((function(e){return e.setExpanded(!0)}))):(i.removeClass("minus"),i.addClass("add"),n.attr("title","\u5168\u90e8\u5c55\u5f00"),this.parentView.$el.fancytree("getRootNode").visit((function(e){return e.setExpanded(!1)})))},n.prototype.show=function(){return this.$el.show()},n.prototype.hide=function(){return this.$el.hide()},n}(Backbone.View),o=function(e){var n,o;function l(){return l.__super__.constructor.apply(this,arguments)}return s(l,e),l.prototype.className="categorys_filter_tree_container theme_tree_container",l.prototype.type="category",l.prototype.headerView=null,o=!1,n=function(e){var t;return t=new a({parentView:e}),e.headerView=t,t.render(),t.$el.html('<div class="toggle_expand_button icon" style="text-align: right;margin-right: 1em;"  title="\u5168\u90e8\u5c55\u5f00"><i class="add circle icon link"></i></div>'),e.tmplDropdownView.$el.find(".tab_header").after(t.$el)},l.prototype.initialize=function(e){var a,s,l;return l=this,this.tmplDropdownView=e.tmplDropdownView,this.$target=e.$target,this.render(),this.$dimmer=this.$target.find(".dimmer"),this.$dimmer.dimmer({onShow:function(){return l.$dimmer.find(".ui.text").html("\u52a0\u8f7d\u4e2d")}}),this.$dimmer.dimmer("show"),this.$target.append(this.$el),s=function(e,t,n,i){return l.$dimmer.find(".ui.text").html("\u7d22\u5f15\u4e2d:"+e+" / "+t)},a=i.getCurrentConfigDB(),t("../../lib/dynamic_import/import_fancytree")((function(){return a.query("query_index/by_category",{reduce:!0,group:!0,showUpdateProgressInfo:s}).then((function(e){var t,i,r,a,s,c,u,d;if(l.$dimmer.dimmer("hide"),r=e.rows,i={},t={},r.reduce((function(e,n){var i;return e[i=(i=n.key.replace(/^\/*|\/*$/g,"")).replace(/\/+/g,"/")]?(e[i]+=n.value,t[i]=t[i].concat(n.ids)):(e[i]=n.value,t[i]=n.ids),e}),i),s={},r.forEach((function(e){var t,n;return(t=e.key.replace(/^[\/]*|[\/]*$/g,"").replace(/\/+/g,"/").split(/[\/]/)).length,n=s,t.forEach((function(e,t){return n[e]||(n[e]={}),n=n[e]}))})),c=l.tmplDropdownView.getTmplObjs(),(u=function(e,n,r){var o,a,s,l,d,p,f;for(l in r&&(r+="/"),d=[],n)f=n[l],a=i[s=r+l],p=(t[s]||[]).map((function(e){var t;if(t=c[e])return{title:t,key:e,folder:!1}})).filter((function(e){return!!e})),0===Object.keys(f).length?([],d.push(e.push({title:l,key:s,count:a,folder:!0,children:p}))):(u(o=[],f,s),d.push(e.push({title:l,key:s,count:a,folder:!0,children:o.concat(p)})));return d})((d={title:"\u6839\u76ee\u5f55",key:"/",children:[]}).children,s,""),a={click:function(e,t){if($(e.originalEvent.target),!t.node.folder)return l.tmplDropdownView.newFileByTemplateFn(t.node.key)},extensions:["wide","glyph","xsjcounter","filter"],filter:{mode:"dimm"},clickFolderMode:3,source:d,wide:{levelOfs:"20px"},glyph:{map:{doc:"far fa-file-alt",checkbox:"fa fa-square-o",checkboxSelected:"fa fa-check-square-o",checkboxUnknown:"fa fa-square",error:"fa fa-warning",expanderClosed:"fa fa-caret-right",expanderLazy:"fa fa-angle-right",expanderOpen:"fa fa-caret-down",folder:"far fa-folder",folderOpen:"far fa-folder-open",loading:"fa fa-spinner fa-pulse"}}},l.$el.fancytree(a),o=!0,n(l),0===e.rows.length)return l.headerView.hide()})).catch((function(e){return l.$dimmer.dimmer("hide"),r.showMessage("\u52a0\u8f7d\u5217\u8868\u51fa\u9519:"+e,6e3,"error")}))}))},l.prototype.destroy=function(){return o&&this.$el.fancytree("destroy"),o=!1,this.hide(),this.headerView&&(this.headerView.remove(),this.headerView=null),this.remove()},l.prototype.show=function(){if(this.$target.show(),this.headerView)return this.headerView.show()},l.prototype.hide=function(){if(this.$target.hide(),this.headerView)return this.headerView.hide()},l}(Backbone.View),n.exports=o}}),window.requirejs.define({"views/tmpl_manager/tmpl_discovery_dialog_view":function(e,t,n){var i,r,o,a,s,l,c,u,d,p=function(e,t){for(var n in t)f.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e},f={}.hasOwnProperty;u=t("../view"),r=t("../../constant"),i=t("../../application"),c=t("../../lib/utils"),l=t("../../lib/tmpl_manager"),o=t("../../lib/notifier"),d=t("./templates/tmpl_discovery_dialog"),a=function(e){var t,n;function a(){return a.__super__.constructor.apply(this,arguments)}return p(a,e),n=null,a.prototype.tmplDoc=null,a.prototype.fakeDoc=null,t=null,a.prototype.tmplDiscoveryDialogView=null,a.prototype.events={"click .save_tmpl_btn":"saveTmplFn","click .use_tmpl_btn":"useTmplFn"},a.prototype.saveTmplFn=function(e){var t,n,r;if(n=!1,(r=i.getUserModel().get("user"))&&r.vip&&(n=!0),"web"===STORY_PLATFORM&&(n=!0),n){if(!(t=$(e.currentTarget)).hasClass("loading"))return t.addClass("loading"),l.createTmplByDoc(this.fakeDoc,{prefixTemplateName:moment().format("YYYY-MM-DD ")},(function(e,n){return t.removeClass("loading"),o.showMessage("\u4fdd\u5b58\u6a21\u677f\u6210\u529f")}))}else o.showMessage("\u975e\u4f1a\u5458\u65e0\u6cd5\u5728\u5ba2\u6237\u7aef\u4fdd\u5b58\u4e3a\u6a21\u677f\u529f\u80fd",6e3,"error")},a.prototype.useTmplFn=function(){return $(window).trigger("newFileModel",[null,this.tmplDoc]),this.tmplDiscoveryDialogView.$el.modal("hide")},a.prototype.initialize=function(e){return this.tmplDiscoveryDialogView=e.tmplDiscoveryDialogView,this.el=e.el},a.prototype.showDimmer=function(e){if(this.$dimmer.dimmer("show"),e)return this.$el.find(".dimmer>.ui.text").html(e)},a.prototype.hideDimmer=function(){return this.$dimmer.dimmer("hide"),this.$el.find(".dimmer>.ui.text").html("\u6570\u636e\u51c6\u5907\u4e2d...")},a.prototype.render=function(){return this.$dimmer=this.$el.dimmer({closable:!1})},a.prototype.showDetail=function(){if(this.tmplDoc)return this.$el.find(".tmpl_discovery_detail_content").text(this.tmplDoc.content)},a.prototype.remove=function(){return n=null,this.fakeDoc=null,this.tmplDoc=null,a.__super__.remove.call(this)},a.prototype.show=function(e){var i;if(n=e,!t)return i=this,t=e,this.$el.addClass("visible"),i.showDimmer(),c.importZipLink(r.host+"/"+n.tmplPath,{},(function(e,r,a,s,c){var u,d,p,f;return d={},s.forEach((function(e){return d[e.name]={data:e.blob,type:e.type}})),p=Object.assign({content:a},c,{_attachments:d}),f=l.getTmplByDoc(p),n.onlyUse?i.$el.find(".save_tmpl_btn").hide():i.$el.find(".save_tmpl_btn").show(),u=function(){return i.hideDimmer(),n!==t?(t=null,i.show(n)):(t=null,i.tmplDoc=f,i.fakeDoc=p,i.showDetail())},f.canScript?_.template(f.content||"",{async:!0})({}).then((function(e){return f.content=e,u()})).catch((function(e){return f.content="\u52a0\u8f7d\u6a21\u677f\u6587\u4ef6\u51fa\u9519",o.showMessage("\u52a0\u8f7d\u6a21\u677f\u5931\u8d25:"+e,6e3,"error"),console.error("\u52a0\u8f7d\u6a21\u677f\u51fa\u9519\uff1a",e),u()})):u()}))},a.prototype.hide=function(){return this.tmplDoc=null,this.fakeDoc=null,this.$el.removeClass("visible")},a}(Backbone.View),s=function(e){var t,n,i,o;function s(){return s.__super__.constructor.apply(this,arguments)}return p(s,e),s.prototype.template=d,s.prototype.tmplDiscoveryDetailView=null,i={},o={},t="",n=null,s.prototype.className="ui fullscreen story_modal modal story_modal_scroll tmpl_discovery_dialog_modal",s.prototype.events={"click .tmpl_discovery_menu>.item":"menuItemClickFn","click .tmpl_discovery_list_container>.item":"listItemClickFn"},s.prototype.listItemClickFn=function(e){var t;return t=$(e.currentTarget).data("id"),n=n===t?null:t,this.renderTemplateDetail()},s.prototype.menuItemClickFn=function(e){var n;if(!(n=$(e.currentTarget)).hasClass("active"))return this.$el.find(".tmpl_discovery_menu>.item.active").removeClass("active"),n.addClass("active"),t=n.data("value"),this.renderTemplateList()},s.prototype.showDimmer=function(e){if(this.$dimmer.dimmer("show"),e)return this.$el.find(".dimmer>.ui.text").html(e)},s.prototype.hideDimmer=function(){return this.$dimmer.dimmer("hide"),this.$el.find(".dimmer>.ui.text").html("\u6570\u636e\u51c6\u5907\u4e2d...")},s.prototype.renderMenu=function(){var e,t,n;for(t in(e=this.$el.find(".tmpl_discovery_menu")).empty(),n=[],i)i[t],n.push('<a class="item" data-value="'+t+'">\n  '+t+"\n</a>");return e.html(n.join("")),e.find(".item:first").click()},s.prototype.renderTemplateList=function(){var e,n,r;return(e=this.$el.find(".tmpl_discovery_list_container")).empty(),r=[],(n=i[t])&&n.forEach((function(e,t){return r.push('<div class="item tmpl_item" data-id="'+e.id+'">'+(t+1)+'. <div class="content">\n    <div class="header">'+_.escape(e.name)+"</div>\n  </div>\n</div>")})),e.html(r.join(""))},s.prototype.renderTemplateDetail=function(){var e;if(e=o[n],this.tmplDiscoveryDetailView)return e?this.tmplDiscoveryDetailView.show(e):this.tmplDiscoveryDetailView.hide()},s.prototype.show=function(){var e;return e=this,this.render(),this.$dimmer=this.$el.find(".story_content").dimmer({closable:!1}),this.$el.find(".dimmer").html('<div class="ui indeterminate text loader">\u6570\u636e\u51c6\u5907\u4e2d...</div>'),this.tmplDiscoveryDetailView=new a({el:this.$el.find(".tmpl_discovery_detail_container")[0],tmplDiscoveryDialogView:this}),this.tmplDiscoveryDetailView.render(),this.$el.modal({closable:!1,onHidden:function(){return e.tmplDiscoveryDetailView&&(e.tmplDiscoveryDetailView.remove(),e.tmplDiscoveryDetailView=null),e.$el.modal("destroy"),e.remove(),e=null},onShow:function(){return fetch(r.host+"/tmpl/all-tmpls.json?fver="+moment().format("YYYYMMDD")).then((function(e){return e.json()})).then((function(t){var n;for(n in e.hideDimmer(),o={},i=t)i[n].forEach((function(e){return o[e.id]=e}));return e.renderMenu()}))}}).modal("show")},s}(u),n.exports=s}}),window.requirejs.define({"views/tmpl_manager/tmpl_dropdown_view":function(e,t,n){var i,r,o,a,s,l,c,u,d,p,f={}.hasOwnProperty;t("../../application"),t("../../lib/notifier"),i=t("../../lib/config_sync"),t("../../lib/utils"),r=t("../templates_manager_view"),c=t("./tmpl_recently_tab_view"),s=t("./tmpl_discovery_dialog_view"),o=t("./tmpl_all_tab_view"),a=t("./tmpl_category_tab_view"),d='<div style="line-height: 2;">\u60a8\u8fd8\u6ca1\u6709\u521b\u5efa\u4efb\u4f55\u6a21\u677f\uff0c\u60a8\u53ef\u4ee5<br/>\n        \u70b9\u51fb<a class="ui icon label direct_create_btn"><i class="edit icon"></i>\u65b0\u5efa</a>\u6309\u94ae\uff0c\u4f7f\u7528\u57fa\u7840\u6a21\u677f\u521b\u5efa\u6587\u7ae0<br/>\n        \u70b9\u51fb<a class="ui icon label tmpl_manager_btn" title="\u7ba1\u7406\u6a21\u677f"><i class="cog icon"></i>\u6a21\u677f\u7ba1\u7406</a>\u6309\u94ae\uff0c\u521b\u5efa\u65b0\u7684\u6a21\u677f<br/>\n        \u8fd8\u53ef\u4ee5\u70b9\u51fb<a class="ui icon label discovery_tmpl_btn" style="color: var(--negativeColor)!important;" title="\u53d1\u73b0\u6a21\u677f"><i class="heartbeat icon"></i>\u53d1\u73b0\u6a21\u677f</a>\u6309\u94ae\uff0c\u4f7f\u7528\u5c0f\u4e66\u5320\u9884\u7f6e\u7684\u6a21\u677f\u3002\n        </div>',u='<div class="ui button list_tmpl_button" data-type="discovery" title="\u53d1\u73b0\u65b0\u6a21\u677f" style="color: var(--negativeColor)!important;">\n<i class="icon heartbeat" style="color: var(--negativeColor);"></i>\n\u53d1\u73b0</div>',MINI_WEB&&(d='<div style="line-height: 2;">\u60a8\u8fd8\u6ca1\u6709\u521b\u5efa\u4efb\u4f55\u6a21\u677f\uff0c\u60a8\u53ef\u4ee5<br/>\n        \u70b9\u51fb<a class="ui icon label direct_create_btn"><i class="edit icon"></i>\u65b0\u5efa</a>\u6309\u94ae\uff0c\u4f7f\u7528\u57fa\u7840\u6a21\u677f\u521b\u5efa\u6587\u7ae0<br/>\n        \u70b9\u51fb<a class="ui icon label tmpl_manager_btn" title="\u7ba1\u7406\u6a21\u677f"><i class="cog icon"></i>\u6a21\u677f\u7ba1\u7406</a>\u6309\u94ae\uff0c\u521b\u5efa\u65b0\u7684\u6a21\u677f\n        </div>',u=""),p='<div class="menu" tabindex="-1" title="">\n <div class="header tab_header">\n   <div class="ui button list_tmpl_button" data-type="recently" title="\u6700\u8fd1\u4f7f\u7528\u7684\u6a21\u677f">\u6700\u8fd1</div>\n   <div class="ui button list_tmpl_button active" data-type="all" title="\u6240\u6709\u6a21\u677f">\u6a21\u677f</div>\n   <div class="ui button list_tmpl_button" data-type="category" title="\u5206\u7c7b\u6811\u65b9\u5f0f\u663e\u793a\u6a21\u677f">\u5206\u7c7b</div>\n   '+u+'\n   <div class="ui button list_tmpl_button" data-type="manager" title="\u7ba1\u7406\u6a21\u677f">\u7ba1\u7406</div>\n </div>\n  <div class="ui icon search input tmpl_search_container">\n    <i class="search icon"></i>\n    <input type="text" placeholder="\u641c\u7d22\u6a21\u677f...">\n  </div>\n <div class="recently_tmpl_container" style="display:none">\n     <div class="ui transition hidden dimmer">\n      <div class="ui text loader">\u52a0\u8f7d\u4e2d</div>\n    </div>\n </div>\n <div class="scrolling menu xsj_patch_menu all_tmpl_container">\n </div>\n <div class="categorys_tmpl_container" style="display:none;min-height: 100px;">\n     <div class="ui transition hidden dimmer">\n      <div class="ui text loader">\u52a0\u8f7d\u4e2d</div>\n    </div>\n </div>\n</div>',l=function(e){var t,n,l,u,h,m;function v(){return v.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)f.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(v,Backbone.View),v.prototype.el=null,h={},null,t=null,l=null,u=null,m=null,n=!1,v.prototype.initialize=function(e){return this.el=e.el,h={}},v.prototype.events={"click .xsj_patch_menu>.item":"useTmplFn","click .list_tmpl_button":"changeListTmplFn","click .tmpl_manager_btn":"tmplManagerFn","click .discovery_tmpl_btn":"discoveryTmplFn","click .direct_create_btn":"directCreateFn","click >.menu":"preventPopapFn"},v.prototype.directCreateFn=function(){return this.newFileByTemplateFn()},v.prototype.discoveryTmplFn=function(){return(new s).show()},v.prototype.tmplManagerFn=function(){(new r).show()},v.prototype.changeListTmplFn=function(e){var t,n;if(!(t=$(e.currentTarget)).hasClass("active"))return this.$el.find(".list_tmpl_button.active").removeClass("active"),t.addClass("active"),n=t.data("type"),this.changeListTmpl(n)},v.prototype.getTmplObjs=function(){return h},v.prototype.changeListTmpl=function(e){var n,i,s;if(t){if(t.type===e)return;t.hide()}switch(i=this.$el.find(".categorys_tmpl_container"),n=this.$el.find(".all_tmpl_container"),s=this.$el.find(".recently_tmpl_container"),this.$el.find(".date_tmpl_container"),e){case"category":u||(u=new a({tmplDropdownView:this,$target:i})),t=u;break;case"recently":m||(m=new c({tmplDropdownView:this,$target:s})),t=m;break;case"manager":return void(new r).show();case"discovery":return void this.discoveryTmplFn();default:l||(l=new o({tmplDropdownView:this,$target:n})),t=l}return t.show()},v.prototype.preventPopapFn=function(e){return e.preventDefault(),e.stopPropagation()},v.prototype.useTmplFn=function(e){var t;return t=$(e.currentTarget).data("value"),this.newFileByTemplateFn(t)},v.prototype.newFileByTemplateFn=function(e){return $(window).trigger("newFileModel",e)},v.prototype.initTmplBtns=function(){var e,r;return r=this,this.$el.addClass("dropdown"),this.$el.append(p),(e=this.$el).dropdown({on:"hover",saveRemoteData:!0,forceSelection:!1,filterRemoteData:!0,forceSelection:!1,className:{selected:"skip_selected"},delay:{show:1,hide:200},message:{noResults:d},templates:{menu:function(e,t){var n,i;return i=e[t.values]||[],"            ",n=[],$.each(i,(function(e,i){var r;if("query"!==i.type)return r=i.selected?"active":"",n.push('<div class="item '+r+'" data-value="'+i[t.value]+'" data-name="'+_.escape(i[t.name])+'">\n<i class="file alternate outline icon"></i>\n'+_.escape(i[t.name])+"\n  </div>")})),"            \n"+n.join("")}},action:function(){},onShow:function(){return r.changeListTmpl(),!0},onHide:function(n){var i;return!e.hasClass("xsj_actived")&&((i=$(this)).find(".list_tmpl_button.active").removeClass("active"),i.find(".list_tmpl_button[data-type=all]").addClass("active"),i.find(".menu>.menu").empty(),i.find(".menu>.message").remove(),i.dropdown("refreshItems"),t=null,null!=l&&l.destroy(),l=null,null!=u&&u.destroy(),u=null,null!=m&&m.destroy(),m=null,h={})},apiSettings:{className:{loading:"loading"},responseAsync:function(e,t){var r,o,a;if(!n)return n=!0,o={reduce:!1,group:!1},a=e.urlData.query,r=i.getCurrentConfigDB(),setTimeout((function(){return r.query("query_index/by_name",o).then((function(e){var i,r,o,s;return n=!1,s=[{type:"query"}],s=[],r=null,e.rows.sort((function(e,t){var n;return n=e.value.updateDate,t.value.updateDate-n})),a&&(o=e.rows.map((function(e){return{docId:e.id,value:e.key}})),(i=new FilteredList(o)).setFilter(a),r=i.filtered.map((function(e){return e.docId}))),e.rows.forEach((function(e){if(h[e.id]=e.key,!r||r.indexOf(e.id)>=0)return s.push({name:e.key,value:e.id})})),t({success:!0,results:s})})).catch((function(){return n=!1}))}),1)}}})},v}(),n.exports=l}}),window.requirejs.define({"views/tmpl_manager/tmpl_recently_tab_view":function(e,t,n){var i,r,o={}.hasOwnProperty;t("../../application"),t("../../lib/utils"),i=t("../../lib/recently_use_manager"),r=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)o.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,Backbone.View),t.prototype.className="recently_use_tmpl_list_container scrolling menu",t.prototype.type="recently",t.prototype.events={"click .item":"changeTmplFn"},t.prototype.applyTmpl=function(e){return this.tmplDropdownView.newFileByTemplateFn(e)},t.prototype.changeTmplFn=function(e){var t;return e.preventDefault(),e.stopPropagation(),$(e.target),t=$(e.currentTarget).data("value"),this.applyTmpl(t)},t.prototype.initialize=function(e){return this,this.tmplDropdownView=e.tmplDropdownView,this.$target=e.$target,this.render(),this.$target.append(this.$el)},t.prototype.renderItems=function(e){var t;return t=[],e.forEach((function(e){if(e&&e.id&&e.name)return t.push('<div data-value="'+_.escape(e.id)+'" class="item"><i class="file alternate icon"></i>'+_.escape(e.name)+"</div>")})),this.$el.html(t.reverse().join(""))},t.prototype.destroy=function(){return this.hide(),this.remove()},t.prototype.show=function(){var e,t;return e=i.getItems("template"),t=this.tmplDropdownView.getTmplObjs(),e=e.map((function(e){return{id:e,name:t[e]}})),this.renderItems(e),this.$target.show()},t.prototype.hide=function(){return this.$target.hide()},t}(),n.exports=r}}),window.requirejs.define({"views/toc_dropdown_view":function(e,t,n){var i,r,o,a,s,l={}.hasOwnProperty;a=t("./view"),i=t("../application"),s=t("./templates/toc_dropdown"),o=t("./table_of_content_view"),r=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)l.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(n,e),n.prototype.template=s,n.prototype.className="ui icon button toc_button",n.prototype.tocType=null,"toc_popup",n.prototype.refresh=null,n.prototype.initialize=function(e){var t,n;return this._$container=e.$container,t=Object.assign({},e,{parent:this}),this.tocType=e.tocType,this.tocView=new o(t),this.onShowDropdownFn=e.onShowDropdownFn||$.noop,this.onHideDropdownFn=e.onHideDropdownFn||$.noop,$(window).on("fileModelChanged",(n=this,function(e,t){if(n.refresh&&n.$el.popup("is visible"))return n.refresh()}))},n.prototype.toggle=function(){return this.isVisible()?this.hide():this.show()},n.prototype.hide=function(){return this.$el.popup("hide")},n.prototype.show=function(){return this.$el.popup("show")},n.prototype.isVisible=function(){return this.$el.popup("is visible")},n.prototype.showDimmer=function(){return this.tocView.showDimmer()},n.prototype.hideDimmer=function(){return this.tocView.hideDimmer()},n.prototype.afterRender=function(){var e,n,r,o,a;if(n=this,this._$container.replaceWith(this.$el),(e=this.$el).popup({position:"left center",lastResort:"left center",html:"<div></div>",on:"click",closable:!1,inline:!1,preserve:!0,exclusive:!0,context:"#main",onCreate:function(e){return this,n.tocView.render(),this.addClass("toc_popup basic"),this.html(n.tocView.$el),n.refresh=n.tocView.refresh},onHide:(a=this,function(){return a.tocView.canHide()}),onHidden:function(){return this,this.draggable("destroy"),this.resizable("destroy"),this.off("mousedown"),n.tocView.destroyToc(),n.onHideDropdownFn(n),e.removeClass("active"),localStorage.toc_popup_isShow="0"},onShow:function(){return e.addClass("active")},customPositionFn:function(e){var t;return t=localStorage.toc_popup_position,i.getTourModel().canPrompt("drag_outline_learned")&&(t=""),!!t&&(e.attr("style",t),e.find(".toc_header").visible(!0))},onVisible:function(){var e,r,o,a,s,l,c,u;if(localStorage.toc_popup_isShow="1",n.tocType&&(localStorage.toc_popup_type=n.tocType),e=this,l=function(){return localStorage.toc_popup_position=e.attr("style")},t("../lib/dynamic_import/import_fancytree")((function(){return n.tocView.initToc(),e.resizable({containment:"#main",helper:"ui-resizable-helper",handles:"e, s, se, nw",start:function(e){return n.showDimmer()},stop:function(e){return l(),n.hideDimmer()}}),e.draggable({handle:".toc_header",cancel:".toc_button .icon",stop:function(e){return l()}}),$(".draggable_dialog_focus").removeClass("draggable_dialog_focus"),e.addClass("draggable_dialog_focus"),e.on("mousedown",(function(){return $(".draggable_dialog_focus").removeClass("draggable_dialog_focus"),e.addClass("draggable_dialog_focus")})),n.onShowDropdownFn(n)})),(u=i.getTourModel()).canPrompt("drag_outline_learned"))return(o=e.find(".toc_header")).css({background:"var(--negativeColor)",color:"white"}),a=(s=o[0].getBoundingClientRect()).x+s.width/2,c=s.y+s.height/2,r=$('<div class="spotlight_container" style="\nbackground: radial-gradient(circle at '+a+"px "+c+'px, transparent 180px, rgba(0, 0, 0, 0.4) 182px, rgba(0, 0, 0, 0.9) 900px);\n">\n  <div style="position: absolute;left: '+a+"px;top: "+c+'px; display: inline-block;">\n    <div class="ui success message">\n      <div class="header">\u62d6\u4f4f\u7ea2\u8272\u533a\u57df\u53ef\u4ee5\u79fb\u52a8\u5927\u7eb2\u4f4d\u7f6e</div>\n      <div class="ui button primary ok_button">\u77e5\u9053\u4e86</div>\n    </div>\n  </div>\n</div>'),$("body").append(r),r.find(".ok_button").click((function(){return o.css({background:"",color:""}),u.dontPrompt("drag_outline_learned"),r.remove()}))}}),o="1"===localStorage.toc_popup_isShow,(r=localStorage.toc_popup_type)&&this.tocType===r&&o)return setTimeout((function(){return n.show()}),1e3)},n}(a),n.exports=r}}),window.requirejs.define({"views/user_info_avatar_view":function(e,t,n){var i,r,o,a,s,l,c,u,d,p,f,h,m,v={}.hasOwnProperty;u=t("./view"),c=t("../lib/utils"),o=t("../lib/utils_image"),a=t("../lib/notifier"),i=t("../lib/config_sync"),t("../application"),r=t("../constant"),s=t("./single_popup_manager_view"),h=t("./templates/user_info_avatar"),m=null,p="http://localhost:3005","production"===ENV&&(p=r.host+"/xsjcors/http://fonts.xiaoshujiang.com"),f=function(e){var t;return t=e.substring(e.lastIndexOf(".")+1).toUpperCase(),_.contains(["JPG","JPEG","PNG","SVG"],t)},d=function(e){if(e)return i.createOrUpdateAvatar(e,(function(e){return e?a.showMessage("\u4fdd\u5b58\u5934\u50cf\u5931\u8d25:"+e,6e3,"error"):a.showMessage("\u4fdd\u5b58\u5934\u50cf\u6210\u529f",6e3)}))},l=function(e){var t,n,l;function u(){return u.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)v.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(u,e),u.prototype.template=h,n=!1,u.prototype.avatarDoc=null,u.prototype.randomPos=-1,u.prototype.avatarInfoObj=null,u.prototype.className="user_info_avatar_container",u.prototype.initialize=function(e){return this.userManagerView=e.userManagerView,m=this},u.prototype.events={"click .drop-zone":"selectFileFn","click .delete_avatar_btn":"deleteAvatarFn","click .modify_avatar_btn":"modifyAvatarFn","click .confirm_apply_avatar_btn":"confirmApplyAvatarFn","click .random_avatar_btn":"randomAvatarFn","click .school_badge_btn":"schoolBadgeFn","click .game_badge_btn":"gameBadgeFn","click .close_font_avatar_select_btn":"closeSchoolBadgeFn"},l=function(){var e;return(e=m.$el.find(".confirm_apply_avatar_btn")).remove(),e=$('<div class="ui button primary  confirm_apply_avatar_btn massive">\u5e94\u7528</div>'),m.$el.find(".drop-zone").append(e)},u.prototype.closeSchoolBadgeFn=function(e){return this.$el.find(".font_avatar_select_container").remove()},u.prototype.gameBadgeFn=function(e){var n,i,o;return e.preventDefault(),e.stopPropagation(),m.userManagerView.dimmer.dimmer("show"),o=r.host+"/web_statics/gameicons/index.html",i=$('<div class="font_avatar_select_container">\n <div class="font_avatar_select_btns">\n  <div class="close_font_avatar_select_btn"><i class="link icon close circle"></i></div>\n </div>\n</div>'),n=$('<iframe src="'+o+'" class="preview_iframe" frameborder="0" style="width: 100%;height:100%;"></iframe>').appendTo(i),this.$el.append(i),n[0].contentWindow.setAvatarFn=function(e,n){return e&&e.svg&&t(new Blob([e.svg],{type:"image/svg+xml"}),(function(t,n){var i;return e.font&&e.text&&(i=c.dataURL2Blob(e.font),n.font=e.text,n.className=e.className||"",n.css=e.css||"",n._attachments.font={content_type:i.type,data:i}),m.$el.find(".ui.button").show(),m.avatarDoc=n,l(),m.initAvatarResult(),m.$el.find(".confirm_apply_avatar_btn").click()})),i.remove()},n.one("load",(function(){return n[0].contentWindow.fetchFontInfoUrl=p,m.userManagerView.dimmer.dimmer("hide")}))},u.prototype.schoolBadgeFn=function(e){var n,i,o;return e.preventDefault(),e.stopPropagation(),m.userManagerView.dimmer.dimmer("show"),o=r.host+"/web_statics/school/index.html",i=$('<div class="font_avatar_select_container">\n <div class="font_avatar_select_btns">\n  <div class="close_font_avatar_select_btn"><i class="link icon close circle"></i></div>\n </div>\n</div>'),n=$('<iframe src="'+o+'" class="preview_iframe" frameborder="0" style="width: 100%;height:100%;"></iframe>').appendTo(i),this.$el.append(i),n[0].contentWindow.setAvatarFn=function(e,n){return console.log("school avatar:",e),e&&e.svg&&t(new Blob([e.svg],{type:"image/svg+xml"}),(function(t,n){var i;return e.font&&e.text&&(i=c.dataURL2Blob(e.font),n.font=e.text,n.className=e.className,n.css=e.css||"",n._attachments.font={content_type:i.type,data:i}),m.$el.find(".ui.button").show(),m.avatarDoc=n,l(),m.initAvatarResult(),m.$el.find(".confirm_apply_avatar_btn").click()})),i.remove()},n.one("load",(function(){return n[0].contentWindow.fetchFontInfoUrl=p,m.userManagerView.dimmer.dimmer("hide")}))},u.prototype.randomAvatarFn=function(e){var n,i,o,s,c,u,d;if(e.preventDefault(),e.stopPropagation(),(n=m.$el.find(".drop-zone")).addClass("loading"),o=m.avatarInfoObj,(d=(s=Object.keys(o)).length)>0)return(u=this.randomPos)<0||"production"===ENV||e.ctrlKey?u=_.random(0,d-1):(u+=1)>=d&&(u=0),this.randomPos=u,(i=o[s[u]]).image,c=r.host+"/"+i.image,fetch(c).then((function(e){return e.blob()})).then((function(e){return t(e,(function(e,t){if(n.removeClass("loading"),t&&(m.$el.find(".ui.button").show(),m.avatarDoc=t,l(),m.initAvatarResult()),e)return a.showMessage("\u968f\u673a\u5934\u50cf\u5931\u8d25:"+e,6e3,"error")}))})).catch((function(e){return n.removeClass("loading"),a.showMessage("\u968f\u673a\u5934\u50cf\u5931\u8d25: "+e,6e3,"error")}))},u.prototype.confirmApplyAvatarFn=function(e){if(e.preventDefault(),e.stopPropagation(),this.$el.find(".confirm_apply_avatar_btn").remove(),this.avatarDoc)return d(this.avatarDoc)},u.prototype.deleteAvatarFn=function(e){if(!n)return n=!0,i.deleteAvatar((function(e){return n=!1,e?a.showMessage("\u5220\u9664\u5934\u50cf\u5931\u8d25:"+e,6e3,"error"):(a.showMessage("\u5220\u9664\u5934\u50cf\u6210\u529f",6e3),m.avatarDoc=null,m.$el.find(".ui.button").hide(),m.$el.find(".drop-zone").removeClass("has-image").css("background-image",""),m.$el.find(".drop-zone").removeClass("has-font").removeAttr("data-font"))}))},u.prototype.modifyAvatarFn=function(e){var n;if(m.avatarDoc&&m.avatarDoc._attachments&&m.avatarDoc._attachments.origin)return n=m.avatarDoc._attachments.origin,c.blob2DataURL(n.data,(function(e,n){if(n)return $(".pusher").click(),m.userManagerView.$el.modal("hide"),s.showPopupView("image",{fileModel:null,link:n,operateType:function(e,n){if(e)return t(e,(function(e,t){return d(t)}))}})}))},u.prototype.selectFileFn=function(e){return $(e.currentTarget),m.$el.find("input[type=file]").trigger("click")},t=function(e,t){var n,i,r,a,s;return n={origin:{content_type:e.type,data:e}},i={_id:"system_user_avatar",_attachments:n},a=window.URL.createObjectURL(e),s=function(t,i){return o.resizeImage(a,t,(function(r,o){var a,s;return o&&(s=(a=c.dataURL2Blob(o)).type||e.type,"image/svg+xml"===e.type&&(s="image/png"),n[t+""]={content_type:s,data:a}),i()}))},r=[50,100,200,400],async.mapLimit(r,10,s,(function(){return window.URL.revokeObjectURL(a),t(null,i)}))},u.prototype.initAvatarResult=function(){var e,t,n,i,r;if(this.avatarDoc)return e=(t=this.avatarDoc._attachments).origin,i=t.font,this._prevObjectUrl&&(window.URL.revokeObjectURL(this._prevObjectUrl),this._prevObjectUrl=null),this.$el.find(">style").remove(),this.$el.find(".drop-zone").removeClass("has-image").css("background-image",""),this.$el.find(".drop-zone").removeClass("has-font").removeAttr("data-font"),i&&this.avatarDoc.font?(n='@font-face {\n  font-family: "avatarFontname";\n  src: url('+(r=window.URL.createObjectURL(i.data))+')  format("truetype");\n  font-style: normal;\n  font-weight: normal;\n}',this.$el.prepend("<style>"+n+"</style>"),this.$el.find(".drop-zone").addClass("has-font").attr("data-font",this.avatarDoc.font),this.$el.find(".ui.button.modify_avatar_btn").hide(),this._prevObjectUrl=r):e?(r=window.URL.createObjectURL(e.data),this.$el.find(".drop-zone").addClass("has-image").css("background-image","url('"+r+"')"),this._prevObjectUrl=r):void 0},u.prototype.afterRender=function(){return m.$el.find(".ui.button").hide(),this.initRandomBtn(),i.getAvatar({attachments:!0,binary:!0},(function(e,t){if(t)return m.avatarDoc=t,m.$el.find(".ui.button").show(),m.initAvatarResult()})),c.initdragFilesSupport(this.$el.find(".drop-zone"),(function(e){return c.insertImageFile(e,(function(e,n,i){var r;return f(i.name)?((r=m.$el.find(".drop-zone")).addClass("loading"),t(i,(function(e,t){if(r.removeClass("loading"),t&&(m.$el.find(".ui.button").show(),m.avatarDoc=t,l(),m.initAvatarResult()),e)return a.showMessage("\u9519\u8bef\u7684\u56fe\u7247:"+e,6e3,"error")}))):a.showMessage("\u9519\u8bef\u7684\u56fe\u7247\u683c\u5f0f,  \u4ec5\u652f\u6301 jpg \u683c\u5f0f",6e3,"error")}))})),c.initFileImportSupport(this.$el.find('input[type="file"]'),(function(e){return c.insertImageFile(e,(function(e,n,i){var r;return f(i.name)?((r=m.$el.find(".drop-zone")).addClass("loading"),t(i,(function(e,t){if(r.removeClass("loading"),t&&(m.$el.find(".ui.button").show(),m.avatarDoc=t,l(),m.initAvatarResult()),e)return a.showMessage("\u9519\u8bef\u7684\u56fe\u7247:"+e,6e3,"error")}))):a.showMessage("\u9519\u8bef\u7684\u56fe\u7247\u683c\u5f0f,  \u4ec5\u652f\u6301 jpg \u683c\u5f0f",6e3,"error")}))}))},u.prototype.initRandomBtn=function(){return fetch(r.host+"/css/random-avatars.json?fver="+moment().format("YYYYMMDD")).then((function(e){return e.json()})).then((function(e){var t,n;for(t in e)n=e[t],"production"===ENV?"development"===n.type&&delete e[t]:"production"===n.type&&delete e[t];if(Object.keys(e).length>0&&(m.avatarInfoObj=e,m.$el.find(".container").prepend('<i class="icon fas fa-dice link large random_avatar_btn" title="\u968f\u673a\u5934\u50cf" style="margin-right: 1em;"></i>')),!MINI_WEB)return m.$el.find(".container").prepend('<i class="icon fas fa-graduation-cap link large school_badge_btn" title="\u6821\u5fbd\u5934\u50cf" style="margin-right: 1em;"></i>'),m.$el.find(".container").prepend('<i class="icon fas fa-trophy link large game_badge_btn" title="\u6e38\u620f\u56fe\u6807\u5934\u50cf" style="margin-right: 1em;"></i>')}))},u.prototype.remove=function(){return m&&m._prevObjectUrl&&(window.URL.revokeObjectURL(m._prevObjectUrl),m._prevObjectUrl=null),m=null,u.__super__.remove.call(this)},u}(u),n.exports=l}}),window.requirejs.define({"views/user_info_basic_view":function(e,t,n){var i,r,o,a,s,l,c,u={}.hasOwnProperty;s=t("./view"),t("../lib/utils"),o=t("../lib/notifier"),i=t("../application"),r=t("../constant"),l=t("./templates/user_info_basic"),c=null,a=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)u.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.template=l,t.prototype.className="user_info_basic_container",t.prototype.initialize=function(e){return this.userManagerView=e.userManagerView,this.user=e.user,c=this},t.prototype.events={"click .logout_button":"logout","click .apply_vip_button":"applyVipFn","click .verify_button":"verifyEmailFn","click .notice_admin_button":"noticeAdminFn"},t.prototype.noticeAdminFn=function(e){var t,n,a,s;return a=(s=i.getUserModel()).get("user"),n=s.get("token"),a.id,c.userManagerView.dimmer.dimmer("show"),t=$.trim(c.$el.find("textarea[name=notice_admin_content]").val()),$.ajax({url:r.apiHost+"/api/users/noticeAdmin",method:"POST",data:{content:t},headers:{Authorization:n}}).always((function(){return c.userManagerView.dimmer.dimmer("hide")})).done((function(e){return o.showMessage("\u901a\u77e5\u5df2\u7ecf\u53d1\u9001\uff0c\u6211\u4eec\u4f1a\u5c3d\u5feb\u5904\u7406\u4f60\u7684\u4f1a\u5458\u7533\u8bf7\u8bf7\u6c42")})).fail((function(e,t,n){var i;return(i=e.responseJSON)&&i.error?(i=i.error,o.showMessage("\u63d0\u4ea4\u51fa\u9519:"+i.message,6e3,"error")):e.responseText?o.showMessage("\u63d0\u4ea4\u51fa\u9519:"+e.responseText,6e3,"error"):o.showMessage("\u63d0\u4ea4\u51fa\u9519:"+n,6e3,"error")}))},t.prototype.verifyEmailFn=function(e){var t,n,a,s;return a=(s=i.getUserModel()).get("user"),t=s.get("token"),n=a.id,c.userManagerView.dimmer.dimmer("show"),$.ajax({url:r.apiHost+"/api/users/"+n+"/verify",method:"POST",headers:{Authorization:t}}).always((function(){return c.userManagerView.dimmer.dimmer("hide")})).done((function(e){return o.showMessage("\u90ae\u7bb1\u9a8c\u8bc1\u53d1\u9001\u6210\u529f\uff0c\u8bf7\u6ce8\u610f\u67e5\u6536")})).fail((function(e,t,n){var i;return(i=e.responseJSON)&&i.error?(i=i.error,o.showMessage("\u63d0\u4ea4\u51fa\u9519:"+i.message,6e3,"error")):e.responseText?o.showMessage("\u63d0\u4ea4\u51fa\u9519:"+e.responseText,6e3,"error"):o.showMessage("\u63d0\u4ea4\u51fa\u9519:"+n,6e3,"error")}))},t.prototype.applyVipFn=function(e){var t;return t=i.getUserModel().get("token"),c.userManagerView.dimmer.dimmer("show"),$.ajax({url:r.apiHost+"/api/users/applyVip",method:"POST",headers:{Authorization:t}}).always((function(){return c.userManagerView.dimmer.dimmer("hide")})).done((function(e){return c.user=e,c.render()})).fail((function(e,t,n){var i;return(i=e.responseJSON)&&i.error?(i=i.error,o.showMessage("\u63d0\u4ea4\u51fa\u9519:"+i.message,6e3,"error")):e.responseText?o.showMessage("\u63d0\u4ea4\u51fa\u9519:"+e.responseText,6e3,"error"):o.showMessage("\u63d0\u4ea4\u51fa\u9519:"+n,6e3,"error")}))},t.prototype._scrollDownTip=function(){var e;return e=$('<a class="scroll_down_tip">\n<span></span><span></span><span></span>\u5411\u4e0b\u6eda\u52a8</a>'),this.$el.append(e),e.one("click",(function(){return c.$el.find(".charge_channel_blur").scrollintoview(),e.remove()})),this.userManagerView.$el.find(".story_content").one("scroll",(function(){return e.remove()}))},t.prototype.getChargeChannelsFn=function(){var e;return e=i.getUserModel().get("token"),$.ajax({url:r.apiHost+"/charge-channels",method:"GET",headers:{Authorization:e}}).done((function(e){var t,n,i;if(c)return t=c.$el.find(".charge_channels_container"),c._scrollDownTip(),t.empty(),i=e.fees,n=$("<div class=\"ui aligned center segment\"><a class='ui blue ribbon label'>\u5957\u9910</a></div>"),i.forEach((function(e){return n.append("<div class='ui circular segment'>"+e.html+"</div>")})),e.warning&&n.append("<div class='ui massive message red'>"+e.warning+"</div>"),t.append(n),e.channels.forEach((function(e){return t.append(""+e.html)}))})).fail((function(e,t,n){var i;return c&&c.$el.find(".charge_channels_container").empty(),(i=e.responseJSON)&&i.error?(i=i.error,o.showMessage("\u83b7\u53d6\u652f\u4ed8\u6e20\u9053\u51fa\u9519:"+i.message,6e3,"error")):e.responseText?o.showMessage("\u83b7\u53d6\u652f\u4ed8\u6e20\u9053\u51fa\u9519:"+e.responseText,6e3,"error"):o.showMessage("\u83b7\u53d6\u652f\u4ed8\u6e20\u9053\u51fa\u9519:"+n,6e3,"error")}))},t.prototype.getRenderData=function(){var e,t,n,i,r;return i=!1,e=!1,r=!1,(t=this.user.expireDate)&&(t=moment(t)).isValid()?(e=(n=t.diff(moment(),"seconds"))<=2592e3,r=!(i=n<=0)&&e,t=t.format("YYYY-MM-DD HH:mm:ss")):t="",t||(e=!0),e&&this.getChargeChannelsFn(),{id:this.user.id,email:this.user.email,emailVerified:this.user.emailVerified,expireDate:t,vip:this.user.vip||this.user.isTempVip,isTempVip:this.user.isTempVip,applyingVip:this.user.applyingVip,canApplying:e,isExpired:i,willExpired:r}},t.prototype.remove=function(){return c=null,t.__super__.remove.call(this)},t.prototype.logout=function(){var e,t,n,o;return n=(o=i.getUserModel()).get("token"),t=this.$el.find("input[name=logoutClearConfig]").is(":checked"),e=function(){return o.clear({silent:!0}),o.set({user:{},token:"",logoutClearConfig:t}),c.userManagerView.showLoginView()},$.ajax({url:r.apiHost+"/api/users/logout",method:"POST",headers:{Authorization:n}}).done(e).fail(e)},t}(s),n.exports=a}}),window.requirejs.define({"views/user_info_invitation_view":function(e,t,n){var i,r,o,a,s,l,c,u={}.hasOwnProperty;s=t("./view"),t("../lib/utils"),o=t("../lib/notifier"),i=t("../application"),r=t("../constant"),t("../lib/config_sync"),l=t("./templates/user_info_invitation"),c=null,a=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)u.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.template=l,t.prototype.className="user_info_invitation_container",t.prototype.initialize=function(e){return this.userManagerView=e.userManagerView,this.user=e.user,c=this},t.prototype.events={"click .create_invitation_button":"createInvitationFn"},t.prototype.createInvitationFn=function(e){return c.userManagerView.dimmer.dimmer("show"),c.createInvitation((function(){return c.userManagerView.dimmer.dimmer("hide")}))},t.prototype.afterRender=function(){if(this.user.vip)return c.userManagerView.dimmer.dimmer("show"),c.getInvitationResult((function(){return c.userManagerView.dimmer.dimmer("hide")}));this.$el.addClass("not_vip")},t.prototype.createInvitation=function(e){var t;return t=i.getUserModel().get("token"),$.ajax({url:r.apiHost+"/api/users/me/createInvitation",method:"POST",headers:{Authorization:t}}).done((function(t){return c.showInvitationResult({invitation:t,results:[]}),e()})).fail((function(t,n,i){var r;return(r=t.responseJSON)&&r.error?(r=r.error,o.showMessage("\u521b\u5efa\u9080\u8bf7\u4fe1\u606f\u51fa\u9519:"+r.message,6e3,"error")):t.responseText?o.showMessage("\u521b\u5efa\u9080\u8bf7\u4fe1\u606f\u51fa\u9519:"+t.responseText,6e3,"error"):o.showMessage("\u521b\u5efa\u9080\u8bf7\u4fe1\u606f\u51fa\u9519:"+i,6e3,"error"),e()}))},t.prototype.showInvitationResult=function(e){var t,n,i,r;if(e.invitation)return c.$el.find(".blank_invitation").hide(),(t=c.$el.find(".invitation_info_container")).css("display",""),t.find(".invitation_code").text(e.invitation.code),t.find(".invitation_statistics").html(e.invitation.statisticsHtml),t.find(".invitation_info").append(e.invitation.usedCountHtml),e.results&&e.results.length>0?(i=(n=$('<table class="ui basic table">\n    <thead>\n      <tr>\n        <th>\u7528\u6237\u540d</th>\n        <th>\u6ce8\u518c\u65f6\u95f4</th>\n        <th>\u662f\u5426\u8fc7\u671f</th>\n        <th>\u662f\u5426\u751f\u6548</th>\n      </tr>\n    </thead>\n    <tbody>\n    </tbody>\n  </table>')).find("tbody"),r=[],e.results.forEach((function(e){var t;return t=e.hasUsed?"positive":"",t=e.isExpired?"negative":t,r.push('<tr class="'+t+'">\n  <td>'+_.escape(e.invitee.email)+"</td>\n  <td>"+moment(e.created).format("YYYY-MM-DD")+"</td>\n  <td>"+(e.isExpired?"\u662f":"\u5426")+"</td>\n  <td>"+(e.hasUsed?"\u662f":"\u5426")+"</td>\n</tr>")})),e.results.length>=10&&r.push('<tr>\n<td colspan="4" style="text-align:center;">\u3002\u3002\u3002\u7cfb\u7edf\u53ea\u5217\u51fa\u6700\u8fd1\u6ce8\u518c\u7684\u524d10\u4e2a\u7528\u6237\u3002\u3002\u3002</td>\n</tr>'),i.html(r.join("")),t.find(".invitation_result").removeClass("placeholder").html(n)):t.find(".invitation_result").addClass("placeholder").html('<div class="ui icon header">\n  <i class="handshake outline icon"></i>\n  \u8fd8\u6ca1\u6709\u88ab\u9080\u8bf7\u7684\u7528\u6237\n</div>')},t.prototype.getInvitationResult=function(e){var t;return t=i.getUserModel().get("token"),$.ajax({url:r.apiHost+"/api/users/me/getInvitationResult",method:"GET",headers:{Authorization:t}}).done((function(t){return c.showInvitationResult(t),e()})).fail((function(t,n,i){var r;return(r=t.responseJSON)&&r.error?(r=r.error,o.showMessage("\u83b7\u53d6\u9080\u8bf7\u4fe1\u606f\u51fa\u9519:"+r.message,6e3,"error")):t.responseText?o.showMessage("\u83b7\u53d6\u9080\u8bf7\u4fe1\u606f\u51fa\u9519:"+t.responseText,6e3,"error"):o.showMessage("\u83b7\u53d6\u9080\u8bf7\u4fe1\u606f\u51fa\u9519:"+i,6e3,"error"),e()}))},t.prototype.remove=function(){return c=null,t.__super__.remove.call(this)},t}(s),n.exports=a}}),window.requirejs.define({"views/user_info_setting_view":function(e,t,n){var i,r,o,a,s,l,c,u,d,p,f={}.hasOwnProperty;u=t("./view"),c=t("../lib/utils"),s=t("../lib/notifier"),i=t("../application"),o=t("../constant"),r=t("../lib/config_sync"),a=t("./file_history_dialog_view"),d=t("./templates/user_info_setting"),p=null,l=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)f.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.template=d,t.prototype.className="user_info_setting_container",t.prototype.initialize=function(e){return this.userManagerView=e.userManagerView,this.user=e.user,p=this},t.prototype.events={"click .apply_config_sync_button":"applyConfigSyncFn","click .export_button":"exportConfigFn","click .reset_button":"resetConfigFn","click .import_button":"importConfigFn","click .config_history_button":"changeConfigHistoryFn"},t.prototype.changeConfigHistoryFn=function(e){var t,n;return n="xsj_config_"+(t=$(e.currentTarget).data("value")),this.userManagerView.hide(),new a({db:r.getConfigDB(),docId:n,title:"\u914d\u7f6e\u6587\u4ef6\uff1a"+t,onHideFn:function(){return p.userManagerView.show()}}).show()},t.prototype.exportConfigFn=function(){return r.exportConfig((function(e,t){var n,i,r;if(e){try{e=JSON.stringify(e)}catch(e){i=e,console.log(i)}return s.showMessage("\u5bfc\u51fa\u51fa\u9519\uff1a"+e,6e3,"error")}return r=JSON.stringify(t),n=new Blob([r],{type:"text/plain;charset=utf-8"}),saveAs(n,moment().format("YYYY-MM-DD")+".xsjcfg"),s.showMessage("\u5bfc\u51fa\u6210\u529f")}))},t.prototype.resetConfigFn=function(){var e,t;if(t=lorem(3,{usePunc:!1}),null!==(e=prompt("\u786e\u8ba4\u662f\u5426\u91cd\u7f6e\u914d\u7f6e\u6587\u4ef6\uff0c\u91cd\u7f6e\u540e\uff0c\u670d\u52a1\u5668\u548c\u5ba2\u6237\u7aef\u6240\u6709\u914d\u7f6e\u4fe1\u606f\u5c06\u6062\u590d\u5230\u767b\u5f55\u524d\u7684\u914d\u7f6e\u72b6\u6001\u3002 \u8bf7\u8f93\u5165'"+t+"' \u5b8c\u6210\u786e\u8ba4\u64cd\u4f5c","")))return e===t?r.resetDefaultDBConfig((function(e){var t;if(e){try{e=JSON.stringify(e)}catch(e){t=e,console.log(t)}return s.showMessage("\u91cd\u7f6e\u5931\u8d25:"+e,6e3,"error")}return s.showMessage("\u91cd\u7f6e\u6210\u529f")})):s.showMessage("\u91cd\u7f6e\u5931\u8d25: \u786e\u8ba4\u7801\u4e0d\u4e00\u81f4",6e3,"error")},t.prototype.importConfigFn=function(){return p.$el.find("input[type=file]").trigger("click")},t.prototype.applyConfigSyncFn=function(e){var t,n,r,a,l,c,u,d,f;if(this.user.vip)return d=(f=i.getUserModel()).get("user"),u=f.get("token"),t=p.$el.find("input[name=configSyncLive]").is(":checked"),n=p.$el.find("input[name=configSyncRangeApplication]").is(":checked"),r=p.$el.find("input[name=configSyncRangeEditor]").is(":checked"),a=p.$el.find("input[name=configSyncRangePreview]").is(":checked"),l=p.$el.find("input[name=configSyncRangeStores]").is(":checked"),c=[],n&&c.push("xsj_config_application"),r&&c.push("xsj_config_editor"),a&&c.push("xsj_config_preview"),l&&c.push("xsj_config_stores"),0===c.length&&(c=["xsj_config_application","xsj_config_editor","xsj_config_preview","xsj_config_stores"]),$.ajax({url:o.apiHost+"/api/users/"+d.id+"/changeConfigSync",method:"POST",data:{configSyncLive:t,configSyncRange:c},headers:{Authorization:u}}).done((function(e){var t;return e.isRealVip=e.vip,e.vip=e.vip||e.isTempVip,t=$.extend({},e,{user:e}),f.set(t),s.showMessage("\u4fee\u6539\u6210\u529f")})).fail((function(e,t,n){var i;return(i=e.responseJSON)&&i.error?(i=i.error,s.showMessage("\u63d0\u4ea4\u51fa\u9519:"+i.message,6e3,"error")):e.responseText?s.showMessage("\u63d0\u4ea4\u51fa\u9519:"+e.responseText,6e3,"error"):s.showMessage("\u63d0\u4ea4\u51fa\u9519:"+n,6e3,"error")}));s.showMessage("\u540c\u6b65\u7528\u6237\u914d\u7f6e\u529f\u80fd\u4ec5\u9650\u4ed8\u8d39\u7528\u6237\u4f7f\u7528",6e3,"error")},t.prototype.getRenderData=function(){var e,t,n,i,r,o;return e="",this.user.configSyncLive&&(e="checked"),t="",n="",i="",r="",0===(o=this.user.configSyncRange||[]).length&&(o=["xsj_config_application","xsj_config_editor","xsj_config_preview","xsj_config_stores"]),o.indexOf("xsj_config_application")>=0&&(t="checked"),o.indexOf("xsj_config_editor")>=0&&(n="checked"),o.indexOf("xsj_config_preview")>=0&&(i="checked"),o.indexOf("xsj_config_stores")>=0&&(r="checked"),{configSyncLive:e,configSyncRangeApplication:t,configSyncRangeEditor:n,configSyncRangePreview:i,configSyncRangeStores:r}},t.prototype.afterRender=function(){var e;return e=function(e){var t,n;if(e.length>0)return t=e[0],(n=new FileReader).onload=function(e){var t,n,i;i=e.target.result;try{t=JSON.parse(i)}catch(e){n=e,s.showMessage("\u5bfc\u5165\u5931\u8d25:"+n,6e3,"error")}if(t)return r.importConfig(t,(function(e){return e?s.showMessage("\u5bfc\u5165\u5931\u8d25:"+e,6e3,"error"):s.showMessage("\u5bfc\u5165\u6210\u529f")}))},n.readAsText(t)},c.initFileImportSupport(p.$el.find("input[type=file]"),e)},t.prototype.remove=function(){return p=null,t.__super__.remove.call(this)},t}(u),n.exports=l}}),window.requirejs.define({"views/user_info_view":function(e,t,n){var i,r,o,a,s,l,c,u,d,p,f,h={}.hasOwnProperty;l=t("./view"),t("../lib/utils"),t("../lib/notifier"),t("../application"),o=t("./user_info_invitation_view"),a=t("./user_info_setting_view"),r=t("./user_info_basic_view"),i=t("./user_info_avatar_view"),p=t("./templates/user_info"),f=null,c=null,d=null,u=null,s=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)h.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.template=p,t.prototype.className="user_info ui segment",t.prototype.initialize=function(e){return this.userManagerView=e.userManagerView,this.user=e.user,f=this},t.prototype.afterRender=function(){return this.$el.css("height","100%")},t.prototype.afterAttached=function(){return this.$el.find(">.ui.menu>.item").tab({onFirstLoad:function(e){var t,n;return"basic"===e?(t=f.$el.find(".user_info_basic_tab_container"),c=new r({userManagerView:f.userManagerView,user:f.user}),t.html("").append(c.render().$el),c):"avatar"===e?(t=f.$el.find(".user_info_avatar_tab_container"),n=new i({userManagerView:f.userManagerView}),t.html("").append(n.render().$el),n):"setting"===e?(t=f.$el.find(".user_info_setting_tab_container"),d=new a({userManagerView:f.userManagerView,user:f.user}),t.html("").append(d.render().$el),d):"invitation"===e?(t=f.$el.find(".user_info_invitation_tab_container"),u=new o({userManagerView:f.userManagerView,user:f.user}),t.html("").append(u.render().$el),u):void 0},onLoad:function(e){return"basic"===e?c:"setting"===e?d:"invitation"===e?u:void 0}}),this.$el.find(">.ui.menu>.item[data-tab=basic]").tab("change tab","basic")},t.prototype.getData=function(){return{email:""}},t.prototype.remove=function(){return null!=c&&c.remove(),c=null,null!=d&&d.remove(),d=null,null!=u&&u.remove(),u=null,null,this.$el.find(">.ui.menu>.item").tab("destroy"),f=null,t.__super__.remove.call(this)},t}(l),n.exports=s}}),window.requirejs.define({"views/user_login_view":function(e,t,n){var i,r,o,a,s,l,c,u=function(e,t){return function(){return e.apply(t,arguments)}},d={}.hasOwnProperty;s=t("./view"),t("../lib/utils"),o=t("../lib/notifier"),i=t("../application"),r=t("../constant"),l=t("./templates/user_login"),c=null,a=function(e){function t(){return this.login=u(this.login,this),this.resetPassword=u(this.resetPassword,this),this.register=u(this.register,this),t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)d.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.template=l,t.prototype.className="user_login ui segment",t.prototype.events={"click .login_button":"login","click .register_button":"register","click .reset_password_button":"resetPassword"},t.prototype.initialize=function(e){return this.userManagerView=e.userManagerView,this.initData=e.data||{email:""},c=this},t.prototype.register=function(e){return e.preventDefault(),e.stopPropagation(),this.userManagerView.showRegisterView(),!1},t.prototype.resetPassword=function(e){return e.preventDefault(),e.stopPropagation(),this.userManagerView.showResetPasswordView(),!1},t.prototype.login=function(e){return e.preventDefault(),e.stopPropagation(),this.$el.find(".form").form("validate form"),!1},t.prototype.remove=function(){return this.$el.find(".form").form("destroy"),t.__super__.remove.call(this),c=null},t.prototype.getData=function(){return{email:this.$el.find("input[name=email]").val()||""}},t.prototype.getRenderData=function(){return this.initData},t.prototype.afterRender=function(){var e;return(e=this.$el.find(".form")).form({fields:{email:{identifier:"email",rules:[{type:"empty",prompt:"\u90ae\u4ef6\u5730\u5740\u4e0d\u80fd\u4e3a\u7a7a"}]}},onSuccess:function(){var t;return t=e.serializeObject(),c.userManagerView.dimmer.dimmer("show"),$.ajax({url:r.apiHost+"/api/users/login?include=user",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify(t),method:"POST"}).always((function(){return c.userManagerView.dimmer.dimmer("hide")})).done((function(e){var t,n,r;return n=i.getUserModel(),(t=e.user).isRealVip=t.vip,t.vip=t.vip||t.isTempVip,r=$.extend({},t,{token:e.id,user:t}),n.set(r),c.userManagerView.showInfoView(e.user)})).fail((function(e,t,n){var i;return(i=e.responseJSON)&&i.error?(i=i.error,o.showMessage("\u63d0\u4ea4\u51fa\u9519:"+i.message,6e3,"error")):e.responseText?o.showMessage("\u63d0\u4ea4\u51fa\u9519:"+e.responseText,6e3,"error"):o.showMessage("\u63d0\u4ea4\u51fa\u9519:"+n,6e3,"error")})),!1}})},t}(s),n.exports=a}}),window.requirejs.define({"views/user_manager_view":function(e,t,n){var i,r,o,a,s,l,c,u,d,p,f,h,m,v={}.hasOwnProperty;p=t("./view"),d=t("../lib/utils"),o=t("../lib/notifier"),i=t("../application"),r=t("../constant"),h=t("./templates/user_manager"),s=t("./user_login_view"),c=t("./user_register_view"),a=t("./user_info_view"),u=t("./user_reset_password_view"),m=null,f=null,l=function(e){var t;function n(){return n.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)v.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(n,e),n.prototype.template=h,n.prototype.className="ui standard story_modal modal",n.prototype.isTempHide=!1,t=!1,n.prototype.showLoginView=function(){var e,t;return e=null,f&&(e=f.getData(),f.remove()),f=null,(t=new s({userManagerView:this,data:e})).render(),this.$el.find(".story_content").append(t.$el),f=t},n.prototype.showRegisterView=function(){var e,t;return e=null,f&&(e=f.getData(),f.remove()),f=null,(t=new c({userManagerView:this,data:e})).render(),this.$el.find(".story_content").append(t.$el),f=t},n.prototype.showResetPasswordView=function(){var e,t;return e=null,f&&(e=f.getData(),f.remove()),f=null,(t=new u({userManagerView:this,data:e})).render(),this.$el.find(".story_content").append(t.$el),f=t},n.prototype.showInfoView=function(e){var t;return null!=f&&f.remove(),f=null,(t=new a({userManagerView:this,user:e})).render(),this.$el.find(".story_content").append(t.$el),t.afterAttached(),f=t},n.prototype.showContentView=function(){var e,t,n;return m.dimmer.dimmer("show"),e=(n=i.getUserModel()).get("token"),t=n.get("user"),e?$.ajax({url:r.apiHost+"/api/users/me",data:{access_token:e},method:"GET"}).always((function(){return m.dimmer.dimmer("hide")})).done((function(e){var t;return e.isRealVip=e.vip,e.vip=e.vip||e.isTempVip,m.showInfoView(e),t=$.extend({},e,{user:e}),n.set(t)})).fail((function(e,i,r){var a;return(a=e.responseJSON)&&a.error?(a=a.error,o.showMessage("\u83b7\u53d6\u7528\u6237\u4fe1\u606f\u51fa\u9519:"+a.message,6e3,"error"),m.showLoginView(),n.clear({silent:!0}),n.set({token:"",user:{}})):m.showInfoView(t)})):(this.dimmer.dimmer("hide"),this.showLoginView())},n.prototype.hide=function(){return m.isTempHide=!0,m.$el.modal("setting","transition","horizontal flip")},n.prototype.show=function(){return m?(m.isTempHide=!1,void m.$el.modal("show")):(m=this,t=!1,this.render(),this.dimmer=d.xsjDimmer(this.$el),this.$el.modal({closable:!1,dimmerSettings:{opacity:.7},onVisible:function(){return t||(m.showContentView(),t=!0),m.$el.modal("setting","transition","scale")},onHidden:function(){var e;if(!m.isTempHide)return m.$el.modal("destroy"),e=m.$el.parent(),null!=f&&f.remove(),f=null,m.remove(),e.remove(),m=null}}).modal("show"))},n}(p),n.exports=l}}),window.requirejs.define({"views/user_register_view":function(e,t,n){var i,r,o,a,s,l,c,u=function(e,t){return function(){return e.apply(t,arguments)}},d={}.hasOwnProperty;s=t("./view"),t("../lib/utils"),o=t("../lib/notifier"),i=t("../application"),r=t("../constant"),l=t("./templates/user_register"),c=null,a=function(e){function t(){return this.resetPassword=u(this.resetPassword,this),this.login=u(this.login,this),this.register=u(this.register,this),t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)d.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.template=l,t.prototype.className="user_register ui segment",t.prototype.events={"click .register_button":"register","click .login_button":"login","click .reset_password_button":"resetPassword"},t.prototype.initialize=function(e){return this.userManagerView=e.userManagerView,this.initData=e.data||{email:""},c=this},t.prototype.register=function(e){return e.preventDefault(),e.stopPropagation(),this.$el.find(".form").form("validate form"),!1},t.prototype.login=function(e){return e.preventDefault(),e.stopPropagation(),this.userManagerView.showLoginView(),!1},t.prototype.resetPassword=function(e){return e.preventDefault(),e.stopPropagation(),this.userManagerView.showResetPasswordView(),!1},t.prototype.remove=function(){return this.$el.find(".form").form("destroy"),c=null,t.__super__.remove.call(this)},t.prototype.getData=function(){return{email:this.$el.find("input[name=email]").val()||""}},t.prototype.getRenderData=function(){return this.initData},t.prototype.afterRender=function(){var e;return(e=this.$el.find(".form")).form({fields:{email:{identifier:"email",rules:[{type:"empty",prompt:"\u90ae\u4ef6\u5730\u5740\u4e0d\u80fd\u4e3a\u7a7a"}]},password:{rules:[{type:"empty",prompt:"\u5bc6\u7801\u4e0d\u80fd\u4e3a\u7a7a"}]}},onSuccess:function(){var t;return t=e.serializeObject(),c.userManagerView.dimmer.dimmer("show"),$.ajax({url:r.apiHost+"/api/users",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify(t),method:"POST"}).always((function(){return c.userManagerView.dimmer.dimmer("hide")})).done((function(e){var t,n;return t=i.getUserModel(),n=$.extend({},e.user,{token:e.id,user:e.user}),t.set(n),c.userManagerView.showInfoView(e.user)})).fail((function(e,t,n){var i;return(i=e.responseJSON)&&i.error?(i=i.error,o.showMessage("\u63d0\u4ea4\u51fa\u9519:"+i.message,6e3,"error")):e.responseText?o.showMessage("\u63d0\u4ea4\u51fa\u9519:"+e.responseText,6e3,"error"):o.showMessage("\u63d0\u4ea4\u51fa\u9519:"+n,6e3,"error")})),!1}})},t}(s),n.exports=a}}),window.requirejs.define({"views/user_reset_password_view":function(e,t,n){var i,r,o,a,s,l,c=function(e,t){return function(){return e.apply(t,arguments)}},u={}.hasOwnProperty;a=t("./view"),t("../lib/utils"),r=t("../lib/notifier"),t("../application"),i=t("../constant"),s=t("./templates/user_reset_password"),l=null,o=function(e){function t(){return this.resetPassword=c(this.resetPassword,this),this.login=c(this.login,this),this.register=c(this.register,this),t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)u.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.template=s,t.prototype.className="user_reset_password ui segment",t.prototype.events={"click .login_button":"login","click .register_button":"register","click .reset_password_button":"resetPassword"},t.prototype.initialize=function(e){return this.userManagerView=e.userManagerView,this.initData=e.data||{email:""},l=this},t.prototype.register=function(e){return e.preventDefault(),e.stopPropagation(),this.userManagerView.showRegisterView(),!1},t.prototype.login=function(e){return e.preventDefault(),e.stopPropagation(),this.userManagerView.showLoginView(),!1},t.prototype.resetPassword=function(e){return e.preventDefault(),e.stopPropagation(),this.$el.find(".form").form("validate form"),!1},t.prototype.getData=function(){return{email:this.$el.find("input[name=email]").val()||""}},t.prototype.getRenderData=function(){return this.initData},t.prototype.remove=function(){return this.$el.find(".form").form("destroy"),t.__super__.remove.call(this),l=null},t.prototype.afterRender=function(){var e;return(e=this.$el.find(".form")).form({fields:{email:{identifier:"email",rules:[{type:"empty",prompt:"\u90ae\u4ef6\u5730\u5740\u4e0d\u80fd\u4e3a\u7a7a"}]}},onSuccess:function(){var t;return t=e.serializeObject(),l.userManagerView.dimmer.dimmer("show"),$.ajax({url:i.apiHost+"/api/users/reset",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify(t),method:"POST"}).always((function(){return l.userManagerView.dimmer.dimmer("hide")})).done((function(e){return r.showMessage("\u91cd\u7f6e\u5bc6\u7801\u90ae\u4ef6\u53d1\u9001\u6210\u529f\uff0c\u8bf7\u6ce8\u610f\u67e5\u6536",6e3),l.userManagerView.showLoginView()})).fail((function(e,t,n){var i;return(i=e.responseJSON)&&i.error?(i=i.error,r.showMessage("\u63d0\u4ea4\u51fa\u9519:"+i.message,6e3,"error")):e.responseText?r.showMessage("\u63d0\u4ea4\u51fa\u9519:"+e.responseText,6e3,"error"):r.showMessage("\u63d0\u4ea4\u51fa\u9519:"+n,6e3,"error")})),!1}})},t}(a),n.exports=o}}),window.requirejs.define({"views/view":function(e,t,n){var i=function(e,t){return function(){return e.apply(t,arguments)}},r={}.hasOwnProperty;t("lib/view_helper"),n.exports=function(e){function t(){return this.render=i(this.render,this),t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)r.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,Backbone.View),t.prototype.template=function(){},t.prototype.getRenderData=function(){},t.prototype.render=function(){return this.$el.html(this.template(this.getRenderData())),this.afterRender(),this},t.prototype.afterRender=function(){},t}()}}),window.requirejs.define({"views/zen_tabs_view":function(e,t,n){var i,r,o,a,s,l,c,u,d=function(e,t){return function(){return e.apply(t,arguments)}},p={}.hasOwnProperty;i=t("../application"),r=t("../lib/notifier"),u=null,a="",s={left:"fly right",right:"fly left",middle:"horizontal flip"},l={left:"fly left",right:"fly right",middle:"horizontal flip"},c=function(e,t){var n,i,r,o,s;if(u.$el.find(".main_content_wrapper").transition(l[a],(function(){if(u&&u.editorView&&"codemirror"===u.editorView.editorType)return u.editorView.editorProxy.editor.refresh()})),u.$el.removeClass("zen_tab_change"),a="",u.stopListening(),s=u.fileTabsModel.get("tabs")||[],i=t.get("_id"),o=u.fileTabsModel.get("maxTabs"),r=_.find(s,(function(e){return e.id===i})),u.listenTo(t,"change:title",(function(e){return r.name=t.get("title"),u.fileTabsModel.set({tabs:s,activeTab:i}),u.$fileTabsWrapper.html(""),u.$menu.html(""),u.refresh()})),!r&&i?s.push({id:i,name:t.get("title")||"\u672a\u547d\u540d\u6587\u4ef6"}):r.name=t.get("title")||"\u672a\u547d\u540d\u6587\u4ef6",s.length>o&&(s=_.rest(s,s.length-o)),u.fileTabsModel.set({tabs:s,activeTab:i}),u.$fileTabsWrapper.html(""),u.$menu.html(""),u.refresh(),!(n=u.$menu.find(".active")).visible())return u.$menu.scrollTo(n)},o=function(e){var t,n;function o(){return this.tabClick=d(this.tabClick,this),this.removeTab=d(this.removeTab,this),this.mouseenterTab=d(this.mouseenterTab,this),this.mouseenterMenu=d(this.mouseenterMenu,this),this.leftClick=d(this.leftClick,this),this.rightClick=d(this.rightClick,this),this.toggleTabsView=d(this.toggleTabsView,this),o.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)p.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(o,Backbone.View),o.prototype.events={click:"toggleTabsView","click .file_tab":"tabClick","click .file_item_tab":"tabClick","click .remove_tab":"removeTab","click .zen_right_arrow":"rightClick","click .zen_left_arrow":"leftClick","mouseenter .file_tab":"mouseenterTab","mouseenter .menu":"mouseenterMenu"},o.prototype.toggleTabsView=function(e){var t;if(t=$(e.target),this.el===e.target||t.hasClass("zen_background"))return this.$el.toggleClass("zen_tabs_hide")},o.prototype.rightClick=function(e){var t,n,i,r,o,l,c;if(!$(e.currentTarget).hasClass("disable")){for(c=this.fileTabsModel.get("tabs")||[],t=this.fileTabsModel.get("activeTab"),o=-1,n=i=0,r=c.length;i<r;n=++i)if(c[n].id===t){o=n;break}return(o+=1)>c.length-1&&(o=c.length-1),o<0&&(o=0),l=c[o].id,a="right",u.$el.addClass("zen_tab_change"),this.$el.find(".main_content_wrapper").transition(s[a],(function(){return u.changeTabId(l)}))}},o.prototype.leftClick=function(e){var t,n,i,r,o,l,c;if(!$(e.currentTarget).hasClass("disable")){for(c=this.fileTabsModel.get("tabs")||[],t=this.fileTabsModel.get("activeTab"),o=-1,n=i=0,r=c.length;i<r;n=++i)if(c[n].id===t){o=n;break}return(o-=1)>c.length-1&&(o=c.length-1),o<0&&(o=0),l=c[o].id,a="left",u.$el.addClass("zen_tab_change"),this.$el.find(".main_content_wrapper").transition(s[a],(function(){return u.changeTabId(l)}))}},o.prototype.mouseenterMenu=function(e){return this.$menu.find(".file_item_tab_hover").removeClass("file_item_tab_hover")},o.prototype.mouseenterTab=function(e){var t;if(t=$(e.currentTarget).data("id"),this.$menu.find(".file_item_tab_hover").removeClass("file_item_tab_hover"),t)return this.$menu.scrollTo(this.$menu.find(".file_item_tab[data-id="+t+"]").addClass("file_item_tab_hover"))},o.prototype.removeTab=function(e){var t,n,i,r,o,a,s;if(e.preventDefault(),e.stopPropagation(),a=$(e.currentTarget).parent().data("id")){for(s=this.fileTabsModel.get("tabs")||[],t=this.fileTabsModel.get("activeTab"),o=-1,n=i=0,r=s.length;i<r;n=++i)if(s[n].id===a){o=n;break}if(o>=0&&t!==s[o].id)return s.splice(o,1),this.fileTabsModel.set({tabs:s}),this.$fileTabsWrapper.html(""),this.$menu.html(""),this.refresh()}},o.prototype.changeTabId=function(e){var t;if(e)return(t=this.fileCollection.where({_id:e})).length>0?$(window).trigger("changeFileModel",t[0]):this.fileCollection.fetch({update:!0,remove:!1,options:{allDocs:{key:e,include_docs:!0,limit:1}},success:function(e,t,n){var i;return 1===t.rows.length?(i=e.get(t.rows[0].id),$(window).trigger("changeFileModel",i)):r.showMessage("\u6587\u4ef6\u5df2\u7ecf\u88ab\u5220\u9664",6e3,"error")},error:function(){return r.showMessage("\u6587\u4ef6\u5df2\u7ecf\u88ab\u5220\u9664",6e3,"error")}})},o.prototype.tabClick=function(e){var t,n;if(e.preventDefault(),e.stopPropagation(),t=$(e.currentTarget),n=t.data("id"))return a="middle",u.$el.addClass("zen_tab_change"),this.$el.find(".main_content_wrapper").transition(s[a],(function(){return u.changeTabId(n)}))},o.prototype.initialize=function(e){return u=this,this.editorView=e.editorView,this.fileTabsModel=i.getFileTabsModel(),this.fileCollection=i.getFileCollection(),this.$right=$('<div class="zen_nav_arrow zen_right_arrow"><i class="icon massive angle right"></i></div>').appendTo(this.$el),this.$left=$('<div class="zen_nav_arrow zen_left_arrow"><i class="icon massive angle left"></i></div>').appendTo(this.$el),this.$navTabs=$('<div class="zen_nav_tabs nav_tabs ui dropdown pointing bottom">\n  <div class="file_tabs_wrapper"></div>\n  <div class="menu"></div>\n</div>').appendTo(this.$el),$(window).on("fileModelChanged",c),this.init()},o.prototype._refreshFileTab=function(){var e,t,n,i,r,o,a,s,l,c,d;for(d=this.fileTabsModel.get("tabs")||[],t=this.fileTabsModel.get("activeTab"),s=-1,n=i=0,o=d.length;i<o;n=++i)if((c=d[n]).id===t){s=n;break}for(u.$left.removeClass("disable"),u.$right.removeClass("disable"),0===s&&u.$left.addClass("disable"),s===d.length-1&&u.$right.addClass("disable"),l=[],r=0,a=d.length;r<a;r++)e="","remove",(c=d[r])&&c.id===t&&(e="active","circle"),l.push(this.$fileTabsWrapper.append('<div class="ui file_tab empty circular label '+e+'" data-id="'+c.id+'" title="'+_.escape(c.name)+'"></div>'));return l},o.prototype._refreshMenuTab=function(){var e,t,n,i,r,o,a,s;for(s=this.fileTabsModel.get("tabs")||[],t=this.fileTabsModel.get("activeTab"),o=[],n=0,i=s.length;n<i;n++)e="",r="remove",(a=s[n])&&a.id===t&&(e="active",r="circle"),o.push(this.$menu.append('<div class="item file_item_tab '+e+'" data-id="'+a.id+'"><i class="remove_tab icon '+r+'"></i>'+_.escape(a.name.substring(0,100))+"</div>"));return o},o.prototype.refresh=function(){return this._refreshMenuTab(),this._refreshFileTab()},o.prototype.init=function(){var e,r,o,a,s;return this.$fileTabsWrapper=this.$navTabs.find(".file_tabs_wrapper"),this.$menu=this.$navTabs.find(".menu"),this.$menu.sortable({stop:(s=this,function(e,t){var n;return n=[],s.$menu.find(".file_item_tab").each((function(e,t){var i,r,o;if(o=(i=$(t)).data("id"),r=i.text(),o&&r)return n.push({id:o,name:r})})),s.fileTabsModel.set({tabs:n}),s.$fileTabsWrapper.html(""),s._refreshFileTab()})}),this.refresh(),this.$navTabs.dropdown({onHide:function(){return 1},on:"hover",action:function(){}}),a=this.fileTabsModel.get("tabs")||[],e=this.fileTabsModel.get("activeTab"),o=_.find(a,(function(t){return t.id===e})),r=i.getCurrentFileMode(),this.listenTo(r,"change:title",function(t){return function(n,i){return o.name=n.get("title")||"\u672a\u547d\u540d\u6587\u4ef6",t.fileTabsModel.set({tabs:a,activeTab:e}),t.$fileTabsWrapper.html(""),t.$menu.html(""),t.refresh()}}(this)),this.$navTabs.off("blur"),this.$el.on("keydown",n),this.$el.on("click mousemove",t)},n=function(){if(u.$el.hasClass("zen_tabs_hide"))return u.$el.addClass("zen_editing")},t=function(){if(u.$el.hasClass("zen_tabs_hide"))return u.$el.removeClass("zen_editing")},o.prototype.destroy=function(){return u.$el.find(".main_content_wrapper").removeClass("transition visible"),this.$el.removeClass("zen_tabs_hide"),this.$el.removeClass("zen_editing"),this.$el.off("keydown",n),this.$el.off("click mousemove",t),this.$right.remove(),this.$right=null,this.$left.remove(),this.$left=null,this.$navTabs.remove(),this.$navTabs=null,this.undelegateEvents(),this.stopListening(),$(window).off("fileModelChanged",c),u=null},o}(),n.exports=o}}),window.requirejs.define({"plugins/oschina/oschina_public_dialog":function(e,t,n){var i=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,r){return'<i class="close icon"></i>\n<div class="header">\u53d1\u5e03\u5230oschina\u535a\u5ba2\u4e0a</div>\n<div class="content">\n<div class="ui form">\n<div class="field">\n<label>\u7528\u6237\u540d</label>\n<div class="ui fluid input">\n<input type="text" name="username">\n</div>\n</div>\n<div class="field">\n<label>\u5bc6\u7801</label>\n<div class="ui fluid input">\n<input type="password" name="password">\n</div>\n</div>\n<div class="field">\n<label>\u539f\u535a\u5ba2\u6587\u7ae0id(\u7559\u7a7a\u8868\u793a\u65b0\u5efa)</label>\n<div class="ui fluid input">\n<input type="text" name="blogid">\n</div>\n</div>\n<div class="ui error message"></div>\n</div>\n</div>\n<div class="actions">\n<div class="ui negative button">\n\u53d6\u6d88\n</div>\n<div class="ui positive right labeled icon button">\n\u53d1\u9001\n<i class="check icon"></i>\n</div>\n</div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof n&&n&&n.exports&&(n.exports=i)}});
