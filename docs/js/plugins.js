!function(){"use strict";var e="undefined"!=typeof window?window:global;if("function"!=typeof e.requirejs){var t={},n={},r=function(e,t){return{}.hasOwnProperty.call(e,t)},i=function(e,t){for(var n,r,i=[],o=0,a=(n=/^\.\.?(\/|$)/.test(t)?[e,t].join("/").split("/"):t.split("/")).length;o<a;o++)".."===(r=n[o])?i.pop():"."!==r&&""!==r&&i.push(r);return i.join("/")},o=function(t,r){var o,a={id:t,exports:{}};return n[t]=a,r(a.exports,(o=t,function(t){var n=function(e){return e.split("/").slice(0,-1).join("/")}(o),r=i(n,t);return e.requirejs(r,o)}),a),a.exports},a=function(e,n){if("object"==typeof e)for(var i in e)r(e,i)&&(t[i]=e[i]);else t[e]=n};e.requirejs=function(e,a){var s=i(e,".");if(null==a&&(a="/"),r(n,s))return n[s].exports;if(r(t,s))return o(s,t[s]);var l=i(s,"./index");if(r(n,l))return n[l].exports;if(r(t,l))return o(l,t[l]);throw new Error('Cannot find module "'+e+'" from "'+a+'"')},e.requirejs.define=a,e.requirejs.register=a,e.requirejs.list=function(){var e=[];for(var n in t)r(t,n)&&e.push(n);return e},e.requirejs.brunch=!0}}(),window.requirejs.define({"plugins/alioss/index":function(e,t,n){var r,i,o,a;i=t("../../lib/notifier"),o=t("../../lib/utils"),t("../../constant");var s={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var t,n,r,i,o,a,l,u="",c=0;for(e=s._utf8_encode(e);c<e.length;)i=(t=e.charCodeAt(c++))>>2,o=(3&t)<<4|(n=e.charCodeAt(c++))>>4,a=(15&n)<<2|(r=e.charCodeAt(c++))>>6,l=63&r,isNaN(n)?a=l=64:isNaN(r)&&(l=64),u=u+this._keyStr.charAt(i)+this._keyStr.charAt(o)+this._keyStr.charAt(a)+this._keyStr.charAt(l);return u},decode:function(e){var t,n,r,i,o,a,l="",u=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");u<e.length;)t=this._keyStr.indexOf(e.charAt(u++))<<2|(i=this._keyStr.indexOf(e.charAt(u++)))>>4,n=(15&i)<<4|(o=this._keyStr.indexOf(e.charAt(u++)))>>2,r=(3&o)<<6|(a=this._keyStr.indexOf(e.charAt(u++))),l+=String.fromCharCode(t),64!=o&&(l+=String.fromCharCode(n)),64!=a&&(l+=String.fromCharCode(r));return l=s._utf8_decode(l)},_utf8_encode:function(e){e=e.replace(/\r\n/g,"\n");for(var t="",n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t+=String.fromCharCode(r):r>127&&r<2048?(t+=String.fromCharCode(r>>6|192),t+=String.fromCharCode(63&r|128)):(t+=String.fromCharCode(r>>12|224),t+=String.fromCharCode(r>>6&63|128),t+=String.fromCharCode(63&r|128))}return t},_utf8_decode:function(e){for(var t="",n=0,r=c1=c2=0;n<e.length;)(r=e.charCodeAt(n))<128?(t+=String.fromCharCode(r),n++):r>191&&r<224?(c2=e.charCodeAt(n+1),t+=String.fromCharCode((31&r)<<6|63&c2),n+=2):(c2=e.charCodeAt(n+1),c3=e.charCodeAt(n+2),t+=String.fromCharCode((15&r)<<12|(63&c2)<<6|63&c3),n+=3);return t}},l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";Crypto={};var u=Crypto.util={rotl:function(e,t){return e<<t|e>>>32-t},rotr:function(e,t){return e<<32-t|e>>>t},endian:function(e){if(e.constructor==Number)return 16711935&u.rotl(e,8)|4278255360&u.rotl(e,24);for(var t=0;t<e.length;t++)e[t]=u.endian(e[t]);return e},randomBytes:function(e){for(var t=[];e>0;e--)t.push(Math.floor(256*Math.random()));return t},stringToBytes:function(e){for(var t=[],n=0;n<e.length;n++)t.push(e.charCodeAt(n));return t},bytesToString:function(e){for(var t=[],n=0;n<e.length;n++)t.push(String.fromCharCode(e[n]));return t.join("")},stringToWords:function(e){for(var t=[],n=0,r=0;n<e.length;n++,r+=8)t[r>>>5]|=e.charCodeAt(n)<<24-r%32;return t},bytesToWords:function(e){for(var t=[],n=0,r=0;n<e.length;n++,r+=8)t[r>>>5]|=e[n]<<24-r%32;return t},wordsToBytes:function(e){for(var t=[],n=0;n<32*e.length;n+=8)t.push(e[n>>>5]>>>24-n%32&255);return t},bytesToHex:function(e){for(var t=[],n=0;n<e.length;n++)t.push((e[n]>>>4).toString(16)),t.push((15&e[n]).toString(16));return t.join("")},hexToBytes:function(e){for(var t=[],n=0;n<e.length;n+=2)t.push(parseInt(e.substr(n,2),16));return t},bytesToBase64:function(e){if("function"==typeof btoa)return btoa(u.bytesToString(e));for(var t,n=[],r=0;r<e.length;r++)switch(r%3){case 0:n.push(l.charAt(e[r]>>>2)),t=(3&e[r])<<4;break;case 1:n.push(l.charAt(t|e[r]>>>4)),t=(15&e[r])<<2;break;case 2:n.push(l.charAt(t|e[r]>>>6)),n.push(l.charAt(63&e[r])),t=-1}for(null!=t&&-1!=t&&n.push(l.charAt(t));n.length%4!=0;)n.push("=");return n.join("")},base64ToBytes:function(e){if("function"==typeof atob)return u.stringToBytes(atob(e));e=e.replace(/[^A-Z0-9+\/]/gi,"");for(var t=[],n=0;n<e.length;n++)switch(n%4){case 1:t.push(l.indexOf(e.charAt(n-1))<<2|l.indexOf(e.charAt(n))>>>4);break;case 2:t.push((15&l.indexOf(e.charAt(n-1)))<<4|l.indexOf(e.charAt(n))>>>2);break;case 3:t.push((3&l.indexOf(e.charAt(n-1)))<<6|l.indexOf(e.charAt(n)))}return t}};Crypto.mode={};u=Crypto.util;Crypto.HMAC=function(e,t,n,r){for(var i=n=n.length>4*e._blocksize?e(n,{asBytes:!0}):u.stringToBytes(n),o=n.slice(0),a=0;a<4*e._blocksize;a++)i[a]^=92,o[a]^=54;var s=e(u.bytesToString(i)+e(u.bytesToString(o)+t,{asString:!0}),{asBytes:!0});return r&&r.asBytes?s:r&&r.asString?u.bytesToString(s):u.bytesToHex(s)};var c=Crypto.SHA1=function(e,t){var n=u.wordsToBytes(c._sha1(e));return t&&t.asBytes?n:t&&t.asString?u.bytesToString(n):u.bytesToHex(n)};c._sha1=function(e){var t=u.stringToWords(e),n=8*e.length,r=[],i=1732584193,o=-271733879,a=-1732584194,s=271733878,l=-1009589776;t[n>>5]|=128<<24-n%32,t[15+(n+64>>>9<<4)]=n;for(var c=0;c<t.length;c+=16){for(var p=i,d=o,f=a,h=s,m=l,v=0;v<80;v++){if(v<16)r[v]=t[c+v];else{var g=r[v-3]^r[v-8]^r[v-14]^r[v-16];r[v]=g<<1|g>>>31}var y=(i<<5|i>>>27)+l+(r[v]>>>0)+(v<20?1518500249+(o&a|~o&s):v<40?1859775393+(o^a^s):v<60?(o&a|o&s|a&s)-1894007588:(o^a^s)-899497514);l=s,s=a,a=o<<30|o>>>2,o=i,i=y}i+=p,o+=d,a+=f,s+=h,l+=m}return[i,o,a,s,l]},c._blocksize=16,a=function(e){var t,n,r;return n="",-1!==(r=(t=new String(e).substring(e.lastIndexOf("/")+1)).lastIndexOf("."))&&(n=t.substring(r),t=t.substring(0,r)),{base:t,ext:n}},r=function(){function e(){}return e.prototype.name="alioss",e.prototype.kind="resource",e.prototype.displayName="\u963f\u91ccoss\u4e91\u5b58\u50a8",e.prototype.description="\u4f7f\u7528\u963f\u91ccoss\u4e91\u505a\u4e3a\u56fe\u5e8a",e.prototype.icon="alioss",e.prototype.logo="img/alioss.png",e.prototype.production=!0,e.prototype.storePluginModel=null,e.prototype.init=function(e){var t,n;if(e){if("string"==typeof(n=e.get("extraInfo")))try{n=JSON.parse(n)}catch(e){t=e,console.log(t)}return this.extraInfo=n||{},this.accessKey=e.get("entryToken"),this.secretKey=e.get("entryTokenSecret"),this.fileName=n.fileName||"{{filename}}",this.urlPrefix=n.urlPrefix,this.uploadEntry=n.uploadEntry,this.storePluginModel=e}},e.prototype.authenticate=function(e){var t,n,r;return this.extraInfo={},t=$('<div class="ui small modal story_modal">\n  <div class="header">\u8bf7\u8f93\u5165\u6709\u6548\u7684 AccessKey,SecretKey \u5b8c\u6210\u8ba4\u8bc1</div>\n  <div class="content story_content">\n    <div class="ui form">\n      <div class="field">\n        <label for="displayName">\u8bf7\u8f93\u5165\u4e00\u4e2a\u81ea\u5b9a\u4e49\u540d\u79f0</label>\n        <div class="ui fluid input">\n          <input type="text" name="displayName" placeholder="" value="\u963f\u91ccoss\u4e91\u5b58\u50a8">\n        </div>\n      </div>\n      <div class="field">\n        <label for="uploadEntry">\u8bf7\u8f93\u5165\u4e00\u4e2a\u6709\u6548\u7684api\u8bbf\u95ee\u5165\u53e3</label>\n        <div class="ui fluid input">\n          <input type="text" name="uploadEntry" placeholder="http(s)://{{\u7a7a\u95f4\u540d\u79f0}}.oss-cn-xxxxxxx.aliyuncs.com" value="">\n        </div>\n      </div>\n      <div class="field">\n        <label for="accessKey">\u8bf7\u8f93\u5165\u4e00\u4e2a\u6709\u6548\u7684AccessKey \u503c</label>\n        <div class="ui fluid input">\n          <input type="text" name="accessKey" placeholder="" value="">\n        </div>\n      </div>\n      <div class="field">\n        <label for="secretKey">\u8bf7\u8f93\u5165\u4e00\u4e2a\u6709\u6548\u7684SecretKey \u503c</label>\n        <div class="ui fluid input">\n          <input type="text" name="secretKey" placeholder="" value="">\n        </div>\n      </div>\n      <div class="field">\n        <label for="fileName">\u6587\u4ef6\u540d\u79f0\u751f\u6210\u89c4\u5219</label>\n        <div class="ui fluid input">\n          <input type="text" name="fileName" placeholder="/folder/{{year}}/{{month}}/{{date}}/{{filename}}" value="/\u5c0f\u4e66\u5320/{{filename}}">\n        </div>\n        <div class="ui pointing label">\u652f\u6301\u53d8\u91cf year, month, date, title, filename, basename, extname, md5</div>\n      </div>\n      <div class="field">\n        <label for="urlPrefix">\u56fe\u7247 URL \u524d\u7f00</label>\n        <div class="ui fluid input">\n          <input type="text" name="urlPrefix" placeholder="http://xxxxx.xxx/" value="">\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class="actions">\n    <div class="tips">\n    </div>\n    <div class="ui cancel button">\n      \u53d6\u6d88\n    </div>\n    <div class="ui positive button">\n      \u786e\u5b9a  \n    </div>\n  </div>\n</div>'),(n=t.find(".ui.form")).form({fields:{urlPrefix:{identifier:"urlPrefix",rules:[{type:"empty",prompt:"url\u524d\u7f00\u4e0d\u80fd\u4e3a\u7a7a"}]},uploadEntry:{identifier:"uploadEntry",rules:[{type:"empty",prompt:"api\u8bbf\u95ee\u5165\u53e3\u4e0d\u80fd\u4e3a\u7a7a"}]},accessKey:{identifier:"accessKey",rules:[{type:"empty",prompt:"accessKey \u4e0d\u80fd\u4e3a\u7a7a"}]},secretKey:{identifier:"secretKey",rules:[{type:"empty",prompt:"secretKey \u4e0d\u80fd\u4e3a\u7a7a"}]}},onSuccess:(r=this,function(){var n,i,o,a,s,l,u;return r.dimmer.dimmer("show"),n=r.dimmer,o=t.find("input[name=displayName]").val().trim(),i=t.find("input[name=accessKey]").val().trim(),s=t.find("input[name=secretKey]").val().trim(),a=t.find("input[name=fileName]").val().trim(),u=t.find("input[name=urlPrefix]").val().trim(),l=t.find("input[name=uploadEntry]").val().trim(),"/"!==u[u.length-1]&&(u+="/"),o=o||"\u4e03\u725b\u4e91\u5b58\u50a8",r.extraInfo.displayName=o,r.extraInfo.urlPrefix=u,r.extraInfo.uploadEntry=l,r.extraInfo.fileName=a||"{{filename}}",r.accessKey=i,r.secretKey=s,r.fileName=a||"{{filename}}",r.urlPrefix=u,r.uploadEntry=l,e(null,i,s,r.extraInfo,r,(function(e){if(n.dimmer("hide"),!e)return t.modal("hide")}))})}),this.dimmer=t.find(".content").dimmer({closable:!1}),t.find(".dimmer").html('<div class="ui indeterminate text loader">\u6821\u9a8c\u4e2d...</div>'),t.modal({closable:!1,allowMultiple:!0,onHidden:function(){return n.form("destroy"),t.modal("destroy"),t.remove()},onApprove:function(){return n.form("validate form"),!1}}).modal("show")},e.prototype.signOut=function(e){return e()},e.prototype.getAccountInfo=function(e){var t;return t=o.dataURL2Blob("data:image/png;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"),this.saveFile(this.extraInfo,"/\u5c0f\u4e66\u5320\u9a8c\u8bc1.png",t,{},(function(t,n,r,o){return t?(i.showMessage("\u7ed1\u5b9a\u8ba4\u8bc1\u5931\u8d25:"+t,6e3,"error"),e("\u7ed1\u5b9a\u8ba4\u8bc1\u5931\u8d25:"+t)):e(null,{shardId:"",username:"",email:""})}))},e.prototype.saveFile=function(e,t,n,r,i){return null==t&&(t=""),null==r&&(r={}),o.blobToArrayBuffer(n,(a=this,function(o,s){var l,u;return s&&((u=new SparkMD5.ArrayBuffer).append(s),l=u.end(),r.fileDataArrayBuffer=s,r.md5=l),a._saveFile(e,t,n,r,i)}));var a},e.prototype._saveFile=function(e,t,n,r,o){var l,u,c,p,d,f,h,m,v,g,y,b,x,w,k,A;if(null==t&&(t=""),null==r&&(r={}),v=this.fileName,f=r.fileModel,d=r.md5,w="\u5c0f\u4e66\u5320",f&&(w=f.get("title")||w),w=w.replace(/[\/\s]/g,"_"),v&&!t.startsWith("/")){m=_.template(v,{interpolate:/\{\{(.+?)\}\}/g}),h=a(t);try{t=m({filename:t,basename:h.base,extname:h.ext,md5:d,year:(new Date).getFullYear().toString(),month:((new Date).getMonth()+1).toString(),date:(new Date).getDate().toString(),title:w})}catch(e){return c=e,console.error(c),void o(c)}}return t=(t=t.replace(/^\/*/,"")).replace(/\s/g,"_"),1,u=Math.round((new Date).getTime()/1e3)+3600,y={expiration:new Date(1e3*u).toISOString(),conditions:[["content-length-range",0,1048576e3]]},b=s.encode(JSON.stringify(y)),g=b,l=Crypto.HMAC(Crypto.SHA1,g,this.secretKey,{asBytes:!0}),x=Crypto.util.bytesToBase64(l),(p=new FormData).append("name",t),p.append("key",t),p.append("policy",b),p.append("OSSAccessKeyId",this.accessKey),p.append("success_action_status","201"),p.append("signature",x),p.append("file",n),A=this.urlPrefix,k=this.uploadEntry,$.ajax({type:"POST",url:k,data:p,processData:!1,contentType:!1}).done((function(e){var n,r;return(n=$(e)).find(">Error").length>0?(g=n.find("Message").html(),i.showMessage("\u4e0a\u4f20\u8d44\u6e90\u5931\u8d25:"+g+"\u300b"+t,6e3,"error"),"function"==typeof o?o("\u4e0a\u4f20\u8d44\u6e90\u5931\u8d25:"+g+"\u300b"+t):void 0):(n.find("Location").html(),r=n.find("Key").html(),"function"==typeof o?o(null,t,A+r,e):void 0)})).fail((function(e,t,n){var r;return(r=e.responseJSON)&&(n=r.error),i.showMessage("\u4e0a\u4f20\u8d44\u6e90\u5931\u8d25:"+n,6e3,"error"),"function"==typeof o?o("\u4e0a\u4f20\u8d44\u6e90\u5931\u8d25:"+n):void 0}))},e}(),n.exports=r}}),window.requirejs.define({"plugins/coding/index":function(e,t,n){var r,i,o,a,s,l,u={}.hasOwnProperty;o=t("../../lib/notifier"),l=t("../../lib/utils"),i=t("../../constant"),s=t("../../views/save_new_dialog_view"),a=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)u.call(t,n)&&(e[n]=t[n]);function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype}(t,e),t.prototype.validateFilename=function(e){return!e.endsWith("/")&&(!!e.replace(/^\/*/g,"")&&/^[^:*?"<>|\r\n]*$/g.test(e))},t.prototype.onSelectObj=function(e,t){var n,r,i,o,a,s;return a=(o=this.currentObj).parentPath||"",o.isChild?n=e:("-1"===(n=o.guid)&&(n=""),0===(a=a+"/"+n).indexOf("/")&&(a=a.substring(1)),(s=(n=e).lastIndexOf("/"))>=0&&(r=n.substring(s+1),i=(i=n.substring(0,s)).replace(/^\/*/g,""),a?(a=a+"/"+i,n=r):(a=i,n=r))),t(a,n)},t}(s),r=function(){function e(){}return e.prototype.name="coding",e.prototype.kind="store",e.prototype.displayName="coding.net",e.prototype.description="\u4f7f\u7528 Coding \u505a\u4e3a\u5b58\u50a8",e.prototype.icon="coding",e.prototype.logo="img/coding.jpg",e.prototype.production=!1,e.prototype.storePluginModel=null,e.prototype.init=function(e){var t,n;if(e){if(n=e.get("extraInfo"),this.postBaseData={pluginName:this.name,entryToken:e.get("entryToken"),entryTokenSecret:e.get("entryTokenSecret"),extraInfo:n},"string"==typeof n)try{n=JSON.parse(n)}catch(e){t=e,console.log(t)}return this.extraInfo=n,this.branchname=this.extraInfo.branchname,this.reponame=this.extraInfo.reponame,this.username=this.extraInfo.username,this.storePluginModel=e}},e.prototype.authenticate=function(e){var t,n,r;return"81d29ac53821e4a25b761accac03b9f2","user,project,project:file,project:depot,project:task,project:key,project:members",n="https://coding.net/oauth_authorize.html?client_id=81d29ac53821e4a25b761accac03b9f2&redirect_uri="+("http://localhost:3000/oauth2/"+this.name)+"&response_type=code&scope=user,project,project:file,project:depot,project:task,project:key,project:members",t=window.open(n,"_blank","resizeable=true,height=400,width=400, left=200, top=30"),window.accessToken=(r=this,function(n,i,a){var s,l,u;r.postBaseData={pluginName:r.name,entryToken:n,entryTokenSecret:i,extraInfo:a};try{a=JSON.parse(a)}catch(e){u=e,console.log(u)}return t.close(),s=$('<div class="ui small modal">\n  <div class="header">\u8bf7\u8f93\u5165\u6709\u6548\u7684\u4ed3\u5e93\uff0c\u53ca\u5bf9\u5e94\u7684\u5206\u652f</div>\n  <div class="content">\n    <div class="ui form">\n      <div class="field">\n        <label>\u4ed3\u5e93\u540d\u79f0</label>\n        <div class="ui fluid icon input">\n          <input type="text" name="repo" placeholder="" value="">\n          <i class="linkify icon"></i>\n        </div>\n      </div>\n      <div class="field">\n        <label>\u5bf9\u5e94\u7684\u5206\u652f</label>\n        <div class="ui fluid icon input">\n          <input type="text" name="branch" placeholder="" value="master">\n          <i class="linkify icon"></i>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class="actions">\n    <div class="tips">\n    </div>\n    <div class="ui basic cancel button">\n      \u53d6\u6d88\n    </div>\n    <div class="ui basic positive button">\n      \u786e\u5b9a  \n    </div>\n  </div>\n</div>'),(l=s.find(".ui.form")).form({fields:{repo:{identifier:"repo",rules:[{type:"empty",prompt:"\u8bf7\u8f93\u5165\u4e00\u4e2a\u6709\u6548\u7684\u4ed3\u5e93\u540d\u79f0"}]},branch:{identifier:"branch",rules:[{type:"empty",prompt:"\u8bf7\u8f93\u5165\u4e00\u4e2a\u6709\u6548\u7684\u5206\u652f"}]}},onSuccess:function(){var t,l,u;return(u=r).dimmer.dimmer("show"),l=s.find("input[name=repo]").val().trim(),t=s.find("input[name=branch]").val().trim(),a.branchname=t,a.reponame=l,u.getAccountInfo((function(t,r){var l;return t?(o.showMessage("\u68c0\u6d4b\u5931\u8d25\uff0c\u68c0\u6d4b\u7528\u6237\u540d\u5931\u8d25",6e3,"error"),u.dimmer.dimmer("hide"),s=null):(l=r.username,a.username=l,u.postBaseData.extraInfo=JSON.stringify(a),u.extraInfo=a,u.username=l,u.branchname=a.branchname,u.reponame=a.reponame,u.listFiles({},{},(function(t,r){return t?(o.showMessage("\u68c0\u6d4b\u5931\u8d25\uff0c\u6ca1\u6709\u627e\u5230\u76f8\u5e94\u7684\u4ed3\u5e93\u6216\u8005\u5206\u652f",6e3,"error"),u.dimmer.dimmer("hide"),u=null,s=null):(e(null,n,i,a,u),u.dimmer.dimmer("hide"),s.modal("hide"),u=null)})))}))}}),r.dimmer=s.find(".content").dimmer({closable:!1}),s.find(".dimmer").html('<div class="ui indeterminate text loader">\u6821\u9a8c\u4e2d...</div>'),s.modal({closable:!1,allowMultiple:!0,onHidden:function(){return s.remove(),s=null},onApprove:function(){return l.form("validate form"),!1}}).modal("show")})},e.prototype.signOut=function(e){return e()},e.prototype.getContextMenu=function(){return{menu:function(e,t){return e.isChild?{refreshFile:{name:"\u66f4\u65b0\u672c\u5730\u7f13\u5b58\u6587\u4ef6"},viewOrign:{name:"\u5728github\u4e2d\u6253\u5f00"},deleteFile:{name:"\u5220\u9664\u6587\u4ef6"}}:{}},actions:{deleteFile:(e=this,function(t,n){var r,i,o;return r=t.guid,i=t&&t.parentPath||"",0===(o=t&&t.isChild?i+"/"+r:r).indexOf("/")&&(o=o.substring(1)),e.repo.remove(e.branch,o,(function(e){return e?n(e):n()}))}),viewOrign:function(e){return function(t,n){var r,i,o,a,s,l;if(i=null,s=t.parentPath,a=t.guid,o=s?s+"/"+a:a,e.extraInfo)try{i=JSON.parse(e.postBaseData.extraInfo)}catch(t){r=t,console.log(r),i=e.extraInfo}return i&&(l="https://www.github.com/"+i.username+"/"+i.reponame+"/blob/"+i.branchname+"/"+o),"client"===STORY_PLATFORM?require("nw.gui").Shell.openExternal(l):window.open(l,"_blank")}}(this)}};var e},e.prototype.getAccountInfo=function(e){var t,n;return t=$.extend(this.postBaseData,{operateType:"getAccountInfo"}),$.ajax({url:"/plugin",data:t,method:"GET",success:(n=this,function(t,r,i){var o,a,s;try{o=JSON.parse(t)}catch(e){a=e,o=t}if(o.error)return e(o);try{(s=JSON.parse(n.postBaseData.extraInfo)).shardId=o.shardId,n.postBaseData.extraInfo=JSON.stringify(s)}catch(e){a=e,console.log(a),(s={}).shardId=o.shardId,n.postBaseData.extraInfo=JSON.stringify(s)}return e(null,o)}),error:function(t){return e(t)},dataType:"json"})},e.prototype.getFile=function(e,t,n){var r,i,o;return r=t.guid,(i=t.parentPath||"")?i+"/"+r:r,this,o=$.extend(this.postBaseData,{parentPath:t.parentPath,guid:t.guid,operateType:"getFile"}),$.ajax({url:"/plugin",data:o,method:"GET",success:function(e,t,r){var i;try{i=JSON.parse(e)}catch(t){t,i=e}return i.error?n(i):n(null,{guid:i.guid,parentPath:i.parentPath,markdownContent:i.markdownContent,htmlContent:i.markdownContent,name:i.name})},error:function(e){return n(e)}})},e.prototype.listFiles=function(e,t,n){var r;return t.parentPath||"",r=$.extend(this.postBaseData,{parentPath:t.parentPath,operateType:"listFiles"}),$.ajax({url:"/plugin",data:r,method:"GET",success:function(e,t,r){var i,o,a,s,u,c;try{i=JSON.parse(e)}catch(t){t,i=e}if(i.error)return n(i);for(a=0,u=i.length;a<u;a++)s=i[a],o=l.checkIsSupportFileType(s.obj.name)?"text":"application",s.obj.fileType=o;return c=_.sortBy(i,(function(e){return(e.folder?"A":"B")+e.title})),n(null,c)},error:function(e){return n(e)}})},e.prototype._saveAttach=function(e,t,n,r){var i,o,a,s;return a=e.lastIndexOf("/"),o=e.substring(0,a),i=e.substring(a+1),s=$.extend({},this.postBaseData,{operateType:"saveFile",parentPath:o,guid:i,fileData:t,fileModel:n.toJSONWithSkipAttachmentData()}),$.ajax({type:"post",url:"/plugin",method:"POST",data:s,dataType:"json",success:function(e,t,n){return r(null,{},this)},error:function(e){return r(e)}})},e.prototype.saveAttach=function(e,t,n,r,i,o,a){var s,u,c,p,d;return p=t.get("pluginName"),u=t.get("guid"),c=t.get("parentPath"),u?p!==this.name?"function"==typeof a?a():void 0:(0===n.indexOf("./")&&(n=n.substring(2)),0===(s=0===n.indexOf("/")?n:c?c+"/"+n:n).indexOf("/")&&(s=s.substring(1)),$.trim(s)?l.blob2Base64(r,(d=this,function(e,n){return e?a(e):d._saveAttach(s,n,t,a)})):a(null,{},this)):"function"==typeof a?a():void 0},e.prototype.saveFile=function(e,t,n,r){var s,u,c,p,d,f,h,m,v;return h=this,p=t.get("pluginName"),u=t.get("guid"),c=t.get("parentPath"),m=t.get("title")||"\u672a\u547d\u540d\u6587\u4ef6.md",this.repo,this.branch,p!==this.name&&(u="",p="",c=""),d=n.saveAs,f=n.saveAttachment,v=this,s=function(e,n,a){var s,u,c,p;return o.showHandling("\u4fdd\u5b58\u4e2d..."),p=setTimeout((function(){return o.hideHandling()}),i.getNetworkResourceTimeout),m.lastIndexOf(".")<0&&(m+=".md"),0===(u=e?e+"/"+n:n).indexOf("/")&&(u=u.substring(1)),s=t.get("content")||"",c=$.extend({},v.postBaseData,{operateType:"saveFile",parentPath:e||"",guid:n||"",title:m,fileMarkdownContent:t.get("content")||"",fileHtmlContent:"",fileModel:t.toJSONWithSkipAttachmentData()}),$.ajax({type:"post",url:"/plugin",method:"POST",data:c,dataType:"json",success:function(n,i,c){var d;return clearTimeout(p),p=null,o.hideHandling(),n.code?(o.showMessage("\u4fdd\u5b58\u5931\u8d25: "+n.error,6e3,"error"),r(n,null)):(d={guid:n.guid,parentPath:n.parentPath,name:n.guid,tagNames:[],createDate:Date.now(),updateDate:Date.now(),isChild:!0},a||f?l.getResourceData("default.md",s,function(n){return function(i,a){return i?(o.showMessage("\u4fdd\u5b58\u9644\u4ef6\u5931\u8d25",6e3,"error"),r(null,d)):(a=a.filter((function(e){return!/^http[s]?:\/\//i.test(e)})),async.eachSeries(a,(function(n,r){var i,a;0===(u=0===(i=n).indexOf("/")?i:e?e+"/"+i:i).indexOf("/")&&(u=u.substring(1));try{n=decodeURI(n)}catch(e){a=e,console.log(a)}return t.getAttachObjectByFilename(n,(function(e,i){var a;return(a=null!=i?i.objectUrl:void 0)?l.objectURLToArrayBuffer(a,(function(i,a){var s;return i?(o.showMessage("\u4fdd\u5b58\u9644\u4ef6\u5931\u8d25: "+n+", "+i,6e3,"error"),r()):(s=l.arrayBufferToBase64(a),h._saveAttach(u,s,t,(function(t){return t&&o.showMessage("\u4fdd\u5b58\u9644\u4ef6\u5931\u8d25: "+n+", "+e,6e3,"error"),r()})))})):r()}))}),(function(e){return clearTimeout(p),p=null,o.hideHandling(),r(null,d,n)})))}}(this)):r(null,d,this))},error:function(e){return r(e)}})},!u||d?new a({plugin:this,saveAs:d,saveAsCallback:r,fileModel:t}).show((function(e,t){return s(e,t,!0)})):s(c,u,!1)},e}(),n.exports=r}}),window.requirejs.define({"plugins/custom_resource/index":function(e,t,n){var r,i,o,a,s;r=t("../../application"),o=t("../../lib/notifier"),a=t("../../lib/utils"),t("../../constant"),s=function(e){return new Function("filename","fileData","opts","callback",e)},i=function(){function e(){}return e.prototype.name="custom_resource",e.prototype.kind="resource",e.prototype.displayName="\u81ea\u5b9a\u4e49\u56fe\u5e8a",e.prototype.description="\u4f7f\u7528\u81ea\u5b9a\u4e49\u7684\u56fe\u5e8a\u4fdd\u5b58\u56fe\u7247",e.prototype.icon="address book outline",e.prototype.logo="",e.prototype.production=!0,e.prototype.storePluginModel=null,e.prototype.init=function(e){var t,n;if(e){if("string"==typeof(n=e.get("extraInfo")))try{n=JSON.parse(n)}catch(e){t=e,console.log(t)}return this.extraInfo=n||{},this._customSaveFn=s(n.saveFnDef),this.storePluginModel=e}},e.prototype.authenticate=function(e){var t,n,r,i;return r={displayName:"\u81ea\u5b9a\u4e49\u56fe\u5e8a"},t=$('<div class="ui small modal story_modal">\n  <div class="header">\u8bf7\u8f93\u5165\u4e0a\u4f20\u56fe\u7247\u7684\u903b\u8f91\u64cd\u4f5c\u4ee3\u7801</div>\n  <div class="content story_content">\n    <div class="ui form">\n      <div class="field">\n        <label>\u4e0a\u4f20\u4ee3\u7801</label>\n        <div class="ui fluid input">\n          <textarea name="saveFnDef"></textarea>\n        </div>\n      </div>\n      <div class="ui message">\n        <details>\n          <summary>\u4ee3\u7801\u903b\u8f91\u8bf4\u660e</summary>\n          <ol>\n            <li>\u4e0a\u4f20\u56fe\u7247\u7684\u4ee3\u7801\u9700\u8981\u4f7f\u7528 javascript \u8bed\u8a00\u5b8c\u6210</li>\n            <li>\u7cfb\u7edf\u901a\u8fc7 javascript \u7684 new Function \u5c06\u81ea\u5b9a\u4e49\u7684\u4e0a\u4f20\u903b\u8f91\u5c01\u88c5\u5728\u4e00\u4e2a\u51fd\u6570\u5185\uff0c\u5f53\u7528\u6237\u89e6\u53d1\u4e0a\u4f20\u56fe\u7247\u7684\u64cd\u4f5c\u65f6\uff0c\u81ea\u52a8\u6267\u884c\u8be5\u51fd\u6570</li>\n            <li>\u5f53\u8be5\u51fd\u6570\u6267\u884c\u65f6\uff0c\u9664\u4e86\u7cfb\u7edf\u9ed8\u8ba4\u7684\u5168\u5c40\u53d8\u91cf\uff0c\u6bd4\u5982 window, $\u7b49\uff0c\u8fd8\u989d\u5916\u63d0\u4f9b\u4e86 filename, fileData, opts, callback \u56db\u4e2a\u53d8\u91cf</li>\n            <ol>\n              <li>filename \u4e3a\u4e0a\u4f20\u6587\u4ef6\u7684\u539f\u59cb\u6587\u4ef6\u540d\uff0c\u5982\u679c\u662f\u4ece\u526a\u5207\u677f\u4e0a\u4f20\u7684\u56fe\u7247\uff0c\u7cfb\u7edf\u81ea\u5df1\u521b\u5efa\u4e00\u4e2a\u6587\u4ef6\u540d, \u683c\u5f0f\u4e3a\u5b57\u7b26\u4e32</li>\n              <li>fileData \u4e3a\u4e0a\u4f20\u6587\u4ef6\u7684\u4e8c\u8fdb\u5236\u5185\u5bb9\uff0c\u683c\u5f0f\u4e3a javascript \u7684 blob \u5bf9\u50cf</li>\n              <li>opts \u63d0\u4f9b\u4e86\u4e00\u4e9b\u989d\u5916\u53c2\u6570\u548c\u65b9\u6cd5\uff0c \u76ee\u524d\u63d0\u4f9b\u4e86\u4e00\u4e2a\u5f53\u524d\u6587\u4ef6\u7684 md5 \u503c\uff08opts.md5\uff09</li>\n              <li>callback \u56de\u8c03\u51fd\u6570\uff0c\u5f53\u56fe\u7247\u4e0a\u4f20\u5b8c\u6210\u540e\uff0c\u9700\u8981\u6267\u884c\u8be5\u56de\u8c03\u51fd\u6570\uff0c\u5e76\u63d0\u4f9b\u76f8\u5173\u7684\u56de\u8c03\u53c2\u6570\uff0c\u6bd4\u5982\u751f\u6210\u7684 url \u5730\u5740</li>\n            </ol>\n            <li>\u5728\u6267\u884c\u5b8c\u4e0a\u4f20\u56fe\u7247\u540e\uff0c\u9700\u8981\u7528\u6237\u6267\u884c\u4e00\u4e2a\u56de\u8c03\u51fd\u6570 callback, \u5c06\u4ee3\u7801\u64cd\u4f5c\u6743\u91cd\u65b0\u8fd4\u56de\u7ed9\u5c0f\u4e66\u5320\uff0c\u56de\u8c03\u51fd\u6570\u9700\u5305\u542b\u4ee5\u4e0b\u53c2\u6570</li>\n            <ol>\n              <li>error \u5982\u679c\u4e0a\u4f20\u56fe\u7247\u5931\u8d25\uff0c\u9700\u8981\u63d0\u4f9b\u4e00\u4e2a error \u63cf\u8ff0\u5931\u8d25\u539f\u56e0\uff0c\u5982\u679c\u4e0a\u4f20\u6210\u529f\uff0c\u76f4\u63a5\u63d0\u4f9b\u4e00\u4e2a null \u503c\u5373\u53ef</li>\n              <li>newFilename \u5982\u679c\u7528\u6237\u60f3\u91cd\u65b0\u751f\u6210\u65b0\u7684\u6587\u4ef6\u540d\uff0c\u9700\u8981\u5728\u8fd9\u91cc\u8fd4\u56de\u8be5\u751f\u6210\u7684\u65b0\u6587\u4ef6\u540d\uff0c\u5982\u679c\u60f3\u4fdd\u6301\u4e0d\u53d8\uff0c\u53ea\u9700\u8bbe\u7f6e\u4e3a  null \u5373\u53ef\u3002</li>\n              <li>url \u4e0a\u4f20\u5b8c\u56fe\u7247\u540e\uff0c\u8fd4\u56de\u7684 url \u5730\u5740</li>\n            </ol>\n          </ol>\n        </details>\n      </div>\n\n    </div>\n  </div>\n  <div class="actions">\n    <div class="tips">\n        <div>\u6ce8\uff1a</div>\n        <div>1.\u67e5\u770b\u6559\u7a0b\uff1a<a href="http://soft.xiaoshujiang.com/blog/images/custom_images_manager" target="_blank">\u6559\u7a0b\u5730\u5740</a>\n        </div>\n    </div>\n    <div class="ui basic cancel button">\n      \u53d6\u6d88\n    </div>\n    <div class="ui basic positive button">\n      \u786e\u5b9a  \n    </div>\n  </div>\n</div>'),(n=t.find(".ui.form")).form({fields:{token:{identifier:"saveFnDef",rules:[{type:"empty",prompt:"\u8bf7\u8f93\u5165\u4e0a\u4f20\u903b\u8f91"}]}},onSuccess:(i=this,function(){var n,l,u;return(u=i).dimmer.dimmer("show"),l=t.find("textarea[name=saveFnDef]").val().trim(),r.saveFnDef=l,i._customSaveFn=s(l),u.extraInfo=r,n=a.dataURL2Blob("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAAMCAIAAADgcHrrAAAAHklEQVQoFWP8//8/A+mAiXQtIB2j2jDCbTRIMIIEANA3AxUYd5EMAAAAAElFTkSuQmCC"),u.saveFile(u.extraInfo,"\u5c0f\u4e66\u5320\u9a8c\u8bc1\u6587\u4ef6.png",n,{},(function(n,i,a,s){return n?(o.showMessage("\u68c0\u6d4b\u5931\u8d25\uff0c\u4e0a\u4f20\u6587\u4ef6\u51fa\u9519:"+n,6e3,"error"),u.dimmer.dimmer("hide")):(e(null,"custom_resource",null,r,u,(function(){})),u.dimmer.dimmer("hide"),t.modal("hide"),u=null)}))})}),this.dimmer=t.find(".content").dimmer({closable:!1}),t.find(".dimmer").html('<div class="ui indeterminate text loader">\u6821\u9a8c\u4e2d...</div>'),t.modal({closable:!1,allowMultiple:!0,onHidden:function(){return t.remove(),t=null},onApprove:function(){return n.form("validate form"),!1}}).modal("show")},e.prototype.signOut=function(e){return e()},e.prototype.getAccountInfo=function(e){return e(null,{username:"custom_resource"})},e.prototype.saveFile=function(e,t,n,i,s){var l,u,c,p;return p=this,l=i.fileModel,c={},l&&(u=l.attributes,c.doc={id:u._id,createDate:u.createDate,tagNames:u.tagNames,title:u.title,updateDate:u.contentUpdateDate||u.updateDate}),a.blobToArrayBuffer(n,(function(e,a){var l,u,d,f,h;a&&((f=new SparkMD5.ArrayBuffer).append(a),d=f.end(),c.md5=d),u=function(e){var t;return e=e||function(){return!0},t=[],p.storePluginModel&&p.storePluginModel.collection.where({kind:"resource"}).filter((function(e){return"custom_resource"!==e.get("name")})).forEach((function(n){var o,a,s,l,u;if(s=n.get("name"),(l=r.getPlugin(s,"resource"))&&(l.init(n),a=n.get("id"),o=n.get("displayName")||l.displayName,e(u={displayName:o,name:s,id:a})))return u.saveFile=function(e,t,n){return l.saveFile({},e,t,i,n)},t.push(u)})),t},c.getPlugins=u;try{return h=setTimeout((function(){return h=null,"function"==typeof s?s("\u4e0a\u4f20\u8d44\u6e90\u8d85\u65f6(1\u5206\u949f)"):void 0}),6e4),p._customSaveFn(t,n,c,(function(e,n,r){if(h)return clearTimeout(h),h=null,e?(o.showMessage("\u4e0a\u4f20\u8d44\u6e90\u5931\u8d25:"+e+"\u300b"+t,6e3,"error"),"function"==typeof s?s("\u4e0a\u4f20\u8d44\u6e90\u5931\u8d25:"+e+"\u300b"+t):void 0):(t=n||t,"function"==typeof s?s(null,t,r,{}):void 0)}))}catch(e){return l=e,clearTimeout(h),h=null,"function"==typeof s?s("\u4e0a\u4f20\u8d44\u6e90\u4ee3\u7801\u6267\u884c\u5931\u8d25, \u8bf7\u68c0\u67e5\u4ee3\u7801\u8bed\u6cd5\uff0c\u903b\u8f91\u662f\u5426\u6b63\u786e:"+l):void 0}}))},e}(),n.exports=i}}),window.requirejs.define({"plugins/dropbox/index":function(e,t,n){var r,i,o,a,s,l,u={}.hasOwnProperty;l=t("../../lib/utils"),r=t("../../constant"),s=t("../../views/save_new_dialog_view"),o=t("../../lib/notifier"),a=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)u.call(t,n)&&(e[n]=t[n]);function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype}(t,e),t.prototype.validateFilename=function(e){return!e.endsWith("/")&&(!!e.replace(/^\/*/g,"")&&/^[^:*?"<>|\r\n]*$/g.test(e))},t.prototype.onSelectObj=function(e,t){var n,r,i,o,a,s;return a=(o=this.currentObj).parentPath||"",o.isChild||("-1"===(n=o.guid)&&(n=""),0===(a=a+"/"+n).indexOf("/")&&(a=a.substring(1))),(s=(n=e).lastIndexOf("/"))>=0&&(r=n.substring(s+1),i=(i=n.substring(0,s)).replace(/^\/*/g,""),a?(a=a+"/"+i,n=r):(a=i,n=r)),t(a,n)},t}(s),i=function(){function e(){}return e.prototype.name="dropbox",e.prototype.kind="store",e.prototype.displayName="Dropbox \u5168\u5c40\u6587\u4ef6\u5939",e.prototype.platform="all",e.prototype.icon="dropbox",e.prototype.logo="img/dropbox.png",e.prototype.description="Dropbox (Permission type Full Dropbox)\u5b58\u50a8\uff0c\u5982\u679c\u65e0\u6cd5\u8bbf\u95ee\uff0c\u8bf7\u68c0\u67e5\u7f51\u9875dropbox.com\u662f\u5426\u53ef\u8fbe",e.prototype.production=!0,e.prototype.storePluginModel=null,e.prototype.clientId="clu8ul5tzsgxrwn",e.prototype.init=function(e){var t,n;if(e)return this.storePluginModel=e,t=e.get("entryToken"),n=e.get("entryTokenSecret"),this.dbx=new Dropbox.Dropbox({clientId:this.clientId,accessToken:t,refreshToken:n}),this.initAuthProxyMethods()},e.prototype.getDisplayName=function(){var e;return this.storePluginModel&&(e=this.storePluginModel.get("displayName")),e||this.displayName},e.prototype.authenticate=function(e){var t,n,r;return n="/dropboxv2.html",n="client"===STORY_PLATFORM||"localhost"!==document.location.hostname?"https://markdown.xiaoshujiang.com"+n:document.location.origin+n,(t=new Dropbox.Dropbox({clientId:this.clientId})).auth.getAuthenticationUrl(n,void 0,"code","offline",void 0,void 0,!0).then((r=this,function(i){var a,s;return s=window.open(i,"_blank","resizeable=true,height=400,width=400, left=200, top=30"),a=t.auth.codeVerifier,window.accessToken=function(i,l,u,c,p){var d,f,h;d={},h={};try{d=JSON.parse(p),h=JSON.parse(c)}catch(e){d={}}return console.log("hashInfo",d),console.log("searchInfo",h),f=function(){return r.postBaseData={pluginName:r.name,entryToken:i,entryTokenSecret:l,extraInfo:u},r.dbx=new Dropbox.Dropbox({clientId:r.clientId,accessToken:i,refreshToken:l}),r.initAuthProxyMethods(),e(null,i,l,u,r,(function(e,t){return r.storePluginModel=t,s.close(),s=null}))},!i&&h.code?(t.auth.setCodeVerifier(a),t.auth.getAccessTokenFromCode(n,h.code).then((function(e){var n;return n=e.result,l=n.refresh_token,i=n.access_token,t.auth.setAccessToken(n.access_token),t.auth.setRefreshToken(n.refresh_token),e.access_token,f()})).catch((function(e){return o.showMessage("\u8ba4\u8bc1\u5931\u8d25:"+e,6e3,"error"),console.error(e)}))):f()}}))},e.prototype.signOut=function(e){return this.dbx.authTokenRevoke().then((function(){return e()})).catch((function(){return e()}))},e.prototype.initAuthProxyMethods=function(){var t;return t=this,["getAccountInfo","hasFile","getFile","listFiles","saveAttach","saveFile","signOut"].forEach((function(n){var r;return r=e.prototype[n],t[n]=function(){var e;return e=arguments,t.dbx.auth.checkAndRefreshAccessToken().then((function(){return r.apply(t,e)})).catch((function(e){return o.showMessage("\u51fa\u9519\uff1a"+e,6e3,"error")}))}}))},e.prototype.getAccountInfo=function(e){return this.dbx.usersGetCurrentAccount().then((function(t){var n,r;return n={username:(r=t.result).name.display_name,displayName:r.name.display_name,email:r.email},e(null,n)})).catch((function(t){return e(t)}))},e.prototype.hasFile=function(e,t,n,r){var i,o,a,s,l,u;return s=n.hasFilesCached,u=e.lastIndexOf("/"),l=e.substring(0,u),a=e.substring(u+1),i=function(e,t){var n,r;for(n=0,r=t.length;n<r;n++)if(t[n].title===e)return!0},(o=s[l])?r(null,i(a,o)):this.listFiles(t,{parentPath:l},(function(e,t){return null==t&&(t=[]),s[l]=t,r(null,i(a,t))}))},e.prototype.getFile=function(e,t,n){var r,i,a;i=t.guid,"/"===(a=t.parentPath||"")?a="":a.startsWith("/")||(a="/"+a),"/"===a&&(a=""),r=this.dbx,this.dbx.filesDownload({path:a+"/"+i}).then((function(e){var s;return s=e.result.fileBlob,l.blob2Text(s,(function(e,s){var u;return u=[],l.getResourceData(i,s,(function(e,c){return e?(o.showMessage("\u5904\u7406\u9644\u4ef6\u51fa\u9519,\u9519\u8bef\u539f\u56e0\uff1a"+e),n(e)):(c=c.filter((function(e){return!/^http[s]?:\/\//i.test(e)})),async.mapLimit(c,20,(function(e,t){var n;return 0!==(n=0===e.indexOf("/")?e:a?a+"/"+e:e).indexOf("/")&&(n="/"+n),r.filesDownload({path:n}).then((function(n){return u.push({name:e,type:l.mimeLookup(e),blob:n.result.fileBlob}),t()})).catch((function(n){return o.showMessage("\u5904\u7406\u9644\u4ef6\u51fa\u9519:"+e+",\u9519\u8bef\u539f\u56e0\uff1a"+n),t()}))}),(function(e){var r;return e?o.showMessage("\u52a0\u8f7d\u9644\u4ef6\u51fa\u9519"+e):(r={guid:i,parentPath:t.parentPath,markdownContent:s,resources:u,htmlContent:s,tagNames:[],name:l.generateMarkdownTitle(i)},n(null,r))})))}))}))})).catch((function(e){return n(e)}))},e.prototype._searchFiles=function(e,t,n){var r,i,a;return a=t.query,r=t.offset||0,i=t.pageSize||30,this,this.dbx.filesSearch({path:"",query:a,start:r,max_results:i,mode:"filename_and_content"}).then((function(e){var t,o;return o=[],null!=(t=e.matches)&&t.forEach((function(e){var t,n,r,i;return r=(e=e.metadata).path_display,{name:t=e.name,parentPath:n=(n=r.substring(0,r.lastIndexOf(t))).replace(/^\/+|\/+$/g,""),childCount:0,isChild:!0,guid:t,createDate:Date.now(),updateDate:Date.now(),tagNames:[]},i={key:r.replace(/\//g,"_"),title:t,tagNames:[],createDate:Date.now(),updateDate:Date.now(),parentPath:n,guid:t,orign:e},o.push(i)})),n(null,{offset:r,pageSize:i,total:t.length,files:o})})).catch((function(e){try{e=JSON.stringify(e)}catch(t){e=t,console.log(e)}return o.showMessage("\u52a0\u8f7d\u6587\u4ef6\u5217\u8868\u51fa\u73b0\u9519\u8bef"+e,3e3,"error"),n(e)}))},e.prototype.listFiles=function(e,t,n){var r,i,o;return"/"===(i=t.parentPath||"/")?i="":i.startsWith("/")||(i="/"+i),r=this.dbx,o=[],this.dbx.filesListFolder({path:i}).then((function(e){var i,a,s,u;return a=e.result,i=function(e){return r.filesListFolderContinue({cursor:e}).then((function(e){var t;return a=e.result,u(a.entries),a.has_more?i(a.cursor):(t=_.sortBy(o,(function(e){return(e.folder?"A":"B")+e.title})),n(null,t))})).catch((function(e){return n(e)}))},(u=function(e){var n,r,i,a,s,u,c,p;for(p=[],i=0,a=e.length;i<a;i++)n=e[i],r=l.checkIsSupportFileType(n.name)?"text":"application",0===(u=n.path_display).indexOf("/")&&(u=u.substring(1)),s={guid:n.name,parentPath:t.parentPath,name:n.name,isChild:"file"===n[".tag"],createDate:new Date(n.client_modified).getTime(),updateDate:new Date(n.client_modified).getTime(),fileType:r,tagNames:[]},c={key:u.replace(/\//g,"_"),folder:"folder"===n[".tag"],title:n.name,lazy:"folder"===n[".tag"],obj:s},p.push(o.push(c));return p})(a.entries),a.has_more?i(a.cursor):(s=_.sortBy(o,(function(e){return(e.folder?"A":"B")+e.title})),n(null,s))})).catch((function(e){return n(e)}))},e.prototype.saveAttach=function(e,t,n,r,i,o,a){var s,l,u,c,p,d,f;return p=t.get("pluginName"),l=t.get("guid"),c=t.get("parentPath"),l?p!==this.name?"function"==typeof a?a():void 0:(0===n.indexOf("./")&&(n=n.substring(2)),0!==(s=0===n.indexOf("/")?n:c?c+"/"+n:n).indexOf("/")&&(s="/"+s),$.trim(s)?(d=s.lastIndexOf("/"),s.substring(0,d),u=s.substring(d+1),this.dbx.filesUpload({path:s,contents:new File([r],u),mode:{".tag":"overwrite"}}).then((f=this,function(e){return a(null,{},f)})).catch((function(e){return a(e)}))):"function"==typeof a?a(null,{},this):void 0):"function"==typeof a?a():void 0},e.prototype.getContextMenu=function(){return{menu:function(e,t){return e.isChild?{refreshFile:{name:"\u66f4\u65b0\u672c\u5730\u7f13\u5b58\u6587\u4ef6"},viewOrign:{name:"\u5728 Dropbox \u5b98\u7f51\u4e2d\u6253\u5f00"},deleteFile:{name:"\u5220\u9664\u6587\u4ef6"}}:{}},actions:{deleteFile:(e=this,function(t,n){var r,i,o;return r=t.guid,i=t&&t.parentPath||"",0!==(o=t&&t.isChild?i+"/"+r:r).indexOf("/")&&(o="/"+o),e.dbx.filesDeleteV2({path:o}).then((function(e){return n()})).catch((function(e){return n(e)}))}),viewOrign:function(e){return function(t,n){var r,i,o;return e.extraInfo,i=t.parentPath||"",r=t.guid,i?i+"/"+r:r,o="https://www.dropbox.com/home/"+i+"?preview="+r,"dropboxfolder"===e.name&&(o="https://www.dropbox.com/home/%E5%BA%94%E7%94%A8/%E5%B0%8F%E4%B9%A6%E5%8C%A0/"+i+"?preview="+r),"client"===STORY_PLATFORM?require("nw.gui").Shell.openExternal(o):window.open(o,"_blank")}}(this)}};var e},e.prototype.saveFile=function(e,t,n,i){var s,u,c,p,d,f,h,m,v;return p=t.get("pluginName"),u=t.get("guid"),c=t.get("parentPath"),m=t.get("title")||"\u672a\u547d\u540d\u6587\u4ef6.md",p!==this.name&&(u="",p="",c=""),d=n.saveAs,f=n.saveAttachment,h=this,v=this,s=function(e,n,a){var s,u,c,p;return o.showHandling("\u4fdd\u5b58\u4e2d..."),p=setTimeout((function(){return o.hideHandling()}),r.getNetworkResourceTimeout),m.lastIndexOf(".")<0&&(m+=".md"),u=t.get("content")||"",Date.now(),(c=e+"/"+n).startsWith("/")||(c="/"+c),s=v.dbx,v.dbx.filesUpload({path:c,contents:new File([u],n),mode:{".tag":"overwrite"}}).then((function(r){var d,m;return m=r.result,d={guid:n,parentPath:e,name:n,tagNames:[],createDate:new Date(m.client_modified).getTime(),updateDate:new Date(m.client_modified).getTime(),isChild:!0},l.getResourceData("default.md",u,(function(n,r){var u;return n?(o.showMessage("\u4fdd\u5b58\u9644\u4ef6\u5931\u8d25",6e3,"error"),i(null,d)):(u={},r=r.filter((function(e){return!/^http[s]?:\/\//i.test(e)})),async.eachSeries(r,(function(n,r){var i,p;0!==(c=0===(i=n).indexOf("/")?i:e?e+"/"+i:i).indexOf("/")&&(c="/"+c);try{n=decodeURI(n)}catch(e){p=e,console.log(p)}return h.hasFile(c,{},{hasFilesCached:u},(function(e,i){return!i||a||f?t.getAttachObjectByFilename(n,(function(e,t){var i,a,u;return(a=null!=t?t.objectUrl:void 0)?(u=c.lastIndexOf("/"),c.substring(0,u),i=c.substring(u+1),l.objectURLToArrayBuffer(a,(function(e,t){var a;return e?(o.showMessage("\u4fdd\u5b58\u9644\u4ef6\u5931\u8d25: "+n+", "+e,6e3,"error"),r()):(a=new Blob([new Uint8Array(t)]),s.filesUpload({path:c,contents:new File([a],i),mode:{".tag":"overwrite"}}).then((function(e){return r()})).catch((function(e){return o.showMessage("\u4fdd\u5b58\u9644\u4ef6\u5931\u8d25: "+n+", "+e,6e3,"error"),r()})))}))):r()})):r()}))}),(function(e){return clearTimeout(p),p=null,o.hideHandling(),i(null,d,v)})))}))})).catch((function(e){return clearTimeout(p),p=null,o.hideHandling(),i(e)}))},!u||d?new a({plugin:this,saveAs:d,saveAsCallback:i,fileModel:t}).show((function(e,t){return s(e,t,!0)})):s(c,u,!1)},e}(),n.exports=i}}),window.requirejs.define({"plugins/dropboxcustom/index":function(e,t,n){var r,i,o={}.hasOwnProperty;i=t("../../lib/notifier"),r=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)o.call(t,n)&&(e[n]=t[n]);function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype}(t,e),t.prototype.platform="client",t.prototype.name="dropboxcustom",t.prototype.displayName="Dropbox Token",t.prototype.description="Dropbox (Manual generate Token)\u5b58\u50a8\uff0c\u5982\u679c\u65e0\u6cd5\u8bbf\u95ee\uff0c\u8bf7\u68c0\u67e5\u7f51\u9875dropbox.com\u662f\u5426\u53ef\u8fbe",t.prototype.init=function(e){var t;if(e)return this.storePluginModel=e,t=e.get("entryToken"),this.dbx=new Dropbox.Dropbox({accessToken:t})},t.prototype.initAuthProxyMethods=function(){},t.prototype.authenticate=function(e){var t,n,r;return t=$('<div class="ui small modal story_modal">\n  <div class="header">\u8bf7\u8f93\u5165\u6709\u6548\u7684token</div>\n  <div class="content story_content">\n    <div class="ui form">\n      <div class="field">\n        <label>\u8bf7\u8f93\u5165\u4e00\u4e2a\u6709\u6548\u7684token\u503c</label>\n        <div class="ui fluid icon input">\n          <input type="text" name="token" placeholder="" value="">\n          <i class="linkify icon"></i>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class="actions">\n    <div class="tips">\n    <div>\u6ce8\uff1a</div>\n    <div>1. \u7533\u8bf7 token \u5730\u5740\uff1a<a href="https://www.dropbox.com/developers/apps" target="_blank">App Console</a><br/>\n    2. \u6743\u9650: files.metadata.write, files.content.write, account_info.read\n    </div>\n    </div>\n    <div class="ui cancel button">\n      \u53d6\u6d88\n    </div>\n    <div class="ui positive button">\n      \u786e\u5b9a  \n    </div>\n  </div>\n</div>'),(n=t.find(".ui.form")).form({fields:{token:{identifier:"token",rules:[{type:"empty",prompt:"\u8bf7\u8f93\u5165\u4e00\u4e2a\u6709\u6548\u7684 access token"}]}},onSuccess:(r=this,function(){var n;return r.dimmer.dimmer("show"),n=t.find("input[name=token]").val().trim(),r.dbx=new Dropbox.Dropbox({accessToken:n}),e(null,n,"","",r,(function(e,n){if(r.dimmer.dimmer("hide"),!e)return r.storePluginModel=n,t.modal("hide");i.showMessage("\u8ba4\u8bc1\u5931\u8d25:"+e,6e3,"error")}))})}),this.dimmer=t.find(".content").dimmer({closable:!1}),t.find(".dimmer").html('<div class="ui indeterminate text loader">\u6821\u9a8c\u4e2d...</div>'),t.modal({closable:!1,allowMultiple:!0,onHidden:function(){return n.form("destroy"),t.modal("destroy"),t.remove()},onApprove:function(){return n.form("validate form"),!1}}).modal("show")},t}(t("../dropbox/index")),n.exports=r}}),window.requirejs.define({"plugins/dropboxfolder/index":function(e,t,n){var r,i={}.hasOwnProperty;r=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)i.call(t,n)&&(e[n]=t[n]);function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype}(t,e),t.prototype.name="dropboxfolder",t.prototype.displayName="Dropbox \u6587\u4ef6\u5939",t.prototype.description="Dropbox (Permission type App folder)\u5b58\u50a8\uff0c\u5982\u679c\u65e0\u6cd5\u8bbf\u95ee\uff0c\u8bf7\u68c0\u67e5\u7f51\u9875dropbox.com\u662f\u5426\u53ef\u8fbe",t.prototype.clientId="7ey0xsh7moxpg2q",t}(t("../dropbox/index")),n.exports=r}}),window.requirejs.define({"plugins/gitea/index":function(e,t,n){var r,i,o,a,s,l,u,c={}.hasOwnProperty;o=t("../../lib/notifier"),l=t("../../lib/utils"),r=t("../../constant"),s=t("../../views/save_new_dialog_view"),a=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)c.call(t,n)&&(e[n]=t[n]);function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype}(t,e),t.prototype.validateFilename=function(e){return!e.endsWith("/")&&(!!e.replace(/^\/*/g,"")&&/^[^:*?"<>|\r\n]*$/g.test(e))},t.prototype.onSelectObj=function(e,t){var n,r,i,o,a,s;return a=(o=this.currentObj).parentPath||"",o.isChild||("-1"===(n=o.guid)&&(n=""),0===(a=a+"/"+n).indexOf("/")&&(a=a.substring(1))),(s=(n=e).lastIndexOf("/"))>=0&&(r=n.substring(s+1),i=(i=n.substring(0,s)).replace(/^\/*/g,""),a?(a=a+"/"+i,n=r):(a=i,n=r)),t(a,n)},t}(s),u=function(e,t,n,r){var i;return i={ref:t,access_token:n},$.ajax({url:e,data:i,method:"GET",success:function(e,t,n){return r("PUT",e.sha)},error:function(e){return r("POST")}})},i=function(){function e(){}return e.prototype.name="gitea",e.prototype.kind="store",e.prototype.displayName="gitea.com",e.prototype.description="\u4f7f\u7528 Gitea \u505a\u4e3a\u5b58\u50a8",e.prototype.icon="gitea",e.prototype.logo="img/gitea.png",e.prototype.production=!0,e.prototype.storePluginModel=null,e.prototype.init=function(e){var t,n;if(e){if("string"==typeof(n=e.get("extraInfo")))try{n=JSON.parse(n)}catch(e){t=e,console.log(t)}return this.extraInfo=n,this.branchname=this.extraInfo.branchname,this.serverUrl=this.extraInfo.serverUrl||"https://gitea.com",this.reponame=this.extraInfo.reponame,this.username=this.extraInfo.username,this.token=e.get("entryToken"),this.storePluginModel=e}},e.prototype.getDisplayName=function(){var e;return this.storePluginModel&&(e=this.storePluginModel.get("displayName")),e||this.displayName},e.prototype.authenticate=function(e){var t,n,r;return t=$('<div class="ui small modal story_modal">\n  <div class="header">\u8bf7\u8f93\u5165\u6709\u6548\u7684 token, \u4ed3\u5e93\uff0c\u53ca\u5bf9\u5e94\u7684\u5206\u652f</div>\n  <div class="content story_content">\n    <div class="ui form">\n      <div class="field">\n        <label for="serverUrl">\u670d\u52a1\u5668\u5730\u5740 </label>\n        <div class="ui fluid icon input">\n          <input type="text" name="serverUrl" placeholder="https://gitea.com" value="">\n          <i class="linkify icon"></i>\n        </div>\n      </div>\n      <div class="field">\n        <label for="token">token </label>\n        <div class="ui fluid icon input">\n          <input type="text" name="token" placeholder="" value="">\n          <i class="key icon"></i>\n        </div>\n      </div>\n      <div class="field">\n        <label for="username">\u62e5\u6709\u8005 </label>\n        <div class="ui fluid icon input">\n          <input type="text" name="username" placeholder="" value="">\n          <i class="user icon"></i>\n        </div>\n        <div class="ui message info icon"><i class="info circle icon"></i><div class="content">\u4e3a\u7a7a\u65f6\uff0c\u81ea\u52a8\u5c06 token \u5bf9\u5e94\u7684\u7528\u6237\u540d\u505a\u4e3a\u62e5\u6709\u8005</div></div>\n      </div>\n      <div class="field">\n        <label for="repo">\u4ed3\u5e93\u540d\u79f0</label>\n        <div class="ui fluid icon input">\n          <input type="text" name="repo" placeholder="" value="">\n          <i class="warehouse icon"></i>\n        </div>\n        <div class="ui message info icon"><i class="info circle icon"></i><div class="content">\u6bd4\u5982 http://gitea.com/suziwen/<strong>markdownxiaoshujiang</strong>,<br> \u53ea\u9700\u8981\u8f93\u5165 <strong>markdownxiaoshujiang</strong> \u5c31\u53ef\u4ee5\u4e86</div></div>\n      </div>\n      <div class="field">\n        <label for="branch">\u5bf9\u5e94\u7684\u5206\u652f</label>\n        <div class="ui fluid icon input">\n          <input type="text" name="branch" placeholder="" value="master">\n          <i class="random icon"></i>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class="actions">\n    <div class="tips">\n    <div>\u6ce8:</div>\n    <div> 1. token \u7533\u8bf7\u5730\u5740 <a target="_blank" href="https://gitea.com/user/settings/applications">token</a><br/>\n    2. \u4ed3\u5e93\u5fc5\u987b\u521d\u59cb\u5316\uff08\u4e5f\u5c31\u662f\u5fc5\u987b\u6709\u4e00\u4e2a\u6587\u4ef6,\u6bd4\u5982readme.md\uff09\n    </div>\n    </div>\n    <div class="ui basic cancel button">\n      \u53d6\u6d88\n    </div>\n    <div class="ui basic positive button">\n      \u786e\u5b9a  \n    </div>\n  </div>\n</div>'),(n=t.find(".ui.form")).form({fields:{token:{identifier:"token",rules:[{type:"empty",prompt:"\u8bf7\u8f93\u5165\u4e00\u4e2a\u6709\u6548\u7684token\u540d\u79f0"}]},repo:{identifier:"repo",rules:[{type:"empty",prompt:"\u8bf7\u8f93\u5165\u4e00\u4e2a\u6709\u6548\u7684\u4ed3\u5e93\u540d\u79f0"}]},branch:{identifier:"branch",rules:[{type:"empty",prompt:"\u8bf7\u8f93\u5165\u4e00\u4e2a\u6709\u6548\u7684\u5206\u652f"}]}},onSuccess:(r=this,function(){var n,i,a,s,l,u;return(s=r).dimmer.dimmer("show"),a=(a=t.find("input[name=serverUrl]").val().trim()).replace(/\/*$/,""),l=t.find("input[name=token]").val().trim(),u=t.find("input[name=username]").val().trim(),i=t.find("input[name=repo]").val().trim(),n=t.find("input[name=branch]").val().trim(),s.token=l,s.serverUrl=a||"https://gitea.com",s.getAccountInfo((function(r,c){return r?(o.showMessage("\u68c0\u6d4b\u5931\u8d25\uff0c\u68c0\u6d4b\u7528\u6237\u540d\u5931\u8d25",6e3,"error"),s.dimmer.dimmer("hide")):(u=u||c.username,s.username=u,s.branchname=n,s.reponame=i,s.listFiles({},{},(function(r,c){return r?(o.showMessage("\u68c0\u6d4b\u5931\u8d25\uff0c\u6ca1\u6709\u627e\u5230\u76f8\u5e94\u7684\u4ed3\u5e93\u6216\u8005\u5206\u652f",6e3,"error"),s.dimmer.dimmer("hide")):(e(null,l,null,{username:u,branchname:n,reponame:i,serverUrl:a},s),s.dimmer.dimmer("hide"),t.modal("hide"),s=null)})))}))})}),this.dimmer=t.find(".content").dimmer({closable:!1}),t.find(".dimmer").html('<div class="ui indeterminate text loader">\u6821\u9a8c\u4e2d...</div>'),t.modal({closable:!1,allowMultiple:!0,onHidden:function(){return n.form("destroy"),t.modal("destroy"),t.remove(),t=null},onApprove:function(){return n.form("validate form"),!1}}).modal("show")},e.prototype.signOut=function(e){return e()},e.prototype.getContextMenu=function(){return{menu:function(e,t){return e.isChild?{refreshFile:{name:"\u66f4\u65b0\u672c\u5730\u7f13\u5b58\u6587\u4ef6"},viewOrign:{name:"\u5728 gitea \u4e2d\u6253\u5f00"},deleteFile:{name:"\u5220\u9664\u6587\u4ef6"}}:{}},actions:{deleteFile:(e=this,function(t,n){var r,i,o,a,s;return i=t.guid,o=t&&t.parentPath||"",0===(a=t&&t.isChild?o+"/"+i:i).indexOf("/")&&(a=a.substring(1)),s={branch:e.branchname,message:"\u5220\u9664\u6587\u4ef6: "+i},r=e.serverUrl+"/api/v1/repos/"+e.username+"/"+e.reponame+"/contents/"+encodeURIComponent(a)+"?access_token="+e.token,u(r,e.branchname,e.token,(function(e,t){return null==e&&(e="POST"),null==t&&(t=""),s.sha=t,$.ajax({url:r,method:"DELETE",data:JSON.stringify(s),contentTypex:"application/x-www-form-urlencoded; charset=UTF-8",contentTypey:!1,contentType:"application/json;charset=utf-8",success:function(e,t,r){return n()},error:function(e){return n(e)}})}))}),viewOrign:function(e){return function(t,n){var r,i,o,a;return null,o=t.parentPath||"",i=t.guid,r=o?o+"/"+i:i,a=e.serverUrl+"/"+e.username+"/"+e.reponame+"/src/branch/"+e.branchname+"/"+r,"client"===STORY_PLATFORM?require("nw.gui").Shell.openExternal(a):window.open(a,"_blank")}}(this)}};var e},e.prototype.getAccountInfo=function(e){var t;return t={access_token:this.token},$.ajax({url:this.serverUrl+"/api/v1/user",data:t,method:"GET",success:function(t,n,r){var i;try{i=JSON.parse(t)}catch(e){i=t}return e(null,i)},error:function(t){return e(t)},dataType:"json"})},e.prototype.hasFile=function(e,t,n,r){var i,o,a,s,l,u;return s=n.hasFilesCached,u=e.lastIndexOf("/"),l=e.substring(0,u),a=e.substring(u+1),i=function(e,t){var n,r;for(n=0,r=t.length;n<r;n++)if(t[n].title===e)return!0},(o=s[l])?r(null,i(a,o)):this.listFiles(t,{parentPath:l},(function(e,t){return null==t&&(t=[]),s[l]=t,r(null,i(a,t))}))},e.prototype.getFileMeta=function(e,t,n){var r,i,o,a,s;return o=t.guid,i=(a=t.parentPath||"")?a+"/"+o:o,this,this.branchname,this.token,s={ref:this.branchname,access_token:this.token},r=this.serverUrl+"/api/v1/repos/"+this.username+"/"+this.reponame+"/contents/",$.ajax({url:r+encodeURIComponent(i),data:s,method:"GET",success:function(e,t,r){var i;try{i=JSON.parse(e)}catch(t){t,i=e}return n(null,{guid:i.name,parentPath:a,name:l.generateMarkdownTitle(i.name)})},error:function(e){return n(e)}})},e.prototype.getFile=function(e,t,n){var r,i,a,s,u,c,p;return s=t.guid,a=(u=t.parentPath||"")?u+"/"+s:s,this,p=this.branchname,r=this.token,c={ref:this.branchname,access_token:this.token},i=this.serverUrl+"/api/v1/repos/"+this.username+"/"+this.reponame+"/contents/",$.ajax({url:i+encodeURIComponent(a),data:c,method:"GET",success:function(e,t,a){var c,d,f,h;try{c=JSON.parse(e)}catch(t){f=t,c=e}return d=decodeURIComponent(escape(window.atob(c.content))),h=[],l.getResourceData(s,d,(function(e,t){return e?(o.showMessage("\u5904\u7406\u9644\u4ef6\u51fa\u9519,\u9519\u8bef\u539f\u56e0\uff1a"+e),n(e)):(t=t.filter((function(e){return!/^http[s]?:\/\//i.test(e)})),async.eachSeries(t,(function(e,t){var n;return 0===(n=0===e.indexOf("/")?e:u?u+"/"+e:e).indexOf("/")&&(n=n.substring(1)),$.ajax({url:i+encodeURIComponent(n),data:{ref:p,access_token:r},method:"GET",success:function(n,r,i){var o,a;return a=l.mimeLookup(e),o=l.base642Blob(n.content,a),h.push({name:e,type:a,blob:o}),t()},error:function(n){return o.showMessage("\u5904\u7406\u9644\u4ef6\u51fa\u9519:"+e+",\u9519\u8bef\u539f\u56e0\uff1a"+n),t()}})}),(function(e){return e?(o.showMessage("\u52a0\u8f7d\u9644\u4ef6\u51fa\u9519"+e),n(f)):n(null,{guid:c.name,parentPath:u,markdownContent:d,htmlContent:d,resources:h,name:l.generateMarkdownTitle(c.name)})})))}))},error:function(e){return n(e)}})},e.prototype.listFiles=function(e,t,n){var r,i;return r=t.parentPath||"",i={access_token:this.token,ref:this.branchname},$.ajax({url:this.serverUrl+"/api/v1/repos/"+this.username+"/"+this.reponame+"/contents/"+encodeURIComponent(r),data:i,method:"GET",success:function(e,r,i){var o,a,s,u,c,p,d,f,h,m;try{o=JSON.parse(e)}catch(t){t,o=e}for(h=[],u=0,p=o.length;u<p;u++)c=o[u],a=l.checkIsSupportFileType(c.name)?"text":"application",s=c.path,d={guid:c.name,parentPath:t.parentPath,name:c.name,isChild:"dir"!==c.type,createDate:Date.now(),updateDate:Date.now(),fileType:a,tagNames:[]},f={key:s.replace(/\//g,"_"),folder:"dir"===c.type,title:c.name,lazy:"dir"===c.type,obj:d},h.push(f);return m=_.sortBy(h,(function(e){return(e.folder?"A":"B")+e.title})),n(null,m)},error:function(e){return n(e)}})},e.prototype._saveAttach=function(e,t,n,r){var i,o,a;return o=e.lastIndexOf("/"),e.substring(0,o),e.substring(o+1),a={access_token:this.token,branch:this.branchname,content:t,message:"\u6dfb\u52a0\u9644\u4ef6 "+e},i=this.serverUrl+"/api/v1/repos/"+this.username+"/"+this.reponame+"/contents/"+encodeURIComponent(e),u(i,this.branchname,this.token,(function(e,t){return null==e&&(e="POST"),null==t&&(t=""),a.sha=t,$.ajax({type:e,url:i,method:e,data:a,dataType:"json",success:function(e,t,n){return r(null,{},this)},error:function(e){return r(e)}})}))},e.prototype.saveAttach=function(e,t,n,r,i,o,a){var s,u,c,p,d;return p=t.get("pluginName"),u=t.get("guid"),c=t.get("parentPath"),u?p!==this.name?"function"==typeof a?a():void 0:(0===n.indexOf("./")&&(n=n.substring(2)),0===(s=0===n.indexOf("/")?n:c?c+"/"+n:n).indexOf("/")&&(s=s.substring(1)),$.trim(s)?l.blob2Base64(r,(d=this,function(e,n){return e?a(e):d._saveAttach(s,n,t,a)})):a(null,{},this)):"function"==typeof a?a():void 0},e.prototype.saveFile=function(e,t,n,i){var s,c,p,d,f,h,m,v,g;return m=this,d=t.get("pluginName"),c=t.get("guid"),p=t.get("parentPath"),v=t.get("title")||"\u672a\u547d\u540d\u6587\u4ef6.md",this.repo,this.branch,d!==this.name&&(c="",d="",p=""),f=n.saveAs,h=n.saveAttachment,g=this,s=function(e,n,a){var s,c,p,d,f,y,b;return o.showHandling("\u4fdd\u5b58\u4e2d..."),b=setTimeout((function(){return o.hideHandling()}),r.getNetworkResourceTimeout),v.lastIndexOf(".")<0&&(v+=".md"),0===(f=e?e+"/"+n:n).indexOf("/")&&(f=f.substring(1)),p=t.get("content")||"",c=a?"\u521b\u5efa\u6587\u4ef6:"+f:"\u4fee\u6539\u6587\u4ef6:"+f,y={access_token:g.token,branch:g.branchname,message:c},d=g.serverUrl+"/api/v1/repos/"+g.username+"/"+g.reponame+"/contents/"+encodeURIComponent(f),s=new Blob([t.get("content")||""],{type:"text/plain"}),l.blob2Base64(s,(function(r,s){return r?i(r):u(d,g.branchname,g.token,(function(r,u){return null==r&&(r="POST"),y.sha=u,y.content=s,$.ajax({url:d,method:r,contentType:"application/x-www-form-urlencoded; charset=UTF-8",data:y,dataType:"json",success:function(r,u,c){var d;return clearTimeout(b),b=null,o.hideHandling(),d={guid:n,parentPath:e,name:n,tagNames:[],createDate:Date.now(),updateDate:Date.now(),isChild:!0},l.getResourceData("default.md",p,(function(n,r){var u;return n?(o.showMessage("\u4fdd\u5b58\u9644\u4ef6\u5931\u8d25",6e3,"error"),o.hideHandling(),i(null,d)):(u={},r=r.filter((function(e){return!/^http[s]?:\/\//i.test(e)})),async.eachSeries(r,(function(n,r){var i,c;0===(f=0===(i=n).indexOf("/")?i:e?e+"/"+i:i).indexOf("/")&&(f=f.substring(1));try{n=decodeURI(n)}catch(e){c=e,console.log(c)}return m.hasFile(f,{},{hasFilesCached:u},(function(e,i){return!i||a||h?t.getAttachObjectByFilename(n,(function(e,i){var a;return(a=null!=i?i.objectUrl:void 0)?l.objectURLToArrayBuffer(a,(function(i,a){return i?(o.showMessage("\u4fdd\u5b58\u9644\u4ef6\u5931\u8d25: "+n+", "+i,6e3,"error"),r()):(s=l.arrayBufferToBase64(a),m._saveAttach(f,s,t,(function(t){return t&&o.showMessage("\u4fdd\u5b58\u9644\u4ef6\u5931\u8d25: "+n+", "+e,6e3,"error"),r()})))})):r()})):r()}))}),(function(e){return clearTimeout(b),b=null,o.hideHandling(),i(null,d,m)})))}))},error:function(e){return o.hideHandling(),i(e)}})}))}))},!c||f?new a({plugin:this,saveAs:f,saveAsCallback:i,fileModel:t}).show((function(e,t){return s(e,t,!0)})):s(p,c,!1)},e}(),n.exports=i}}),window.requirejs.define({"plugins/giteav2/index":function(e,t,n){var r,i,o,a,s,l,u,c={}.hasOwnProperty;o=t("../../lib/notifier"),l=t("../../lib/utils"),r=t("../../constant"),s=t("../../views/save_new_dialog_view"),a=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)c.call(t,n)&&(e[n]=t[n]);function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype}(t,e),t.prototype.validateFilename=function(e){return!e.endsWith("/")&&(!!e.replace(/^\/*/g,"")&&/^[^:*?"<>|\r\n]*$/g.test(e))},t.prototype.onSelectObj=function(e,t){var n,r,i,o,a,s;return a=(o=this.currentObj).parentPath||"",o.isChild||("-1"===(n=o.guid)&&(n=""),0===(a=a+"/"+n).indexOf("/")&&(a=a.substring(1))),(s=(n=e).lastIndexOf("/"))>=0&&(r=n.substring(s+1),i=(i=n.substring(0,s)).replace(/^\/*/g,""),a?(a=a+"/"+i,n=r):(a=i,n=r)),t(a,n)},t}(s),u=function(e,t,n,r){var i;return i={ref:t,access_token:n},$.ajax({url:e,data:i,method:"GET",success:function(e,t,n){return r("PUT",e.sha)},error:function(e){return r("POST")}})},i=function(){function e(){}return e.prototype.name="giteav2",e.prototype.kind="store",e.prototype.displayName="giteaV2",e.prototype.description="\u4f7f\u7528 Gitea(1.21 \u7248\u672c\u4e4b\u540e)\u505a\u4e3a\u5b58\u50a8",e.prototype.icon="gitea",e.prototype.logo="img/gitea.png",e.prototype.production=!0,e.prototype.storePluginModel=null,e.prototype.init=function(e){var t,n;if(e){if("string"==typeof(n=e.get("extraInfo")))try{n=JSON.parse(n)}catch(e){t=e,console.log(t)}return this.extraInfo=n,this.branchname=this.extraInfo.branchname,this.serverUrl=this.extraInfo.serverUrl||"https://gitea.com",this.reponame=this.extraInfo.reponame,this.username=this.extraInfo.username,this.token=e.get("entryToken"),this.storePluginModel=e}},e.prototype.getDisplayName=function(){var e;return this.storePluginModel&&(e=this.storePluginModel.get("displayName")),e||this.displayName},e.prototype.authenticate=function(e){var t,n,r;return t=$('<div class="ui small modal story_modal">\n  <div class="header">\u8bf7\u8f93\u5165\u6709\u6548\u7684 token, \u4ed3\u5e93\uff0c\u53ca\u5bf9\u5e94\u7684\u5206\u652f</div>\n  <div class="content story_content">\n    <div class="ui form">\n      <div class="field">\n        <label for="serverUrl">\u670d\u52a1\u5668\u5730\u5740 </label>\n        <div class="ui fluid icon input">\n          <input type="text" name="serverUrl" placeholder="https://gitea.com" value="">\n          <i class="linkify icon"></i>\n        </div>\n      </div>\n      <div class="field">\n        <label for="token">token </label>\n        <div class="ui fluid icon input">\n          <input type="text" name="token" placeholder="" value="">\n          <i class="key icon"></i>\n        </div>\n      </div>\n      <div class="field">\n        <label for="username">\u62e5\u6709\u8005 </label>\n        <div class="ui fluid icon input">\n          <input type="text" name="username" placeholder="" value="">\n          <i class="user icon"></i>\n        </div>\n        <div class="ui message info icon"><i class="info circle icon"></i><div class="content">\u4e3a\u7a7a\u65f6\uff0c\u81ea\u52a8\u5c06 token \u5bf9\u5e94\u7684\u7528\u6237\u540d\u505a\u4e3a\u62e5\u6709\u8005</div></div>\n      </div>\n      <div class="field">\n        <label for="repo">\u4ed3\u5e93\u540d\u79f0</label>\n        <div class="ui fluid icon input">\n          <input type="text" name="repo" placeholder="" value="">\n          <i class="warehouse icon"></i>\n        </div>\n        <div class="ui message info icon"><i class="info circle icon"></i><div class="content">\u6bd4\u5982 http://gitea.com/suziwen/<strong>markdownxiaoshujiang</strong>,<br> \u53ea\u9700\u8981\u8f93\u5165 <strong>markdownxiaoshujiang</strong> \u5c31\u53ef\u4ee5\u4e86</div></div>\n      </div>\n      <div class="field">\n        <label for="branch">\u5bf9\u5e94\u7684\u5206\u652f</label>\n        <div class="ui fluid icon input">\n          <input type="text" name="branch" placeholder="" value="master">\n          <i class="random icon"></i>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class="actions">\n    <div class="tips">\n    <div>\u6ce8:</div>\n    <div> 1. token \u7533\u8bf7\u5730\u5740 <a target="_blank" href="https://gitea.com/user/settings/applications">token</a><br/>\n    2. \u4ed3\u5e93\u5fc5\u987b\u521d\u59cb\u5316\uff08\u4e5f\u5c31\u662f\u5fc5\u987b\u6709\u4e00\u4e2a\u6587\u4ef6,\u6bd4\u5982readme.md\uff09\n    </div>\n    </div>\n    <div class="ui basic cancel button">\n      \u53d6\u6d88\n    </div>\n    <div class="ui basic positive button">\n      \u786e\u5b9a  \n    </div>\n  </div>\n</div>'),(n=t.find(".ui.form")).form({fields:{token:{identifier:"token",rules:[{type:"empty",prompt:"\u8bf7\u8f93\u5165\u4e00\u4e2a\u6709\u6548\u7684token\u540d\u79f0"}]},repo:{identifier:"repo",rules:[{type:"empty",prompt:"\u8bf7\u8f93\u5165\u4e00\u4e2a\u6709\u6548\u7684\u4ed3\u5e93\u540d\u79f0"}]},branch:{identifier:"branch",rules:[{type:"empty",prompt:"\u8bf7\u8f93\u5165\u4e00\u4e2a\u6709\u6548\u7684\u5206\u652f"}]}},onSuccess:(r=this,function(){var n,i,a,s,l,u;return(s=r).dimmer.dimmer("show"),a=(a=t.find("input[name=serverUrl]").val().trim()).replace(/\/*$/,""),l=t.find("input[name=token]").val().trim(),u=t.find("input[name=username]").val().trim(),i=t.find("input[name=repo]").val().trim(),n=t.find("input[name=branch]").val().trim(),s.token=l,s.serverUrl=a||"https://gitea.com",s.getAccountInfo((function(r,c){return r?(o.showMessage("\u68c0\u6d4b\u5931\u8d25\uff0c\u68c0\u6d4b\u7528\u6237\u540d\u5931\u8d25",6e3,"error"),s.dimmer.dimmer("hide")):(u=u||c.username,s.username=u,s.branchname=n,s.reponame=i,s.listFiles({},{},(function(r,c){return r?(o.showMessage("\u68c0\u6d4b\u5931\u8d25\uff0c\u6ca1\u6709\u627e\u5230\u76f8\u5e94\u7684\u4ed3\u5e93\u6216\u8005\u5206\u652f",6e3,"error"),s.dimmer.dimmer("hide")):(e(null,l,null,{username:u,branchname:n,reponame:i,serverUrl:a},s),s.dimmer.dimmer("hide"),t.modal("hide"),s=null)})))}))})}),this.dimmer=t.find(".content").dimmer({closable:!1}),t.find(".dimmer").html('<div class="ui indeterminate text loader">\u6821\u9a8c\u4e2d...</div>'),t.modal({closable:!1,allowMultiple:!0,onHidden:function(){return n.form("destroy"),t.modal("destroy"),t.remove(),t=null},onApprove:function(){return n.form("validate form"),!1}}).modal("show")},e.prototype.signOut=function(e){return e()},e.prototype.getContextMenu=function(){return{menu:function(e,t){return e.isChild?{refreshFile:{name:"\u66f4\u65b0\u672c\u5730\u7f13\u5b58\u6587\u4ef6"},viewOrign:{name:"\u5728 gitea \u4e2d\u6253\u5f00"},deleteFile:{name:"\u5220\u9664\u6587\u4ef6"}}:{}},actions:{deleteFile:(e=this,function(t,n){var r,i,o,a,s;return i=t.guid,o=t&&t.parentPath||"",0===(a=t&&t.isChild?o+"/"+i:i).indexOf("/")&&(a=a.substring(1)),s={branch:e.branchname,message:"\u5220\u9664\u6587\u4ef6: "+i},r=e.serverUrl+"/api/v1/repos/"+e.username+"/"+e.reponame+"/contents/"+encodeURIComponent(a)+"?access_token="+e.token,u(r,e.branchname,e.token,(function(e,t){return null==e&&(e="POST"),null==t&&(t=""),s.sha=t,$.ajax({url:r,method:"DELETE",data:JSON.stringify(s),contentType:"application/json; charset=utf-8",dataType:"json",success:function(e,t,r){return n()},error:function(e){return n(e)}})}))}),viewOrign:function(e){return function(t,n){var r,i,o,a;return null,o=t.parentPath||"",i=t.guid,r=o?o+"/"+i:i,a=e.serverUrl+"/"+e.username+"/"+e.reponame+"/src/branch/"+e.branchname+"/"+r,"client"===STORY_PLATFORM?require("nw.gui").Shell.openExternal(a):window.open(a,"_blank")}}(this)}};var e},e.prototype.getAccountInfo=function(e){var t;return t={access_token:this.token},$.ajax({url:this.serverUrl+"/api/v1/user",data:t,method:"GET",success:function(t,n,r){var i;try{i=JSON.parse(t)}catch(e){i=t}return e(null,i)},error:function(t){return e(t)},dataType:"json"})},e.prototype.hasFile=function(e,t,n,r){var i,o,a,s,l,u;return s=n.hasFilesCached,u=e.lastIndexOf("/"),l=e.substring(0,u),a=e.substring(u+1),i=function(e,t){var n,r;for(n=0,r=t.length;n<r;n++)if(t[n].title===e)return!0},(o=s[l])?r(null,i(a,o)):this.listFiles(t,{parentPath:l},(function(e,t){return null==t&&(t=[]),s[l]=t,r(null,i(a,t))}))},e.prototype.getFileMeta=function(e,t,n){var r,i,o,a,s;return o=t.guid,i=(a=t.parentPath||"")?a+"/"+o:o,this,this.branchname,this.token,s={ref:this.branchname,access_token:this.token},r=this.serverUrl+"/api/v1/repos/"+this.username+"/"+this.reponame+"/contents/",$.ajax({url:r+encodeURIComponent(i),data:s,method:"GET",success:function(e,t,r){var i;try{i=JSON.parse(e)}catch(t){t,i=e}return n(null,{guid:i.name,parentPath:a,name:l.generateMarkdownTitle(i.name)})},error:function(e){return n(e)}})},e.prototype.getFile=function(e,t,n){var r,i,a,s,u,c,p;return s=t.guid,a=(u=t.parentPath||"")?u+"/"+s:s,this,p=this.branchname,r=this.token,c={ref:this.branchname,access_token:this.token},i=this.serverUrl+"/api/v1/repos/"+this.username+"/"+this.reponame+"/contents/",$.ajax({url:i+encodeURIComponent(a),data:c,method:"GET",success:function(e,t,a){var c,d,f,h;try{c=JSON.parse(e)}catch(t){f=t,c=e}return d=decodeURIComponent(escape(window.atob(c.content))),h=[],l.getResourceData(s,d,(function(e,t){return e?(o.showMessage("\u5904\u7406\u9644\u4ef6\u51fa\u9519,\u9519\u8bef\u539f\u56e0\uff1a"+e),n(e)):(t=t.filter((function(e){return!/^http[s]?:\/\//i.test(e)})),async.eachSeries(t,(function(e,t){var n;return 0===(n=0===e.indexOf("/")?e:u?u+"/"+e:e).indexOf("/")&&(n=n.substring(1)),$.ajax({url:i+encodeURIComponent(n),data:{ref:p,access_token:r},method:"GET",success:function(n,r,i){var o,a;return a=l.mimeLookup(e),o=l.base642Blob(n.content,a),h.push({name:e,type:a,blob:o}),t()},error:function(n){return o.showMessage("\u5904\u7406\u9644\u4ef6\u51fa\u9519:"+e+",\u9519\u8bef\u539f\u56e0\uff1a"+n),t()}})}),(function(e){return e?(o.showMessage("\u52a0\u8f7d\u9644\u4ef6\u51fa\u9519"+e),n(f)):n(null,{guid:c.name,parentPath:u,markdownContent:d,htmlContent:d,resources:h,name:l.generateMarkdownTitle(c.name)})})))}))},error:function(e){return n(e)}})},e.prototype.listFiles=function(e,t,n){var r,i;return r=t.parentPath||"",i={access_token:this.token,ref:this.branchname},$.ajax({url:this.serverUrl+"/api/v1/repos/"+this.username+"/"+this.reponame+"/contents/"+encodeURIComponent(r),data:i,method:"GET",success:function(e,r,i){var o,a,s,u,c,p,d,f,h,m;try{o=JSON.parse(e)}catch(t){t,o=e}for(h=[],u=0,p=o.length;u<p;u++)c=o[u],a=l.checkIsSupportFileType(c.name)?"text":"application",s=c.path,d={guid:c.name,parentPath:t.parentPath,name:c.name,isChild:"dir"!==c.type,createDate:Date.now(),updateDate:Date.now(),fileType:a,tagNames:[]},f={key:s.replace(/\//g,"_"),folder:"dir"===c.type,title:c.name,lazy:"dir"===c.type,obj:d},h.push(f);return m=_.sortBy(h,(function(e){return(e.folder?"A":"B")+e.title})),n(null,m)},error:function(e){return n(e)}})},e.prototype._saveAttach=function(e,t,n,r){var i,o,a;return o=e.lastIndexOf("/"),e.substring(0,o),e.substring(o+1),a={branch:this.branchname,content:t,message:"\u6dfb\u52a0\u9644\u4ef6 "+e},i=this.serverUrl+"/api/v1/repos/"+this.username+"/"+this.reponame+"/contents/"+encodeURIComponent(e)+"?access_token="+this.token,u(i,this.branchname,this.token,(function(e,t){return null==e&&(e="POST"),null==t&&(t=""),a.sha=t,$.ajax({type:e,url:i,method:e,data:JSON.stringify(a),contentType:"application/json; charset=utf-8",dataType:"json",success:function(e,t,n){return r(null,{},this)},error:function(e){return r(e)}})}))},e.prototype.saveAttach=function(e,t,n,r,i,o,a){var s,u,c,p,d;return p=t.get("pluginName"),u=t.get("guid"),c=t.get("parentPath"),u?p!==this.name?"function"==typeof a?a():void 0:(0===n.indexOf("./")&&(n=n.substring(2)),0===(s=0===n.indexOf("/")?n:c?c+"/"+n:n).indexOf("/")&&(s=s.substring(1)),$.trim(s)?l.blob2Base64(r,(d=this,function(e,n){return e?a(e):d._saveAttach(s,n,t,a)})):a(null,{},this)):"function"==typeof a?a():void 0},e.prototype.saveFile=function(e,t,n,i){var s,c,p,d,f,h,m,v,g;return m=this,d=t.get("pluginName"),c=t.get("guid"),p=t.get("parentPath"),v=t.get("title")||"\u672a\u547d\u540d\u6587\u4ef6.md",this.repo,this.branch,d!==this.name&&(c="",d="",p=""),f=n.saveAs,h=n.saveAttachment,g=this,s=function(e,n,a){var s,c,p,d,f,y,b;return o.showHandling("\u4fdd\u5b58\u4e2d..."),b=setTimeout((function(){return o.hideHandling()}),r.getNetworkResourceTimeout),v.lastIndexOf(".")<0&&(v+=".md"),0===(f=e?e+"/"+n:n).indexOf("/")&&(f=f.substring(1)),p=t.get("content")||"",c=a?"\u521b\u5efa\u6587\u4ef6:"+f:"\u4fee\u6539\u6587\u4ef6:"+f,y={branch:g.branchname,message:c},d=g.serverUrl+"/api/v1/repos/"+g.username+"/"+g.reponame+"/contents/"+encodeURIComponent(f)+"?access_token="+g.token,s=new Blob([t.get("content")||""],{type:"text/plain"}),l.blob2Base64(s,(function(r,s){return r?i(r):u(d,g.branchname,g.token,(function(r,u){return null==r&&(r="POST"),y.sha=u,y.content=s,$.ajax({url:d,method:r,contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify(y),success:function(r,u,c){var d;return clearTimeout(b),b=null,o.hideHandling(),d={guid:n,parentPath:e,name:n,tagNames:[],createDate:Date.now(),updateDate:Date.now(),isChild:!0},l.getResourceData("default.md",p,(function(n,r){var u;return n?(o.showMessage("\u4fdd\u5b58\u9644\u4ef6\u5931\u8d25",6e3,"error"),o.hideHandling(),i(null,d)):(u={},r=r.filter((function(e){return!/^http[s]?:\/\//i.test(e)})),async.eachSeries(r,(function(n,r){var i,c;0===(f=0===(i=n).indexOf("/")?i:e?e+"/"+i:i).indexOf("/")&&(f=f.substring(1));try{n=decodeURI(n)}catch(e){c=e,console.log(c)}return m.hasFile(f,{},{hasFilesCached:u},(function(e,i){return!i||a||h?t.getAttachObjectByFilename(n,(function(e,i){var a;return(a=null!=i?i.objectUrl:void 0)?l.objectURLToArrayBuffer(a,(function(i,a){return i?(o.showMessage("\u4fdd\u5b58\u9644\u4ef6\u5931\u8d25: "+n+", "+i,6e3,"error"),r()):(s=l.arrayBufferToBase64(a),m._saveAttach(f,s,t,(function(t){return t&&o.showMessage("\u4fdd\u5b58\u9644\u4ef6\u5931\u8d25: "+n+", "+e,6e3,"error"),r()})))})):r()})):r()}))}),(function(e){return clearTimeout(b),b=null,o.hideHandling(),i(null,d,m)})))}))},error:function(e){return o.hideHandling(),i(e)}})}))}))},!c||f?new a({plugin:this,saveAs:f,saveAsCallback:i,fileModel:t}).show((function(e,t){return s(e,t,!0)})):s(p,c,!1)},e}(),n.exports=i}}),window.requirejs.define({"plugins/giteawiki/index":function(e,t,n){var r,i,o,a,s,l,u,c={}.hasOwnProperty;o=t("../../lib/notifier"),l=t("../../lib/utils"),r=t("../../constant"),s=t("../../views/save_new_dialog_view"),a=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)c.call(t,n)&&(e[n]=t[n]);function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype}(t,e),t.prototype.validateFilename=function(e){return!e.endsWith("/")&&(!!e.replace(/^\/*/g,"")&&/^[^:*?"<>|\r\n]*$/g.test(e))},t.prototype.show=function(e){return t.__super__.show.call(this,e),this.$el.find("input[name=filename]").val(this.fileModel.get("title"))},t.prototype.setSelectObj=function(e,t){var n;return this.currentObj=e,"",n=this.fileModel.get("title")||"\u672a\u547d\u540d\u7684\u6587\u4ef6",e.isChild?("/"+t.getParent().title+"/",n=e.name):"-1"===e.guid?"/":"/"+t.title+"/",this.$el.find("input[name=filename]").val(n)},t.prototype.onSelectObj=function(e,t){var n,r,i,o,a,s;return a=(o=this.currentObj).parentPath||"",o.isChild||("-1"===(n=o.guid)&&(n=""),0===(a=a+"/"+n).indexOf("/")&&(a=a.substring(1))),(s=(n=e).lastIndexOf("/"))>=0&&(r=n.substring(s+1),i=(i=n.substring(0,s)).replace(/^\/*/g,""),a?(a=a+"/"+i,n=r):(a=i,n=r)),t("",a+n)},t}(s),u=function(e,t,n){var r;return r={access_token:t},$.ajax({url:e,data:r,method:"GET",success:function(e,t,r){return n(!0)},error:function(e){return n(!1)}})},i=function(){function e(){}return e.prototype.name="giteawiki",e.prototype.kind="store",e.prototype.displayName="gitea wiki",e.prototype.description="\u4f7f\u7528 GiteaWiki \u505a\u4e3a\u5b58\u50a8",e.prototype.icon="gitea",e.prototype.logo="img/gitea.png",e.prototype.production=!0,e.prototype.storePluginModel=null,e.prototype.init=function(e){var t,n;if(e){if("string"==typeof(n=e.get("extraInfo")))try{n=JSON.parse(n)}catch(e){t=e,console.log(t)}return this.extraInfo=n,this.serverUrl=this.extraInfo.serverUrl||"https://gitea.com",this.reponame=this.extraInfo.reponame,this.username=this.extraInfo.username,this.token=e.get("entryToken"),this.storePluginModel=e}},e.prototype.getDisplayName=function(){var e;return this.storePluginModel&&(e=this.storePluginModel.get("displayName")),e||this.displayName},e.prototype.authenticate=function(e){var t,n,r;return t=$('<div class="ui small modal story_modal">\n  <div class="header">\u8bf7\u8f93\u5165\u6709\u6548\u7684 token, \u4ed3\u5e93\uff0c\u53ca\u5bf9\u5e94\u7684\u5206\u652f</div>\n  <div class="content story_content">\n    <div class="ui form">\n      <div class="field">\n        <label for="serverUrl">\u670d\u52a1\u5668\u5730\u5740 </label>\n        <div class="ui fluid icon input">\n          <input type="text" name="serverUrl" placeholder="https://gitea.com" value="">\n          <i class="linkify icon"></i>\n        </div>\n      </div>\n      <div class="field">\n        <label for="token">token </label>\n        <div class="ui fluid icon input">\n          <input type="text" name="token" placeholder="" value="">\n          <i class="key icon"></i>\n        </div>\n      </div>\n      <div class="field">\n        <label for="username">\u62e5\u6709\u8005 </label>\n        <div class="ui fluid icon input">\n          <input type="text" name="username" placeholder="" value="">\n          <i class="user icon"></i>\n        </div>\n        <div class="ui message info icon"><i class="info circle icon"></i><div class="content">\u4e3a\u7a7a\u65f6\uff0c\u81ea\u52a8\u5c06 token \u5bf9\u5e94\u7684\u7528\u6237\u540d\u505a\u4e3a\u62e5\u6709\u8005</div></div>\n      </div>\n      <div class="field">\n        <label for="repo">\u4ed3\u5e93\u540d\u79f0</label>\n        <div class="ui fluid icon input">\n          <input type="text" name="repo" placeholder="" value="">\n          <i class="warehouse icon"></i>\n        </div>\n        <div class="ui message info icon"><i class="info circle icon"></i><div class="content">\u6bd4\u5982 http://gitea.com/suziwen/<strong>markdownxiaoshujiang</strong>,<br> \u53ea\u9700\u8981\u8f93\u5165 <strong>markdownxiaoshujiang</strong> \u5c31\u53ef\u4ee5\u4e86</div></div>\n      </div>\n    </div>\n  </div>\n  <div class="actions">\n    <div class="tips">\n    <div>\u6ce8:</div>\n    <div> 1. token \u7533\u8bf7\u5730\u5740 <a target="_blank" href="https://gitea.com/user/settings/applications">token</a><br/>\n    2. \u4ed3\u5e93\u5fc5\u987b\u521d\u59cb\u5316\uff08\u4e5f\u5c31\u662f\u5fc5\u987b\u6709\u4e00\u4e2a\u6587\u4ef6,\u6bd4\u5982readme.md\uff09\n    </div>\n    </div>\n    <div class="ui basic cancel button">\n      \u53d6\u6d88\n    </div>\n    <div class="ui basic positive button">\n      \u786e\u5b9a  \n    </div>\n  </div>\n</div>'),(n=t.find(".ui.form")).form({fields:{token:{identifier:"token",rules:[{type:"empty",prompt:"\u8bf7\u8f93\u5165\u4e00\u4e2a\u6709\u6548\u7684token\u540d\u79f0"}]},repo:{identifier:"repo",rules:[{type:"empty",prompt:"\u8bf7\u8f93\u5165\u4e00\u4e2a\u6709\u6548\u7684\u4ed3\u5e93\u540d\u79f0"}]}},onSuccess:(r=this,function(){var n,i,a,s,l;return(a=r).dimmer.dimmer("show"),i=t.find("input[name=serverUrl]").val().trim(),s=t.find("input[name=token]").val().trim(),l=t.find("input[name=username]").val().trim(),n=t.find("input[name=repo]").val().trim(),a.token=s,a.serverUrl=i||"https://gitea.com",a.getAccountInfo((function(r,u){return r?(o.showMessage("\u68c0\u6d4b\u5931\u8d25\uff0c\u68c0\u6d4b\u7528\u6237\u540d\u5931\u8d25",6e3,"error"),a.dimmer.dimmer("hide")):(l=l||u.username,a.username=l,a.reponame=n,a.listFiles({},{},(function(r,u){return r?(o.showMessage("\u68c0\u6d4b\u5931\u8d25\uff0c\u6ca1\u6709\u627e\u5230\u76f8\u5e94\u7684\u4ed3\u5e93\u6216\u8005\u5206\u652f",6e3,"error"),a.dimmer.dimmer("hide")):(e(null,s,null,{username:l,reponame:n,serverUrl:i},a),a.dimmer.dimmer("hide"),t.modal("hide"),a=null)})))}))})}),this.dimmer=t.find(".content").dimmer({closable:!1}),t.find(".dimmer").html('<div class="ui indeterminate text loader">\u6821\u9a8c\u4e2d...</div>'),t.modal({closable:!1,allowMultiple:!0,onHidden:function(){return n.form("destroy"),t.modal("destroy"),t.remove(),t=null},onApprove:function(){return n.form("validate form"),!1}}).modal("show")},e.prototype.signOut=function(e){return e()},e.prototype.getContextMenu=function(){return{menu:function(e,t){return e.isChild?{refreshFile:{name:"\u66f4\u65b0\u672c\u5730\u7f13\u5b58\u6587\u4ef6"},viewOrign:{name:"\u5728 gitea \u4e2d\u6253\u5f00"},deleteFile:{name:"\u5220\u9664\u6587\u4ef6"}}:{}},actions:{deleteFile:(e=this,function(t,n){var r,i,o,a,s;return i=t.guid,o=t&&t.parentPath||"",0===(a=t&&t.isChild?o+"/"+i:i).indexOf("/")&&(a=a.substring(1)),s={message:"\u5220\u9664\u6587\u4ef6: "+i},r=e.serverUrl+"/api/v1/repos/"+e.username+"/"+e.reponame+"/wiki/page/"+encodeURIComponent(a)+"?access_token="+e.token,$.ajax({url:r,method:"DELETE",data:JSON.stringify(s),contentTypex:"application/x-www-form-urlencoded; charset=UTF-8",contentTypey:!1,contentType:"application/json;charset=utf-8",success:function(e,t,r){return n()},error:function(e){return n(e)}})}),viewOrign:function(e){return function(t,n){var r,i,o,a;return null,o=t.parentPath||"",i=t.guid,r=o?o+"/"+i:i,a=e.serverUrl+"/"+e.username+"/"+e.reponame+"/wiki/"+encodeURIComponent(r),"client"===STORY_PLATFORM?require("nw.gui").Shell.openExternal(a):window.open(a,"_blank")}}(this)}};var e},e.prototype.getAccountInfo=function(e){var t;return t={access_token:this.token},$.ajax({url:this.serverUrl+"/api/v1/user",data:t,method:"GET",success:function(t,n,r){var i;try{i=JSON.parse(t)}catch(e){i=t}return e(null,i)},error:function(t){return e(t)},dataType:"json"})},e.prototype.getFileMeta=function(e,t,n){var r,i,o,a,s;return o=t.guid,i=(a=t.parentPath||"")?a+"/"+o:o,this,this.token,s={access_token:this.token},r=this.serverUrl+"/api/v1/repos/"+this.username+"/"+this.reponame+"/wiki/page/",$.ajax({url:r+encodeURIComponent(i),data:s,method:"GET",success:function(e,t,r){var i;try{i=JSON.parse(e)}catch(t){t,i=e}return n(null,{guid:i.title,parentPath:a,name:l.generateMarkdownTitle(i.title)})},error:function(e){return n(e)}})},e.prototype.getFile=function(e,t,n){var r,i,o,a,s;return o=t.guid,i=(a=t.parentPath||"")?a+"/"+o:o,this,this.token,s={access_token:this.token},r=this.serverUrl+"/api/v1/repos/"+this.username+"/"+this.reponame+"/wiki/page/",$.ajax({url:r+encodeURIComponent(i),data:s,method:"GET",success:function(e,t,r){var i,o,s;try{i=JSON.parse(e)}catch(t){t,i=e}return o=decodeURIComponent(escape(window.atob(i.content_base64))),s=[],n(null,{guid:i.title,parentPath:a,markdownContent:o,htmlContent:o,resources:s,name:l.generateMarkdownTitle(i.title)})},error:function(e){return n(e)}})},e.prototype.listFiles=function(e,t,n){var r;return t.parentPath||"",r={access_token:this.token},$.ajax({url:this.serverUrl+"/api/v1/repos/"+this.username+"/"+this.reponame+"/wiki/pages",data:r,method:"GET",success:function(e,r,i){var o,a,s,l,u,c,p,d;try{o=JSON.parse(e)}catch(t){t,o=e}for(p=[],a=0,l=o.length;a<l;a++)u={guid:(s=o[a]).title,parentPath:t.parentPath,name:s.title,isChild:!0,createDate:Date.now(),updateDate:Date.now(),fileType:"text",tagNames:[]},c={key:s.title.replace(/\//g,"_"),folder:!1,title:s.title,lazy:!1,obj:u},p.push(c);return d=_.sortBy(p,(function(e){return(e.folder?"A":"B")+e.title})),n(null,d)},error:function(e){return n(e)}})},e.prototype.saveFile=function(e,t,n,i){var s,c,p,d,f,h,m;return h=this,d=t.get("pluginName"),c=t.get("guid"),p=t.get("parentPath"),this.repo,d!==this.name&&(c="",d="",p=""),f=n.saveAs,m=this,s=function(e,n,a){var s,c,p,d,f,v;return o.showHandling("\u4fdd\u5b58\u4e2d..."),v=setTimeout((function(){return o.hideHandling()}),r.getNetworkResourceTimeout),0===(d=e?e+"/"+n:n).indexOf("/")&&(d=d.substring(1)),t.get("content"),c=a?"\u521b\u5efa\u6587\u4ef6:"+d:"\u4fee\u6539\u6587\u4ef6:"+d,f={access_token:m.token,message:c,title:n},p=m.serverUrl+"/api/v1/repos/"+m.username+"/"+m.reponame+"/wiki/page/"+encodeURIComponent(n),s=new Blob([t.get("content")||""],{type:"text/plain"}),l.blob2Base64(s,(function(t,r){return t?i(t):(f.content_base64=r,u(p,m.token,(function(t){var r;return r=t?"PATCH":"POST",t||(p=h.serverUrl+"/api/v1/repos/"+h.username+"/"+h.reponame+"/wiki/new"),$.ajax({url:p,method:r,contentType:"application/x-www-form-urlencoded; charset=UTF-8",data:f,dataType:"json",success:function(t,r,a){var s;return clearTimeout(v),v=null,o.hideHandling(),s={guid:n,parentPath:e,name:n,tagNames:[],createDate:Date.now(),updateDate:Date.now(),isChild:!0},i(null,s,h)},error:function(e){return o.hideHandling(),i(e)}})})))}))},!c||f?new a({plugin:this,saveAs:f,saveAsCallback:i,fileModel:t}).show((function(e,t){return s(e,t,!0)})):s(p,c,!1)},e}(),n.exports=i}}),window.requirejs.define({"plugins/giteeimg/index":function(e,t,n){var r,i,o,a;i=t("../../lib/notifier"),o=t("../../lib/utils"),t("../../constant"),a=function(e){var t,n,r;return n="",-1!==(r=(t=new String(e).substring(e.lastIndexOf("/")+1)).lastIndexOf("."))&&(n=t.substring(r),t=t.substring(0,r)),{base:t,ext:n}},r=function(){function e(){}return e.prototype.name="giteeimg",e.prototype.kind="resource",e.prototype.displayName="\u7801\u4e91\u56fe\u5e8a",e.prototype.description="\u4f7f\u7528 GiteeImg \u505a\u4e3a\u56fe\u5e8a\u5b58\u50a8",e.prototype.icon="gitoschina",e.prototype.logo="img/gitoschina.png",e.prototype.production=!0,e.prototype.storePluginModel=null,e.prototype.init=function(e){var t,n;if(e){if(n=e.get("extraInfo"),this.postBaseData={pluginName:this.name,entryToken:e.get("entryToken"),entryTokenSecret:e.get("entryTokenSecret"),extraInfo:n},"string"==typeof n)try{n=JSON.parse(n)}catch(e){t=e,console.log(t)}return this.extraInfo=n,this.branchname=this.extraInfo.branchname,this.fileName=this.extraInfo.fileName||"{{filename}}",this.urlPrefix=this.extraInfo.urlPrefix,this.reponame=this.extraInfo.reponame,this.username=this.extraInfo.username,this.storePluginModel=e}},e.prototype.authenticate=function(e){var t,n,r,a;return r={},"",t=$('<div class="ui small modal story_modal">\n  <div class="header">\u8bf7\u8f93\u5165\u6709\u6548\u7684\u4ed3\u5e93\uff0c\u53ca\u5bf9\u5e94\u7684\u5206\u652f</div>\n  <div class="content story_content">\n    <div class="ui form">\n      <div class="field">\n        <label>\u8bf7\u8f93\u5165\u4e00\u4e2a\u6709\u6548\u7684token\u503c</label>\n        <div class="ui fluid icon input">\n          <input type="text" name="token" placeholder="" value="">\n          <i class="linkify icon"></i>\n        </div>\n      </div>\n      <div class="field">\n        <label>\u4ed3\u5e93\u540d\u79f0</label>\n        <div class="ui fluid icon input">\n          <input type="text" name="repo" placeholder="markdownxiaoshujiang" value="">\n          <i class="linkify icon"></i>\n        </div>\n        <div class="ui message info icon"><i class="info circle icon"></i><div class="content">\u6bd4\u5982 http://gitee.com/suziwen/<strong>markdownxiaoshujiang</strong>,<br> \u53ea\u9700\u8981\u8f93\u5165 <strong>markdownxiaoshujiang</strong> \u5c31\u53ef\u4ee5\u4e86</div></div>\n      </div>\n      <div class="field">\n        <label>\u5bf9\u5e94\u7684\u5206\u652f</label>\n        <div class="ui fluid icon input">\n          <input type="text" name="branch" placeholder="" value="master">\n          <i class="linkify icon"></i>\n        </div>\n      </div>\n\n      <div class="field">\n        <label for="fileName">\u6587\u4ef6\u540d\u79f0\u751f\u6210\u89c4\u5219</label>\n        <div class="ui fluid input">\n          <input type="text" name="fileName" placeholder="/folder/{{year}}/{{month}}/{{date}}/{{filename}}" value="/\u5c0f\u4e66\u5320/{{filename}}">\n        </div>\n        <div class="ui pointing label">\u652f\u6301\u53d8\u91cf year, month, date, title, filename, basename, extname, md5</div>\n      </div>\n      <div class="field">\n        <label>\u8bf7\u8f93\u5165\u4e00\u4e2aurl\u524d\u7f00</label>\n        <div class="ui fluid input">\n          <input type="text" name="urlPrefix" placeholder="http://xxxx.xxx/" value="">\n        </div>\n      </div>\n      <div class="ui message">\n      url \u524d\u7f00\u4e3a\u7a7a\u65f6\uff0c\u7cfb\u7edf\u9ed8\u8ba4\u4f7f\u7528 https://gitee.com/{username}/{reponame}/raw/{branch}/\n      \u5176\u4e2d: username \u4e3a\u5f53\u524d token \u7684\u7528\u6237\u540d, reponame \u4e3a\u8f93\u5165\u7684\u4ed3\u5e93\u540d\u79f0\uff0c branch \u4e3a\u5bf9\u5e94\u7684\u5206\u652f\n      </div>\n\n    </div>\n  </div>\n  <div class="actions">\n    <div class="tips">\n        <div>\u6ce8\uff1a</div>\n        <div>1.\u7533\u8bf7token\u5730\u5740\uff1a<a href="https://gitee.com/profile/personal_access_tokens/new" target="_blank">token</a>\n          <br>\n          2. \u9700\u8981\u7684\u6743\u9650\u4e3a\uff1auser_info, projects\n          <br>\n          3. \u4ed3\u5e93\u5fc5\u987b\u521d\u59cb\u5316\uff08\u4e5f\u5c31\u662f\u5fc5\u987b\u6709\u4e00\u4e2a\u6587\u4ef6,\u6bd4\u5982readme.md\uff09\n        </div>\n    </div>\n    <div class="ui basic cancel button">\n      \u53d6\u6d88\n    </div>\n    <div class="ui basic positive button">\n      \u786e\u5b9a  \n    </div>\n  </div>\n</div>'),(n=t.find(".ui.form")).form({fields:{token:{identifier:"token",rules:[{type:"empty",prompt:"\u8bf7\u8f93\u5165\u4e00\u4e2a\u6709\u6548\u7684token"}]},repo:{identifier:"repo",rules:[{type:"empty",prompt:"\u8bf7\u8f93\u5165\u4e00\u4e2a\u6709\u6548\u7684\u4ed3\u5e93\u540d\u79f0"}]},branch:{identifier:"branch",rules:[{type:"empty",prompt:"\u8bf7\u8f93\u5165\u4e00\u4e2a\u6709\u6548\u7684\u5206\u652f"}]}},onSuccess:(a=this,function(){var n,s,l,u,c,p;return(c=a).dimmer.dimmer("show"),n=t.find("input[name=token]").val().trim(),u=t.find("input[name=repo]").val().trim(),s=t.find("input[name=branch]").val().trim(),l=t.find("input[name=fileName]").val().trim(),p=t.find("input[name=urlPrefix]").val().trim(),r.branchname=s,r.reponame=u,r.fileName=l||"{{filename}}",r.urlPrefix=p,a.fileName=r.fileName,a.urlPrefix=r.urlPrefix,a.postBaseData={pluginName:a.name,entryToken:n,entryTokenSecret:"",extraInfo:JSON.stringify(r)},c.getAccountInfo((function(a,s){var l,u;return a?(i.showMessage("\u68c0\u6d4b\u5931\u8d25\uff0c\u68c0\u6d4b\u7528\u6237\u540d\u5931\u8d25",6e3,"error"),c.dimmer.dimmer("hide"),t=null):(u=s.username,r.username=u,c.postBaseData.extraInfo=JSON.stringify(r),c.extraInfo=r,c.username=u,c.branchname=r.branchname,c.reponame=r.reponame,l=o.dataURL2Blob("data:image/png;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"),c.saveFile(c.extraInfo,"/\u5c0f\u4e66\u5320\u9a8c\u8bc1\u6587\u4ef6.png",l,{},(function(o,a,s,l){return o?(i.showMessage("\u68c0\u6d4b\u5931\u8d25\uff0c\u6ca1\u6709\u627e\u5230\u76f8\u5e94\u7684\u4ed3\u5e93\u6216\u8005\u5206\u652f",6e3,"error"),c.dimmer.dimmer("hide"),c=null,t=null):(e(null,n,"",r,c),c.dimmer.dimmer("hide"),t.modal("hide"),c=null)})))}))})}),this.dimmer=t.find(".content").dimmer({closable:!1}),t.find(".dimmer").html('<div class="ui indeterminate text loader">\u6821\u9a8c\u4e2d...</div>'),t.modal({closable:!1,allowMultiple:!0,onHidden:function(){return t.remove(),t=null},onApprove:function(){return n.form("validate form"),!1}}).modal("show")},e.prototype.signOut=function(e){return e()},e.prototype.getAccountInfo=function(e){var t,n;return t=$.extend({},this.postBaseData,{pluginName:"gitoschina",operateType:"getAccountInfo"}),$.ajax({url:"/plugin",data:t,method:"GET",success:(n=this,function(t,r,i){var o,a,s;try{o=JSON.parse(t)}catch(e){a=e,o=t}if(o.error)return e(o);try{(s=JSON.parse(n.postBaseData.extraInfo)).shardId=o.shardId,n.postBaseData.extraInfo=JSON.stringify(s)}catch(e){a=e,console.log(a),(s={}).shardId=o.shardId,n.postBaseData.extraInfo=JSON.stringify(s)}return e(null,o)}),error:function(t){return e(t)},dataType:"json"})},e.prototype._saveAttach=function(e,t,n,r){var i,o,a,s;return null==n&&(n={}),a=e.lastIndexOf("/"),o=e.substring(0,a),i=e.substring(a+1),s=$.extend({},this.postBaseData,{pluginName:"gitoschina",operateType:"saveFile",parentPath:o,guid:i,fileData:t,fileModel:"function"==typeof n.toJSONWithSkipAttachmentData?n.toJSONWithSkipAttachmentData():void 0}),$.ajax({type:"post",url:"/plugin",method:"POST",data:s,dataType:"json",success:function(e,t,n){return r(null,{},this)},error:function(e){return r(e)}})},e.prototype.saveFile=function(e,t,n,r,i){return null==t&&(t=""),null==r&&(r={}),o.blobToArrayBuffer(n,(a=this,function(o,s){var l,u;return s&&((u=new SparkMD5.ArrayBuffer).append(s),l=u.end(),r.fileDataArrayBuffer=s,r.md5=l),a._saveFile(e,t,n,r,i)}));var a},e.prototype._saveFile=function(e,t,n,r,i){var s,l,u,c,p,d,f,h,m,v;if(null==t&&(t=""),null==r&&(r={}),h=this.parentPath||"",d=this.fileName,u=r.fileModel,l=r.md5,m="\u5c0f\u4e66\u5320",u&&(m=u.get("title")||m),m=m.replace(/[\/\s]/g,"_"),d&&!t.startsWith("/")){p=_.template(d,{interpolate:/\{\{(.+?)\}\}/g}),c=a(t);try{t=p({filename:t,basename:c.base,extname:c.ext,md5:l,year:(new Date).getFullYear().toString(),month:((new Date).getMonth()+1).toString(),date:(new Date).getDate().toString(),title:m})}catch(e){return s=e,console.error(s),void i(s)}}if(t=(t=t.replace(/^\/*/,"")).replace(/\s/g,"_"),f=(f=h+"/"+t).replace(/^\/*/,""),$.trim(f))return o.blob2Base64(n,(v=this,function(e,n){return v._saveAttach(f,n,u,(function(e,n,r){var o;return e?i(e):((o=v.urlPrefix||"https://gitee.com/"+v.extraInfo.username+"/"+v.extraInfo.reponame+"/raw/"+v.extraInfo.branchname+"/").endsWith("/")||(o+="/"),i(null,t,o+t,{}))}))}))},e}(),n.exports=r}}),window.requirejs.define({"plugins/github/index":function(e,t,n){var r,i,o,a,s,l,u,c={}.hasOwnProperty,p=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};o=t("../../lib/notifier"),l=t("../../lib/utils"),r=t("../../constant"),s=t("../../views/save_new_dialog_view"),a=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)c.call(t,n)&&(e[n]=t[n]);function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype}(t,e),t.prototype.validateFilename=function(e){return!e.endsWith("/")&&(!!e.replace(/^\/*/g,"")&&/^[^:*?"<>|\r\n]*$/g.test(e))},t.prototype.onSelectObj=function(e,t){var n,r,i,o,a,s;return a=(o=this.currentObj).parentPath||"",o.isChild||("-1"===(n=o.guid)&&(n=""),0===(a=a+"/"+n).indexOf("/")&&(a=a.substring(1))),(s=(n=e).lastIndexOf("/"))>=0&&(r=n.substring(s+1),i=(i=n.substring(0,s)).replace(/^\/*/g,""),a?(a=a+"/"+i,n=r):(a=i,n=r)),t(a,n)},t}(s),u=function(e){var t,n;null==e&&(e={});try{n=JSON.stringify(e)}catch(e){t=e,console.log(t)}switch(e.error){case 0:return o.showMessage("\u7f51\u7edc\u8bf7\u6c42\u51fa\u9519, \u7f51\u7edc\u65e0\u6cd5\u8bbf\u95ee: "+n,6e3,"error");case 409:return o.showMessage("\u8bf7\u6c42\u51fa\u9519, \u8bf7\u5148\u521d\u59cb\u5316\u4ed3\u5e93(\u6bd4\u5982\u624b\u52a8\u4e0a\u4f20\u4e00\u4e2a\u6587\u4ef6): "+n,6e3,"error");default:return o.showMessage(n,6e3,"error")}},i=function(){function e(){}return e.prototype.name="github",e.prototype.kind="store",e.prototype.displayName="github",e.prototype.description="\u4f7f\u7528github\u505a\u4e3a\u5b58\u50a8",e.prototype.icon="github",e.prototype.logo="img/github.jpg",e.prototype.production=!0,e.prototype.storePluginModel=null,e.prototype.init=function(e){var t,n;if(e){if("string"==typeof(n=e.get("extraInfo")))try{n=JSON.parse(n)}catch(e){t=e,console.log(t)}return this.extraInfo=n,this.branch=this.extraInfo.branchname,this.github=new Github({token:e.get("entryToken"),auth:"oauth"}),this.repo=this.github.getRepo(this.extraInfo.username,this.extraInfo.reponame),this.storePluginModel=e}},e.prototype.getDisplayName=function(){var e;return this.storePluginModel&&(e=this.storePluginModel.get("displayName")),e||this.displayName},e.prototype.authenticate=function(e){var t,n,r;return t=$('<div class="ui small modal story_modal">\n  <div class="header">\u8bf7\u8f93\u5165\u6709\u6548\u7684token,\u4ed3\u5e93\uff0c\u53ca\u5bf9\u5e94\u7684\u5206\u652f</div>\n  <div class="content story_content">\n    <div class="ui form">\n      <div class="field">\n        <label>\u8bf7\u8f93\u5165\u4e00\u4e2a\u6709\u6548\u7684token\u503c</label>\n        <div class="ui fluid icon input">\n          <input type="text" name="token" placeholder="" value="">\n          <i class="linkify icon"></i>\n        </div>\n      </div>\n      <div class="field">\n        <label>\u4ed3\u5e93\u540d\u79f0</label>\n        <div class="ui fluid icon input">\n          <input type="text" name="repo" placeholder="" value="">\n          <i class="linkify icon"></i>\n        </div>\n        <div class="ui message info icon"><i class="info circle icon"></i><div class="content">\u6bd4\u5982 http://github.com/suziwen/<strong>markdownxiaoshujiang</strong>,<br> \u53ea\u9700\u8981\u8f93\u5165 <strong>markdownxiaoshujiang</strong> \u5c31\u53ef\u4ee5\u4e86</div></div>\n      </div>\n      <div class="field">\n        <label>\u5bf9\u5e94\u7684\u5206\u652f</label>\n        <div class="ui fluid icon input">\n          <input type="text" name="branch" placeholder="" value="main">\n          <i class="linkify icon"></i>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class="actions">\n    <div class="tips">\n    <div>\u6ce8\uff1a</div>\n    <div>1.\u7533\u8bf7token\u5730\u5740\uff1a<a href="https://github.com/settings/tokens/new" target="_blank">token</a>\n      <br>\n      2. \u9700\u8981\u7684\u6743\u9650\u4e3a\uff1arepo\n      <br>\n      3. \u4ed3\u5e93\u5fc5\u987b\u521d\u59cb\u5316\n    </div>\n    </div>\n    <div class="ui cancel button">\n      \u53d6\u6d88\n    </div>\n    <div class="ui positive button">\n      \u786e\u5b9a  \n    </div>\n  </div>\n</div>'),(n=t.find(".ui.form")).form({fields:{token:{identifier:"token",rules:[{type:"empty",prompt:"\u8bf7\u8f93\u5165\u4e00\u4e2a\u6709\u6548\u7684token"}]},repo:{identifier:"repo",rules:[{type:"empty",prompt:"\u8bf7\u8f93\u5165\u4e00\u4e2a\u6709\u6548\u7684\u4ed3\u5e93\u540d\u79f0"}]},branch:{identifier:"branch",rules:[{type:"empty",prompt:"\u8bf7\u8f93\u5165\u4e00\u4e2a\u6709\u6548\u7684\u5206\u652f"}]}},onSuccess:(r=this,function(){var n,i,a,s;return r.dimmer.dimmer("show"),s=t.find("input[name=token]").val().trim(),a=t.find("input[name=repo]").val().trim(),n=t.find("input[name=branch]").val().trim(),(i=new Github({token:s})).getUser().repos((function(l,c){var d,f,h,m;return l?(u(l),r.dimmer.dimmer("hide")):(d=_.findWhere(c,{name:a}))?(h=d.owner.login,m=d.owner.avatar_url,(f=i.getRepo(h,a)).listBranches((function(i,l){return i?(u(i),r.dimmer.dimmer("hide")):p.call(l,n)>=0?(r.repo=f,r.branch=n,r.extraInfo={username:h,avatar:m,reponame:a,branchname:n},e(null,s,null,r.extraInfo),r.dimmer.dimmer("hide"),t.modal("hide")):(o.showMessage("\u5728\u4ed3\u5e93"+a+"\u4e0b\uff0c\u627e\u4e0d\u5230\u6307\u5b9a\u7684\u5206\u652f"+n,6e3,"error"),r.dimmer.dimmer("hide"))}))):(o.showMessage("\u68c0\u6d4b\u5931\u8d25\uff0c\u4f7f\u7528\u7684token\u6ca1\u6709\u627e\u5230\u76f8\u5e94\u7684\u4ed3\u5e93",6e3,"error"),r.dimmer.dimmer("hide"))}))})}),this.dimmer=t.find(".content").dimmer({closable:!1}),t.find(".dimmer").html('<div class="ui indeterminate text loader">\u6821\u9a8c\u4e2d...</div>'),t.modal({closable:!1,allowMultiple:!0,onHidden:function(){return n.form("destroy"),t.modal("destroy"),t.remove()},onApprove:function(){return n.form("validate form"),!1}}).modal("show")},e.prototype.setting=function(){var e,t,n,r,i,o,a;if(a=this.storePluginModel)return n=this.extraInfo,o=(i=!!n.manualCommitMessage)?'checked="checked"':"",t=a.get("displayName"),r=this.icon?"<i class='large icon "+this.icon+"'></i>":"",(e=$('<div class="ui small modal">\n  <div class="header">'+r+t+' \u914d\u7f6e</div>\n  <div class="content">\n    <div class="inline field">\n      <label for="manualCommitMessage" >\u6bcf\u6b21\u63d0\u4ea4\u6587\u7ae0\u65f6\uff0c\u624b\u52a8\u8f93\u5165\u63d0\u4ea4\u6d88\u606f</label>\n      <input type="checkbox" name="manualCommitMessage" '+o+'>\n    </div>\n\n  </div>\n  <div class="actions">\n    <div class="ui basic cancel right button">\n      \u53d6\u6d88\n    </div>\n    <div class="ui basic positive right button">\n      \u786e\u5b9a\n    </div>\n  </div>\n</div>')).modal({allowMultiple:!0,closable:!1,onApprove:function(){var t;return i=e.find("input[name=manualCommitMessage]").is(":checked"),n.manualCommitMessage=i,t=JSON.stringify(n),a.set("extraInfo",t),a.save()},onHidden:function(){return e.modal("destroy"),e.remove(),e=null}}),e.modal("show")},e.prototype.signOut=function(e){return e()},e.prototype.getContextMenu=function(){return{menu:function(e,t){return e.isChild?{refreshFile:{name:"\u66f4\u65b0\u672c\u5730\u7f13\u5b58\u6587\u4ef6"},viewOrign:{name:"\u5728github\u4e2d\u6253\u5f00"},deleteFile:{name:"\u5220\u9664\u6587\u4ef6"}}:{}},actions:{deleteFile:(e=this,function(t,n){var r,i,o;return r=t.guid,i=t&&t.parentPath||"",0===(o=t&&t.isChild?i+"/"+r:r).indexOf("/")&&(o=o.substring(1)),e.repo.remove(e.branch,o,(function(e){return e?n(e):n()}))}),viewOrign:function(e){return function(t,n){var r,i,o,a,s;return r=e.extraInfo,a=t.parentPath||"",o=t.guid,i=a?a+"/"+o:o,r&&(s="https://www.github.com/"+r.username+"/"+r.reponame+"/blob/"+r.branchname+"/"+i),"client"===STORY_PLATFORM?require("nw.gui").Shell.openExternal(s):window.open(s,"_blank")}}(this)}};var e},e.prototype.getAccountInfo=function(e){return e(null,{username:this.extraInfo.username,displayName:this.extraInfo.username,email:"",avatar:this.extraInfo.avatar})},e.prototype.hasFile=function(e,t,n,r){var i,o,a,s,l,u;return s=n.hasFilesCached,u=e.lastIndexOf("/"),l=e.substring(0,u),a=e.substring(u+1),i=function(e,t){var n,r;for(n=0,r=t.length;n<r;n++)if(t[n].title===e)return!0},(o=s[l])?r(null,i(a,o)):this.listFiles(t,{parentPath:l},(function(e,t){return null==t&&(t=[]),s[l]=t,r(null,i(a,t))}))},e.prototype.getFileMeta=function(e,t,n){var r,i,o;return i=t.guid,r=(o=t.parentPath||"")?o+"/"+i:i,this,this.repo.read(this.branch,r,(function(e,r){var o;return e?n(e):(o={guid:i,parentPath:t.parentPath,name:l.generateMarkdownTitle(i)},n(null,o))}))},e.prototype.getFile=function(e,t,n){var r,i,a,s;return i=t.guid,r=(a=t.parentPath||"")?a+"/"+i:i,s=this,this.repo.read(this.branch,r,(function(e,r){var u;return e?n(e):(u=[],l.getResourceData(i,r,(function(e,c){return e?(o.showMessage("\u5904\u7406\u9644\u4ef6\u51fa\u9519,\u9519\u8bef\u539f\u56e0\uff1a"+e),n(e)):(c=c.filter((function(e){return!/^http[s]?:\/\//i.test(e)})),async.mapLimit(c,20,(function(e,t){var n;return 0===(n=0===e.indexOf("/")?e:a?a+"/"+e:e).indexOf("/")&&(n=n.substring(1)),s.repo.readBinary(s.branch,n,(function(n,r){return n?o.showMessage("\u5904\u7406\u9644\u4ef6\u51fa\u9519:"+e+",\u9519\u8bef\u539f\u56e0\uff1a"+n):u.push({name:e,type:l.mimeLookup(e),blob:r}),t()}))}),(function(e){var a;return e?o.showMessage("\u52a0\u8f7d\u9644\u4ef6\u51fa\u9519"+e):(a={guid:i,parentPath:t.parentPath,markdownContent:r,resources:u,htmlContent:r,tagNames:[],name:l.generateMarkdownTitle(i)},n(null,a))})))})))}))},e.prototype.searchFiles=function(e,t,n){var r,i,a;return a=t.query,r=t.offset||0,i=t.pageSize||30,this,this.repo.search(a,parseInt(r/i),i,"","",(function(e,t){var a,s;if(e){try{e=JSON.stringify(e)}catch(t){e=t,console.log(e)}return o.showMessage("\u52a0\u8f7d\u6587\u4ef6\u5217\u8868\u51fa\u73b0\u9519\u8bef"+e,3e3,"error"),n(e)}return s=[],null!=(a=t.items)&&a.forEach((function(e){var t,n,r,i;return r=e.path,{name:t=e.name,parentPath:n=(n=r.substring(0,r.lastIndexOf(t))).replace(/^\/+|\/+$/g,""),childCount:0,isChild:!0,guid:t,createDate:Date.now(),updateDate:Date.now(),tagNames:[]},i={key:r.replace(/\//g,"_"),title:t,tagNames:[],createDate:Date.now(),updateDate:Date.now(),parentPath:n,guid:t,orign:e},s.push(i)})),n(null,{offset:r,pageSize:i,total:t.total_count,files:s})}))},e.prototype.listFiles=function(e,t,n){var r;return r=t.parentPath||"",this.repo.contents(this.branch,r,(function(e,r){var i,o,a,s,u,c,p,d;if(e)return n(e);for(p=[],a=0,s=r.length;a<s;a++)i=r[a],o=l.checkIsSupportFileType(i.name)?"text":"application",u={guid:i.name,parentPath:t.parentPath,name:i.name,isChild:"file"===i.type,createDate:Date.now(),updateDate:Date.now(),fileType:o,tagNames:[]},c={key:i.path.replace(/\//g,"_"),folder:"dir"===i.type,title:i.name,lazy:"dir"===i.type,obj:u},p.push(c);return d=_.sortBy(p,(function(e){return(e.folder?"A":"B")+e.title})),n(null,d)}))},e.prototype.saveAttach=function(e,t,n,r,i,o,a){var s,u,c,p,d;return p=t.get("pluginName"),u=t.get("guid"),c=t.get("parentPath"),u?p!==this.name?"function"==typeof a?a():void 0:(0===n.indexOf("./")&&(n=n.substring(2)),0===(s=0===n.indexOf("/")?n:c?c+"/"+n:n).indexOf("/")&&(s=s.substring(1)),$.trim(s)?l.blob2Base64(r,(d=this,function(e,t){return d.repo.writeBase64(d.branch,s,t,"\u6dfb\u52a0\u9644\u4ef6 : "+s,(function(e){return e?a(e):a(null,{},d)}))})):"function"==typeof a?a(null,{},this):void 0):"function"==typeof a?a():void 0},e.prototype.inputCommitMessageBeforeSave=function(e,t){var n;return this.extraInfo.manualCommitMessage?((n=$('<div class="ui small modal">\n  <div class="header">\u63d0\u4ea4\u6d88\u606f</div>\n  <div class="content">\n    <div class="ui form">\n      <div class="inline field">\n        <textarea name="commitMessage"/>\n      </div>\n    </div>\n  </div>\n  <div class="actions">\n    <div class="ui basic cancel right button">\n      \u53d6\u6d88\n    </div>\n    <div class="ui basic positive right button">\n      \u786e\u5b9a\n    </div>\n  </div>\n</div>')).modal({onVisible:function(){return n.find("textarea[name=commitMessage]").on("keydown",(function(e){if(e.ctrlKey&&13===e.keyCode)return n.find(".ui.positive.button").trigger("click")}))},onApprove:function(){var e;return e=n.find("textarea[name=commitMessage]").val(),t(e)},onHidden:function(){return n.modal("destroy"),n.remove(),n=null}}),n.modal("show")):t("")},e.prototype.saveFile=function(e,t,n,i){var s,u,c,p,d,f,h,m,v,g,y;return d=t.get("pluginName"),c=t.get("guid"),p=t.get("parentPath"),g=t.get("title")||"\u672a\u547d\u540d\u6587\u4ef6.md",f=this.repo,u=this.branch,v=this,d!==this.name&&(c="",d="",p=""),h=n.saveAs,m=n.saveAttachment,y=this,s=function(e,n,a,s){var c,p,d;return o.showHandling("\u4fdd\u5b58\u4e2d..."),d=setTimeout((function(){return o.hideHandling()}),r.getNetworkResourceTimeout),g.lastIndexOf(".")<0&&(g+=".md"),0===(p=e?e+"/"+n:n).indexOf("/")&&(p=p.substring(1)),c=t.get("content")||"",y.repo.write(y.branch,p,unescape(encodeURIComponent(c)),s||"\u4fee\u6539\u6587\u4ef6: "+p,(function(r){var s;return clearTimeout(d),d=null,r?(o.hideHandling(),i(r)):(s={guid:n,parentPath:e,name:n,tagNames:[],createDate:Date.now(),updateDate:Date.now(),isChild:!0},l.getResourceData("default.md",c,(function(n,r){var c;return n?(o.showMessage("\u4fdd\u5b58\u9644\u4ef6\u5931\u8d25",6e3,"error"),o.hideHandling(),i(null,s)):(c={},r=r.filter((function(e){return!/^http[s]?:\/\//i.test(e)})),async.eachSeries(r,(function(n,r){var i,s;0===(p=0===(i=n).indexOf("/")?i:e?e+"/"+i:i).indexOf("/")&&(p=p.substring(1));try{n=decodeURI(n)}catch(e){s=e,console.log(s)}return v.hasFile(p,{},{hasFilesCached:c},(function(e,i){return!i||a||m?t.getAttachObjectByFilename(n,(function(e,t){var i;return(i=null!=t?t.objectUrl:void 0)?l.objectURLToArrayBuffer(i,(function(e,t){var i;return e?(o.showMessage("\u4fdd\u5b58\u9644\u4ef6\u5931\u8d25: "+n+", "+e,6e3,"error"),r()):(i=l.arrayBufferToBase64(t),f.writeBase64(u,p,i,"add attach file",(function(e){return e?(o.showMessage("\u4fdd\u5b58\u9644\u4ef6\u5931\u8d25: "+n+", "+e,6e3,"error"),r()):r()})))})):r()})):r()}))}),(function(e){return clearTimeout(d),d=null,o.hideHandling(),i(null,s,y)})))})))}))},!c||h?new a({plugin:this,saveAs:h,saveAsCallback:i,fileModel:t}).show((function(e,t){return setTimeout((function(){return v.inputCommitMessageBeforeSave(null,(function(n){return s(e,t,!0,n)}))}),100)})):this.inputCommitMessageBeforeSave(null,(function(e){return s(p,c,!1,e)}))},e}(),n.exports=i}}),window.requirejs.define({"plugins/githubimg/index":function(e,t,n){var r,i,o,a,s=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};i=t("../../lib/notifier"),o=t("../../lib/utils"),t("../../constant"),a=function(e){var t,n,r;return n="",-1!==(r=(t=new String(e).substring(e.lastIndexOf("/")+1)).lastIndexOf("."))&&(n=t.substring(r),t=t.substring(0,r)),{base:t,ext:n}},r=function(){function e(){}return e.prototype.name="githubimg",e.prototype.kind="resource",e.prototype.displayName="githubimg",e.prototype.description="\u4f7f\u7528github\u505a\u4e3a\u56fe\u5e8a\u5b58\u50a8",e.prototype.icon="github",e.prototype.logo="img/github.jpg",e.prototype.production=!0,e.prototype.storePluginModel=null,e.prototype.init=function(e){var t,n;if(e){if("string"==typeof(n=e.get("extraInfo")))try{n=JSON.parse(n)}catch(e){t=e,console.log(t)}return this.extraInfo=n,this.branch=this.extraInfo.branchname,this.fileName=this.extraInfo.fileName||"{{filename}}",this.urlPrefix=this.extraInfo.urlPrefix,this.github=new Github({token:e.get("entryToken"),auth:"oauth"}),this.repo=this.github.getRepo(this.extraInfo.username,this.extraInfo.reponame),this.storePluginModel=e}},e.prototype.authenticate=function(e){var t,n,r;return t=$('<div class="ui story_modal small modal">\n  <div class="header">\u8bf7\u8f93\u5165\u6709\u6548\u7684token,\u4ed3\u5e93\uff0c\u53ca\u5bf9\u5e94\u7684\u5206\u652f</div>\n  <div class="content story_content">\n    <div class="ui form">\n      <div class="field">\n        <label for="displayName">\u8bf7\u8f93\u5165\u4e00\u4e2a\u81ea\u5b9a\u4e49\u540d\u79f0</label>\n        <div class="ui fluid input">\n          <input type="text" name="displayName" placeholder="" value="github\u56fe\u5e8a">\n        </div>\n      </div>\n      <div class="field">\n        <label>\u8bf7\u8f93\u5165\u4e00\u4e2a\u6709\u6548\u7684token\u503c</label>\n        <div class="ui fluid input">\n          <input type="text" name="token" placeholder="" value="">\n        </div>\n      </div>\n      <div class="field">\n        <label>\u4ed3\u5e93\u540d\u79f0</label>\n        <div class="ui fluid input">\n          <input type="text" name="repo" placeholder="" value="">\n        </div>\n      </div>\n      <div class="field">\n        <label>\u5bf9\u5e94\u7684\u5206\u652f</label>\n        <div class="ui fluid input">\n          <input type="text" name="branch" placeholder="" value="master">\n        </div>\n      </div>\n      <div class="field">\n        <label for="fileName">\u6587\u4ef6\u540d\u79f0\u751f\u6210\u89c4\u5219</label>\n        <div class="ui fluid input">\n          <input type="text" name="fileName" placeholder="/folder/{{year}}/{{month}}/{{date}}/{{filename}}" value="/\u5c0f\u4e66\u5320/{{filename}}">\n        </div>\n        <div class="ui pointing label">\u652f\u6301\u53d8\u91cf year, month, date, title, filename, basename, extname, md5</div>\n      </div>\n      <div class="field">\n        <label>\u8bf7\u8f93\u5165\u4e00\u4e2aurl\u524d\u7f00</label>\n        <div class="ui fluid input">\n          <input type="text" name="urlPrefix" placeholder="http://xxxx.xxx/" value="">\n        </div>\n      </div>\n      <div class="ui message">\n      url \u524d\u7f00\u4e3a\u7a7a\u65f6\uff0c\u7cfb\u7edf\u9ed8\u8ba4\u4f7f\u7528 https://raw.githubusercontent.com/{username}/{reponame}/{branch}/ \n      \u5176\u4e2d: username \u4e3a\u5f53\u524d token \u7684\u7528\u6237\u540d, reponame \u4e3a\u8f93\u5165\u7684\u4ed3\u5e93\u540d\u79f0\uff0c branch \u4e3a\u5bf9\u5e94\u7684\u5206\u652f\n      </div>\n    </div>\n  </div>\n  <div class="actions">\n    <div class="tips">\n    <div>\u6ce8\uff1a</div>\n    <div>1.\u7533\u8bf7token\u5730\u5740\uff1a<a href="https://github.com/settings/tokens/new" target="_blank">token</a>\n      <br>\n      2. \u9700\u8981\u7684\u6743\u9650\u4e3a\uff1arepo, public_repo\n      <br>\n      3. \u4ed3\u5e93\u5fc5\u987b\u521d\u59cb\u5316\n    </div>\n    </div>\n    <div class="ui cancel button">\n      \u53d6\u6d88\n    </div>\n    <div class="ui positive button">\n      \u786e\u5b9a  \n    </div>\n  </div>\n</div>'),(n=t.find(".ui.form")).form({fields:{token:{identifier:"token",rules:[{type:"empty",prompt:"\u8bf7\u8f93\u5165\u4e00\u4e2a\u6709\u6548\u7684token"}]},repo:{identifier:"repo",rules:[{type:"empty",prompt:"\u8bf7\u8f93\u5165\u4e00\u4e2a\u6709\u6548\u7684\u4ed3\u5e93\u540d\u79f0"}]},branch:{identifier:"branch",rules:[{type:"empty",prompt:"\u8bf7\u8f93\u5165\u4e00\u4e2a\u6709\u6548\u7684\u5206\u652f"}]}},onSuccess:(r=this,function(){var n,o,a,l,u,c,p;return r.dimmer.dimmer("show"),o=t.find("input[name=displayName]").val().trim(),c=t.find("input[name=token]").val().trim(),u=t.find("input[name=repo]").val().trim(),n=t.find("input[name=branch]").val().trim(),a=t.find("input[name=fileName]").val().trim(),p=t.find("input[name=urlPrefix]").val().trim(),(l=new Github({token:c})).getUser().repos((function(d,f){var h,m,v,g;return d?(i.showMessage(d,6e3,"error"),r.dimmer.dimmer("hide")):(h=_.findWhere(f,{name:u}))?(v=h.owner.login,g=h.owner.avatar_url,(m=l.getRepo(v,u)).listBranches((function(l,d){var f;if(l){try{l=JSON.stringify(l)}catch(e){f=e,console.log(f)}return i.showMessage(l,6e3,"error"),r.dimmer.dimmer("hide")}return s.call(d,n)>=0?(r.repo=m,r.branch=n,r.fileName=a||"{{filename}}",r.urlPrefix=p,r.extraInfo={displayName:o,username:v,avatar:g,reponame:u,branchname:n,fileName:a||"{{filename}}",urlPrefix:p},e(null,c,null,r.extraInfo),r.dimmer.dimmer("hide"),t.modal("hide")):(i.showMessage("\u5728\u4ed3\u5e93"+u+"\u4e0b\uff0c\u627e\u4e0d\u5230\u6307\u5b9a\u7684\u5206\u652f"+n,6e3,"error"),r.dimmer.dimmer("hide"))}))):(i.showMessage("\u68c0\u6d4b\u5931\u8d25\uff0c\u4f7f\u7528\u7684token\u6ca1\u6709\u627e\u5230\u76f8\u5e94\u7684\u4ed3\u5e93",6e3,"error"),r.dimmer.dimmer("hide"))}))})}),this.dimmer=t.find(".content").dimmer({closable:!1}),t.find(".dimmer").html('<div class="ui indeterminate text loader">\u6821\u9a8c\u4e2d...</div>'),t.modal({closable:!1,allowMultiple:!0,onHidden:function(){return n.form("destroy"),t.modal("destroy"),t.remove()},onApprove:function(){return n.form("validate form"),!1}}).modal("show")},e.prototype.signOut=function(e){return e()},e.prototype.getAccountInfo=function(e){return e(null,{username:this.extraInfo.username,displayName:this.extraInfo.displayName||this.extraInfo.username,email:"",avatar:this.extraInfo.avatar,urlPrefix:this.extraInfo.urlPrefix})},e.prototype.saveFile=function(e,t,n,r,i){return null==t&&(t=""),null==r&&(r={}),o.blobToArrayBuffer(n,(a=this,function(o,s){var l,u;return s&&((u=new SparkMD5.ArrayBuffer).append(s),l=u.end(),r.fileDataArrayBuffer=s,r.md5=l),a._saveFile(e,t,n,r,i)}));var a},e.prototype._saveFile=function(e,t,n,r,i){var s,l,u,c,p,d,f,h,m,v;if(null==t&&(t=""),null==r&&(r={}),h=this.parentPath||"",d=this.fileName,u=r.fileModel,l=r.md5,m="\u5c0f\u4e66\u5320",u&&(m=u.get("title")||m),m=m.replace(/[\/\s]/g,"_"),d&&!t.startsWith("/")){p=_.template(d,{interpolate:/\{\{(.+?)\}\}/g}),c=a(t);try{t=p({filename:t,basename:c.base,extname:c.ext,md5:l,year:(new Date).getFullYear().toString(),month:((new Date).getMonth()+1).toString(),date:(new Date).getDate().toString(),title:m})}catch(e){return s=e,console.error(s),void i(s)}}if(t=(t=t.replace(/^\/*/,"")).replace(/\s/g,"_"),f=(f=h+"/"+t).replace(/^\/*/,""),$.trim(f))return o.blob2Base64(n,(v=this,function(e,n){return v.repo.writeBase64(v.branch,f,n,"\u6dfb\u52a0\u9644\u4ef6 : "+f,(function(e){var n;return e?i(e):((n=v.urlPrefix||"https://raw.githubusercontent.com/"+v.extraInfo.username+"/"+v.extraInfo.reponame+"/"+v.extraInfo.branchname+"/").endsWith("/")||(n+="/"),i(null,t,n+t,{}))}))}))},e}(),n.exports=r}}),window.requirejs.define({"plugins/gitlab/index":function(e,t,n){var r,i,o,a,s,l,u,c={}.hasOwnProperty;o=t("../../lib/notifier"),l=t("../../lib/utils"),r=t("../../constant"),s=t("../../views/save_new_dialog_view"),a=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)c.call(t,n)&&(e[n]=t[n]);function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype}(t,e),t.prototype.validateFilename=function(e){return!e.endsWith("/")&&(!!e.replace(/^\/*/g,"")&&/^[^:*?"<>|\r\n]*$/g.test(e))},t.prototype.onSelectObj=function(e,t){var n,r,i,o,a,s;return a=(o=this.currentObj).parentPath||"",o.isChild||("-1"===(n=o.guid)&&(n=""),0===(a=a+"/"+n).indexOf("/")&&(a=a.substring(1))),(s=(n=e).lastIndexOf("/"))>=0&&(r=n.substring(s+1),i=(i=n.substring(0,s)).replace(/^\/*/g,""),a?(a=a+"/"+i,n=r):(a=i,n=r)),t(a,n)},t}(s),u=function(e,t,n,r){var i;return i={ref:t,private_token:n},$.ajax({url:e,data:i,method:"GET",success:function(e,t,n){return r("PUT")},error:function(e){return r("POST")}})},i=function(){function e(){}return e.prototype.name="gitlab",e.prototype.kind="store",e.prototype.displayName="gitlab.com",e.prototype.description="\u4f7f\u7528 Gitlab \u505a\u4e3a\u5b58\u50a8",e.prototype.icon="gitlab",e.prototype.logo="img/gitlab.jpg",e.prototype.production=!0,e.prototype.storePluginModel=null,e.prototype.init=function(e){var t,n;if(e){if("string"==typeof(n=e.get("extraInfo")))try{n=JSON.parse(n)}catch(e){t=e,console.log(t)}return this.extraInfo=n,this.branchname=this.extraInfo.branchname,this.reponame=this.extraInfo.reponame,this.username=this.extraInfo.username,this.token=e.get("entryToken"),this.storePluginModel=e}},e.prototype.getDisplayName=function(){var e;return this.storePluginModel&&(e=this.storePluginModel.get("displayName")),e||this.displayName},e.prototype.authenticate=function(e){var t,n,r;return t=$('<div class="ui small modal story_modal">\n  <div class="header">\u8bf7\u8f93\u5165\u6709\u6548\u7684 token, \u4ed3\u5e93\uff0c\u53ca\u5bf9\u5e94\u7684\u5206\u652f</div>\n  <div class="content story_content">\n    <div class="ui form">\n      <div class="field">\n        <label for="token">token </label>\n        <div class="ui fluid icon input">\n          <input type="text" name="token" placeholder="" value="">\n          <i class="linkify icon"></i>\n        </div>\n      </div>\n      <div class="field">\n        <label for="repo">\u4ed3\u5e93\u540d\u79f0</label>\n        <div class="ui fluid icon input">\n          <input type="text" name="repo" placeholder="" value="">\n          <i class="linkify icon"></i>\n        </div>\n        <div class="ui message info icon"><i class="info circle icon"></i><div class="content">\u6bd4\u5982 http://gitlab.com/suziwen/<strong>markdownxiaoshujiang</strong>,<br> \u53ea\u9700\u8981\u8f93\u5165 <strong>markdownxiaoshujiang</strong> \u5c31\u53ef\u4ee5\u4e86</div></div>\n      </div>\n      <div class="field">\n        <label for="branch">\u5bf9\u5e94\u7684\u5206\u652f</label>\n        <div class="ui fluid icon input">\n          <input type="text" name="branch" placeholder="" value="master">\n          <i class="linkify icon"></i>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class="actions">\n    <div class="tips">\n    <div>\u6ce8:</div>\n    <div> 1. token \u7533\u8bf7\u5730\u5740 <a target="_blank" href="https://gitlab.com/profile/personal_access_tokens">token</a><br/>\n    2. \u9700\u8981\u7684\u6743\u9650\u4e3a: api, read_user\n    </div>\n    </div>\n    <div class="ui basic cancel button">\n      \u53d6\u6d88\n    </div>\n    <div class="ui basic positive button">\n      \u786e\u5b9a  \n    </div>\n  </div>\n</div>'),(n=t.find(".ui.form")).form({fields:{token:{identifier:"token",rules:[{type:"empty",prompt:"\u8bf7\u8f93\u5165\u4e00\u4e2a\u6709\u6548\u7684token\u540d\u79f0"}]},repo:{identifier:"repo",rules:[{type:"empty",prompt:"\u8bf7\u8f93\u5165\u4e00\u4e2a\u6709\u6548\u7684\u4ed3\u5e93\u540d\u79f0"}]},branch:{identifier:"branch",rules:[{type:"empty",prompt:"\u8bf7\u8f93\u5165\u4e00\u4e2a\u6709\u6548\u7684\u5206\u652f"}]}},onSuccess:(r=this,function(){var n,i,a,s;return(a=r).dimmer.dimmer("show"),s=t.find("input[name=token]").val().trim(),i=t.find("input[name=repo]").val().trim(),n=t.find("input[name=branch]").val().trim(),a.token=s,a.getAccountInfo((function(r,l){var u;return r?(o.showMessage("\u68c0\u6d4b\u5931\u8d25\uff0c\u68c0\u6d4b\u7528\u6237\u540d\u5931\u8d25",6e3,"error"),a.dimmer.dimmer("hide")):(u=l.username,a.username=u,a.branchname=n,a.reponame=i,a.listFiles({},{},(function(r,l){return r?(o.showMessage("\u68c0\u6d4b\u5931\u8d25\uff0c\u6ca1\u6709\u627e\u5230\u76f8\u5e94\u7684\u4ed3\u5e93\u6216\u8005\u5206\u652f",6e3,"error"),a.dimmer.dimmer("hide")):(e(null,s,null,{username:u,branchname:n,reponame:i},a),a.dimmer.dimmer("hide"),t.modal("hide"),a=null)})))}))})}),this.dimmer=t.find(".content").dimmer({closable:!1}),t.find(".dimmer").html('<div class="ui indeterminate text loader">\u6821\u9a8c\u4e2d...</div>'),t.modal({closable:!1,allowMultiple:!0,onHidden:function(){return n.form("destroy"),t.modal("destroy"),t.remove(),t=null},onApprove:function(){return n.form("validate form"),!1}}).modal("show")},e.prototype.signOut=function(e){return e()},e.prototype.getContextMenu=function(){return{menu:function(e,t){return e.isChild?{refreshFile:{name:"\u66f4\u65b0\u672c\u5730\u7f13\u5b58\u6587\u4ef6"},viewOrign:{name:"\u5728 gitlab \u4e2d\u6253\u5f00"},deleteFile:{name:"\u5220\u9664\u6587\u4ef6"}}:{}},actions:{deleteFile:(e=this,function(t,n){var r,i,o,a,s;return i=t.guid,o=t&&t.parentPath||"",0===(a=t&&t.isChild?o+"/"+i:i).indexOf("/")&&(a=a.substring(1)),s={private_token:e.token,utf8:decodeURI("%E2%9C%93"),branch:e.branchname,commit_message:"\u5220\u9664\u6587\u4ef6: "+i},r="https://gitlab.com/api/v4/projects/"+e.username+"%2F"+e.reponame+"/repository/files/"+encodeURIComponent(a),$.ajax({url:r,method:"DELETE",data:s,success:function(e,t,r){return n()},error:function(e){return n(e)}})}),viewOrign:function(e){return function(t,n){var r,i,o,a;return null,o=t.parentPath||"",i=t.guid,r=o?o+"/"+i:i,a="https://gitlab.com/"+e.username+"/"+e.reponame+"/blob/"+e.branchname+"/"+r,"client"===STORY_PLATFORM?require("nw.gui").Shell.openExternal(a):window.open(a,"_blank")}}(this)}};var e},e.prototype.getAccountInfo=function(e){var t;return t={private_token:this.token},$.ajax({url:"https://gitlab.com/api/v4/user",data:t,method:"GET",success:function(t,n,r){var i;try{i=JSON.parse(t)}catch(e){i=t}return e(null,i)},error:function(t){return e(t)},dataType:"json"})},e.prototype.hasFile=function(e,t,n,r){var i,o,a,s,l,u;return s=n.hasFilesCached,u=e.lastIndexOf("/"),l=e.substring(0,u),a=e.substring(u+1),i=function(e,t){var n,r;for(n=0,r=t.length;n<r;n++)if(t[n].title===e)return!0},(o=s[l])?r(null,i(a,o)):this.listFiles(t,{parentPath:l},(function(e,t){return null==t&&(t=[]),s[l]=t,r(null,i(a,t))}))},e.prototype.getFileMeta=function(e,t,n){var r,i,o,a,s;return o=t.guid,i=(a=t.parentPath||"")?a+"/"+o:o,this,this.branchname,this.token,s={ref:this.branchname,private_token:this.token},r="https://gitlab.com/api/v4/projects/"+this.username+"%2F"+this.reponame+"/repository/files/",$.ajax({url:r+encodeURIComponent(i),data:s,method:"GET",success:function(e,t,r){var i;try{i=JSON.parse(e)}catch(t){t,i=e}return n(null,{guid:i.file_name,parentPath:a,name:l.generateMarkdownTitle(i.file_name)})},error:function(e){return n(e)}})},e.prototype.getFile=function(e,t,n){var r,i,a,s,u,c,p;return a=t.guid,i=(s=t.parentPath||"")?s+"/"+a:a,this,p=this.branchname,c=this.token,u={ref:this.branchname,private_token:this.token},r="https://gitlab.com/api/v4/projects/"+this.username+"%2F"+this.reponame+"/repository/files/",$.ajax({url:r+encodeURIComponent(i),data:u,method:"GET",success:function(e,t,i){var u,d,f,h;try{u=JSON.parse(e)}catch(t){f=t,u=e}return d=decodeURIComponent(escape(window.atob(u.content))),h=[],l.getResourceData(a,d,(function(e,t){return e?(o.showMessage("\u5904\u7406\u9644\u4ef6\u51fa\u9519,\u9519\u8bef\u539f\u56e0\uff1a"+e),n(e)):(t=t.filter((function(e){return!/^http[s]?:\/\//i.test(e)})),async.eachSeries(t,(function(e,t){var n;return 0===(n=0===e.indexOf("/")?e:s?s+"/"+e:e).indexOf("/")&&(n=n.substring(1)),$.ajax({url:r+encodeURIComponent(n),data:{ref:p,private_token:c},method:"GET",success:function(n,r,i){var o,a;return a=l.mimeLookup(e),o=l.base642Blob(n.content,a),h.push({name:e,type:a,blob:o}),t()},error:function(n){return o.showMessage("\u5904\u7406\u9644\u4ef6\u51fa\u9519:"+e+",\u9519\u8bef\u539f\u56e0\uff1a"+n),t()}})}),(function(e){return e?(o.showMessage("\u52a0\u8f7d\u9644\u4ef6\u51fa\u9519"+e),n(f)):n(null,{guid:u.file_name,parentPath:s,markdownContent:d,htmlContent:d,resources:h,name:l.generateMarkdownTitle(u.file_name)})})))}))},error:function(e){return n(e)}})},e.prototype.listFiles=function(e,t,n){var r;return r={path:t.parentPath||"",private_token:this.token,ref:this.branchname},$.ajax({url:"https://gitlab.com/api/v4/projects/"+this.username+"%2F"+this.reponame+"/repository/tree",data:r,method:"GET",success:function(e,r,i){var o,a,s,u,c,p,d,f,h,m;try{o=JSON.parse(e)}catch(t){t,o=e}for(h=[],u=0,p=o.length;u<p;u++)c=o[u],a=l.checkIsSupportFileType(c.name)?"text":"application",s=c.path,d={guid:c.name,parentPath:t.parentPath,name:c.name,isChild:"tree"!==c.type,createDate:Date.now(),updateDate:Date.now(),fileType:a,tagNames:[]},f={key:s.replace(/\//g,"_"),folder:"tree"===c.type,title:c.name,lazy:"tree"===c.type,obj:d},h.push(f);return m=_.sortBy(h,(function(e){return(e.folder?"A":"B")+e.title})),n(null,m)},error:function(e){return n(e)}})},e.prototype._saveAttach=function(e,t,n,r){var i,o,a;return o=e.lastIndexOf("/"),e.substring(0,o),e.substring(o+1),a={private_token:this.token,branch:this.branchname,encoding:"base64",content:t,commit_message:"\u6dfb\u52a0\u9644\u4ef6 "+e},i="https://gitlab.com/api/v4/projects/"+this.username+"%2F"+this.reponame+"/repository/files/"+encodeURIComponent(e),u(i,this.branchname,this.token,(function(e){return null==e&&(e="POST"),$.ajax({type:e,url:i,method:e,data:a,dataType:"json",success:function(e,t,n){return r(null,{},this)},error:function(e){return r(e)}})}))},e.prototype.saveAttach=function(e,t,n,r,i,o,a){var s,u,c,p,d;return p=t.get("pluginName"),u=t.get("guid"),c=t.get("parentPath"),u?p!==this.name?"function"==typeof a?a():void 0:(0===n.indexOf("./")&&(n=n.substring(2)),0===(s=0===n.indexOf("/")?n:c?c+"/"+n:n).indexOf("/")&&(s=s.substring(1)),$.trim(s)?l.blob2Base64(r,(d=this,function(e,n){return e?a(e):d._saveAttach(s,n,t,a)})):a(null,{},this)):"function"==typeof a?a():void 0},e.prototype.saveFile=function(e,t,n,i){var s,c,p,d,f,h,m,v,g;return m=this,d=t.get("pluginName"),c=t.get("guid"),p=t.get("parentPath"),v=t.get("title")||"\u672a\u547d\u540d\u6587\u4ef6.md",this.repo,this.branch,d!==this.name&&(c="",d="",p=""),f=n.saveAs,h=n.saveAttachment,g=this,s=function(e,n,a){var s,c,p,d,f,y;return o.showHandling("\u4fdd\u5b58\u4e2d..."),y=setTimeout((function(){return o.hideHandling()}),r.getNetworkResourceTimeout),v.lastIndexOf(".")<0&&(v+=".md"),0===(d=e?e+"/"+n:n).indexOf("/")&&(d=d.substring(1)),c=t.get("content")||"",s=a?"\u521b\u5efa\u6587\u4ef6:"+d:"\u4fee\u6539\u6587\u4ef6:"+d,f={private_token:g.token,utf8:decodeURI("%E2%9C%93"),branch:g.branchname,content:t.get("content")||"",commit_message:s},p="https://gitlab.com/api/v4/projects/"+g.username+"%2F"+g.reponame+"/repository/files/"+encodeURIComponent(d),u(p,g.branchname,g.token,(function(r){return null==r&&(r="POST"),$.ajax({url:p,method:r,data:f,dataType:"json",success:function(r,s,u){var p;return clearTimeout(y),y=null,o.hideHandling(),p={guid:n,parentPath:e,name:n,tagNames:[],createDate:Date.now(),updateDate:Date.now(),isChild:!0},l.getResourceData("default.md",c,(function(n,r){var s;return n?(o.showMessage("\u4fdd\u5b58\u9644\u4ef6\u5931\u8d25",6e3,"error"),o.hideHandling(),i(null,p)):(s={},r=r.filter((function(e){return!/^http[s]?:\/\//i.test(e)})),async.eachSeries(r,(function(n,r){var i,u;0===(d=0===(i=n).indexOf("/")?i:e?e+"/"+i:i).indexOf("/")&&(d=d.substring(1));try{n=decodeURI(n)}catch(e){u=e,console.log(u)}return m.hasFile(d,{},{hasFilesCached:s},(function(e,i){return!i||a||h?t.getAttachObjectByFilename(n,(function(e,i){var a;return(a=null!=i?i.objectUrl:void 0)?l.objectURLToArrayBuffer(a,(function(i,a){var s;return i?(o.showMessage("\u4fdd\u5b58\u9644\u4ef6\u5931\u8d25: "+n+", "+i,6e3,"error"),r()):(s=l.arrayBufferToBase64(a),m._saveAttach(d,s,t,(function(t){return t&&o.showMessage("\u4fdd\u5b58\u9644\u4ef6\u5931\u8d25: "+n+", "+e,6e3,"error"),r()})))})):r()})):r()}))}),(function(e){return clearTimeout(y),y=null,o.hideHandling(),i(null,p,m)})))}))},error:function(e){return o.hideHandling(),i(e)}})}))},!c||f?new a({plugin:this,saveAs:f,saveAsCallback:i,fileModel:t}).show((function(e,t){return s(e,t,!0)})):s(p,c,!1)},e}(),n.exports=i}}),window.requirejs.define({"plugins/gitoschina/index":function(e,t,n){var r,i,o,a,s,l,u={}.hasOwnProperty;o=t("../../lib/notifier"),l=t("../../lib/utils"),r=t("../../constant"),s=t("../../views/save_new_dialog_view"),a=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)u.call(t,n)&&(e[n]=t[n]);function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype}(t,e),t.prototype.validateFilename=function(e){return!e.endsWith("/")&&(!!e.replace(/^\/*/g,"")&&/^[^:*?"<>|\r\n]*$/g.test(e))},t.prototype.onSelectObj=function(e,t){var n,r,i,o,a,s;return a=(o=this.currentObj).parentPath||"",o.isChild||("-1"===(n=o.guid)&&(n=""),0===(a=a+"/"+n).indexOf("/")&&(a=a.substring(1))),(s=(n=e).lastIndexOf("/"))>=0&&(r=n.substring(s+1),i=(i=n.substring(0,s)).replace(/^\/*/g,""),a?(a=a+"/"+i,n=r):(a=i,n=r)),t(a,n)},t}(s),i=function(){function e(){}return e.prototype.name="gitoschina",e.prototype.kind="store",e.prototype.displayName="\u7801\u4e91",e.prototype.description="\u4f7f\u7528 Gitoschina \u505a\u4e3a\u5b58\u50a8",e.prototype.icon="gitoschina",e.prototype.logo="img/gitoschina.png",e.prototype.production=!0,e.prototype.storePluginModel=null,e.prototype.init=function(e){var t,n;if(e){if(n=e.get("extraInfo"),this.postBaseData={pluginName:this.name,entryToken:e.get("entryToken"),entryTokenSecret:e.get("entryTokenSecret"),extraInfo:n},"string"==typeof n)try{n=JSON.parse(n)}catch(e){t=e,console.log(t)}return this.extraInfo=n,this.branchname=this.extraInfo.branchname,this.reponame=this.extraInfo.reponame,this.username=this.extraInfo.username,this.storePluginModel=e}},e.prototype.getDisplayName=function(){var e;return this.storePluginModel&&(e=this.storePluginModel.get("displayName")),e||this.displayName},e.prototype._authenticate=function(e){var t,n,r;return"310b9e8510fc2d060ff897e04289f71b2930235852603902bb5661b0513f4481",n="https://gitee.com/oauth/authorize?client_id=310b9e8510fc2d060ff897e04289f71b2930235852603902bb5661b0513f4481&redirect_uri="+("http://markdown.xiaoshujiang.com/oauth2/"+this.name)+"&response_type=code",t=window.open(n,"_blank","resizeable=true,height=400,width=400, left=200, top=30"),window.accessToken=(r=this,function(n,i,a){var s,l,u;r.postBaseData={pluginName:r.name,entryToken:n,entryTokenSecret:i,extraInfo:a};try{a=JSON.parse(a)}catch(e){u=e,console.log(u)}return t.close(),s=$('<div class="ui small modal story_modal">\n  <div class="header">\u8bf7\u8f93\u5165\u6709\u6548\u7684\u4ed3\u5e93\uff0c\u53ca\u5bf9\u5e94\u7684\u5206\u652f</div>\n  <div class="content story_content">\n    <div class="ui form">\n      <div class="field">\n        <label>\u4ed3\u5e93\u540d\u79f0</label>\n        <div class="ui fluid icon input">\n          <input type="text" name="repo" placeholder="" value="">\n          <i class="linkify icon"></i>\n        </div>\n      </div>\n      <div class="field">\n        <label>\u5bf9\u5e94\u7684\u5206\u652f</label>\n        <div class="ui fluid icon input">\n          <input type="text" name="branch" placeholder="" value="master">\n          <i class="linkify icon"></i>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class="actions">\n    <div class="tips">\n    \u6ce8\uff1a\u4ed3\u5e93\u5fc5\u987b\u521d\u59cb\u5316\uff08\u4e5f\u5c31\u662f\u5fc5\u987b\u6709\u4e00\u4e2a\u6587\u4ef6,\u6bd4\u5982readme.md\uff09\n    </div>\n    <div class="ui basic cancel button">\n      \u53d6\u6d88\n    </div>\n    <div class="ui basic positive button">\n      \u786e\u5b9a  \n    </div>\n  </div>\n</div>'),(l=s.find(".ui.form")).form({fields:{repo:{identifier:"repo",rules:[{type:"empty",prompt:"\u8bf7\u8f93\u5165\u4e00\u4e2a\u6709\u6548\u7684\u4ed3\u5e93\u540d\u79f0"}]},branch:{identifier:"branch",rules:[{type:"empty",prompt:"\u8bf7\u8f93\u5165\u4e00\u4e2a\u6709\u6548\u7684\u5206\u652f"}]}},onSuccess:function(){var t,l,u;return(u=r).dimmer.dimmer("show"),l=s.find("input[name=repo]").val().trim(),t=s.find("input[name=branch]").val().trim(),a.branchname=t,a.reponame=l,u.getAccountInfo((function(t,r){var l;return t?(o.showMessage("\u68c0\u6d4b\u5931\u8d25\uff0c\u68c0\u6d4b\u7528\u6237\u540d\u5931\u8d25",6e3,"error"),u.dimmer.dimmer("hide"),s=null):(l=r.username,a.username=l,u.postBaseData.extraInfo=JSON.stringify(a),u.extraInfo=a,u.username=l,u.branchname=a.branchname,u.reponame=a.reponame,u.listFiles({},{},(function(t,r){return t?(o.showMessage("\u68c0\u6d4b\u5931\u8d25\uff0c\u6ca1\u6709\u627e\u5230\u76f8\u5e94\u7684\u4ed3\u5e93\u6216\u8005\u5206\u652f",6e3,"error"),u.dimmer.dimmer("hide"),u=null,s=null):(e(null,n,i,a,u),u.dimmer.dimmer("hide"),s.modal("hide"),u=null)})))}))}}),r.dimmer=s.find(".content").dimmer({closable:!1}),s.find(".dimmer").html('<div class="ui indeterminate text loader">\u6821\u9a8c\u4e2d...</div>'),s.modal({closable:!1,allowMultiple:!0,onHidden:function(){return s.remove(),s=null},onApprove:function(){return l.form("validate form"),!1}}).modal("show")})},e.prototype.authenticate=function(e){var t,n,r,i;return r={},"",t=$('<div class="ui small modal story_modal">\n  <div class="header">\u8bf7\u8f93\u5165\u6709\u6548\u7684\u4ed3\u5e93\uff0c\u53ca\u5bf9\u5e94\u7684\u5206\u652f</div>\n  <div class="content story_content">\n    <div class="ui form">\n      <div class="field">\n        <label>\u8bf7\u8f93\u5165\u4e00\u4e2a\u6709\u6548\u7684token\u503c</label>\n        <div class="ui fluid icon input">\n          <input type="text" name="token" placeholder="" value="">\n          <i class="linkify icon"></i>\n        </div>\n      </div>\n      <div class="field">\n        <label>\u4ed3\u5e93\u540d\u79f0</label>\n        <div class="ui fluid icon input">\n          <input type="text" name="repo" placeholder="markdownxiaoshujiang" value="">\n          <i class="linkify icon"></i>\n        </div>\n        <div class="ui message info icon"><i class="info circle icon"></i><div class="content">\u6bd4\u5982 http://gitee.com/suziwen/<strong>markdownxiaoshujiang</strong>,<br> \u53ea\u9700\u8981\u8f93\u5165 <strong>markdownxiaoshujiang</strong> \u5c31\u53ef\u4ee5\u4e86</div></div>\n      </div>\n      <div class="field">\n        <label>\u5bf9\u5e94\u7684\u5206\u652f</label>\n        <div class="ui fluid icon input">\n          <input type="text" name="branch" placeholder="" value="master">\n          <i class="linkify icon"></i>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class="actions">\n    <div class="tips">\n        <div>\u6ce8\uff1a</div>\n        <div>1.\u7533\u8bf7token\u5730\u5740\uff1a<a href="https://gitee.com/profile/personal_access_tokens/new" target="_blank">token</a>\n          <br>\n          2. \u9700\u8981\u7684\u6743\u9650\u4e3a\uff1auser_info, projects\n          <br>\n          3. \u4ed3\u5e93\u5fc5\u987b\u521d\u59cb\u5316\uff08\u4e5f\u5c31\u662f\u5fc5\u987b\u6709\u4e00\u4e2a\u6587\u4ef6,\u6bd4\u5982readme.md\uff09\n        </div>\n    </div>\n    <div class="ui basic cancel button">\n      \u53d6\u6d88\n    </div>\n    <div class="ui basic positive button">\n      \u786e\u5b9a  \n    </div>\n  </div>\n</div>'),(n=t.find(".ui.form")).form({fields:{token:{identifier:"token",rules:[{type:"empty",prompt:"\u8bf7\u8f93\u5165\u4e00\u4e2a\u6709\u6548\u7684token"}]},repo:{identifier:"repo",rules:[{type:"empty",prompt:"\u8bf7\u8f93\u5165\u4e00\u4e2a\u6709\u6548\u7684\u4ed3\u5e93\u540d\u79f0"}]},branch:{identifier:"branch",rules:[{type:"empty",prompt:"\u8bf7\u8f93\u5165\u4e00\u4e2a\u6709\u6548\u7684\u5206\u652f"}]}},onSuccess:(i=this,function(){var n,a,s,l;return(l=i).dimmer.dimmer("show"),n=t.find("input[name=token]").val().trim(),s=t.find("input[name=repo]").val().trim(),a=t.find("input[name=branch]").val().trim(),r.branchname=a,r.reponame=s,i.postBaseData={pluginName:i.name,entryToken:n,entryTokenSecret:"",extraInfo:JSON.stringify(r)},l.getAccountInfo((function(i,a){var s;return i?(o.showMessage("\u68c0\u6d4b\u5931\u8d25\uff0c\u68c0\u6d4b\u7528\u6237\u540d\u5931\u8d25",6e3,"error"),l.dimmer.dimmer("hide"),t=null):(s=a.username,r.username=s,l.postBaseData.extraInfo=JSON.stringify(r),l.extraInfo=r,l.username=s,l.branchname=r.branchname,l.reponame=r.reponame,l.listFiles({},{},(function(i,a){return i?(o.showMessage("\u68c0\u6d4b\u5931\u8d25\uff0c\u6ca1\u6709\u627e\u5230\u76f8\u5e94\u7684\u4ed3\u5e93\u6216\u8005\u5206\u652f",6e3,"error"),l.dimmer.dimmer("hide"),l=null,t=null):(e(null,n,"",r,l),l.dimmer.dimmer("hide"),t.modal("hide"),l=null)})))}))})}),this.dimmer=t.find(".content").dimmer({closable:!1}),t.find(".dimmer").html('<div class="ui indeterminate text loader">\u6821\u9a8c\u4e2d...</div>'),t.modal({closable:!1,allowMultiple:!0,onHidden:function(){return t.remove(),t=null},onApprove:function(){return n.form("validate form"),!1}}).modal("show")},e.prototype.signOut=function(e){return e()},e.prototype.getContextMenu=function(){return{menu:function(e,t){return e.isChild?{refreshFile:{name:"\u66f4\u65b0\u672c\u5730\u7f13\u5b58\u6587\u4ef6"},viewOrign:{name:"\u5728gitoschina\u4e2d\u6253\u5f00"},deleteFile:{name:"\u5220\u9664\u6587\u4ef6"}}:{}},actions:{deleteFile:(e=this,function(t,n){var r,i,o,a;return r=t.guid,i=t&&t.parentPath||"",0===(o=t&&t.isChild?i+"/"+r:r).indexOf("/")&&(o=o.substring(1)),a=$.extend({},e.postBaseData,{operateType:"deleteFile",parentPath:i,guid:t.guid,fileModel:t}),$.ajax({type:"post",url:"/plugin",method:"POST",data:a,dataType:"json",success:function(e,t,r){var i;try{i=JSON.parse(e)}catch(t){i=e}return i.error?n(i):n()}})}),viewOrign:function(e){return function(t,n){var r,i,o,a,s,l;if(i=null,s=t.parentPath||"",a=t.guid,o=s?s+"/"+a:a,e.extraInfo)try{i=JSON.parse(e.postBaseData.extraInfo)}catch(t){r=t,console.log(r),i=e.extraInfo}return i&&(l="https://gitee.com/"+i.username+"/"+i.reponame+"/blob/"+i.branchname+"/"+o),"client"===STORY_PLATFORM?require("nw.gui").Shell.openExternal(l):window.open(l,"_blank")}}(this)}};var e},e.prototype.getAccountInfo=function(e){var t,n;return t=$.extend({},this.postBaseData,{operateType:"getAccountInfo"}),$.ajax({url:"/plugin",data:t,method:"GET",success:(n=this,function(t,r,i){var o,a,s;try{o=JSON.parse(t)}catch(e){a=e,o=t}if(o.error)return e(o);try{(s=JSON.parse(n.postBaseData.extraInfo)).shardId=o.shardId,n.postBaseData.extraInfo=JSON.stringify(s)}catch(e){a=e,console.log(a),(s={}).shardId=o.shardId,n.postBaseData.extraInfo=JSON.stringify(s)}return e(null,o)}),error:function(t){return e(t)},dataType:"json"})},e.prototype.hasFile=function(e,t,n,r){var i,o,a,s,l,u;return s=n.hasFilesCached,u=e.lastIndexOf("/"),l=e.substring(0,u),a=e.substring(u+1),i=function(e,t){var n,r;for(n=0,r=t.length;n<r;n++)if(t[n].title===e)return!0},(o=s[l])?r(null,i(a,o)):this.listFiles(t,{parentPath:l},(function(e,t){return null==t&&(t=[]),s[l]=t,r(null,i(a,t))}))},e.prototype.getFileMeta=function(e,t,n){var r,i,o;return r=t.guid,(i=t.parentPath||"")?i+"/"+r:r,this,o=$.extend({},this.postBaseData,{parentPath:t.parentPath,guid:t.guid,operateType:"getFile"}),this,$.ajax({url:"/plugin",data:o,method:"GET",success:function(e,t,r){var i;try{i=JSON.parse(e)}catch(t){t,i=e}return i.error?n(i):n(null,{guid:i.guid,parentPath:i.parentPath,name:l.generateMarkdownTitle(i.name)})}})},e.prototype.getFile=function(e,t,n){var r,i,a,s;return r=t.guid,(i=t.parentPath||"")?i+"/"+r:r,this,a=$.extend({},this.postBaseData,{parentPath:t.parentPath,guid:t.guid,operateType:"getFile"}),s=this,$.ajax({url:"/plugin",data:a,method:"GET",success:function(e,t,a){var u,c;try{u=JSON.parse(e)}catch(t){t,u=e}return u.error?n(u):(c=[],l.getResourceData(r,u.markdownContent,(function(e,t){return e?(o.showMessage("\u5904\u7406\u9644\u4ef6\u51fa\u9519,\u9519\u8bef\u539f\u56e0\uff1a"+e),n(e)):(t=t.filter((function(e){return!/^http[s]?:\/\//i.test(e)})),async.mapLimit(t,20,(function(e,t){var n,r,a;return 0===(n=0===e.indexOf("/")?e:i?i+"/"+e:e).indexOf("/")&&(n=n.substring(1)),r=n.lastIndexOf("/"),a=$.extend({},s.postBaseData,{parentPath:n.substring(0,r),guid:n.substring(r+1),operateType:"getFile",returnType:"base64"}),$.ajax({url:"/plugin",data:a,method:"GET",error:function(e){return o.showMessage("\u52a0\u8f7d\u8d44\u6e90\u5931\u8d25"+e,6e3,"error"),t()},success:function(r,i,a){var s,u,p,d;try{s=JSON.parse(r)}catch(e){e,s=r}return s.error?(o.showMessage("\u52a0\u8f7d\u8d44\u6e90("+n+")\u5931\u8d25"+s.error,6e3,"error"),t()):(u=s.fileData,d=l.mimeLookup(e),p=l.base642Blob(u,d),c.push({name:e,type:d,blob:p}),t())}})}),(function(e){return e?(o.showMessage("\u52a0\u8f7d\u9644\u4ef6\u51fa\u9519"+e),n(e)):n(null,{guid:u.guid,parentPath:u.parentPath,markdownContent:u.markdownContent,resources:c,htmlContent:u.markdownContent,name:l.generateMarkdownTitle(u.name)})})))})))},error:function(e){return n(e)}})},e.prototype.listFiles=function(e,t,n){var r;return t.parentPath||"",r=$.extend({},this.postBaseData,{parentPath:t.parentPath,operateType:"listFiles"}),$.ajax({url:"/plugin",data:r,method:"GET",success:function(e,t,r){var i,o,a,s,u,c;try{i=JSON.parse(e)}catch(t){t,i=e}if(i.error)return n(i);for(a=0,u=i.length;a<u;a++)s=i[a],o=l.checkIsSupportFileType(s.obj.name)?"text":"application",s.obj.fileType=o;return c=_.sortBy(i,(function(e){return(e.folder?"A":"B")+e.title})),n(null,c)},error:function(e){return n(e)}})},e.prototype._saveAttach=function(e,t,n,r){var i,o,a,s;return a=e.lastIndexOf("/"),o=e.substring(0,a),i=e.substring(a+1),s=$.extend({},this.postBaseData,{operateType:"saveFile",parentPath:o,guid:i,fileData:t,fileModel:n.toJSONWithSkipAttachmentData()}),$.ajax({type:"post",url:"/plugin",method:"POST",data:s,dataType:"json",success:function(e,t,n){return r(null,{},this)},error:function(e){return r(e)}})},e.prototype.saveAttach=function(e,t,n,r,i,o,a){var s,u,c,p,d;return p=t.get("pluginName"),u=t.get("guid"),c=t.get("parentPath"),u?p!==this.name?"function"==typeof a?a():void 0:(0===n.indexOf("./")&&(n=n.substring(2)),0===(s=0===n.indexOf("/")?n:c?c+"/"+n:n).indexOf("/")&&(s=s.substring(1)),$.trim(s)?l.blob2Base64(r,(d=this,function(e,n){return e?a(e):d._saveAttach(s,n,t,a)})):a(null,{},this)):"function"==typeof a?a():void 0},e.prototype.saveFile=function(e,t,n,i){var s,u,c,p,d,f,h,m,v;return h=this,p=t.get("pluginName"),u=t.get("guid"),c=t.get("parentPath"),m=t.get("title")||"\u672a\u547d\u540d\u6587\u4ef6.md",this.repo,this.branch,p!==this.name&&(u="",p="",c=""),d=n.saveAs,f=n.saveAttachment,v=this,s=function(e,n,a){var s,u,c,p;return o.showHandling("\u4fdd\u5b58\u4e2d..."),p=setTimeout((function(){return o.hideHandling()}),r.getNetworkResourceTimeout),m.lastIndexOf(".")<0&&(m+=".md"),0===(u=e?e+"/"+n:n).indexOf("/")&&(u=u.substring(1)),s=t.get("content")||"",c=$.extend({},v.postBaseData,{operateType:"saveFile",parentPath:e||"",guid:n||"",title:m,fileMarkdownContent:t.get("content")||"",fileHtmlContent:"",fileModel:t.toJSONWithSkipAttachmentData()}),$.ajax({type:"post",url:"/plugin",method:"POST",data:c,dataType:"json",success:function(n,r,c){var d;return clearTimeout(p),p=null,n.code?(o.showMessage("\u4fdd\u5b58\u5931\u8d25: "+n.error,6e3,"error"),o.hideHandling(),i(n,null)):(d={guid:n.guid,parentPath:n.parentPath,name:n.guid,tagNames:[],createDate:Date.now(),updateDate:Date.now(),isChild:!0},l.getResourceData("default.md",s,(function(n,r){var s;return n?(o.showMessage("\u4fdd\u5b58\u9644\u4ef6\u5931\u8d25",6e3,"error"),o.hideHandling(),i(null,d)):(s={},r=r.filter((function(e){return!/^http[s]?:\/\//i.test(e)})),async.eachSeries(r,(function(n,r){var i,c;0===(u=0===(i=n).indexOf("/")?i:e?e+"/"+i:i).indexOf("/")&&(u=u.substring(1));try{n=decodeURI(n)}catch(e){c=e,console.log(c)}return h.hasFile(u,{},{hasFilesCached:s},(function(e,i){return!i||a||f?t.getAttachObjectByFilename(n,(function(e,i){var a;return(a=null!=i?i.objectUrl:void 0)?l.objectURLToArrayBuffer(a,(function(i,a){var s;return i?(o.showMessage("\u4fdd\u5b58\u9644\u4ef6\u5931\u8d25: "+n+", "+i,6e3,"error"),r()):(s=l.arrayBufferToBase64(a),h._saveAttach(u,s,t,(function(t){return t&&o.showMessage("\u4fdd\u5b58\u9644\u4ef6\u5931\u8d25: "+n+", "+e,6e3,"error"),r()})))})):r()})):r()}))}),(function(e){return clearTimeout(p),p=null,o.hideHandling(),i(null,d,h)})))})))},error:function(e){return o.hideHandling(),i(e)}})},!u||d?new a({plugin:this,saveAs:d,saveAsCallback:i,fileModel:t}).show((function(e,t){return s(e,t,!0)})):s(c,u,!1)},e}(),n.exports=i}}),window.requirejs.define({"plugins/imgur/index":function(e,t,n){var r,i;i=t("../../lib/notifier"),t("../../lib/utils"),t("../../constant"),r=function(){function e(){}return e.prototype.name="imgur",e.prototype.kind="resource",e.prototype.displayName="imgur \u533f\u540d",e.prototype.description="\u9700\u8981\u81ea\u5df1\u6ce8\u518cclientid",e.prototype.icon="imgur",e.prototype.logo="img/imgur.png",e.prototype.production=!0,e.prototype.storePluginModel=null,e.prototype.init=function(e){var t,n;if(e){if("string"==typeof(n=e.get("extraInfo")))try{n=JSON.parse(n)}catch(e){t=e,console.log(t)}return this.extraInfo=n||{},this.clientId=e.get("entryToken"),this.storePluginModel=e}},e.prototype.authenticate=function(e){var t,n,r;return this.extraInfo={},t=$('<div class="ui small modal story_modal">\n  <div class="header">\u8bf7\u8f93\u5165\u6709\u6548\u7684 clientid \u5b8c\u6210\u8ba4\u8bc1</div>\n  <div class="content story_content">\n    <div class="ui form">\n      <div class="field">\n        <label for="displayName">\u8bf7\u8f93\u5165\u4e00\u4e2a\u81ea\u5b9a\u4e49\u540d\u79f0</label>\n        <div class="ui fluid input">\n          <input type="text" name="displayName" placeholder="" value="imgur \u4e91\u5b58\u50a8">\n        </div>\n      </div>\n      <div class="field">\n        <label>\u8bf7\u8f93\u5165\u4e00\u4e2a\u6709\u6548\u7684clientId\u503c</label>\n        <div class="ui fluid icon input">\n          <input type="text" name="clientId" placeholder="" value="">\n          <i class="linkify icon"></i>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class="actions">\n    <div class="tips">\n    <div>\u6ce8\uff1a</div>\n    <div>1.\u7533\u8bf7clientId\u5730\u5740\uff1a<a href="http://api.imgur.com/" target="_blank">token</a>\n    </div>\n    </div>\n    <div class="ui cancel button">\n      \u53d6\u6d88\n    </div>\n    <div class="ui positive button">\n      \u786e\u5b9a  \n    </div>\n  </div>\n</div>'),(n=t.find(".ui.form")).form({onSuccess:(r=this,function(){var n,i,o;return r.dimmer.dimmer("show"),n=r.dimmer,i=t.find("input[name=clientId]").val().trim(),o=t.find("input[name=displayName]").val().trim(),i=i||"df35ba07854d2f7",r.clientId=i,r.extraInfo.displayName=o,e(null,i,null,r.extraInfo,r,(function(e){if(n.dimmer("hide"),!e)return t.modal("hide")}))})}),this.dimmer=t.find(".content").dimmer({closable:!1}),t.find(".dimmer").html('<div class="ui indeterminate text loader">\u6821\u9a8c\u4e2d...</div>'),t.modal({closable:!1,allowMultiple:!0,onHidden:function(){return n.form("destroy"),t.modal("destroy"),t.remove()},onApprove:function(){return n.form("validate form"),!1}}).modal("show")},e.prototype.signOut=function(e){return e()},e.prototype.getAccountInfo=function(e){var t;return t=this.clientId,$.ajax({type:"POST",url:"https://api.imgur.com/3/image",data:{type:"base64",image:"R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"},headers:{Authorization:"Client-ID "+t}}).done((function(n){return n&&n.success?e(null,{shardId:t,username:t,email:""}):(i.showMessage("\u7ed1\u5b9a\u8ba4\u8bc1\u5931\u8d25:"+n.data.error,6e3,"error"),e("\u7ed1\u5b9a\u8ba4\u8bc1\u5931\u8d25:"+n.data.error))})).fail((function(t,n,r){var o;return(o=t.responseJSON)&&(r=o.status+":"+o.data.error),i.showMessage("\u7ed1\u5b9a\u8ba4\u8bc1\u5931\u8d25:"+r,6e3,"error"),e("\u7ed1\u5b9a\u8ba4\u8bc1\u5931\u8d25"+r)}))},e.prototype.saveFile=function(e,t,n,r,o){var a,s;return(s=new FormData).append("image",n),a=this.clientId,$.ajax({type:"POST",url:"https://api.imgur.com/3/image",data:s,headers:{Authorization:"Client-ID "+a},processData:!1,contentType:!1}).done((function(e){return e&&e.success?"function"==typeof o?o(null,t,e.data.link,e.data):void 0:(i.showMessage("\u4e0a\u4f20\u8d44\u6e90\u5931\u8d25:"+e.data.error+"\u300b"+filePath,6e3,"error"),"function"==typeof o?o("\u4e0a\u4f20\u8d44\u6e90\u5931\u8d25:"+e.data.error+"\u300b"+filePath):void 0)})).fail((function(e,t,n){var r;return(r=e.responseJSON)&&(n=r.status+":"+r.data.error),i.showMessage("\u4e0a\u4f20\u8d44\u6e90\u5931\u8d25:"+n,6e3,"error"),"function"==typeof o?o("\u4e0a\u4f20\u8d44\u6e90\u5931\u8d25:"+n):void 0}))},e}(),n.exports=r}}),window.requirejs.define({"plugins/imgur_callback/index":function(e,t,n){var r,i;i=t("../../lib/notifier"),t("../../lib/utils"),t("../../constant"),r=function(){function e(){}return e.prototype.name="imgur_callback",e.prototype.kind="resource",e.prototype.displayName="imgur\u8ba4\u8bc1\u4e0a\u4f20",e.prototype.description="\u9700\u8981\u7528\u6237 oauth2  \u8ba4\u8bc1",e.prototype.icon="imgur",e.prototype.logo="img/imgur.png",e.prototype.production=!0,e.prototype.storePluginModel=null,e.prototype.init=function(e){var t,n;if(e){if("string"==typeof(n=e.get("extraInfo")))try{n=JSON.parse(n)}catch(e){t=e,console.log(t)}return this.extraInfo=n,this.accessToken=e.get("entryToken"),this.storePluginModel=e}},e.prototype.authenticate=function(e){var t,n,r;return n=encodeURIComponent("https://markdown.xiaoshujiang.com/imgurcallback.html"),t=window.open("https://api.imgur.com/oauth2/authorize?client_id=df35ba07854d2f7&state=1&response_type=token&redirect_uri="+n,"_blank","resizeable=true,height=400,width=400, left=200, top=30"),window.accessToken=(r=this,function(n,i,o){return r.accessToken=n,e(null,n,i,o,r),t.close()})},e.prototype.signOut=function(e){return e()},e.prototype.getAccountInfo=function(e){var t;return t=this.accessToken,$.ajax({type:"GET",url:"https://api.imgur.com/3/account/me",headers:{Authorization:"Bearer "+t}}).done((function(t){var n;return t&&t.success?(n={shardId:t.data.id,username:t.data.url,email:""},e(null,n)):(i.showMessage("\u7ed1\u5b9a\u8ba4\u8bc1\u5931\u8d25:"+t.data.error,6e3,"error"),e("\u7ed1\u5b9a\u8ba4\u8bc1\u5931\u8d25:"+t.data.error))})).fail((function(t,n,r){var o;return(o=t.responseJSON)&&(r=o.status+":"+o.data.error),i.showMessage("\u7ed1\u5b9a\u8ba4\u8bc1\u5931\u8d25:"+r,6e3,"error"),e("\u7ed1\u5b9a\u8ba4\u8bc1\u5931\u8d25"+r)}))},e.prototype.saveFile=function(e,t,n,r,o){var a,s;return(s=new FormData).append("image",n),a=this.accessToken,$.ajax({type:"POST",url:"https://api.imgur.com/3/image",data:s,headers:{Authorization:"Bearer "+a},processData:!1,contentType:!1}).done((function(e){return e&&e.success?"function"==typeof o?o(null,t,e.data.link,e.data):void 0:(i.showMessage("\u4e0a\u4f20\u8d44\u6e90\u5931\u8d25:"+e.data.error+"\u300b"+filePath,6e3,"error"),"function"==typeof o?o("\u4e0a\u4f20\u8d44\u6e90\u5931\u8d25:"+e.data.error+"\u300b"+filePath):void 0)})).fail((function(e,t,n){var r;return(r=e.responseJSON)&&(n=r.status+":"+r.data.error),i.showMessage("\u4e0a\u4f20\u8d44\u6e90\u5931\u8d25:"+n,6e3,"error"),"function"==typeof o?o("\u4e0a\u4f20\u8d44\u6e90\u5931\u8d25:"+n):void 0}))},e}(),n.exports=r}}),window.requirejs.define({"plugins/imgur_n/index":function(e,t,n){var r,i;i=t("../../lib/notifier"),t("../../lib/utils"),t("../../constant"),r=function(){function e(){}return e.prototype.name="imgur_n",e.prototype.kind="resource",e.prototype.displayName="imgur_n",e.prototype.description="\u9700\u8981\u7528\u6237 oauth2  \u8ba4\u8bc1",e.prototype.icon="github",e.prototype.logo="img/github.jpg",e.prototype.production=!1,e.prototype.storePluginModel=null,e.prototype.init=function(e){var t,n;if(e){if("string"==typeof(n=e.get("extraInfo")))try{n=JSON.parse(n)}catch(e){t=e,console.log(t)}return this.extraInfo=n,this.accessToken=e.get("entryToken"),this.storePluginModel=e}},e.prototype.authenticate=function(e){var t,n;return t=window.open("https://api.imgur.com/oauth2/authorize?client_id=62040f62b692443&state=1&response_type=token","_blank","resizeable=true,height=400,width=400, left=200, top=30"),window.accessToken=(n=this,function(r,i,o){return n.accessToken=r,e(null,r,i,o,n),t.close()})},e.prototype.signOut=function(e){return e()},e.prototype.getAccountInfo=function(e){var t;return t=this.accessToken,$.ajax({type:"GET",url:"https://api.imgur.com/3/account/me",headers:{Authorization:"Bearer "+t}}).done((function(t){var n;return t&&t.success?(n={shardId:t.data.id,username:t.data.url,email:""},e(null,n)):(i.showMessage("\u7ed1\u5b9a\u8ba4\u8bc1\u5931\u8d25:"+t.data.error,6e3,"error"),e("\u7ed1\u5b9a\u8ba4\u8bc1\u5931\u8d25:"+t.data.error))})).fail((function(t,n,r){var o;return(o=t.responseJSON)&&(r=o.status+":"+o.data.error),i.showMessage("\u7ed1\u5b9a\u8ba4\u8bc1\u5931\u8d25:"+r,6e3,"error"),e("\u7ed1\u5b9a\u8ba4\u8bc1\u5931\u8d25"+r)}))},e.prototype.saveFile=function(e,t,n,r,o){var a,s;return(s=new FormData).append("image",n),a=this.accessToken,$.ajax({type:"POST",url:"https://api.imgur.com/3/image",data:s,headers:{Authorization:"Bearer "+a},processData:!1,contentType:!1}).done((function(e){return e&&e.success?"function"==typeof o?o(null,t,e.data.link,e.data):void 0:(i.showMessage("\u4e0a\u4f20\u8d44\u6e90\u5931\u8d25:"+e.data.error+"\u300b"+filePath,6e3,"error"),"function"==typeof o?o("\u4e0a\u4f20\u8d44\u6e90\u5931\u8d25:"+e.data.error+"\u300b"+filePath):void 0)})).fail((function(e,t,n){var r;return(r=e.responseJSON)&&(n=r.status+":"+r.data.error),i.showMessage("\u4e0a\u4f20\u8d44\u6e90\u5931\u8d25:"+n,6e3,"error"),"function"==typeof o?o("\u4e0a\u4f20\u8d44\u6e90\u5931\u8d25:"+n):void 0}))},e}(),n.exports=r}}),window.requirejs.define({"plugins/local/index":function(e,t,n){var r,i,o,a,s,l,u={}.hasOwnProperty;l=t("../../lib/utils"),o=t("../../lib/notifier"),r=t("../../constant"),s=t("../../views/save_new_dialog_view"),a=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)u.call(t,n)&&(e[n]=t[n]);function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype}(t,e),t.prototype.validateFilename=function(e){return!e.endsWith("/")&&(!!e.replace(/^\/*/g,"")&&/^[^:*?"<>|\r\n]*$/g.test(e))},t.prototype.onSelectObj=function(e,t){var n,r,i,o,a,s;return a=(o=this.currentObj).parentPath||"",o.isChild||("-1"===(n=o.guid)&&(n=""),0===(a=a+"/"+n).indexOf("/")&&(a=a.substring(1))),(s=(n=e).lastIndexOf("/"))>=0&&(r=n.substring(s+1),i=(i=n.substring(0,s)).replace(/^\/*/g,""),a?(a=a+"/"+i,n=r):(a=i,n=r)),t(a,n)},t}(s),i=function(){function e(){}return e.prototype.name="local",e.prototype.kind="store",e.prototype.displayName="\u672c\u5730\u6587\u4ef6\u7cfb\u7edf",e.prototype.platform="client",e.prototype.icon="inbox",e.prototype.logo="img/avatar_d_white_bg_256x256.png",e.prototype.description="\u4f7f\u7528\u672c\u5730\u6587\u4ef6\u7cfb\u7edf\u4e0b\u7684\u6587\u4ef6",e.prototype.production=!0,e.prototype.storePluginModel=null,e.prototype.init=function(e){var t,n;if(this.fs=require("fs"),this.writefile=require("write"),this.mime=require("mime"),e){if(this.storePluginModel=e,"string"==typeof(n=e.get("extraInfo")))try{n=JSON.parse(n)}catch(e){t=e,console.log(t)}return this.path=n.path,this.storePluginModel=e}},e.prototype.getDisplayName=function(){var e;return this.storePluginModel&&(e=this.storePluginModel.get("displayName")),e||this.displayName},e.prototype.authenticate=function(e){var t,n,r,i;return n=$('<div class="ui modal small">\n  <div class="header">\u9009\u62e9\u4e00\u4e2a\u6587\u4ef6\u5939\u4f5c\u4e3a\u5165\u53e3</div>\n  <div class="content">\n    <div class="ui breadcrumb">\n\n    </div>\n    <div class="file_explore">\n    <input type="file" nwdirectory>\n    </div>\n  </div>\n  <div class="actions">\n    <div class="ui negative button">\n      \u53d6\u6d88\n    </div>\n    <div class="ui positive right labeled icon button">\n      \u786e\u5b9a  \n      <i class="check icon"></i>\n    </div>\n  </div>\n</div>'),t=n.find(".content .breadcrumb"),(r=n.find("input[type=file]")).on("change",(i=this,function(){return i.path=r.val(),t.text(i.path)})),n.modal({allowMultiple:!0,closable:!1,onHidden:function(){return n.modal("destroy"),n.remove()},onApprove:function(t){return function(){return t.path.lastIndexOf("/")===t.path.length-1&&(t.path=t.path.substring(0,t.path.length(-1))),e(null,t.path,null,{path:t.path}),!0}}(this)}),n.modal("show")},e.prototype.setting=function(){var e,t,n,r,i,o,a,s;if(o=this.storePluginModel){r=o.get("extraInfo")||{};try{r=JSON.parse(r)}catch(e){n=e,console.log(n)}return s=(a=!!r.useLocalResource)?'checked="checked"':"",t=o.get("displayName"),i=this.icon?"<i class='large icon "+this.icon+"'></i>":"",(e=$('<div class="ui small modal">\n  <div class="header">'+i+t+' \u914d\u7f6e</div>\n  <div class="content">\n    <div class="inline field">\n      <label for="useLocalResource" >\u4f7f\u7528\u5168\u5c40\u8d44\u6e90\u67e5\u627e\u7b56\u7565</label>\n      <input type="checkbox" name="useLocalResource" '+s+'>\n    </div>\n\n  </div>\n  <div class="actions">\n    <div class="ui basic cancel right button">\n      \u53d6\u6d88\n    </div>\n    <div class="ui basic positive right button">\n      \u786e\u5b9a\n    </div>\n  </div>\n</div>')).modal({allowMultiple:!0,closable:!1,onApprove:function(){var t;return a=e.find("input[name=useLocalResource]").is(":checked"),r.useLocalResource=a,t=JSON.stringify(r),o.set("extraInfo",t),o.save()},onHidden:function(){return e.modal("destroy"),e.remove(),e=null}}),e.modal("show")}},e.prototype.signOut=function(e){return this.path=null,e()},e.prototype.getContextMenu=function(){var e,t,n;return e=this.fs,t=this.writefile,{menu:function(e,t){return _.extend({},t,{viewInFolder:{name:"\u5728\u6587\u4ef6\u5939\u4e2d\u6253\u5f00"}})},actions:{viewInFolder:(n=this,function(e,t){var r,i,o,a;if("-1"!==e.guid)return r=e.guid,0===(a=(o=e&&e.parentPath||"")?o+"/"+r:r).indexOf("/")&&(a=a.substring(1)),"/"!==(i=require("path")).sep?nw.Shell.showItemInFolder((n.path+"/"+a).split("/").join(i.sep)):nw.Shell.showItemInFolder(n.path+"/"+a);nw.Shell.showItemInFolder(n.path)}),createFile:function(n){return function(r,i,o){var a,s,l;return(s=r&&r.parentPath||"")+""=="-1"&&(s=""),r&&r.isChild?l=s+"/"+i:r&&r.guid+""!="-1"?(s=s+"/"+r.guid,l=s+"/"+i):l=i,0===l.indexOf("/")&&(l=l.substring(1)),a=n.path+"/"+l,e.exists(a,(function(e){return e?o("\u5b58\u5728\u76f8\u540c\u7684\u6587\u4ef6\u540d"):t(a,"",(function(e){var t;return e?o(e):(r={guid:i,parentPath:s,name:i,isChild:!0,createDate:Date.now(),updateDate:Date.now(),fileType:"text",tagNames:[]},t={key:l.replace(/\//g,"_"),folder:!1,title:i,obj:r},o(null,t))}))}))}}(this),createFolder:function(t){return function(n,r,i){var o,a,s;return(a=n&&n.parentPath||"")+""=="-1"&&(a=""),n&&n.isChild?s=a+"/"+r:n&&n.guid+""!="-1"?(a=a+"/"+n.guid,s=a+"/"+r):s=r,0===s.indexOf("/")&&(s=s.substring(1)),o=t.path+"/"+s,e.exists(o,(function(t){return t?i("\u5b58\u5728\u76f8\u540c\u7684\u6587\u4ef6\u540d"):e.mkdir(o,(function(e){var t;return e?i(e):(n={guid:r,parentPath:a,name:r,isChild:!1,createDate:Date.now(),updateDate:Date.now(),fileType:"text",tagNames:[]},t={key:s.replace(/\//g,"_"),folder:!0,title:r,obj:n},i(null,t))}))}))}}(this),deleteFile:function(t){return function(n,r){var i,o,a;return i=n.guid,o=n&&n.parentPath||"",0===(a=n&&n.isChild?o+"/"+i:i).indexOf("/")&&(a=a.substring(1)),e.unlink(t.path+"/"+a,(function(e){return e?r(e):r()}))}}(this),deleteFolder:function(t){return function(n,r){var i,o;return i=n&&n.parentPath||"",0===(o=n?i+"/"+n.guid:n.guid).indexOf("/")&&(o=o.substring(1)),e.rmdir(t.path+"/"+o,(function(e){return e?r(e):r()}))}}(this),renameFile:function(t){return function(n,r,i){var o,a,s,l,u;return l=n&&n.parentPath||"",s="",n&&n.isChild||n?(u=l+"/"+r,s=l+"/"+n.guid):(u=r,s=n.guid),0===u.indexOf("/")&&(u=u.substring(1)),0===s.indexOf("/")&&(s=s.substring(1)),o=t.path+"/"+u,a=t.path+"/"+s,e.exists(o,(function(t){return t?i("\u5b58\u5728\u76f8\u540c\u7684\u6587\u4ef6\u540d"):e.rename(a,o,(function(e){var t;return e?i(e):(n={guid:r,parentPath:l,name:r,isChild:!0,createDate:Date.now(),updateDate:Date.now(),fileType:"text",tagNames:[]},t={key:u.replace(/\//g,"_"),folder:!1,title:r,obj:n},i(null,t))}))}))}}(this),renameFolder:function(t){return function(n,r,i){var o,a,s,l,u;return l=n&&n.parentPath||"",s="",n&&n.isChild||n?(u=l+"/"+r,s=l+"/"+n.guid):(u=r,s=n.guid),0===u.indexOf("/")&&(u=u.substring(1)),0===s.indexOf("/")&&(s=s.substring(1)),o=t.path+"/"+u,a=t.path+"/"+s,e.exists(o,(function(t){return t?i("\u5b58\u5728\u76f8\u540c\u7684\u6587\u4ef6\u540d"):e.rename(a,o,(function(e){var t;return e?i(e):(n={guid:r,parentPath:l,name:r,isChild:!1,createDate:Date.now(),updateDate:Date.now(),fileType:"text",tagNames:[]},t={key:u.replace(/\//g,"_"),folder:!0,title:r,obj:n},i(null,t))}))}))}}(this)}}},e.prototype.getAccountInfo=function(e){return e(null,{username:"\u672c\u5730\u6587\u4ef6\u7cfb\u7edf",displayName:"\u672c\u5730\u6587\u4ef6\u7cfb\u7edf",email:""})},e.prototype.getFileMeta=function(e,t,n){var r,i,o;return i=t.guid,r=(o=t.parentPath||"")?this.path+"/"+o:this.path,this.fs.access(r+"/"+i,(function(e){var r;return e?n(e):(r={guid:i,parentPath:t.parentPath,name:l.generateMarkdownTitle(i)},n(null,r))}))},e.prototype.getFile=function(e,t,n){var r,i,a,s,u,c;return s=t.guid,c=t.parentPath||"",r=this.fs,i=this.mime,u=this.path,a=c?this.path+"/"+c:this.path,this.fs.readFile(a+"/"+s,{encoding:"utf-8"},(function(e,c){var p;return e?n(e,c):(p=[],console.log("read file "+s+" success"),l.getResourceData(s,c,(function(e,d){return d=(d=d||[]).filter((function(e){return!/^http[s]?:\/\//i.test(e)})),async.eachSeries(d,(function(t,n){var s;return s=0===t.indexOf("/")?"/"===u?t:u+t:a+"/"+t,r.readFile(s,(function(r,a){var l,u;return console.log("read file success "+t),r?o.showMessage("\u5904\u7406\u9644\u4ef6\u51fa\u9519:"+t+",\u9519\u8bef\u539f\u56e0\uff1a"+e):(u=i.lookup(s),console.log("attachment type: "+u),console.log(t),l=new Blob([function(e){var t,n,r,i,o,a;for(t=new ArrayBuffer(e.length),a=new Uint8Array(t),r=i=0,o=e.length;i<o;r=++i)n=e[r],a[r]=n;return t}(a)],{type:u}),console.log(l),p.push({name:t,type:u,blob:l})),n()}))}),(function(e){var r;return e?o.showMessage("\u52a0\u8f7d\u9644\u4ef6\u51fa\u9519"+e):(r={guid:s,parentPath:t.parentPath,markdownContent:c,resources:p,htmlContent:c,tagNames:[],name:l.generateMarkdownTitle(s)},n(e,r))}))})))}))},e.prototype.watchPath=function(e){var t,n,r,i;return i=e.parentPath,n=e.guid,t=i?this.path+"/"+i:this.path,"/"!==(r=require("path")).sep?(t+"/"+n).split("/").join(r.sep):t+"/"+n},e.prototype.listFiles=function(e,t,n){var r,i,o;return i=t.parentPath||"",r=i?this.path+"/"+i:this.path,this.fs.readdir(r,(o=this,function(e,a){var s,u,c,p,d,f,h,m,v,g,y;if(e)return n(e);for(v=[],p=0,d=a.length;p<d;p++){s=a[p],c=l.checkIsSupportFileType(s)?"text":"application";try{y=o.fs.statSync(r+"/"+s)}catch(e){u=e,console.log(u)}if(!y)break;0===(h=i+"/"+s).indexOf("/")&&(h=h.substring(1)),f={guid:s,parentPath:t.parentPath,name:s,isChild:y.isFile(),createDate:y.ctime,updateDate:y.mtime,fileType:c,tagNames:[]},m={key:h.replace(/\//g,"_"),folder:y.isDirectory(),title:s,lazy:y.isDirectory(),obj:f},v.push(m)}return g=_.sortBy(v,(function(e){return(e.folder?"A":"B")+e.title})),n(null,g)}))},e.prototype.saveAttach=function(e,t,n,r,i,a,s){var u,c,p,d,f,h;if(h=t.get("pluginName"),d=t.get("guid"),f=t.get("parentPath"),!d)return"function"==typeof s?s():void 0;if(h!==this.name)return"function"==typeof s?s():void 0;0===n.indexOf("./")&&(n=n.substring(2));try{n=decodeURI(n)}catch(e){c=e,console.log(c)}return this.fs,u=this.writefile,p=f?this.path+"/"+f:this.path,l.objectURLToArrayBuffer(i,(function(e,t){var r;return e?o.showMessage("\u4fdd\u5b58\u9644\u4ef6\u5931\u8d253: "+n+", "+e,6e3,"error"):(r=l.arrayBufferToNodeBuffer(t),u(p+"/"+n,r,(function(e){if(e)return o.showMessage("\u4fdd\u5b58\u9644\u4ef6\u5931\u8d254: "+n+", "+e,6e3,"error")})))}))},e.prototype.saveFile=function(e,t,n,i){var s,u,c,p,d,f,h,m;return p=t.get("pluginName"),u=t.get("guid"),c=t.get("parentPath"),h=t.get("title")||"\u672a\u547d\u540d\u6587\u4ef6.md",p!==this.name&&(u="",p="",c=""),d=n.saveAs||!1,f=n.saveAttachment||!1,m=this,s=function(e,n,a){var s,u,c,p,d,v;return o.showHandling("\u4fdd\u5b58\u4e2d..."),d=setTimeout((function(){return o.hideHandling()}),r.getNetworkResourceTimeout),h.lastIndexOf(".")<0&&(h+=".md"),u=t.get("content")||"",v=Date.now(),m.fs,s=m.writefile,p=m.path,c=e?m.path+"/"+e:m.path,s(c+"/"+n,(" "+u).substring(1),(function(r){var h;return r?(o.hideHandling(),i(r)):(h={guid:n,parentPath:e,fullPath:c+"/"+n,name:n,tagNames:[],createDate:v,updateDate:v,isChild:!0},a||f?l.getResourceData("default.md",u,(function(e,n){return e?(o.showMessage("\u4fdd\u5b58\u9644\u4ef6\u5931\u8d25",6e3,"error"),i(null,h)):(n=n.filter((function(e){return!/^http[s]?:\/\//i.test(e)})),async.eachSeries(n,(function(e,n){var r;try{e=decodeURI(e)}catch(e){r=e,console.log(r)}return t.getAttachObjectByFilename(e,(function(t,r){var i;return r&&(i=r.objectUrl)?l.objectURLToArrayBuffer(i,(function(t,r){var i,a;return t?(o.showMessage("\u4fdd\u5b58\u9644\u4ef6\u5931\u8d251: "+e+", "+t,6e3,"error"),n()):(a=l.arrayBufferToNodeBuffer(r),i=0===e.indexOf("/")?"/"===p?e:p+e:c+"/"+e,s(i,a,(function(t){return t&&o.showMessage("\u4fdd\u5b58\u9644\u4ef6\u5931\u8d252: "+e+", "+t,6e3,"error"),n()})))})):n()}))}),(function(e){return clearTimeout(d),d=null,o.hideHandling(),i(null,h,m)})))})):(o.hideHandling(),i(null,h,m)))}))},!u||d?new a({plugin:this,saveAs:d,saveAsCallback:i,fileModel:t}).show((function(e,t){return s(e,t,!0)})):s(c,u,!1)},e}(),n.exports=i}}),window.requirejs.define({"plugins/oschina/index":function(e,t,n){var r,i;r=t("./oschina_public_dialog_view"),i=function(){function e(){}return e.prototype.name="oschinaBlog",e.prototype.displayName="OSChina\u535a\u5ba2",e.prototype.kind="public",e.prototype.description="\u5c06\u5f53\u524d\u6587\u7ae0\u53d1\u5e03\u5230oschina\u535a\u5ba2\u4e0a",e.prototype.publicFile=function(e){return new r({model:e}).show()},e}(),n.exports=i}}),window.requirejs.define({"plugins/oschina/oschina_public_dialog_view":function(e,t,n){var r,i,o,a={}.hasOwnProperty;i=t("../../views/view"),o=t("./oschina_public_dialog"),r=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)a.call(t,n)&&(e[n]=t[n]);function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype}(t,e),t.prototype.template=o,t.prototype.className="ui small modal",t.prototype.show=function(){var e,t;return this.render(),this.dimmer=this.$el.find(".content").dimmer({closable:!1}),this.$el.find(".dimmer").html('<div class="ui indeterminate text loader">\u63d0\u4ea4\u4e2d...</div>'),(e=this.$el.find(".ui.form")).form({username:{identifier:"username",rules:[{type:"empty",prompt:"\u7528\u6237\u540d\u4e0d\u80fd\u4e3a\u7a7a"}]},password:{identifier:"password",rules:[{type:"empty",prompt:"\u5bc6\u7801\u4e0d\u80fd\u4e3a\u7a7a"}]}},{onSuccess:(t=this,function(){return t.dimmer.dimmer("show")})}),this.$el.modal({allowMultiple:!0,closable:!1,onHidden:function(e){return function(){return e.remove()}}(this),onApprove:function(){return e.form("validate form"),!1}}).modal("show")},t}(i),n.exports=r}}),window.requirejs.define({"plugins/qiniu/index":function(e,t,n){var r,i,o,a;r=t("../../lib/notifier"),o=t("../../lib/utils"),t("../../constant");var s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_";new Array(-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1);var l=function(e){return e=(e=e.replace(/\+/g,"-")).replace(/\//g,"_")},u=function(e,t,n){var r=JSON.stringify(n);console&&console.log("put_policy = ",r);var i=function(e){var t,n,r,i,o,a;for(r=e.length,n=0,t="";n<r;){if(i=255&e.charCodeAt(n++),n==r){t+=s.charAt(i>>2),t+=s.charAt((3&i)<<4),t+="==";break}if(o=e.charCodeAt(n++),n==r){t+=s.charAt(i>>2),t+=s.charAt((3&i)<<4|(240&o)>>4),t+=s.charAt((15&o)<<2),t+="=";break}a=e.charCodeAt(n++),t+=s.charAt(i>>2),t+=s.charAt((3&i)<<4|(240&o)>>4),t+=s.charAt((15&o)<<2|(192&a)>>6),t+=s.charAt(63&a)}return t}(function(e){var t,n,r,i;for(t="",r=e.length,n=0;n<r;n++)(i=e.charCodeAt(n))>=1&&i<=127?t+=e.charAt(n):i>2047?(t+=String.fromCharCode(224|i>>12&15),t+=String.fromCharCode(128|i>>6&63),t+=String.fromCharCode(128|i>>0&63)):(t+=String.fromCharCode(192|i>>6&31),t+=String.fromCharCode(128|i>>0&63));return t}(r));console&&console.log("encoded = ",i);var o=CryptoJS.HmacSHA1(i,t).toString(CryptoJS.enc.Base64);console&&console.log("encoded_signed=",o);var a=e+":"+l(o)+":"+i;return console&&console.log("upload_token=",a),a};a=function(e){var t,n,r;return n="",-1!==(r=(t=new String(e).substring(e.lastIndexOf("/")+1)).lastIndexOf("."))&&(n=t.substring(r),t=t.substring(0,r)),{base:t,ext:n}},i=function(){function e(){}return e.prototype.name="qiniu",e.prototype.kind="resource",e.prototype.displayName="\u4e03\u725b\u4e91\u5b58\u50a8",e.prototype.description="\u4f7f\u7528\u4e03\u725b\u4e91\u505a\u4e3a\u56fe\u5e8a",e.prototype.icon="qiniu",e.prototype.logo="img/qiniu.png",e.prototype.production=!0,e.prototype.storePluginModel=null,e.prototype.init=function(e){var t,n;if(e){if("string"==typeof(n=e.get("extraInfo")))try{n=JSON.parse(n)}catch(e){t=e,console.log(t)}return this.extraInfo=n||{},this.accessKey=e.get("entryToken"),this.secretKey=e.get("entryTokenSecret"),this.bucketName=n.bucketName,this.fileName=n.fileName||"{{filename}}",this.urlPrefix=n.urlPrefix,this.uploadEntry=n.uploadEntry,this.storePluginModel=e}},e.prototype.authenticate=function(e){var t,n,r;return this.extraInfo={},t=$('<div class="ui small modal story_modal">\n  <div class="header">\u8bf7\u8f93\u5165\u6709\u6548\u7684 AccessKey,SecretKey \u5b8c\u6210\u8ba4\u8bc1</div>\n  <div class="content story_content">\n    <div class="ui form">\n      <div class="field">\n        <label for="displayName">\u8bf7\u8f93\u5165\u4e00\u4e2a\u81ea\u5b9a\u4e49\u540d\u79f0</label>\n        <div class="ui fluid input">\n          <input type="text" name="displayName" placeholder="" value="\u4e03\u725b\u4e91\u5b58\u50a8">\n        </div>\n      </div>\n      <div class="field">\n        <label for="uploadEntry">\u4e0a\u4f20\u5165\u53e3</label>\n        <div class="ui fluid input">\n          <select name="uploadEntry">\n            <option value="http://up.qiniu.com">http://up.qiniu.com(\u534e\u4e1c)</option>\n            <option value="http://upload.qiniu.com">http://upload.qiniu.com(\u534e\u4e1c)</option>\n            <option value="http://up.qiniup.com" selected="selected">http://up.qiniup.com(\u534e\u4e1c)</option>\n            <option value="http://upload.qiniup.com">http://upload.qiniup.com(\u534e\u4e1c)</option>\n            <option value="https://up.qbox.me">https://up.qbox.me(\u534e\u4e1c)</option>\n            <option value="http://up-z1.qiniu.com">http://up-z1.qiniu.com(\u534e\u5317)</option>\n            <option value="http://up-z1.qiniup.com">http://up-z1.qiniup.com(\u534e\u5317)</option>\n            <option value="http://upload-z1.qiniup.com">http://upload-z1.qiniup.com(\u534e\u5317)</option>\n            <option value="https://up-z1.qbox.me">https://up-z1.qbox.me(\u534e\u5317)</option>\n            <option value="http://up-z2.qiniu.com">http://up-z2.qiniu.com(\u534e\u5357)</option>\n            <option value="http://up-z2.qiniup.com">http://up-z2.qiniup.com(\u534e\u5357)</option>\n            <option value="http://upload-z2.qiniup.com">http://upload-z2.qiniup.com(\u534e\u5357)</option>\n            <option value="https://up-z2.qbox.me">https://up-z2.qbox.me(\u534e\u5357)</option>\n            <option value="http://up-na0.qiniu.com">http://up-na0.qiniu.com(\u5317\u7f8e)</option>\n            <option value="http://up-na0.qiniup.com">http://up-na0.qiniup.com(\u5317\u7f8e)</option>\n            <option value="http://upload-na0.qiniup.com">http://upload-na0.qiniup.com(\u5317\u7f8e)</option>\n            <option value="https://up-na0.qbox.me">https://up-na0.qbox.me(\u5317\u7f8e)</option>\n            <option value="http://upload-as0.qiniup.com">http://upload-as0.qiniup.com(\u4e1c\u5357\u4e9a)</option>\n            <option value="http://up-as0.qiniup.com">http://up-as0.qiniup.com(\u4e1c\u5357\u4e9a)</option>\n          </select>\n        </div>\n        <div class="ui fluid input" style="margin-top: 10px;">\n          <input type="text" name="uploadEntryInput" placeholder="http://xxxx.xxx.xxx" value="">\n        </div>\n      </div>\n      <div class="field">\n        <label for="accessKey">\u8bf7\u8f93\u5165\u4e00\u4e2a\u6709\u6548\u7684AccessKey \u503c</label>\n        <div class="ui fluid input">\n          <input type="text" name="accessKey" placeholder="" value="">\n        </div>\n      </div>\n      <div class="field">\n        <label for="secretKey">\u8bf7\u8f93\u5165\u4e00\u4e2a\u6709\u6548\u7684SecretKey \u503c</label>\n        <div class="ui fluid input">\n          <input type="text" name="secretKey" placeholder="" value="">\n        </div>\n      </div>\n      <div class="field">\n        <label for="bucketName">\u8bf7\u8f93\u5165\u4e00\u4e2a\u6709\u6548\u7684\u7a7a\u95f4\u540d\u79f0(Bucket Name)</label>\n        <div class="ui fluid input">\n          <input type="text" name="bucketName" placeholder="" value="">\n        </div>\n      </div>\n      <div class="field">\n        <label for="fileName">\u6587\u4ef6\u540d\u79f0\u751f\u6210\u89c4\u5219</label>\n        <div class="ui fluid input">\n          <input type="text" name="fileName" placeholder="/folder/{{year}}/{{month}}/{{date}}/{{filename}}" value="/\u5c0f\u4e66\u5320/{{filename}}">\n        </div>\n        <div class="ui pointing label">\u652f\u6301\u53d8\u91cf year, month, date, title, filename, basename, extname, md5</div>\n      </div>\n      <div class="field">\n        <label for="urlPrefix">\u56fe\u7247 URL \u524d\u7f00</label>\n        <div class="ui fluid input">\n          <input type="text" name="urlPrefix" placeholder="http://xxxxx.xxx/" value="">\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class="actions">\n    <div class="tips">\n    </div>\n    <div class="ui cancel button">\n      \u53d6\u6d88\n    </div>\n    <div class="ui positive button">\n      \u786e\u5b9a  \n    </div>\n  </div>\n</div>'),(n=t.find(".ui.form")).form({fields:{urlPrefix:{identifier:"urlPrefix",rules:[{type:"empty",prompt:"url\u524d\u7f00\u4e0d\u80fd\u4e3a\u7a7a"}]},accessKey:{identifier:"accessKey",rules:[{type:"empty",prompt:"accessKey \u4e0d\u80fd\u4e3a\u7a7a"}]},secretKey:{identifier:"secretKey",rules:[{type:"empty",prompt:"secretKey \u4e0d\u80fd\u4e3a\u7a7a"}]},bucketName:{identifier:"bucketName",rules:[{type:"empty",prompt:"bucketName \u4e0d\u80fd\u4e3a\u7a7a"}]}},onSuccess:(r=this,function(){var n,i,o,a,s,l,u,c,p;return r.dimmer.dimmer("show"),n=r.dimmer,s=t.find("input[name=displayName]").val().trim(),o=t.find("input[name=accessKey]").val().trim(),u=t.find("input[name=secretKey]").val().trim(),p=t.find("input[name=urlPrefix]").val().trim(),i=t.find("input[name=uploadEntryInput]"),(c=$.trim(i.val()))||(c=t.find("select[name=uploadEntry]>option:selected").val().trim()),"/"!==p[p.length-1]&&(p+="/"),a=t.find("input[name=bucketName]").val().trim(),l=t.find("input[name=fileName]").val().trim(),s=s||"\u4e03\u725b\u4e91\u5b58\u50a8",r.extraInfo.displayName=s,r.extraInfo.bucketName=a,r.extraInfo.fileName=l||"{{filename}}",r.extraInfo.urlPrefix=p,r.extraInfo.uploadEntry=c,r.accessKey=o,r.secretKey=u,r.urlPrefix=p,r.bucketName=a,r.fileName=l||"{{filename}}",r.uploadEntry=c,e(null,o,u,r.extraInfo,r,(function(e){if(n.dimmer("hide"),!e)return t.modal("hide")}))})}),this.dimmer=t.find(".content").dimmer({closable:!1}),t.find(".dimmer").html('<div class="ui indeterminate text loader">\u6821\u9a8c\u4e2d...</div>'),t.on("change","select[name=uploadEntry]",(function(e){var n;return n=t.find("select[name=uploadEntry]>option:selected").val().trim(),t.find("input[name=uploadEntryInput]").val(n)})),t.modal({closable:!1,allowMultiple:!0,onHidden:function(){return n.form("destroy"),t.modal("destroy"),t.remove()},onApprove:function(){return n.form("validate form"),!1}}).modal("show")},e.prototype.signOut=function(e){return e()},e.prototype.getAccountInfo=function(e){var t;return t=o.dataURL2Blob("data:image/png;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"),this.saveFile(this.extraInfo,"/\u5c0f\u4e66\u5320\u9a8c\u8bc1\u6587\u4ef6.png",t,{},(function(t,n,i,o){return t?(r.showMessage("\u7ed1\u5b9a\u8ba4\u8bc1\u5931\u8d25:"+t,6e3,"error"),e("\u7ed1\u5b9a\u8ba4\u8bc1\u5931\u8d25:"+t)):e(null,{shardId:"",username:"",email:""})}))},e.prototype.saveFile=function(e,t,n,r,i){return null==t&&(t=""),null==r&&(r={}),o.blobToArrayBuffer(n,(a=this,function(o,s){var l,u;return s&&((u=new SparkMD5.ArrayBuffer).append(s),l=u.end(),r.fileDataArrayBuffer=s,r.md5=l),a._saveFile(e,t,n,r,i)}));var a},e.prototype._saveFile=function(e,t,n,i,o){var s,c,p,d,f,h,m,v,g,y,b,x,w,k,A;if(null==t&&(t=""),null==i&&(i={}),b=this.bucketName,m=this.fileName,d=i.fileModel,p=i.md5,x="\u5c0f\u4e66\u5320",d&&(x=d.get("title")||x),x=x.replace(/[\/\s]/g,"_"),m&&!t.startsWith("/")){h=_.template(m,{interpolate:/\{\{(.+?)\}\}/g}),f=a(t);try{t=h({filename:t,basename:f.base,extname:f.ext,md5:p,year:(new Date).getFullYear().toString(),month:((new Date).getMonth()+1).toString(),date:(new Date).getDate().toString(),title:x})}catch(e){return s=e,console.error(s),void o(s)}}return(t=(t=t.replace(/^\/*/,"")).replace(/\s/g,"_"))&&(b=b+":"+t),g={hash:"${etag}",key:"${key}",w:"${imageInfo.width}",h:"${imageInfo.height}",fname:"${fname}",fsize:"${fsize}"},y=l(JSON.stringify(g)),1,v={scope:b,deadline:Math.round((new Date).getTime()/1e3)+3600,returnBody:y},w=u(this.accessKey,this.secretKey,v),(c=new FormData).append("file",n),c.append("key",t),c.append("token",w),A=this.urlPrefix,k=this.uploadEntry,$.ajax({type:"POST",url:k||"http://upload.qiniup.com/",data:c,processData:!1,contentType:!1}).done((function(e){return!e||e.error?(r.showMessage("\u4e0a\u4f20\u8d44\u6e90\u5931\u8d25:"+e.error+"\u300b"+t,6e3,"error"),"function"==typeof o?o("\u4e0a\u4f20\u8d44\u6e90\u5931\u8d25:"+e.error+"\u300b"+t):void 0):"function"==typeof o?o(null,t,A+e.key,e):void 0})).fail((function(e,t,n){var i;return(i=e.responseJSON)&&(n=i.error),r.showMessage("\u4e0a\u4f20\u8d44\u6e90\u5931\u8d25:"+n,6e3,"error"),"function"==typeof o?o("\u4e0a\u4f20\u8d44\u6e90\u5931\u8d25:"+n):void 0}))},e}(),n.exports=i}}),window.requirejs.define({"plugins/smms/index":function(e,t,n){var r,i;r=t("../../lib/notifier"),t("../../lib/utils"),t("../../constant"),i=function(){function e(){}return e.prototype.name="smms",e.prototype.kind="resource",e.prototype.displayName="sm.ms",e.prototype.description="https://sm.ms",e.prototype.icon="hand paper",e.prototype.logo="",e.prototype.production=!0,e.prototype.storePluginModel=null,e.prototype.init=function(e){var t,n;if(e){if("string"==typeof(n=e.get("extraInfo")))try{n=JSON.parse(n)}catch(e){t=e,console.log(t)}return this.extraInfo=n||{},this.storePluginModel=e}},e.prototype.authenticate=function(e){return this.extraInfo={displayName:"smms \u5b58\u50a8"},e(null,"sm.ms",null,this.extraInfo,this,(function(){}))},e.prototype.signOut=function(e){return e()},e.prototype.getAccountInfo=function(e){return e(null,{username:"sm.ms"})},e.prototype.saveFile=function(e,t,n,i,o){var a;return(a=new FormData).append("smfile",n),$.ajax({type:"POST",url:"https://sm.ms/api/upload",data:a,processData:!1,contentType:!1}).done((function(e){var n;try{e=JSON.parse(e)}catch(e){e}return e&&"error"!==e.code&&"exception"!==e.code?"function"==typeof o?o(null,t,e.data.url,e.data):void 0:(n=e.msg||e.message,r.showMessage("\u4e0a\u4f20\u8d44\u6e90\u5931\u8d25:"+n+"\u300b"+t,6e3,"error"),"function"==typeof o?o("\u4e0a\u4f20\u8d44\u6e90\u5931\u8d25:"+n+"\u300b"+t):void 0)})).fail((function(e,t,n){return r.showMessage("\u4e0a\u4f20\u8d44\u6e90\u5931\u8d25:"+n,6e3,"error"),"function"==typeof o?o("\u4e0a\u4f20\u8d44\u6e90\u5931\u8d25:"+n):void 0}))},e}(),n.exports=i}}),window.requirejs.define({"plugins/smmsv2/index":function(e,t,n){var r,i,o;r=t("../../lib/notifier"),o=t("../../lib/utils"),t("../../constant"),i=function(){function e(){}return e.prototype.name="smmsv2",e.prototype.kind="resource",e.prototype.displayName="sm.ms v2",e.prototype.description="https://sm.ms",e.prototype.icon="hand paper",e.prototype.logo="",e.prototype.production=!0,e.prototype.storePluginModel=null,e.prototype.init=function(e){var t,n;if(e){if("string"==typeof(n=e.get("extraInfo")))try{n=JSON.parse(n)}catch(e){t=e,console.log(t)}return this.accessKey=e.get("entryToken"),this.extraInfo=n||{},this.storePluginModel=e}},e.prototype.authenticate=function(e){return this.extraInfo={displayName:"smms v2 \u5b58\u50a8"},e(null,"sm.ms",null,this.extraInfo,this,(function(){}))},e.prototype.authenticate=function(e){var t,n,i,a;return i={},"",t=$('<div class="ui small modal story_modal">\n  <div class="header">\u8bf7\u8f93\u5165\u6709\u6548\u7684Secret Token</div>\n  <div class="content story_content">\n    <div class="ui form">\n      <div class="field">\n        <label>\u8bf7\u8f93\u5165\u4e00\u4e2a\u6709\u6548\u7684 Secret Token \u503c</label>\n        <div class="ui fluid icon input">\n          <input type="text" name="token" placeholder="" value="">\n          <i class="linkify icon"></i>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class="actions">\n    <div class="tips">\n        <div>\u6ce8\uff1a</div>\n        <div>1.\u7533\u8bf7token\u5730\u5740\uff1a<a href="https://sm.ms/home/apitoken" target="_blank">token</a>\n        </div>\n    </div>\n    <div class="ui basic cancel button">\n      \u53d6\u6d88\n    </div>\n    <div class="ui basic positive button">\n      \u786e\u5b9a  \n    </div>\n  </div>\n</div>'),(n=t.find(".ui.form")).form({fields:{token:{identifier:"token",rules:[{type:"empty",prompt:"\u8bf7\u8f93\u5165\u4e00\u4e2a\u6709\u6548\u7684token"}]}},onSuccess:(a=this,function(){var n,s;return(s=a).dimmer.dimmer("show"),n=t.find("input[name=token]").val().trim(),a.accessKey=n,s.getAccountInfo((function(a,l){var u,c;return a?(r.showMessage("\u68c0\u6d4b\u5931\u8d25\uff0c\u68c0\u6d4b\u7528\u6237\u540d\u5931\u8d25",6e3,"error"),s.dimmer.dimmer("hide")):(c=l.username,i.username=c,s.extraInfo=i,s.username=c,u=o.dataURL2Blob("data:image/png;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"),s.saveFile(s.extraInfo,"/\u5c0f\u4e66\u5320\u9a8c\u8bc1\u6587\u4ef6.png",u,{},(function(o,a,l,u){return o?(r.showMessage("\u68c0\u6d4b\u5931\u8d25\uff0c\u65e0\u6cd5\u4e0a\u4f20\u6d4b\u8bd5\u56fe\u7247",6e3,"error"),s.dimmer.dimmer("hide")):(u&&u.delete&&$.get(u.delete,(function(){return console.log("delete test png success.")})),e(null,n,"",i,s),s.dimmer.dimmer("hide"),t.modal("hide"),s=null)})))}))})}),this.dimmer=t.find(".content").dimmer({closable:!1}),t.find(".dimmer").html('<div class="ui indeterminate text loader">\u6821\u9a8c\u4e2d...</div>'),t.modal({closable:!1,allowMultiple:!0,onHidden:function(){return t.remove(),t=null},onApprove:function(){return n.form("validate form"),!1}}).modal("show")},e.prototype.signOut=function(e){return e()},e.prototype.getAccountInfo=function(e){return e(null,{username:"sm.ms"})},e.prototype.saveFile=function(e,t,n,i,o){var a,s;return a=new FormData,n instanceof Blob&&(n=new File([n],t||"\u672a\u547d\u4ee4\u6587\u4ef6.png")),a.append("smfile",n),a.append("ssl",!0),s="https://sm.ms/api/v2/upload","web"===STORY_PLATFORM&&(s="/smmsv2/proxy"),$.ajax({type:"POST",url:s,headers:{Authorization:this.accessKey},data:a,processData:!1,contentType:!1}).done((function(e){var n;try{e=JSON.parse(e)}catch(e){e}return e&&e.success&&"error"!==e.code&&"exception"!==e.code?"function"==typeof o?o(null,t,e.data.url,e.data):void 0:(n=e.msg||e.message||"").indexOf("this image exists at")>-1?o(null,t,n.substring(n.indexOf("https://")),e):(r.showMessage("\u4e0a\u4f20\u8d44\u6e90\u5931\u8d25:"+n+"\u300b"+t,6e3,"error"),"function"==typeof o?o("\u4e0a\u4f20\u8d44\u6e90\u5931\u8d25:"+n+"\u300b"+t):void 0)})).fail((function(e,t,n){return r.showMessage("\u4e0a\u4f20\u8d44\u6e90\u5931\u8d25:"+n,6e3,"error"),"function"==typeof o?o("\u4e0a\u4f20\u8d44\u6e90\u5931\u8d25:"+n):void 0}))},e}(),n.exports=i}}),window.requirejs.define({"plugins/tencentoss/index":function(e,t,n){var r,i,o,a;r=t("../../lib/notifier"),o=t("../../lib/utils"),t("../../constant"),a=function(e){var t,n,r;return n="",-1!==(r=(t=new String(e).substring(e.lastIndexOf("/")+1)).lastIndexOf("."))&&(n=t.substring(r),t=t.substring(0,r)),{base:t,ext:n}},i=function(){function e(){}return e.prototype.name="tencentoss",e.prototype.kind="resource",e.prototype.displayName="\u817e\u8fc5\u4e91oss\u5b58\u50a8(v4 api \u7248\u672c)",e.prototype.description="\u4f7f\u7528\u817e\u8fc5\u4e91oss\u505a\u4e3a\u56fe\u5e8a, \u4f7f\u7528\u7684\u662f\u817e\u8fc5\u4e91 v4 \u7248\u672c\u7684 api",e.prototype.icon="qq",e.prototype.logo="img/qq.png",e.prototype.production=!0,e.prototype.storePluginModel=null,e.prototype.init=function(e){var t,n;if(e){if("string"==typeof(n=e.get("extraInfo")))try{n=JSON.parse(n)}catch(e){t=e,console.log(t)}return this.extraInfo=n||{},this.accessKey=e.get("entryToken"),this.secretKey=e.get("entryTokenSecret"),this.fileName=n.fileName||"{{filename}}",this.urlPrefix=n.urlPrefix,this.uploadEntry=n.uploadEntry,this.bucketName=n.bucketName,this.region=n.region,this.storePluginModel=e}},e.prototype.authenticate=function(e){var t,n,r;return this.extraInfo={},t=$('<div class="ui small modal story_modal">\n  <div class="header">\u8bf7\u8f93\u5165\u6709\u6548\u7684 SecretId,SecretKey \u7b49\u4fe1\u606f\u5b8c\u6210\u8ba4\u8bc1</div>\n  <div class="content story_content">\n    <div class="ui form">\n      <div class="field">\n        <label for="displayName">\u8bf7\u8f93\u5165\u4e00\u4e2a\u81ea\u5b9a\u4e49\u540d\u79f0</label>\n        <div class="ui fluid input">\n          <input type="text" name="displayName" placeholder="" value="\u817e\u8fc5\u4e91oss\u5b58\u50a8">\n        </div>\n      </div>\n      <div class="field">\n        <label for="uploadEntry">\u8bf7\u8f93\u5165\u4e00\u4e2a\u6709\u6548\u7684appId</label>\n        <div class="ui fluid input">\n          <input type="text" name="uploadEntry" placeholder="" value="">\n        </div>\n      </div>\n      <div class="field">\n        <label for="accessKey">\u8bf7\u8f93\u5165\u4e00\u4e2a\u6709\u6548\u7684SecretId \u503c</label>\n        <div class="ui fluid input">\n          <input type="text" name="accessKey" placeholder="" value="">\n        </div>\n      </div>\n      <div class="field">\n        <label for="secretKey">\u8bf7\u8f93\u5165\u4e00\u4e2a\u6709\u6548\u7684SecretKey \u503c</label>\n        <div class="ui fluid input">\n          <input type="text" name="secretKey" placeholder="" value="">\n        </div>\n      </div>\n      <div class="field">\n        <label for="bucketName">\u8bf7\u8f93\u5165\u4e00\u4e2a\u6709\u6548\u7684\u7a7a\u95f4\u540d\u79f0(Bucket Name)</label>\n        <div class="ui fluid input">\n          <input type="text" name="bucketName" placeholder="" value="">\n        </div>\n      </div>\n      <div class="field">\n        <label for="region">\u5730\u57df(<a href="https://cloud.tencent.com/document/product/436/7777" target="_blank">\u53ef\u7528\u5730\u57df</a>)</label>\n        <div class="ui fluid input">\n          <input type="text" name="region" placeholder="sh" value="">\n        </div>\n      </div>\n      <div class="field">\n        <label for="fileName">\u6587\u4ef6\u540d\u79f0\u751f\u6210\u89c4\u5219</label>\n        <div class="ui fluid input">\n          <input type="text" name="fileName" placeholder="/folder/{{year}}/{{month}}/{{date}}/{{filename}}" value="/\u5c0f\u4e66\u5320/{{filename}}">\n        </div>\n        <div class="ui pointing label">\u652f\u6301\u53d8\u91cf year, month, date, title, filename, basename, extname, md5</div>\n      </div>\n      <div class="field">\n        <label for="urlPrefix">\u56fe\u7247 URL \u524d\u7f00</label>\n        <div class="ui fluid input">\n          <input type="text" name="urlPrefix" placeholder="http://xxxxx.xxx/" value="">\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class="actions">\n    <div class="tips">\n    </div>\n    <div class="ui cancel button">\n      \u53d6\u6d88\n    </div>\n    <div class="ui positive button">\n      \u786e\u5b9a  \n    </div>\n  </div>\n</div>'),(n=t.find(".ui.form")).form({fields:{uploadEntry:{identifier:"uploadEntry",rules:[{type:"empty",prompt:"appid\u4e0d\u80fd\u4e3a\u7a7a"}]},accessKey:{identifier:"accessKey",rules:[{type:"empty",prompt:"secretId \u4e0d\u80fd\u4e3a\u7a7a"}]},secretKey:{identifier:"secretKey",rules:[{type:"empty",prompt:"secretKey \u4e0d\u80fd\u4e3a\u7a7a"}]},bucketName:{identifier:"bucketName",rules:[{type:"empty",prompt:"bucketName \u4e0d\u80fd\u4e3a\u7a7a"}]}},onSuccess:(r=this,function(){var n,i,o,a,s,l,u,c,p;return r.dimmer.dimmer("show"),n=r.dimmer,a=t.find("input[name=displayName]").val().trim(),i=t.find("input[name=accessKey]").val().trim(),u=t.find("input[name=secretKey]").val().trim(),o=t.find("input[name=bucketName]").val().trim(),l=t.find("input[name=region]").val().trim()||"sh",s=t.find("input[name=fileName]").val().trim(),p=t.find("input[name=urlPrefix]").val().trim(),c=t.find("input[name=uploadEntry]").val().trim(),a=a||"\u817e\u8fc5\u4e91\u5b58\u50a8",r.extraInfo.displayName=a,r.extraInfo.urlPrefix=p,r.extraInfo.bucketName=o,r.extraInfo.region=l,r.extraInfo.uploadEntry=c,r.extraInfo.fileName=s||"{{filename}}",r.accessKey=i,r.secretKey=u,r.bucketName=o,r.region=l,r.fileName=s||"{{filename}}",r.urlPrefix=p,r.uploadEntry=c,e(null,i,u,r.extraInfo,r,(function(e){if(n.dimmer("hide"),!e)return t.modal("hide")}))})}),this.dimmer=t.find(".content").dimmer({closable:!1}),t.find(".dimmer").html('<div class="ui indeterminate text loader">\u6821\u9a8c\u4e2d...</div>'),t.modal({closable:!1,allowMultiple:!0,onHidden:function(){return n.form("destroy"),t.modal("destroy"),t.remove()},onApprove:function(){return n.form("validate form"),!1}}).modal("show")},e.prototype.signOut=function(e){return e()},e.prototype.getAccountInfo=function(e){var t;return t=o.dataURL2Blob("data:image/png;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"),this.saveFile(this.extraInfo,"/\u5c0f\u4e66\u5320\u9a8c\u8bc1.png",t,{},(function(t,n,i,o){return t?(r.showMessage("\u7ed1\u5b9a\u8ba4\u8bc1\u5931\u8d25:"+t,6e3,"error"),e("\u7ed1\u5b9a\u8ba4\u8bc1\u5931\u8d25:"+t)):e(null,{shardId:"",username:"",email:""})}))},e.prototype.saveFile=function(e,t,n,r,i){return null==t&&(t=""),null==r&&(r={}),o.blobToArrayBuffer(n,(a=this,function(o,s){var l,u;return s&&((u=new SparkMD5.ArrayBuffer).append(s),l=u.end(),r.fileDataArrayBuffer=s,r.md5=l),a._saveFile(e,t,n,r,i)}));var a},e.prototype._saveFile=function(e,t,n,i,o){var s,l,u,c,p,d,f,h,m,v,g,y,b,x,w,k,A;if(null==t&&(t=""),null==i&&(i={}),f=this.fileName,c=i.fileModel,u=i.md5,w="\u5c0f\u4e66\u5320",c&&(w=c.get("title")||w),w=w.replace(/[\/\s]/g,"_"),f&&!t.startsWith("/")){d=_.template(f,{interpolate:/\{\{(.+?)\}\}/g}),p=a(t);try{t=d({filename:t,basename:p.base,extname:p.ext,md5:u,year:(new Date).getFullYear().toString(),month:((new Date).getMonth()+1).toString(),date:(new Date).getDate().toString(),title:w})}catch(e){return s=e,console.error(s),void o(s)}}return t=(t=t.replace(/^\/*/,"")).replace(/\s/g,"_"),m=parseInt(Math.random()*Math.pow(2,32)),s=(h=parseInt((new Date).getTime()/1e3))+60,"",b="a="+this.uploadEntry+"&k="+this.accessKey+"&e="+s+"&t="+h+"&r="+m+"&f=&b="+this.bucketName,g=CryptoJS.HmacSHA1(b,this.secretKey),x=CryptoJS.enc.Utf8.parse(b),v=g.concat(x),y=encodeURIComponent(v.toString(CryptoJS.enc.Base64)),k="https://"+this.region+".file.myqcloud.com/files/v2/"+this.uploadEntry+"/"+this.bucketName+"/"+t+"?sign="+y,(l=new FormData).append("op","upload"),l.append("fileContent",n),A=(A=this.urlPrefix).replace(/[\/]*$/,""),this.uploadEntry,$.ajax({type:"POST",url:k,data:l,processData:!1,contentType:!1}).done((function(e){var n;return 0!==e.code?(r.showMessage("\u4e0a\u4f20\u8d44\u6e90\u5931\u8d25:"+e.message+"\u300b"+t,6e3,"error"),"function"==typeof o?o("\u4e0a\u4f20\u8d44\u6e90\u5931\u8d25:"+e.message+"\u300b"+t):void 0):(n=e.data.source_url,A&&(n=A+"/"+t),"function"==typeof o?o(null,t,n,e):void 0)})).fail((function(e,t,n){var i;return(i=e.responseJSON)&&(n="errorcode: "+i.code+"errorMessage:"+i.message),r.showMessage("\u4e0a\u4f20\u8d44\u6e90\u5931\u8d25:"+n,6e3,"error"),"function"==typeof o?o("\u4e0a\u4f20\u8d44\u6e90\u5931\u8d25:"+n):void 0}))},e}(),n.exports=i}}),window.requirejs.define({"plugins/tencentossv5/index":function(e,t,n){var r,i,o,a;function s(e){return encodeURIComponent(e).replace(/!/g,"%21").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/\*/g,"%2A")}r=t("../../lib/notifier"),o=t("../../lib/utils"),t("../../constant");a=function(e){var t,n,r;return n="",-1!==(r=(t=new String(e).substring(e.lastIndexOf("/")+1)).lastIndexOf("."))&&(n=t.substring(r),t=t.substring(0,r)),{base:t,ext:n}},i=function(){function e(){}return e.prototype.name="tencentossv5",e.prototype.kind="resource",e.prototype.displayName="\u817e\u8fc5\u4e91\u5bf9\u50cf\u5b58\u50a8(v5 api \u7248\u672c)",e.prototype.description="\u4f7f\u7528\u817e\u8fc5\u4e91\u5bf9\u50cf\u5b58\u50a8\u505a\u4e3a\u56fe\u5e8a, \u4f7f\u7528\u7684\u662f\u817e\u8fc5\u4e91 v5 \u7248\u672c\u7684 api",e.prototype.icon="qq",e.prototype.logo="img/qq.png",e.prototype.production=!0,e.prototype.storePluginModel=null,e.prototype.init=function(e){var t,n;if(e){if("string"==typeof(n=e.get("extraInfo")))try{n=JSON.parse(n)}catch(e){t=e,console.log(t)}return this.extraInfo=n||{},this.accessKey=e.get("entryToken"),this.secretKey=e.get("entryTokenSecret"),this.fileName=n.fileName||"{{filename}}",this.urlPrefix=n.urlPrefix,this.bucketName=n.bucketName,this.region=n.region,this.storePluginModel=e}},e.prototype.authenticate=function(e){var t,n,r;return this.extraInfo={},t=$('<div class="ui small modal story_modal">\n  <div class="header">\u8bf7\u8f93\u5165\u6709\u6548\u7684 SecretId,SecretKey \u7b49\u4fe1\u606f\u5b8c\u6210\u8ba4\u8bc1</div>\n  <div class="content story_content">\n    <div class="ui form">\n      <div class="field">\n        <label for="displayName">\u8bf7\u8f93\u5165\u4e00\u4e2a\u81ea\u5b9a\u4e49\u540d\u79f0</label>\n        <div class="ui fluid input">\n          <input type="text" name="displayName" placeholder="" value="\u817e\u8fc5\u4e91oss\u5b58\u50a8">\n        </div>\n      </div>\n      <div class="field">\n        <label for="accessKey">\u8bf7\u8f93\u5165\u4e00\u4e2a\u6709\u6548\u7684SecretId \u503c</label>\n        <div class="ui fluid input">\n          <input type="text" name="accessKey" placeholder="" value="">\n        </div>\n      </div>\n      <div class="field">\n        <label for="secretKey">\u8bf7\u8f93\u5165\u4e00\u4e2a\u6709\u6548\u7684SecretKey \u503c</label>\n        <div class="ui fluid input">\n          <input type="text" name="secretKey" placeholder="" value="">\n        </div>\n      </div>\n      <div class="field">\n        <label for="bucketName">\u8bf7\u8f93\u5165\u4e00\u4e2a\u6709\u6548\u7684\u7a7a\u95f4\u540d\u79f0(Bucket Name)</label>\n        <div class="ui fluid input">\n          <input type="text" name="bucketName" placeholder="BucketName-APPID" value="">\n        </div>\n      </div>\n      <div class="field">\n        <label for="region">\u5730\u57df(<a href="https://cloud.tencent.com/document/product/436/6224" target="_blank">\u53ef\u7528\u5730\u57df</a>)</label>\n        <div class="ui fluid input">\n          <input type="text" name="region" placeholder="ap-shanghai" value="">\n        </div>\n      </div>\n      <div class="field">\n        <label for="fileName">\u6587\u4ef6\u540d\u79f0\u751f\u6210\u89c4\u5219</label>\n        <div class="ui fluid input">\n          <input type="text" name="fileName" placeholder="/folder/{{year}}/{{month}}/{{date}}/{{filename}}" value="/\u5c0f\u4e66\u5320/{{filename}}">\n        </div>\n        <div class="ui pointing label">\u652f\u6301\u53d8\u91cf year, month, date, title, filename, basename, extname, md5</div>\n      </div>\n      <div class="field">\n        <label for="urlPrefix">\u56fe\u7247 URL \u524d\u7f00</label>\n        <div class="ui fluid input">\n          <input type="text" name="urlPrefix" placeholder="http://xxxxx.xxx/" value="">\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class="actions">\n    <div class="tips">\n    </div>\n    <div class="ui cancel button">\n      \u53d6\u6d88\n    </div>\n    <div class="ui positive button">\n      \u786e\u5b9a  \n    </div>\n  </div>\n</div>'),(n=t.find(".ui.form")).form({fields:{accessKey:{identifier:"accessKey",rules:[{type:"empty",prompt:"secretId \u4e0d\u80fd\u4e3a\u7a7a"}]},secretKey:{identifier:"secretKey",rules:[{type:"empty",prompt:"secretKey \u4e0d\u80fd\u4e3a\u7a7a"}]},bucketName:{identifier:"bucketName",rules:[{type:"empty",prompt:"bucketName \u4e0d\u80fd\u4e3a\u7a7a"}]}},onSuccess:(r=this,function(){var n,i,o,a,s,l,u,c;return r.dimmer.dimmer("show"),n=r.dimmer,a=t.find("input[name=displayName]").val().trim(),i=t.find("input[name=accessKey]").val().trim(),u=t.find("input[name=secretKey]").val().trim(),o=t.find("input[name=bucketName]").val().trim(),l=t.find("input[name=region]").val().trim()||"ap-shanghai",s=t.find("input[name=fileName]").val().trim(),c=t.find("input[name=urlPrefix]").val().trim(),a=a||"\u817e\u8fc5\u4e91\u5b58\u50a8",r.extraInfo.displayName=a,r.extraInfo.urlPrefix=c,r.extraInfo.bucketName=o,r.extraInfo.region=l,r.extraInfo.fileName=s||"{{filename}}",r.accessKey=i,r.secretKey=u,r.bucketName=o,r.region=l,r.fileName=s||"{{filename}}",r.urlPrefix=c,e(null,i,u,r.extraInfo,r,(function(e){if(n.dimmer("hide"),!e)return t.modal("hide")}))})}),this.dimmer=t.find(".content").dimmer({closable:!1}),t.find(".dimmer").html('<div class="ui indeterminate text loader">\u6821\u9a8c\u4e2d...</div>'),t.modal({closable:!1,allowMultiple:!0,onHidden:function(){return n.form("destroy"),t.modal("destroy"),t.remove()},onApprove:function(){return n.form("validate form"),!1}}).modal("show")},e.prototype.signOut=function(e){return e()},e.prototype.getAccountInfo=function(e){var t;return t=o.dataURL2Blob("data:image/png;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"),this.saveFile(this.extraInfo,"/\u5c0f\u4e66\u5320\u9a8c\u8bc1.png",t,{},(function(t,n,i,o){return t?(r.showMessage("\u7ed1\u5b9a\u8ba4\u8bc1\u5931\u8d25:"+t,6e3,"error"),e("\u7ed1\u5b9a\u8ba4\u8bc1\u5931\u8d25:"+t)):e(null,{shardId:"",username:"",email:""})}))},e.prototype.saveFile=function(e,t,n,r,i){return null==t&&(t=""),null==r&&(r={}),o.blobToArrayBuffer(n,(a=this,function(o,s){var l,u;return s&&((u=new SparkMD5.ArrayBuffer).append(s),l=u.end(),r.fileDataArrayBuffer=s,r.md5=l),a._saveFile(e,t,n,r,i)}));var a},e.prototype._saveFile=function(e,t,n,i,o){var l,u,c,p,d,f,h,m,v,g,y,b,x,w,k,A,T,I,N,O,P,S,M,D,F,C,j,B,$,R,J,U;if(null==t&&(t=""),null==i&&(i={}),h=this.fileName,p=i.fileModel,c=i.md5,v="\u5c0f\u4e66\u5320",p&&(v=p.get("title")||v),v=v.replace(/[\/\s]/g,"_"),h&&!t.startsWith("/")){f=_.template(h,{interpolate:/\{\{(.+?)\}\}/g}),d=a(t);try{t=f({filename:t,basename:d.base,extname:d.ext,md5:c,year:(new Date).getFullYear().toString(),month:((new Date).getMonth()+1).toString(),date:(new Date).getDate().toString(),title:v})}catch(e){return u=e,console.error(u),void o(u)}}return t=(t=t.replace(/^\/*/,"")).replace(/\s/g,"_"),x={SecretId:this.accessKey,SecretKey:this.secretKey,Method:"PUT",Pathname:"/"+t},w=x.SecretId,k=x.SecretKey,A=(x.Method||"get").toLowerCase(),T=x.Query||{},I=x.Headers||{},N=x.Pathname||"/",O=x.Expires,P=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t.sort((function(e,t){return(e=e.toLowerCase())===(t=t.toLowerCase())?0:e>t?1:-1}))},S=function(e){var t,n,r,i=[],o=P(e);for(t=0;t<o.length;t++)r=void 0===e[n=o[t]]||null===e[n]?"":""+e[n],n=s(n=n.toLowerCase()),r=s(r)||"",i.push(n+"="+r);return i.join("&")},M=parseInt((new Date).getTime()/1e3)-1,F=w,C=M+";"+(D=M+(void 0===O?900:1*O||0)),j=M+";"+D,B=P(I).join(";").toLowerCase(),$=P(T).join(";").toLowerCase(),R=CryptoJS.HmacSHA1(j,k).toString(),J=[A,N,S(T),S(I),""].join("\n"),U=["sha1",C,CryptoJS.SHA1(J).toString(),""].join("\n"),l=["q-sign-algorithm=sha1","q-ak="+F,"q-sign-time="+C,"q-key-time="+j,"q-header-list="+B,"q-url-param-list="+$,"q-signature="+CryptoJS.HmacSHA1(U,R).toString()].join("&"),y=(y=this.urlPrefix).replace(/[\/]*$/,""),g="https://"+this.bucketName+".cos."+this.region+".myqcloud.com/"+s(t).replace(/%2F/,"/"),m="https://"+this.bucketName+".cos."+this.region+".myqcloud.com/"+t,(b=new XMLHttpRequest).open("PUT",g,!0),b.setRequestHeader("Authorization",l),b.onload=function(){var e;return 200===b.status||206===b.status?(y&&(m=y+"/"+t),"function"==typeof o?o(null,t,m,{}):void 0):(e="\u4e0a\u4f20\u8d44\u6e90\u5931\u8d25:"+b.status+", "+escape(b.responseText||b.response),r.showMessage(e,6e3,"error"),"function"==typeof o?o(e):void 0)},b.onerror=function(){var e;return e="\u4e0a\u4f20\u8d44\u6e90\u5931\u8d25: \u76ee\u6807\u5730\u5740\u4e0d\u53ef\u8bbf\u95ee\uff0c\u8bf7\u68c0\u6d4b\u662f\u5426\u9650\u5236\u4e86\u8de8\u57df\u8bbf\u95ee\uff0c\u6216\u8005\u8bbe\u7f6e\u7684\u4ed3\u5e93\u662f\u5426\u6b63\u786e",r.showMessage(e,6e3,"error"),"function"==typeof o?o(e):void 0},b.send(n)},e}(),n.exports=i}}),window.requirejs.define({"plugins/upyun/index":function(e,t,n){var r,i,o,a;r=t("../../lib/notifier"),o=t("../../lib/utils"),t("../../constant"),a=function(e){var t,n,r;return n="",-1!==(r=(t=new String(e).substring(e.lastIndexOf("/")+1)).lastIndexOf("."))&&(n=t.substring(r),t=t.substring(0,r)),{base:t,ext:n}},i=function(){function e(){}return e.prototype.name="upyun",e.prototype.kind="resource",e.prototype.displayName="upyun \u5b58\u50a8",e.prototype.description="\u4f7f\u7528\u53f3\u62cd\u4e91\u505a\u4e3a\u56fe\u5e8a",e.prototype.icon="upyun",e.prototype.logo="img/upyun.png",e.prototype.production=!0,e.prototype.storePluginModel=null,e.prototype.init=function(e){var t,n;if(e){if("string"==typeof(n=e.get("extraInfo")))try{n=JSON.parse(n)}catch(e){t=e,console.log(t)}return this.extraInfo=n||{},this.accessKey=e.get("entryToken"),this.secretKey=e.get("entryTokenSecret"),this.bucketName=n.bucketName,this.fileName=n.fileName||"{{filename}}",this.urlPrefix=n.urlPrefix,this.uploadEntry=n.uploadEntry,this.storePluginModel=e}},e.prototype.authenticate=function(e){var t,n,r;return this.extraInfo={},t=$('<div class="ui small modal story_modal">\n  <div class="header">\u8bf7\u8f93\u5165\u6709\u6548\u7684\u64cd\u4f5c\u5458\u7528\u6237\u540d\u548c\u5bc6\u7801\u5b8c\u6210\u8ba4\u8bc1</div>\n  <div class="content story_content">\n    <div class="ui form">\n      <div class="field">\n        <label for="displayName">\u8bf7\u8f93\u5165\u4e00\u4e2a\u81ea\u5b9a\u4e49\u540d\u79f0</label>\n        <div class="ui fluid input">\n          <input type="text" name="displayName" placeholder="" value="\u53f3\u62cd\u4e91\u5b58\u50a8">\n        </div>\n      </div>\n      <div class="field">\n        <label for="uploadEntry">\u4e0a\u4f20\u5165\u53e3</label>\n        <div class="ui fluid input">\n          <select name="uploadEntry">\n            <option value="http://v0.api.upyun.com" selected="selected">http://v0.api.upyun.com(\u667a\u80fd\u9009\u8def)</option>\n            <option value="http://v1.api.upyun.com">http://v1.api.upyun.com(\u7535\u4fe1)</option>\n            <option value="http://v2.api.upyun.com">http://v2.api.upyun.com(\u8054\u901a)</option>\n            <option value="http://v3.api.upyun.com">http://v3.api.upyun.com(\u79fb\u52a8)</option>\n          </select>\n        </div>\n      </div>\n      <div class="field">\n        <label for="accessKey">\u8bf7\u8f93\u5165\u4e00\u4e2a\u6709\u6548\u7684\u64cd\u4f5c\u5458(\u5982\u679c\u4f7f\u7528fromapisecret\u8ba4\u8bc1\u8be5\u503c\u5fc5\u987b\u4e3a\u7a7a)</label>\n        <div class="ui fluid input">\n          <input type="text" name="accessKey" placeholder="" value="">\n        </div>\n      </div>\n      <div class="field">\n        <label for="secretKey">\u8bf7\u8f93\u5165formApiSecret</label>\n        <div class="ui fluid input">\n          <input type="text" name="secretKey" placeholder="" value="">\n        </div>\n      </div>\n      <div class="field">\n        <label for="bucketName">\u8bf7\u8f93\u5165\u4e00\u4e2a\u6709\u6548\u7684\u7a7a\u95f4\u540d\u79f0(Bucket Name)</label>\n        <div class="ui fluid input">\n          <input type="text" name="bucketName" placeholder="" value="">\n        </div>\n      </div>\n      <div class="field">\n        <label for="fileName">\u6587\u4ef6\u540d\u79f0\u751f\u6210\u89c4\u5219</label>\n        <div class="ui fluid input">\n          <input type="text" name="fileName" placeholder="/folder/{{year}}/{{month}}/{{date}}/{{filename}}" value="/\u5c0f\u4e66\u5320/{{filename}}">\n        </div>\n        <div class="ui pointing label">\u652f\u6301\u53d8\u91cf year, month, date, title, filename, basename, extname, md5</div>\n      </div>\n      <div class="field">\n        <label for="urlPrefix">\u56fe\u7247 URL \u524d\u7f00</label>\n        <div class="ui fluid input">\n          <input type="text" name="urlPrefix" placeholder="http://xxxxx.xxx/" value="">\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class="actions">\n    <div class="tips">\n    </div>\n    <div class="ui cancel button">\n      \u53d6\u6d88\n    </div>\n    <div class="ui positive button">\n      \u786e\u5b9a  \n    </div>\n  </div>\n</div>'),(n=t.find(".ui.form")).form({fields:{urlPrefix:{identifier:"urlPrefix",rules:[{type:"empty",prompt:"url\u524d\u7f00\u4e0d\u80fd\u4e3a\u7a7a"}]},secretKey:{identifier:"secretKey",rules:[{type:"empty",prompt:"secretKey \u4e0d\u80fd\u4e3a\u7a7a"}]},bucketName:{identifier:"bucketName",rules:[{type:"empty",prompt:"bucketName \u4e0d\u80fd\u4e3a\u7a7a"}]}},onSuccess:(r=this,function(){var n,i,o,a,s,l,u,c;return r.dimmer.dimmer("show"),n=r.dimmer,a=t.find("input[name=displayName]").val().trim(),i=t.find("input[name=accessKey]").val().trim(),l=t.find("input[name=secretKey]").val().trim(),c=t.find("input[name=urlPrefix]").val().trim(),u=t.find("select[name=uploadEntry]>option:selected").val().trim(),"/"!==c[c.length-1]&&(c+="/"),o=t.find("input[name=bucketName]").val().trim(),s=t.find("input[name=fileName]").val().trim(),a=a||"\u53f3\u62cd\u4e91\u5b58\u50a8",r.extraInfo.displayName=a,r.extraInfo.bucketName=o,r.extraInfo.fileName=s||"{{filename}}",r.extraInfo.urlPrefix=c,r.extraInfo.uploadEntry=u,r.accessKey=i,r.secretKey=l,r.urlPrefix=c,r.bucketName=o,r.fileName=s||"{{filename}}",r.uploadEntry=u,e(null,i,l,r.extraInfo,r,(function(e){if(n.dimmer("hide"),!e)return t.modal("hide")}))})}),this.dimmer=t.find(".content").dimmer({closable:!1}),t.find(".dimmer").html('<div class="ui indeterminate text loader">\u6821\u9a8c\u4e2d...</div>'),t.modal({closable:!1,allowMultiple:!0,onHidden:function(){return n.form("destroy"),t.modal("destroy"),t.remove()},onApprove:function(){return n.form("validate form"),!1}}).modal("show")},e.prototype.signOut=function(e){return e()},e.prototype.getAccountInfo=function(e){var t;return t=o.dataURL2Blob("data:image/png;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"),this.saveFile(this.extraInfo,"/\u5c0f\u4e66\u5320\u9a8c\u8bc1\u6587\u4ef6.png",t,{},(function(t,n,i,o){return t?(r.showMessage("\u7ed1\u5b9a\u8ba4\u8bc1\u5931\u8d25:"+t,6e3,"error"),e("\u7ed1\u5b9a\u8ba4\u8bc1\u5931\u8d25:"+t)):e(null,{shardId:"",username:"",email:""})}))},e.prototype.saveFile=function(e,t,n,r,i){return null==t&&(t=""),null==r&&(r={}),o.blobToArrayBuffer(n,(a=this,function(o,s){var l,u;return s&&((u=new SparkMD5.ArrayBuffer).append(s),l=u.end(),r.fileDataArrayBuffer=s,r.md5=l),a._saveFile(e,t,n,r,i)}));var a},e.prototype._saveFile=function(e,t,n,i,o){var s,l,u,c,p,d,f,h,m,v,g,y,b,x,w,k;if(null==t&&(t=""),null==i&&(i={}),m=this.fileName,d=i.fileModel,p=i.md5,x="\u5c0f\u4e66\u5320",d&&(x=d.get("title")||x),x=x.replace(/[\/\s]/g,"_"),m&&!t.startsWith("/")){h=_.template(m,{interpolate:/\{\{(.+?)\}\}/g}),f=a(t);try{t=h({filename:t,basename:f.base,extname:f.ext,md5:p,year:(new Date).getFullYear().toString(),month:((new Date).getMonth()+1).toString(),date:(new Date).getDate().toString(),title:x})}catch(e){return u=e,console.error(u),void o(u)}}return t=(t=t.replace(/^\/*/,"")).replace(/\s/g,"_"),1,l=Math.round((new Date).getTime()/1e3)+3600,s=new Date,g={bucket:encodeURIComponent(this.bucketName),"save-key":encodeURIComponent(t),expiration:l,date:s.toUTCString()},y=window.btoa(JSON.stringify(g)),v="POST",(c=new FormData).append("file",n),{},b=CryptoJS.MD5(y+"&"+this.secretKey),c.append("policy",y),c.append("signature",b),k=this.urlPrefix,w=this.uploadEntry||"http://v0.api.upyun.com",w+="/"+this.bucketName+"/",$.ajax({type:v,url:w,data:c,processData:!1,contentType:!1}).done((function(e,n,i){var a;try{a=JSON.parse(e)}catch(e){e,a={code:-1,message:n}}return a&&200===a.code?"function"==typeof o?o(null,t,k+a.url,a):void 0:(r.showMessage("\u4e0a\u4f20\u8d44\u6e90\u5931\u8d25:"+a.message+"\u300b"+t,6e3,"error"),"function"==typeof o?o("\u4e0a\u4f20\u8d44\u6e90\u5931\u8d25:"+a.message+"\u300b"+t):void 0)})).fail((function(e,t,n){var i;return(i=e.responseJSON)&&(n=i.message),r.showMessage("\u4e0a\u4f20\u8d44\u6e90\u5931\u8d25:"+n,6e3,"error"),"function"==typeof o?o("\u4e0a\u4f20\u8d44\u6e90\u5931\u8d25:"+n):void 0}))},e}(),n.exports=i}}),window.requirejs.define({"plugins/webdav/index":function(e,t,n){var r,i,o,a,s,l,u,c,p,d={}.hasOwnProperty;s=t("../../lib/utils"),i=t("../../lib/notifier"),r=t("../../constant"),o=t("../../views/save_new_dialog_view"),c=function(e){return e=(e=e.replace(/\/+/g,"/")).replace(/^\/|\/$/,"")},u=function(e,t,n){return e.exists(t.join("/")).then((function(r){return r?n():t.length<=1?e.createDirectory(t.join("/")).then((function(){return n()})).catch((function(e){return n(e)})):u(e,t.slice(0,-1),(function(r){return r?n(r):e.createDirectory(t.join("/")).then((function(){return n()})).catch((function(e){return n(e)}))}))}))},p=function(e,t,n,r){return new Promise((function(i,o){var a;return(a=(t=c(t)).split("/")).length>1?u(e,a.slice(0,-1),(function(a){return a?o(a):e.putFileContents(t,n,r).then(i).catch(o)})):e.putFileContents(t,n,r).then(i).catch(o)}))},a=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)d.call(t,n)&&(e[n]=t[n]);function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype}(t,e),t.prototype.validateFilename=function(e){return!e.endsWith("/")&&(!!e.replace(/^\/*/g,"")&&/^[^:*?"<>|\r\n]*$/g.test(e))},t.prototype.onSelectObj=function(e,t){var n,r,i,o,a,s;return a=(o=this.currentObj).parentPath||"",o.isChild||("-1"===(n=o.guid)&&(n=""),0===(a=a+"/"+n).indexOf("/")&&(a=a.substring(1))),(s=(n=e).lastIndexOf("/"))>=0&&(r=n.substring(s+1),i=(i=n.substring(0,s)).replace(/^\/*/g,""),a?(a=a+"/"+i,n=r):(a=i,n=r)),t(a,n)},t}(o),l=function(){function e(){}return e.prototype.name="webdav",e.prototype.kind="store",e.prototype.displayName="webdav\u6587\u4ef6\u7cfb\u7edf",e.prototype.platform="all",e.prototype.icon="inbox",e.prototype.logo="img/avatar_d_white_bg_256x256.png",e.prototype.description="\u4f7f\u7528 webdav \u6587\u4ef6\u7cfb\u7edf\u4e0b\u7684\u6587\u4ef6",e.prototype.production=!0,e.prototype.storePluginModel=null,e.prototype.init=function(e){var t,n,i,o,a;if(e){if(this.storePluginModel=e,"string"==typeof(i=e.get("extraInfo")))try{i=JSON.parse(i)}catch(e){n=e,console.log(n)}return this.uploadEntry=i.uploadEntry,a=this.uploadEntry,o="",t="","web"===STORY_PLATFORM&&(a=r.corsAnyWhereURL+this.uploadEntry,o=window.WebDAV.extractURLPath(this.uploadEntry),DOCKER_VERSION&&(t="xAuthorization")),this.client=window.WebDAV.createClient(a,{remotePath:o,username:e.get("entryToken"),password:e.get("entryTokenSecret"),digest:"digest"===i.authType,xAuthorHeaders:t}),this.storePluginModel=e}},e.prototype.getDisplayName=function(){var e;return this.storePluginModel&&(e=this.storePluginModel.get("displayName")),e||this.displayName},e.prototype.authenticate=function(e){var t,n,o;return t=$('<div class="ui modal small">\n  <div class="header">\u9009\u62e9\u4e00\u4e2a\u6587\u4ef6\u5939\u4f5c\u4e3a\u5165\u53e3</div>\n  <div class="content story_content">\n    <div class="ui form">\n      <div class="field">\n        <label for="uploadEntry">\u8bf7\u8f93\u5165\u4e00\u4e2a\u6709\u6548\u7684 webdav api \u8bbf\u95ee\u5165\u53e3</label>\n        <div class="ui fluid input">\n          <input type="text" name="uploadEntry" placeholder="http(s)://xxx.xxx.xxx/xxx/xxx" value="">\n        </div>\n      </div>\n      <div class="field">\n        <label for="accessKey">\u7528\u6237\u540d</label>\n        <div class="ui fluid input">\n          <input type="text" name="accessKey" placeholder="" value="">\n        </div>\n      </div>\n      <div class="field">\n        <label for="secretKey">\u5bc6\u7801</label>\n        <div class="ui fluid input">\n          <input type="text" name="secretKey" placeholder="" value="">\n        </div>\n      </div>\n      <div class="inline fields">\n        <label for="authType">\u8ba4\u8bc1\u65b9\u5f0f</label>\n        <div class="field">\n          <input type="radio" name="authType" value="basic" tabindex="0" checked>\n          <label>basic</label>\n        </div>\n        <div class="field">\n          <input type="radio" name="authType" value="digest" tabindex="0">\n          <label>digest</label>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class="actions">\n    <div class="ui negative button">\n      \u53d6\u6d88\n    </div>\n    <div class="ui positive button">\n      \u786e\u5b9a  \n    </div>\n  </div>\n</div>'),(n=t.find(".ui.form")).form({fields:{uploadEntry:{identifier:"uploadEntry",rules:[{type:"empty",prompt:"api\u8bbf\u95ee\u5165\u53e3\u4e0d\u80fd\u4e3a\u7a7a"}]}},onSuccess:(o=this,function(){var n,a,s,l,u,c,p,d,f;return o.dimmer.dimmer("show"),n=o.dimmer,s=t.find("input[name=accessKey]").val().trim(),p=t.find("input[name=secretKey]").val().trim(),f=t.find("input[name=uploadEntry]").val().trim(),l=t.find("input[name=authType]:checked").val(),d=f,c="",u="","web"===STORY_PLATFORM&&(d=r.corsAnyWhereURL+f,c=window.WebDAV.extractURLPath(f),DOCKER_VERSION&&(u="xAuthorization")),(a=window.WebDAV.createClient(d,{remotePath:c,username:s,password:p,digest:"digest"===l,xAuthorHeaders:u})).getQuota().then((function(r){var i;return(i={}).uploadEntry=f,i.authType=l,o.uploadEntry=f,o.client=a,e(null,s,p,i,o,(function(e){if(n.dimmer("hide"),!e)return t.modal("hide")}))})).catch((function(e){return i.showMessage("\u68c0\u6d4b\u5931\u8d25:"+e,6e3,"error"),n.dimmer("hide")}))})}),this.dimmer=t.find(".content").dimmer({closable:!1}),t.find(".dimmer").html('<div class="ui indeterminate text loader">\u6821\u9a8c\u4e2d...</div>'),t.modal({allowMultiple:!0,closable:!1,onHidden:function(){return n.form("destroy"),t.modal("destroy"),t.remove()},onApprove:function(){return n.form("validate form"),!1}}),t.modal("show")},e.prototype.signOut=function(e){return e()},e.prototype.getContextMenu=function(){var e,t;return e=this.client,{menu:function(e,t){return _.extend({},t,{viewInFolder:{name:"\u5728 webdav \u670d\u52a1\u5668\u4e2d\u6253\u5f00"}})},actions:{viewInFolder:(t=this,function(e,n){var r,i,o,a;if("-1"!==e.guid)return r=e.guid,i=e&&e.parentPath||"",o=c(o=i?i+"/"+r:r),a=t.uploadEntry+"/"+o,"client"===STORY_PLATFORM?require("nw.gui").Shell.openExternal(a):window.open(a,"_blank");a=t.uploadEntry}),createFile:function(t,n,r){var i,o,a;return(o=t&&t.parentPath||"")+""=="-1"&&(o=""),t&&t.isChild?a=o+"/"+n:t&&t.guid+""!="-1"?(o=o+"/"+t.guid,a=o+"/"+n):a=n,i=c(a),e.exists(i).then((function(s){return s?r("\u5b58\u5728\u76f8\u540c\u7684\u6587\u4ef6\u540d"):p(e,i,"").then((function(){var e;return t={guid:n,parentPath:o,name:n,isChild:!0,createDate:Date.now(),updateDate:Date.now(),fileType:"text",tagNames:[]},e={key:a.replace(/\//g,"_"),folder:!1,title:n,obj:t},r(null,e)})).catch((function(e){return r(e)}))}))},createFolder:function(t,n,r){var i,o,a;return(o=t&&t.parentPath||"")+""=="-1"&&(o=""),t&&t.isChild?a=o+"/"+n:t&&t.guid+""!="-1"?(o=o+"/"+t.guid,a=o+"/"+n):a=n,i=c(a),e.exists(i).then((function(s){return s?r("\u5b58\u5728\u76f8\u540c\u7684\u6587\u4ef6\u540d"):u(e,i.split("/"),(function(e){var i;return e?r(e):(t={guid:n,parentPath:o,name:n,isChild:!1,createDate:Date.now(),updateDate:Date.now(),fileType:"text",tagNames:[]},i={key:a.replace(/\//g,"_"),folder:!0,title:n,obj:t},r(null,i))}))}))},deleteFile:function(t,n){var r,i,o,a;return r=t.guid,o=t&&t.parentPath||"",a=t&&t.isChild?o+"/"+r:r,i=c(a),e.deleteFile(i).then((function(){return n()})).catch((function(e){return n(e)}))},deleteFolder:function(t,n){var r,i,o;return i=t&&t.parentPath||"",o=t?i+"/"+t.guid:t.guid,r=c(o),e.deleteFile(r).then((function(){return n()})).catch((function(e){return n(e)}))},renameFile:function(t,n,r){var i,o,a,s,l;return s=t&&t.parentPath||"",a="",t&&t.isChild||t?(l=s+"/"+n,a=s+"/"+t.guid):(l=n,a=t.guid),i=c(l),o=c(a),e.exists(i).then((function(a){return a?r("\u5b58\u5728\u76f8\u540c\u7684\u6587\u4ef6\u540d"):e.moveFile(o,i).then((function(){var e;return t={guid:n,parentPath:s,name:n,isChild:!0,createDate:Date.now(),updateDate:Date.now(),fileType:"text",tagNames:[]},e={key:l.replace(/\//g,"_"),folder:!1,title:n,obj:t},r(null,e)})).catch((function(e){return r(e)}))}))},renameFolder:function(t,n,r){var i,o,a,s,l;return s=t&&t.parentPath||"",a="",t&&t.isChild||t?(l=s+"/"+n,a=s+"/"+t.guid):(l=n,a=t.guid),i=c(l),o=c(a),e.exists(i).then((function(a){return a?r("\u5b58\u5728\u76f8\u540c\u7684\u6587\u4ef6\u540d"):e.moveFile(o,i).then((function(){var e;return t={guid:n,parentPath:s,name:n,isChild:!1,createDate:Date.now(),updateDate:Date.now(),fileType:"text",tagNames:[]},e={key:l.replace(/\//g,"_"),folder:!0,title:n,obj:t},r(null,e)})).catch((function(e){return r(e)}))}))}}}},e.prototype.getAccountInfo=function(e){return e(null,{username:"webdav\u6587\u4ef6\u7cfb\u7edf",displayName:"webdav\u6587\u4ef6\u7cfb\u7edf",email:""})},e.prototype.getFileMeta=function(e,t,n){var r,i,o;return i=t.guid,o=t.parentPath||"",r=c(r=o?o+"/"+i:i),this.client.stat(r).then((function(e){var r;return r={guid:i,parentPath:t.parentPath,name:s.generateMarkdownTitle(i)},n(null,r)})).catch((function(e){return n(e)}))},e.prototype.getFile=function(e,t,n){var r,o,a,l;return a=t.guid,l=t.parentPath||"",r=this.client,o=c(o=l?l+"/"+a:a),r.getFileContents(o,{format:"text"}).then((function(e){var o;return o=[],s.getResourceData(a,e,(function(u,p){return p=(p=p||[]).filter((function(e){return!/^http[s]?:\/\//i.test(e)})),async.eachSeries(p,(function(e,t){var n;return n=0===e.indexOf("/")?e:l+"/"+e,n=c(n),r.getFileContents(n).then((function(i){return r.stat(n).then((function(n){var r,a;return a=n.mime,r=new Blob([i],{type:a}),o.push({name:e,type:a,blob:r}),t()}))})).catch((function(n){return i.showMessage("\u5904\u7406\u9644\u4ef6\u51fa\u9519:"+e+",\u9519\u8bef\u539f\u56e0\uff1a"+n),t()}))}),(function(r){var l;return r?i.showMessage("\u52a0\u8f7d\u9644\u4ef6\u51fa\u9519"+r):(l={guid:a,parentPath:t.parentPath,markdownContent:e,resources:o,htmlContent:e,tagNames:[],name:s.generateMarkdownTitle(a)},n(r,l))}))}))})).catch((function(e){return n(e)}))},e.prototype.listFiles=function(e,t,n){var r;return r=t.parentPath||"",this.client.getDirectoryContents(r).then((function(e){var i,o,a,l,u,c,p,d,f;for(d=[],a=0,l=e.length;a<l;a++)i=e[a],o=s.checkIsSupportFileType(i.basename)?"text":"application",0===(c=r+"/"+i.basename).indexOf("/")&&(c=c.substring(1)),u={guid:i.basename,parentPath:t.parentPath,name:i.basename,isChild:"file"===i.type,createDate:i.lastmod,updateDate:i.lastmod,fileType:o,tagNames:[]},p={key:c.replace(/\//g,"_"),folder:"directory"===i.type,title:i.basename,lazy:"directory"===i.type,obj:u},d.push(p);return f=_.sortBy(d,(function(e){return(e.folder?"A":"B")+e.title})),n(null,f)})).catch((function(e){return n(e)}))},e.prototype.saveAttach=function(e,t,n,r,o,a,l){var u,d,f,h,m,v;if(v=t.get("pluginName"),h=t.get("guid"),m=t.get("parentPath"),!h)return"function"==typeof l?l():void 0;if(v!==this.name)return"function"==typeof l?l():void 0;0===n.indexOf("./")&&(n=n.substring(2));try{n=decodeURI(n)}catch(e){d=e,console.log(d)}return u=this.client,f=c(f=m?m+"/"+n:n),s.objectURLToArrayBuffer(o,(function(e,t){return e?i.showMessage("\u4fdd\u5b58\u9644\u4ef6\u5931\u8d253: "+n+", "+e,6e3,"error"):p(u,f,t,{overwrite:!0}).then((function(){return 0})).catch((function(e){return i.showMessage("\u4fdd\u5b58\u9644\u4ef6\u5931\u8d254: "+n+", "+e,6e3,"error")}))}))},e.prototype.saveFile=function(e,t,n,o){var l,u,d,f,h,m,v,g,y;return v=this,f=t.get("pluginName"),u=t.get("guid"),d=t.get("parentPath"),g=t.get("title")||"\u672a\u547d\u540d\u6587\u4ef6.md",f!==this.name&&(u="",f="",d=""),h=n.saveAs||!1,m=n.saveAttachment||!1,y=this,l=function(e,n,a){var l,u,d,f,h;return i.showHandling("\u4fdd\u5b58\u4e2d..."),f=setTimeout((function(){return i.hideHandling()}),r.getNetworkResourceTimeout),g.lastIndexOf(".")<0&&(g+=".md"),u=t.get("content")||"",h=Date.now(),l=y.client,d=c(d=e?e+"/"+n:n),p(l,d,u).then((function(){var r;return r={guid:n,parentPath:e,name:n,tagNames:[],createDate:h,updateDate:h,isChild:!0},a||m?s.getResourceData("default.md",u,(function(n,a){return n?(i.showMessage("\u4fdd\u5b58\u9644\u4ef6\u5931\u8d25",6e3,"error"),o(null,r)):(a=a.filter((function(e){return!/^http[s]?:\/\//i.test(e)})),async.eachSeries(a,(function(n,r){var o;try{n=decodeURI(n)}catch(e){o=e,console.log(o)}return t.getAttachObjectByFilename(n,(function(t,o){var a;return o&&(a=o.objectUrl)?s.objectURLToArrayBuffer(a,(function(t,o){var a;return t?(i.showMessage("\u4fdd\u5b58\u9644\u4ef6\u5931\u8d251: "+n+", "+t,6e3,"error"),r()):(a=0===n.indexOf("/")?n:e?e+"/"+n:n,a=c(a),p(l,a,o).then((function(){return r()})).catch((function(e){return i.showMessage("\u4fdd\u5b58\u9644\u4ef6\u5931\u8d252: "+n+", "+e,6e3,"error"),r()})))})):r()}))}),(function(e){return clearTimeout(f),f=null,i.hideHandling(),o(null,r,v)})))})):(i.hideHandling(),o(null,r,this))})).catch((function(e){return i.hideHandling(),o(e)}))},!u||h?new a({plugin:this,saveAs:h,saveAsCallback:o,fileModel:t}).show((function(e,t){return l(e,t,!0)})):l(d,u,!1)},e}(),n.exports=l}}),window.requirejs.define({"plugins/weibo/index":function(e,t,n){var r,i;r=t("../../lib/notifier"),t("../../lib/utils"),t("../../constant"),i=function(){function e(){}return e.prototype.name="weibo",e.prototype.kind="resource",e.prototype.displayName="weibo",e.prototype.description=" weibo \u505a\u4e3a\u81ea\u5df1\u7684\u56fe\u5e8a",e.prototype.icon="weibo",e.prototype.logo="",e.prototype.platform="client",e.prototype.production=!1,e.prototype.storePluginModel=null,e.prototype.init=function(e){var t,n;if(e){if("string"==typeof(n=e.get("extraInfo")))try{n=JSON.parse(n)}catch(e){t=e,console.log(t)}return this.extraInfo=n||{},this.accessToken=e.get("entryToken"),this.storePluginModel=e}},e.prototype.authenticate=function(e){var t,n;return t=window.open("https://api.weibo.com/oauth2/authorize?client_id=2809665603&state=1&response_type=code&redirect_uri=http://markdown.xiaoshujiang.com/oauth2?pluginName="+this.name,"_blank","resizeable=true,height=400,width=400, left=200, top=30"),window.accessToken=(n=this,function(r,i,o){return n.postBaseData={pluginName:n.name,entryToken:r,entryTokenSecret:i,extraInfo:o},n.accessToken=r,e(null,r,i,o,n),t.close()})},e.prototype.signOut=function(e){return e()},e.prototype.getAccountInfo=function(e){var t;return t=this.accessToken,$.ajax({type:"GET",url:"https://api.weibo.com/2/account/get_uid.json",data:{access_token:t}}).done((function(t,n,i){var o;return t&&"success"===n?(o={shardId:t.uid,username:t.uid,email:""},e(null,o)):(r.showMessage("\u7ed1\u5b9a\u8ba4\u8bc1\u5931\u8d25:"+t.error,6e3,"error"),e("\u7ed1\u5b9a\u8ba4\u8bc1\u5931\u8d25:"+t.error))})).fail((function(t,n,i){var o;return(o=t.responseJSON)&&(i=o.error_code+":"+o.error),r.showMessage("\u7ed1\u5b9a\u8ba4\u8bc1\u5931\u8d25:"+i,6e3,"error"),e("\u7ed1\u5b9a\u8ba4\u8bc1\u5931\u8d25"+i)}))},e.prototype.saveFile=function(e,t,n,i,o){var a,s;return a=this.accessToken,(s=new FormData).append("pic",n),s.append("status",t||"\u5c0f\u4e66\u5320"),s.append("access_token",a),$.ajax({type:"POST",url:"https://upload.api.weibo.com/2/statuses/upload.json",data:s,processData:!1,contentType:!1}).done((function(e,n,i){return e&&"success"===n?({fileName:t,url:e.original_pic,data:e},$.ajax({type:"POST",url:"https://api.weibo.com/2/statuses/destroy.json",data:{access_token:a,id:e.id}}).always((function(){return"function"==typeof o?o(null,t,e.original_pic,e):void 0}))):(r.showMessage("\u4e0a\u4f20\u8d44\u6e90\u5931\u8d25:"+e.error+"\u300b"+filePath,6e3,"error"),"function"==typeof o?o("\u4e0a\u4f20\u8d44\u6e90\u5931\u8d25:"+e.error+"\u300b"+filePath):void 0)})).fail((function(e,t,n){var i;return(i=e.responseJSON)&&(n=i.error_code+":"+i.error),r.showMessage("\u4e0a\u4f20\u8d44\u6e90\u5931\u8d25:"+n,6e3,"error"),"function"==typeof o?o("\u4e0a\u4f20\u8d44\u6e90\u5931\u8d25:"+n):void 0}))},e}(),n.exports=i}}),window.requirejs.define({"plugins/wiz/index":function(e,t,n){var r,i,o,a,s,l,u,c={}.hasOwnProperty;o=t("../../lib/notifier"),l=t("../../lib/utils"),i=t("../../constant"),a=t("../../views/save_new_dialog_view"),r=t("../../application"),s=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)c.call(t,n)&&(e[n]=t[n]);function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype}(t,e),t.prototype.validateFilename=function(e){return!0},t.prototype.setSelectObj=function(e,t){var n,r;return this.currentObj=e,r=(r=e.parentPath||"")?"/"+r+"/":"/",n=this.fileModel.get("title")||"\u672a\u547d\u540d\u7684\u6587\u4ef6",e.isChild?(r="/"+t.getParent().title+"/",n=e.name):r="-1"===e.guid?"/":r+t.title+"/",this.$el.find(".parent_path").text(r+n),this.$el.find("input[name=filename]").val(n)},t.prototype.show=function(e){return t.__super__.show.call(this,e),this.$el.find(".parent_path").text("/"+this.fileModel.get("title")),this.$el.find("input[name=filename]").val(this.fileModel.get("title")),this.$el.find("input[name=filename]").hide()},t.prototype.onSelectObj=function(e,t){var n,r,i;return i=(r=this.currentObj).parentPath||"",r.isChild?n=r.guid:(n="","-1"!==r.guid&&0===(i=i+"/"+r.guid).indexOf("/")&&(i=i.substring(1))),t(i,n,e)},t}(a),u=function(){function e(){}return e.prototype.name="wiz",e.prototype.kind="store",e.prototype.displayName="\u4e3a\u77e5\u7b14\u8bb0",e.prototype.description="\u4f7f\u7528\u4e3a\u77e5\u7b14\u8bb0\u5b58\u50a8",e.prototype.icon="wiz",e.prototype.logo="img/wiz.jpg",e.prototype.production=!1,e.prototype.loginUrl="/wiz_login",e.prototype.storePluginModel=null,e.prototype.reAuth=function(e){var t,n;return t={username:this.username,password:this.password,wizServer:this.wizServer},$.ajax({url:this.loginUrl,data:t,method:"post",error:function(t){return e(t)},success:(n=this,function(t,r,i){var o;try{o=JSON.parse(t)}catch(e){o=t}return o.error?e(o):(n.postBaseData={pluginName:n.name,entryToken:o.token,entryTokenSecret:"",extraInfo:JSON.stringify(o)},n.storePluginModel.set({entryToken:o.token,entryTokenSecret:n.password,extraInfo:JSON.stringify(o)}),n.storePluginModel.save(),e(null))})})},e.prototype.init=function(e){var t;return this.storePluginModel=e,e?(this.postBaseData={pluginName:e.get("name"),entryToken:e.get("entryToken"),entryTokenSecret:"",extraInfo:e.get("extraInfo")},t=this.postBaseData.extraInfo,t=JSON.parse(t),this.username=t.email,this.password=e.get("entryTokenSecret"),this.wizServer=t.wizServer||"https://as.wiz.cn"):this.postBaseData={}},e.prototype.getDisplayName=function(){var e;return this.storePluginModel&&(e=this.storePluginModel.get("displayName")),e||this.displayName},e.prototype.authenticate=function(e){var t,n,r;return t=$('<div class="ui small modal story_modal">\n  <div class="header">\u8bf7\u8f93\u5165\u4e3a\u77e5\u5e10\u53f7\u548c\u5bc6\u7801</div>\n  <div class="content story_content">\n    <div class="ui form">\n      <div class="field">\n        <label>\u670d\u52a1\u5668\u5730\u5740</label>\n        <div class="ui fluid input">\n          <input type="text" name="wizServer" placeholder="https://as.wiz.cn" value="">\n        </div>\n      </div>\n      <div class="field">\n        <label>\u7528\u6237\u540d</label>\n        <div class="ui fluid input">\n          <input type="text" name="username" placeholder="" value="">\n        </div>\n      </div>\n      <div class="field">\n        <label>\u5bc6\u7801</label>\n        <div class="ui fluid input">\n          <input type="password" name="password" placeholder="" value="">\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class="actions">\n    <div class="tips">\n    </div>\n    <div class="ui cancel button">\n      \u53d6\u6d88\n    </div>\n    <div class="ui positive button">\n      \u786e\u5b9a  \n    </div>\n  </div>\n</div>'),(n=t.find(".ui.form")).form({fields:{username:{identifier:"username",rules:[{type:"empty",prompt:"\u8bf7\u8f93\u5165\u6709\u6548\u7684\u4e3a\u77e5\u5e10\u53f7"}]},password:{identifier:"password",rules:[{type:"empty",prompt:"\u8bf7\u8f93\u5165\u6709\u6548\u7684\u5bc6\u7801"}]}},onSuccess:(r=this,function(){var n,i,a,s;if(r.dimmer.dimmer("show"),s=t.find("input[name=wizServer]").val().trim(),!(s=$.trim(s.replace(/\/*$/,"")))||/^https?:\/\//i.test(s))return s=s||"https://as.wiz.cn",a=t.find("input[name=username]").val().trim(),n=t.find("input[name=password]").val().trim(),i={username:a,password:n,wizServer:s},$.ajax({url:r.loginUrl,data:i,method:"post",error:function(t){return e(t),r.dimmer.dimmer("hide")},success:function(o,s,l){var u;try{u=JSON.parse(o)}catch(e){u=o}return u.error?(e(JSON.stringify(u)),r.dimmer.dimmer("hide")):(r.postBaseData={pluginName:r.name,entryToken:u.token,entryTokenSecret:"",extraInfo:JSON.stringify(u)},r.password=n,r.username=a,r.wizServer=i.wizServer,e(null,u.token,n,JSON.stringify(u),r,(function(e,n){if(r.dimmer.dimmer("hide"),!e)return r.storePluginModel=n,t.modal("hide")})))}});o.showMessage("\u8bf7\u8f93\u5165\u4e00\u4e2a\u5408\u6cd5\u7684 url \u5730\u5740(\u9700\u5305\u542b http[s]:// \u534f\u8bae\u4fe1\u606f)",6e3,"error")})}),this.dimmer=t.find(".content").dimmer({closable:!1}),t.find(".dimmer").html('<div class="ui indeterminate text loader">\u6821\u9a8c\u4e2d...</div>'),t.modal({closable:!1,allowMultiple:!0,onHidden:function(){return n.form("destroy"),t.modal("destroy"),t.remove()},onApprove:function(){return n.form("validate form"),!1}}).modal("show")},e.prototype.setting=function(){var e,t,n,r,i,o,a,s,l;if(l=this.storePluginModel,s=this.postBaseData,l){r=l.get("extraInfo")||{};try{r=JSON.parse(this.postBaseData.extraInfo)}catch(e){n=e,console.log(n)}return a=(o=!(!1===r.netImage))?'checked="checked"':"",t=l.get("displayName"),i=this.icon?"<i class='large icon "+this.icon+"'></i>":"",(e=$('<div class="ui small modal">\n  <div class="header">'+i+t+' \u914d\u7f6e</div>\n  <div class="content">\n    <div class="inline field">\n      <label for="netImage" >\u8f6c\u6362\u7f51\u7edc\u56fe\u7247</label>\n      <input type="checkbox" name="netImage" '+a+'>\n    </div>\n\n  </div>\n  <div class="actions">\n    <div class="ui basic cancel right button">\n      \u53d6\u6d88\n    </div>\n    <div class="ui basic positive right button">\n      \u786e\u5b9a\n    </div>\n  </div>\n</div>')).modal({allowMultiple:!0,closable:!1,onApprove:function(){var t;return o=e.find("input[name=netImage]").is(":checked"),r.netImage=o,t=JSON.stringify(r),s.extraInfo=t,l.set("extraInfo",t),l.save()},onHidden:function(){return e.modal("destroy"),e.remove(),e=null}}),e.modal("show")}},e.prototype.signOut=function(e){return this.postBaseData=null,e()},e.prototype.getContextMenu=function(){return{menu:function(e,t){return e.isChild?{refreshFile:{name:"\u66f4\u65b0\u672c\u5730\u7f13\u5b58\u6587\u4ef6"},viewOrign:{name:"\u5728\u4e3a\u77e5\u7b14\u8bb0 web \u7248\u4e2d\u6253\u5f00"},deleteFile:{name:"\u5220\u9664\u6587\u4ef6"}}:{}},actions:{viewOrign:(e=this,function(t,n){var r,i,o,a;if(i=null,a=null,e.postBaseData.extraInfo)try{i=JSON.parse(e.postBaseData.extraInfo)}catch(e){r=e,console.log(r)}if(i&&i.kbGuid&&(a=i.wizServer&&"https://as.wiz.cn"!==i.wizServer?i.wizServer+"/wapp/recent/"+i.kbGuid+"?":"https://www.wiz.cn/wapp/recent/"+i.kbGuid+"?"),a)return o=a+"docGuid="+t.guid,"client"===STORY_PLATFORM?require("nw.gui").Shell.openExternal(o):window.open(o,"_blank")}),deleteFile:function(e){return function(t,n){return o.showHandling("\u5220\u9664\u4e2d..."),e.deleteFile({},t,(function(){return o.hideHandling(),n()}))}}(this)}};var e},e.prototype.getAccountInfo=function(e){var t,n;return t=$.extend({},this.postBaseData,{operateType:"getAccountInfo"}),$.ajax({url:"/plugin",data:t,method:"GET",success:(n=this,function(t,r,i){var o,a,s;try{o=JSON.parse(t)}catch(e){a=e,o=t}if(o.error)return e(o);try{(s=JSON.parse(n.postBaseData.extraInfo)).shardId=o.shardId,n.postBaseData.extraInfo=JSON.stringify(s)}catch(e){a=e,console.log(a),(s={}).shardId=o.shardId,n.postBaseData.extraInfo=JSON.stringify(s)}return e(null,o)}),error:function(t){return e(t)},dataType:"json"})},e.prototype.getFile=function(e,t,n){var r,i,a,s;return i=t.guid,(a=t.parentPath||"")?a+"/"+i:i,this.getAccountInfo((s=this,function(e,t){return e||t.error?s.reAuth((function(e){return e?o.showMessage("\u8ba4\u8bc1\u5931\u8d25,\u8bf7\u91cd\u65b0\u7ed1\u5b9a",6e3,"error"):r()})):r()})),r=function(e){return function(){var r;return r=$.extend({},e.postBaseData,{parentPath:t.parentPath,guid:t.guid,operateType:"getFile"}),$.getJSON("/plugin",r,(function(r,i,o){var a,s;return r.error?(n(r.error),void console.log("\u52a0\u8f7d\u6587\u4ef6\u51fa\u9519"+r.error)):(s=r.resources,a=[],s&&$.each(s,(function(e,t){var n,r;return r={name:e,type:(n=l.dataURL2Blob(t)).type,blob:n},a.push(r)})),t=$.extend({},r,e.postBaseData),r.markdownContent||(r.markdownContent=l.html2markdown(r.htmlContent)),n(null,{guid:r.guid,parentPath:r.parentPath,markdownContent:r.markdownContent,cssText:r.cssText||"",htmlContent:r.htmlContent,resources:a,tagNames:r.tagNames,name:r.name}))}))}}(this)},e.prototype.deleteFile=function(e,t,n){var r,i;return this.getAccountInfo((i=this,function(e,t){return e||t.error?i.reAuth((function(e){return e?o.showMessage("\u8ba4\u8bc1\u5931\u8d25,\u8bf7\u91cd\u65b0\u7ed1\u5b9a",6e3,"error"):r()})):r()})),r=function(e){return function(){var r;return r=$.extend({},e.postBaseData,{parentPath:t.parentPath,guid:t.guid,operateType:"deleteFile"}),$.getJSON("/plugin",r,(function(e,t,r){return e.error?(n(e.error),void console.log("\u5220\u9664\u6587\u4ef6\u51fa\u9519"+e.error)):n(null)}))}}(this)},e.prototype.searchFiles=function(e,t,n){var r,i,a,s,l,u,c;return i=t.parentPath,l=t.query,u=t.tags,a=t.offset||0,s=t.pageSize||30,this,this.getAccountInfo((c=this,function(e,t){return e||t.error?c.reAuth((function(e){return e?o.showMessage("\u8ba4\u8bc1\u5931\u8d25,\u8bf7\u91cd\u65b0\u7ed1\u5b9a",6e3,"error"):r()})):r()})),r=function(e){return function(){return $.ajax({url:"/plugin",data:$.extend({},e.postBaseData,{operateType:"searchFiles",parentPath:i,query:l,tags:u,offset:a,pageSize:s}),dataType:"json",success:function(e,t,r){var i;if(e.code){try{i=JSON.stringify(e)}catch(t){t,i=e}return o.showMessage("\u52a0\u8f7d\u6587\u4ef6\u5217\u8868\u51fa\u73b0\u9519\u8bef"+i,3e3,"error"),n(i)}return n(null,e)},error:function(e,t){return o.showMessage("\u52a0\u8f7d\u6587\u4ef6\u5217\u8868\u51fa\u73b0\u9519\u8bef"+t,3e3,"error"),n(e)}})}}(this)},e.prototype.listTags=function(e,t,n){var r,i;return this,this.getAccountInfo((i=this,function(e,t){return e||t.error?i.reAuth((function(e){return e?o.showMessage("\u8ba4\u8bc1\u5931\u8d25,\u8bf7\u91cd\u65b0\u7ed1\u5b9a",6e3,"error"):r()})):r()})),r=function(e){return function(){return $.ajax({url:"/plugin",data:$.extend({},e.postBaseData,{operateType:"listTags"}),dataType:"json",success:function(e,t,r){var i;if(e.code){try{i=JSON.stringify(e)}catch(t){t,i=e}return o.showMessage("\u52a0\u8f7d\u6807\u7b7e\u5217\u8868\u51fa\u73b0\u9519\u8bef"+i,3e3,"error"),n(i)}return n(null,e)},error:function(e,t){return o.showMessage("\u52a0\u8f7d\u6807\u7b7e\u5217\u8868\u51fa\u73b0\u9519\u8bef"+t,3e3,"error"),n(e)}})}}(this)},e.prototype.listFiles=function(e,t,n){var r,i,a,s;return i=t.parentPath,a=t.pageSize||0,this.getAccountInfo((s=this,function(e,t){return e||t.error?s.reAuth((function(e){return e?o.showMessage("\u8ba4\u8bc1\u5931\u8d25,\u8bf7\u91cd\u65b0\u7ed1\u5b9a",6e3,"error"):r()})):r()})),r=function(e){return function(){return $.ajax({url:"/plugin",data:$.extend({},e.postBaseData,{operateType:"listFiles",parentPath:i,pageSize:a}),dataType:"json",success:function(e,t,r){var i;if(e.code){try{i=JSON.stringify(e)}catch(t){t,i=e}return o.showMessage("\u52a0\u8f7d\u51fa\u73b0\u9519\u8bef"+i,3e3,"error"),n(i)}return n(null,e)},error:function(e){return o.showMessage("\u52a0\u8f7d\u51fa\u73b0\u9519\u8bef",3e3,"error"),n(e)}})}}(this)},e.prototype.saveFile=function(e,t,n,a){var u,c,p,d,f,h,m;return d=t.get("pluginName"),c=t.get("guid"),h=t.get("title"),p=t.get("parentPath"),d!==this.name&&(c="",d="",p=""),f=n.saveAs,m=this,u=function(e,n,s){var u,c;o.showHandling("\u4fdd\u5b58\u4e2d..."),c=setTimeout((function(){return o.hideHandling()}),i.getNetworkResourceTimeout);try{u=JSON.parse(m.postBaseData.extraInfo)}catch(e){u={netImage:!0}}return $(window).trigger("convertPreviewFormatForExport",[t,{type:"dataURL",netImage:u.netImage,changeOpenTarget:!0,brand:"xsj_plugin_"+m.name},function(i,u){return r.getStyleText(t,(function(r,i){return l.inlineStylesheet(u.html(),i,(function(r,i){var l;return m.getAccountInfo((function(e,t){return e||t.error?m.reAuth((function(e){return e?o.showMessage("\u8ba4\u8bc1\u5931\u8d25,\u8bf7\u91cd\u65b0\u7ed1\u5b9a",6e3,"error"):l()})):l()})),l=function(){var r;return(r=$.extend({},m.postBaseData,{pluginName:m.name,entryToken:m.postBaseData.entryToken,operateType:"saveFile",parentPath:e||"",guid:n||"",title:s,fileMarkdownContent:t.get("content")||"",fileHtmlContent:"",fileModel:t.toJSONWithSkipAttachmentData()})).fileHtmlContent=i,$.ajax({type:"post",url:"/plugin",data:r,dataType:"json",success:function(e,t,n){var r;return clearTimeout(c),c=null,o.hideHandling(),e.code?(o.showMessage("\u4fdd\u5b58\u5931\u8d25: "+e.error,6e3,"error"),a(e,null)):(r={guid:e.guid,parentPath:e.parentPath,name:e.name,tagNames:e.tagNames,createDate:e.createDate,updateDate:e.updateDate,isChild:!0},a(null,r,m))},error:function(e){return o.hideHandling(),a(e)}})}}))}))}])},!c||f?new s({plugin:this,saveAs:f,saveAsCallback:a,fileModel:t}).show((function(e,t,n){return u(e,t,n)})):u(p,c,h)},e}(),n.exports=u}}),window.requirejs.define({"plugins/wizv2/index":function(e,t,n){var r,i={}.hasOwnProperty;r=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)i.call(t,n)&&(e[n]=t[n]);function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype}(t,e),t.prototype.name="wizv2",t.prototype.kind="store",t.prototype.production=!0,t.prototype.displayName="\u4e3a\u77e5\u7b14\u8bb0",t.prototype.description="\u4f7f\u7528\u65b0\u7248\u540c\u6b65\u65b9\u5f0f\u7684\u4e3a\u77e5\u7b14\u8bb0\u5b58\u50a8",t.prototype.loginUrl="/wizv2_login",t}(t("../wiz")),n.exports=r}}),window.requirejs.define({"plugins/youdao/index":function(e,t,n){var r,i,o,a,s,l,u,c={}.hasOwnProperty;o=t("../../lib/notifier"),l=t("../../lib/utils"),i=t("../../constant"),a=t("../../views/save_new_dialog_view"),r=t("../../application"),s=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)c.call(t,n)&&(e[n]=t[n]);function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype}(t,e),t.prototype.validateFilename=function(e){return!0},t.prototype.setSelectObj=function(e,t){var n,r;return this.currentObj=e,r=(r=e.parentPath||"")?"/"+r+"/":"/",n=this.fileModel.get("title")||"\u672a\u547d\u540d\u7684\u6587\u4ef6",e.isChild?(r="/"+t.getParent().title+"/",n=e.name):r="-1"===e.guid?"/":r+t.title+"/",this.$el.find(".parent_path").text(r+n),this.$el.find("input[name=filename]").val(n)},t.prototype.show=function(e){return t.__super__.show.call(this,e),this.$el.find(".parent_path").text("/"+this.fileModel.get("title")),this.$el.find("input[name=filename]").val(this.fileModel.get("title")),this.$el.find("input[name=filename]").hide()},t.prototype.onSelectObj=function(e,t){var n,r,i;return i=(r=this.currentObj).parentPath||"",r.isChild?n=r.guid:(n="","-1"!==r.guid&&0===(i=i+"/"+r.guid).indexOf("/")&&(i=i.substring(1))),t(i,n,e)},t}(a),u=function(){function e(){}return e.prototype.name="youdao",e.prototype.kind="store",e.prototype.displayName="\u6709\u9053\u4e91\u7b14\u8bb0",e.prototype.description="\u4f7f\u7528\u6709\u9053\u4e91\u7b14\u8bb0\u5b58\u50a8",e.prototype.icon="youdao",e.prototype.logo="img/youdao.jpg",e.prototype.production=!0,e.prototype.storePluginModel=null,e.prototype.init=function(e){return e?(this.storePluginModel=e,this.postBaseData={pluginName:e.get("name"),entryToken:e.get("entryToken"),entryTokenSecret:e.get("entryTokenSecret"),extraInfo:e.get("extraInfo")}):this.postBaseData={}},e.prototype.getDisplayName=function(){var e;return this.storePluginModel&&(e=this.storePluginModel.get("displayName")),e||this.displayName},e.prototype.authenticate=function(e){var t,n;return t=window.open("https://note.youdao.com/oauth/authorize2?client_id=193360a61e7f979b056181c841327583&state=1&response_type=code&redirect_uri=http://markdown.xiaoshujiang.com/oauth2?pluginName="+this.name,"_blank","resizeable=true,height=400,width=400, left=200, top=30"),window.accessToken=(n=this,function(r,i,o){return n.postBaseData={pluginName:n.name,entryToken:r,entryTokenSecret:i,extraInfo:o},e(null,r,i,o,n),t.close()})},e.prototype.setting=function(){var e,t,n,r,i,o,a,s,l;if(l=this.storePluginModel,s=this.postBaseData,l){r=l.get("extraInfo")||{};try{r=JSON.parse(this.postBaseData.extraInfo)}catch(e){n=e,console.log(n)}return a=(o=!(!1===r.netImage))?'checked="checked"':"",t=l.get("displayName"),i=this.icon?"<i class='large icon "+this.icon+"'></i>":"",(e=$('<div class="ui small modal">\n  <div class="header">'+i+t+' \u914d\u7f6e</div>\n  <div class="content">\n    <div class="inline field">\n      <label for="netImage" >\u8f6c\u6362\u7f51\u7edc\u56fe\u7247</label>\n      <input type="checkbox" name="netImage" '+a+'>\n    </div>\n\n  </div>\n  <div class="actions">\n    <div class="ui basic cancel right button">\n      \u53d6\u6d88\n    </div>\n    <div class="ui basic positive right button">\n      \u786e\u5b9a\n    </div>\n  </div>\n</div>')).modal({allowMultiple:!0,closable:!1,onApprove:function(){var t;return o=e.find("input[name=netImage]").is(":checked"),r.netImage=o,t=JSON.stringify(r),s.extraInfo=t,l.set("extraInfo",t),l.save()},onHidden:function(){return e.modal("destroy"),e.remove(),e=null}}),e.modal("show")}},e.prototype.signOut=function(e){return this.postBaseData=null,e()},e.prototype.getAccountInfo=function(e){var t,n;return t=$.extend(this.postBaseData,{operateType:"getAccountInfo"}),$.ajax({url:"/plugin",data:t,method:"GET",success:(n=this,function(t,r,i){var o,a,s;try{o=JSON.parse(t)}catch(e){a=e,o=t}if(o.error)return e(o);try{(s=JSON.parse(n.postBaseData.extraInfo)).shardId=o.shardId,n.postBaseData.extraInfo=JSON.stringify(s)}catch(e){a=e,console.log(a),(s={}).shardId=o.shardId,n.postBaseData.extraInfo=JSON.stringify(s)}return e(null,o)}),error:function(t){return e(t)},dataType:"json"})},e.prototype.getFile=function(e,t,n){var r,i,o,a;return r=t.guid,(i=t.parentPath||"")?i+"/"+r:r,o=$.extend(this.postBaseData,{parentPath:t.parentPath,guid:t.guid,operateType:"getFile"}),$.getJSON("/plugin",o,(a=this,function(e,r,i){var o,s;return e.error?(n(e.error),void console.log("\u52a0\u8f7d\u6587\u4ef6\u51fa\u9519"+e.error)):(s=e.resources,o=[],s&&$.each(s,(function(e,t){var n,r;return r={name:e,type:(n=l.dataURL2Blob(t)).type,blob:n},o.push(r)})),t=$.extend(e,a.postBaseData),e.markdownContent||(e.markdownContent=l.html2markdown(e.htmlContent)),n("\u7531\u4e8e\u6709\u9053\u4e91\u8c03\u6574\u4e86 api \u6b63\u6587\u89e3\u6790\u89c4\u5219\uff0c \u65e0\u6cd5\u518d\u652f\u6301\u4ece\u6709\u9053\u4e91\u6293\u53d6\u6570\u636e\u529f\u80fd",{guid:e.guid,parentPath:e.parentPath,markdownContent:e.markdownContent,cssText:e.cssText||"",htmlContent:e.htmlContent,resources:o,tagNames:e.tagNames,name:e.name}))}))},e.prototype.deleteFile=function(e,t,n){var r;return r=$.extend(this.postBaseData,{parentPath:t.parentPath,guid:t.guid,operateType:"deleteFile"}),$.getJSON("/plugin",r,(function(e,t,r){return e.error?(n(e.error),void console.log("\u5220\u9664\u6587\u4ef6\u51fa\u9519"+e.error)):n(null)}))},e.prototype.listFiles=function(e,t,n){var r,i;return r=t.parentPath,i=t.pageSize||0,$.ajax({url:"/plugin",data:$.extend(this.postBaseData,{operateType:"listFiles",parentPath:r,pageSize:i}),dataType:"json",success:function(e,t,r){var i;if(e.code){try{i=JSON.stringify(e)}catch(t){t,i=e}return o.showMessage("\u52a0\u8f7d\u51fa\u73b0\u9519\u8bef"+i,3e3,"error"),n(i)}return n(null,e)},error:function(e){return o.showMessage("\u52a0\u8f7d\u51fa\u73b0\u9519\u8bef",3e3,"error"),n(e)}})},e.prototype.saveFile=function(e,t,n,a){var u,c,p,d,f,h,m;return d=t.get("pluginName"),c=t.get("guid"),h=t.get("title"),p=t.get("parentPath"),d!==this.name&&(c="",d="",p=""),f=n.saveAs,m=this,u=function(e,n,s){var u,c,p;o.showHandling("\u4fdd\u5b58\u4e2d..."),p=setTimeout((function(){return o.hideHandling()}),i.getNetworkResourceTimeout),c={pluginName:m.name,entryToken:m.postBaseData.entryToken,operateType:"saveFile",parentPath:e||"",guid:n||"",title:s,fileMarkdownContent:t.get("content")||"",fileHtmlContent:"",fileModel:t.toJSONWithSkipAttachmentData()};try{u=JSON.parse(m.postBaseData.extraInfo)}catch(e){u={netImage:!0}}return $(window).trigger("convertPreviewFormatForExport",[t,{type:"dataURL",netImage:u.netImage,changeOpenTarget:!0,brand:"xsj_plugin_"+m.name},function(e,n){return n.find(".li_linenum").addClass("li_list_style"),n.find(".task-list-item").addClass("li_list_style"),n.find(".task-list-item>input[type=checkbox]").map((function(e,t){var n;return(n=$(t)).is(":checked")?n.replaceWith('<span style="color:gray;font-size:1em;margin-right:.2em;">\u2611</span>'):n.replaceWith('<span style="color:gray;font-size:1.3em;margin-right:.2em;">\u25a1</span>')})),r.getStyleText(t,(function(e,t){return l.inlineStylesheet(n.html(),t,(function(e,t){return c.fileHtmlContent=t,$.ajax({type:"post",url:"/plugin",data:c,dataType:"json",success:function(e,t,n){var r;return clearTimeout(p),p=null,o.hideHandling(),e.code?(o.showMessage("\u4fdd\u5b58\u5931\u8d25: "+e.error,6e3,"error"),a(e,null)):(r={guid:e.guid,parentPath:e.parentPath,name:e.name,tagNames:e.tagNames,createDate:e.createDate,updateDate:e.updateDate,isChild:!0},a(null,r,m))},error:function(e){return o.hideHandling(),a(e)}})}))}))}])},!c||f?new s({plugin:this,saveAs:f,saveAsCallback:a,fileModel:t}).show((function(e,t,n){return u(e,t,n)})):u(p,c,h)},e}(),n.exports=u}}),window.requirejs.define({"plugins/remote_plugin":function(e,t,n){var r,i,o,a,s,l,u,c,p,d={}.hasOwnProperty;c=t("../../lib/utils"),a=t("../../lib/notifier"),r=t("../../application"),l=t("../../views/save_new_dialog_view"),i=t("../../constant"),o=t("../../models/file_model"),u=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)d.call(t,n)&&(e[n]=t[n]);function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype}(t,e),t.prototype.validateFilename=function(e){return!0},t.prototype.setSelectObj=function(e,t){var n,r;return this.currentObj=e,r="",n=this.fileModel.get("title")||"\u672a\u547d\u540d\u7684\u6587\u4ef6",e.isChild?(r="/"+t.getParent().title+"/",n=e.name):r="-1"===e.guid?"/":"/"+t.title+"/",this.$el.find(".parent_path").text(r+n),this.$el.find("input[name=filename]").val(n)},t.prototype.show=function(e){return t.__super__.show.call(this,e),this.$el.find(".parent_path").text("/"+this.fileModel.get("title")),this.$el.find("input[name=filename]").val(this.fileModel.get("title")),this.$el.find("input[name=filename]").hide()},t.prototype.onSelectObj=function(e,t){var n,r,i;return i=(r=this.currentObj).parentPath||"",r.isChild?n=r.guid:(n="","-1"===r.guid||r.isVirtualNode||(i=r.guid)),t(i,n,e)},t}(l),p=function(e){if(e.code&&e.orign&&19===e.orign.errorCode)return a.showMessage({html:"\u8bbf\u95ee evernote/\u5370\u8c61 \u670d\u52a1 api \u592a\u8fc7\u9891\u7e41\uff0c\u8d85\u8fc7\u6700\u5927\u9650\u5236\uff0c\u8bf7\u8fc7 "+e.orign.rateLimitDuration+" \u79d2("+Math.round(e.orign.rateLimitDuration/60)+" \u5206\u949f)\u540e\u518d\u8fdb\u884c\u8bbf\u95ee\u3002 \u67e5\u770b<a href='https://dev.yinxiang.com/doc/articles/rate_limits.php' target='_blank'>\u5b98\u65b9\u8bf4\u660e</a>"},3e3,"error")},s=function(){function e(e){this.name=e.name,this.displayName=e.displayName,this.icon=e.icon,this.logo=e.logo,this.production=e.production,this.description=e.description,this.serviceHost=e.serviceHost,this.sandbox=e.sandbox,this.serviceType=e.serviceType,this.authType=e.authType,this.inputTokenTip=e.inputTokenTip,this.kind=e.kind||"store",this.platform=e.platform||"all"}return e.prototype.name="",e.prototype.kind="store",e.prototype.platform="all",e.prototype.displayName="",e.prototype.virtualPathMap={},e.prototype.storePluginModel=null,e.prototype.init=function(e){return e?(this.postBaseData={pluginName:e.get("name"),entryToken:e.get("entryToken"),entryTokenSecret:e.get("entryTokenSecret"),extraInfo:e.get("extraInfo")},this.storePluginModel=e):this.postBaseData={}},e.prototype.getDisplayName=function(){var e;return this.storePluginModel&&(e=this.storePluginModel.get("displayName")),e||this.displayName},e.prototype.authenticate=function(e){var t,n;return n="/redirect?version=2&pluginName="+this.name,"client"===STORY_PLATFORM&&(n="http://markdown.xiaoshujiang.com"+n),t=window.open(n,"_blank","resizeable=true,height=400,width=400, left=200, top=30"),window.accessToken=function(n){return function(r,i,o){return n.postBaseData={pluginName:n.name,entryToken:r,entryTokenSecret:i,extraInfo:o},e(null,r,i,o,n,(function(e,t){return n.storePluginModel=t})),t.close()}}(this)},e.prototype.signOut=function(e){return this.postBaseData=null,e()},e.prototype.setting=function(e){var t,n,r,i,o,a,s,l,u,c,p,d,f,h,m,v,g,y,b;if(b=this.storePluginModel,y=this.postBaseData,b){s=b.get("extraInfo")||{};try{s=JSON.parse(this.postBaseData.extraInfo)}catch(e){a=e,console.log(a)}return f=b.get("name"),o=b.get("displayName")||f||"",d=s.lockFile||!1,r=s.checkVersionBeforeSave||!1,v=s.numberedHeading||!1,l=s.hideOrignMarkdown||!1,n=!1!==s.addOrignMarkdown,h=!(!1===s.netImage),i=r?'checked="checked"':"",p=d?'checked="checked"':"",g=v?'checked="checked"':"",u=l?'checked="checked"':"",n?'checked="checked"':"",m=h?'checked="checked"':"",c=this.icon?"<i class='large icon "+this.icon+"'></i>":"",(t=$('<div class="ui small modal">\n  <div class="header">'+c+o+' \u914d\u7f6e</div>\n  <div class="content">\n    <div class="ui form">\n      <div class="field">\n        <label >\u663e\u793a\u540d\u79f0</label>\n        <input type="text" value="'+o+'" name="displayName">\n      </div>\n      <div class="inline field">\n        <label for="numberedHeading" >\u662f\u5426\u5f3a\u5236\u6807\u9898\u81ea\u52a8\u7f16\u53f7</label>\n        <input type="checkbox" name="numberedHeading" '+g+'>\n      </div>\n      <div class="inline field">\n        <label for="checkVersionBeforeSave" >\u4fdd\u5b58\u6587\u7ae0\u524d\u67e5\u68c0\u662f\u5426\u6700\u65b0\u7248\u672c\u6587\u7ae0</label>\n        <input type="checkbox" name="checkVersionBeforeSave" '+i+'>\n      </div>\n      <div class="inline field">\n        <label for="lockFile" >\u4fdd\u62a4\u6587\u6863</label>\n        <input type="checkbox" name="lockFile" '+p+'>\n      </div>\n      <div class="inline field">\n        <label for="hideOrignMarkdown" >\u9690\u85cf\u539f markdown \u6587\u4ef6</label>\n        <input type="checkbox" name="hideOrignMarkdown" '+u+'>\n      </div>\n      <div class="inline field">\n        <label for="netImage" >\u8f6c\u6362\u7f51\u7edc\u56fe\u7247</label>\n        <input type="checkbox" name="netImage" '+m+'>\n      </div>\n    </div>\n\n  </div>\n  <div class="actions">\n    <div class="ui basic cancel right button">\n      \u53d6\u6d88\n    </div>\n    <div class="ui basic positive right button">\n      \u786e\u5b9a\n    </div>\n  </div>\n</div>')).modal({allowMultiple:!0,closable:!1,onApprove:function(){var n;return o=t.find("input[name=displayName]").val(),r=t.find("input[name=checkVersionBeforeSave]").is(":checked"),d=t.find("input[name=lockFile]").is(":checked"),v=t.find("input[name=numberedHeading]").is(":checked"),l=t.find("input[name=hideOrignMarkdown]").is(":checked"),h=t.find("input[name=netImage]").is(":checked"),s.checkVersionBeforeSave=r,s.lockFile=d,s.numberedHeading=v,s.hideOrignMarkdown=l,s.addOrignMarkdown=!0,s.netImage=h,n=JSON.stringify(s),y.extraInfo=n,b.set("extraInfo",n),b.set("displayName",o),b.save(),"function"==typeof e?e(null,b):void 0},onHidden:function(){return t.modal("destroy"),t.remove(),t=null}}),t.modal("show")}},e.prototype.getContextMenu=function(){return{menu:function(e,t){return e.isChild?{refreshFile:{name:"\u66f4\u65b0\u672c\u5730\u7f13\u5b58\u6587\u4ef6",icon:"fas fa-download"},copyLink:{name:"\u590d\u5236\u94fe\u63a5",icon:"fas fa-link"},viewOrign:{name:"\u5728evernote(\u5370\u8c61\u7b14\u8bb0)\u4e2d\u6253\u5f00",icon:"fas fa-external-link-alt"},deleteFile:{name:"\u5220\u9664\u6587\u4ef6",icon:"fas fa-trash"}}:{}},actions:{viewOrign:(e=this,function(t,n){var r,i,o,a,s;if(i=null,s=null,e.postBaseData.extraInfo)try{i=JSON.parse(e.postBaseData.extraInfo)}catch(e){r=e,console.log(r)}if(i&&((s=i.edam_webApiUrlPrefix)||(o=i.shardId)&&("yinxiang"===e.postBaseData.pluginName?s="https://app.yinxiang.com/shard/"+o+"/":"evernote"===e.postBaseData.pluginName&&(s="https://www.evernote.com/shard/"+o+"/"))),s)return a=s+"view/notebook/"+t.guid,"evernote"===e.postBaseData.pluginName&&(a="https://www.evernote.com/client/web#?b="+t.parentPath+"&n="+t.guid+"&"),"client"===STORY_PLATFORM?require("nw.gui").Shell.openExternal(a):window.open(a,"_blank")}),deleteFile:function(e){return function(t,n){return a.showHandling("\u5220\u9664\u4e2d..."),e.deleteFile({},t,(function(){return a.hideHandling(),n()}))}}(this),copyLink:function(e){return function(t,n){var r,i,o,s,l;if(s=null,e.postBaseData.extraInfo)try{s=JSON.parse(e.postBaseData.extraInfo)}catch(e){r=e,console.log(r)}if(s)return i=s.edam_shard,o=s.edam_userId,l="["+t.name+"](evernote:///view/"+o+"/"+i+"/"+t.guid+"/"+t.guid+")",$(document).one("copy",(function(e){return e.preventDefault(),e.stopPropagation(),e.originalEvent.clipboardData.setData("text/plain",l)})),document.execCommand("copy"),a.showMessage("\u590d\u5236\u6210\u529f")}}(this)}};var e},e.prototype.getAccountInfo=function(e){var t,n;return t=$.extend({},this.postBaseData,{operateType:"getAccountInfo"}),$.ajax({url:"/plugin",data:t,success:(n=this,function(t,r,i){var o,a,s;try{o=JSON.parse(t)}catch(e){a=e,o=t}if(o.error)return p(o),e(o);try{(s=JSON.parse(n.postBaseData.extraInfo)).shardId=o.shardId,n.postBaseData.extraInfo=JSON.stringify(s)}catch(e){a=e,console.log(a),(s={}).shardId=o.shardId,n.postBaseData.extraInfo=JSON.stringify(s)}return e(null,o)}),error:function(t){return e(t)}})},e.prototype.getFileMeta=function(e,t,n){var r,i;return r=$.extend({},this.postBaseData,{parentPath:t.parentPath,guid:t.guid,operateType:"getFileMeta"}),$.getJSON("/plugin",r,(i=this,function(e,r,o){return e.error?(p(e),n(e.error),void console.log("\u52a0\u8f7d\u6587\u4ef6\u51fa\u9519"+e.error)):(t=$.extend(e,i.postBaseData),n(null,{guid:e.guid,parentPath:e.parentPath,name:e.name}))}))},e.prototype.getFile=function(e,t,n){var r,i;return r=$.extend({},this.postBaseData,{parentPath:t.parentPath,guid:t.guid,operateType:"getFile"}),$.getJSON("/plugin",r,(i=this,function(e,r,o){var a,s;return e.error?(p(e),n(e.error),void console.log("\u52a0\u8f7d\u6587\u4ef6\u51fa\u9519"+e.error)):(s=e.resources,a=[],s&&$.each(s,(function(e,t){var n,r;return r={name:e,type:(n=c.dataURL2Blob(t)).type,blob:n},a.push(r)})),t=$.extend(e,i.postBaseData),e.markdownContent||(e.markdownContent=c.html2markdown(e.htmlContent)),n(null,{guid:e.guid,parentPath:e.parentPath,markdownContent:e.markdownContent,cssText:e.cssText||"",htmlContent:e.htmlContent,resources:a,tagNames:e.tagNames,name:e.name}))}))},e.prototype.getVirtualPath=function(e){return this.virtualPathMap[e]||e},e.prototype.deleteFile=function(e,t,n){var r;return r=$.extend({},this.postBaseData,{parentPath:t.parentPath,guid:t.guid,operateType:"deleteFile"}),$.getJSON("/plugin",r,(function(e,t,r){return e.error?(p(e),n(e.error),void console.log("\u5220\u9664\u6587\u4ef6\u51fa\u9519"+e.error)):n(null)}))},e.prototype.searchFiles=function(e,t,n){var r,i,o,s,l;return r=t.parentPath,s=t.query,l=t.tags,i=t.offset||0,o=t.pageSize||30,this,$.ajax({url:"/plugin",data:$.extend({},this.postBaseData,{operateType:"searchFiles",parentPath:r,query:s,tags:l,offset:i,pageSize:o}),dataType:"json",success:function(e,t,r){var i;if(e.code){try{i=JSON.stringify(e)}catch(t){t,i=e}return p(e),a.showMessage("\u52a0\u8f7d\u6587\u4ef6\u5217\u8868\u51fa\u73b0\u9519\u8bef"+i,3e3,"error"),n(i)}return n(null,e)},error:function(e,t){return a.showMessage("\u52a0\u8f7d\u6587\u4ef6\u5217\u8868\u51fa\u73b0\u9519\u8bef"+t,3e3,"error"),n(e)}})},e.prototype.listTags=function(e,t,n){return this,$.ajax({url:"/plugin",data:$.extend({},this.postBaseData,{operateType:"listTags"}),dataType:"json",success:function(e,t,r){var i;if(e.code){try{i=JSON.stringify(e)}catch(t){t,i=e}return p(e),a.showMessage("\u52a0\u8f7d\u6807\u7b7e\u5217\u8868\u51fa\u73b0\u9519\u8bef"+i,3e3,"error"),n(i)}return n(null,e)},error:function(e,t){return a.showMessage("\u52a0\u8f7d\u6807\u7b7e\u5217\u8868\u51fa\u73b0\u9519\u8bef"+t,3e3,"error"),n(e)}})},e.prototype.listSearchs=function(e,t,n){return this,$.ajax({url:"/plugin",data:$.extend({},this.postBaseData,{operateType:"listSearchs"}),dataType:"json",success:function(e,t,r){var i;if(e.code){try{i=JSON.stringify(e)}catch(t){t,i=e}return p(e),a.showMessage("\u52a0\u8f7d\u67e5\u8be2\u5217\u8868\u51fa\u73b0\u9519\u8bef"+i,3e3,"error"),n(i)}return n(null,e)},error:function(e,t){return a.showMessage("\u52a0\u8f7d\u67e5\u8be2\u5217\u8868\u51fa\u73b0\u9519\u8bef"+t,3e3,"error"),n(e)}})},e.prototype.createSearch=function(e,t,n){return this,$.ajax({type:"post",url:"/plugin",data:$.extend({},this.postBaseData,{operateType:"createSearch",name:t.name,query:t.query}),dataType:"json",success:function(e,t,r){var i;if(e.code){try{i=JSON.stringify(e)}catch(t){t,i=e}return p(e),a.showMessage("\u521b\u5efa\u5feb\u901f\u67e5\u8be2\u51fa\u73b0\u9519\u8bef"+i,3e3,"error"),n(i)}return n(null,e)},error:function(e,t){return a.showMessage("\u521b\u5efa\u5feb\u901f\u67e5\u8be2\u51fa\u73b0\u9519\u8bef"+t,3e3,"error"),n(e)}})},e.prototype.listFiles=function(e,t,n){var r,i,o;return r=t.parentPath,i=t.pageSize||0,o=this,$.ajax({url:"/plugin",data:$.extend({},this.postBaseData,{operateType:"listFiles",parentPath:r,pageSize:i}),dataType:"json",success:function(e,t,r){var i;if(e.code){try{i=JSON.stringify(e)}catch(t){t,i=e}return p(e),a.showMessage("\u52a0\u8f7d\u6587\u4ef6\u5217\u8868\u51fa\u73b0\u9519\u8bef"+i,3e3,"error"),n(i)}return e.forEach((function(e){if(e.obj&&e.obj.isVirtualNode&&e.children)return e.children.forEach((function(t){return o.virtualPathMap[t.key]=e.key+"/"+t.key}))})),n(null,e)},error:function(e,t){return a.showMessage("\u52a0\u8f7d\u6587\u4ef6\u5217\u8868\u51fa\u73b0\u9519\u8bef"+t,3e3,"error"),n(e)}})},e.prototype.beforeSaveFile=function(e,t,n,i){var s,l,u,p,d,f;return s=t.get("guid"),l=t.get("parentPath"),u=$.extend({},this.postBaseData,{parentPath:l,guid:s,operateType:"getFile"}),d=t.get("title"),p=t.get("tagNames"),a.showHandling("\u68c0\u67e5\u7248\u672c\u4e2d..."),$.getJSON("/plugin",u,(f=this,function(e,n,s){var l,u,h,m,v,g,y,b,x,w,k,A;if(e.error)return i(e.error),void console.log("\u52a0\u8f7d\u6587\u4ef6\u51fa\u9519"+e.error);if(w=e.resources,h=[],w&&$.each(w,(function(e,t){var n,r;return r={name:e,type:(n=c.dataURL2Blob(t)).type,blob:n},h.push(r)})),$.extend(e,f.postBaseData),e.markdownContent,b="",l="",p&&p.length>0&&(l=p.sort().join(",")),x=e.name,u=d,A=function(){var e,n,o;return(e=r.homeView.editorView.getActiveEditorProxy())&&e.fileModel===t&&(n=t.get("content"),o=c.setMetaData(n,"title",x,!0),n!==(o=c.setMetaData(o,"tags",b,!0))&&e.setValue(o)),t.saveTitleAndTagsMeta(x,b,{success:function(){return i()},error:function(e){return i()}})},k=function(){var e;return(e=$('<div class="ui small modal">\n  <i class="close icon"></i>\n  <div class="header">\n    \u670d\u52a1\u5668\u6807\u9898(\u6807\u7b7e) \u88ab\u5176\u4ed6\u5ba2\u6237\u7aef\u4fee\u6539\u8fc7\uff0c\u662f\u5426\u8986\u76d6\uff1f\n  </div>\n  <div class="content">\n    <div class="ui raised segment">\n      <div class="ui green ribbon label">\n        <i class="icon server"></i> \u670d\u52a1\u5668\u7248\u672c\n      </div>\n      <div class="basic ui segment">\n        <div class="ui right floated green button use_remote_button">\u4f7f\u7528\u670d\u52a1\u5668\u7248\u672c</div>\n        <h3 class="ui header">\u6807\u9898: '+x+"</h3>\n        <h5>\u6807\u7b7e: "+b+'</h5>\n      </div>\n    </div>\n    <div class="ui raised segment">\n      <div class="ui brown ribbon label">\n        <i class="file alternate outline icon"></i> \u672c\u5730\u7f16\u8f91\u7248\u672c\n      </div>\n      <div class="basic ui segment">\n        <div class="ui right floated button brown use_local_button">\u4f7f\u7528\u672c\u5730\u7248\u672c</div>\n        <h3 class="ui header">\u6807\u9898: '+u+"</h3>\n        <h5>\u6807\u7b7e: "+l+'</h5>\n      </div>\n    </div>\n  </div>\n  <div class="actions">\n    <div class="ui close button cancel">\n      \u5173\u95ed\n    </div>\n  </div>\n</div>')).modal({closable:!1,onHidden:function(){return a.hideHandling(),e.off("click"),e.remove(),e=null}}).modal("show"),e.on("click",".use_remote_button",(function(t){return t.preventDefault(),t.stopPropagation(),A(),e.modal("hide")})).on("click",".use_local_button",(function(t){return t.preventDefault(),t.stopPropagation(),i(),e.modal("hide")}))},m=o.getMeta(e.markdownContent),e.tagNames&&e.tagNames.length>0&&(b=e.tagNames.sort().join(",")),m&&(m.title||m.tags)){if(g="",y="",v=!1,m.tags&&("string"==typeof m.tags&&(m.tags=m.tags.split(",")),m.tags.length>0&&(g=m.tags.sort().join(",")),v=b!==g),m.title&&(y=m.title,v||(v=x!==y)),v&&(x!==u||b!==l))return k()}else if(x!==u||l!==b)return k();return i()}))},e.prototype.saveFile=function(e,t,n,o){var s,l,d,f,h,m,v,g;h=t.get("pluginName"),d=t.get("guid"),v=t.get("title"),f=t.get("parentPath"),h!==this.name&&(d="",h="",f=""),m=n.saveAs;try{s=JSON.parse(this.postBaseData.extraInfo)}catch(e){e,s={netImage:!0,numberedHeading:!1}}return g=this,l=function(e,n,l){var u,d,f;return a.showHandling("\u4fdd\u5b58\u4e2d..."),f=setTimeout((function(){return a.hideHandling()}),i.getNetworkResourceTimeout),d={pluginName:g.name,entryToken:g.postBaseData.entryToken,operateType:"saveFile",parentPath:e||"",guid:n||"",title:l,fileMarkdownContent:t.get("content")||"",fileHtmlContent:"",fileModel:t.toJSONWithSkipAttachmentData()},d=$.extend({},g.postBaseData,d),u={brand:"xsj_plugin_"+g.name,type:"dataURL",netImage:s.netImage,changeOpenTarget:!0},s.numberedHeading&&(u.renderNumberedHeading=!0),$(window).trigger("convertPreviewFormatForExport",[t,u,function(e,n){return n.find(".li_linenum_before_span").remove(),n.find(".li_linenum").addClass("li_list_style"),n.find("img").map((function(e,t){var n,r,i,o;if(i=(n=$(t)).attr("src"),r=n.attr("name"),o=n.attr("title"),r&&0===i.indexOf("data:image/svg"))return n.after('<div class="component_attachment" style="display:none;">\n<a class=\'attachment table_attachment\' href=\''+i+"' name='"+r+"' title='"+o+'\'>\n  <i class="fa fa-paperclip"></i>\n</a>\n</div>')})),r.getStyleText(t,(function(e,t){return c.inlineStylesheet(n.html(),t,(function(e,t){return t=(t+="").replace(/[\x00-\x08\x0B-\x0C\x0E-\x1F\x7F-\x9F]/g,""),d.fileHtmlContent=t,$.ajax({type:"post",url:"/plugin",data:d,dataType:"json",success:function(e,t,n){var r;return clearTimeout(f),f=null,a.hideHandling(),e.code?(p(e),a.showMessage("\u4fdd\u5b58\u5931\u8d25: "+e.error,6e3,"error"),o(e,null)):(r={guid:e.guid,parentPath:e.parentPath,name:e.name,tagNames:e.tagNames,createDate:e.createDate,updateDate:e.updateDate,isChild:!0},o(null,r,g))},error:function(e){return a.hideHandling(),o(e)}})}))}))}])},!d||m?new u({plugin:this,saveAs:m,saveAsCallback:o,fileModel:t}).show((function(e,t,n){return l(e,t,n)})):s.checkVersionBeforeSave?this.beforeSaveFile(e,t,n,(function(){return l(f,d,v)})):l(f,d,v)},e}(),n.exports=s}}),window.requirejs.define({"plugins/remote_resource_plugin":function(e,t,n){var r,i,o;o=t("../../lib/utils"),r=t("../../lib/notifier"),t("../../application"),t("../../constant"),i=function(){function e(e){this.name=e.name,this.displayName=e.displayName,this.icon=e.icon,this.logo=e.logo,this.production=e.production,this.description=e.description,this.serviceHost=e.serviceHost,this.sandbox=e.sandbox,this.serviceType=e.serviceType,this.authType=e.authType,this.inputTokenTip=e.inputTokenTip,this.platform=e.platform||"all"}return e.prototype.name="",e.prototype.kind="resource",e.prototype.platfrom="all",e.prototype.displayName="",e.prototype.storePluginModel=null,e.prototype.init=function(e){return e?(this.storePluginModel=e,this.postBaseData={pluginName:e.get("name"),entryToken:e.get("entryToken"),entryTokenSecret:e.get("entryTokenSecret"),extraInfo:e.get("extraInfo")}):this.postBaseData={}},e.prototype.authenticate=function(e){var t,n,r;return"inputToken"===this.authType?(t=$('<div class="ui small modal">\n  <div class="header">\u8bf7\u8f93\u5165\u6709\u6548\u7684token</div>\n  <div class="content">\n    <div class="ui fluid input">\n      <input type="text" name="token" placeholder="\u8bf7\u8f93\u5165\u4e00\u4e2a\u6709\u6548\u7684token">\n    </div>\n    <p>'+this.inputTokenTip+'</p>\n  </div>\n  <div class="actions">\n    <div class="ui cancel right button">\n      \u53d6\u6d88\n    </div>\n    <div class="ui positive right button">\n      \u786e\u5b9a\n    </div>\n  </div>\n  </div>')).modal({allowMultiple:!0,closable:!1,onHidden:function(){return t.remove()},onApprove:(r=this,function(){var n;return n=t.find("input[name=token]").val(),r.postBaseData={pluginName:r.name,entryToken:n,entryTokenSecret:"",extraInfo:{}},e(null,n,"",{},r),t.modal("hide"),!1})}).modal("show"):(n=window.open("/redirect?pluginName="+this.name,"_blank","resizeable=true,height=400,width=400, left=200, top=30"),window.accessToken=function(t){return function(r,i,o){return t.postBaseData={pluginName:t.name,entryToken:r,entryTokenSecret:i,extraInfo:o},e(null,r,i,o,t),n.close()}}(this))},e.prototype.signOut=function(e){return this.postBaseData=null,e()},e.prototype.getAccountInfo=function(e){var t,n;return t=this.postBaseData,n=$.extend(this.postBaseData,{operateType:"getAccountInfo"}),$.ajax({url:"/plugin",data:n,success:function(n,r,i){var o,a,s;try{o=JSON.parse(n)}catch(e){a=e,o=n}if(o.error)return e(o);try{(s=JSON.parse(t.extraInfo)).shardId=o.shardId,t.extraInfo=JSON.stringify(s)}catch(e){a=e,console.log(a),(s={}).shardId=o.shardId,t.extraInfo=JSON.stringify(s)}return e(null,o)},error:function(t){return e(t)}})},e.prototype.saveFile=function(e,t,n,i,a){var s,l;return l=this.postBaseData,s=this.name,o.blob2DataURL(n,(function(e,n){var i;return e?(r.showMessage("\u4e0a\u4f20\u5931\u8d25: "+e,6e3,"error"),a(e)):(i={pluginName:s,entryToken:l.entryToken,operateType:"saveFile",filename:t,fileData:n},$.ajax({type:"post",url:"/plugin",data:i,dataType:"json",success:function(e,t,n){return e.code?(r.showMessage("\u4e0a\u4f20\u5931\u8d25: "+e.error,6e3,"error"),a(e,null)):a(null,e.filename,e.url,e)},error:function(e,t,n){return r.showMessage("\u4e0a\u4f20\u5931\u8d25: "+t,6e3,"error"),a(t)}}))}))},e}(),n.exports=i}});
