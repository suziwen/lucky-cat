!function(){"use strict";var e="undefined"!=typeof window?window:global;if("function"!=typeof e.requirejs){var t={},n={},o=function(e,t){return{}.hasOwnProperty.call(e,t)},i=function(e,t){for(var n,o,i=[],r=0,a=(n=/^\.\.?(\/|$)/.test(t)?[e,t].join("/").split("/"):t.split("/")).length;r<a;r++)".."===(o=n[r])?i.pop():"."!==o&&""!==o&&i.push(o);return i.join("/")},r=function(t,o){var r,a={id:t,exports:{}};return n[t]=a,o(a.exports,(r=t,function(t){var n=function(e){return e.split("/").slice(0,-1).join("/")}(r),o=i(n,t);return e.requirejs(o,r)}),a),a.exports},a=function(e,n){if("object"==typeof e)for(var i in e)o(e,i)&&(t[i]=e[i]);else t[e]=n};e.requirejs=function(e,a){var s=i(e,".");if(null==a&&(a="/"),o(n,s))return n[s].exports;if(o(t,s))return r(s,t[s]);var l=i(s,"./index");if(o(n,l))return n[l].exports;if(o(t,l))return r(l,t[l]);throw new Error('Cannot find module "'+e+'" from "'+a+'"')},e.requirejs.define=a,e.requirejs.register=a,e.requirejs.list=function(){var e=[];for(var n in t)o(t,n)&&e.push(n);return e},e.requirejs.brunch=!0}}(),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("codemirror"),require("lodash")):"function"==typeof define&&define.amd?define(["exports","codemirror","lodash"],t):t((e=e||self).CodemirrorMinimap={},e.CodeMirror,e._)}(this,(function(e,t,n){"use strict";var o;t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t,(o=e.Constants||(e.Constants={}))[o.DEFAULT_SCALE=5]="DEFAULT_SCALE";var i=function(){function e(e,t){var n=this;this.$slider=document.createElement("div"),this.translateY=0,this.isMoving=!1,this.startY=0,this.startScrollTop=0,this.onMousedown=function(e){n.isMoving=!0,n.startY=e.clientY,n.startScrollTop=n.instance.$scrollContainer.scrollTop,document.addEventListener("mousemove",n.onMousemove),document.addEventListener("mouseup",n.onMouseup),document.onselectstart=function(){return!1}},this.onMouseup=function(){document.removeEventListener("mousemove",n.onMousemove),document.removeEventListener("mouseup",n.onMouseup),document.onselectstart=null},this.onMousemove=function(e){if(n.isMoving){var t=e.clientY-n.startY,o=n.instance,i=o.renderData,r=o.$scrollContainer,a=n.startScrollTop+t/(i.height-i.sliderHeight)*(r.scrollHeight-r.clientHeight);n.instance.$scrollContainer.scrollTo(0,a)}},this.render=function(){var e=n.instance.renderData,t=e.translateY,o=e.sliderHeight;n.$slider.style.height=o+"px",n.$slider.style.transform="translateY("+t+"px)"},this.cm=e,this.instance=t,this.$slider.setAttribute("class","CodeMirror-minimap__slider"),this.$slider.addEventListener("mousedown",this.onMousedown),this.instance.$root.appendChild(this.$slider)}return e.prototype.destroy=function(){this.$slider.removeEventListener("mousedown",this.onMousedown),this.$slider.parentNode&&this.$slider.parentNode.removeChild(this.$slider)},e}(),r=function(){function e(e,t){this.data=[],this.yAxisMap=[],this.height=0,this.sliderHeight=0,this.translateY=0,this.cm=e,this.instance=t}return e.prototype.calcTranslateY=function(){var e=this.instance.$scrollContainer,t=e.scrollTop,n=e.scrollHeight,o=e.clientHeight,i=this.instance.$container.clientHeight,r=this.height,a=this.sliderHeight,s=n-o+i;if(s!==i)if(r<this.instance.$canvas.height){for(var l=this.instance.viewportStartLine,d=Math.floor(l),u=0,c=0;c<d;c++)u+=this.getLineData(c).lineHeight;var f=this.getLineData(d);this.translateY=u+(l-d)*f.lineHeight}else{var h=t/(s-i);this.translateY=(r-a)*h}else this.translateY=0},e.prototype.calcHeight=function(){for(var e=this.instance.$canvas.height,t=this.cm.doc.lineCount(),n=0,o=0;n<=t-1&&o<e;){o+=this.getLineData(n).lineHeight,n++}this.height=Math.min(o,e)},e.prototype.calcSliderHeight=function(){for(var e=this.instance.viewportStartLine,t=Math.floor(e),n=this.instance.viewportEndLine,o=Math.floor(n),i=this.getLineData(t),r=(1-(e-t))*i.lineHeight,a=t+1;a<o;a++)r+=(i=this.getLineData(a)).lineHeight;r+=(n-o)*(i=this.getLineData(o)).lineHeight,this.sliderHeight=r},e.prototype.refresh=function(){this.calcTranslateY(),this.data=[],this.yAxisMap=[];var e=this.instance.$canvas.height,t=this.cm.doc.lineCount(),n=this.instance.viewportStartLine,o=Math.floor(n),i=this.getLineData(o),r=this.translateY-(n-o)*i.lineHeight;this.data.push(i),this.yAxisMap.push(r);for(var a=r,s=o-1;a>=0&&s>=0;){var l=this.getLineData(s);this.data.unshift(l),a-=l.lineHeight,this.yAxisMap.unshift(a),s--}for(a=r+i.lineHeight,s=o+1;a<=e&&s<t;){l=this.getLineData(s);this.data.push(l),this.yAxisMap.push(a),a+=l.lineHeight,s++}this.yAxisMap.push(a)},e.prototype.checkFolded=function(e){return!!e.markedSpans&&e.markedSpans.some((function(t){var n=t.marker;return n.__isFold&&n.lines.indexOf(e)>0}))},e.prototype.getLineData=function(e){var t=[],n=this.instance.baseLineHeight,o=this.cm.getLineHandle(e),i=this.cm.getLineTokens(e);if(!o||this.checkFolded(o))return{lineHeight:0,tokenData:t,line:e,handle:o};for(var r=0,a=i.length;r<a;r++){var s=i[r],l=this.instance.getFontInfoFromTokenType(s.type);n=Math.max(l.fontSize,n),t.push({fontInfo:l,text:s.string})}return{lineHeight:n,tokenData:t,line:e,handle:o}},e.prototype.dispatchChange=function(){this.calcHeight(),this.calcSliderHeight()},e.prototype.dispatchViewportChange=function(){this.calcSliderHeight()},e}(),a=function(){function e(e,t,o){var a=this;this.$root=document.createElement("div"),this.$canvas=document.createElement("canvas"),this.fontInfoMap=new Map,this.onWheel=function(e){var t=e.deltaY,n=a,o=n.renderData,i=n.$scrollContainer,r=i.scrollTop;if(e.shiftKey){var s=r+t/(o.height-o.sliderHeight)*(i.scrollHeight-i.clientHeight);i.scrollTo(0,s)}else i.scrollTo(0,r+t)},this.onClick=function(e){var t=a,n=t.renderData,o=t.$scrollContainer,i=a.$scrollContainer.getBoundingClientRect(),r=(e.clientY-i.y-n.sliderHeight/2)/(n.height-n.sliderHeight)*(o.scrollHeight-o.clientHeight);a.$scrollContainer.scrollTo(0,r)},this.render=n.throttle((function(){a.renderData.refresh(),setTimeout((function(){var e=a.$canvas,t=e.width,n=e.height;a.$canvas.getContext("2d").clearRect(0,0,t,n);for(var o=0,i=a.renderData.data.length;o<i;o++)a.renderLine(o);a.slider.render()}))}),1e3/60),this.cm=e,this.$container=this.cm.getWrapperElement(),this.$root.setAttribute("class","CodeMirror-minimap"),this.$canvas.setAttribute("class","CodeMirror-minimap__canvas"),this.$root.appendChild(this.$canvas),o?o.appendChild(this.$root):this.$container.appendChild(this.$root),this.$scrollContainer=this.cm.getScrollerElement(),this.scale=t;var s=this.getFontInfoFromTokenType(null).fontSize;this.baseLineHeight=s,this.slider=new i(this.cm,this),this.renderData=new r(this.cm,this),this.$canvas.addEventListener("click",this.onClick),this.$root.addEventListener("wheel",this.onWheel)}Object.defineProperty(e.prototype,"viewportStartLine",{get:function(){var e=this.$container.getBoundingClientRect().top,t=this.cm.lineAtHeight(e),n=this.cm.getLineHandle(t);return n?t+Math.max((e-this.cm.heightAtLine(t))/n.height,0):t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"viewportEndLine",{get:function(){var e=this.$container.getBoundingClientRect().bottom,t=this.cm.lineAtHeight(e),n=this.cm.getLineHandle(t);return n?t+Math.max((e-this.cm.heightAtLine(t))/n.height,0):t},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){this.slider.destroy(),this.$canvas.removeEventListener("click",this.onClick),this.$canvas.parentNode&&this.$canvas.parentNode.removeChild(this.$canvas),this.$root.removeEventListener("wheel",this.onWheel),this.$root.parentNode&&this.$root.parentNode.removeChild(this.$root)},e.prototype.renderLine=function(e){var t=this.$canvas.getContext("2d");t.textBaseline="bottom";var n=this.renderData.data[e],o=n.lineHeight,i=n.tokenData,r=this.renderData.yAxisMap[e];if(o<=0)return 0;if(0===i.length)return this.baseLineHeight;for(var a=0,s=0,l=i.length;s<l;s++){var d=i[s],u=d.fontInfo,c=u.font,f=u.color,h=d.text;if(t.font=c,t.fillStyle=f,t.fillText(h,a,r+o),(a+=t.measureText(h).width)>this.$canvas.width)break}},e.prototype.getFontInfoFromTokenType=function(e){if(void 0===e&&(e=null),this.fontInfoMap.has(e))return this.fontInfoMap.get(e);var t=document.createElement("span");if(e){var n=e.split(/\s+/).map((function(e){return e.startsWith("ace_")?e:"cm-"+e}));t.setAttribute("class",n.join(" "))}this.$container.appendChild(t);var o=window.getComputedStyle(t),i=Math.floor(parseFloat(o.fontSize)/this.scale),r={font:o.fontStyle+" "+o.fontWeight+" "+i+"px "+o.fontFamily,fontSize:i,color:o.color};return this.fontInfoMap.set(e,r),this.$container.removeChild(t),r},e.prototype.renderOnResize=function(e,t){this.$canvas.width=e,this.$canvas.height=t,this.$canvas.style.width=this.$canvas.width+"px",this.$canvas.style.height=this.$canvas.height+"px",this.renderOnChange()},e.prototype.renderOnViewportChange=function(){this.renderData.dispatchViewportChange(),this.render()};var t=_.debounce((function(e){e.renderData.dispatchChange(),e.render()}),600);return e.prototype.renderOnChange=function(){t(this)},e.prototype.clearCache=function(){this.fontInfoMap=new Map},e}(),s=function(){function t(t,o){var i=this;this.onResize=n.throttle((function(){var e=i.$container.getBoundingClientRect(),t=e.width,n=e.height;i.instance.renderOnResize(t/i.scale,n)}),50),this.onCMScroll=n.throttle((function(e){i.instance.renderOnViewportChange()}),50),this.onCMUpdate=function(){i.instance.renderOnChange()};var r=o||{},s=r.scale,l=void 0===s?e.Constants.DEFAULT_SCALE:s,d=r.replaceTarget;this.cm=t,this.scale=Math.max(2,Math.min(10,l)),this.replaceTarget=d,this.$container=this.cm.getWrapperElement(),this.instance=new a(this.cm,this.scale,d),this.onResize(),this.cm.on("refresh",this.onResize),this.cm.on("scroll",this.onCMScroll),this.cm.on("change",this.onCMUpdate)}return t.prototype.destroy=function(){this.cm.off("refresh",this.onResize),this.cm.off("scroll",this.onCMScroll),this.cm.off("change",this.onCMUpdate),this.instance.destroy(),this.replaceTarget&&this.replaceTarget.parentNode&&this.replaceTarget.parentNode.removeChild(this.replaceTarget)},t.prototype.refresh=function(){this.instance.clearCache(),this.onResize()},t}();t.defineOption("minimap",!1,(function(e,n,o){o&&o!==t.Init&&e.state.minimap&&(e.state.minimap.destroy(),e.state.minimap=null),n&&(e.state.minimap=new s(e,"object"==typeof n?n:{}))})),Object.defineProperty(e,"__esModule",{value:!0})})),
/*!
 *  howler.js v2.2.3
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */
function(){"use strict";var e=function(){this.init()};e.prototype={init:function(){var e=this||t;return e._counter=1e3,e._html5AudioPool=[],e.html5PoolSize=10,e._codecs={},e._howls=[],e._muted=!1,e._volume=1,e._canPlayEvent="canplaythrough",e._navigator="undefined"!=typeof window&&window.navigator?window.navigator:null,e.masterGain=null,e.noAudio=!1,e.usingWebAudio=!0,e.autoSuspend=!0,e.ctx=null,e.autoUnlock=!0,e._setup(),e},volume:function(e){var n=this||t;if(e=parseFloat(e),n.ctx||d(),void 0!==e&&e>=0&&e<=1){if(n._volume=e,n._muted)return n;n.usingWebAudio&&n.masterGain.gain.setValueAtTime(e,t.ctx.currentTime);for(var o=0;o<n._howls.length;o++)if(!n._howls[o]._webAudio)for(var i=n._howls[o]._getSoundIds(),r=0;r<i.length;r++){var a=n._howls[o]._soundById(i[r]);a&&a._node&&(a._node.volume=a._volume*e)}return n}return n._volume},mute:function(e){var n=this||t;n.ctx||d(),n._muted=e,n.usingWebAudio&&n.masterGain.gain.setValueAtTime(e?0:n._volume,t.ctx.currentTime);for(var o=0;o<n._howls.length;o++)if(!n._howls[o]._webAudio)for(var i=n._howls[o]._getSoundIds(),r=0;r<i.length;r++){var a=n._howls[o]._soundById(i[r]);a&&a._node&&(a._node.muted=!!e||a._muted)}return n},stop:function(){for(var e=this||t,n=0;n<e._howls.length;n++)e._howls[n].stop();return e},unload:function(){for(var e=this||t,n=e._howls.length-1;n>=0;n--)e._howls[n].unload();return e.usingWebAudio&&e.ctx&&void 0!==e.ctx.close&&(e.ctx.close(),e.ctx=null,d()),e},codecs:function(e){return(this||t)._codecs[e.replace(/^x-/,"")]},_setup:function(){var e=this||t;if(e.state=e.ctx&&e.ctx.state||"suspended",e._autoSuspend(),!e.usingWebAudio)if("undefined"!=typeof Audio)try{void 0===(new Audio).oncanplaythrough&&(e._canPlayEvent="canplay")}catch(t){e.noAudio=!0}else e.noAudio=!0;try{(new Audio).muted&&(e.noAudio=!0)}catch(e){}return e.noAudio||e._setupCodecs(),e},_setupCodecs:function(){var e=this||t,n=null;try{n="undefined"!=typeof Audio?new Audio:null}catch(t){return e}if(!n||"function"!=typeof n.canPlayType)return e;var o=n.canPlayType("audio/mpeg;").replace(/^no$/,""),i=e._navigator?e._navigator.userAgent:"",r=i.match(/OPR\/([0-6].)/g),a=r&&parseInt(r[0].split("/")[1],10)<33,s=-1!==i.indexOf("Safari")&&-1===i.indexOf("Chrome"),l=i.match(/Version\/(.*?) /),d=s&&l&&parseInt(l[1],10)<15;return e._codecs={mp3:!(a||!o&&!n.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:!!o,opus:!!n.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!n.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!n.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(n.canPlayType('audio/wav; codecs="1"')||n.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!n.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!n.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(n.canPlayType("audio/x-m4a;")||n.canPlayType("audio/m4a;")||n.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(n.canPlayType("audio/x-m4b;")||n.canPlayType("audio/m4b;")||n.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(n.canPlayType("audio/x-mp4;")||n.canPlayType("audio/mp4;")||n.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!(d||!n.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!(d||!n.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!n.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(n.canPlayType("audio/x-flac;")||n.canPlayType("audio/flac;")).replace(/^no$/,"")},e},_unlockAudio:function(){var e=this||t;if(!e._audioUnlocked&&e.ctx){e._audioUnlocked=!1,e.autoUnlock=!1,e._mobileUnloaded||44100===e.ctx.sampleRate||(e._mobileUnloaded=!0,e.unload()),e._scratchBuffer=e.ctx.createBuffer(1,1,22050);var n=function(t){for(;e._html5AudioPool.length<e.html5PoolSize;)try{var o=new Audio;o._unlocked=!0,e._releaseHtml5Audio(o)}catch(t){e.noAudio=!0;break}for(var i=0;i<e._howls.length;i++)if(!e._howls[i]._webAudio)for(var r=e._howls[i]._getSoundIds(),a=0;a<r.length;a++){var s=e._howls[i]._soundById(r[a]);s&&s._node&&!s._node._unlocked&&(s._node._unlocked=!0,s._node.load())}e._autoResume();var l=e.ctx.createBufferSource();l.buffer=e._scratchBuffer,l.connect(e.ctx.destination),void 0===l.start?l.noteOn(0):l.start(0),"function"==typeof e.ctx.resume&&e.ctx.resume(),l.onended=function(){l.disconnect(0),e._audioUnlocked=!0,document.removeEventListener("touchstart",n,!0),document.removeEventListener("touchend",n,!0),document.removeEventListener("click",n,!0),document.removeEventListener("keydown",n,!0);for(var t=0;t<e._howls.length;t++)e._howls[t]._emit("unlock")}};return document.addEventListener("touchstart",n,!0),document.addEventListener("touchend",n,!0),document.addEventListener("click",n,!0),document.addEventListener("keydown",n,!0),e}},_obtainHtml5Audio:function(){var e=this||t;if(e._html5AudioPool.length)return e._html5AudioPool.pop();var n=(new Audio).play();return n&&"undefined"!=typeof Promise&&(n instanceof Promise||"function"==typeof n.then)&&n.catch((function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")})),new Audio},_releaseHtml5Audio:function(e){var n=this||t;return e._unlocked&&n._html5AudioPool.push(e),n},_autoSuspend:function(){var e=this;if(e.autoSuspend&&e.ctx&&void 0!==e.ctx.suspend&&t.usingWebAudio){for(var n=0;n<e._howls.length;n++)if(e._howls[n]._webAudio)for(var o=0;o<e._howls[n]._sounds.length;o++)if(!e._howls[n]._sounds[o]._paused)return e;return e._suspendTimer&&clearTimeout(e._suspendTimer),e._suspendTimer=setTimeout((function(){if(e.autoSuspend){e._suspendTimer=null,e.state="suspending";var t=function(){e.state="suspended",e._resumeAfterSuspend&&(delete e._resumeAfterSuspend,e._autoResume())};e.ctx.suspend().then(t,t)}}),3e4),e}},_autoResume:function(){var e=this;if(e.ctx&&void 0!==e.ctx.resume&&t.usingWebAudio)return"running"===e.state&&"interrupted"!==e.ctx.state&&e._suspendTimer?(clearTimeout(e._suspendTimer),e._suspendTimer=null):"suspended"===e.state||"running"===e.state&&"interrupted"===e.ctx.state?(e.ctx.resume().then((function(){e.state="running";for(var t=0;t<e._howls.length;t++)e._howls[t]._emit("resume")})),e._suspendTimer&&(clearTimeout(e._suspendTimer),e._suspendTimer=null)):"suspending"===e.state&&(e._resumeAfterSuspend=!0),e}};var t=new e,n=function(e){e.src&&0!==e.src.length?this.init(e):console.error("An array of source files must be passed with any new Howl.")};n.prototype={init:function(e){var n=this;return t.ctx||d(),n._autoplay=e.autoplay||!1,n._format="string"!=typeof e.format?e.format:[e.format],n._html5=e.html5||!1,n._muted=e.mute||!1,n._loop=e.loop||!1,n._pool=e.pool||5,n._preload="boolean"!=typeof e.preload&&"metadata"!==e.preload||e.preload,n._rate=e.rate||1,n._sprite=e.sprite||{},n._src="string"!=typeof e.src?e.src:[e.src],n._volume=void 0!==e.volume?e.volume:1,n._xhr={method:e.xhr&&e.xhr.method?e.xhr.method:"GET",headers:e.xhr&&e.xhr.headers?e.xhr.headers:null,withCredentials:!(!e.xhr||!e.xhr.withCredentials)&&e.xhr.withCredentials},n._duration=0,n._state="unloaded",n._sounds=[],n._endTimers={},n._queue=[],n._playLock=!1,n._onend=e.onend?[{fn:e.onend}]:[],n._onfade=e.onfade?[{fn:e.onfade}]:[],n._onload=e.onload?[{fn:e.onload}]:[],n._onloaderror=e.onloaderror?[{fn:e.onloaderror}]:[],n._onplayerror=e.onplayerror?[{fn:e.onplayerror}]:[],n._onpause=e.onpause?[{fn:e.onpause}]:[],n._onplay=e.onplay?[{fn:e.onplay}]:[],n._onstop=e.onstop?[{fn:e.onstop}]:[],n._onmute=e.onmute?[{fn:e.onmute}]:[],n._onvolume=e.onvolume?[{fn:e.onvolume}]:[],n._onrate=e.onrate?[{fn:e.onrate}]:[],n._onseek=e.onseek?[{fn:e.onseek}]:[],n._onunlock=e.onunlock?[{fn:e.onunlock}]:[],n._onresume=[],n._webAudio=t.usingWebAudio&&!n._html5,void 0!==t.ctx&&t.ctx&&t.autoUnlock&&t._unlockAudio(),t._howls.push(n),n._autoplay&&n._queue.push({event:"play",action:function(){n.play()}}),n._preload&&"none"!==n._preload&&n.load(),n},load:function(){var e=null;if(t.noAudio)this._emit("loaderror",null,"No audio support.");else{"string"==typeof this._src&&(this._src=[this._src]);for(var n=0;n<this._src.length;n++){var i,a;if(this._format&&this._format[n])i=this._format[n];else{if("string"!=typeof(a=this._src[n])){this._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}(i=/^data:audio\/([^;,]+);/i.exec(a))||(i=/\.([^.]+)$/.exec(a.split("?",1)[0])),i&&(i=i[1].toLowerCase())}if(i||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),i&&t.codecs(i)){e=this._src[n];break}}if(e)return this._src=e,this._state="loading","https:"===window.location.protocol&&"http:"===e.slice(0,5)&&(this._html5=!0,this._webAudio=!1),new o(this),this._webAudio&&r(this),this;this._emit("loaderror",null,"No codec support for selected audio sources.")}},play:function(e,n){var o=this,i=null;if("number"==typeof e)i=e,e=null;else{if("string"==typeof e&&"loaded"===o._state&&!o._sprite[e])return null;if(void 0===e&&(e="__default",!o._playLock)){for(var r=0,a=0;a<o._sounds.length;a++)o._sounds[a]._paused&&!o._sounds[a]._ended&&(r++,i=o._sounds[a]._id);1===r?e=null:i=null}}var s=i?o._soundById(i):o._inactiveSound();if(!s)return null;if(i&&!e&&(e=s._sprite||"__default"),"loaded"!==o._state){s._sprite=e,s._ended=!1;var l=s._id;return o._queue.push({event:"play",action:function(){o.play(l)}}),l}if(i&&!s._paused)return n||o._loadQueue("play"),s._id;o._webAudio&&t._autoResume();var d=Math.max(0,s._seek>0?s._seek:o._sprite[e][0]/1e3),u=Math.max(0,(o._sprite[e][0]+o._sprite[e][1])/1e3-d),c=1e3*u/Math.abs(s._rate),f=o._sprite[e][0]/1e3,h=(o._sprite[e][0]+o._sprite[e][1])/1e3;s._sprite=e,s._ended=!1;var p=function(){s._paused=!1,s._seek=d,s._start=f,s._stop=h,s._loop=!(!s._loop&&!o._sprite[e][2])};if(!(d>=h)){var _=s._node;if(o._webAudio){var m=function(){o._playLock=!1,p(),o._refreshBuffer(s);var e=s._muted||o._muted?0:s._volume;_.gain.setValueAtTime(e,t.ctx.currentTime),s._playStart=t.ctx.currentTime,void 0===_.bufferSource.start?s._loop?_.bufferSource.noteGrainOn(0,d,86400):_.bufferSource.noteGrainOn(0,d,u):s._loop?_.bufferSource.start(0,d,86400):_.bufferSource.start(0,d,u),c!==1/0&&(o._endTimers[s._id]=setTimeout(o._ended.bind(o,s),c)),n||setTimeout((function(){o._emit("play",s._id),o._loadQueue()}),0)};"running"===t.state&&"interrupted"!==t.ctx.state?m():(o._playLock=!0,o.once("resume",m),o._clearTimer(s._id))}else{var v=function(){_.currentTime=d,_.muted=s._muted||o._muted||t._muted||_.muted,_.volume=s._volume*t.volume(),_.playbackRate=s._rate;try{var i=_.play();if(i&&"undefined"!=typeof Promise&&(i instanceof Promise||"function"==typeof i.then)?(o._playLock=!0,p(),i.then((function(){o._playLock=!1,_._unlocked=!0,n?o._loadQueue():o._emit("play",s._id)})).catch((function(){o._playLock=!1,o._emit("playerror",s._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),s._ended=!0,s._paused=!0}))):n||(o._playLock=!1,p(),o._emit("play",s._id)),_.playbackRate=s._rate,_.paused)return void o._emit("playerror",s._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");"__default"!==e||s._loop?o._endTimers[s._id]=setTimeout(o._ended.bind(o,s),c):(o._endTimers[s._id]=function(){o._ended(s),_.removeEventListener("ended",o._endTimers[s._id],!1)},_.addEventListener("ended",o._endTimers[s._id],!1))}catch(e){o._emit("playerror",s._id,e)}};"data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"===_.src&&(_.src=o._src,_.load());var g=window&&window.ejecta||!_.readyState&&t._navigator.isCocoonJS;if(_.readyState>=3||g)v();else{o._playLock=!0,o._state="loading";var y=function(){o._state="loaded",v(),_.removeEventListener(t._canPlayEvent,y,!1)};_.addEventListener(t._canPlayEvent,y,!1),o._clearTimer(s._id)}}return s._id}o._ended(s)},pause:function(e){var t=this;if("loaded"!==t._state||t._playLock)return t._queue.push({event:"pause",action:function(){t.pause(e)}}),t;for(var n=t._getSoundIds(e),o=0;o<n.length;o++){t._clearTimer(n[o]);var i=t._soundById(n[o]);if(i&&!i._paused&&(i._seek=t.seek(n[o]),i._rateSeek=0,i._paused=!0,t._stopFade(n[o]),i._node))if(t._webAudio){if(!i._node.bufferSource)continue;void 0===i._node.bufferSource.stop?i._node.bufferSource.noteOff(0):i._node.bufferSource.stop(0),t._cleanBuffer(i._node)}else isNaN(i._node.duration)&&i._node.duration!==1/0||i._node.pause();arguments[1]||t._emit("pause",i?i._id:null)}return t},stop:function(e,t){var n=this;if("loaded"!==n._state||n._playLock)return n._queue.push({event:"stop",action:function(){n.stop(e)}}),n;for(var o=n._getSoundIds(e),i=0;i<o.length;i++){n._clearTimer(o[i]);var r=n._soundById(o[i]);r&&(r._seek=r._start||0,r._rateSeek=0,r._paused=!0,r._ended=!0,n._stopFade(o[i]),r._node&&(n._webAudio?r._node.bufferSource&&(void 0===r._node.bufferSource.stop?r._node.bufferSource.noteOff(0):r._node.bufferSource.stop(0),n._cleanBuffer(r._node)):isNaN(r._node.duration)&&r._node.duration!==1/0||(r._node.currentTime=r._start||0,r._node.pause(),r._node.duration===1/0&&n._clearSound(r._node))),t||n._emit("stop",r._id))}return n},mute:function(e,n){var o=this;if("loaded"!==o._state||o._playLock)return o._queue.push({event:"mute",action:function(){o.mute(e,n)}}),o;if(void 0===n){if("boolean"!=typeof e)return o._muted;o._muted=e}for(var i=o._getSoundIds(n),r=0;r<i.length;r++){var a=o._soundById(i[r]);a&&(a._muted=e,a._interval&&o._stopFade(a._id),o._webAudio&&a._node?a._node.gain.setValueAtTime(e?0:a._volume,t.ctx.currentTime):a._node&&(a._node.muted=!!t._muted||e),o._emit("mute",a._id))}return o},volume:function(){var e,n,o,i=this,r=arguments;if(0===r.length)return i._volume;if(1===r.length||2===r.length&&void 0===r[1]){var a=i._getSoundIds(),s=a.indexOf(r[0]);s>=0?n=parseInt(r[0],10):e=parseFloat(r[0])}else r.length>=2&&(e=parseFloat(r[0]),n=parseInt(r[1],10));if(!(void 0!==e&&e>=0&&e<=1))return(o=n?i._soundById(n):i._sounds[0])?o._volume:0;if("loaded"!==i._state||i._playLock)return i._queue.push({event:"volume",action:function(){i.volume.apply(i,r)}}),i;void 0===n&&(i._volume=e),n=i._getSoundIds(n);for(var l=0;l<n.length;l++)(o=i._soundById(n[l]))&&(o._volume=e,r[2]||i._stopFade(n[l]),i._webAudio&&o._node&&!o._muted?o._node.gain.setValueAtTime(e,t.ctx.currentTime):o._node&&!o._muted&&(o._node.volume=e*t.volume()),i._emit("volume",o._id));return i},fade:function(e,n,o,i){var r=this;if("loaded"!==r._state||r._playLock)return r._queue.push({event:"fade",action:function(){r.fade(e,n,o,i)}}),r;e=Math.min(Math.max(0,parseFloat(e)),1),n=Math.min(Math.max(0,parseFloat(n)),1),o=parseFloat(o),r.volume(e,i);for(var a=r._getSoundIds(i),s=0;s<a.length;s++){var l=r._soundById(a[s]);if(l){if(i||r._stopFade(a[s]),r._webAudio&&!l._muted){var d=t.ctx.currentTime,u=d+o/1e3;l._volume=e,l._node.gain.setValueAtTime(e,d),l._node.gain.linearRampToValueAtTime(n,u)}r._startFadeInterval(l,e,n,o,a[s],void 0===i)}}return r},_startFadeInterval:function(e,t,n,o,i,r){var a=this,s=t,l=n-t,d=Math.abs(l/.01),u=Math.max(4,d>0?o/d:o),c=Date.now();e._fadeTo=n,e._interval=setInterval((function(){var i=(Date.now()-c)/o;c=Date.now(),s+=l*i,s=Math.round(100*s)/100,s=l<0?Math.max(n,s):Math.min(n,s),a._webAudio?e._volume=s:a.volume(s,e._id,!0),r&&(a._volume=s),(n<t&&s<=n||n>t&&s>=n)&&(clearInterval(e._interval),e._interval=null,e._fadeTo=null,a.volume(n,e._id),a._emit("fade",e._id))}),u)},_stopFade:function(e){var n=this._soundById(e);return n&&n._interval&&(this._webAudio&&n._node.gain.cancelScheduledValues(t.ctx.currentTime),clearInterval(n._interval),n._interval=null,this.volume(n._fadeTo,e),n._fadeTo=null,this._emit("fade",e)),this},loop:function(){var e,t,n,o=this,i=arguments;if(0===i.length)return o._loop;if(1===i.length){if("boolean"!=typeof i[0])return!!(n=o._soundById(parseInt(i[0],10)))&&n._loop;e=i[0],o._loop=e}else 2===i.length&&(e=i[0],t=parseInt(i[1],10));for(var r=o._getSoundIds(t),a=0;a<r.length;a++)(n=o._soundById(r[a]))&&(n._loop=e,o._webAudio&&n._node&&n._node.bufferSource&&(n._node.bufferSource.loop=e,e&&(n._node.bufferSource.loopStart=n._start||0,n._node.bufferSource.loopEnd=n._stop,o.playing(r[a])&&(o.pause(r[a],!0),o.play(r[a],!0)))));return o},rate:function(){var e,n,o,i=this,r=arguments;if(0===r.length)n=i._sounds[0]._id;else if(1===r.length){var a=i._getSoundIds(),s=a.indexOf(r[0]);s>=0?n=parseInt(r[0],10):e=parseFloat(r[0])}else 2===r.length&&(e=parseFloat(r[0]),n=parseInt(r[1],10));if("number"!=typeof e)return(o=i._soundById(n))?o._rate:i._rate;if("loaded"!==i._state||i._playLock)return i._queue.push({event:"rate",action:function(){i.rate.apply(i,r)}}),i;void 0===n&&(i._rate=e),n=i._getSoundIds(n);for(var l=0;l<n.length;l++)if(o=i._soundById(n[l])){i.playing(n[l])&&(o._rateSeek=i.seek(n[l]),o._playStart=i._webAudio?t.ctx.currentTime:o._playStart),o._rate=e,i._webAudio&&o._node&&o._node.bufferSource?o._node.bufferSource.playbackRate.setValueAtTime(e,t.ctx.currentTime):o._node&&(o._node.playbackRate=e);var d=i.seek(n[l]),u=(i._sprite[o._sprite][0]+i._sprite[o._sprite][1])/1e3-d,c=1e3*u/Math.abs(o._rate);!i._endTimers[n[l]]&&o._paused||(i._clearTimer(n[l]),i._endTimers[n[l]]=setTimeout(i._ended.bind(i,o),c)),i._emit("rate",o._id)}return i},seek:function(){var e,n,o=this,i=arguments;if(0===i.length)o._sounds.length&&(n=o._sounds[0]._id);else if(1===i.length){var r=o._getSoundIds(),a=r.indexOf(i[0]);a>=0?n=parseInt(i[0],10):o._sounds.length&&(n=o._sounds[0]._id,e=parseFloat(i[0]))}else 2===i.length&&(e=parseFloat(i[0]),n=parseInt(i[1],10));if(void 0===n)return 0;if("number"==typeof e&&("loaded"!==o._state||o._playLock))return o._queue.push({event:"seek",action:function(){o.seek.apply(o,i)}}),o;var s=o._soundById(n);if(s){if(!("number"==typeof e&&e>=0)){if(o._webAudio){var l=o.playing(n)?t.ctx.currentTime-s._playStart:0,d=s._rateSeek?s._rateSeek-s._seek:0;return s._seek+(d+l*Math.abs(s._rate))}return s._node.currentTime}var u=o.playing(n);u&&o.pause(n,!0),s._seek=e,s._ended=!1,o._clearTimer(n),o._webAudio||!s._node||isNaN(s._node.duration)||(s._node.currentTime=e);var c=function(){u&&o.play(n,!0),o._emit("seek",n)};if(u&&!o._webAudio){var f=function(){o._playLock?setTimeout(f,0):c()};setTimeout(f,0)}else c()}return o},playing:function(e){if("number"==typeof e){var t=this._soundById(e);return!!t&&!t._paused}for(var n=0;n<this._sounds.length;n++)if(!this._sounds[n]._paused)return!0;return!1},duration:function(e){var t=this._duration,n=this._soundById(e);return n&&(t=this._sprite[n._sprite][1]/1e3),t},state:function(){return this._state},unload:function(){for(var e=this,n=e._sounds,o=0;o<n.length;o++)n[o]._paused||e.stop(n[o]._id),e._webAudio||(e._clearSound(n[o]._node),n[o]._node.removeEventListener("error",n[o]._errorFn,!1),n[o]._node.removeEventListener(t._canPlayEvent,n[o]._loadFn,!1),n[o]._node.removeEventListener("ended",n[o]._endFn,!1),t._releaseHtml5Audio(n[o]._node)),delete n[o]._node,e._clearTimer(n[o]._id);var r=t._howls.indexOf(e);r>=0&&t._howls.splice(r,1);var a=!0;for(o=0;o<t._howls.length;o++)if(t._howls[o]._src===e._src||e._src.indexOf(t._howls[o]._src)>=0){a=!1;break}return i&&a&&delete i[e._src],t.noAudio=!1,e._state="unloaded",e._sounds=[],e=null,null},on:function(e,t,n,o){var i=this["_on"+e];return"function"==typeof t&&i.push(o?{id:n,fn:t,once:o}:{id:n,fn:t}),this},off:function(e,t,n){var o=this["_on"+e],i=0;if("number"==typeof t&&(n=t,t=null),t||n)for(i=0;i<o.length;i++){var r=n===o[i].id;if(t===o[i].fn&&r||!t&&r){o.splice(i,1);break}}else if(e)this["_on"+e]=[];else{var a=Object.keys(this);for(i=0;i<a.length;i++)0===a[i].indexOf("_on")&&Array.isArray(this[a[i]])&&(this[a[i]]=[])}return this},once:function(e,t,n){return this.on(e,t,n,1),this},_emit:function(e,t,n){for(var o=this["_on"+e],i=o.length-1;i>=0;i--)o[i].id&&o[i].id!==t&&"load"!==e||(setTimeout(function(e){e.call(this,t,n)}.bind(this,o[i].fn),0),o[i].once&&this.off(e,o[i].fn,o[i].id));return this._loadQueue(e),this},_loadQueue:function(e){if(this._queue.length>0){var t=this._queue[0];t.event===e&&(this._queue.shift(),this._loadQueue()),e||t.action()}return this},_ended:function(e){var n=e._sprite;if(!this._webAudio&&e._node&&!e._node.paused&&!e._node.ended&&e._node.currentTime<e._stop)return setTimeout(this._ended.bind(this,e),100),this;var o=!(!e._loop&&!this._sprite[n][2]);if(this._emit("end",e._id),!this._webAudio&&o&&this.stop(e._id,!0).play(e._id),this._webAudio&&o){this._emit("play",e._id),e._seek=e._start||0,e._rateSeek=0,e._playStart=t.ctx.currentTime;var i=1e3*(e._stop-e._start)/Math.abs(e._rate);this._endTimers[e._id]=setTimeout(this._ended.bind(this,e),i)}return this._webAudio&&!o&&(e._paused=!0,e._ended=!0,e._seek=e._start||0,e._rateSeek=0,this._clearTimer(e._id),this._cleanBuffer(e._node),t._autoSuspend()),this._webAudio||o||this.stop(e._id,!0),this},_clearTimer:function(e){if(this._endTimers[e]){if("function"!=typeof this._endTimers[e])clearTimeout(this._endTimers[e]);else{var t=this._soundById(e);t&&t._node&&t._node.removeEventListener("ended",this._endTimers[e],!1)}delete this._endTimers[e]}return this},_soundById:function(e){for(var t=0;t<this._sounds.length;t++)if(e===this._sounds[t]._id)return this._sounds[t];return null},_inactiveSound:function(){this._drain();for(var e=0;e<this._sounds.length;e++)if(this._sounds[e]._ended)return this._sounds[e].reset();return new o(this)},_drain:function(){var e=this._pool,t=0,n=0;if(!(this._sounds.length<e)){for(n=0;n<this._sounds.length;n++)this._sounds[n]._ended&&t++;for(n=this._sounds.length-1;n>=0;n--){if(t<=e)return;this._sounds[n]._ended&&(this._webAudio&&this._sounds[n]._node&&this._sounds[n]._node.disconnect(0),this._sounds.splice(n,1),t--)}}},_getSoundIds:function(e){if(void 0===e){for(var t=[],n=0;n<this._sounds.length;n++)t.push(this._sounds[n]._id);return t}return[e]},_refreshBuffer:function(e){return e._node.bufferSource=t.ctx.createBufferSource(),e._node.bufferSource.buffer=i[this._src],e._panner?e._node.bufferSource.connect(e._panner):e._node.bufferSource.connect(e._node),e._node.bufferSource.loop=e._loop,e._loop&&(e._node.bufferSource.loopStart=e._start||0,e._node.bufferSource.loopEnd=e._stop||0),e._node.bufferSource.playbackRate.setValueAtTime(e._rate,t.ctx.currentTime),this},_cleanBuffer:function(e){var n=t._navigator&&t._navigator.vendor.indexOf("Apple")>=0;if(t._scratchBuffer&&e.bufferSource&&(e.bufferSource.onended=null,e.bufferSource.disconnect(0),n))try{e.bufferSource.buffer=t._scratchBuffer}catch(e){}return e.bufferSource=null,this},_clearSound:function(e){/MSIE |Trident\//.test(t._navigator&&t._navigator.userAgent)||(e.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var o=function(e){this._parent=e,this.init()};o.prototype={init:function(){var e=this._parent;return this._muted=e._muted,this._loop=e._loop,this._volume=e._volume,this._rate=e._rate,this._seek=0,this._paused=!0,this._ended=!0,this._sprite="__default",this._id=++t._counter,e._sounds.push(this),this.create(),this},create:function(){var e=this._parent,n=t._muted||this._muted||this._parent._muted?0:this._volume;return e._webAudio?(this._node=void 0===t.ctx.createGain?t.ctx.createGainNode():t.ctx.createGain(),this._node.gain.setValueAtTime(n,t.ctx.currentTime),this._node.paused=!0,this._node.connect(t.masterGain)):t.noAudio||(this._node=t._obtainHtml5Audio(),this._errorFn=this._errorListener.bind(this),this._node.addEventListener("error",this._errorFn,!1),this._loadFn=this._loadListener.bind(this),this._node.addEventListener(t._canPlayEvent,this._loadFn,!1),this._endFn=this._endListener.bind(this),this._node.addEventListener("ended",this._endFn,!1),this._node.src=e._src,this._node.preload=!0===e._preload?"auto":e._preload,this._node.volume=n*t.volume(),this._node.load()),this},reset:function(){var e=this._parent;return this._muted=e._muted,this._loop=e._loop,this._volume=e._volume,this._rate=e._rate,this._seek=0,this._rateSeek=0,this._paused=!0,this._ended=!0,this._sprite="__default",this._id=++t._counter,this},_errorListener:function(){this._parent._emit("loaderror",this._id,this._node.error?this._node.error.code:0),this._node.removeEventListener("error",this._errorFn,!1)},_loadListener:function(){var e=this._parent;e._duration=Math.ceil(10*this._node.duration)/10,0===Object.keys(e._sprite).length&&(e._sprite={__default:[0,1e3*e._duration]}),"loaded"!==e._state&&(e._state="loaded",e._emit("load"),e._loadQueue()),this._node.removeEventListener(t._canPlayEvent,this._loadFn,!1)},_endListener:function(){var e=this._parent;e._duration===1/0&&(e._duration=Math.ceil(10*this._node.duration)/10,e._sprite.__default[1]===1/0&&(e._sprite.__default[1]=1e3*e._duration),e._ended(this)),this._node.removeEventListener("ended",this._endFn,!1)}};var i={},r=function(e){var t=e._src;if(i[t])return e._duration=i[t].duration,void l(e);if(/^data:[^;]+;base64,/.test(t)){for(var n=atob(t.split(",")[1]),o=new Uint8Array(n.length),r=0;r<n.length;++r)o[r]=n.charCodeAt(r);s(o.buffer,e)}else{var d=new XMLHttpRequest;d.open(e._xhr.method,t,!0),d.withCredentials=e._xhr.withCredentials,d.responseType="arraybuffer",e._xhr.headers&&Object.keys(e._xhr.headers).forEach((function(t){d.setRequestHeader(t,e._xhr.headers[t])})),d.onload=function(){var t=(d.status+"")[0];"0"===t||"2"===t||"3"===t?s(d.response,e):e._emit("loaderror",null,"Failed loading audio file with status: "+d.status+".")},d.onerror=function(){e._webAudio&&(e._html5=!0,e._webAudio=!1,e._sounds=[],delete i[t],e.load())},a(d)}},a=function(e){try{e.send()}catch(t){e.onerror()}},s=function(e,n){var o=function(){n._emit("loaderror",null,"Decoding audio data failed.")},r=function(e){e&&n._sounds.length>0?(i[n._src]=e,l(n,e)):o()};"undefined"!=typeof Promise&&1===t.ctx.decodeAudioData.length?t.ctx.decodeAudioData(e).then(r).catch(o):t.ctx.decodeAudioData(e,r,o)},l=function(e,t){t&&!e._duration&&(e._duration=t.duration),0===Object.keys(e._sprite).length&&(e._sprite={__default:[0,1e3*e._duration]}),"loaded"!==e._state&&(e._state="loaded",e._emit("load"),e._loadQueue())},d=function(){if(t.usingWebAudio){try{"undefined"!=typeof AudioContext?t.ctx=new AudioContext:"undefined"!=typeof webkitAudioContext?t.ctx=new webkitAudioContext:t.usingWebAudio=!1}catch(e){t.usingWebAudio=!1}t.ctx||(t.usingWebAudio=!1);var e=/iP(hone|od|ad)/.test(t._navigator&&t._navigator.platform),n=t._navigator&&t._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),o=n?parseInt(n[1],10):null;if(e&&o&&o<9){var i=/safari/.test(t._navigator&&t._navigator.userAgent.toLowerCase());t._navigator&&!i&&(t.usingWebAudio=!1)}t.usingWebAudio&&(t.masterGain=void 0===t.ctx.createGain?t.ctx.createGainNode():t.ctx.createGain(),t.masterGain.gain.setValueAtTime(t._muted?0:t._volume,t.ctx.currentTime),t.masterGain.connect(t.ctx.destination)),t._setup()}};"function"==typeof define&&define.amd&&define([],(function(){return{Howler:t,Howl:n}})),"undefined"!=typeof exports&&(exports.Howler=t,exports.Howl=n),"undefined"!=typeof window?(window.HowlerGlobal=e,window.Howler=t,window.Howl=n,window.Sound=o):"undefined"!=typeof global&&(global.HowlerGlobal=e,global.Howler=t,global.Howl=n,global.Sound=o)}(),function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}((function(e){"use strict";var t=!1,n=/gecko\/\d/i.test(navigator.userAgent),o="thumbtack icon rotated counterclockwise",i={sound:"web"===STORY_PLATFORM,soundValue:10,displayEffect:"web"===STORY_PLATFORM},r=Object.assign({sound:!0,displayEffect:!0,soundValue:10},i);try{r=JSON.parse(localStorage.getItem("type_writer_key"))||r,r=Object.assign({},i,r)}catch(e){console.error(e)}function a(e){if(r.sound&&!a.sound){$(e.getWrapperElement()).find(".codemirror_type_writer_handle").find(".type_writer_scroll_btn>i").attr("class","asterisk loading icon");var t=new Howl({src:["./media/typewriter/1/scroll.mp3"],volume:r.soundValue/100,onend:function(){a.sound=null}});"loaded"===t.state()&&(t.play(),a.sound=t)}}function s(){if(r.sound){var e=new Howl({volume:r.soundValue/100,src:["./media/typewriter/1/delete.mp3"]});"loaded"===e.state()&&e.play()}}function l(){if(r.sound){var e=new Howl({volume:r.soundValue/100,src:["./media/typewriter/1/press.mp3"]});"loaded"===e.state()&&e.play()}}function d(t){d.timeout&&(clearTimeout(d.timeout),d.timeout=null),d.timeout=setTimeout((function(){if(d.timeout=null,t.getOption("disableInput"))return e.Pass;var i=t.getCursor("anchor"),r=t.charCoords({line:i.line,ch:i.ch},"local").bottom-t.defaultTextHeight(),s=t.getWrapperElement().offsetHeight,l=$(t.getWrapperElement()).find(".codemirror_type_writer_handle"),u=t.state.typewriterScrolling.position;(u<0||u>s)&&(u=.5*s,localStorage.type_writer_position_y=u,t.state.typewriterScrolling.position=u,l.css({top:u+"px"})),t.getOption("typewriterScrolling")||(u=.5*s);var c=t.coordsChar({left:0,top:t.getScrollInfo().top+u},"local"),f=Math.round(r-u);t.getOption("typewriterScrolling")?n?t.scrollTo(null,f):function(e,t,n){var o=e.getScrollInfo().top;if(!(t<=0&&o<=0)){var i=null,r=n.time;r||(r=Math.min(Math.max(200,Math.abs(parseInt(o-t))),800)),(Math.abs(n.cursor.line-n.targetCursor.line)>3||r>220)&&a(e);var s=e.state.typewriterScrolling.scrollingTimeout;s&&(clearTimeout(s),e.state.typewriterScrolling.scrollingTimeout=null),t=+t,r=+r,e.state.typewriterScrolling.scrolling=!0,window.requestAnimationFrame((function a(s){var l=s-(i=i||s);o<t?e.scrollTo(0,(t-o)*l/r+o):e.scrollTo(0,o-(o-t)*l/r),l<r?window.requestAnimationFrame(a):(e.scrollTo(0,t),n.callback&&n.callback(),e.state.typewriterScrolling.scrollingTimeout=setTimeout((function(){e.state.typewriterScrolling.scrolling=!1,e.state.typewriterScrolling.scrollingTimeout=null}),500))}))}}(t,f,{cursor:i,targetCursor:c,callback:function(){t.state.typewriterScrolling.isTempDisable?l.find(".type_writer_scroll_btn>i").attr("class","thumbtack icon"):l.find(".type_writer_scroll_btn>i").attr("class",o)}}):t.scrollTo(0,f)}),150)}function u(e){window.event;if(event){p(event.key)&&A(e,{keyCode:event.which});var n=!0;(event instanceof KeyboardEvent||event instanceof InputEvent)&&(n=!1),event.altKey||event.ctrlKey||event.shiftKey||"Backspace"!==event.code&&"Delete"!==event.code&&(n||t||e.state.typewriterScrolling.isTempDisable||e.hasFocus()&&0===e.getSelection().length&&(function(e){var t=e.getCursor(),n=e.getLineHandle(t.line).markedSpans||[],o=!1;return n.find((function(e){return!(!e.marker||!e.marker.__disableTypeWriterScroll)&&(o=!0,!0)})),o}(e)||e.execCommand("scrollSelectionToCenter")))}}function c(e,n){t=!(!n||1!==n.buttons)}function f(e,t,n){var o=e.getRange(t,n)||"";(o=o.trim())&&g(e,o)}function h(e,t){if(e.hasFocus()&&0===e.getSelection().length)for(var n=0,o=t.length;n<o;n++){var i=t[n];if("+delete"===i.origin){if(i.removed&&i.removed.length>0)(a=(a=i.removed.join("")).trim())&&g(e,a,{direction:"left"});return void s()}if("+input"===i.origin&&window.event&&window.event instanceof window.InputEvent){var r=window.event,a="";"insertText"===r.inputType&&(a=(a=r.data||a).trim())&&g(e,a)}if("+input"===i.origin||"*compose"===i.origin||"+delete"===i.origin)return void l()}}function p(e){return["ArrowRight","ArrowLeft","ArrowUp","ArrowDown","PageDown","PageUp","Home","End"].indexOf(e)>=0}function _(e){var t=window.event;if(p(t&&t.key))return function(){if(r.sound){var e=new Howl({volume:r.soundValue/100,src:["./media/typewriter/1/direction.mp3"]});"loaded"===e.state()&&e.play()}}(),void k(e,{keyCode:t.which})}function m(e){13!==window.event.which||function(){if(r.sound){var e=new Howl({src:["./media/typewriter/1/return.mp3"],volume:r.soundValue/100,sprite:{enter:[0,500]}});"loaded"===e.state()&&e.play("enter")}}()}function v(e,t,n){return!(!e||e.str!==t||e.direction!==n.direction)}function g(e,t,n){x(e,t,n)}function y(){w.execObjs.map((function(e){e.dequeue("xsj")})),w.execObjs.length=0,w.prevObj=null,w.execTimeout=null}function w(e,t,n){if(r.displayEffect){n=n||{};var o=null;if(w.execTimeout&&clearTimeout(w.execTimeout),v(w.prevObj,t,n)){var i=(o=w.prevObj.$target).find(".type_writer_count");return 0===i.length&&(i=$("<div class='type_writer_count'></div>"),o.prepend(i)),i.text(++w.prevObj.count),w.prevObj.count>10&&S(w.prevObj.count,t,n),void(w.execTimeout=setTimeout(y,200))}y(),(o=$("<div class='type_writer_machine type_writer_machine_by_js'><div class='type_writer_content'></div></div>")).find(".type_writer_content").text(t);var a=o[0],s=e.cursorCoords(),l=(s.bottom,s.top,s.left),d=s.top-10-37;a.style.left=l+"px",a.style.top=d+"px",$(".type_writer_stage").append(o);var u={top:"-=100px",opacity:0};"left"===n.direction?Object.assign(u,{left:"+=100px"}):Object.assign(u,{left:"-=100px"}),w.prevObj={$target:o,str:t,direction:n.direction,count:1},o.animate(u,{duration:500,easing:"linear",queue:"xsj",complete:function(){$(this).remove()}}),w.execObjs.push(o),w.execTimeout=setTimeout(y,200)}}function b(){x.execObjs.map((function(e){e.css(e.data("styleEnd"))})),x.execObjs.length=0,x.prevObj=null,x.execTimeout=null}function x(e,t,n){if(r.displayEffect){n=n||{};var o=null;if(x.execTimeout&&clearTimeout(x.execTimeout),v(x.prevObj,t,n)){var i=(o=x.prevObj.$target).find(".type_writer_count");return 0===i.length&&(i=$("<div class='type_writer_count'></div>"),o.prepend(i)),i.text(++x.prevObj.count),x.prevObj.count>10&&S(x.prevObj.count,t,n),void(x.execTimeout=setTimeout(b,200))}b(),(o=$("<div class='type_writer_machine type_writer_machine_by_css paper_move'><div class='type_writer_content'></div></div>")).find(".type_writer_content").text(t);var a=o[0],s=e.cursorCoords(),l=(s.bottom,s.top,s.left),d=s.top-10-37;a.style.left=l+"px",a.style.top=d+"px",$(".type_writer_stage").append(o);var u,c,f,h,p,_,m,g=(u=n.direction,c={min:90,max:180},f={min:-45,max:45},h={min:-40,max:50},p="left"===u?{min:100,max:200}:{min:-200,max:-100},_={min:-200,max:-100},m={min:150,max:250},{rx:Math.floor(Math.random()*(c.max-c.min+1)+c.min),ry:Math.floor(Math.random()*(f.max-f.min+1)+f.min),rz:Math.floor(Math.random()*(h.max-h.min+1)+h.min),tx:Math.floor(Math.random()*(p.max-p.min+1)+p.min),ty:Math.floor(Math.random()*(_.max-_.min+1)+_.min),tz:Math.floor(Math.random()*(m.max-m.min+1)+m.min)}),y={opacity:0,transform:"translateX("+g.tx+"px) translateY("+g.ty+"px) translateZ("+g.tz+"px) rotateX("+g.rx+"deg) rotateY("+g.ry+"deg) rotateZ("+g.rz+"deg)"};o.data("styleEnd",y),o.on($.support.transition.end,(function(){o.remove()})),x.prevObj={$target:o,str:t,direction:n.direction,count:1},x.execObjs.push(o),x.execTimeout=setTimeout(b,200)}}function T(){if(A.prevObj){var e=A.prevObj.$target;e.css(e.data("styleEnd"))}A.prevObj=null,A.execTimeout=null}function A(t,n){if(r.displayEffect){var o=A.prevKeyCode,i=A.prevCursor;A.prevKeyCode=null,A.prevCursor=null;var a=t.getCursor();if([33,34].indexOf(n.keyCode)>=0&&t.highlightPos&&t.highlightPos(a,{autoHideTimeout:1e3,force:!0}),[35,36].indexOf(n.keyCode)>=0&&(A.prevKeyCode=n.keyCode,A.prevCursor=a,i&&o===n.keyCode&&0===e.cmpPos(i,a)&&t.highlightPos&&t.highlightPos(a,{autoHideTimeout:1e3,force:!0})),!([37,39].indexOf(n.keyCode)<0)&&0===t.getSelection().length){n=n||{};var s=null;A.execTimeout&&clearTimeout(A.execTimeout);var l=t.cursorCoords(),d=(l.bottom,l.top,l.left),u=l.top-10-37;[33,38].indexOf(n.keyCode)>=0&&(u=l.top+10+37);var c,f="["+(a.line+1)+":"+a.ch+"]";if(A.prevObj)return(s=A.prevObj.$target).find(".type_writer_content").text(f),(c=s[0]).style.left=d+"px",c.style.top=u+"px",void(A.execTimeout=setTimeout(T,300));(s=$("<div class='type_writer_machine type_writer_machine_by_css paper_move'><div class='type_writer_content'></div></div>")).find(".type_writer_content").text(f),(c=s[0]).style.left=d+"px",c.style.top=u+"px",$(".type_writer_stage").append(s);s.data("styleEnd",{opacity:0}),s.on($.support.transition.end,(function(){s.remove()})),A.prevObj={$target:s},A.execTimeout=setTimeout(T,300)}}}function k(t,n){if(r.displayEffect){var o=k.prevKeyCode,i=k.prevCursor;k.prevKeyCode=null,k.prevCursor=null;var a=t.getCursor();[33,34].indexOf(n.keyCode)>=0&&t.highlightPos&&t.highlightPos(a,{autoHideTimeout:1e3,force:!0,disableScrollIntoView:!0}),[35,36].indexOf(n.keyCode)>=0&&(k.prevKeyCode=n.keyCode,k.prevCursor=a,i&&o===n.keyCode&&0===e.cmpPos(i,a)&&t.highlightPos&&t.highlightPos(a,{autoHideTimeout:1e3,force:!0})),[37,39].indexOf(n.keyCode)}}function S(e,t,n){var o=null;v(S.prevObj,t,n)?o=S.prevObj.$target:(o=$("<div class='type_writer_machine_power_counter'></div>"),$("body").append(o)),o.stop(!0),o.stop("xsjPowerCounter",!0),o.css("opacity",1),S.prevObj={$target:o,str:t,direction:n.direction},o.animate({fontSize:"+=10px"},{duration:500}).animate({fontSize:"-=10px"},{duration:500}),o.animate({opacity:0},{duration:1e3,easing:"linear",queue:"xsjPowerCounter",complete:function(){$(this).stop(!0),$(this).remove(),S.prevObj=null}}),o.dequeue("xsjPowerCounter"),o.text(e)}e.commands.scrollSelectionToCenter=function(e){d(e)},e.defineOption("typewriterScrolling",!1,(function(n,i,s){var l=$(n.getWrapperElement());if(!window.mobileAndTabletcheck||!window.mobileAndTabletcheck()){if(s&&s!=e.Init)n.off("changes",h),n.off("xsjTempComposingEnd",f),n.off("keyup",m),n.off("keydown",_),n.off("cursorActivity",u),n.off("mousedown",c),n.state.typewriterScrolling&&n.state.typewriterScrolling.onMouseUp&&e.off(n.display.mover,"mouseup",n.state.typewriterScrolling.onMouseUp),(w=l.find(".codemirror_type_writer_handle")).draggable("destroy"),w.find(".type_writer_sound_btn").draggable("destroy"),w.remove(),n.state.typewriterScrolling={};if(i){$(".type_writer_stage").length<=0&&$("body").append('<div class="type_writer_stage"></div>'),n.on("changes",h),n.on("xsjTempComposingEnd",f),n.on("keyup",m),n.on("keydown",_),n.on("cursorActivity",u),n.on("mousedown",c);var d=l[0].offsetHeight,p=parseFloat(localStorage.type_writer_position_y)||-1;p<0&&(p=.5*d),n.state.typewriterScrolling={isTempDisable:!1,position:p||0,globalState:r,onMouseUp:function(e){!function(e,n){if(t=!1,e.state.typewriterScrolling.isTempDisable)return;if(0!==e.getSelection().length)return}(n)}},e.on(n.display.mover,"mouseup",n.state.typewriterScrolling.onMouseUp);var v=r.sound?"volume up icon link":"volume off icon link",g=r.soundValue,y=r.displayEffect?"magic icon link":"ban icon link",w=$("<div class='codemirror_type_writer_handle' style='top:"+p+"px;'><div class='type_writer_btn type_writer_scroll_btn' title='\u70b9\u51fb\u5207\u6362\u6eda\u52a8\u5f00\u5173\uff0c\u4e0a\u4e0b\u62d6\u52a8\u53ef\u4ee5\u8c03\u6574\u5b9a\u4f4d\u4f4d\u7f6e'><i class='"+o+"'></i></div><div class='type_writer_btn type_writer_sound_btn' title='\u70b9\u51fb\u5207\u6362\u58f0\u97f3\u5f00\u5173,\u5de6\u53f3\u62d6\u52a8\u8c03\u6574\u58f0\u97f3\u5927\u5c0f'><i class='"+v+"'></i><span class='type_writer_sound_value'>"+g+"%</span></div> <div class='type_writer_btn type_writer_display_effect_btn' title='\u70b9\u51fb\u5207\u6362\u52a8\u753b\u6548\u679c\u5f00\u5173'><i class='"+y+"'></i></div> </div>");l.append(w);var b=w.find(".type_writer_sound_btn");w.on("click",".type_writer_btn",(function(e){if(w.hasClass("type_writer_start_drag"))w.removeClass("type_writer_start_drag");else{var t=$(e.currentTarget);if(t.hasClass("type_writer_scroll_btn"))n.state.typewriterScrolling.isTempDisable=!n.state.typewriterScrolling.isTempDisable,n.state.typewriterScrolling.isTempDisable?w.find(".type_writer_scroll_btn>i").attr("class","thumbtack icon"):w.find(".type_writer_scroll_btn>i").attr("class",o);else if(t.hasClass("type_writer_sound_btn")){if(b.hasClass("type_writer_start_drag"))return;r.sound=!r.sound,localStorage.setItem("type_writer_key",JSON.stringify(r)),v=r.sound?"volume up icon link":"volume off icon link",$(".type_writer_sound_btn>i").attr("class",v)}else t.hasClass("type_writer_display_effect_btn")&&(r.displayEffect=!r.displayEffect,localStorage.setItem("type_writer_key",JSON.stringify(r)),y=r.displayEffect?"magic icon link":"ban icon link",$(".type_writer_display_effect_btn>i").attr("class",y))}})),b.draggable({axis:"x",helper:function(e){var t=r.soundValue||0;return $("<div class='ui-widget-header'>"+t+"%</div>")},drag:function(e,t){var n=t.helper,o=t.originalPosition,i=t.position,r=n.data("soundValue");(r+=Math.round(i.left-o.left))>100&&(r=100),r<0&&(r=0),n.html(r+"%"),n.data("soundValue",r)},start:function(e,t){var n=t.helper,o=r.soundValue||0;n.data("soundValue",o),b.addClass("type_writer_start_drag")},stop:function(e,t){var n=t.helper,o=n.data("soundValue");o!==r.soundValue&&(r.soundValue=o||0,localStorage.setItem("type_writer_key",JSON.stringify(r)),b.find(".type_writer_sound_value").html(r.soundValue+"%")),n.data("soundValue",o),b.removeClass("type_writer_start_drag")}}),w.draggable({axis:"y",containment:"parent",start:function(){w.addClass("type_writer_dragging type_writer_start_drag")},stop:function(e,t){var o=l[0].offsetHeight,i=t.position.top;(i>o||i<0)&&(i=o/2),localStorage.type_writer_position_y=i,n.state.typewriterScrolling.position=i,w.removeClass("type_writer_dragging"),n.execCommand("scrollSelectionToCenter"),a(n)}})}}})),w.execObjs=[],x.execObjs=[]})),function(e){"use strict";"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}((function(e){"use strict";var t=e.prototype.findWordAt;if($&&$.layout&&$.layout.browser&&$.layout.browser.webkit){e.xsjFindWord=function(t,n,o,i,r){var a=function(t,n,o,i,r){var a=e.xsjFindWordRange(o,i);if(a){var s=a[0],l=a[1];if(n<0){if(s>=i){var d=e.xsjFindWordRange(o,s-1);if(d[0]!=a[0])s=d[0];else{for(var u=s-1;" "==o.charAt(u)&&u>0;)u--;if((d=e.xsjFindWordRange(o,u))[0]==a[0])return null;s=d[0]}}return s==i&&--s<0&&(s=0),{from:s,to:i,line:r}}if(l<=i+1){var c=e.xsjFindWordRange(o,l+1);if(c[1]==a[1])return null;l=c[1]}return{from:i,to:l,line:r}}}(0,n,o,i,r);return document.activeElement.blur(),t.focus(),a},e.xsjFindWordRange=function(e,t){function n(e){window.getSelection().modify("extend",e,"word")}return function(e,t){if(!e)return null;t=t||0,++t>=e.length&&(t=e.length-1);const o=document.createElement("div");o.style.position="absolute",o.style.opacity=0,o.style.top=0,o.style.zIndex=-1e3,o.style.height=0,o.style.left=0,o.innerText=e,document.body.append(o);const i=window.getSelection(),r=document.createRange(),a=o.childNodes[0];r.setStart(a,t),r.setEnd(a,t),i.rangeCount>0&&i.removeAllRanges(),i.addRange(r),n("backward");let s=i.getRangeAt(0),l=s.startOffset;r.setStart(a,l),r.setEnd(a,l),i.removeAllRanges(),i.addRange(r),n("forward"),s=i.getRangeAt(0);let d=null;return s.endOffset>=t||(r.setStart(a,t),r.setEnd(a,t),i.removeAllRanges(),i.addRange(r),n("forward"),s=i.getRangeAt(0)),d=[s.startOffset,s.endOffset],document.body.removeChild(o),d}(e,t)}}e.prototype.findWordAt=function(n){var o=this.doc,i=o.getLine(n.line),r=n.ch,a=n.ch;if(i&&$.layout.browser.webkit){this.getHelper(n,"wordChars");"before"!=n.sticky&&a!=i.length||!r?++a:--r;try{const t=e.xsjFindWordRange(i,r);return r=t[0],a=t[1],new e.Range(e.Pos(n.line,r),e.Pos(n.line,a))}catch(e){return t.apply(this,arguments)}}return t.apply(this,arguments)}})),function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}((function(e){var t={pairs:"()[]{}''\"\"",triples:"",explode:"[]{}"},n=e.Pos;function o(e,n){return"pairs"==n&&"string"==typeof e?e:"object"==typeof e&&null!=e[n]?e[n]:t[n]}e.defineOption("autoCloseBrackets",!1,(function(t,n,o){o&&o!=e.Init&&(t.removeKeyMap(r),t.state.closeBrackets=null),n&&(t.state.closeBrackets=n,t.addKeyMap(r))}));for(var i=t.pairs+"`",r={Backspace:function(t){var i=l(t);if(!i||t.getOption("disableInput"))return e.Pass;for(var r=o(i,"pairs"),a=t.listSelections(),s=0;s<a.length;s++){if(!a[s].empty())return e.Pass;var d=u(t,a[s].head);if(!d||r.indexOf(d)%2!=0)return e.Pass}for(s=a.length-1;s>=0;s--){var c=a[s].head;t.replaceRange("",n(c.line,c.ch-1),n(c.line,c.ch+1),"+delete")}},Enter:function(t){var n=l(t),i=n&&o(n,"explode");if(!i||t.getOption("disableInput"))return e.Pass;for(var r=t.listSelections(),a=0;a<r.length;a++){if(!r[a].empty())return e.Pass;var s=u(t,r[a].head);if(!s||i.indexOf(s)%2!=0)return e.Pass}t.operation((function(){t.replaceSelection("\n\n",null),t.execCommand("goCharLeft"),r=t.listSelections();for(var e=0;e<r.length;e++){var n=r[e].head.line;t.indentLine(n,null,!0),t.indentLine(n+1,null,!0)}}))}},a=0;a<i.length;a++)r["'"+i.charAt(a)+"'"]=s(i.charAt(a));function s(t){return function(i){return function(t,i){var r=l(t);if(!r||t.getOption("disableInput"))return e.Pass;var a=o(r,"pairs"),s=a.indexOf(i);if(-1==s)return e.Pass;for(var u,f=o(r,"triples"),h=a.charAt(s+1)==i,p=t.listSelections(),_=s%2==0,m=0;m<p.length;m++){var v,g=p[m],y=g.head,w=t.getRange(y,n(y.line,y.ch+1));if(_&&!g.empty())v="surround";else if(!h&&_||w!=i)if(h&&y.ch>1&&f.indexOf(i)>=0&&t.getRange(n(y.line,y.ch-2),y)==i+i&&(y.ch<=2||t.getRange(n(y.line,y.ch-3),n(y.line,y.ch-2))!=i))v="addFour";else if(h){if(e.isWordChar(w)||!c(t,y,i))return e.Pass;v="both"}else{if(!_||t.getLine(y.line).length!=y.ch&&!d(w,a)&&!/\s/.test(w))return e.Pass;v="both"}else v=f.indexOf(i)>=0&&t.getRange(y,n(y.line,y.ch+3))==i+i+i?"skipThree":"skip";if(u){if(u!=v)return e.Pass}else u=v}var b=s%2?a.charAt(s-1):i,x=s%2?i:a.charAt(s+1);t.operation((function(){if("skip"==u)t.execCommand("goCharRight");else if("skipThree"==u)for(var o=0;o<3;o++)t.execCommand("goCharRight");else if("surround"==u){var i=t.getSelections();for(o=0;o<i.length;o++)i[o]=b+i[o]+x;t.replaceSelections(i,"around"),i=t.listSelections().slice();for(o=0;o<i.length;o++)i[o]=(r=i[o],a=void 0,a=e.cmpPos(r.anchor,r.head)>0,{anchor:new n(r.anchor.line,r.anchor.ch+(a?-1:1)),head:new n(r.head.line,r.head.ch+(a?1:-1))});t.setSelections(i)}else"both"==u?(t.replaceSelection(b+x,null),t.triggerElectric(b+x),t.execCommand("goCharLeft")):"addFour"==u&&(t.replaceSelection(b+b+b+b,"before"),t.execCommand("goCharRight"));var r,a}))}(i,t)}}function l(e){var t=e.state.closeBrackets;return t?e.getModeAt(e.getCursor()).closeBrackets||t:null}function d(e,t){var n=t.lastIndexOf(e);return n>-1&&n%2==1}function u(e,t){var o=e.getRange(n(t.line,t.ch-1),n(t.line,t.ch+1));return 2==o.length?o:null}function c(t,n,o){var i=t.getLine(n.line),r=t.getTokenAt(n);if(/\bstring2?\b/.test(r.type))return!1;var a=new e.StringStream(i.slice(0,n.ch)+o+i.slice(n.ch),4);for(a.pos=a.start=r.start;;){var s=t.getMode().token(a,r.state);if(a.pos>=n.ch+1)return/\bstring2?\b/.test(s);a.start=a.pos}}})),function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}((function(e){var t=/MSIE \d/.test(navigator.userAgent)&&(null==document.documentMode||document.documentMode<8),n=e.Pos,o={"(":")>",")":"(<","[":"]>","]":"[<","{":"}>","}":"{<"};function i(e,t,i,a){var s=e.getLineHandle(t.line),l=t.ch-1,d=l>=0&&o[s.text.charAt(l)]||o[s.text.charAt(++l)];if(!d)return null;var u=">"==d.charAt(1)?1:-1;if(i&&u>0!=(l==t.ch))return null;var c=e.getTokenTypeAt(n(t.line,l+1)),f=r(e,n(t.line,l+(u>0?1:0)),u,c||null,a);return null==f?null:{from:n(t.line,l),to:f&&f.pos,match:f&&f.ch==d.charAt(0),forward:u>0}}function r(e,t,i,r,a){for(var s=a&&a.maxScanLineLength||1e4,l=a&&a.maxScanLines||1e3,d=[],u=a&&a.bracketRegex?a.bracketRegex:/[(){}[\]]/,c=i>0?Math.min(t.line+l,e.lastLine()+1):Math.max(e.firstLine()-1,t.line-l),f=t.line;f!=c;f+=i){var h=e.getLine(f);if(h){var p=i>0?0:h.length-1,_=i>0?h.length:-1;if(!(h.length>s))for(f==t.line&&(p=t.ch-(i<0?1:0));p!=_;p+=i){var m=h.charAt(p);if(u.test(m)&&(void 0===r||e.getTokenTypeAt(n(f,p+1))==r))if(">"==o[m].charAt(1)==i>0)d.push(m);else{if(!d.length)return{pos:n(f,p),ch:m};d.pop()}}}}return f-i!=(i>0?e.lastLine():e.firstLine())&&null}function a(e,o,r){for(var a=e.state.matchBrackets.maxHighlightLineLength||1e3,s=[],l=e.listSelections(),d=0;d<l.length;d++){var u=l[d].empty()&&i(e,l[d].head,!1,r);if(u&&e.getLine(u.from.line).length<=a){var c=u.match?"CodeMirror-matchingbracket":"CodeMirror-nonmatchingbracket";s.push(e.markText(u.from,n(u.from.line,u.from.ch+1),{className:c})),u.to&&e.getLine(u.to.line).length<=a&&s.push(e.markText(u.to,n(u.to.line,u.to.ch+1),{className:c}))}}if(s.length){t&&e.state.focused&&e.focus();var f=function(){e.operation((function(){for(var e=0;e<s.length;e++)s[e].clear()}))};if(!o)return f;setTimeout(f,800)}}var s=null;function l(e){e.operation((function(){s&&(s(),s=null),s=a(e,!1,e.state.matchBrackets)}))}e.defineOption("matchBrackets",!1,(function(t,n,o){o&&o!=e.Init&&t.off("cursorActivity",l),n&&(t.state.matchBrackets="object"==typeof n?n:{},t.on("cursorActivity",l))})),e.defineExtension("matchBrackets",(function(){a(this,!0)})),e.defineExtension("findMatchingBracket",(function(e,t,n){return i(this,e,t,n)})),e.defineExtension("scanForBracket",(function(e,t,n,o){return r(this,e,t,n,o)}))})),function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror"),require("../fold/xml-fold")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../fold/xml-fold"],e):e(CodeMirror)}((function(e){"use strict";function t(e){e.state.tagHit&&e.state.tagHit.clear(),e.state.tagOther&&e.state.tagOther.clear(),e.state.tagHit=e.state.tagOther=null}function n(n){n.state.failedTagMatch=!1,n.operation((function(){if(t(n),!n.somethingSelected()){var o=n.getCursor(),i=n.getViewport();i.from=Math.min(i.from,o.line),i.to=Math.max(o.line+1,i.to);var r=e.findMatchingTag(n,o,i);if(r){if(n.state.matchBothTags){var a="open"==r.at?r.open:r.close;a&&(n.state.tagHit=n.markText(a.from,a.to,{className:"CodeMirror-matchingtag"}))}var s="close"==r.at?r.open:r.close;s?n.state.tagOther=n.markText(s.from,s.to,{className:"CodeMirror-matchingtag"}):n.state.failedTagMatch=!0}}}))}function o(e){e.state.failedTagMatch&&n(e)}e.defineOption("matchTags",!1,(function(i,r,a){a&&a!=e.Init&&(i.off("cursorActivity",n),i.off("viewportChange",o),t(i)),r&&(i.state.matchBothTags="object"==typeof r&&r.bothTags,i.on("cursorActivity",n),i.on("viewportChange",o),n(i))})),e.commands.toMatchingTag=function(t){var n=e.findMatchingTag(t,t.getCursor());if(n){var o="close"==n.at?n.open:n.close;o&&t.extendSelection(o.to,o.from)}}})),function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror"),require("../fold/xml-fold")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../fold/xml-fold"],e):e(CodeMirror)}((function(e){e.defineOption("autoCloseTags",!1,(function(a,s,l){if(l!=e.Init&&l&&a.removeKeyMap("autoCloseTags"),s){var d={name:"autoCloseTags"};("object"!=typeof s||s.whenClosing)&&(d["'/'"]=function(t){return function(t){return t.getOption("disableInput")?e.Pass:o(t,!0)}(t)}),("object"!=typeof s||s.whenOpening)&&(d["'>'"]=function(o){return function(o){if(o.getOption("disableInput"))return e.Pass;for(var a=o.listSelections(),s=[],l=0;l<a.length;l++){if(!a[l].empty())return e.Pass;var d=a[l].head,u=o.getTokenAt(d),c=e.innerMode(o.getMode(),u.state),f=c.state;if("xml"!=c.mode.name||!f.tagName)return e.Pass;var h=o.getOption("autoCloseTags"),p="html"==c.mode.configuration,_="object"==typeof h&&h.dontCloseTags||p&&t,m="object"==typeof h&&h.indentTags||p&&n,v=f.tagName;u.end>d.ch&&(v=v.slice(0,v.length-u.end+d.ch));var g=v.toLowerCase();if(!v||"string"==u.type&&(u.end!=d.ch||!/[\"\']/.test(u.string.charAt(u.string.length-1))||1==u.string.length)||"tag"==u.type&&"closeTag"==f.type||u.string.indexOf("/")==u.string.length-1||_&&i(_,g)>-1||r(o,v,d,f,!0))return e.Pass;var y=m&&i(m,g)>-1;s[l]={indent:y,text:">"+(y?"\n\n":"")+"</"+v+">",newPos:y?e.Pos(d.line+1,0):e.Pos(d.line,d.ch+1)}}for(l=a.length-1;l>=0;l--){var w=s[l];o.replaceRange(w.text,a[l].head,a[l].anchor,"+insert");var b=o.listSelections().slice(0);b[l]={head:w.newPos,anchor:w.newPos},o.setSelections(b),w.indent&&(o.indentLine(w.newPos.line,null,!0),o.indentLine(w.newPos.line+1,null,!0))}}(o)}),a.addKeyMap(d)}}));var t=["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"],n=["applet","blockquote","body","button","div","dl","fieldset","form","frameset","h1","h2","h3","h4","h5","h6","head","html","iframe","layer","legend","object","ol","p","select","table","ul"];function o(t,n){for(var o=t.listSelections(),i=[],a=n?"/":"</",s=0;s<o.length;s++){if(!o[s].empty())return e.Pass;var l,d=o[s].head,u=t.getTokenAt(d),c=e.innerMode(t.getMode(),u.state),f=c.state;if(n&&("string"==u.type||"<"!=u.string.charAt(0)||u.start!=d.ch-1))return e.Pass;if("xml"!=c.mode.name)if("htmlmixed"==t.getMode().name&&"javascript"==c.mode.name)l=a+"script";else{if("htmlmixed"!=t.getMode().name||"css"!=c.mode.name)return e.Pass;l=a+"style"}else{if(!f.context||!f.context.tagName||r(t,f.context.tagName,d,f))return e.Pass;l=a+f.context.tagName}">"!=t.getLine(d.line).charAt(u.end)&&(l+=">"),i[s]=l}t.replaceSelections(i),o=t.listSelections();for(s=0;s<o.length;s++)(s==o.length-1||o[s].head.line<o[s+1].head.line)&&t.indentLine(o[s].head.line)}function i(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0,o=e.length;n<o;++n)if(e[n]==t)return n;return-1}function r(t,n,o,i,r){if(!e.scanForClosingTag)return!1;var a=Math.min(t.lastLine()+1,o.line+500),s=e.scanForClosingTag(t,o,null,a);if(!s||s.tag!=n)return!1;for(var l=i.context,d=r?1:0;l&&l.tagName==n;l=l.prev)++d;o=s.to;for(var u=1;u<d;u++){var c=e.scanForClosingTag(t,o,null,a);if(!c||c.tag!=n)return!1;o=c.to}return!0}e.commands.closeTag=function(e){return o(e)}}));
