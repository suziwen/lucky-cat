!function(){"use strict";var t="undefined"!=typeof window?window:global;if("function"!=typeof t.requirejs){var e={},n={},r=function(t,e){return{}.hasOwnProperty.call(t,e)},a=function(t,e){for(var n,r,a=[],i=0,o=(n=/^\.\.?(\/|$)/.test(e)?[t,e].join("/").split("/"):e.split("/")).length;i<o;i++)".."===(r=n[i])?a.pop():"."!==r&&""!==r&&a.push(r);return a.join("/")},i=function(e,r){var i,o={id:e,exports:{}};return n[e]=o,r(o.exports,(i=e,function(e){var n=function(t){return t.split("/").slice(0,-1).join("/")}(i),r=a(n,e);return t.requirejs(r,i)}),o),o.exports},o=function(t,n){if("object"==typeof t)for(var a in t)r(t,a)&&(e[a]=t[a]);else e[t]=n};t.requirejs=function(t,o){var s=a(t,".");if(null==o&&(o="/"),r(n,s))return n[s].exports;if(r(e,s))return i(s,e[s]);var c=a(s,"./index");if(r(n,c))return n[c].exports;if(r(e,c))return i(c,e[c]);throw new Error('Cannot find module "'+t+'" from "'+o+'"')},t.requirejs.define=o,t.requirejs.register=o,t.requirejs.list=function(){var t=[];for(var n in e)r(e,n)&&t.push(n);return t},t.requirejs.brunch=!0}}(),function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Hierarchy=e():t.Hierarchy=e()}("undefined"!=typeof self?self:this,(function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var a=e[r]={i:r,l:!1,exports:{}};return t[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:r})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=4)}([function(t,e,n){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var a=n(2),i=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};r(this,t);var i=this;i.options=n,i.rootNode=a(e,n)}return t.prototype.execute=function(){throw new Error("please override this method")},t}();t.exports=i},function(t,e,n){var r=n(3),a=["LR","RL","TB","BT","H","V"],i=["LR","RL","H"],o=a[0];t.exports=function(t,e,n){var s=e.direction||o;if(e.isHorizontal=function(t){return i.indexOf(t)>-1}(s),s&&-1===a.indexOf(s))throw new TypeError("Invalid direction: "+s);if(s===a[0])n(t,e);else if(s===a[1])n(t,e),t.right2left();else if(s===a[2])n(t,e);else if(s===a[3])n(t,e),t.bottom2top();else if(s===a[4]||s===a[5]){var c=r(t,e),h=c.left,l=c.right;n(h,e),n(l,e),e.isHorizontal?h.right2left():h.bottom2top(),l.translate(h.x-l.x,h.y-l.y),t.x=h.x,t.y=l.y;var u=t.getBoundingBox();e.isHorizontal?u.top<0&&t.translate(0,-u.top):u.left<0&&t.translate(-u.left,0)}return t.translate(-(t.x+t.width/2+t.hgap),-(t.y+t.height/2+t.vgap)),t}},function(t,e){var n={getId:function(t){return t.id||t.name},getHGap:function(t){return t.hgap||18},getVGap:function(t){return t.vgap||18},getChildren:function(t){return t.children},getHeight:function(t){return t.height||36},getWidth:function(t){var e=t.name||" ";return t.width||18*e.split("").length}};function r(t,e){var n=this;if(n.vgap=n.hgap=0,t instanceof r)return t;n.data=t;var a=e.getHGap(t),i=e.getVGap(t);return n.width=e.getWidth(t),n.height=e.getHeight(t),n.id=e.getId(t),n.x=n.y=0,n.depth=0,n.children||(n.children=[]),n.addGap(a,i),n}Object.assign(r.prototype,{isRoot:function(){return 0===this.depth},isLeaf:function(){return 0===this.children.length},addGap:function(t,e){this.hgap+=t,this.vgap+=e,this.width+=2*t,this.height+=2*e},eachNode:function(t){for(var e=[this],n=void 0;n=e.pop();)t(n),e=e.concat(n.children)},DFTraverse:function(t){this.eachNode(t)},BFTraverse:function(t){for(var e=[this],n=void 0;n=e.shift();)t(n),e=e.concat(n.children)},getBoundingBox:function(){var t={left:Number.MAX_VALUE,top:Number.MAX_VALUE,width:0,height:0};return this.eachNode((function(e){t.left=Math.min(t.left,e.x),t.top=Math.min(t.top,e.y),t.width=Math.max(t.width,e.x+e.width),t.height=Math.max(t.height,e.y+e.height)})),t},translate:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.eachNode((function(n){n.x+=t,n.y+=e}))},right2left:function(){var t=this.getBoundingBox();this.eachNode((function(e){e.x=e.x-2*(e.x-t.left)-e.width})),this.translate(t.width,0)},bottom2top:function(){var t=this.getBoundingBox();this.eachNode((function(e){e.y=e.y-2*(e.y-t.top)-e.height})),this.translate(0,t.height)}}),t.exports=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments[2],i=new r(t,e=Object.assign({},n,e)),o=[i],s=void 0;if(!a&&!t.collapsed)for(;s=o.pop();)if(!s.data.collapsed){var c=e.getChildren(s.data),h=c?c.length:0;if(s.children=new Array(h),c&&h)for(var l=0;l<h;l++){var u=new r(c[l],e);s.children[l]=u,o.push(u),u.parent=s,u.depth=s.depth+1}}return i}},function(t,e,n){var r=n(2);t.exports=function(t,e){for(var n=r(t.data,e,!0),a=r(t.data,e,!0),i=t.children.length,o=Math.round(i/2),s=e.getSide||function(t,e){return e<o?"right":"left"},c=0;c<i;c++){var h=t.children[c];"right"===s(h,c)?a.children.push(h):n.children.push(h)}return n.eachNode((function(t){t.isRoot()||(t.side="left")})),a.eachNode((function(t){t.isRoot()||(t.side="right")})),{left:n,right:a}}},function(t,e,n){var r={compactBox:n(5),dendrogram:n(7),indented:n(9),mindmap:n(11)};t.exports=r},function(t,e,n){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}var i=n(0),o=n(6),s=n(1),c=function(t){function e(){return r(this,e),a(this,t.apply(this,arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.execute=function(){return s(this.rootNode,this.options,o)},e}(i),h={};t.exports=function(t,e){return e=Object.assign({},h,e),new c(t,e).execute()}},function(t,e){function n(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],a=this;a.w=t||0,a.h=e||0,a.y=n||0,a.x=0,a.c=r||[],a.cs=r.length,a.prelim=0,a.mod=0,a.shift=0,a.change=0,a.tl=null,a.tr=null,a.el=null,a.er=null,a.msel=0,a.mser=0}function r(t,e){var n=function t(e,n){var r=n?e.y:e.x;return e.children.forEach((function(e){r=Math.min(t(e,n),r)})),r}(t,e);!function t(e,n,r){r?e.y+=n:e.x+=n,e.children.forEach((function(e){t(e,n,r)}))}(t,-n,e)}function a(t,e,n){n?e.y=t.x:e.x=t.x,t.c.forEach((function(t,r){a(t,e.children[r],n)}))}function i(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;e?(t.x=n,n+=t.width):(t.y=n,n+=t.height),t.children.forEach((function(t){i(t,e,n)}))}n.fromNode=function(t,e){if(!t)return null;var r=[];return t.children.forEach((function(t){r.push(n.fromNode(t,e))})),e?new n(t.height,t.width,t.x,r):new n(t.width,t.height,t.y,r)},t.exports=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=e.isHorizontal;function s(t){if(0!==t.cs){s(t.c[0]);for(var e=b(d(t.c[0].el),0,null),n=1;n<t.cs;++n){s(t.c[n]);var r=d(t.c[n].er);h(t,n,e),e=b(r,n,e)}y(t),c(t)}else c(t)}function c(t){0===t.cs?(t.el=t,t.er=t,t.msel=t.mser=0):(t.el=t.c[0].el,t.msel=t.c[0].msel,t.er=t.c[t.cs-1].er,t.mser=t.c[t.cs-1].mser)}function h(t,e,n){for(var r=t.c[e-1],a=r.mod,i=t.c[e],o=i.mod;null!==r&&null!==i;){d(r)>n.low&&(n=n.nxt);var s=a+r.prelim+r.w-(o+i.prelim);s>0&&(o+=s,l(t,e,n.index,s));var c=d(r),h=d(i);c<=h&&null!==(r=p(r))&&(a+=r.mod),c>=h&&null!==(i=u(i))&&(o+=i.mod)}!r&&i?f(t,e,i,o):r&&!i&&g(t,e,r,a)}function l(t,e,n,r){t.c[e].mod+=r,t.c[e].msel+=r,t.c[e].mser+=r,m(t,e,n,r)}function u(t){return 0===t.cs?t.tl:t.c[0]}function p(t){return 0===t.cs?t.tr:t.c[t.cs-1]}function d(t){return t.y+t.h}function f(t,e,n,r){var a=t.c[0].el;a.tl=n;var i=r-n.mod-t.c[0].msel;a.mod+=i,a.prelim-=i,t.c[0].el=t.c[e].el,t.c[0].msel=t.c[e].msel}function g(t,e,n,r){var a=t.c[e].er;a.tr=n;var i=r-n.mod-t.c[e].mser;a.mod+=i,a.prelim-=i,t.c[e].er=t.c[e-1].er,t.c[e].mser=t.c[e-1].mser}function y(t){t.prelim=(t.c[0].prelim+t.c[0].mod+t.c[t.cs-1].mod+t.c[t.cs-1].prelim+t.c[t.cs-1].w)/2-t.w/2}function v(t,e){e+=t.mod,t.x=t.prelim+e,x(t);for(var n=0;n<t.cs;n++)v(t.c[n],e)}function m(t,e,n,r){if(n!==e-1){var a=e-n;t.c[n+1].shift+=r/a,t.c[e].shift-=r/a,t.c[e].change-=r-r/a}}function x(t){for(var e=0,n=0,r=0;r<t.cs;r++)n+=(e+=t.c[r].shift)+t.c[r].change,t.c[r].mod+=n}function b(t,e,n){for(;null!==n&&t>=n.low;)n=n.nxt;return{low:t,index:e,nxt:n}}i(t,o);var w=n.fromNode(t,o);return s(w),v(w,0),a(w,t,o),r(t,o),t}},function(t,e,n){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}var i=n(0),o=n(8),s=n(1),c=function(t){function e(){return r(this,e),a(this,t.apply(this,arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.execute=function(){return this.rootNode.width=0,s(this.rootNode,this.options,o)},e}(i),h={};t.exports=function(t,e){return e=Object.assign({},h,e),new c(t,e).execute()}},function(t,e){function n(){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],e=this;e.x=e.y=0,e.leftChild=e.rightChild=null,e.height=0,e.children=t}var r={isHorizontal:!0,nodeSep:20,nodeSize:20,rankSep:200,subTreeSep:10};function a(t,e,n){n?(e.x=t.x,e.y=t.y):(e.x=t.y,e.y=t.x),t.children.forEach((function(t,r){a(t,e.children[r],n)}))}t.exports=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e=Object.assign({},r,e);var i=0;function o(t){if(!t)return null;t.width=0,t.depth&&t.depth>i&&(i=t.depth);var e=t.children,r=e.length,a=new n(t.height,[]);return e.forEach((function(t,e){var n=o(t);a.children.push(n),0===e&&(a.leftChild=n),e===r-1&&(a.rightChild=n)})),a.originNode=t,a.isLeaf=t.isLeaf(),a}function s(t){if(t.isLeaf||0===t.children.length)t.drawingDepth=i;else{var e=t.children.map((function(t){return s(t)})),n=Math.min.apply(null,e);t.drawingDepth=n-1}return t.drawingDepth}var c=void 0;function h(t){t.x=t.drawingDepth*e.rankSep,t.isLeaf?(t.y=0,c&&(t.y=c.y+c.height+e.nodeSep,t.originNode.parent!==c.originNode.parent&&(t.y+=e.subTreeSep)),c=t):(t.children.forEach((function(t){h(t)})),t.y=(t.leftChild.y+t.rightChild.y)/2)}var l=o(t);return s(l),h(l),a(l,t,e.isHorizontal),t}},function(t,e,n){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}var i=n(0),o=n(10),s=n(3),c=["LR","RL","H"],h=c[0],l=function(t){function e(){return r(this,e),a(this,t.apply(this,arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.execute=function(){var t=this.options,e=this.rootNode;t.isHorizontal=!0;var n=t.indent,r=t.direction||h;if(r&&-1===c.indexOf(r))throw new TypeError("Invalid direction: "+r);if(r===c[0])o(e,n);else if(r===c[1])o(e,n),e.right2left();else if(r===c[2]){var a=s(e,t),i=a.left,l=a.right;o(i,n),i.right2left(),o(l,n);var u=i.getBoundingBox();l.translate(u.width,0),e.x=l.x-e.width/2}return e},e}(i),u={};t.exports=function(t,e){return e=Object.assign({},u,e),new l(t,e).execute()}},function(t,e){function n(t,e,n){t.x+=n*t.depth,t.y=e?e.y+e.height:0}t.exports=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,r=null;t.eachNode((function(t){n(t,r,e),r=t}))}},function(t,e,n){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}var i=n(0),o=n(12),s=n(1),c=function(t){function e(){return r(this,e),a(this,t.apply(this,arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.execute=function(){return s(this.rootNode,this.options,o)},e}(i),h={};t.exports=function(t,e){return e=Object.assign({},h,e),new c(t,e).execute()}},function(t,e){function n(t,e){var r=0;return t.children.length?t.children.forEach((function(t){r+=n(t,e)})):r=t.height,t._subTreeSep=e.getSubTreeSep(t.data),t.totalHeight=Math.max(t.height,r)+2*t._subTreeSep,t.totalHeight}function r(t){var e=t.children,n=e.length;if(n){e.forEach((function(t){r(t)}));var a=e[0],i=e[n-1],o=i.y-a.y+i.height,s=0;if(e.forEach((function(t){s+=t.totalHeight})),o>t.height)t.y=a.y+o/2-t.height/2;else if(1!==e.length||t.height>s){var c=t.y+(t.height-o)/2-a.y;e.forEach((function(t){t.translate(0,c)}))}else t.y=(a.y+a.height/2+i.y+i.height/2)/2-t.height/2}}var a={getSubTreeSep:function(){return 0}};t.exports=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e=Object.assign({},a,e),t.parent={x:0,width:0,height:0,y:0},t.BFTraverse((function(t){t.x=t.parent.x+t.parent.width})),t.parent=null,n(t,e),t.startY=0,t.y=t.totalHeight/2-t.height/2,t.eachNode((function(t){var e=t.children,n=e.length;if(n){var r=e[0];if(r.startY=t.startY+t._subTreeSep,1===n)r.y=t.y+t.height/2-r.height/2;else{r.y=r.startY+r.totalHeight/2-r.height/2;for(var a=1;a<n;a++){var i=e[a];i.startY=e[a-1].startY+e[a-1].totalHeight,i.y=i.startY+i.totalHeight/2-i.height/2}}}})),r(t)}}])})),function(t,e){"function"==typeof define&&define.amd?define(["d3"],e):"object"==typeof exports?module.exports=e(require("d3")):t.markmap=e(t.d3)}(this,(function(t){var e,n,r,a,i,o=/([,;\n\r\u3002\uff0c\uff1b])/,s=/[\n\r]/,c=function(t){if(t instanceof Array)return t;if("number"==typeof t&&(t+=""),"string"==typeof t){var e=[];return t.split(",").forEach((function(t){t=t.trim(),/^\d+$|^[A-Za-z]+$/.test(t)&&e.push(t)})),e}return[]},h=function(t){return t instanceof Array?t:("number"==typeof t&&(t+=""),"string"==typeof t?[t]:[])};function l(t,e){return"H"===t.layoutDirection?"right"===e.side?"LR":"RL":"V"===t.layoutDirection?"right"===e.side?"TB":"BT":t.layoutDirection}function u(e){return function(n){var r=n.colorSetMode||"branch",a=t.scaleOrdinal(e);return function(t,e){var n=t;return"depth"===r&&(n=e.depth),a(n=n||0)}}}_escape=(e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},n=function(t){return e[t]},r="(?:"+Object.keys(e).join("|")+")",a=RegExp(r),i=RegExp(r,"g"),function(t){return t=null==t?"":""+t,a.test(t)?t.replace(i,n):t});var p=Object.assign||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t},d=0,f="",g=50;function y(t,e){if("M"==t&&e==f)return d;var n=(y.canvas||(y.canvas=document.createElement("canvas"))).getContext("2d");n.font=e;var r=n.measureText(t);return"M"==t&&f!=e&&(r.width<g&&(g=r.width),f=e,d=r.width),r.width}function v(t,e){!function(t,e){t.name=t.name.replace(/^([!]+)\s+/,(function(e,n){if(0!=t.depth){var r=n.length;1===r&&(t.important=!0),2===r&&(t.importantPath=!0),r>2&&(t.important=!0,t.importantPath=!0)}return""})),t.name=t.name.replace(/^!\*\s+/,(function(){return t.rangeNode=!0,""})),t.name=t.name.replace(/^\*\*(.*)\*\*$/,(function(e,n){return t.important=!0,n}))}(t),function(t,e){t.name=t.name.replace(/\s+#([A-Za-z]+)$/,(function(e,n){return t.customKey=n,""}))}(t),t.name=t.name.replace(/[\\]?\|/g,(function(t){return 2===t.length?"|":"\n"})).replace(/[\\]{1,2}n/g,(function(t){return 3===t.length?"\\n":"\n"})),function(t,e){var n=t.name.split(o);1===n.length&&(t.names=[t.name]),resultTexts=[];for(var r=0;r<n.length;r+=2){var a=n[r],i=n[r+1]||"";s.test(i)&&(i=""),a+=i,resultTexts.push(a),t.names=resultTexts}}(t),t.children&&t.children.forEach((function(n){n.parent=t,v(n,e)}))}function m(t,e,n){if(!(this instanceof m))return new m(t,e,n);this.init(t,e,n)}function x(t){var e=t.depth;return""!==t.name&&t.children&&1===t.children.length&&""===t.children[0].name&&(e+=1),t.data.importantPath?6:Math.max(6-2*e,1)}function b(t,e){t.data&&(t=t.data);var n=t.depth,r=e.fontSizeSet,a=e.fontFamilySet,i=r[n]||r[r.length-1]||"14";t.depth>0&&(t.important||t.importantPath)&&(i=parseInt(i)+5);var o=a[n]||a[a.length-1]||"sans-serif";return 0==n?"bolder "+i+"px "+o:i+"px "+o}var w={color:"gray",colorSet:null,colorSetMode:"branch",fontSizeSet:[30,20,15],fontFamilySet:[],linkShape:"diagonal",layoutDirection:"LR",fixForLink:!0,arrowSharp:5,arrowGap:1};return p(m.prototype,{getInitialState:function(){return{layoutDirection:"LR",arrowSharp:5,arrowGap:1,zoomScale:1,zoomTranslate:[0,0],depthMaxSize:{},nodeFont:"14px sans-serif"}},presets:{default:w,colorful:p(p({},w),{renderer:"basic",color:"category20"})},helperNames:["linkShape","color"],linkShapes:{diagonal:function(){return function(t,e){var n=l(t,e.target),r=null,a=null;switch(n){case"LR":r={x:e.source.x+(e.source.width-e.source.hgap),y:e.source.y+e.source.vgap,gap:e.source.hgap},a={x:e.target.x+e.target.hgap,y:e.target.y+e.target.vgap,gap:e.target.hgap};break;case"RL":r={x:e.source.x+e.source.hgap,y:e.source.y+e.source.vgap,gap:e.source.hgap},a={x:e.target.x+(e.target.width-e.target.hgap),y:e.target.y+e.target.vgap,gap:e.target.hgap};break;case"TB":r={x:e.source.x+e.source.hgap,y:e.source.y+(e.source.height-e.source.vgap),gap:e.source.vgap},a={x:e.target.x+e.target.hgap,y:e.target.y+e.target.vgap,gap:e.target.vgap};break;case"BT":r={x:e.source.x+e.source.hgap,y:e.source.y+e.source.vgap,gap:e.source.vgap},a={x:e.target.x+e.target.hgap,y:e.target.y+(e.target.height-e.target.vgap),gap:e.target.vgap}}var i="";switch(n){case"BT":i="M"+r.x+","+r.y+" L"+r.x+","+(r.y-t.arrowSharp)+" C"+r.x+","+(r.y-r.gap-t.arrowSharp)+" "+a.x+","+(a.y+a.gap)+" "+a.x+","+a.y+" L"+a.x+","+(a.y-2);break;case"TB":i="M"+r.x+","+r.y+" L"+r.x+","+(r.y+t.arrowSharp)+" C"+r.x+","+(r.y+r.gap+t.arrowSharp)+" "+a.x+","+(a.y-a.gap)+" "+a.x+","+a.y+" L"+a.x+","+(a.y+2);break;case"RL":i="M"+r.x+","+r.y+" L"+(r.x-t.arrowSharp)+","+r.y+" C"+(r.x-r.gap-t.arrowSharp)+","+r.y+" "+(a.x+a.gap)+","+a.y+" "+a.x+","+a.y+" L"+(a.x-2)+","+a.y;break;default:i="M"+r.x+","+r.y+" L"+(r.x+t.arrowSharp)+","+r.y+" C"+(r.x+r.gap+t.arrowSharp)+","+r.y+" "+(a.x-a.gap)+","+a.y+" "+a.x+","+a.y+" L"+(a.x+2)+","+a.y}return i}},bracket:function(){return function(t){return"M"+t.source.x+","+t.source.y+"V"+t.target.y+"H"+t.target.x}}},colors:p({gray:function(){return function(){return"#929292"}}},{category10:u(t.schemeCategory10),category20:u(["#3366cc","#dc3912","#ff9900","#109618","#990099","#0099c6","#dd4477","#66aa00","#b82e2e","#316395","#994499","#22aa99","#aaaa11","#6633cc","#e67300","#8b0707","#651067","#329262","#5574a6","#3b3eac"]),category20b:u(t.schemeCategory20b),category20c:u(t.schemeCategory20c),custom:function(t){var e=t.colorSet||[],n=t.colorSetMode||"branch",r=e.length;return r<=0&&(r=1,e=["#929292"]),function(t,a){var i=(t=t||0)%r;return"depth"===n&&(i=a.depth%r),e[i]}}}),init:function(e,n,r){this.elementSvg=document.querySelector(e),this.roughSvg=rough.svg(this.elementSvg),r=r||{},e=e.datum?e:t.select(e),this.helpers={},this.i=0;var a=this.state=this.getInitialState();this.colorSet=null,this.colorSetMode="branch",r.colorSet&&r.colorSet.length>0&&(r.color="custom",this.colorSet=r.colorSet),["branch","depth"].indexOf(r.colorSetMode)>=0&&(this.colorSetMode=r.colorSetMode),this.set(this.presets[r.preset||"default"]),this.set(r),e.attr("class","xsj_svg_viewbox"),this.containerSvg=e,this.svg=e.append("g"),this.setData(n),this.update(a.root)},updateZoom:function(t,e){var n=this.state;n.zoomTranslate=t,n.zoomScale=e,this.svg.attr("transform","translate("+n.zoomTranslate+") scale("+n.zoomScale+")")},set:function(t){t.preset&&this.set(this.presets[t.preset]);var e=this.state,n=this.helpers;return this.helperNames.forEach(function(r){(!n[r]||t[r]&&t[r]!==e[r])&&(n[r]=this[r+"s"][t[r]||e[r]](this))}.bind(this)),p(e,t||{}),e.importantNodes=c(t.importantNodes),e.importantPaths=c(t.importantPaths),e.rangeNodes=c(t.rangeNodes),e.annotations=h(t.annotations),e.relations=h(t.relations),this},setData:function(t){var e=this.state,n=0,r=function(t){t.id=++n,t.children&&t.children.length>0&&t.children.forEach(r)};return r(t),v(t,e),t.children&&t.children.forEach((function(t,n){!function t(e,n,r){e.branch=n,e.children&&e.children.forEach((function(e){t(e,n,r)}))}(t,n,e)})),(e=this.state).root=t,this},update:function(e){var n=this.state;e=e||n.root;var r=this.layout(n);n.rangeNodeInfos=[],n.relationInfos=[],n.annotationInfos=[];var a,i,o={};n.mapNodeObj=o,a=r.nodes,i=n.rangeNodeInfos,a.forEach((function(t){if(o[t.id]=t,t.data.customKey&&(o[t.data.customKey]=t),(n.importantNodes.indexOf(t.id)>=0||n.importantNodes.indexOf(t.data.customKey)>=0)&&(t.data.important=!0),(n.importantPaths.indexOf(t.id)>=0||n.importantPaths.indexOf(t.data.customKey)>=0)&&(t.data.importantPath=!0),t.data.importantPath)for(var e=t.data.parent;e;)e.importantPath=!0,e=e.parent;if((n.rangeNodes.indexOf(t.id)>=0||n.rangeNodes.indexOf(t.data.customKey)>=0)&&(t.data.rangeNode=!0),t.data.rangeNode){var r={rangeNodes:function(t){var e=[];return function t(e,r,a){var i=l(n,e);if(!r||r.children[0]==e)switch(i){case"RL":a.push([e.x+e.width,e.y-5]);break;case"TB":a.push([e.x,e.y-5]);break;case"BT":a.push([e.x,e.y+e.height-e.vgap/2]);break;default:a.push([e.x+e.hgap,e.y-5])}if(e.children&&e.children.length>0)e.children.forEach((function(e,n){t(e,e.parent,a)}));else switch(i){case"RL":a.push([e.x+e.hgap,e.y-5]),a.push([e.x+e.hgap,e.y+e.height-2*e.vgap]);break;case"TB":a.push([e.x,e.y+e.height-e.vgap/2]),a.push([e.x+e.width-e.hgap,e.y+e.height-e.vgap/2]);break;case"BT":a.push([e.x,e.y-5]),a.push([e.x+e.width-e.hgap,e.y-5]);break;default:a.push([e.x+e.width,e.y-5]),a.push([e.x+e.width,e.y+e.height-2*e.vgap])}if(!r||r.children[r.children.length-1]==e)switch(i){case"RL":a.push([e.x+e.width,e.y+e.height-2*e.vgap]);break;case"TB":a.push([e.x+e.width-e.hgap,e.y-5]);break;case"BT":a.push([e.x+e.width-e.hgap,e.y+e.height-e.vgap/2]);break;default:a.push([e.x+e.hgap,e.y+e.height-2*e.vgap])}}(t,null,e),e}(t),node:t};i.push(r)}}));var s=n.relations||[],c=n.relationInfos;s.forEach((function(t,e){var n=function(t){var n=t.split(/:(.+)/),r=n[0],a=n[1]||"",i=r.split(/([,<>])/);if(3==i.length){var s=o[i[0].trim()],h=o[i[2].trim()],l=i[1].trim(),u="normal";if("<"==l){u="right";var p=s;s=h,h=p}else">"==l?u="right":diretion="normal";s&&h&&c.push({id:"relation_"+e,startNode:s,endNode:h,note:a,direction:u})}};if("string"==typeof(t=t||"")&&n(t),t instanceof Object)for(var r in t)n(r+":"+t[r])}));var h=n.annotations||[],u=n.annotationInfos;var p=t.min(r.nodes,(function(t){return 0===t.depth&&["LR","RL","H"].indexOf(n.layoutDirection)<0?t.x-t.width/2+t.hgap+50:t.x}))-20,d=t.min(r.nodes,(function(t){return 0===t.depth&&["LR","RL","H"].indexOf(n.layoutDirection)>=0?t.y-t.height/2-t.vgap:t.y-t.vgap}))-20,f=function(t,e,r,a){var i={minX:t,maxX:e,minY:r,maxY:a};return h.forEach((function(s,c){var h=function(s){var h=s.split(/:(.+)/);if(3==h.length){var p=h[0],d=h[1]||"",f=p.split(","),g=[];if(f.forEach((function(t,e){var n=o[t.trim()];n&&g.push(n)})),g.length>0){var y=g.reduce((function(t,e){var r=l(n,e)||"LR";return t[r]=t[r]||[],t[r].push(e),t}),{}),v=[],m="LR";for(var x in y){var b=y[x];b.length>v&&(v=b,m=x)}var w=v[0],M=n.mapNodeObj[1],k={};switch(m){case"TB":k=M.x<w.x?{align:"top",lineType:"vertical",x:w.x-w.width,y:a+50}:{align:"top",lineType:"vertical",x:w.x+w.width,y:a+50},i.maxY=a+50;break;case"BT":k=M.x<w.x?{align:"bottom",lineType:"vertical",x:w.x-w.width,y:r}:{align:"bottom",lineType:"vertical",x:w.x+w.width,y:r},i.minY=r-30;break;case"RL":k=M.y<w.y?{align:"left",x:t-100,y:w.y-w.height}:{align:"left",x:t-100,y:w.y+w.height},i.minX=t-100;break;default:k=M.y<w.y?{align:"right",x:e+100,y:w.y-w.height}:{align:"right",x:e+100,y:w.y+w.height},i.maxX=e+100}u.push({id:"annotation_"+c,note:d,nodes:g,positionInfo:k})}}};if("string"==typeof(s=s||"")&&h(s),s instanceof Object)for(var p in s)h(p+":"+s[p])})),i}(p,t.max(r.nodes,(function(t){return 0===t.depth&&["LR","RL","H"].indexOf(n.layoutDirection)<0?t.x+t.width/2+20:t.x+t.width-t.hgap/2}))+20,d,t.max(r.nodes,(function(t){return 0===t.depth&&["LR","RL","H"].indexOf(n.layoutDirection)>=0?t.y+t.height/2+t.vgap:t.y+t.height}))+20),y=f.maxY-f.minY+10,v=f.maxX-f.minX+10;n.height=y,n.width=v;var m=Math.min(n.height/y,n.width/v,1),x=[(n.width-v*m)/2-f.minX*m,(n.height-y*m)/2-f.minY*m];this.containerSvg.attr("style","max-width:"+v+"px;max-height:"+y+"px;").attr("viewBox","0 0 "+v+" "+y).attr("width","100%").attr("height","100%"),this.updateZoom(x,m);Math.ceil(v/g),Math.ceil(y/g);return this.render(e,r.nodes,r.links),this},layout:function(e){e.linkShape;var n=0;function r(t){var n=t.names.map((function(n){return y(n,b(t,e))})),r=Math.max.apply(null,n);return r<15&&(r=15),0===t.depth&&(r+=20),r}function a(t,e){var n=t.names.length,r=(y("M",b(t,e))+5)*n+20;return r<10&&(r=10),0===t.depth&&(r+=20),0===t.depth&&r<60&&(r=60),r}function i(t){return 0===t.depth?72:36}var o=Hierarchy.compactBox(e.root,{direction:e.layoutDirection,getId:function(t){return t.id+""||"#"+ ++n},getWidth:function(t){return 0===t.depth?r(t)+4*e.arrowGap:["LR","RL","H"].indexOf(e.layoutDirection)>=0?r(t):a(t,e)},getHeight:function(t){return 0===t.depth||["LR","RL","H"].indexOf(e.layoutDirection)>=0?a(t,e):r(t)},getVGap:function(t){return 0===t.depth||["LR","RL","H"].indexOf(e.layoutDirection)>=0?18:i(t)},getHGap:function(t){return 0===t.depth||["LR","RL","H"].indexOf(e.layoutDirection)>=0?i(t):18}}),s=[],c=[];return function(e,n){if(e.children&&0!==e.children.length){var r=[];["V","H"].indexOf(n.layoutDirection)>=0?e.children.forEach((function(t){"right"===t.side&&r.push(t)})):r=e.children,0!==r.length&&(["LR","RL","H"].indexOf(n.layoutDirection)>=0?e.y=a(r,"y"):e.x=a(r,"x")-54)}function a(e,n){return t.mean(e,(function(t){return t[n]}))}}(o,e),o.eachNode((function(t){t.children.forEach((function(e){c.push({source:t,target:e})})),s.push(t)})),{nodes:s,links:c}},render:function(t,e,n){this.renderers[this.state.renderer].call(this,t,e,n)},renderers:{basic:function(e,n,r){var a=this.svg;a.append("defs").attr("xmlns","http://www.w3.org/2000/svg").html((function(){return'      <feGaussianBlur in="SourceAlpha" stdDeviation="3"/> ','      <feOffset dx="2" dy="2" result="offsetblur"/> ',"      <feMerge> ","        <feMergeNode/>",'        <feMergeNode in="SourceGraphic"/> ',"      </feMerge>","    </filter>",'<filter id="editing-stripe-bk" filterUnits="userSpaceOnUse" x="-100%" y="-100%" width="300%" height="300%"><feFlood flood-color="#700f0f" result="flood1"></feFlood><feFlood flood-color="#fff" flood-opacity="0.5" result="flood2"></feFlood><feImage xlink:href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMDAwcHgiIGhlaWdodD0iMTAwMHB4Ij48ZGVmcz48cGF0dGVybiBpZD0icGF0dGVybiIgcGF0dGVyblVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeD0iMCIgeT0iMCIgd2lkdGg9IjQiIGhlaWdodD0iNCI+PHBhdGggZD0iTSAtNCAtNCBMIDggOCBNIC04IC00IEwgNCA4IE0gLTQgLTggTCA4IDQiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxIi8+PC9wYXR0ZXJuPjwvZGVmcz48cmVjdCB4PSIwIiB5PSIwIiB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJ1cmwoI3BhdHRlcm4pIi8+PC9zdmc+" x="0" y="0" width="2000" height="1000" result="image"></feImage><feTile in="image" result="tile"></feTile><feComposite operator="in" in="flood1" in2="tile" result="tile2"></feComposite><feGaussianBlur in="SourceAlpha" stdDeviation="10" result="blur"></feGaussianBlur><feComposite operator="in" in="tile2" in2="blur" result="cloud"></feComposite><feMorphology operator="dilate" radius="2" in="SourceAlpha" result="dilate"></feMorphology><feComposite operator="in" in="flood2" in2="dilate" result="base"></feComposite><feMerge><feMergeNode in="cloud"></feMergeNode><feMergeNode in="base"></feMergeNode><feMergeNode in="SourceGraphic"></feMergeNode></feMerge></filter>','<filter xmlns="http://www.w3.org/2000/svg" id="dropshadow" height="130%">      <feGaussianBlur in="SourceAlpha" stdDeviation="3"/>       <feOffset dx="2" dy="2" result="offsetblur"/>       <feMerge>         <feMergeNode/>        <feMergeNode in="SourceGraphic"/>       </feMerge>    </filter><filter id="editing-stripe-bk" filterUnits="userSpaceOnUse" x="-100%" y="-100%" width="300%" height="300%"><feFlood flood-color="#700f0f" result="flood1"></feFlood><feFlood flood-color="#fff" flood-opacity="0.5" result="flood2"></feFlood><feImage xlink:href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMDAwcHgiIGhlaWdodD0iMTAwMHB4Ij48ZGVmcz48cGF0dGVybiBpZD0icGF0dGVybiIgcGF0dGVyblVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeD0iMCIgeT0iMCIgd2lkdGg9IjQiIGhlaWdodD0iNCI+PHBhdGggZD0iTSAtNCAtNCBMIDggOCBNIC04IC00IEwgNCA4IE0gLTQgLTggTCA4IDQiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxIi8+PC9wYXR0ZXJuPjwvZGVmcz48cmVjdCB4PSIwIiB5PSIwIiB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJ1cmwoI3BhdHRlcm4pIi8+PC9zdmc+" x="0" y="0" width="2000" height="1000" result="image"></feImage><feTile in="image" result="tile"></feTile><feComposite operator="in" in="flood1" in2="tile" result="tile2"></feComposite><feGaussianBlur in="SourceAlpha" stdDeviation="10" result="blur"></feGaussianBlur><feComposite operator="in" in="tile2" in2="blur" result="cloud"></feComposite><feMorphology operator="dilate" radius="2" in="SourceAlpha" result="dilate"></feMorphology><feComposite operator="in" in="flood2" in2="dilate" result="base"></feComposite><feMerge><feMergeNode in="cloud"></feMergeNode><feMergeNode in="base"></feMergeNode><feMergeNode in="SourceGraphic"></feMergeNode></feMerge></filter>'}));var i=this.state,o=this.helpers.color,s=this.helpers.linkShape,c=a.selectAll("g.markmap-node").data(n,function(t){return t.id||(t.id=++this.i)}.bind(this)).enter().append("g").attr("data-mindmap-line",(function(t){return t.data.line>=0?t.data.line:null})).attr("class",(function(t){return 0===t.depth?"markmap-node markmap-root-node":"markmap-node"})).attr("transform",(function(t){return"translate("+(t.x+t.hgap)+","+(t.y+t.vgap)+")"})),h=c.filter((function(t,e){return 0===t.depth})),u=h.append("g").attr("transform",(function(t){var e=0,n=0;return["LR","RL","H"].indexOf(i.layoutDirection)>=0?(e=0+i.arrowGap,n=-(t.height-2*t.vgap)/2+i.arrowGap):(n=0+i.arrowGap,e=-(t.width-2*t.hgap)/2+i.arrowGap),"translate("+e+", "+n+")"}));u.append("rect").attr("class","markmap-node-rect").attr("rx",10).attr("ry",10).attr("height",(function(t){return t.height-2*t.vgap-2*i.arrowGap})).attr("width",(function(t){return t.width-2*t.hgap-2*i.arrowGap})).attr("fill",(function(e){return t.rgb(o(e.data.branch,e.data)).brighter(1.2)})).attr("stroke",(function(t){return o(t.data.branch,t.data)})).attr("stroke-width",1);var p=u.filter((function(t,e){return!!t.data.link})),d=p.append("a").attr("xlink:href",(function(t){return t.data.link}));function f(t){i.fixForLink&&t.append("switch").append("foreignObject").attr("pointer-events","all").attr("style","overflow:visible").attr("width",(function(t){return t.width-2*t.hgap})).attr("y",(function(t){return 0===t.depth?(t.vgap+i.arrowGap)/2||0:["LR","RL","H"].indexOf(i.layoutDirection)>=0&&-(t.height-(t.vgap+i.arrowGap))/2||0})).attr("x",(function(t){return 0===t.depth&&(t.hgap+i.arrowGap)/2-20||0})).attr("height",(function(t){return 2*(t.height-2*t.vgap)})).append("div").attr("xmlns","http://www.w3.org/1999/xhtml").attr("class","xsj_foreignObject").style("visibility","hidden").style("display","inline-block").style("height","100%").style("width","100%").style("font",(function(t){return b(t,i)})).append("a").attr("href",(function(t){return t.data.link})).style("display","inline-block").style("height","100%").style("width","100%").html((function(t){return t.data.names.map((function(t,e){return _escape(t)})).join("<br/>")}))}f(p);var g=u.filter((function(t,e){return!t.data.link}));function v(e){e.append("text").attr("class","markmap-node-text").attr("alignment-baseline","middle").attr("x",(function(t){return(t.width-2*t.hgap)/2})).attr("y",(function(t){var e=t.data.names;return 1===e.length?(t.height-t.vgap)/2-5-1:(t.height-2*t.vgap-(y("M",b(t,i))+5)*(e.length-2))/2-5-1})).attr("text-anchor",(function(t){return"middle"})).html((function(t){var e=(t.width-2*t.hgap)/2,n=t.data.names;if(1===n.length)return _escape(n[0]);resultHtmls=[];for(var r=0;r<n.length;r++){var a=n[r];a=_escape(a);var o=r;o>0&&(o=y("M",b(t,i))+5),resultHtmls.push("<tspan x='"+e+"' dy='"+o+"'>"+a+"</tspan>")}return resultHtmls.join("")})).style("font",(function(t){return b(t,i)})).style("font-weight","bolder").style("cursor",(function(t){return t.data.link?"pointer":""})).style("fill-opacity",1).style("fill",(function(e){return t.color(invert(o(e.data.branch,e.data),!0))}))}v(d),v(g),h.selectAll("polygon").data((function(t,e){var n=[i.layoutDirection];return t.children&&0!==t.children.length?("H"==i.layoutDirection&&(n=t.children&&t.children.length>1?["LR","RL"]:["LR"]),"V"==i.layoutDirection&&(n=t.children&&t.children.length>1?["TB","BT"]:["TB"])):n=[],n.map((function(e){return{node:t,direction:e}}))})).enter().insert("polygon",":first-child").attr("class","markmap-node-polygon").attr("stroke-width","0").style("fill",(function(t){var e=t.node;return o(e.data.branch,e.data)})).attr("transform",(function(t){var e=t.node,n=0,r=0;switch(t.direction){case"RL":return"translate("+(n=i.arrowGap)+", "+r+")";case"TB":return"translate("+n+", "+(r=e.height-2*e.vgap-i.arrowGap)+") rotate(90)";case"BT":return"translate("+n+", "+(r=i.arrowGap)+") rotate(90)";default:return"translate("+(n=e.width-2*e.hgap-i.arrowGap)+", "+r+")"}})).attr("points",(function(t){var e=x(t.node),n=i.arrowSharp;return points=[[0,-e/2],[n,0],[0,e/2],[-n,0]],points.map((function(t){return[t[0],t[1]].join(",")})).join(" ")}));var m=(c=c.filter((function(t,e){return 0!==t.depth}))).filter((function(t){return!!t.data.link})),w=m.append("a").attr("xlink:href",(function(t){return t.data.link}));f(m);var M=c.filter((function(t){return!t.data.link}));function k(t){t.append("text").attr("class","markmap-node-text").attr("y","-5").attr("filter",(function(t){return t.data.important,null})).attr("text-anchor",(function(t){return"start"})).html((function(t){var e=t.data.names;if(1===e.length)return _escape(e[0]);resultHtmls=[];for(var n=y("M",b(t,i))*e.length,r=0;r<e.length;r++){var a=e[r];a=_escape(a);var o=r;o=o*(y("M",b(t,i))+5)-5,["LR","RL","H"].indexOf(i.layoutDirection)<0&&(o=n-o),["LR","RL","H"].indexOf(i.layoutDirection)>=0?resultHtmls.push("<tspan x='0' y='"+o+"'>"+a+"</tspan>"):resultHtmls.push("<tspan x='"+(o+10)+"' y='0'>"+a+"</tspan>")}return resultHtmls.join("")})).attr("x",(function(t){return["LR","RL","H"].indexOf(i.layoutDirection)>=0?0:12})).style("fill-opacity",1).style("font",(function(t){return b(t,i)})).style("fill",(function(t){return o(t.data.branch,t.data)})).style("stroke",(function(t){return"white"})).style("stroke-width",(function(t){return"2px"})).style("cursor",(function(t){return t.data.link?"pointer":""})).style("writing-mode",_).clone(!0).style("stroke",(function(t){return""})).style("stroke-width",(function(t){return""}))}function _(t){return!(["LR","RL","H"].indexOf(i.layoutDirection)>=0)&&"tb-rl"}!function(e,n){e.append("g").html((function(e){var r=y("M",b(e,i)),a=12,s=-5,c=e.data.names.length*(r+5)+5,h=e.width;["LR","RL","H"].indexOf(i.layoutDirection)>=0?(a=0,s=s-5-r,h-=2*e.hgap):(a=0,e.data.names.length>1&&(a=12),h=c,c=e.height-e.vgap);var l=t.color(o(e.data.branch,e.data)).brighter(.8);return l.opacity=.5,n.rectangle(a,s,h,c,{fill:l,stroke:"none",fillStyle:"zigzag"}).innerHTML}))}(c.filter((function(t){return t.data.important})),this.roughSvg),k(w),k(M);var S=a.selectAll("g.markmap-link").data(r,(function(t){return t.target.id}));linkEnter=S.enter().insert("g","g").attr("class","markmap-link").attr("style","fill:none;"),linkEnter.append("path").attr("stroke",(function(t){return o(t.target.data.branch,t.target.data)})).attr("stroke-width",(function(t){return x(t.target)})).attr("d",(function(t){return s(i,t)})),linkEnter.append("polygon").attr("class","markmap-link-polygon").attr("stroke-width","0").style("fill",(function(t){return"white"})).attr("transform",(function(t){var e=t.source.x,n=t.source.y;switch(l(i,t.target)){case"RL":return"translate("+(e=t.source.x+t.source.hgap)+", "+(n+t.source.vgap)+")";case"TB":return n=t.source.y+t.source.height-t.source.vgap,"translate("+(e+t.source.hgap)+", "+n+") rotate(90)";case"BT":return n=t.source.y+t.source.vgap,"translate("+(e+t.source.hgap)+", "+n+") rotate(90)";default:return"translate("+(e=t.source.x+t.source.width-t.source.hgap)+", "+(n+t.source.vgap)+")"}})).attr("points",(function(t){var e=x(t.source),n=i.arrowSharp;return points=[[0,-e/2],[n,0],[0,e/2],[-n,0]],points.map((function(t){return[t[0],t[1]].join(",")})).join(" ")}));var j=linkEnter.append("g").attr("transform",(function(t){var e=t.target;return"translate("+(e.x+e.hgap)+","+(e.y+e.vgap)+")"}));j.append("path").attr("class","markmap-node-path").attr("d",(function(e){var n=e.target,r=l(i,n),a=t.line(),o=0,s=0,c=0,h=0;switch(r){case"BT":s=i.arrowGap,h=n.height-2*n.vgap;break;case"TB":h=n.height-2*n.vgap-i.arrowGap;break;case"RL":o=i.arrowGap,c=n.width-2*n.hgap;break;default:c=n.width-2*n.hgap-i.arrowGap}var u=[[o,s]];if(n.data.important)switch(a=a.curve(t.curveCardinal),r){case"BT":case"TB":u=t.range(s,h-4,4).map((function(t){return[4*Math.sin(t),t]}));break;default:u=t.range(o,c-4,4).map((function(t){return[t,4*Math.sin(t)]}))}return u.push([c,h]),a(u)})).attr("stroke-width",(function(t){var e=t.target;return e.data.important?6:x(e)})).attr("stroke",(function(t){var e=t.target;return o(e.data.branch,e.data)})),j.append("polygon").attr("class","markmap-node-polygon").attr("stroke-width","0").style("fill",(function(t){var e=t.target;return o(e.data.branch,e.data)})).attr("transform",(function(t){var e=t.target,n=0,r=0;switch(l(i,e)){case"RL":return"translate("+(n=i.arrowGap)+", "+r+")";case"TB":return"translate("+n+", "+(r=e.height-2*e.vgap-i.arrowGap)+") rotate(90)";case"BT":return"translate("+n+", "+(r=i.arrowGap)+") rotate(90)";default:return"translate("+(n=e.width-2*e.hgap-i.arrowGap)+", "+r+")"}})).attr("points",(function(t){var e=x(t.target),n=i.arrowSharp;return points=[[0,-e/2],[n,0],[0,e/2],[-n,0]],points.map((function(t){return[t[0],t[1]].join(",")})).join(" ")}));var T=this.state.rangeNodeInfos||[];(T=T.reverse())&&T.length>0&&a.selectAll("g.range-node").data(T).enter().insert("g","g").attr("class","range-node").append("path").attr("d",(function(e){return t.line().curve(t.curveCatmullRomClosed)(e.rangeNodes.slice())})).style("fill",(function(e){var n=textures.paths().d("crosses").stroke(o(e.node.data.branch,e.node.data)).lighter(),r=t.color(invert(o(e.node.data.branch,e.node.data)));n=textures.circles().lighter().complement().fill(r);return a.call(n),n.url()})).attr("stroke",(function(e){return t.color(invert(o(e.node.data.branch,e.node.data)))}));var C=this.state.relationInfos||[];if(C&&C.length>0){var N=a.selectAll("g.relation-link").data(C).enter().append("g").attr("class","relation-link");N.append("path").attr("id",(function(t){return t.id})).attr("d",(function(e){var n=t.line().curve(t.curveCatmullRom);function r(t){return["V","TB","BT"].indexOf(i.layoutDirection)>=0?[t.x+t.hgap,t.y+t.height/2]:[t.x+t.width/2,t.y+t.vgap]}var a=r(i.mapNodeObj[1]),o=r(e.startNode),s=r(e.endNode),c=60;(o[1]-s[1])*a[0]+(s[0]-o[0])*a[1]+o[0]*s[1]-s[0]*o[1]>0&&(c=-c),preStartVec=[o[0]+(s[0]-o[0])/4+c,o[1]+(s[1]-o[1])/4+c],sufEndVec=[o[0]+3*(s[0]-o[0])/4+c,o[1]+3*(s[1]-o[1])/4+c];preStartVec,sufEndVec;return pathData=n([o,preStartVec,sufEndVec,s]),pathData})).attr("stroke",(function(e){return t.rgb(o(e.startNode.data.branch,e.startNode.data))})).attr("fill","none").attr("stroke-dasharray",4).attr("marker-end",(function(e){return"normal"!=e.direction?(a.append("svg:defs").append("svg:marker").attr("class","triangle").attr("id",(function(t){return"relation_arrow_"+e.id})).attr("viewBox","0 -5 10 10").attr("refX",6).attr("markerWidth",20).attr("markerHeight",20).attr("orient","auto").append("svg:path").attr("d","M0,-5L10,0L0,5").attr("fill","none").attr("stroke",(function(){return t.rgb(o(e.startNode.data.branch,e.startNode.data))})),"url(#relation_arrow_"+e.id+")"):null})),N.filter((function(t){return!!t.note})).append("text").append("textPath").attr("startOffset","50%").attr("text-anchor","middle").attr("fill",(function(e){return t.rgb(o(e.startNode.data.branch,e.startNode.data))})).attr("href",(function(t){return"#"+t.id})).text((function(t){return t.note}))}var P=[];(this.state.annotationInfos||[]).forEach((function(e,n){e.nodes.forEach((function(n,r){var a=n.x+n.width/2,o=n.y+n.vgap;["V","TB","BT"].indexOf(i.layoutDirection)>=0&&(a=n.x+n.hgap,o=n.y+n.height/2),P.push({note:{title:r?"":e.note,align:e.positionInfo.align,lineType:e.positionInfo.lineType,wrap:100},type:t.annotationCalloutCircle,subject:{radius:4,x1:a,x2:a+(n.width-2*n.hgap)/2,width:n.width-2*n.hgap,height:n.height-2*n.vgap},connector:{type:"curve",end:"arrow"},x:a,y:o,dx:e.positionInfo.x-a,dy:e.positionInfo.y-o})}))}));var O=t.annotation().type(t.annotationLabel).annotations(P);a.append("g").attr("class","annotation-group").call(O)}}}),m})),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3-selection"),require("d3-drag"),require("d3-shape"),require("d3-dispatch")):"function"==typeof define&&define.amd?define(["exports","d3-selection","d3-drag","d3-shape","d3-dispatch"],e):e(t.d3=t.d3||{},t.d3,t.d3,t.d3,t.d3)}(this,(function(t,e,n,r,a){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},s=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),c=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},h=function t(e,n,r){null===e&&(e=Function.prototype);var a=Object.getOwnPropertyDescriptor(e,n);if(void 0===a){var i=Object.getPrototypeOf(e);return null===i?void 0:t(i,n,r)}if("value"in a)return a.value;var o=a.get;return void 0!==o?o.call(r):void 0},l=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},u=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},p=function(){function t(e){var n=e.x,r=void 0===n?0:n,a=e.y,i=void 0===a?0:a,s=e.nx,c=e.ny,h=e.dy,l=void 0===h?0:h,u=e.dx,p=void 0===u?0:u,d=e.color,f=void 0===d?"grey":d,g=e.data,y=e.type,v=e.subject,m=e.connector,x=e.note,b=e.disable,w=e.id,M=e.className;o(this,t),this._dx=void 0!==s?s-r:p,this._dy=void 0!==c?c-i:l,this._x=r,this._y=i,this._color=f,this.id=w,this._className=M||"",this._type=y||"",this.data=g,this.note=x||{},this.connector=m||{},this.subject=v||{},this.disable=b||[]}return s(t,[{key:"updatePosition",value:function(){this.type.setPosition&&(this.type.setPosition(),this.type.subject&&0!==this.type.subject.selectAll(":not(.handle)").nodes().length&&this.type.redrawSubject())}},{key:"clearComponents",value:function(){this.type.clearComponents&&this.type.clearComponents()}},{key:"updateOffset",value:function(){this.type.setOffset&&(this.type.setOffset(),0!==this.type.connector.selectAll(":not(.handle)").nodes().length&&this.type.redrawConnector(),this.type.redrawNote())}},{key:"className",get:function(){return this._className},set:function(t){this._className=t,this.type.setClassName&&this.type.setClassName()}},{key:"type",get:function(){return this._type},set:function(t){this._type=t,this.clearComponents()}},{key:"x",get:function(){return this._x},set:function(t){this._x=t,this.updatePosition()}},{key:"y",get:function(){return this._y},set:function(t){this._y=t,this.updatePosition()}},{key:"color",get:function(){return this._color},set:function(t){this._color=t,this.updatePosition()}},{key:"dx",get:function(){return this._dx},set:function(t){this._dx=t,this.updateOffset()}},{key:"dy",get:function(){return this._dy},set:function(t){this._dy=t,this.updateOffset()}},{key:"nx",set:function(t){this._dx=t-this._x,this.updateOffset()}},{key:"ny",set:function(t){this._dy=t-this._y,this.updateOffset()}},{key:"offset",get:function(){return{x:this._dx,y:this._dy}},set:function(t){var e=t.x,n=t.y;this._dx=e,this._dy=n,this.updateOffset()}},{key:"position",get:function(){return{x:this._x,y:this._y}},set:function(t){var e=t.x,n=t.y;this._x=e,this._y=n,this.updatePosition()}},{key:"translation",get:function(){return{x:this._x+this._dx,y:this._y+this._dy}}},{key:"json",get:function(){var t={x:this._x,y:this._y,dx:this._dx,dy:this._dy};return this.data&&Object.keys(this.data).length>0&&(t.data=this.data),this.type&&(t.type=this.type),this._className&&(t.className=this._className),Object.keys(this.connector).length>0&&(t.connector=this.connector),Object.keys(this.subject).length>0&&(t.subject=this.subject),Object.keys(this.note).length>0&&(t.note=this.note),t}}]),t}(),d=function(){function t(e){var n=e.annotations,r=e.accessors,a=e.accessorsInverse;o(this,t),this.accessors=r,this.accessorsInverse=a,this.annotations=n}return s(t,[{key:"clearTypes",value:function(t){this.annotations.forEach((function(e){e.type=void 0,e.subject=t&&t.subject||e.subject,e.connector=t&&t.connector||e.connector,e.note=t&&t.note||e.note}))}},{key:"setPositionWithAccessors",value:function(){var t=this;this.annotations.forEach((function(e){e.type.setPositionWithAccessors(t.accessors)}))}},{key:"editMode",value:function(t){this.annotations.forEach((function(e){e.type&&(e.type.editMode=t,e.type.updateEditMode())}))}},{key:"updateDisable",value:function(t){this.annotations.forEach((function(e){e.disable=t,e.type&&t.forEach((function(t){e.type[t]&&(e.type[t].remove&&e.type[t].remove(),e.type[t]=void 0)}))}))}},{key:"updateTextWrap",value:function(t){this.annotations.forEach((function(e){e.type&&e.type.updateTextWrap&&e.type.updateTextWrap(t)}))}},{key:"updateText",value:function(){this.annotations.forEach((function(t){t.type&&t.type.drawText&&t.type.drawText()}))}},{key:"updateNotePadding",value:function(t){this.annotations.forEach((function(e){e.type&&(e.type.notePadding=t)}))}},{key:"json",get:function(){var t=this;return this.annotations.map((function(e){var n=e.json;return t.accessorsInverse&&e.data&&(n.data={},Object.keys(t.accessorsInverse).forEach((function(r){n.data[r]=t.accessorsInverse[r]({x:e.x,y:e.y})}))),n}))}},{key:"noteNodes",get:function(){return this.annotations.map((function(t){return c({},t.type.getNoteBBoxOffset(),{positionX:t.x,positionY:t.y})}))}}]),t}(),f=function(t,e){return"dynamic"!==t&&"left"!==t&&"right"!==t||(t=e<0?"top":"bottom"),t},g=function(t,e){return"dynamic"!==t&&"top"!==t&&"bottom"!==t||(t=e<0?"right":"left"),t},y=["topBottom","top","bottom"],v=["leftRight","left","right"],m=function(t){var e=t.data,n=t.curve,a=void 0===n?r.curveLinear:n,i=t.canvasContext,o=t.className,s=t.classID,c=r.line().curve(a),h={type:"path",className:o,classID:s,data:e};return i?(c.context(i),h.pathMethods=c):h.attrs={d:c(e)},h},x=function(t){var e=t.data,n=t.canvasContext,a={type:"path",className:t.className,classID:t.classID,data:e},i=r.arc().innerRadius(e.innerRadius||0).outerRadius(e.outerRadius||e.radius||2).startAngle(e.startAngle||0).endAngle(e.endAngle||2*Math.PI);return n?(i.context(n),a.pathMethods=lineGen):a.attrs={d:i()},a},b=function(t){var e=t.align,n=t.x,r=void 0===n?0:n,a=t.y,i=void 0===a?0:a,o=t.bbox,s=t.offset;"top"===(e=f(e,s.y))?i-=o.height:"middle"===e&&(i-=o.height/2);var c=[[r,i],[r,i+o.height]];return{components:[m({data:c,className:"note-line"})]}},w=function(t){var e=t.align,n=t.x,r=void 0===n?0:n,a=t.y,i=void 0===a?0:a,o=t.offset,s=t.bbox;"right"===(e=g(e,o.x))?r-=s.width:"middle"===e&&(r-=s.width/2);var c=[[r,i],[r+s.width,i]];return{components:[m({data:c,className:"note-line"})]}},M=function(t){var e=t.type,n=t.subjectType,r=e.annotation,a=r.position,i=r.x-a.x,o=i+r.dx,s=r.y-a.y,c=s+r.dy,h=r.subject;if("circle"===n&&(h.outerRadius||h.radius)){var l=Math.sqrt((i-o)*(i-o)+(s-c)*(s-c)),u=Math.asin(-c/l),p=h.outerRadius||h.radius+(h.radiusPadding||0);i=Math.abs(Math.cos(u)*p)*(o<0?-1:1),s=Math.abs(Math.sin(u)*p)*(c<0?-1:1)}if("rect"===n){var d=h.width,f=h.height;(d>0&&r.dx>0||d<0&&r.dx<0)&&(i=Math.abs(d)>Math.abs(r.dx)?d/2:d),(f>0&&r.dy>0||f<0&&r.dy<0)&&(s=Math.abs(f)>Math.abs(r.dy)?f/2:f),i===d/2&&s===f/2&&(i=o,s=c)}return[[i,s],[o,c]]},k=function(t){var e=M(t);return{components:[m({data:e,className:"connector"})]}},_=function(t){var e=t.type,n=t.subjectType,r=e.annotation,a=r.position,i=r.x-a.x,o=i+r.dx,s=r.y-a.y,c=s+r.dy,h=r.subject;if("rect"===n){var l=h.width,u=h.height;(l>0&&r.dx>0||l<0&&r.dx<0)&&(i=Math.abs(l)>Math.abs(r.dx)?l/2:l),(u>0&&r.dy>0||u<0&&r.dy<0)&&(s=Math.abs(u)>Math.abs(r.dy)?u/2:u),i===l/2&&s===u/2&&(i=o,s=c)}var p=[[i,s],[o,c]],d=c-s,f=o-i,g=o,y=c,v=c<s&&o>i||o<i&&c>s?-1:1;if(Math.abs(f)<Math.abs(d)?(g=o,y=s+f*v):(y=c,g=i+d*v),"circle"===n&&(h.outerRadius||h.radius)){var x=(h.outerRadius||h.radius)+(h.radiusPadding||0),b=x/Math.sqrt(2);if(Math.abs(f)>b&&Math.abs(d)>b)p=[[i=b*(o<0?-1:1),s=b*(c<0?-1:1)],[g,y],[o,c]];else if(Math.abs(f)>Math.abs(d)){var w=Math.asin(-c/x);p=[[i=Math.abs(Math.cos(w)*x)*(o<0?-1:1),c],[o,c]]}else{var M=Math.acos(o/x);p=[[o,s=Math.abs(Math.sin(M)*x)*(c<0?-1:1)],[o,c]]}}else p=[[i,s],[g,y],[o,c]];return{components:[m({data:p,className:"connector"})]}},S=function(t){var n=t.type,a=t.connectorData,i=t.subjectType;a||(a={}),a.points&&"number"!=typeof a.points||(a.points=j(n.annotation.offset,a.points)),a.curve||(a.curve=r.curveCatmullRom);var o=[];if(n.editMode){var s=a.points.map((function(t,e){return c({},function(t){var e=t.cx,n=void 0===e?0:e,r=t.cy;return{move:{x:n,y:void 0===r?0:r}}}({cx:t[0],cy:t[1]}),{index:e})})),h=function(t){a.points[t][0]+=e.event.dx,a.points[t][1]+=e.event.dy,n.redrawConnector()};o=n.mapHandles(s.map((function(t){return c({},t.move,{drag:h.bind(n,t.index)})})))}var l=M({type:n,subjectType:i});return l=[l[0]].concat(function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}(a.points),[l[1]]),{components:[m({data:l,curve:a.curve,className:"connector"})],handles:o}},j=function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,n={x:t.x/(e+1),y:t.y/(e+1)},r=[],a=1;a<=e;a++)r.push([n.x*a+a%2*20,n.y*a-a%2*20]);return r},T=function(t){var e=t.annotation,n=t.start,r=t.end,a=t.scale,i=void 0===a?1:a,o=e.position;n=n?[-r[0]+n[0],-r[1]+n[1]]:[e.dx,e.dy],r||(r=[e.x-o.x,e.y-o.y]);var s=r[0],c=r[1],h=n[0],l=n[1],u=10*i,p=16/180*Math.PI,d=Math.atan(l/h);h<0&&(d+=Math.PI);var f=[[s,c],[Math.cos(d+p)*u+s,Math.sin(d+p)*u+c],[Math.cos(d-p)*u+s,Math.sin(d-p)*u+c],[s,c]];return{components:[m({data:f,className:"connector-end connector-arrow",classID:"connector-end"})]}},C=function(t){var e=t.line,n=t.scale,r=void 0===n?1:n,a=x({className:"connector-end connector-dot",classID:"connector-end",data:{radius:3*Math.sqrt(r)}});return a.attrs.transform="translate("+e.data[0][0]+", "+e.data[0][1]+")",{components:[a]}},N=function(t){var n=t.subjectData,r=t.type;n.radius||n.outerRadius||(n.radius=20);var a=[],i=x({data:n,className:"subject"});if(r.editMode){var o=function(t){var e=t.cx,n=void 0===e?0:e,r=t.cy,a=void 0===r?0:r,i=t.r1,o=t.r2,s=t.padding,c={move:{x:n,y:a}};return void 0!==i&&(c.r1={x:n+i/Math.sqrt(2),y:a+i/Math.sqrt(2)}),void 0!==o&&(c.r2={x:n+o/Math.sqrt(2),y:a+o/Math.sqrt(2)}),void 0!==s&&(c.padding={x:n+i+s,y:a}),c}({r1:i.data.outerRadius||i.data.radius,r2:i.data.innerRadius,padding:n.radiusPadding}),s=function(t){var a=n[t]+e.event.dx*Math.sqrt(2);n[t]=a,r.redrawSubject(),r.redrawConnector()},h=[c({},o.r1,{drag:s.bind(r,void 0!==n.outerRadius?"outerRadius":"radius")})];n.innerRadius&&h.push(c({},o.r2,{drag:s.bind(r,"innerRadius")})),a=r.mapHandles(h)}return i.attrs["fill-opacity"]=0,{components:[i],handles:a}},P=function(t){var n=t.subjectData,r=t.type;n.width||(n.width=100),n.height||(n.height=100);var a=[],i=n.width,o=n.height,s=m({data:[[0,0],[i,0],[i,o],[0,o],[0,0]],className:"subject"});if(r.editMode){var c=[{x:i,y:o/2,drag:function(){n.width=e.event.x,r.redrawSubject(),r.redrawConnector()}.bind(r)},{x:i/2,y:o,drag:function(){n.height=e.event.y,r.redrawSubject(),r.redrawConnector()}.bind(r)}];a=r.mapHandles(c)}return s.attrs["fill-opacity"]=.1,{components:[s],handles:a}},O=function(t){var e=t.subjectData,n=t.type.annotation.position,r=(void 0!==e.x1?e.x1:n.x)-n.x,a=(void 0!==e.x2?e.x2:n.x)-n.x,i=(void 0!==e.y1?e.y1:n.y)-n.y,o=(void 0!==e.y2?e.y2:n.y)-n.y;return{components:[m({data:[[r,i],[a,o]],className:"subject"})]}},E=function(t){var n=t.subjectData,r=void 0===n?{}:n,a=t.type,i=void 0===a?{}:a,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=i.typeSettings&&i.typeSettings.subject;r.radius||(s&&s.radius?r.radius=s.radius:r.radius=14),r.x||s&&s.x&&(r.x=s.x),r.y||s&&s.y&&(r.y=s.y);var c=[],h=[],l=r.radius,u=.7*l,p=0,d=0,f=Math.sqrt(2)*l,g={xleftcorner:-l,xrightcorner:l,ytopcorner:-l,ybottomcorner:l,xleft:-f,xright:f,ytop:-f,ybottom:f};r.x&&!r.y?p=g["x"+r.x]:r.y&&!r.x?d=g["y"+r.y]:r.x&&r.y&&(p=g["x"+r.x+"corner"],d=g["y"+r.y+"corner"]);var y="translate("+p+", "+d+")",v=x({className:"subject",data:{radius:l}});v.attrs.transform=y,v.attrs.fill=o.color,v.attrs["stroke-linecap"]="round",v.attrs["stroke-width"]="3px";var b=x({className:"subject-ring",data:{outerRadius:l,innerRadius:u}});b.attrs.transform=y,b.attrs["stroke-width"]="3px",b.attrs.fill="white";var w=void 0;if(p&&d||!p&&!d)w=m({className:"subject-pointer",data:[[0,0],[p||0,0],[0,d||0],[0,0]]});else if(p||d){var M=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return t&&t/Math.sqrt(2)/Math.sqrt(2)||e*l/Math.sqrt(2)};w=m({className:"subject-pointer",data:[[0,0],[M(p),M(d)],[M(p,-1),M(d,-1)],[0,0]]})}if(w&&(w.attrs.fill=o.color,w.attrs["stroke-linecap"]="round",w.attrs["stroke-width"]="3px",h.push(w)),i.editMode){var k=function(){r.x=e.event.x<2*-l?"left":e.event.x>2*l?"right":void 0,r.y=e.event.y<2*-l?"top":e.event.y>2*l?"bottom":void 0,i.redrawSubject()},_={x:2*p,y:2*d,drag:k.bind(i)};_.x||_.y||(_.y=-l),c=i.mapHandles([_])}var S=void 0;return r.text&&(S={type:"text",className:"badge-text",attrs:{fill:"white",stroke:"none","font-size":".7em",text:r.text,"text-anchor":"middle",dy:".25em",x:p,y:d}}),h.push(v),h.push(b),h.push(S),{components:h,handles:c}},R=function(){function t(e){var n=e.a,r=e.annotation,a=e.editMode,i=e.dispatcher,s=e.notePadding,c=e.accessors;if(o(this,t),this.a=n,this.note=-1===r.disable.indexOf("note")&&n.select("g.annotation-note"),this.noteContent=this.note&&n.select("g.annotation-note-content"),this.connector=-1===r.disable.indexOf("connector")&&n.select("g.annotation-connector"),this.subject=-1===r.disable.indexOf("subject")&&n.select("g.annotation-subject"),this.dispatcher=i,i){var h=X.bind(null,i,r);h({component:this.note,name:"note"}),h({component:this.connector,name:"connector"}),h({component:this.subject,name:"subject"})}this.annotation=r,this.editMode=r.editMode||a,this.notePadding=void 0!==s?s:3,this.offsetCornerX=0,this.offsetCornerY=0,c&&r.data&&this.init(c)}return s(t,[{key:"init",value:function(t){this.annotation.x||this.mapX(t),this.annotation.y||this.mapY(t)}},{key:"mapY",value:function(t){t.y&&(this.annotation.y=t.y(this.annotation.data))}},{key:"mapX",value:function(t){t.x&&(this.annotation.x=t.x(this.annotation.data))}},{key:"updateEditMode",value:function(){this.a.selectAll("circle.handle").remove()}},{key:"drawOnSVG",value:function(t,r){var a=this;Array.isArray(r)||(r=[r]),r.filter((function(t){return t})).forEach((function(r){var i=r.type,o=r.className,s=r.attrs,c=r.handles,h=r.classID;if("handle"===i)!function(t){var r=t.group,a=t.handles,i=t.r,o=void 0===i?10:i,s=r.selectAll("circle.handle").data(a);s.enter().append("circle").attr("class","handle").attr("fill","grey").attr("fill-opacity",.1).attr("cursor","move").attr("stroke-dasharray",5).attr("stroke","grey").call(n.drag().container(e.select("g.annotations").node()).on("start",(function(t){return t.start&&t.start(t)})).on("drag",(function(t){return t.drag&&t.drag(t)})).on("end",(function(t){return t.end&&t.end(t)}))),r.selectAll("circle.handle").attr("cx",(function(t){return t.x})).attr("cy",(function(t){return t.y})).attr("r",(function(t){return t.r||o})).attr("class",(function(t){return"handle "+(t.className||"")})),s.exit().remove()}({group:t,r:s&&s.r,handles:c});else{V(t,[a.annotation],i,o,h);for(var l=t.select(i+"."+(h||o)),u=Object.keys(s),p=[],d=l.node().attributes,f=d.length-1;f>=0;f--){var g=d[f].name;-1===u.indexOf(g)&&"class"!==g&&p.push(g)}u.forEach((function(t){"text"===t?l.text(s[t]):l.attr(t,s[t])})),p.forEach((function(t){return l.attr(t,null)}))}}))}},{key:"getNoteBBox",value:function(){return J(this.note,".annotation-note-content text")}},{key:"getNoteBBoxOffset",value:function(){var t=J(this.note,".annotation-note-content"),e=this.noteContent.attr("transform").split(/\(|\,|\)/g);return t.offsetCornerX=parseFloat(e[1])+this.annotation.dx,t.offsetCornerY=parseFloat(e[2])+this.annotation.dy,t.offsetX=this.annotation.dx,t.offsetY=this.annotation.dy,t}},{key:"drawSubject",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=this.annotation.subject,r=e.type,a={type:this,subjectData:n},i={};"circle"===r?i=N(a):"rect"===r?i=P(a):"threshold"===r?i=O(a):"badge"===r&&(i=E(a,this.annotation));var o=i,s=o.components,c=void 0===s?[]:s,h=o.handles,l=void 0===h?[]:h;return c.forEach((function(e){e&&e.attrs&&!e.attrs.stroke&&(e.attrs.stroke=t.annotation.color)})),this.editMode&&(l=l.concat(this.mapHandles([{drag:this.dragSubject.bind(this)}])),c.push({type:"handle",handles:l})),c}},{key:"drawConnector",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=this.annotation.connector,r=n.type||e.type,a={type:this,connectorData:n};a.subjectType=this.typeSettings&&this.typeSettings.subject&&this.typeSettings.subject.type;var i="curve"===r?S(a):"elbow"===r?_(a):k(a),o=i.components,s=void 0===o?[]:o,c=i.handles,h=void 0===c?[]:c,l=s[0];l&&(l.attrs.stroke=this.annotation.color,l.attrs.fill="none");var u=n.end||e.end,p={};if("arrow"===u){var d=l.data[1],f=l.data[0],g=Math.sqrt(Math.pow(d[0]-f[0],2)+Math.pow(d[1]-f[1],2));g<5&&l.data[2]&&(d=l.data[2]),p=T({annotation:this.annotation,start:d,end:f,scale:n.endScale})}else"dot"===u?p=C({line:l,scale:n.endScale}):u&&"none"!==u||this.connector&&this.connector.select(".connector-end").remove();return p.components&&(p.components.forEach((function(e){e.attrs.fill=t.annotation.color,e.attrs.stroke=t.annotation.color})),s=s.concat(p.components)),this.editMode&&0!==h.length&&s.push({type:"handle",handles:h}),s}},{key:"drawNote",value:function(){var t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=this.annotation.note,i=a.align||r.align||"dynamic",o={bbox:r.bbox,align:i,offset:this.annotation.offset},s=a.lineType||r.lineType,c={};"vertical"===s?c=b(o):"horizontal"===s&&(c=w(o));var h=c,l=h.components,u=void 0===l?[]:l,p=h.handles,d=void 0===p?[]:p;if(u.forEach((function(e){e.attrs.stroke=t.annotation.color})),this.editMode){d=this.mapHandles([{x:0,y:0,drag:this.dragNote.bind(this)}]),u.push({type:"handle",handles:d});var f=this.dragNote.bind(this),g=this.dragstarted.bind(this),y=this.dragended.bind(this);this.note.call(n.drag().container(e.select("g.annotations").node()).on("start",(function(t){return g(t)})).on("drag",(function(t){return f(t)})).on("end",(function(t){return y(t)})))}else this.note.on("mousedown.drag",null);return u}},{key:"drawNoteContent",value:function(t){var e=this.annotation.note,n=void 0!==e.padding?e.padding:this.notePadding,r=e.orientation||t.orientation||"topBottom",a=e.lineType||t.lineType,i=e.align||t.align||"dynamic";"vertical"===a?r="leftRight":"horizontal"===a&&(r="topBottom");var o=function(t){var e=t.padding,n=void 0===e?0:e,r=t.bbox,a=void 0===r?{x:0,y:0,width:0,height:0}:r,i=t.align,o=t.orientation,s=t.offset,c=void 0===s?{x:0,y:0}:s,h=-a.x,l=0;return-1!==y.indexOf(o)?(i=g(i,c.x),c.y<0&&"topBottom"===o||"top"===o?l-=a.height+n:l+=n,"middle"===i?h-=a.width/2:"right"===i&&(h-=a.width)):-1!==v.indexOf(o)&&(i=f(i,c.y),c.x<0&&"leftRight"===o||"left"===o?h-=a.width+n:h+=n,"middle"===i?l-=a.height/2:"top"===i&&(l-=a.height)),{x:h,y:l}}({padding:n,bbox:t.bbox,offset:this.annotation.offset,orientation:r,align:i}),s=o.x,c=o.y;return this.offsetCornerX=s+this.annotation.dx,this.offsetCornerY=c+this.annotation.dy,this.note&&this.noteContent.attr("transform","translate("+s+", "+c+")"),[]}},{key:"drawOnScreen",value:function(t,e){return this.drawOnSVG(t,e)}},{key:"redrawSubject",value:function(){this.subject&&this.drawOnScreen(this.subject,this.drawSubject())}},{key:"redrawConnector",value:function(){this.connector&&this.drawOnScreen(this.connector,this.drawConnector())}},{key:"redrawNote",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getNoteBBox();this.noteContent&&this.drawOnScreen(this.noteContent,this.drawNoteContent({bbox:t})),this.note&&this.drawOnScreen(this.note,this.drawNote({bbox:t}))}},{key:"setPosition",value:function(){var t=this.annotation.position;this.a.attr("transform","translate("+t.x+", "+t.y+")")}},{key:"clearComponents",value:function(){this.subject&&this.subject.select("*").remove(),this.connector&&this.connector.select("*").remove()}},{key:"setOffset",value:function(){if(this.note){var t=this.annotation.offset;this.note.attr("transform","translate("+t.x+", "+t.y+")")}}},{key:"setPositionWithAccessors",value:function(t){t&&this.annotation.data&&(this.mapX(t),this.mapY(t)),this.setPosition()}},{key:"setClassName",value:function(){this.a.attr("class","annotation "+(this.className&&this.className())+" "+(this.editMode?"editable":"")+" "+(this.annotation.className||""))}},{key:"draw",value:function(){this.setClassName(),this.setPosition(),this.setOffset(),this.redrawSubject(),this.redrawConnector(),this.redrawNote()}},{key:"dragstarted",value:function(){e.event.sourceEvent.stopPropagation(),this.dispatcher&&this.dispatcher.call("dragstart",this.a,this.annotation),this.a.classed("dragging",!0),this.a.selectAll("circle.handle").style("pointer-events","none")}},{key:"dragended",value:function(){this.dispatcher&&this.dispatcher.call("dragend",this.a,this.annotation),this.a.classed("dragging",!1),this.a.selectAll("circle.handle").style("pointer-events","all")}},{key:"dragSubject",value:function(){var t=this.annotation.position;t.x+=e.event.dx,t.y+=e.event.dy,this.annotation.position=t}},{key:"dragNote",value:function(){var t=this.annotation.offset;t.x+=e.event.dx,t.y+=e.event.dy,this.annotation.offset=t}},{key:"mapHandles",value:function(t){var e=this;return t.map((function(t){return c({},t,{start:e.dragstarted.bind(e),end:e.dragended.bind(e)})}))}}]),t}(),L=function(t,e,n){return function(t){function r(t){o(this,r);var n=u(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,t));return n.typeSettings=e,e.disable&&e.disable.forEach((function(t){n[t]&&n[t].remove(),n[t]=void 0,"note"===t&&(n.noteContent=void 0)})),n}return l(r,t),s(r,[{key:"className",value:function(){return""+(e.className||h(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"className",this)&&h(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"className",this).call(this)||"")}},{key:"drawSubject",value:function(t){return this.typeSettings.subject=c({},e.subject,this.typeSettings.subject),h(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"drawSubject",this).call(this,c({},t,this.typeSettings.subject))}},{key:"drawConnector",value:function(t){return this.typeSettings.connector=c({},e.connector,this.typeSettings.connector),h(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"drawConnector",this).call(this,c({},t,e.connector,this.typeSettings.connector))}},{key:"drawNote",value:function(t){return this.typeSettings.note=c({},e.note,this.typeSettings.note),h(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"drawNote",this).call(this,c({},t,e.note,this.typeSettings.note))}},{key:"drawNoteContent",value:function(t){return h(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"drawNoteContent",this).call(this,c({},t,e.note,this.typeSettings.note))}}],[{key:"init",value:function(t,e){return h(r.__proto__||Object.getPrototypeOf(r),"init",this).call(this,t,e),n&&(t=n(t,e)),t}}]),r}(t)},I=function(t){function e(t){o(this,e);var n=u(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.textWrap=t.textWrap||120,n.drawText(),n}return l(e,t),s(e,[{key:"updateTextWrap",value:function(t){this.textWrap=t,this.drawText()}},{key:"drawText",value:function(){if(this.note){V(this.note,[this.annotation],"g","annotation-note-content");var t=this.note.select("g.annotation-note-content");V(t,[this.annotation],"rect","annotation-note-bg"),V(t,[this.annotation],"text","annotation-note-label"),V(t,[this.annotation],"text","annotation-note-title");var e={height:0},n=this.a.select("text.annotation-note-label"),r=this.annotation.note&&this.annotation.note.wrap||this.typeSettings&&this.typeSettings.note&&this.typeSettings.note.wrap||this.textWrap,a=this.annotation.note&&this.annotation.note.wrapSplitter||this.typeSettings&&this.typeSettings.note&&this.typeSettings.note.wrapSplitter,o=this.annotation.note&&this.annotation.note.bgPadding||this.typeSettings&&this.typeSettings.note&&this.typeSettings.note.bgPadding,s={top:0,bottom:0,left:0,right:0};if("number"==typeof o?s={top:o,bottom:o,left:o,right:o}:o&&"object"===(void 0===o?"undefined":i(o))&&(s=c(s,o)),this.annotation.note.title){var h=this.a.select("text.annotation-note-title");h.text(this.annotation.note.title),h.attr("fill",this.annotation.color),h.attr("font-weight","bold"),h.call(F,r,a),e=h.node().getBBox()}n.text(this.annotation.note.label).attr("dx","0"),n.call(F,r,a),n.attr("y",1.1*e.height||0),n.attr("fill",this.annotation.color);var l=this.getNoteBBox();this.a.select("rect.annotation-note-bg").attr("width",l.width+s.left+s.right).attr("height",l.height+s.top+s.bottom).attr("x",l.x-s.left).attr("y",-s.top).attr("fill","white").attr("fill-opacity",0)}}}]),e}(R),A=L(I,{className:"label",note:{align:"middle"}}),B=L(I,{className:"callout",note:{lineType:"horizontal"}}),H=L(B,{className:"callout elbow",connector:{type:"elbow"}}),D=L(B,{className:"callout curve",connector:{type:"curve"}}),z=L(R,{className:"badge",subject:{type:"badge"},disable:["connector","note"]}),G=L(I,{className:"callout circle",subject:{type:"circle"},note:{lineType:"horizontal"},connector:{type:"elbow"}}),q=L(I,{className:"callout rect",subject:{type:"rect"},note:{lineType:"horizontal"},connector:{type:"elbow"}}),W=L(function(t){function e(){return o(this,e),u(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return l(e,t),s(e,[{key:"mapY",value:function(t){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"mapY",this).call(this,t);var n=this.annotation;(n.subject.x1||n.subject.x2)&&n.data&&t.y&&(n.y=t.y(n.data)),!n.subject.x1&&!n.subject.x2||n.x||(n.x=n.subject.x1||n.subject.x2)}},{key:"mapX",value:function(t){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"mapX",this).call(this,t);var n=this.annotation;(n.subject.y1||n.subject.y2)&&n.data&&t.x&&(n.x=t.x(n.data)),!n.subject.y1&&!n.subject.y2||n.y||(n.y=n.subject.y1||n.subject.y2)}}]),e}(B),{className:"callout xythreshold",subject:{type:"threshold"}}),V=function(t,e,n,r,a){var i=t.selectAll(n+"."+(a||r)).data(e);return i.enter().append(n).merge(i).attr("class",r),i.exit().remove(),t},X=function(t,e,n){var r=n.component,a=n.name;r&&r.on("mouseover.annotations",(function(){t.call(a+"over",r,e)})).on("mouseout.annotations",(function(){return t.call(a+"out",r,e)})).on("click.annotations",(function(){return t.call(a+"click",r,e)}))},F=function(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1.2;t.each((function(){for(var t=e.select(this),i=t.text().split(r||/[ \t\r\n]+/).reverse().filter((function(t){return""!==t})),o=void 0,s=[],c=t.text(null).append("tspan").attr("x",0).attr("dy","0.8em");o=i.pop();)s.push(o),c.text(s.join(" ")),c.node().getComputedTextLength()>n&&s.length>1&&(s.pop(),c.text(s.join(" ")),s=[o],c=t.append("tspan").attr("x",0).attr("dy",a+"em").text(o))}))},J=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:":not(.handle)";return t?t.selectAll(e).nodes().reduce((function(t,e){var n=e.getBBox();t.x=Math.min(t.x,n.x),t.y=Math.min(t.y,n.y),t.width=Math.max(t.width,n.width);var r=e&&e.attributes&&e.attributes.y;return t.height=Math.max(t.height,(r&&parseFloat(r.value)||0)+n.height),t}),{x:0,y:0,width:0,height:0}):{x:0,y:0,width:0,height:0}};function U(){var t=[],n=void 0,r=void 0,i=[],o={},s={},c=!1,h=void 0,l=B,u=void 0,f=void 0,g=a.dispatch("subjectover","subjectout","subjectclick","connectorover","connectorout","connectorclick","noteover","noteout","noteclick","dragend","dragstart"),y=void 0,v=function(r){y=r,c||r.selectAll("circle.handle").remove();var a=t.map((function(t){return t.type||(t.type=l),t.disable||(t.disable=i),new p(t)}));n=n||new d({annotations:a,accessors:o,accessorsInverse:s,ids:h}),r.selectAll("g").data([n]).enter().append("g").attr("class","annotations");var v=r.select("g.annotations");V(v,n.annotations,"g","annotation");var m=v.selectAll("g.annotation");m.each((function(t){var n=e.select(this);n.attr("class","annotation"),V(n,[t],"g","annotation-connector"),V(n,[t],"g","annotation-subject"),V(n,[t],"g","annotation-note"),V(n.select("g.annotation-note"),[t],"g","annotation-note-content"),t.type="[object Object]"===t.type.toString()?t.type:new t.type({a:n,annotation:t,textWrap:u,notePadding:f,editMode:c,dispatcher:g,accessors:o}),t.type.draw(),t.type.drawText&&t.type.drawText()}))};return v.json=function(){return console.log("Annotations JSON was copied to your clipboard. Please note the annotation type is not JSON compatible. It appears in the objects array in the console, but not in the copied JSON.",n.json),window.copy(JSON.stringify(n.json.map((function(t){return delete t.type,t})))),v},v.update=function(){return t&&n&&(t=n.annotations.map((function(t){return t.type.draw(),t}))),v},v.updateText=function(){return n&&(n.updateText(u),t=n.annotations),v},v.updatedAccessors=function(){return n.setPositionWithAccessors(),t=n.annotations,v},v.disable=function(e){return arguments.length?(i=e,n&&(n.updateDisable(i),t=n.annotations),v):i},v.textWrap=function(e){return arguments.length?(u=e,n&&(n.updateTextWrap(u),t=n.annotations),v):u},v.notePadding=function(e){return arguments.length?(f=e,n&&(n.updateNotePadding(f),t=n.annotations),v):f},v.type=function(e,r){return arguments.length?(l=e,n&&(n.annotations.map((function(t){t.type.note&&t.type.note.selectAll("*:not(.annotation-note-content)").remove(),t.type.noteContent&&t.type.noteContent.selectAll("*").remove(),t.type.subject&&t.type.subject.selectAll("*").remove(),t.type.connector&&t.type.connector.selectAll("*").remove(),t.type.typeSettings={},t.type=l,t.subject=r&&r.subject||t.subject,t.connector=r&&r.connector||t.connector,t.note=r&&r.note||t.note})),t=n.annotations),v):l},v.annotations=function(e){if(!arguments.length)return n&&n.annotations||t;if(t=e,n&&n.annotations){var r=t.some((function(t){return!t.type||"[object Object]"!==t.type.toString()}));r?(n=null,v(y)):n.annotations=t}return v},v.context=function(t){return arguments.length?(r=t,v):r},v.accessors=function(t){return arguments.length?(o=t,v):o},v.accessorsInverse=function(t){return arguments.length?(s=t,v):s},v.ids=function(t){return arguments.length?(h=t,v):h},v.editMode=function(e){return arguments.length?(c=e,y&&y.selectAll("g.annotation").classed("editable",c),n&&(n.editMode(c),t=n.annotations),v):c},v.collection=function(t){return arguments.length?(n=t,v):n},v.on=function(){var t=g.on.apply(g,arguments);return t===g?v:t},v}var $={annotation:U,annotationTypeBase:R,annotationLabel:A,annotationCallout:B,annotationCalloutCurve:D,annotationCalloutElbow:H,annotationCalloutCircle:G,annotationCalloutRect:q,annotationXYThreshold:W,annotationBadge:z,annotationCustomType:L};t.annotation=U,t.annotationTypeBase=R,t.annotationLabel=A,t.annotationCallout=B,t.annotationCalloutCurve=D,t.annotationCalloutElbow=H,t.annotationCalloutCircle=G,t.annotationCalloutRect=q,t.annotationXYThreshold=W,t.annotationBadge=z,t.annotationCustomType=L,t.default=$,Object.defineProperty(t,"__esModule",{value:!0})})),
/*! @license https://github.com/onury/invert-color */
function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.invert=e()}(this,(function(){"use strict";var t=Math.sqrt(1.05*.05)-.05,e=/^(?:[0-9a-f]{3}){1,2}$/i,n={black:"#000000",white:"#ffffff",threshold:t};function r(t){if("#"===t.slice(0,1)&&(t=t.slice(1)),!e.test(t))throw new Error('Invalid HEX color: "'+t+'"');return 3===t.length&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]),[parseInt(t.slice(0,2),16),parseInt(t.slice(2,4),16),parseInt(t.slice(4,6),16)]}function a(t){if(!t)throw new Error("Invalid color value");return Array.isArray(t)?t:"string"==typeof t?r(t):[t.r,t.g,t.b]}function i(t,e,a){var i=!0===e?n:Object.assign({},n,e);return function(t){var e,n,r=[];for(e=0;e<t.length;e++)n=t[e]/255,r[e]=n<=.03928?n/12.92:Math.pow((n+.055)/1.055,2.4);return.2126*r[0]+.7152*r[1]+.0722*r[2]}(t)>i.threshold?a?r(i.black):i.black:a?r(i.white):i.white}function o(t,e){return void 0===e&&(e=!1),t=a(t),e?i(t,e):"#"+t.map((function(t){return e=(255-t).toString(16),void 0===n&&(n=2),(new Array(n).join("0")+e).slice(-n);var e,n})).join("")}return function(e){function n(t,e){t=a(t);var n,r=e?i(t,e,!0):t.map((function(t){return 255-t}));return{r:(n=r)[0],g:n[1],b:n[2]}}e.asRGB=n,e.asRgbArray=function(t,e){return t=a(t),e?i(t,e,!0):t.map((function(t){return 255-t}))},e.defaultThreshold=t,e.asRgbObject=n}(o||(o={})),o})),window.jQuery&&function(t){var e,n="9a91ab9b8e64d2cf7fce0616b66efbaf",r="inline-block"+n,a="inline"+n,i="scale"+n,o="over"+n,s={over:o,under:"under9a91ab9b8e64d2cf7fce0616b66efbaf"},c=0,h={dot:["\u2022","\u25e6"],circle:["\u25cf","\u25cb"],"double-circle":["\u25c9","\u25ce"],triangle:["\u25b2","\u25b3"],sesame:["\ufe45","\ufe46"]},l={" ":1,"\xa0":1,"\u1361":1,"\u10100":1,"\u10101":1,"\u1039F":1,"\u1091F":1,"\u0f0b":1,"\u0f0c":1,"\u200b":1,"\u3000":1,"\u2000":1,"\u200a":1,"\0":1,"\t":1,"\n":1,"\r":1,"\x85":1},u={style:1,script:1,textarea:1,input:1},p=/['"]([^'"]+)['"]/,d=/(dot|circle|double-circle|triangle|sesame)/,f=/(under|over|left|right)/,g={char:{},color:{},mark:{}};window.xsjPatchEmphasis="";var y={addCSSRule:function(n,r){if(!e){var a=document.createElement("style");a.type="text/css",xsjPatchEmphasis="",t("head").eq(0).prepend(a),e=document.styleSheets[0]}xsjPatchEmphasis+=n+"{"+r+"}\n",e.insertRule?e.insertRule(n+"{"+r+"}",e.cssRules.length):e.addRule(n,r,-1)},addBeforeCSSRule:function(t,e,r){var a=g[t];if(a[e])return a[e];var i=t+c+++n;return this.addCSSRule("."+i+":before",r),a[e]=i,i},testStyle:function(t,e){for(var n=["webkit","moz","o","ms"],r=0,a=n.length;r<a;r++)if(""===t.style[n[r]+e])return n[r]+e;var i=e.charAt(0).toLowerCase()+e.slice(1);return void 0!==t.style[i]&&i},jsNameToCssName:function(t){return t.replace(/[A-Z]/g,(function(t){return"-"+t.toLowerCase()})).replace(/^(webkit|moz|o|ms)\-/,"-$1-")},supportScale:function t(){if(void 0!==t.result)return t.result;var e,n=document.createElement("div"),r=this.testStyle(n,"Transform"),a=this.testStyle(n,"TransformOrigin");return r&&a?(r=this.jsNameToCssName(r),a=this.jsNameToCssName(a),e=["-webkit-transform","-webkit-transform-origin"]):e=null,t.result=e,e},supportEmphasis:function(){return!1},supportWritingMode:function t(){if(void 0!==t.result)return t.result;var e,n=document.createElement("div"),r=this.testStyle(n,"WritingMode");return e=r?r=this.jsNameToCssName(r):null,t.result=e,e},initCSSRule:function t(){if(!t.inited){t.inited=!0,this.addCSSRule("."+r,"position:relative;display:inline-block;_zoom:1;float:none;border:none;margin:0;padding:0 0 0.5em 0;vertical-align: baseline;color:inherit;font-size:inherit;font-family:inherit;letter-spacing: normal;text-decoration:inherit;line-height:inherit;"),this.addCSSRule("."+r+"."+o,"padding:0.5em 0 0 0;"),this.addCSSRule("."+a,"position:relative;float:none;border:none;margin:0;padding:0;vertical-align: baseline;color:inherit;font-size:inherit;font-family:inherit;letter-spacing: normal;text-decoration:inherit;line-height:inherit;");var e="position:absolute;bottom: 0.35em;left: 0;height: 1em;line-height: 1em;text-align: center;width: 100%;float:none;border:none;margin:0;padding:0;vertical-align: baseline;color:inherit;font-size: inherit;font-family:inherit;text-decoration: none;";this.addCSSRule("."+a+":before",e+"bottom: -1em;"),this.addCSSRule("."+r+":before",e),this.addCSSRule("."+a+"."+i+":before","bottom: -0.5em;width: 200%;"),this.addCSSRule("."+a+"."+o+":before","top: -0.5em;bottom: auto;"),this.addCSSRule("."+r+"."+i+":before","width: 200%;"),this.addCSSRule("."+r+"."+o+":before","top: 0.25em;bottom: auto;")}},getLineHeight:function(t,e){var n=t.css("line-height");return"normal"===n?this.getNormalLineHeight(e):n.match(/px/)?parseInt(n,10):e*n},getNormalLineHeight:function e(n){if(void 0!==e.result)return e.result;var r=t('<div style="padding:0;display:block;border:0;position:absolute;line-height:normal;overflow:hidden;width:100px;">Some words.</div>');r.css("font-size",n+"px"),r.appendTo("body");var a=r.height();return r.remove(),e.result=a,a}},v=function(t,e){this.parse(t,e)};function m(t,e,n){this.markInfo=t,this.$el=e,this.styleNames=n,this.setEmphasis()}v.prototype.set=function(t,e){return void 0===this[t]&&(this[t]=e,!0)},v.prototype.parse=function(e,n){var r;if(n){if(!(r=n.match(f)))return void(this.error=!0);this.position=r[1]}if(e){for(var a,i,o=0,s=(e=e.split(" ")).length;o<s;o++){if(r=(a=e[o]).match(p)){var c=r[1];if(c.length>1&&(c=c.charAt(0)),i=this.set("mark",c),this.isStringMark=!0,i)return}else{if(-1!==a.indexOf("none"))return void(this.isNone=!0);i=-1!==a.indexOf("filled")?this.set("filled",!0):-1!==a.indexOf("open")?this.set("filled",!1):(r=a.match(d))?this.set("mark",r[1]):this.set("color",t.trim(a))}if(!i)return void(this.error=!0)}void 0===this.mark&&void 0===this.filled&&(this.error=!0)}else this.error=!0},v.prototype.autoComplete=function(){if(!this.isNone){var t=navigator.language||navigator.browserLanguage||"",e="ja"===(t=t.slice(0,2));null==this.position&&(this.position=e?"over":"under");var n=void 0!==this.filled,r=void 0!==this.mark;n&&r||r&&this.isStringMark||(r?this.filled=!0:n&&(this.mark="circle"))}},m.prototype.removeEmphasis=function(){this.styleNames?this.$el.css(this.styleNames[0],"none"):this.removeEmphasizedTag(this.$el)},m.prototype.setEmphasis=function(){this.markInfo.isNone?this.removeEmphasis():(this.markInfo.autoComplete(),this.styleNames?this.setEmphasisByCSS():this.setEmphasisByFallback())},m.prototype.setEmphasisByCSS=function(){var t={};this.markInfo.isStringMark?t[this.styleNames[0]]='"'+this.markInfo.mark+'"':t[this.styleNames[0]]=(this.markInfo.filled?"filled":"open")+" "+this.markInfo.mark+" "+(this.markInfo.color||""),t[this.styleNames[1]]=this.markInfo.position,this.$el.css(t)},m.prototype.setEmphasisByFallback=function(){y.initCSSRule(),this.markInfo.character=h[this.markInfo.mark]?h[this.markInfo.mark][this.markInfo.filled?0:1]:this.markInfo.mark.charAt(0),this.fakeEmphasis(this.$el,this.markInfo)},m.prototype.removeEmphasizedTag=function(e,n){if(this.isEmphasizedTag(e[0]))e.replaceWith(e.text());else for(var r,a=e.children(),i=0,o=a.length;i<o;i++)r=t(a[i]),this.isEmphasizedTag(r[0])?r.replaceWith(r.text()):n||this.removeEmphasizedTag(r)},m.prototype.hasEmphasizedTag=function(t){for(var e,n=t.children(),r=0,a=n.length;r<a;r++)if(e=n[r],this.isEmphasizedTag(e))return!0;return!1},m.prototype.isEmphasizedTag=function(t){var e=t.className;return-1!==e.indexOf(r)||-1!==e.indexOf(a)},m.prototype.fakeEmphasis=function(e,n,r){1===(r=r||1)&&this.removeEmphasizedTag(e,!0);for(var a,i=e.contents(),o=0,s=i.length;o<s;o++)if(3===(a=i[o]).nodeType)this.textToHtml(t(a),e,n);else if(1===a.nodeType){var c=this.isEmphasizedTag(a),h=a.nodeName.toLowerCase();u[h]||c||this.fakeEmphasis(t(a),n,r+1)}},m.prototype.textToHtml=function(t,e,n){var o=parseInt(e.css("font-size"),10),c=o/2,h=!1;(y.getLineHeight(e,o)-o)/2<c&&(h=!0);var u,p=y.supportScale();u=p?p[0]+":scale(0.5);"+p[1]+("over"===n.position?":top left;":":bottom left;"):"font-size:"+c+"px;height:"+c+"px;line-height:"+c+"px;";var d=y.addBeforeCSSRule("mark",p?n.position:c,u),f="";n.color&&(f=y.addBeforeCSSRule("color",n.color,"color:"+n.color+" !important;"));var g=h?r:a,v=y.addBeforeCSSRule("char",n.character,"content:'"+n.character+"';"),m=s[n.position],x=e.css("letter-spacing"),b="";"normal"!==x&&0!==x&&(b="margin-right:"+x+";");for(var w,M='<span class="'+g+" "+v+" "+d+" "+f+" "+(p?i:"")+" "+m+'" style="'+b+'">',k=t.text(),_=[],S=0,j=k.length;S<j;S++)w=k.charAt(S),l[w]?_.push(w):(_.push(M),_.push(w),_.push("</span>"));t.replaceWith(_.join(""))},t.fn.emphasis=function(e,n){var r=new v(e,n);if(!r.error)return this.each((function(e,n){var a=t(n),i=y.supportEmphasis();new m(r,a,i)})),this}}(jQuery);var rough=function(){"use strict";var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};function e(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}var n="undefined"!=typeof self,r=function(){function t(t,e){this.defaultOptions={maxRandomnessOffset:2,roughness:1,bowing:1,stroke:"#000",strokeWidth:1,curveTightness:0,curveStepCount:9,fillStyle:"hachure",fillWeight:-1,hachureAngle:-41,hachureGap:-1,dashOffset:-1,dashGap:-1,zigzagOffset:-1},this.config=t||{},this.surface=e,this.config.options&&(this.defaultOptions=this._options(this.config.options))}return t.prototype._options=function(t){return t?Object.assign({},this.defaultOptions,t):this.defaultOptions},t.prototype._drawable=function(t,e,n){return{shape:t,sets:e||[],options:n||this.defaultOptions}},t.prototype.getCanvasSize=function(){var t=function(t){return t&&"object"==typeof t&&t.baseVal&&t.baseVal.value?t.baseVal.value:t||100};return this.surface?[t(this.surface.width),t(this.surface.height)]:[100,100]},t.prototype.computePolygonSize=function(t){if(t.length){for(var e=t[0][0],n=t[0][0],r=t[0][1],a=t[0][1],i=1;i<t.length;i++)e=Math.min(e,t[i][0]),n=Math.max(n,t[i][0]),r=Math.min(r,t[i][1]),a=Math.max(a,t[i][1]);return[n-e,a-r]}return[0,0]},t.prototype.polygonPath=function(t){var e="";if(t.length){e="M"+t[0][0]+","+t[0][1];for(var n=1;n<t.length;n++)e=e+" L"+t[n][0]+","+t[n][1]}return e},t.prototype.computePathSize=function(t){var e=[0,0];if(n&&self.document)try{var r="http://www.w3.org/2000/svg",a=self.document.createElementNS(r,"svg");a.setAttribute("width","0"),a.setAttribute("height","0");var i=self.document.createElementNS(r,"path");i.setAttribute("d",t),a.appendChild(i),self.document.body.appendChild(a);var o=i.getBBox();o&&(e[0]=o.width||0,e[1]=o.height||0),self.document.body.removeChild(a)}catch(t){}var s=this.getCanvasSize();return e[0]*e[1]||(e=s),e},t.prototype.toPaths=function(t){for(var e=t.sets||[],n=t.options||this.defaultOptions,r=[],a=0,i=e;a<i.length;a++){var o=i[a],s=null;switch(o.type){case"path":s={d:this.opsToPath(o),stroke:n.stroke,strokeWidth:n.strokeWidth,fill:"none"};break;case"fillPath":s={d:this.opsToPath(o),stroke:"none",strokeWidth:0,fill:n.fill||"none"};break;case"fillSketch":s=this.fillSketch(o,n);break;case"path2Dfill":s={d:o.path||"",stroke:"none",strokeWidth:0,fill:n.fill||"none"};break;case"path2Dpattern":var c=o.size,h={x:0,y:0,width:1,height:1,viewBox:"0 0 "+Math.round(c[0])+" "+Math.round(c[1]),patternUnits:"objectBoundingBox",path:this.fillSketch(o,n)};s={d:o.path,stroke:"none",strokeWidth:0,pattern:h}}s&&r.push(s)}return r},t.prototype.fillSketch=function(t,e){var n=e.fillWeight;return n<0&&(n=e.strokeWidth/2),{d:this.opsToPath(t),stroke:e.fill||"none",strokeWidth:n,fill:"none"}},t.prototype.opsToPath=function(t){for(var e="",n=0,r=t.ops;n<r.length;n++){var a=r[n],i=a.data;switch(a.op){case"move":e+="M"+i[0]+" "+i[1]+" ";break;case"bcurveTo":e+="C"+i[0]+" "+i[1]+", "+i[2]+" "+i[3]+", "+i[4]+" "+i[5]+" ";break;case"qcurveTo":e+="Q"+i[0]+" "+i[1]+", "+i[2]+" "+i[3]+" ";break;case"lineTo":e+="L"+i[0]+" "+i[1]+" "}}return e.trim()},t}();function a(t,e){return t.type===e}var i={A:7,a:7,C:6,c:6,H:1,h:1,L:2,l:2,M:2,m:2,Q:4,q:4,S:4,s:4,T:4,t:2,V:1,v:1,Z:0,z:0},o=function(){function t(t){this.COMMAND=0,this.NUMBER=1,this.EOD=2,this.segments=[],this.parseData(t),this.processPoints()}return t.prototype.tokenize=function(t){for(var e=new Array;""!==t;)if(t.match(/^([ \t\r\n,]+)/))t=t.substr(RegExp.$1.length);else if(t.match(/^([aAcChHlLmMqQsStTvVzZ])/))e[e.length]={type:this.COMMAND,text:RegExp.$1},t=t.substr(RegExp.$1.length);else{if(!t.match(/^(([-+]?[0-9]+(\.[0-9]*)?|[-+]?\.[0-9]+)([eE][-+]?[0-9]+)?)/))return console.error("Unrecognized segment command: "+t),[];e[e.length]={type:this.NUMBER,text:""+parseFloat(RegExp.$1)},t=t.substr(RegExp.$1.length)}return e[e.length]={type:this.EOD,text:""},e},t.prototype.parseData=function(t){var e=this.tokenize(t),n=0,r=e[n],o="BOD";for(this.segments=new Array;!a(r,this.EOD);){var s=void 0,c=new Array;if("BOD"===o){if("M"!==r.text&&"m"!==r.text)return void this.parseData("M0,0"+t);n++,s=i[r.text],o=r.text}else a(r,this.NUMBER)?s=i[o]:(n++,s=i[r.text],o=r.text);if(n+s<e.length){for(var h=n;h<n+s;h++){var l=e[h];if(!a(l,this.NUMBER))return void console.error("Parameter type is not a number: "+o+","+l.text);c[c.length]=+l.text}if("number"!=typeof i[o])return void console.error("Unsupported segment type: "+o);var u={key:o,data:c};this.segments.push(u),r=e[n+=s],"M"===o&&(o="L"),"m"===o&&(o="l")}else console.error("Path data ended before all parameters were found")}},Object.defineProperty(t.prototype,"closed",{get:function(){if(void 0===this._closed){this._closed=!1;for(var t=0,e=this.segments;t<e.length;t++)"z"===e[t].key.toLowerCase()&&(this._closed=!0)}return this._closed},enumerable:!0,configurable:!0}),t.prototype.processPoints=function(){for(var t=null,e=[0,0],n=0;n<this.segments.length;n++){var r=this.segments[n];switch(r.key){case"M":case"L":case"T":r.point=[r.data[0],r.data[1]];break;case"m":case"l":case"t":r.point=[r.data[0]+e[0],r.data[1]+e[1]];break;case"H":r.point=[r.data[0],e[1]];break;case"h":r.point=[r.data[0]+e[0],e[1]];break;case"V":r.point=[e[0],r.data[0]];break;case"v":r.point=[e[0],r.data[0]+e[1]];break;case"z":case"Z":t&&(r.point=[t[0],t[1]]);break;case"C":r.point=[r.data[4],r.data[5]];break;case"c":r.point=[r.data[4]+e[0],r.data[5]+e[1]];break;case"S":r.point=[r.data[2],r.data[3]];break;case"s":r.point=[r.data[2]+e[0],r.data[3]+e[1]];break;case"Q":r.point=[r.data[2],r.data[3]];break;case"q":r.point=[r.data[2]+e[0],r.data[3]+e[1]];break;case"A":r.point=[r.data[5],r.data[6]];break;case"a":r.point=[r.data[5]+e[0],r.data[6]+e[1]]}"m"!==r.key&&"M"!==r.key||(t=null),r.point&&(e=r.point,t||(t=r.point)),"z"!==r.key&&"Z"!==r.key||(t=null)}},t}(),s=function(){function t(t){this._position=[0,0],this._first=null,this.bezierReflectionPoint=null,this.quadReflectionPoint=null,this.parsed=new o(t)}return Object.defineProperty(t.prototype,"segments",{get:function(){return this.parsed.segments},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"closed",{get:function(){return this.parsed.closed},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"linearPoints",{get:function(){if(!this._linearPoints){for(var t=[],e=[],n=0,r=this.parsed.segments;n<r.length;n++){var a=r[n],i=a.key.toLowerCase();("m"!==i&&"z"!==i||(e.length&&(t.push(e),e=[]),"z"!==i))&&a.point&&e.push(a.point)}e.length&&(t.push(e),e=[]),this._linearPoints=t}return this._linearPoints},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"first",{get:function(){return this._first},set:function(t){this._first=t},enumerable:!0,configurable:!0}),t.prototype.setPosition=function(t,e){this._position=[t,e],this._first||(this._first=[t,e])},Object.defineProperty(t.prototype,"position",{get:function(){return this._position},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"x",{get:function(){return this._position[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._position[1]},enumerable:!0,configurable:!0}),t}(),c=function(){function t(t,e,n,r,a,i){if(this._segIndex=0,this._numSegs=0,this._rx=0,this._ry=0,this._sinPhi=0,this._cosPhi=0,this._C=[0,0],this._theta=0,this._delta=0,this._T=0,this._from=t,t[0]!==e[0]||t[1]!==e[1]){var o=Math.PI/180;this._rx=Math.abs(n[0]),this._ry=Math.abs(n[1]),this._sinPhi=Math.sin(r*o),this._cosPhi=Math.cos(r*o);var s=this._cosPhi*(t[0]-e[0])/2+this._sinPhi*(t[1]-e[1])/2,c=-this._sinPhi*(t[0]-e[0])/2+this._cosPhi*(t[1]-e[1])/2,h=0,l=this._rx*this._rx*this._ry*this._ry-this._rx*this._rx*c*c-this._ry*this._ry*s*s;if(l<0){var u=Math.sqrt(1-l/(this._rx*this._rx*this._ry*this._ry));this._rx=this._rx*u,this._ry=this._ry*u,h=0}else h=(a===i?-1:1)*Math.sqrt(l/(this._rx*this._rx*c*c+this._ry*this._ry*s*s));var p=h*this._rx*c/this._ry,d=-h*this._ry*s/this._rx;this._C=[0,0],this._C[0]=this._cosPhi*p-this._sinPhi*d+(t[0]+e[0])/2,this._C[1]=this._sinPhi*p+this._cosPhi*d+(t[1]+e[1])/2,this._theta=this.calculateVectorAngle(1,0,(s-p)/this._rx,(c-d)/this._ry);var f=this.calculateVectorAngle((s-p)/this._rx,(c-d)/this._ry,(-s-p)/this._rx,(-c-d)/this._ry);!i&&f>0?f-=2*Math.PI:i&&f<0&&(f+=2*Math.PI),this._numSegs=Math.ceil(Math.abs(f/(Math.PI/2))),this._delta=f/this._numSegs,this._T=8/3*Math.sin(this._delta/4)*Math.sin(this._delta/4)/Math.sin(this._delta/2)}}return t.prototype.getNextSegment=function(){if(this._segIndex===this._numSegs)return null;var t=Math.cos(this._theta),e=Math.sin(this._theta),n=this._theta+this._delta,r=Math.cos(n),a=Math.sin(n),i=[this._cosPhi*this._rx*r-this._sinPhi*this._ry*a+this._C[0],this._sinPhi*this._rx*r+this._cosPhi*this._ry*a+this._C[1]],o=[this._from[0]+this._T*(-this._cosPhi*this._rx*e-this._sinPhi*this._ry*t),this._from[1]+this._T*(-this._sinPhi*this._rx*e+this._cosPhi*this._ry*t)],s=[i[0]+this._T*(this._cosPhi*this._rx*a+this._sinPhi*this._ry*r),i[1]+this._T*(this._sinPhi*this._rx*a-this._cosPhi*this._ry*r)];return this._theta=n,this._from=[i[0],i[1]],this._segIndex++,{cp1:o,cp2:s,to:i}},t.prototype.calculateVectorAngle=function(t,e,n,r){var a=Math.atan2(e,t),i=Math.atan2(r,n);return i>=a?i-a:2*Math.PI-(a-i)},t}(),h=function(){function t(t,e){this.sets=t,this.closed=e}return t.prototype.fit=function(t){for(var e=[],n=0,r=this.sets;n<r.length;n++){var a=(h=r[n]).length,i=Math.floor(t*a);if(i<5){if(a<=5)continue;i=5}e.push(this.reduce(h,i))}for(var o="",s=0,c=e;s<c.length;s++){for(var h=c[s],l=0;l<h.length;l++){var u=h[l];o+=0===l?"M"+u[0]+","+u[1]:"L"+u[0]+","+u[1]}this.closed&&(o+="z ")}return o},t.prototype.distance=function(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2))},t.prototype.reduce=function(t,e){if(t.length<=e)return t;for(var n=t.slice(0);n.length>e;){for(var r=[],a=-1,i=-1,o=1;o<n.length-1;o++){var s=this.distance(n[o-1],n[o]),c=this.distance(n[o],n[o+1]),h=this.distance(n[o-1],n[o+1]),l=(s+c+h)/2,u=Math.sqrt(l*(l-s)*(l-c)*(l-h));r.push(u),(a<0||u<a)&&(a=u,i=o)}if(!(i>0))break;n.splice(i,1)}return n},t}(),l=function(){function t(t,e){this.xi=Number.MAX_VALUE,this.yi=Number.MAX_VALUE,this.px1=t[0],this.py1=t[1],this.px2=e[0],this.py2=e[1],this.a=this.py2-this.py1,this.b=this.px1-this.px2,this.c=this.px2*this.py1-this.px1*this.py2,this._undefined=0===this.a&&0===this.b&&0===this.c}return t.prototype.isUndefined=function(){return this._undefined},t.prototype.intersects=function(t){if(this.isUndefined()||t.isUndefined())return!1;var e=Number.MAX_VALUE,n=Number.MAX_VALUE,r=0,a=0,i=this.a,o=this.b,s=this.c;return Math.abs(o)>1e-5&&(e=-i/o,r=-s/o),Math.abs(t.b)>1e-5&&(n=-t.a/t.b,a=-t.c/t.b),e===Number.MAX_VALUE?n===Number.MAX_VALUE?-s/i==-t.c/t.a&&(this.py1>=Math.min(t.py1,t.py2)&&this.py1<=Math.max(t.py1,t.py2)?(this.xi=this.px1,this.yi=this.py1,!0):this.py2>=Math.min(t.py1,t.py2)&&this.py2<=Math.max(t.py1,t.py2)&&(this.xi=this.px2,this.yi=this.py2,!0)):(this.xi=this.px1,this.yi=n*this.xi+a,!((this.py1-this.yi)*(this.yi-this.py2)<-1e-5||(t.py1-this.yi)*(this.yi-t.py2)<-1e-5||Math.abs(t.a)<1e-5&&(t.px1-this.xi)*(this.xi-t.px2)<-1e-5)):n===Number.MAX_VALUE?(this.xi=t.px1,this.yi=e*this.xi+r,!((t.py1-this.yi)*(this.yi-t.py2)<-1e-5||(this.py1-this.yi)*(this.yi-this.py2)<-1e-5||Math.abs(i)<1e-5&&(this.px1-this.xi)*(this.xi-this.px2)<-1e-5)):e===n?r===a&&(this.px1>=Math.min(t.px1,t.px2)&&this.px1<=Math.max(t.py1,t.py2)?(this.xi=this.px1,this.yi=this.py1,!0):this.px2>=Math.min(t.px1,t.px2)&&this.px2<=Math.max(t.px1,t.px2)&&(this.xi=this.px2,this.yi=this.py2,!0)):(this.xi=(a-r)/(e-n),this.yi=e*this.xi+r,!((this.px1-this.xi)*(this.xi-this.px2)<-1e-5||(t.px1-this.xi)*(this.xi-t.px2)<-1e-5))},t}(),u=function(){function t(t,e,n,r,a,i,o,s){this.deltaX=0,this.hGap=0,this.top=t,this.bottom=e,this.left=n,this.right=r,this.gap=a,this.sinAngle=i,this.tanAngle=s,Math.abs(i)<1e-4?this.pos=n+a:Math.abs(i)>.9999?this.pos=t+a:(this.deltaX=(e-t)*Math.abs(s),this.pos=n-Math.abs(this.deltaX),this.hGap=Math.abs(a/o),this.sLeft=new l([n,e],[n,t]),this.sRight=new l([r,e],[r,t]))}return t.prototype.nextLine=function(){if(Math.abs(this.sinAngle)<1e-4){if(this.pos<this.right){var t=[this.pos,this.top,this.pos,this.bottom];return this.pos+=this.gap,t}}else if(Math.abs(this.sinAngle)>.9999){if(this.pos<this.bottom)return t=[this.left,this.pos,this.right,this.pos],this.pos+=this.gap,t}else{var e=this.pos-this.deltaX/2,n=this.pos+this.deltaX/2,r=this.bottom,a=this.top;if(this.pos<this.right+this.deltaX){for(;e<this.left&&n<this.left||e>this.right&&n>this.right;)if(this.pos+=this.hGap,e=this.pos-this.deltaX/2,n=this.pos+this.deltaX/2,this.pos>this.right+this.deltaX)return null;var i=new l([e,r],[n,a]);return this.sLeft&&i.intersects(this.sLeft)&&(e=i.xi,r=i.yi),this.sRight&&i.intersects(this.sRight)&&(n=i.xi,a=i.yi),this.tanAngle>0&&(e=this.right-(e-this.left),n=this.right-(n-this.left)),t=[e,r,n,a],this.pos+=this.hGap,t}}return null},t}();function p(t){var e=t[0],n=t[1];return Math.sqrt(Math.pow(e[0]-n[0],2)+Math.pow(e[1]-n[1],2))}function d(t,e){for(var n=[],r=new l([t[0],t[1]],[t[2],t[3]]),a=0;a<e.length;a++){var i=new l(e[a],e[(a+1)%e.length]);r.intersects(i)&&n.push([r.xi,r.yi])}return n}function f(t,e,n,r,a,i,o){return[-n*i-r*a+n+i*t+a*e,o*(n*a-r*i)+r+-o*a*t+o*i*e]}function g(t,e){var n=[];if(t&&t.length){for(var r=t[0][0],a=t[0][0],i=t[0][1],o=t[0][1],s=1;s<t.length;s++)r=Math.min(r,t[s][0]),a=Math.max(a,t[s][0]),i=Math.min(i,t[s][1]),o=Math.max(o,t[s][1]);var c=e.hachureAngle,h=e.hachureGap;h<0&&(h=4*e.strokeWidth),h=Math.max(h,.1);for(var l=c%180*(Math.PI/180),p=Math.cos(l),f=Math.sin(l),g=Math.tan(l),y=new u(i-1,o+1,r-1,a+1,h,f,p,g),v=void 0;null!=(v=y.nextLine());){var m=d(v,t);for(s=0;s<m.length;s++)if(s<m.length-1){var x=m[s],b=m[s+1];n.push([x,b])}}}return n}function y(t,e,n,r,a,i){var o=[],s=Math.abs(r/2),c=Math.abs(a/2);s+=t.randOffset(.05*s,i),c+=t.randOffset(.05*c,i);var h=i.hachureAngle,l=i.hachureGap;l<=0&&(l=4*i.strokeWidth);var u=i.fillWeight;u<0&&(u=i.strokeWidth/2);for(var p=h%180*(Math.PI/180),d=Math.tan(p),g=c/s,y=Math.sqrt(g*d*g*d+1),v=g*d/y,m=1/y,x=l/(s*c/Math.sqrt(c*m*(c*m)+s*v*(s*v))/s),b=Math.sqrt(s*s-(e-s+x)*(e-s+x)),w=e-s+x;w<e+s;w+=x){var M=f(w,n-(b=Math.sqrt(s*s-(e-w)*(e-w))),e,n,v,m,g),k=f(w,n+b,e,n,v,m,g);o.push([M,k])}return o}var v=function(){function t(t){this.helper=t}return t.prototype.fillPolygon=function(t,e){return this._fillPolygon(t,e)},t.prototype.fillEllipse=function(t,e,n,r,a){return this._fillEllipse(t,e,n,r,a)},t.prototype.fillArc=function(t,e,n,r,a,i,o){return null},t.prototype._fillPolygon=function(t,e,n){void 0===n&&(n=!1);var r=g(t,e);return{type:"fillSketch",ops:this.renderLines(r,e,n)}},t.prototype._fillEllipse=function(t,e,n,r,a,i){void 0===i&&(i=!1);var o=y(this.helper,t,e,n,r,a);return{type:"fillSketch",ops:this.renderLines(o,a,i)}},t.prototype.renderLines=function(t,e,n){for(var r=[],a=null,i=0,o=t;i<o.length;i++){var s=o[i];r=r.concat(this.helper.doubleLineOps(s[0][0],s[0][1],s[1][0],s[1][1],e)),n&&a&&(r=r.concat(this.helper.doubleLineOps(a[0],a[1],s[0][0],s[0][1],e))),a=s[1]}return r},t}(),m=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.prototype.fillPolygon=function(t,e){return this._fillPolygon(t,e,!0)},n.prototype.fillEllipse=function(t,e,n,r,a){return this._fillEllipse(t,e,n,r,a,!0)},n}(v),x=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.prototype.fillPolygon=function(t,e){var n=this._fillPolygon(t,e),r=Object.assign({},e,{hachureAngle:e.hachureAngle+90}),a=this._fillPolygon(t,r);return n.ops=n.ops.concat(a.ops),n},n.prototype.fillEllipse=function(t,e,n,r,a){var i=this._fillEllipse(t,e,n,r,a),o=Object.assign({},a,{hachureAngle:a.hachureAngle+90}),s=this._fillEllipse(t,e,n,r,o);return i.ops=i.ops.concat(s.ops),i},n}(v),b=function(){function t(t){this.helper=t}return t.prototype.fillPolygon=function(t,e){var n=g(t,e=Object.assign({},e,{curveStepCount:4,hachureAngle:0}));return this.dotsOnLines(n,e)},t.prototype.fillEllipse=function(t,e,n,r,a){a=Object.assign({},a,{curveStepCount:4,hachureAngle:0});var i=y(this.helper,t,e,n,r,a);return this.dotsOnLines(i,a)},t.prototype.fillArc=function(t,e,n,r,a,i,o){return null},t.prototype.dotsOnLines=function(t,e){var n=[],r=e.hachureGap;r<0&&(r=4*e.strokeWidth),r=Math.max(r,.1);var a=e.fillWeight;a<0&&(a=e.strokeWidth/2);for(var i=0,o=t;i<o.length;i++)for(var s=o[i],c=p(s)/r,h=Math.ceil(c)-1,l=Math.atan((s[1][1]-s[0][1])/(s[1][0]-s[0][0])),u=0;u<h;u++){var d=r*(u+1),f=d*Math.sin(l),g=d*Math.cos(l),y=[s[0][0]-g,s[0][1]+f],v=this.helper.randOffsetWithRange(y[0]-r/4,y[0]+r/4,e),m=this.helper.randOffsetWithRange(y[1]-r/4,y[1]+r/4,e),x=this.helper.ellipse(v,m,a,a,e);n=n.concat(x.ops)}return{type:"fillSketch",ops:n}},t}(),w=function(){function t(t){this.helper=t}return t.prototype.fillPolygon=function(t,e){var n=[Number.MAX_SAFE_INTEGER,Number.MIN_SAFE_INTEGER],r=[Number.MAX_SAFE_INTEGER,Number.MIN_SAFE_INTEGER];t.forEach((function(t){n[0]=Math.min(n[0],t[0]),n[1]=Math.max(n[1],t[0]),r[0]=Math.min(r[0],t[1]),r[1]=Math.max(r[1],t[1])}));var a=function(t){for(var e=0,n=0,r=0,a=0;a<t.length;a++){var i=t[a],o=a===t.length-1?t[0]:t[a+1];e+=i[0]*o[1]-o[0]*i[1]}for(e/=2,a=0;a<t.length;a++)i=t[a],o=a===t.length-1?t[0]:t[a+1],n+=(i[0]+o[0])*(i[0]*o[1]-o[0]*i[1]),r+=(i[1]+o[1])*(i[0]*o[1]-o[0]*i[1]);return[n/(6*e),r/(6*e)]}(t),i=Math.max(Math.sqrt(Math.pow(a[0]-n[0],2)+Math.pow(a[1]-r[0],2)),Math.sqrt(Math.pow(a[0]-n[1],2)+Math.pow(a[1]-r[1],2))),o=e.hachureGap>0?e.hachureGap:4*e.strokeWidth,s=[];if(t.length>2)for(var c=0;c<t.length;c++)c===t.length-1?s.push([t[c],t[0]]):s.push([t[c],t[c+1]]);var h=[],l=Math.max(1,Math.PI*i/o),u=function(t){var e=t*Math.PI/l,o=[a,[a[0]+i*Math.cos(e),a[1]+i*Math.sin(e)]];s.forEach((function(t){var e,a,i,s,c,l,u,p,d,f=(a=o,i=(e=t)[1][1]-e[0][1],s=e[0][0]-e[1][0],c=i*e[0][0]+s*e[0][1],l=a[1][1]-a[0][1],u=a[0][0]-a[1][0],p=l*a[0][0]+u*a[0][1],(d=i*u-l*s)?[Math.round((u*c-s*p)/d),Math.round((i*p-l*c)/d)]:null);f&&f[0]>=n[0]&&f[0]<=n[1]&&f[1]>=r[0]&&f[1]<=r[1]&&h.push(f)}))};for(c=0;c<l;c++)u(c);h=this.removeDuplocatePoints(h);var p=this.createLinesFromCenter(a,h);return{type:"fillSketch",ops:this.drawLines(p,e)}},t.prototype.fillEllipse=function(t,e,n,r,a){return this.fillArcSegment(t,e,n,r,0,2*Math.PI,a)},t.prototype.fillArc=function(t,e,n,r,a,i,o){return this.fillArcSegment(t,e,n,r,a,i,o)},t.prototype.fillArcSegment=function(t,e,n,r,a,i,o){var s=[t,e],c=n/2,h=r/2,l=Math.max(n/2,r/2),u=o.hachureGap;u<0&&(u=4*o.strokeWidth);for(var p=Math.max(1,Math.abs(i-a)*l/u),d=[],f=0;f<p;f++){var g=f*((i-a)/p)+a,y=l*Math.cos(g),v=l*Math.sin(g),m=Math.sqrt(c*c*v*v+h*h*y*y),x=c*h*y/m,b=c*h*v/m;d.push([s[0]+x,s[1]+b])}d=this.removeDuplocatePoints(d);var w=this.createLinesFromCenter(s,d);return{type:"fillSketch",ops:this.drawLines(w,o)}},t.prototype.drawLines=function(t,e){var n=this,r=[];return t.forEach((function(t){var a=t[0],i=t[1];r=r.concat(n.helper.doubleLineOps(a[0],a[1],i[0],i[1],e))})),r},t.prototype.createLinesFromCenter=function(t,e){return e.map((function(e){return[t,e]}))},t.prototype.removeDuplocatePoints=function(t){var e=new Set;return t.filter((function(t){var n=t.join(",");return!e.has(n)&&(e.add(n),!0)}))},t}(),M=function(){function t(t){this.helper=t}return t.prototype.fillPolygon=function(t,e){var n=g(t,e);return{type:"fillSketch",ops:this.dashedLine(n,e)}},t.prototype.fillEllipse=function(t,e,n,r,a){var i=y(this.helper,t,e,n,r,a);return{type:"fillSketch",ops:this.dashedLine(i,a)}},t.prototype.fillArc=function(t,e,n,r,a,i,o){return null},t.prototype.dashedLine=function(t,e){var n=this,r=e.dashOffset<0?e.hachureGap<0?4*e.strokeWidth:e.hachureGap:e.dashOffset,a=e.dashGap<0?e.hachureGap<0?4*e.strokeWidth:e.hachureGap:e.dashGap,i=[];return t.forEach((function(t){var o=p(t),s=Math.floor(o/(r+a)),c=(o+a-s*(r+a))/2,h=t[0],l=t[1];h[0]>l[0]&&(h=t[1],l=t[0]);for(var u=Math.atan((l[1]-h[1])/(l[0]-h[0])),d=0;d<s;d++){var f=d*(r+a),g=f+r,y=[h[0]+f*Math.cos(u)+c*Math.cos(u),h[1]+f*Math.sin(u)+c*Math.sin(u)],v=[h[0]+g*Math.cos(u)+c*Math.cos(u),h[1]+g*Math.sin(u)+c*Math.sin(u)];i=i.concat(n.helper.doubleLineOps(y[0],y[1],v[0],v[1],e))}})),i},t}(),k=function(){function t(t){this.helper=t}return t.prototype.fillPolygon=function(t,e){var n=e.hachureGap<0?4*e.strokeWidth:e.hachureGap,r=e.zigzagOffset<0?n:e.zigzagOffset,a=g(t,e=Object.assign({},e,{hachureGap:n+r}));return{type:"fillSketch",ops:this.zigzagLines(a,r,e)}},t.prototype.fillEllipse=function(t,e,n,r,a){var i=a.hachureGap<0?4*a.strokeWidth:a.hachureGap,o=a.zigzagOffset<0?i:a.zigzagOffset;a=Object.assign({},a,{hachureGap:i+o});var s=y(this.helper,t,e,n,r,a);return{type:"fillSketch",ops:this.zigzagLines(s,o,a)}},t.prototype.fillArc=function(t,e,n,r,a,i,o){return null},t.prototype.zigzagLines=function(t,e,n){var r=this,a=[];return t.forEach((function(t){var i=p(t),o=Math.round(i/(2*e)),s=t[0],c=t[1];s[0]>c[0]&&(s=t[1],c=t[0]);for(var h=Math.atan((c[1]-s[1])/(c[0]-s[0])),l=0;l<o;l++){var u=2*l*e,d=2*(l+1)*e,f=Math.sqrt(2*Math.pow(e,2)),g=[s[0]+u*Math.cos(h),s[1]+u*Math.sin(h)],y=[s[0]+d*Math.cos(h),s[1]+d*Math.sin(h)],v=[g[0]+f*Math.cos(h+Math.PI/4),g[1]+f*Math.sin(h+Math.PI/4)];a=(a=a.concat(r.helper.doubleLineOps(g[0],g[1],v[0],v[1],n))).concat(r.helper.doubleLineOps(v[0],v[1],y[0],y[1],n))}})),a},t}(),_={};function S(t,e){var n=t.fillStyle||"hachure";if(!_[n])switch(n){case"zigzag":_[n]||(_[n]=new m(e));break;case"cross-hatch":_[n]||(_[n]=new x(e));break;case"dots":_[n]||(_[n]=new b(e));break;case"starburst":_[n]||(_[n]=new w(e));break;case"dashed":_[n]||(_[n]=new M(e));break;case"zigzag-line":_[n]||(_[n]=new k(e));break;case"hachure":default:_[n="hachure"]||(_[n]=new v(e))}return _[n]}var j={randOffset:function(t,e){return I(t,e)},randOffsetWithRange:function(t,e,n){return L(t,e,n)},ellipse:P,doubleLineOps:function(t,e,n,r,a){return A(t,e,n,r,a)}};function T(t,e,n,r,a){return{type:"path",ops:A(t,e,n,r,a)}}function C(t,e,n){var r=(t||[]).length;if(r>2){for(var a=[],i=0;i<r-1;i++)a=a.concat(A(t[i][0],t[i][1],t[i+1][0],t[i+1][1],n));return e&&(a=a.concat(A(t[r-1][0],t[r-1][1],t[0][0],t[0][1],n))),{type:"path",ops:a}}return 2===r?T(t[0][0],t[0][1],t[1][0],t[1][1],n):{type:"path",ops:[]}}function N(t,e){var n=H(t,1*(1+.2*e.roughness),e),r=H(t,1.5*(1+.22*e.roughness),e);return{type:"path",ops:n.concat(r)}}function P(t,e,n,r,a){var i=2*Math.PI/a.curveStepCount,o=Math.abs(n/2),s=Math.abs(r/2),c=z(i,t,e,o+=I(.05*o,a),s+=I(.05*s,a),1,i*L(.1,L(.4,1,a),a),a),h=z(i,t,e,o,s,1.5,0,a);return{type:"path",ops:c.concat(h)}}function O(t,e,n,r,a,i,o,s,c){var h=t,l=e,u=Math.abs(n/2),p=Math.abs(r/2);u+=I(.01*u,c),p+=I(.01*p,c);for(var d=a,f=i;d<0;)d+=2*Math.PI,f+=2*Math.PI;f-d>2*Math.PI&&(d=0,f=2*Math.PI);var g=2*Math.PI/c.curveStepCount,y=Math.min(g/2,(f-d)/2),v=G(y,h,l,u,p,d,f,1,c),m=G(y,h,l,u,p,d,f,1.5,c),x=v.concat(m);return o&&(s?x=(x=x.concat(A(h,l,h+u*Math.cos(d),l+p*Math.sin(d),c))).concat(A(h,l,h+u*Math.cos(f),l+p*Math.sin(f),c)):(x.push({op:"lineTo",data:[h,l]}),x.push({op:"lineTo",data:[h+u*Math.cos(d),l+p*Math.sin(d)]}))),{type:"path",ops:x}}function E(t,e){var n=[];if(t.length){var r=e.maxRandomnessOffset||0,a=t.length;if(a>2){n.push({op:"move",data:[t[0][0]+I(r,e),t[0][1]+I(r,e)]});for(var i=1;i<a;i++)n.push({op:"lineTo",data:[t[i][0]+I(r,e),t[i][1]+I(r,e)]})}}return{type:"fillPath",ops:n}}function R(t,e){return S(e,j).fillPolygon(t,e)}function L(t,e,n){return n.roughness*(Math.random()*(e-t)+t)}function I(t,e){return L(-t,t,e)}function A(t,e,n,r,a){var i=B(t,e,n,r,a,!0,!1),o=B(t,e,n,r,a,!0,!0);return i.concat(o)}function B(t,e,n,r,a,i,o){var s=Math.pow(t-n,2)+Math.pow(e-r,2),c=a.maxRandomnessOffset||0;c*c*100>s&&(c=Math.sqrt(s)/10);var h=c/2,l=.2+.2*Math.random(),u=a.bowing*a.maxRandomnessOffset*(r-e)/200,p=a.bowing*a.maxRandomnessOffset*(t-n)/200;u=I(u,a),p=I(p,a);var d=[],f=function(){return I(h,a)},g=function(){return I(c,a)};return i&&(o?d.push({op:"move",data:[t+f(),e+f()]}):d.push({op:"move",data:[t+I(c,a),e+I(c,a)]})),o?d.push({op:"bcurveTo",data:[u+t+(n-t)*l+f(),p+e+(r-e)*l+f(),u+t+2*(n-t)*l+f(),p+e+2*(r-e)*l+f(),n+f(),r+f()]}):d.push({op:"bcurveTo",data:[u+t+(n-t)*l+g(),p+e+(r-e)*l+g(),u+t+2*(n-t)*l+g(),p+e+2*(r-e)*l+g(),n+g(),r+g()]}),d}function H(t,e,n){var r=[];r.push([t[0][0]+I(e,n),t[0][1]+I(e,n)]),r.push([t[0][0]+I(e,n),t[0][1]+I(e,n)]);for(var a=1;a<t.length;a++)r.push([t[a][0]+I(e,n),t[a][1]+I(e,n)]),a===t.length-1&&r.push([t[a][0]+I(e,n),t[a][1]+I(e,n)]);return D(r,null,n)}function D(t,e,n){var r=t.length,a=[];if(r>3){var i=[],o=1-n.curveTightness;a.push({op:"move",data:[t[1][0],t[1][1]]});for(var s=1;s+2<r;s++){var c=t[s];i[0]=[c[0],c[1]],i[1]=[c[0]+(o*t[s+1][0]-o*t[s-1][0])/6,c[1]+(o*t[s+1][1]-o*t[s-1][1])/6],i[2]=[t[s+1][0]+(o*t[s][0]-o*t[s+2][0])/6,t[s+1][1]+(o*t[s][1]-o*t[s+2][1])/6],i[3]=[t[s+1][0],t[s+1][1]],a.push({op:"bcurveTo",data:[i[1][0],i[1][1],i[2][0],i[2][1],i[3][0],i[3][1]]})}if(e&&2===e.length){var h=n.maxRandomnessOffset;a.push({op:"lineTo",data:[e[0]+I(h,n),e[1]+I(h,n)]})}}else 3===r?(a.push({op:"move",data:[t[1][0],t[1][1]]}),a.push({op:"bcurveTo",data:[t[1][0],t[1][1],t[2][0],t[2][1],t[2][0],t[2][1]]})):2===r&&(a=a.concat(A(t[0][0],t[0][1],t[1][0],t[1][1],n)));return a}function z(t,e,n,r,a,i,o,s){var c=I(.5,s)-Math.PI/2,h=[];h.push([I(i,s)+e+.9*r*Math.cos(c-t),I(i,s)+n+.9*a*Math.sin(c-t)]);for(var l=c;l<2*Math.PI+c-.01;l+=t)h.push([I(i,s)+e+r*Math.cos(l),I(i,s)+n+a*Math.sin(l)]);return h.push([I(i,s)+e+r*Math.cos(c+2*Math.PI+.5*o),I(i,s)+n+a*Math.sin(c+2*Math.PI+.5*o)]),h.push([I(i,s)+e+.98*r*Math.cos(c+o),I(i,s)+n+.98*a*Math.sin(c+o)]),h.push([I(i,s)+e+.9*r*Math.cos(c+.5*o),I(i,s)+n+.9*a*Math.sin(c+.5*o)]),D(h,null,s)}function G(t,e,n,r,a,i,o,s,c){var h=i+I(.1,c),l=[];l.push([I(s,c)+e+.9*r*Math.cos(h-t),I(s,c)+n+.9*a*Math.sin(h-t)]);for(var u=h;u<=o;u+=t)l.push([I(s,c)+e+r*Math.cos(u),I(s,c)+n+a*Math.sin(u)]);return l.push([e+r*Math.cos(o),n+a*Math.sin(o)]),l.push([e+r*Math.cos(o),n+a*Math.sin(o)]),D(l,null,c)}function q(t,e,n,r,a,i,o,s){for(var c=[],h=[s.maxRandomnessOffset||1,(s.maxRandomnessOffset||1)+.5],l=[0,0],u=0;u<2;u++)0===u?c.push({op:"move",data:[o.x,o.y]}):c.push({op:"move",data:[o.x+I(h[0],s),o.y+I(h[0],s)]}),l=[a+I(h[u],s),i+I(h[u],s)],c.push({op:"bcurveTo",data:[t+I(h[u],s),e+I(h[u],s),n+I(h[u],s),r+I(h[u],s),l[0],l[1]]});return o.setPosition(l[0],l[1]),c}function W(t,e,n,r){var a=[];switch(e.key){case"M":case"m":var i="m"===e.key;if(e.data.length>=2){var o=+e.data[0],s=+e.data[1];i&&(o+=t.x,s+=t.y);var h=1*(r.maxRandomnessOffset||0);o+=I(h,r),s+=I(h,r),t.setPosition(o,s),a.push({op:"move",data:[o,s]})}break;case"L":case"l":i="l"===e.key,e.data.length>=2&&(o=+e.data[0],s=+e.data[1],i&&(o+=t.x,s+=t.y),a=a.concat(A(t.x,t.y,o,s,r)),t.setPosition(o,s));break;case"H":case"h":i="h"===e.key,e.data.length&&(o=+e.data[0],i&&(o+=t.x),a=a.concat(A(t.x,t.y,o,t.y,r)),t.setPosition(o,t.y));break;case"V":case"v":i="v"===e.key,e.data.length&&(s=+e.data[0],i&&(s+=t.y),a=a.concat(A(t.x,t.y,t.x,s,r)),t.setPosition(t.x,s));break;case"Z":case"z":t.first&&(a=a.concat(A(t.x,t.y,t.first[0],t.first[1],r)),t.setPosition(t.first[0],t.first[1]),t.first=null);break;case"C":case"c":if(i="c"===e.key,e.data.length>=6){var l=+e.data[0],u=+e.data[1],p=+e.data[2],d=+e.data[3];o=+e.data[4],s=+e.data[5],i&&(l+=t.x,p+=t.x,o+=t.x,u+=t.y,d+=t.y,s+=t.y);var f=q(l,u,p,d,o,s,t,r);a=a.concat(f),t.bezierReflectionPoint=[o+(o-p),s+(s-d)]}break;case"S":case"s":if(i="s"===e.key,e.data.length>=4){p=+e.data[0],d=+e.data[1],o=+e.data[2],s=+e.data[3],i&&(p+=t.x,o+=t.x,d+=t.y,s+=t.y),l=p,u=d;var g=null;"c"!==(x=n?n.key:"")&&"C"!==x&&"s"!==x&&"S"!==x||(g=t.bezierReflectionPoint),g&&(l=g[0],u=g[1]),f=q(l,u,p,d,o,s,t,r),a=a.concat(f),t.bezierReflectionPoint=[o+(o-p),s+(s-d)]}break;case"Q":case"q":if(i="q"===e.key,e.data.length>=4){l=+e.data[0],u=+e.data[1],o=+e.data[2],s=+e.data[3],i&&(l+=t.x,o+=t.x,u+=t.y,s+=t.y);var y=1*(1+.2*r.roughness),v=1.5*(1+.22*r.roughness);a.push({op:"move",data:[t.x+I(y,r),t.y+I(y,r)]});var m=[o+I(y,r),s+I(y,r)];a.push({op:"qcurveTo",data:[l+I(y,r),u+I(y,r),m[0],m[1]]}),a.push({op:"move",data:[t.x+I(v,r),t.y+I(v,r)]}),m=[o+I(v,r),s+I(v,r)],a.push({op:"qcurveTo",data:[l+I(v,r),u+I(v,r),m[0],m[1]]}),t.setPosition(m[0],m[1]),t.quadReflectionPoint=[o+(o-l),s+(s-u)]}break;case"T":case"t":var x;if(i="t"===e.key,e.data.length>=2)o=+e.data[0],s=+e.data[1],i&&(o+=t.x,s+=t.y),l=o,u=s,g=null,"q"!==(x=n?n.key:"")&&"Q"!==x&&"t"!==x&&"T"!==x||(g=t.quadReflectionPoint),g&&(l=g[0],u=g[1]),y=1*(1+.2*r.roughness),v=1.5*(1+.22*r.roughness),a.push({op:"move",data:[t.x+I(y,r),t.y+I(y,r)]}),m=[o+I(y,r),s+I(y,r)],a.push({op:"qcurveTo",data:[l+I(y,r),u+I(y,r),m[0],m[1]]}),a.push({op:"move",data:[t.x+I(v,r),t.y+I(v,r)]}),m=[o+I(v,r),s+I(v,r)],a.push({op:"qcurveTo",data:[l+I(v,r),u+I(v,r),m[0],m[1]]}),t.setPosition(m[0],m[1]),t.quadReflectionPoint=[o+(o-l),s+(s-u)];break;case"A":case"a":if(i="a"===e.key,e.data.length>=7){var b=+e.data[0],w=+e.data[1],M=+e.data[2],k=+e.data[3],_=+e.data[4];if(o=+e.data[5],s=+e.data[6],i&&(o+=t.x,s+=t.y),o===t.x&&s===t.y)break;if(0===b||0===w)a=a.concat(A(t.x,t.y,o,s,r)),t.setPosition(o,s);else for(var S=0;S<1;S++)for(var j=new c([t.x,t.y],[o,s],[b,w],M,!!k,!!_),T=j.getNextSegment();T;)f=q(T.cp1[0],T.cp1[1],T.cp2[0],T.cp2[1],T.to[0],T.to[1],t,r),a=a.concat(f),T=j.getNextSegment()}}return a}var V=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.prototype.line=function(t,e,n,r,a){var i=this._options(a);return this._drawable("line",[T(t,e,n,r,i)],i)},n.prototype.rectangle=function(t,e,n,r,a){var i=this._options(a),o=[];if(i.fill){var s=[[t,e],[t+n,e],[t+n,e+r],[t,e+r]];"solid"===i.fillStyle?o.push(E(s,i)):o.push(R(s,i))}return o.push(function(t,e,n,r,a){return function(t,e){return C(t,!0,e)}([[t,e],[t+n,e],[t+n,e+r],[t,e+r]],a)}(t,e,n,r,i)),this._drawable("rectangle",o,i)},n.prototype.ellipse=function(t,e,n,r,a){var i=this._options(a),o=[];if(i.fill)if("solid"===i.fillStyle){var s=P(t,e,n,r,i);s.type="fillPath",o.push(s)}else o.push(function(t,e,n,r,a){return S(a,j).fillEllipse(t,e,n,r,a)}(t,e,n,r,i));return o.push(P(t,e,n,r,i)),this._drawable("ellipse",o,i)},n.prototype.circle=function(t,e,n,r){var a=this.ellipse(t,e,n,n,r);return a.shape="circle",a},n.prototype.linearPath=function(t,e){var n=this._options(e);return this._drawable("linearPath",[C(t,!1,n)],n)},n.prototype.arc=function(t,e,n,r,a,i,o,s){void 0===o&&(o=!1);var c=this._options(s),h=[];if(o&&c.fill)if("solid"===c.fillStyle){var l=O(t,e,n,r,a,i,!0,!1,c);l.type="fillPath",h.push(l)}else h.push(function(t,e,n,r,a,i,o){var s=S(o,j).fillArc(t,e,n,r,a,i,o);if(s)return s;var c=t,h=e,l=Math.abs(n/2),u=Math.abs(r/2);l+=I(.01*l,o),u+=I(.01*u,o);for(var p=a,d=i;p<0;)p+=2*Math.PI,d+=2*Math.PI;d-p>2*Math.PI&&(p=0,d=2*Math.PI);for(var f=(d-p)/o.curveStepCount,g=[],y=p;y<=d;y+=f)g.push([c+l*Math.cos(y),h+u*Math.sin(y)]);return g.push([c+l*Math.cos(d),h+u*Math.sin(d)]),g.push([c,h]),R(g,o)}(t,e,n,r,a,i,c));return h.push(O(t,e,n,r,a,i,o,!0,c)),this._drawable("arc",h,c)},n.prototype.curve=function(t,e){var n=this._options(e);return this._drawable("curve",[N(t,n)],n)},n.prototype.polygon=function(t,e){var n=this._options(e),r=[];if(n.fill)if("solid"===n.fillStyle)r.push(E(t,n));else{var a=this.computePolygonSize(t),i=R([[0,0],[a[0],0],[a[0],a[1]],[0,a[1]]],n);i.type="path2Dpattern",i.size=a,i.path=this.polygonPath(t),r.push(i)}return r.push(C(t,!0,n)),this._drawable("polygon",r,n)},n.prototype.path=function(t,e){var n=this._options(e),r=[];if(!t)return this._drawable("path",r,n);if(n.fill)if("solid"===n.fillStyle){var a={type:"path2Dfill",path:t,ops:[]};r.push(a)}else{var i=this.computePathSize(t);(a=R([[0,0],[i[0],0],[i[0],i[1]],[0,i[1]]],n)).type="path2Dpattern",a.size=i,a.path=t,r.push(a)}return r.push(function(t,e){t=(t||"").replace(/\n/g," ").replace(/(-\s)/g,"-").replace("/(ss)/g"," ");var n=new s(t);if(e.simplification){var r=new h(n.linearPoints,n.closed).fit(e.simplification);n=new s(r)}for(var a=[],i=n.segments||[],o=0;o<i.length;o++){var c=W(n,i[o],o>0?i[o-1]:null,e);c&&c.length&&(a=a.concat(c))}return{type:"path",ops:a}}(t,n)),this._drawable("path",r,n)},n}(r),X="undefined"!=typeof document,F=function(t){function n(e,n){var r=t.call(this,e)||this;return r.gen=new V(n||null,r.canvas),r}return e(n,t),Object.defineProperty(n.prototype,"generator",{get:function(){return this.gen},enumerable:!0,configurable:!0}),n.prototype.getDefaultOptions=function(){return this.gen.defaultOptions},n.prototype.line=function(t,e,n,r,a){var i=this.gen.line(t,e,n,r,a);return this.draw(i),i},n.prototype.rectangle=function(t,e,n,r,a){var i=this.gen.rectangle(t,e,n,r,a);return this.draw(i),i},n.prototype.ellipse=function(t,e,n,r,a){var i=this.gen.ellipse(t,e,n,r,a);return this.draw(i),i},n.prototype.circle=function(t,e,n,r){var a=this.gen.circle(t,e,n,r);return this.draw(a),a},n.prototype.linearPath=function(t,e){var n=this.gen.linearPath(t,e);return this.draw(n),n},n.prototype.polygon=function(t,e){var n=this.gen.polygon(t,e);return this.draw(n),n},n.prototype.arc=function(t,e,n,r,a,i,o,s){void 0===o&&(o=!1);var c=this.gen.arc(t,e,n,r,a,i,o,s);return this.draw(c),c},n.prototype.curve=function(t,e){var n=this.gen.curve(t,e);return this.draw(n),n},n.prototype.path=function(t,e){var n=this.gen.path(t,e);return this.draw(n),n},n}(function(){function t(t){this.canvas=t,this.ctx=this.canvas.getContext("2d")}return t.prototype.draw=function(t){for(var e=t.sets||[],n=t.options||this.getDefaultOptions(),r=this.ctx,a=0,i=e;a<i.length;a++){var o=i[a];switch(o.type){case"path":r.save(),r.strokeStyle=n.stroke,r.lineWidth=n.strokeWidth,this._drawToContext(r,o),r.restore();break;case"fillPath":r.save(),r.fillStyle=n.fill||"",this._drawToContext(r,o),r.restore();break;case"fillSketch":this.fillSketch(r,o,n);break;case"path2Dfill":this.ctx.save(),this.ctx.fillStyle=n.fill||"";var s=new Path2D(o.path);this.ctx.fill(s),this.ctx.restore();break;case"path2Dpattern":var c=this.canvas.ownerDocument||X&&document;if(c){var h=o.size,l=c.createElement("canvas"),u=l.getContext("2d"),p=this.computeBBox(o.path);p&&(p.width||p.height)?(l.width=this.canvas.width,l.height=this.canvas.height,u.translate(p.x||0,p.y||0)):(l.width=h[0],l.height=h[1]),this.fillSketch(u,o,n),this.ctx.save(),this.ctx.fillStyle=this.ctx.createPattern(l,"repeat"),s=new Path2D(o.path),this.ctx.fill(s),this.ctx.restore()}else console.error("Cannot render path2Dpattern. No defs/document defined.")}}},t.prototype.computeBBox=function(t){if(X)try{var e="http://www.w3.org/2000/svg",n=document.createElementNS(e,"svg");n.setAttribute("width","0"),n.setAttribute("height","0");var r=self.document.createElementNS(e,"path");r.setAttribute("d",t),n.appendChild(r),document.body.appendChild(n);var a=r.getBBox();return document.body.removeChild(n),a}catch(t){}return null},t.prototype.fillSketch=function(t,e,n){var r=n.fillWeight;r<0&&(r=n.strokeWidth/2),t.save(),t.strokeStyle=n.fill||"",t.lineWidth=r,this._drawToContext(t,e),t.restore()},t.prototype._drawToContext=function(t,e){t.beginPath();for(var n=0,r=e.ops;n<r.length;n++){var a=r[n],i=a.data;switch(a.op){case"move":t.moveTo(i[0],i[1]);break;case"bcurveTo":t.bezierCurveTo(i[0],i[1],i[2],i[3],i[4],i[5]);break;case"qcurveTo":t.quadraticCurveTo(i[0],i[1],i[2],i[3]);break;case"lineTo":t.lineTo(i[0],i[1])}}"fillPath"===e.type?t.fill():t.stroke()},t}()),J="undefined"!=typeof document,U=function(t){function n(e,n){var r=t.call(this,e)||this;return r.gen=new V(n||null,r.svg),r}return e(n,t),Object.defineProperty(n.prototype,"generator",{get:function(){return this.gen},enumerable:!0,configurable:!0}),n.prototype.getDefaultOptions=function(){return this.gen.defaultOptions},n.prototype.opsToPath=function(t){return this.gen.opsToPath(t)},n.prototype.line=function(t,e,n,r,a){var i=this.gen.line(t,e,n,r,a);return this.draw(i)},n.prototype.rectangle=function(t,e,n,r,a){var i=this.gen.rectangle(t,e,n,r,a);return this.draw(i)},n.prototype.ellipse=function(t,e,n,r,a){var i=this.gen.ellipse(t,e,n,r,a);return this.draw(i)},n.prototype.circle=function(t,e,n,r){var a=this.gen.circle(t,e,n,r);return this.draw(a)},n.prototype.linearPath=function(t,e){var n=this.gen.linearPath(t,e);return this.draw(n)},n.prototype.polygon=function(t,e){var n=this.gen.polygon(t,e);return this.draw(n)},n.prototype.arc=function(t,e,n,r,a,i,o,s){void 0===o&&(o=!1);var c=this.gen.arc(t,e,n,r,a,i,o,s);return this.draw(c)},n.prototype.curve=function(t,e){var n=this.gen.curve(t,e);return this.draw(n)},n.prototype.path=function(t,e){var n=this.gen.path(t,e);return this.draw(n)},n}(function(){function t(t){this.svg=t}return Object.defineProperty(t.prototype,"defs",{get:function(){var t=this.svg.ownerDocument||J&&document;if(t&&!this._defs){var e=t.createElementNS("http://www.w3.org/2000/svg","defs");this.svg.firstChild?this.svg.insertBefore(e,this.svg.firstChild):this.svg.appendChild(e),this._defs=e}return this._defs||null},enumerable:!0,configurable:!0}),t.prototype.draw=function(t){for(var e=t.sets||[],n=t.options||this.getDefaultOptions(),r=this.svg.ownerDocument||window.document,a=r.createElementNS("http://www.w3.org/2000/svg","g"),i=0,o=e;i<o.length;i++){var s=o[i],c=null;switch(s.type){case"path":(c=r.createElementNS("http://www.w3.org/2000/svg","path")).setAttribute("d",this.opsToPath(s)),c.style.stroke=n.stroke,c.style.strokeWidth=n.strokeWidth+"",c.style.fill="none";break;case"fillPath":(c=r.createElementNS("http://www.w3.org/2000/svg","path")).setAttribute("d",this.opsToPath(s)),c.style.stroke="none",c.style.strokeWidth="0",c.style.fill=n.fill||null;break;case"fillSketch":c=this.fillSketch(r,s,n);break;case"path2Dfill":(c=r.createElementNS("http://www.w3.org/2000/svg","path")).setAttribute("d",s.path||""),c.style.stroke="none",c.style.strokeWidth="0",c.style.fill=n.fill||null;break;case"path2Dpattern":if(this.defs){var h=s.size,l=r.createElementNS("http://www.w3.org/2000/svg","pattern"),u="rough-"+Math.floor(Math.random()*(Number.MAX_SAFE_INTEGER||999999));l.setAttribute("id",u),l.setAttribute("x","0"),l.setAttribute("y","0"),l.setAttribute("width","1"),l.setAttribute("height","1"),l.setAttribute("height","1"),l.setAttribute("viewBox","0 0 "+Math.round(h[0])+" "+Math.round(h[1])),l.setAttribute("patternUnits","objectBoundingBox");var p=this.fillSketch(r,s,n);l.appendChild(p),this.defs.appendChild(l),(c=r.createElementNS("http://www.w3.org/2000/svg","path")).setAttribute("d",s.path||""),c.style.stroke="none",c.style.strokeWidth="0",c.style.fill="url(#"+u+")"}else console.error("Cannot render path2Dpattern. No defs/document defined.")}c&&a.appendChild(c)}return a},t.prototype.fillSketch=function(t,e,n){var r=n.fillWeight;r<0&&(r=n.strokeWidth/2);var a=t.createElementNS("http://www.w3.org/2000/svg","path");return a.setAttribute("d",this.opsToPath(e)),a.style.stroke=n.fill||null,a.style.strokeWidth=r+"",a.style.fill="none",a},t}());return{canvas:function(t,e){return new F(t,e)},svg:function(t,e){return new U(t,e)},generator:function(t,e){return new V(t,e)}}}();!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).textures=e()}(this,(function(){"use strict";function t(){return"".concat(Math.random().toString(36),"00000000000000000").replace(/[^a-z]+/g,"").slice(0,5)}return{circles:function(){function e(t){var e=t.append("defs").append("pattern").attr("id",h).attr("patternUnits","userSpaceOnUse").attr("width",n).attr("height",n);r&&e.append("rect").attr("width",n).attr("height",n).attr("fill",r),e.append("circle").attr("cx",n/2).attr("cy",n/2).attr("r",a).attr("fill",o).attr("stroke",s).attr("stroke-width",c),i&&[[0,0],[0,n],[n,0],[n,n]].forEach((function(t){e.append("circle").attr("cx",t[0]).attr("cy",t[1]).attr("r",a).attr("fill",o).attr("stroke",s).attr("stroke-width",c)}))}var n=20,r="",a=2,i=!1,o="#343434",s="#343434",c=0,h=t();return e.heavier=function(t){return a*=0===arguments.length?2:2*t,e},e.lighter=function(t){return a/=0===arguments.length?2:2*t,e},e.thinner=function(t){return n*=0===arguments.length?2:2*t,e},e.thicker=function(t){return n/=0===arguments.length?2:2*t,e},e.background=function(t){return r=t,e},e.size=function(t){return n=t,e},e.complement=function(t){return i=0===arguments.length||t,e},e.radius=function(t){return a=t,e},e.fill=function(t){return o=t,e},e.stroke=function(t){return s=t,e},e.strokeWidth=function(t){return c=t,e},e.id=function(t){return 0===arguments.length?h:(h=t,e)},e.url=function(){return"url(#".concat(h,")")},e},lines:function(){function e(t){var e=t.append("defs").append("pattern").attr("id",o).attr("patternUnits","userSpaceOnUse").attr("width",n).attr("height",n);i&&e.append("rect").attr("width",n).attr("height",n).attr("fill",i),s.forEach((function(t){e.append("path").attr("d",function(t){var e=n;switch(t){case"0/8":case"vertical":return"M ".concat(e/2,", 0 l 0, ").concat(e);case"1/8":return"M ".concat(e/4,",0 l ").concat(e/2,",").concat(e," M ").concat(-e/4,",0 l ").concat(e/2,",").concat(e," M ").concat(3*e/4,",0 l ").concat(e/2,",").concat(e);case"2/8":case"diagonal":return"M 0,".concat(e," l ").concat(e,",").concat(-e," M ").concat(-e/4,",").concat(e/4," l ").concat(e/2,",").concat(-e/2," M ").concat(.75*e,",").concat(5/4*e," l ").concat(e/2,",").concat(-e/2);case"3/8":return"M 0,".concat(.75*e," l ").concat(e,",").concat(-e/2," M 0,").concat(e/4," l ").concat(e,",").concat(-e/2," M 0,").concat(5*e/4," l ").concat(e,",").concat(-e/2);case"4/8":case"horizontal":return"M 0,".concat(e/2," l ").concat(e,",0");case"5/8":return"M 0,".concat(-e/4," l ").concat(e,",").concat(e/2,"M 0,").concat(e/4," l ").concat(e,",").concat(e/2," M 0,").concat(3*e/4," l ").concat(e,",").concat(e/2);case"6/8":return"M 0,0 l ".concat(e,",").concat(e," M ").concat(-e/4,",").concat(.75*e," l ").concat(e/2,",").concat(e/2," M ").concat(3*e/4,",").concat(-e/4," l ").concat(e/2,",").concat(e/2);case"7/8":return"M ".concat(-e/4,",0 l ").concat(e/2,",").concat(e," M ").concat(e/4,",0 l ").concat(e/2,",").concat(e," M ").concat(3*e/4,",0 l ").concat(e/2,",").concat(e);default:return"M ".concat(e/2,", 0 l 0, ").concat(e)}}(t)).attr("stroke-width",a).attr("shape-rendering",c).attr("stroke",r).attr("stroke-linecap","square")}))}var n=20,r="#343434",a=2,i="",o=t(),s=["diagonal"],c="auto";return e.heavier=function(t){return a*=0===arguments.length?2:2*t,e},e.lighter=function(t){return a/=0===arguments.length?2:2*t,e},e.thinner=function(t){return n*=0===arguments.length?2:2*t,e},e.thicker=function(t){return n/=0===arguments.length?2:2*t,e},e.background=function(t){return i=t,e},e.size=function(t){return n=t,e},e.orientation=function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return 0===arguments.length||(s=n),e},e.shapeRendering=function(t){return c=t,e},e.stroke=function(t){return r=t,e},e.strokeWidth=function(t){return a=t,e},e.id=function(t){return 0===arguments.length?o:(o=t,e)},e.url=function(){return"url(#".concat(o,")")},e},paths:function(){function e(t){var e=function(t){var e=a;switch(t){case"squares":return"M ".concat(e/4," ").concat(e/4," l ").concat(e/2," 0 l 0 ").concat(e/2," l ").concat(-e/2," 0 Z");case"nylon":return"M 0 ".concat(e/4," l ").concat(e/4," 0 l 0 ").concat(-e/4," M ").concat(3*e/4," ").concat(e," l 0 ").concat(-e/4," l ").concat(e/4," 0 M ").concat(e/4," ").concat(e/2," l 0 ").concat(e/4," l ").concat(e/4," 0 M ").concat(e/2," ").concat(e/4," l ").concat(e/4," 0 l 0 ").concat(e/4);case"waves":return"M 0 ".concat(e/2," c ").concat(e/8," ").concat(-e/4," , ").concat(3*e/8," ").concat(-e/4," , ").concat(e/2," 0 c ").concat(e/8," ").concat(e/4," , ").concat(3*e/8," ").concat(e/4," , ").concat(e/2," 0 M ").concat(-e/2," ").concat(e/2," c ").concat(e/8," ").concat(e/4," , ").concat(3*e/8," ").concat(e/4," , ").concat(e/2," 0 M ").concat(e," ").concat(e/2," c ").concat(e/8," ").concat(-e/4," , ").concat(3*e/8," ").concat(-e/4," , ").concat(e/2," 0");case"woven":return"M ".concat(e/4,",").concat(e/4,"l").concat(e/2,",").concat(e/2,"M").concat(3*e/4,",").concat(e/4,"l").concat(e/2,",").concat(-e/2," M").concat(e/4,",").concat(3*e/4,"l").concat(-e/2,",").concat(e/2,"M").concat(3*e/4,",").concat(5*e/4,"l").concat(e/2,",").concat(-e/2," M").concat(-e/4,",").concat(e/4,"l").concat(e/2,",").concat(-e/2);case"crosses":return"M ".concat(e/4,",").concat(e/4,"l").concat(e/2,",").concat(e/2,"M").concat(e/4,",").concat(3*e/4,"l").concat(e/2,",").concat(-e/2);case"caps":return"M ".concat(e/4,",").concat(3*e/4,"l").concat(e/4,",").concat(-e/2,"l").concat(e/4,",").concat(e/2);case"hexagons":return n=3,r=Math.sqrt(3),"M ".concat(e,",0 l ").concat(e,",0 l ").concat(e/2,",").concat(e*Math.sqrt(3)/2," l ").concat(-e/2,",").concat(e*Math.sqrt(3)/2," l ").concat(-e,",0 l ").concat(-e/2,",").concat(-e*Math.sqrt(3)/2," Z M 0,").concat(e*Math.sqrt(3)/2," l ").concat(e/2,",0 M ").concat(3*e,",").concat(e*Math.sqrt(3)/2," l ").concat(-e/2,",0");default:return t(e)}}(c),p=t.append("defs").append("pattern").attr("id",h).attr("patternUnits","userSpaceOnUse").attr("width",a*n).attr("height",a*r);s&&p.append("rect").attr("width",a*n).attr("height",a*r).attr("fill",s),p.append("path").attr("d",e).attr("fill",l).attr("stroke",i).attr("stroke-width",o).attr("stroke-linecap","square").attr("shape-rendering",u)}var n=1,r=1,a=20,i="#343434",o=2,s="",c=function(t){return"M ".concat(t/4,",").concat(3*t/4,"l").concat(t/4,",").concat(-t/2,"l").concat(t/4,",").concat(t/2)},h=t(),l="transparent",u="auto";return e.heavier=function(t){return o*=0===arguments.length?2:2*t,e},e.lighter=function(t){return o/=0===arguments.length?2:2*t,e},e.thinner=function(t){return a*=0===arguments.length?2:2*t,e},e.thicker=function(t){return a/=0===arguments.length?2:2*t,e},e.background=function(t){return s=t,e},e.shapeRendering=function(t){return u=t,e},e.size=function(t){return a=t,e},e.d=function(t){return c=t,e},e.fill=function(t){return l=t,e},e.stroke=function(t){return i=t,e},e.strokeWidth=function(t){return o=t,e},e.id=function(t){return 0===arguments.length?h:(h=t,e)},e.url=function(){return"url(#".concat(h,")")},e}}})),window.requirejs.define({"previews/lib/parse.toc":function(t,e,n){var r,a,i,o;o=e("./transform.headings"),a=function(t,e){return t&&t.dataset?t.dataset[e]:null},r=function(t){var e,n,r;if(!(e=t.querySelector("a")))return!1;if(0===(n=e.getAttribute("href")||"").indexOf("#")){r=null;try{r=document.querySelector("#"+CSS.escape(n.substring(1))+".blank_anchor_id")}catch(t){t,r=null}if(r&&r.parentElement&&r.parentElement.parentElement&&(r=r.parentElement.parentElement,"true"===a(r,"mindmapHidden")))return!0}return!1},i=function(t,e,n){var o,s,c,h,l,u,p,d,f,g,y,v,m,x;if(t){if("UL"===(y=t.nodeName))for(e+=1,v=function(t){var e;return(e=t.children)&&1===e.length&&"UL"===e[0].nodeName&&(e=v(e[0])),e},l=0,p=(s=t.children).length;l<p;l++)o=s[l],i(o,e,n);if("LI"===y&&!r(t))for(u=0,d=(s=t.children).length;u<d;u++)o=s[u],i(o,e,n);if("A"===y){if(h=t.getAttribute("href")||"",x=t.getAttribute("title"),c={depth:e,name:t.textContent,html:t.innerHTML,link:h,title:x},0===h.indexOf("#")){m=null;try{m=document.querySelector("#"+CSS.escape(h.substring(1))+".blank_anchor_id")}catch(t){t,m=null}m&&m.parentElement&&m.parentElement.parentElement&&(m=m.parentElement.parentElement,(g=a(m,"mindmapName"))&&(c.name=g),(f=a(m,"mindmapId"))&&(c.customKey=f),a(m,"mindmapImportantNode")&&(c.important=!0),a(m,"mindmapImportantPath")&&(c.importantPath=!0),a(m,"mindmapRangeNode")&&(c.rangeNode=!0))}n.push(c)}}},n.exports=function(t,e,n,r){var a;return i(t,0,a=[]),o(a,e,n,r)}}}),window.requirejs.define({"previews/lib/parse.txtmap":function(t,e,n){n.exports=function(t){for(var e=t.split("\n"),n=[],r=0;r<e.length;r++)if(""!==e[r].trim()){var a=/^(\s*)(.+)$/.exec(e[r]);if(a){var i=a[1].length>0&&" "===a[1][0],o=a[1].length;i&&(o/=2),o+=1,n.push({depth:o,line:r+1,name:a[2]})}}return n}}}),window.requirejs.define({"previews/lib/transform.headings":function(t,e,n){n.exports=function(t,e,n,r){var a,i={name:n||"root",depth:0,children:[]},o=i,s=[];if(r=r||{},t.forEach((function(t,e){for(;t.depth<o.depth+1;)o=s.pop();for(;t.depth>o.depth+1;)o.children&&0!==o.children.length||(a={name:"",depth:o.depth+1},r.autoCollapse&&(a.autoCollapse=!0),o.children=o.children||[],o.children.push(a)),s.push(o),o=o.children[o.children.length-1];o.children=o.children||[],o.children.push(t)})),i=function t(e,n){e.depth-=n;for(;e.children&&1===e.children.length&&e.children[0].autoCollapse&&n<20;)e.children=e.children[0].children,n+=1;e.children&&(e.children=e.children.map((function(e){return e.autoCollapse&&e.children&&1===e.children.length?t(e.children[0],n+1):t(e,n)})));e.autoCollapse&&delete e.autoCollapse;return e}(i,0),e&&1===i.children.length){(function t(e){if(e.depth=e.depth-1,e.children)for(var n=0;n<e.children.length;n++){t(e.children[n])}})(i=i.children[0])}return e&&""===i.name&&n&&(i.name=n),i}}}),window.requirejs.define({"previews/lib/utils":function(t,e,n){var r;(r={}).escape=function(t){return String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},r.deparam=function(t,e){var n={},r={true:!0,false:!1,null:null};return t.replace(/\+/g," ").split("&").forEach((function(t){var a,i=t.split("="),o=decodeURIComponent(i[0]),s=n,c=0,h=o.split("]["),l=h.length-1;if(/\[/.test(h[0])&&/\]$/.test(h[l])?(h[l]=h[l].replace(/\]$/,""),l=(h=h.shift().split("[").concat(h)).length-1):l=0,2===i.length)if(a=decodeURIComponent(i[1]),e&&(a=a&&!isNaN(a)&&+a+""===a?+a:"undefined"===a?void 0:void 0!==r[a]?r[a]:a),l)for(;c<=l;c++)s=s[o=""===h[c]?s.length:h[c]]=c<l?s[o]||(h[c+1]&&isNaN(h[c+1])?{}:[]):a;else"[object Array]"===Object.prototype.toString.call(n[o])?n[o].push(a):!{}.hasOwnProperty.call(n,o)?n[o]=a:n[o]=[n[o],a];else o&&(n[o]=e?void 0:"")})),n},n.exports=r}}),window.requirejs.define({"previews/preview":function(t,e,n){var r,a,i,o,s;o=e("./lib/utils"),r=e("./lib/parse.toc"),i=e("./lib/transform.headings"),a=e("./lib/parse.txtmap"),s=function(t){var e,n,s,c,h,l;return null==t&&(t=l),t.pending=!1,e=t.document,l=t,"undefined"!=typeof MathJax&&null!==MathJax&&MathJax.Hub.Config({showProcessingMessages:!1,messageStyle:"none",tex2jax:{inlineMath:[["$","$"],["\\(","\\)"]],ignoreClass:"preview",processClass:"mathjax"},"HTML-CSS":{linebreaks:{automatic:!0}},TeX:{equationNumbers:{autoNumber:"AMS"},extensions:["autoload-all.js"]},SVG:{linebreaks:{automatic:!0},showMathMenu:!1}}),t.getSelectedText=function(){var n;return n="",t.getSelection?n=t.getSelection().toString():e.selection&&"Control"!==e.selection.type&&(n=e.selection.createRange().text),n},t.locationByHashTag=function(t){var n;return null==t&&(t=""),t.startsWith("#")||(t="#"+t),(n=e.createElement("a")).href=t,n.click()},h=function(){var e,n;if(l.MathJax)return(e=MathJax.Hub).Configured(),t.HUB=e,e.Cancel?void 0:(e.cancelTypeset=!1,e.Register.StartupHook("HTML-CSS Jax Config",(function(){var t,n;return t=MathJax.OutputJax["HTML-CSS"],n=t.Translate,t.Augment({Translate:function(r,a){if(e.cancelTypeset||a.cancelled)throw Error("MathJax Canceled");return n.call(t,r,a)}})})),e.Register.StartupHook("SVG Jax Config",(function(){var t,n;return t=MathJax.OutputJax.SVG,n=t.Translate,t.Augment({Translate:function(r,a){if(e.cancelTypeset||a.cancelled)throw Error("MathJax Canceled");return n.call(t,r,a)}})})),e.Register.StartupHook("TeX Jax Config",(function(){var t,n;return t=MathJax.InputJax.TeX,n=t.Translate,t.Augment({Translate:function(r,a){if(e.cancelTypeset||a.cancelled)throw Error("MathJax Canceled");return n.call(t,r,a)}})})),n=e.processError,t.PROCESSERROR=n,e.processError=function(t,r,a){return"MathJax Canceled"!==t.message?n.call(e,t,r,a):(MathJax.Message.Clear(0,0),r.jaxIDs=[],r.jax={},r.scripts=[],r.i=r.j=0,r.cancelled=!0,null)},e.Cancel=function(){return this.cancelTypeset=!0})},t.beforeRenderPreview=function(e){return t.pending||(t.pending=!0,MathJax.Hub.Cancel()),MathJax.InputJax.TeX&&MathJax.InputJax.TeX.resetEquationNumbers&&MathJax.Hub.Queue(["resetEquationNumbers",MathJax.InputJax.TeX]),"function"==typeof e?e():void 0},h(),t.mermaid&&(t.checkMermaidParse=function(e){var n;try{return t.mermaid.parse(e),t.mermaidError="",!0}catch(e){return n=e,t.mermaidError=n.str||n.message,!1}},t.mermaid.initialize({fontFamily:"monospace",flowchart:{htmlLabels:!0},er:{fontSize:16},journey:{textPlacement:"old"},gantt:{numberSectionStyles:4,axisFormatter:[["%I:%M",function(t){return t.getHours()}],["w. %U",function(t){return 1===t.getDay()}],["%a %d",function(t){return t.getDay()&&1!==t.getDate()}],["%b %d",function(t){return 1!==t.getDate()}],["%m-%y",function(t){return t.getMonth()}]]}})),SVGElement.prototype.getTransformToElement=SVGElement.prototype.getTransformToElement||function(t){return t.getScreenCTM().inverse().multiply(this.getScreenCTM())},t.renderPreview=function(e,n,r,a,i){var o,s;if(o=e.mathjax__autoNumber?"AMS":"none",MathJax.Hub.Config({TeX:{equationNumbers:{autoNumber:o}}}),MathJax.Hub.Queue((function(){return t.pending=!1,MathJax.Hub.cancelTypeset=!1})),MathJax.Hub.Queue(["Typeset",MathJax.Hub]),MathJax.Hub.Queue((function(){return setTimeout((function(){return t.fixTextEmphasis(r),t.fixMarkdownVertical(r),"function"==typeof i?i():void 0}),1)})),t.processCodeMindmap(e,n,r,a),t.processTocMindmap(e,n,r,a),t.processFlow(e,n,r),t.processAllWaveDrom(n),t.mermaid)try{return t.mermaid.init()}catch(t){return s=t,console.log(s)}},c=!1,n=function(t){var e,n;if((t=(t=t.replace(/[# ]/g,"")).replace(/,{2,}/,","))&&","!==t&&0!==(e=t.split(",")).length)return n=[],e.forEach((function(t,e){if(/^#[0-9A-F]{6}$/i.test("#"+t))return n.push("#"+t)})),0===n.length?null:n},s=function(t){var e,n;if((t=t.replace(/[ ]/g,""))&&","!==t&&0!==(e=t.split(",")).length)return n=[],e.forEach((function(t,e){var r;if(r=parseInt(t))return n.push(r)})),0===n.length?null:n},t.fixMarkdownVertical=function(t){if("xsj_export_pdf"===t.brand&&l.$)return $(".markdown_vertical").map((function(t,e){var n,r,a,i;return n=$(e),i=(r=l.getComputedStyle(e)).fontSize,a=r.fontFamily,n.attr("data-font-size",i),n.attr("data-font-family",a)}))},t.fixTextEmphasis=function(e){var n,r,a,i;if("xsj_export_pdf"===e.brand&&l.$&&(n=$("em.markdown_em_asterisk, em.markdown_em_underline, .xsj_code_strong"),a=!1,n.map((function(t,e){var n,r;if(n=$(e),(r=l.getComputedStyle(e)).webkitTextEmphasisStyle&&"none"!==r.webkitTextEmphasisStyle)return 0===n.closest(".markdown_vertical").length?(a=!0,"function"==typeof n.emphasis?n.emphasis(r.webkitTextEmphasisStyle,r.webkitTextEmphasisPosition):void 0):n.addClass("markdown_vertical_emphasis")})),a&&t.xsjPatchEmphasis))return i=t.xsjPatchEmphasis,(r=$("<style></style>")).html(i),void $(n[0]).prepend(r)},t.processCodeMindmap=function(r,c,h,l){var u,p,d,f,g,y,v,m,x,b,w,M,k,_,S,j,T,C,N,P,O,E,R,L,I,A,B,H,D;for(R=[],C=0,N=(g=t.document.querySelectorAll(".mindmap_code")).length;C<N;C++)if(!(f=g[C]).__isInited)if(f.__isInited=!0,_=f.dataset.hash+h.mindmap_fixForLink,p=c.get(_))R.push(f.innerHTML=p);else{if(E=(j=f.dataset.info||"").indexOf("?"),j=j.substring(E+1),T=o.deparam(j),x=(m=f.innerText).split(/\n+-{3,}\n*/),m=x[0],B=(B=x[1]||"").trim(),L=l._rootWindow,B&&L&&L.jsyaml){try{D=L.jsyaml.load(B),D=JSON.parse(JSON.stringify(D))}catch(t){H=t.toString()}T=Object.assign({},D,T)}w=T.root||"root",u=!0,T.root&&(u=!1),S=a(m),O=i(S,u,w,T),d="",T.title&&(d='<br><div class="xsj_mindmap_caption">'+o.escape(T.title)+"</div>"),I=Date.now(),f.innerHTML='<div class="xsj_mindmap xsj_mindmap_code"><svg id="xsj_mindmap_code_'+I+'" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"  version="1.1"></svg>'+d+"</div>",P={preset:"colorful",linkShape:"diagonal",layoutDirection:"LR",fixForLink:!1},h.mindmap_fixForLink&&(P.fixForLink=!0),"gray"===(A=T.theme||r.mindmap__theme)&&(P.color=A),(y=T.colors||r.mindmap__colors)&&(y=n(y))&&(P.colorSet=y),(v=T.colorsMode||r.mindmap__colorsMode)&&(P.colorSetMode=v),(k=T.fontSizes||r.mindmap__fontSizes)&&(k=s(k))&&(P.fontSizeSet=k),b=T.direction||r.mindmap__direction,/^(H|V|LR|RL|TB|BT)$/gi.test(b)&&(P.layoutDirection=b.toUpperCase()),P.importantPaths=T.importantPaths||[],P.importantNodes=T.importantNodes||[],P.rangeNodes=T.rangeNodes||[],P.annotations=T.annotations||[],P.relations=T.relations||[],t.markmap("#xsj_mindmap_code_"+I,O,P),H&&((M=e.createElement("div")).style.color="red",M.innerText="\u601d\u7ef4\u5bfc\u56fe\u5143\u6570\u636e\u89e3\u6790\u9519\u8bef\uff1a"+H,f.appendChild(M)),R.push(c.set(_,f.innerHTML))}return R},t.processTocMindmap=function(e,a,i,c){var h,l,u,p,d,f,g,y,v,m,x,b,w,M,k,_,S,j,T,C,N;for(N=t.document.querySelectorAll(".mindmap_toc"),g=c.doc,y=c.meta.title||g.title||"root",S=[],w=0,M=N.length;w<M;w++)(C=N[w]).__isInited||(x=C.dataset.info||"",y=(b=o.deparam(x)).root||y,h=!0,b.root&&(h=!1),m=C.dataset.hash+y+i.mindmap_fixForLink,(l=a.get(m))?C.innerHTML=l:(_=r(C.firstChild,h,y,b),u="",b.title&&(u='<br><div class="xsj_mindmap_caption">'+o.escape(b.title)+"</div>"),j=Date.now(),C.innerHTML='<div class="xsj_mindmap xsj_mindmap_toc"><svg id="xsj_mindmap_toc_'+j+'" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"  version="1.1"></svg>'+u+"</div>",k={preset:"colorful",linkShape:"diagonal",layoutDirection:"LR",fixForLink:!1},i.mindmap_fixForLink&&(k.fixForLink=!0),"gray"===(T=b.theme||e.mindmap__theme)&&(k.color=T),(p=b.colors||e.mindmap__colors)&&(p=n(p))&&(k.colorSet=p),(d=b.colorsMode||e.mindmap__colorsMode)&&(k.colorSetMode=d),(v=b.fontSizes||e.mindmap__fontSizes)&&(v=s(v))&&(k.fontSizeSet=v),f=b.direction||e.mindmap__direction,/^(H|V|LR|RL|TB|BT)$/gi.test(f)&&(k.layoutDirection=f.toUpperCase()),k.importantPaths=b.importantPaths||[],k.importantNodes=b.importantNodes||[],k.rangeNodes=b.rangeNodes||[],k.annotations=b.annotations||[],k.relations=b.relations||[],t.markmap("#xsj_mindmap_toc_"+j,_,k),a.set(m,C.innerHTML)),S.push(C.__isInited=!0));return S},function(){return{}},t.processFlow=function(t,n,r){var a,i,o,s,c,h,l,u,p;for(c=e.getElementsByClassName("xsj_flow"),h={},u=0,p=[];u<c.length;)if((s=c[u]).__isInited)u++;else{l=s.getAttribute("data-hash"),i=s.textContent,s.textContent="",a=n.get(l);try{a?s.innerHTML=a:(flowchart.parse(i).drawSVG(s,h),n.set(l,s.innerHTML))}catch(t){o=t,s.innerHTML=o.toString()}s.__isInited=!0,p.push(u++)}return p},t.processSequence=function(t,n,r){var a,i,o,s,c,h,l,u,p,d;for(c=e.getElementsByClassName("xsj_sequence"),l=0,u=[];l<c.length;){try{h=(s=c[l]).getAttribute("data-hash"),"simple"!==(d=s.getAttribute("data-theme")||t.sequence__theme)&&"hand"!==d&&(d="hand"),i=s.textContent,s.textContent="",(a=n.get(h))?s.innerHTML=a:(Diagram.parse(i).drawSVG(s,{theme:d}),(p=s.getElementsByTagName("svg"))&&p.length>0&&p[0].setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),n.set(h,s.innerHTML))}catch(t){o=t,console.error(o)}u.push(l++)}return u},t.processAllWaveDrom=function(t){var n,r,a,i,o,s,h,l,u,p,d,f,g,y,v;for(h=e.getElementsByClassName("xsj_wavedrom"),y=e.getElementsByClassName("wavedrom_svg_hidden")[0],p=0,f=[];p<h.length;)if(d=p,!c&&t&&(d=t.getCounter(),d=0),i=h[p],p++,!i.__isInited){if(u=i.getAttribute("data-hash"),c&&t){if(r=t.get(u)){i.innerHTML=r;continue}d=t.getCounter()}if(i.id="wavedrom"+d,(v=i.innerText||"").trim()){try{if(a=JSON.parse(v.replace(/([(\w)|(\-)]+)(:)/g,'"$1"$2').replace(/'/g,'"')),WaveDrom.RenderWaveForm(d,a,"wavedrom"),(g=i.children[0]).setAttribute("class","wavedrom_svg"),!c)for(s=g.children,n=0;n<s.length;)"style"!==(o=s[n]).tagName&&"defs"!==o.tagName||(c=!0,"defs"===o.tagName&&o.setAttribute("class","wavedrom_svg_defs"),y.appendChild(o),n--),n++;t&&t.set(u,i.innerHTML)}catch(t){l=t,i.textContent=l.toString(),console.log(l)}f.push(i.__isInited=!0)}}return f},t.html2img=function(t,n){var r,a,i;for((r=e.documentElement).classList.add("xiaoshujiang_camera"),i=e.getElementsByClassName("xiaoshujiang_element"),a=0;a<i.length;)i[a].classList.add("xiaoshujiang_element_hide"),a++;return t||(t=r),domtoimage.toBlob(t).then((function(t){for(r.classList.remove("xiaoshujiang_camera"),a=0;a<i.length;)i[a].classList.remove("xiaoshujiang_element_hide"),a++;return n(null,t)})).catch((function(t){for(r.classList.remove("xiaoshujiang_camera"),a=0;a<i.length;)i[a].classList.remove("xiaoshujiang_element_hide"),a++;return n(t)}))},t.scalePreview=function(t){var e;return e=$(".html_preview.preview"),t>10&&(t=10),t<0&&(t=.1),1===t?e.css("transform",""):e.css("transform","scale("+t+")")}},n.exports=s}});
